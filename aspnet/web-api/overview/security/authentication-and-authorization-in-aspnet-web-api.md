---
uid: web-api/overview/security/authentication-and-authorization-in-aspnet-web-api
title: Autenticazione e autorizzazione nellASP.NETAPI Web Documenti Microsoft
author: MikeWasson
description: Viene fornita una panoramica generale dell'autenticazione e dell'autorizzazione nellASP.NETAPI Web.
ms.author: riande
ms.date: 11/27/2012
ms.assetid: 6dfb51ea-9f4d-4e70-916c-8ef8344a88d6
msc.legacyurl: /web-api/overview/security/authentication-and-authorization-in-aspnet-web-api
msc.type: authoredcontent
ms.openlocfilehash: 368d2b9456d12b2bb4063a23333e5c8837faa3b8
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2020
ms.locfileid: "80676258"
---
# <a name="authentication-and-authorization-in-aspnet-web-api"></a><span data-ttu-id="2e87e-103">Authentication and Authorization in ASP.NET Web API (in inglese)</span><span class="sxs-lookup"><span data-stu-id="2e87e-103">Authentication and Authorization in ASP.NET Web API</span></span>

<span data-ttu-id="2e87e-104">da parte di [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="2e87e-104">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

<span data-ttu-id="2e87e-105">È stata creata un'API Web, ma ora si desidera controllarne l'accesso.</span><span class="sxs-lookup"><span data-stu-id="2e87e-105">You've created a web API, but now you want to control access to it.</span></span> <span data-ttu-id="2e87e-106">In questa serie di articoli verranno esaminare alcune opzioni per la protezione di un'API Web da utenti non autorizzati.</span><span class="sxs-lookup"><span data-stu-id="2e87e-106">In this series of articles, we'll look at some options for securing a web API from unauthorized users.</span></span> <span data-ttu-id="2e87e-107">Questa serie riguarda sia l'autenticazione che l'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="2e87e-107">This series will cover both authentication and authorization.</span></span>

- <span data-ttu-id="2e87e-108">*L'autenticazione* conosce l'identità dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-108">*Authentication* is knowing the identity of the user.</span></span> <span data-ttu-id="2e87e-109">Ad esempio, Alice accede con il proprio nome utente e password e il server utilizza la password per autenticare Alice.</span><span class="sxs-lookup"><span data-stu-id="2e87e-109">For example, Alice logs in with her username and password, and the server uses the password to authenticate Alice.</span></span>
- <span data-ttu-id="2e87e-110">*L'autorizzazione* decide se un utente è autorizzato a eseguire un'azione.</span><span class="sxs-lookup"><span data-stu-id="2e87e-110">*Authorization* is deciding whether a user is allowed to perform an action.</span></span> <span data-ttu-id="2e87e-111">Ad esempio, Alice dispone dell'autorizzazione per ottenere una risorsa ma non di creare una risorsa.</span><span class="sxs-lookup"><span data-stu-id="2e87e-111">For example, Alice has permission to get a resource but not create a resource.</span></span>

<span data-ttu-id="2e87e-112">Il primo articolo della serie fornisce una panoramica generale dell'autenticazione e dell'autorizzazione in ASP.NETAPI Web.</span><span class="sxs-lookup"><span data-stu-id="2e87e-112">The first article in the series gives a general overview of authentication and authorization in ASP.NET Web API.</span></span> <span data-ttu-id="2e87e-113">Altri argomenti descrivono scenari di autenticazione comuni per l'API Web.Other topics describe common authentication scenarios for Web API.</span><span class="sxs-lookup"><span data-stu-id="2e87e-113">Other topics describe common authentication scenarios for Web API.</span></span>

> [!NOTE]
> <span data-ttu-id="2e87e-114">Grazie alle persone che hanno recensito questa serie e fornito feedback preziosi: Rick Anderson, Levi Broderick, Barry Dorrans, Tom Dykstra, Hongmei Ge, David Matson, Daniel Roth, Tim Teebken.</span><span class="sxs-lookup"><span data-stu-id="2e87e-114">Thanks to the people who reviewed this series and provided valuable feedback: Rick Anderson, Levi Broderick, Barry Dorrans, Tom Dykstra, Hongmei Ge, David Matson, Daniel Roth, Tim Teebken.</span></span>

## <a name="authentication"></a><span data-ttu-id="2e87e-115">Authentication</span><span class="sxs-lookup"><span data-stu-id="2e87e-115">Authentication</span></span>

<span data-ttu-id="2e87e-116">L'API Web presuppone che l'autenticazione avvenga nell'host.</span><span class="sxs-lookup"><span data-stu-id="2e87e-116">Web API assumes that authentication happens in the host.</span></span> <span data-ttu-id="2e87e-117">Per l'hosting Web, l'host è IIS, che utilizza moduli HTTP per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="2e87e-117">For web-hosting, the host is IIS, which uses HTTP modules for authentication.</span></span> <span data-ttu-id="2e87e-118">È possibile configurare il progetto per l'utilizzo di uno qualsiasi dei moduli di autenticazione incorporati in IIS o ASP.NET oppure scrivere un modulo HTTP personalizzato per eseguire l'autenticazione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="2e87e-118">You can configure your project to use any of the authentication modules built in to IIS or ASP.NET, or write your own HTTP module to perform custom authentication.</span></span>

<span data-ttu-id="2e87e-119">Quando l'host autentica l'utente, crea un *oggetto principal*, ovvero un oggetto [IPrincipal](https://msdn.microsoft.com/library/System.Security.Principal.IPrincipal.aspx) che rappresenta il contesto di sicurezza in cui viene eseguito il codice.</span><span class="sxs-lookup"><span data-stu-id="2e87e-119">When the host authenticates the user, it creates a *principal*, which is an [IPrincipal](https://msdn.microsoft.com/library/System.Security.Principal.IPrincipal.aspx) object that represents the security context under which code is running.</span></span> <span data-ttu-id="2e87e-120">L'host associa l'entità al thread corrente impostando **Thread.CurrentPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-120">The host attaches the principal to the current thread by setting **Thread.CurrentPrincipal**.</span></span> <span data-ttu-id="2e87e-121">L'entità contiene un oggetto **Identity** associato che contiene informazioni sull'utente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-121">The principal contains an associated **Identity** object that contains information about the user.</span></span> <span data-ttu-id="2e87e-122">Se l'utente è autenticato, la proprietà **Identity.IsAuthenticated** restituisce **true**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-122">If the user is authenticated, the **Identity.IsAuthenticated** property returns **true**.</span></span> <span data-ttu-id="2e87e-123">Per le richieste anonime, **IsAuthenticated** restituisce **false**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-123">For anonymous requests, **IsAuthenticated** returns **false**.</span></span> <span data-ttu-id="2e87e-124">Per ulteriori informazioni sulle entità, vedere [Protezione basata](https://msdn.microsoft.com/library/shz8h065.aspx)sui ruoli .</span><span class="sxs-lookup"><span data-stu-id="2e87e-124">For more information about principals, see [Role-Based Security](https://msdn.microsoft.com/library/shz8h065.aspx).</span></span>

### <a name="http-message-handlers-for-authentication"></a><span data-ttu-id="2e87e-125">HTTP Message Handlers for Authentication</span><span class="sxs-lookup"><span data-stu-id="2e87e-125">HTTP Message Handlers for Authentication</span></span>

<span data-ttu-id="2e87e-126">Anziché utilizzare l'host per l'autenticazione, è possibile inserire la logica di autenticazione in un [gestore messaggi HTTP.](../advanced/http-message-handlers.md)</span><span class="sxs-lookup"><span data-stu-id="2e87e-126">Instead of using the host for authentication, you can put authentication logic into an [HTTP message handler](../advanced/http-message-handlers.md).</span></span> <span data-ttu-id="2e87e-127">In tal caso, il gestore messaggi esamina la richiesta HTTP e imposta l'entità.</span><span class="sxs-lookup"><span data-stu-id="2e87e-127">In that case, the message handler examines the HTTP request and sets the principal.</span></span>

<span data-ttu-id="2e87e-128">Quando è consigliabile usare i gestori di messaggi per l'autenticazione?</span><span class="sxs-lookup"><span data-stu-id="2e87e-128">When should you use message handlers for authentication?</span></span> <span data-ttu-id="2e87e-129">Ecco alcuni compromessi:</span><span class="sxs-lookup"><span data-stu-id="2e87e-129">Here are some tradeoffs:</span></span>

- <span data-ttu-id="2e87e-130">Un modulo HTTP vede tutte le richieste che passano attraverso la pipeline ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2e87e-130">An HTTP module sees all requests that go through the ASP.NET pipeline.</span></span> <span data-ttu-id="2e87e-131">Un gestore messaggi visualizza solo le richieste indirizzate all'API Web.</span><span class="sxs-lookup"><span data-stu-id="2e87e-131">A message handler only sees requests that are routed to Web API.</span></span>
- <span data-ttu-id="2e87e-132">È possibile impostare gestori di messaggi per route, che consentono di applicare uno schema di autenticazione a una route specifica.</span><span class="sxs-lookup"><span data-stu-id="2e87e-132">You can set per-route message handlers, which lets you apply an authentication scheme to a specific route.</span></span>
- <span data-ttu-id="2e87e-133">I moduli HTTP sono specifici di IIS.</span><span class="sxs-lookup"><span data-stu-id="2e87e-133">HTTP modules are specific to IIS.</span></span> <span data-ttu-id="2e87e-134">I gestori di messaggi sono indipendenti dall'host, pertanto possono essere utilizzati sia con l'hosting Web che con l'hosting autonomo.</span><span class="sxs-lookup"><span data-stu-id="2e87e-134">Message handlers are host-agnostic, so they can be used with both web-hosting and self-hosting.</span></span>
- <span data-ttu-id="2e87e-135">I moduli HTTP partecipano alla registrazione IIS, al controllo e così via.</span><span class="sxs-lookup"><span data-stu-id="2e87e-135">HTTP modules participate in IIS logging, auditing, and so on.</span></span>
- <span data-ttu-id="2e87e-136">I moduli HTTP vengono eseguiti in precedenza nella pipeline.</span><span class="sxs-lookup"><span data-stu-id="2e87e-136">HTTP modules run earlier in the pipeline.</span></span> <span data-ttu-id="2e87e-137">Se si gestisce l'autenticazione in un gestore messaggi, l'entità non viene impostata fino a quando non viene eseguito il gestore.</span><span class="sxs-lookup"><span data-stu-id="2e87e-137">If you handle authentication in a message handler, the principal does not get set until the handler runs.</span></span> <span data-ttu-id="2e87e-138">Inoltre, l'entità torna all'entità precedente quando la risposta esce dal gestore messaggi.</span><span class="sxs-lookup"><span data-stu-id="2e87e-138">Moreover, the principal reverts back to the previous principal when the response leaves the message handler.</span></span>

<span data-ttu-id="2e87e-139">In genere, se non è necessario supportare l'hosting autonomo, un modulo HTTP è un'opzione migliore.</span><span class="sxs-lookup"><span data-stu-id="2e87e-139">Generally, if you don't need to support self-hosting, an HTTP module is a better option.</span></span> <span data-ttu-id="2e87e-140">Se è necessario supportare l'hosting autonomo, prendere in considerazione un gestore di messaggi.</span><span class="sxs-lookup"><span data-stu-id="2e87e-140">If you need to support self-hosting, consider a message handler.</span></span>

### <a name="setting-the-principal"></a><span data-ttu-id="2e87e-141">Impostazione del principio</span><span class="sxs-lookup"><span data-stu-id="2e87e-141">Setting the Principal</span></span>

<span data-ttu-id="2e87e-142">Se l'applicazione esegue una logica di autenticazione personalizzata, è necessario impostare l'entità su due posizioni:If your application performs any custom authentication logic, you must set the principal on two places:</span><span class="sxs-lookup"><span data-stu-id="2e87e-142">If your application performs any custom authentication logic, you must set the principal on two places:</span></span>

- <span data-ttu-id="2e87e-143">**Thread.CurrentPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-143">**Thread.CurrentPrincipal**.</span></span> <span data-ttu-id="2e87e-144">Questa proprietà è il modo standard per impostare l'entità del thread in .NET.</span><span class="sxs-lookup"><span data-stu-id="2e87e-144">This property is the standard way to set the thread's principal in .NET.</span></span>
- <span data-ttu-id="2e87e-145">**HttpContext.Current.User**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-145">**HttpContext.Current.User**.</span></span> <span data-ttu-id="2e87e-146">Questa proprietà è specifica di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2e87e-146">This property is specific to ASP.NET.</span></span>

<span data-ttu-id="2e87e-147">Il codice seguente mostra come impostare l'entità:The following code shows how to set the principal:</span><span class="sxs-lookup"><span data-stu-id="2e87e-147">The following code shows how to set the principal:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample1.cs)]

<span data-ttu-id="2e87e-148">Per l'hosting web, è necessario impostare l'entità in entrambe le posizioni; in caso contrario, il contesto di sicurezza potrebbe diventare incoerente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-148">For web-hosting, you must set the principal in both places; otherwise the security context may become inconsistent.</span></span> <span data-ttu-id="2e87e-149">Per self-hosting, tuttavia, **HttpContext.Current** è null.</span><span class="sxs-lookup"><span data-stu-id="2e87e-149">For self-hosting, however, **HttpContext.Current** is null.</span></span> <span data-ttu-id="2e87e-150">Per assicurarsi che il codice sia indipendente dall'host, pertanto verificare la presenza di null prima dell'assegnazione a **HttpContext.Current**, come illustrato.</span><span class="sxs-lookup"><span data-stu-id="2e87e-150">To ensure your code is host-agnostic, therefore, check for null before assigning to **HttpContext.Current**, as shown.</span></span>

## <a name="authorization"></a><span data-ttu-id="2e87e-151">Autorizzazione</span><span class="sxs-lookup"><span data-stu-id="2e87e-151">Authorization</span></span>

<span data-ttu-id="2e87e-152">L'autorizzazione viene eseguita più avanti nella pipeline, più vicino al controller.</span><span class="sxs-lookup"><span data-stu-id="2e87e-152">Authorization happens later in the pipeline, closer to the controller.</span></span> <span data-ttu-id="2e87e-153">Ciò consente di effettuare scelte più granulari quando si concede l'accesso alle risorse.</span><span class="sxs-lookup"><span data-stu-id="2e87e-153">That lets you make more granular choices when you grant access to resources.</span></span>

- <span data-ttu-id="2e87e-154">*I filtri di autorizzazione* vengono eseguiti prima dell'azione del controller.</span><span class="sxs-lookup"><span data-stu-id="2e87e-154">*Authorization filters* run before the controller action.</span></span> <span data-ttu-id="2e87e-155">Se la richiesta non è autorizzata, il filtro restituisce una risposta di errore e l'azione non viene richiamata.</span><span class="sxs-lookup"><span data-stu-id="2e87e-155">If the request is not authorized, the filter returns an error response, and the action is not invoked.</span></span>
- <span data-ttu-id="2e87e-156">All'interno di un'azione del controller, è possibile ottenere l'entità corrente dal **ApiController.User** proprietà.</span><span class="sxs-lookup"><span data-stu-id="2e87e-156">Within a controller action, you can get the current principal from the **ApiController.User** property.</span></span> <span data-ttu-id="2e87e-157">Ad esempio, è possibile filtrare un elenco di risorse in base al nome utente, restituendo solo le risorse che appartengono a tale utente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-157">For example, you might filter a list of resources based on the user name, returning only those resources that belong to that user.</span></span>

![](authentication-and-authorization-in-aspnet-web-api/_static/image1.png)

<a id="auth3"></a>
### <a name="using-the-authorize-attribute"></a><span data-ttu-id="2e87e-158">Utilizzo dell'attributo [Authorize]</span><span class="sxs-lookup"><span data-stu-id="2e87e-158">Using the [Authorize] Attribute</span></span>

<span data-ttu-id="2e87e-159">Api Web fornisce un filtro di autorizzazione incorporato, [AuthorizeAttribute](https://msdn.microsoft.com/library/system.web.http.authorizeattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e87e-159">Web API provides a built-in authorization filter, [AuthorizeAttribute](https://msdn.microsoft.com/library/system.web.http.authorizeattribute.aspx).</span></span> <span data-ttu-id="2e87e-160">Questo filtro controlla se l'utente è autenticato.</span><span class="sxs-lookup"><span data-stu-id="2e87e-160">This filter checks whether the user is authenticated.</span></span> <span data-ttu-id="2e87e-161">In caso contrario, restituisce il codice di stato HTTP 401 (Non autorizzato), senza richiamare l'azione.</span><span class="sxs-lookup"><span data-stu-id="2e87e-161">If not, it returns HTTP status code 401 (Unauthorized), without invoking the action.</span></span>

<span data-ttu-id="2e87e-162">È possibile applicare il filtro a livello globale, a livello di controller o a livello di singole azioni.</span><span class="sxs-lookup"><span data-stu-id="2e87e-162">You can apply the filter globally, at the controller level, or at the level of individual actions.</span></span>

<span data-ttu-id="2e87e-163">**A livello globale:** per limitare l'accesso per ogni controller API Web, aggiungere il filtro **AuthorizeAttribute** all'elenco di filtri globali:</span><span class="sxs-lookup"><span data-stu-id="2e87e-163">**Globally**: To restrict access for every Web API controller, add the **AuthorizeAttribute** filter to the global filter list:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample2.cs)]

<span data-ttu-id="2e87e-164">**Controller**: Per limitare l'accesso per un controller specifico, aggiungere il filtro come attributo al controller:</span><span class="sxs-lookup"><span data-stu-id="2e87e-164">**Controller**: To restrict access for a specific controller, add the filter as an attribute to the controller:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample3.cs)]

<span data-ttu-id="2e87e-165">**Azione**: Per limitare l'accesso per azioni specifiche, aggiungere l'attributo al metodo di azione:</span><span class="sxs-lookup"><span data-stu-id="2e87e-165">**Action**: To restrict access for specific actions, add the attribute to the action method:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample4.cs)]

<span data-ttu-id="2e87e-166">In alternativa, è possibile limitare il controller e quindi `[AllowAnonymous]` consentire l'accesso anonimo ad azioni specifiche, utilizzando l'attributo .</span><span class="sxs-lookup"><span data-stu-id="2e87e-166">Alternatively, you can restrict the controller and then allow anonymous access to specific actions, by using the `[AllowAnonymous]` attribute.</span></span> <span data-ttu-id="2e87e-167">Nell'esempio seguente `Post` il metodo è `Get` limitato, ma il metodo consente l'accesso anonimo.</span><span class="sxs-lookup"><span data-stu-id="2e87e-167">In the following example, the `Post` method is restricted, but the `Get` method allows anonymous access.</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample5.cs)]

<span data-ttu-id="2e87e-168">Negli esempi precedenti, il filtro consente a qualsiasi utente autenticato di accedere ai metodi con restrizioni; vengono tenuti fuori solo gli utenti anonimi. È inoltre possibile limitare l'accesso a utenti specifici o a utenti in ruoli specifici:You can also limit access to specific users or to users in specific roles:</span><span class="sxs-lookup"><span data-stu-id="2e87e-168">In the previous examples, the filter allows any authenticated user to access the restricted methods; only anonymous users are kept out. You can also limit access to specific users or to users in specific roles:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample6.cs)]

> [!NOTE]
> <span data-ttu-id="2e87e-169">Il filtro **AuthorizeAttribute** per i controller API Web si trova nello spazio dei nomi **System.Web.Http.**</span><span class="sxs-lookup"><span data-stu-id="2e87e-169">The **AuthorizeAttribute** filter for Web API controllers is located in the **System.Web.Http** namespace.</span></span> <span data-ttu-id="2e87e-170">Esiste un filtro simile per i controller MVC nello spazio dei nomi **System.Web.Mvc,** che non è compatibile con i controller API Web.</span><span class="sxs-lookup"><span data-stu-id="2e87e-170">There is a similar filter for MVC controllers in the **System.Web.Mvc** namespace, which is not compatible with Web API controllers.</span></span>

### <a name="custom-authorization-filters"></a><span data-ttu-id="2e87e-171">Filtri di autorizzazione personalizzati</span><span class="sxs-lookup"><span data-stu-id="2e87e-171">Custom Authorization Filters</span></span>

<span data-ttu-id="2e87e-172">Per scrivere un filtro di autorizzazione personalizzato, derivare da uno di questi tipi:To write a custom authorization filter, derive from one of these types:</span><span class="sxs-lookup"><span data-stu-id="2e87e-172">To write a custom authorization filter, derive from one of these types:</span></span>

- <span data-ttu-id="2e87e-173">**AuthorizeAttribute**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-173">**AuthorizeAttribute**.</span></span> <span data-ttu-id="2e87e-174">Estendere questa classe per eseguire la logica di autorizzazione in base all'utente corrente e ai ruoli dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-174">Extend this class to perform authorization logic based on the current user and the user's roles.</span></span>
- <span data-ttu-id="2e87e-175">**AuthorizationFilterAttribute**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-175">**AuthorizationFilterAttribute**.</span></span> <span data-ttu-id="2e87e-176">Estendere questa classe per eseguire la logica di autorizzazione sincrona che non è necessariamente basata sull'utente o sul ruolo corrente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-176">Extend this class to perform synchronous authorization logic that is not necessarily based on the current user or role.</span></span>
- <span data-ttu-id="2e87e-177">**IAuthorizationFilter**.</span><span class="sxs-lookup"><span data-stu-id="2e87e-177">**IAuthorizationFilter**.</span></span> <span data-ttu-id="2e87e-178">Implementare questa interfaccia per eseguire la logica di autorizzazione asincrona; ad esempio, se la logica di autorizzazione effettua chiamate di I/O o di rete asincrone.</span><span class="sxs-lookup"><span data-stu-id="2e87e-178">Implement this interface to perform asynchronous authorization logic; for example, if your authorization logic makes asynchronous I/O or network calls.</span></span> <span data-ttu-id="2e87e-179">Se la logica di autorizzazione è associata alla CPU, è più semplice derivare da **AuthorizationFilterAttribute**, poiché non è necessario scrivere un metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="2e87e-179">(If your authorization logic is CPU-bound, it is simpler to derive from **AuthorizationFilterAttribute**, because then you don't need to write an asynchronous method.)</span></span>

<span data-ttu-id="2e87e-180">Nel diagramma seguente viene illustrata la gerarchia di classi per la classe **AuthorizeAttribute.The** following diagram shows the class hierarchy for the AuthorizeAttribute class.</span><span class="sxs-lookup"><span data-stu-id="2e87e-180">The following diagram shows the class hierarchy for the **AuthorizeAttribute** class.</span></span>

![](authentication-and-authorization-in-aspnet-web-api/_static/image2.png)

### <a name="authorization-inside-a-controller-action"></a><span data-ttu-id="2e87e-181">Autorizzazione all'interno di un'azione del controllerAuthorization Inside a Controller Action</span><span class="sxs-lookup"><span data-stu-id="2e87e-181">Authorization Inside a Controller Action</span></span>

<span data-ttu-id="2e87e-182">In alcuni casi, è possibile consentire una richiesta di procedere, ma modificare il comportamento in base all'entità.</span><span class="sxs-lookup"><span data-stu-id="2e87e-182">In some cases, you might allow a request to proceed, but change the behavior based on the principal.</span></span> <span data-ttu-id="2e87e-183">Ad esempio, le informazioni restituite potrebbero cambiare a seconda del ruolo dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2e87e-183">For example, the information that you return might change depending on the user's role.</span></span> <span data-ttu-id="2e87e-184">All'interno di un metodo del controller, è possibile ottenere l'entità corrente dal **ApiController.User** proprietà.</span><span class="sxs-lookup"><span data-stu-id="2e87e-184">Within a controller method, you can get the current principal from the **ApiController.User** property.</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample7.cs)]
