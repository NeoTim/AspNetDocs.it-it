---
uid: web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
title: Uso di CascadingDropDown con un Database (c#) | Microsoft Docs
author: wenz
description: Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList carichi associati i valori in anoth...
ms.author: riande
ms.date: 06/02/2008
ms.assetid: 684f0c28-a490-4e5b-b5e5-5dfb77464b49
msc.legacyurl: /web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
msc.type: authoredcontent
ms.openlocfilehash: 706a099042a298f8870f36cb653f1e5d5d156f2a
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65125171"
---
# <a name="using-cascadingdropdown-with-a-database-c"></a><span data-ttu-id="9134a-103">Uso di CascadingDropDown con un database (C#)</span><span class="sxs-lookup"><span data-stu-id="9134a-103">Using CascadingDropDown with a Database (C#)</span></span>

<span data-ttu-id="9134a-104">da [Christian Wenz](https://github.com/wenz)</span><span class="sxs-lookup"><span data-stu-id="9134a-104">by [Christian Wenz](https://github.com/wenz)</span></span>

<span data-ttu-id="9134a-105">[Scaricare il codice](http://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) o [Scarica il PDF](http://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="9134a-105">[Download Code](http://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) or [Download PDF](http://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span></span>

> <span data-ttu-id="9134a-106">Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList Carica valori in un altro controllo DropDownList associati.</span><span class="sxs-lookup"><span data-stu-id="9134a-106">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="9134a-107">Affinché il corretto funzionamento, è necessario creare un servizio web speciale.</span><span class="sxs-lookup"><span data-stu-id="9134a-107">In order for this to work, a special web service must be created.</span></span>

## <a name="overview"></a><span data-ttu-id="9134a-108">Panoramica</span><span class="sxs-lookup"><span data-stu-id="9134a-108">Overview</span></span>

<span data-ttu-id="9134a-109">Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList Carica valori in un altro controllo DropDownList associati.</span><span class="sxs-lookup"><span data-stu-id="9134a-109">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="9134a-110">(Ad esempio, un unico elenco fornisce un elenco di stati degli Stati Uniti e il successivo elenco viene riempito con città più importanti di tale stato.) Affinché il corretto funzionamento, è necessario creare un servizio web speciale.</span><span class="sxs-lookup"><span data-stu-id="9134a-110">(For instance, one list provides a list of US states, and the next list is then filled with major cities in that state.) In order for this to work, a special web service must be created.</span></span>

## <a name="steps"></a><span data-ttu-id="9134a-111">Passaggi</span><span class="sxs-lookup"><span data-stu-id="9134a-111">Steps</span></span>

<span data-ttu-id="9134a-112">Prima di tutto, è richiesta un'origine dati.</span><span class="sxs-lookup"><span data-stu-id="9134a-112">First of all, a data source is required.</span></span> <span data-ttu-id="9134a-113">Questo esempio Usa il database AdventureWorks e Microsoft SQL Server 2005 Express Edition.</span><span class="sxs-lookup"><span data-stu-id="9134a-113">This sample uses the AdventureWorks database and the Microsoft SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="9134a-114">Il database è una parte facoltativa di un'installazione di Visual Studio (inclusa l'edizione express) ed è anche disponibile come download separato in [ https://go.microsoft.com/fwlink/?LinkId=64064 ](https://go.microsoft.com/fwlink/?LinkId=64064).</span><span class="sxs-lookup"><span data-stu-id="9134a-114">The database is an optional part of a Visual Studio installation (including express edition) and is also available as a separate download under [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span></span> <span data-ttu-id="9134a-115">Il database AdventureWorks è parte di SQL Server 2005 Samples and Sample Databases (download all'indirizzo [ https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp; DisplayLang = en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span><span class="sxs-lookup"><span data-stu-id="9134a-115">The AdventureWorks database is part of the SQL Server 2005 Samples and Sample Databases (download at [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span></span> <span data-ttu-id="9134a-116">Il modo più semplice per configurare il database è di utilizzare Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp; DisplayLang = en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) e collegare il `AdventureWorks.mdf` file di database.</span><span class="sxs-lookup"><span data-stu-id="9134a-116">The easiest way to set the database up is to use the Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) and attach the `AdventureWorks.mdf` database file.</span></span>

<span data-ttu-id="9134a-117">In questo esempio, si presuppone che l'istanza di SQL Server 2005 Express Edition è chiamato `SQLEXPRESS` e si trova nello stesso computer come server web; questo è anche l'impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="9134a-117">For this sample, we assume that the instance of the SQL Server 2005 Express Edition is called `SQLEXPRESS` and resides on the same machine as the web server; this is also the default setup.</span></span> <span data-ttu-id="9134a-118">Se il programma di installazione diverso, è necessario adattare le informazioni di connessione per il database.</span><span class="sxs-lookup"><span data-stu-id="9134a-118">If your setup differs, you have to adapt the connection information for the database.</span></span>

<span data-ttu-id="9134a-119">Per attivare la funzionalità di ASP.NET AJAX e il Toolkit di controllo, il `ScriptManager` controllo deve essere inserito in un punto qualsiasi della pagina (ma entro la &lt; `form` &gt; elemento):</span><span class="sxs-lookup"><span data-stu-id="9134a-119">In order to activate the functionality of ASP.NET AJAX and the Control Toolkit, the `ScriptManager` control must be put anywhere on the page (but within the &lt;`form`&gt; element):</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample1.aspx)]

<span data-ttu-id="9134a-120">Nel passaggio successivo, sono necessari due controlli DropDownList.</span><span class="sxs-lookup"><span data-stu-id="9134a-120">In the next step, two DropDownList controls are required.</span></span> <span data-ttu-id="9134a-121">In questo esempio, utilizziamo il fornitore e informazioni di contatto da AdventureWorks, pertanto creiamo un unico elenco per i fornitori disponibili e uno per i contatti disponibili:</span><span class="sxs-lookup"><span data-stu-id="9134a-121">In this sample, we use the vendor and contact information from AdventureWorks, thus we create one list for the available vendors and one for the available contacts:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample2.aspx)]

<span data-ttu-id="9134a-122">Quindi, è necessario aggiungere due dispositivi Extender CascadingDropDown alla pagina.</span><span class="sxs-lookup"><span data-stu-id="9134a-122">Then, two CascadingDropDown extenders must be added to the page.</span></span> <span data-ttu-id="9134a-123">Uno compilato automaticamente nel primo elenco (fornitori), e un' nel secondo elenco (contatti).</span><span class="sxs-lookup"><span data-stu-id="9134a-123">One fills the first (vendors) list, and the other one fills the second (contacts) list.</span></span> <span data-ttu-id="9134a-124">È necessario impostare gli attributi seguenti:</span><span class="sxs-lookup"><span data-stu-id="9134a-124">The following attributes must be set:</span></span>

- <span data-ttu-id="9134a-125">`ServicePath`: URL di un servizio web distribuisce le voci dell'elenco</span><span class="sxs-lookup"><span data-stu-id="9134a-125">`ServicePath`: URL of a web service delivering the list entries</span></span>
- <span data-ttu-id="9134a-126">`ServiceMethod`: Metodo Web le voci dell'elenco di distribuzione</span><span class="sxs-lookup"><span data-stu-id="9134a-126">`ServiceMethod`: Web method delivering the list entries</span></span>
- <span data-ttu-id="9134a-127">`TargetControlID`: ID dell'elenco a discesa</span><span class="sxs-lookup"><span data-stu-id="9134a-127">`TargetControlID`: ID of the dropdown list</span></span>
- <span data-ttu-id="9134a-128">`Category`: Informazioni sulle categorie in cui viene inviati al metodo web quando viene chiamato</span><span class="sxs-lookup"><span data-stu-id="9134a-128">`Category`: Category information that is submitted to the web method when called</span></span>
- <span data-ttu-id="9134a-129">`PromptText`: Testo visualizzato quando si caricano in modo asincrono i dati dell'elenco dal server</span><span class="sxs-lookup"><span data-stu-id="9134a-129">`PromptText`: Text displayed when asynchronously loading list data from the server</span></span>
- <span data-ttu-id="9134a-130">`ParentControlID`: (facoltativo) che il caricamento di trigger dell'elenco corrente nell'elenco a discesa padre</span><span class="sxs-lookup"><span data-stu-id="9134a-130">`ParentControlID`: (optional) parent dropdown list that triggers loading of the current list</span></span>

<span data-ttu-id="9134a-131">A seconda del linguaggio di programmazione utilizzato, il nome del servizio web in questione viene modificato, ma tutti gli altri valori di attributo sono lo stesso.</span><span class="sxs-lookup"><span data-stu-id="9134a-131">Depending on the programming language used, the name of the web service in question changes, but all other attribute values are the same.</span></span> <span data-ttu-id="9134a-132">Ecco l'elemento CascadingDropDown per il primo elenco a discesa:</span><span class="sxs-lookup"><span data-stu-id="9134a-132">Here is the CascadingDropDown element for the first dropdown list:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample3.aspx)]

<span data-ttu-id="9134a-133">È necessario impostare i controlli Extender per l'elenco secondo il `ParentControlID` attributo in modo che se si seleziona una voce nei trigger elenco fornitori caricamento associati elementi nell'elenco di contatti.</span><span class="sxs-lookup"><span data-stu-id="9134a-133">The control extenders for the second list need to set the `ParentControlID` attribute so that selecting an entry in the vendors list triggers loading associated elements in the contacts list.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample4.aspx)]

<span data-ttu-id="9134a-134">Le operazioni effettive vengono quindi eseguite nel servizio web, che è configurato come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="9134a-134">The actual work is then done in the web service, which is set up as follows.</span></span> <span data-ttu-id="9134a-135">Si noti che il `[ScriptService]` attributo viene utilizzato, in caso contrario, ASP.NET AJAX non è possibile creare il proxy di JavaScript per accedere ai metodi web dal codice di script lato client.</span><span class="sxs-lookup"><span data-stu-id="9134a-135">Note that the `[ScriptService]` attribute is used, otherwise ASP.NET AJAX cannot create the JavaScript proxy to access the web methods from client-side script code.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample5.aspx)]

<span data-ttu-id="9134a-136">La firma dei metodi web chiamato da CascadingDropDown è come segue:</span><span class="sxs-lookup"><span data-stu-id="9134a-136">The signature of the web methods called by CascadingDropDown is as follows:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample6.cs)]

<span data-ttu-id="9134a-137">In modo che il valore restituito deve essere una matrice di tipo `CascadingDropDownNameValue` definito dal Toolkit di controllo.</span><span class="sxs-lookup"><span data-stu-id="9134a-137">So the return value must be an array of type `CascadingDropDownNameValue` which is defined by the Control Toolkit.</span></span> <span data-ttu-id="9134a-138">Il `GetVendors()` metodo è piuttosto semplice da implementare: Il codice si connette al database AdventureWorks e i primi 25 fornitori una query.</span><span class="sxs-lookup"><span data-stu-id="9134a-138">The `GetVendors()` method is quite easy to implement: The code connects to the AdventureWorks database and queries the first 25 vendors.</span></span> <span data-ttu-id="9134a-139">Il primo parametro nel `CascadingDropDownNameValue` costruttore è la didascalia della voce di elenco, il secondo il relativo valore (attributo value del linguaggio HTML &lt; `option` &gt; elemento).</span><span class="sxs-lookup"><span data-stu-id="9134a-139">The first parameter in the `CascadingDropDownNameValue` constructor is the caption of the list entry, the second one its value (value attribute in HTML's &lt;`option`&gt; element).</span></span> <span data-ttu-id="9134a-140">Ecco il codice:</span><span class="sxs-lookup"><span data-stu-id="9134a-140">Here is the code:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample7.cs)]

<span data-ttu-id="9134a-141">Come ottenere i contatti associati per un fornitore (nome del metodo: `GetContactsForVendor()`) è un po' più complicato.</span><span class="sxs-lookup"><span data-stu-id="9134a-141">Getting the associated contacts for a vendor (method name: `GetContactsForVendor()`) is a bit trickier.</span></span> <span data-ttu-id="9134a-142">Prima di tutto, è necessario determinare il fornitore che è stato selezionato nel primo elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="9134a-142">First of all, the vendor which has been selected in the first dropdown list must be determined.</span></span> <span data-ttu-id="9134a-143">Il Toolkit di controllo definisce un metodo di supporto per tale attività: Il `ParseKnownCategoryValuesString()` metodo restituisce un `StringDictionary` elemento con i dati di elenco a discesa:</span><span class="sxs-lookup"><span data-stu-id="9134a-143">The Control Toolkit defines a helper method for that task: The `ParseKnownCategoryValuesString()` method returns a `StringDictionary` element with the dropdown data:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample8.cs)]

<span data-ttu-id="9134a-144">Per motivi di sicurezza, questi dati devono essere convalidati prima di tutto.</span><span class="sxs-lookup"><span data-stu-id="9134a-144">For security reasons, this data must be validated first.</span></span> <span data-ttu-id="9134a-145">Pertanto, se è presente una voce del fornitore (perché il `Category` del primo elemento CascadingDropDown è impostata su `"Vendor"`), può essere recuperato l'ID del fornitore selezionato:</span><span class="sxs-lookup"><span data-stu-id="9134a-145">So if there is a Vendor entry (because the `Category` property of the first CascadingDropDown element is set to `"Vendor"`), the ID of the selected vendor may be retrieved:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample9.cs)]

<span data-ttu-id="9134a-146">Il resto del metodo è piuttosto semplice, quindi.</span><span class="sxs-lookup"><span data-stu-id="9134a-146">The rest of the method is fairly straight-forward, then.</span></span> <span data-ttu-id="9134a-147">ID del fornitore viene utilizzato come parametro per una query SQL che recupera tutti i contatti associati per fornitore.</span><span class="sxs-lookup"><span data-stu-id="9134a-147">The vendor's ID is used as a parameter for an SQL query that retrieves all associated contacts for that vendor.</span></span> <span data-ttu-id="9134a-148">Ancora una volta, il metodo restituisce una matrice di tipo `CascadingDropDownNameValue`.</span><span class="sxs-lookup"><span data-stu-id="9134a-148">Once again, the method returns an array of type `CascadingDropDownNameValue`.</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample10.cs)]

<span data-ttu-id="9134a-149">Caricare la pagina ASP.NET e dopo un breve periodo di tempo viene inserito nell'elenco di fornitori con le voci di 25.</span><span class="sxs-lookup"><span data-stu-id="9134a-149">Load the ASP.NET page, and after a short while the vendor list is filled with 25 entries.</span></span> <span data-ttu-id="9134a-150">Selezionare una voce e notare come il secondo elenco a discesa viene riempita con i dati.</span><span class="sxs-lookup"><span data-stu-id="9134a-150">Pick one entry and notice how the second dropdown list is filled with data.</span></span>

<span data-ttu-id="9134a-151">[![Nel primo elenco viene compilato automaticamente](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9134a-151">[![The first list is filled automatically](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span></span>

<span data-ttu-id="9134a-152">Nel primo elenco viene compilato automaticamente ([fare clic per visualizzare l'immagine con dimensioni normali](using-cascadingdropdown-with-a-database-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9134a-152">The first list is filled automatically ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image3.png))</span></span>

<span data-ttu-id="9134a-153">[![Nel secondo elenco viene compilato in base della selezione nel primo elenco](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9134a-153">[![The second list is filled according to the selection in the first list](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span></span>

<span data-ttu-id="9134a-154">Nel secondo elenco viene compilato in base della selezione nel primo elenco ([fare clic per visualizzare l'immagine con dimensioni normali](using-cascadingdropdown-with-a-database-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9134a-154">The second list is filled according to the selection in the first list ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image6.png))</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9134a-155">[Precedente](filling-a-list-using-cascadingdropdown-cs.md)
> [Successivo](presetting-list-entries-with-cascadingdropdown-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9134a-155">[Previous](filling-a-list-using-cascadingdropdown-cs.md)
[Next](presetting-list-entries-with-cascadingdropdown-cs.md)</span></span>
