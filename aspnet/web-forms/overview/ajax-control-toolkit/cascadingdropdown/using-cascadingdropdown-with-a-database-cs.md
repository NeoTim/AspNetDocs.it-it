---
uid: web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
title: Uso di CascadingDropDown con un databaseC#() | Microsoft Docs
author: wenz
description: Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList carichino i valori associati in un altr...
ms.author: riande
ms.date: 06/02/2008
ms.assetid: 684f0c28-a490-4e5b-b5e5-5dfb77464b49
msc.legacyurl: /web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
msc.type: authoredcontent
ms.openlocfilehash: bcf453170d17807b4e3b2d2a8b545cba43139f89
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74599816"
---
# <a name="using-cascadingdropdown-with-a-database-c"></a><span data-ttu-id="cec38-103">Uso di CascadingDropDown con un database (C#)</span><span class="sxs-lookup"><span data-stu-id="cec38-103">Using CascadingDropDown with a Database (C#)</span></span>

<span data-ttu-id="cec38-104">di [Christian Wenz](https://github.com/wenz)</span><span class="sxs-lookup"><span data-stu-id="cec38-104">by [Christian Wenz](https://github.com/wenz)</span></span>

<span data-ttu-id="cec38-105">[Scarica codice](https://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) o [Scarica PDF](https://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="cec38-105">[Download Code](https://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) or [Download PDF](https://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span></span>

> <span data-ttu-id="cec38-106">Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList carichino i valori associati in un altro DropDownList.</span><span class="sxs-lookup"><span data-stu-id="cec38-106">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="cec38-107">Per consentire il funzionamento di questo, è necessario creare un servizio Web speciale.</span><span class="sxs-lookup"><span data-stu-id="cec38-107">In order for this to work, a special web service must be created.</span></span>

## <a name="overview"></a><span data-ttu-id="cec38-108">Panoramica di</span><span class="sxs-lookup"><span data-stu-id="cec38-108">Overview</span></span>

<span data-ttu-id="cec38-109">Il controllo CascadingDropDown in AJAX Control Toolkit estende un controllo DropDownList in modo che le modifiche in un controllo DropDownList carichino i valori associati in un altro DropDownList.</span><span class="sxs-lookup"><span data-stu-id="cec38-109">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="cec38-110">Ad esempio, un elenco include un elenco di stati degli Stati Uniti e l'elenco successivo viene quindi riempito con le città principali in tale stato. Per consentire il funzionamento di questo, è necessario creare un servizio Web speciale.</span><span class="sxs-lookup"><span data-stu-id="cec38-110">(For instance, one list provides a list of US states, and the next list is then filled with major cities in that state.) In order for this to work, a special web service must be created.</span></span>

## <a name="steps"></a><span data-ttu-id="cec38-111">Passaggi</span><span class="sxs-lookup"><span data-stu-id="cec38-111">Steps</span></span>

<span data-ttu-id="cec38-112">Prima di tutto, è necessaria un'origine dati.</span><span class="sxs-lookup"><span data-stu-id="cec38-112">First of all, a data source is required.</span></span> <span data-ttu-id="cec38-113">In questo esempio vengono utilizzati il database AdventureWorks e il Microsoft SQL Server 2005 Express Edition.</span><span class="sxs-lookup"><span data-stu-id="cec38-113">This sample uses the AdventureWorks database and the Microsoft SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="cec38-114">Il database è una parte facoltativa di un'installazione di Visual Studio (inclusa l'edizione Express) ed è disponibile anche come download separato in [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span><span class="sxs-lookup"><span data-stu-id="cec38-114">The database is an optional part of a Visual Studio installation (including express edition) and is also available as a separate download under [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span></span> <span data-ttu-id="cec38-115">Il database AdventureWorks fa parte degli esempi SQL Server 2005 e dei database di esempio (scaricare [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;D isplaylang = en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span><span class="sxs-lookup"><span data-stu-id="cec38-115">The AdventureWorks database is part of the SQL Server 2005 Samples and Sample Databases (download at [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span></span> <span data-ttu-id="cec38-116">Il modo più semplice per impostare il database consiste nell'usare il Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;D isplaylang = en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) e alleghi il file di database `AdventureWorks.mdf`.</span><span class="sxs-lookup"><span data-stu-id="cec38-116">The easiest way to set the database up is to use the Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) and attach the `AdventureWorks.mdf` database file.</span></span>

<span data-ttu-id="cec38-117">Per questo esempio si presuppone che l'istanza del SQL Server 2005 Express Edition venga chiamata `SQLEXPRESS` e che risiede nello stesso computer del server Web. si tratta anche della configurazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="cec38-117">For this sample, we assume that the instance of the SQL Server 2005 Express Edition is called `SQLEXPRESS` and resides on the same machine as the web server; this is also the default setup.</span></span> <span data-ttu-id="cec38-118">Se la configurazione è diversa, è necessario adattare le informazioni di connessione per il database.</span><span class="sxs-lookup"><span data-stu-id="cec38-118">If your setup differs, you have to adapt the connection information for the database.</span></span>

<span data-ttu-id="cec38-119">Per attivare la funzionalità di ASP.NET AJAX e di Control Toolkit, il controllo `ScriptManager` deve essere inserito in un punto qualsiasi della pagina, ma all'interno dell'elemento &lt;`form`&gt;:</span><span class="sxs-lookup"><span data-stu-id="cec38-119">In order to activate the functionality of ASP.NET AJAX and the Control Toolkit, the `ScriptManager` control must be put anywhere on the page (but within the &lt;`form`&gt; element):</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample1.aspx)]

<span data-ttu-id="cec38-120">Nel passaggio successivo sono necessari due controlli DropDownList.</span><span class="sxs-lookup"><span data-stu-id="cec38-120">In the next step, two DropDownList controls are required.</span></span> <span data-ttu-id="cec38-121">In questo esempio vengono usate le informazioni relative al fornitore e al contatto da AdventureWorks, quindi viene creato un elenco per i fornitori disponibili e uno per i contatti disponibili:</span><span class="sxs-lookup"><span data-stu-id="cec38-121">In this sample, we use the vendor and contact information from AdventureWorks, thus we create one list for the available vendors and one for the available contacts:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample2.aspx)]

<span data-ttu-id="cec38-122">Quindi, è necessario aggiungere due Extender CascadingDropDown alla pagina.</span><span class="sxs-lookup"><span data-stu-id="cec38-122">Then, two CascadingDropDown extenders must be added to the page.</span></span> <span data-ttu-id="cec38-123">Una riempie il primo elenco (fornitori) e l'altra riempie il secondo elenco (contatti).</span><span class="sxs-lookup"><span data-stu-id="cec38-123">One fills the first (vendors) list, and the other one fills the second (contacts) list.</span></span> <span data-ttu-id="cec38-124">È necessario impostare i seguenti attributi:</span><span class="sxs-lookup"><span data-stu-id="cec38-124">The following attributes must be set:</span></span>

- <span data-ttu-id="cec38-125">`ServicePath`: URL di un servizio Web che fornisce le voci dell'elenco</span><span class="sxs-lookup"><span data-stu-id="cec38-125">`ServicePath`: URL of a web service delivering the list entries</span></span>
- <span data-ttu-id="cec38-126">`ServiceMethod`: metodo Web che fornisce le voci dell'elenco</span><span class="sxs-lookup"><span data-stu-id="cec38-126">`ServiceMethod`: Web method delivering the list entries</span></span>
- <span data-ttu-id="cec38-127">`TargetControlID`: ID dell'elenco a discesa</span><span class="sxs-lookup"><span data-stu-id="cec38-127">`TargetControlID`: ID of the dropdown list</span></span>
- <span data-ttu-id="cec38-128">`Category`: informazioni sulla categoria inviate al metodo Web quando viene chiamata</span><span class="sxs-lookup"><span data-stu-id="cec38-128">`Category`: Category information that is submitted to the web method when called</span></span>
- <span data-ttu-id="cec38-129">`PromptText`: testo visualizzato quando si caricano in modo asincrono i dati dell'elenco dal server</span><span class="sxs-lookup"><span data-stu-id="cec38-129">`PromptText`: Text displayed when asynchronously loading list data from the server</span></span>
- <span data-ttu-id="cec38-130">`ParentControlID`: (facoltativo) elenco a discesa padre che attiva il caricamento dell'elenco corrente</span><span class="sxs-lookup"><span data-stu-id="cec38-130">`ParentControlID`: (optional) parent dropdown list that triggers loading of the current list</span></span>

<span data-ttu-id="cec38-131">A seconda del linguaggio di programmazione utilizzato, il nome del servizio Web in questione cambia, ma tutti gli altri valori di attributo sono gli stessi.</span><span class="sxs-lookup"><span data-stu-id="cec38-131">Depending on the programming language used, the name of the web service in question changes, but all other attribute values are the same.</span></span> <span data-ttu-id="cec38-132">Ecco l'elemento CascadingDropDown per il primo elenco a discesa:</span><span class="sxs-lookup"><span data-stu-id="cec38-132">Here is the CascadingDropDown element for the first dropdown list:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample3.aspx)]

<span data-ttu-id="cec38-133">Gli Extender del controllo per il secondo elenco devono impostare l'attributo `ParentControlID` in modo che la selezione di una voce nell'elenco dei fornitori attivi il caricamento degli elementi associati nell'elenco contatti.</span><span class="sxs-lookup"><span data-stu-id="cec38-133">The control extenders for the second list need to set the `ParentControlID` attribute so that selecting an entry in the vendors list triggers loading associated elements in the contacts list.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample4.aspx)]

<span data-ttu-id="cec38-134">Il lavoro effettivo viene quindi eseguito nel servizio Web, configurato come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="cec38-134">The actual work is then done in the web service, which is set up as follows.</span></span> <span data-ttu-id="cec38-135">Si noti che viene usato l'attributo `[ScriptService]`, in caso contrario ASP.NET AJAX non è in grado di creare il proxy JavaScript per accedere ai metodi Web dal codice di script sul lato client.</span><span class="sxs-lookup"><span data-stu-id="cec38-135">Note that the `[ScriptService]` attribute is used, otherwise ASP.NET AJAX cannot create the JavaScript proxy to access the web methods from client-side script code.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample5.aspx)]

<span data-ttu-id="cec38-136">La firma dei metodi Web chiamati da CascadingDropDown è la seguente:</span><span class="sxs-lookup"><span data-stu-id="cec38-136">The signature of the web methods called by CascadingDropDown is as follows:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample6.cs)]

<span data-ttu-id="cec38-137">Il valore restituito deve quindi essere una matrice di tipo `CascadingDropDownNameValue` definita da Control Toolkit.</span><span class="sxs-lookup"><span data-stu-id="cec38-137">So the return value must be an array of type `CascadingDropDownNameValue` which is defined by the Control Toolkit.</span></span> <span data-ttu-id="cec38-138">Il metodo `GetVendors()` è piuttosto semplice da implementare: il codice si connette al database AdventureWorks ed esegue una query sui primi 25 fornitori.</span><span class="sxs-lookup"><span data-stu-id="cec38-138">The `GetVendors()` method is quite easy to implement: The code connects to the AdventureWorks database and queries the first 25 vendors.</span></span> <span data-ttu-id="cec38-139">Il primo parametro nel costruttore `CascadingDropDownNameValue` è la didascalia della voce dell'elenco, il secondo valore (attributo value nell'elemento &lt;`option`&gt; di HTML).</span><span class="sxs-lookup"><span data-stu-id="cec38-139">The first parameter in the `CascadingDropDownNameValue` constructor is the caption of the list entry, the second one its value (value attribute in HTML's &lt;`option`&gt; element).</span></span> <span data-ttu-id="cec38-140">Ecco il codice:</span><span class="sxs-lookup"><span data-stu-id="cec38-140">Here is the code:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample7.cs)]

<span data-ttu-id="cec38-141">Il recupero dei contatti associati per un fornitore (nome metodo: `GetContactsForVendor()`) è un po' più complicato.</span><span class="sxs-lookup"><span data-stu-id="cec38-141">Getting the associated contacts for a vendor (method name: `GetContactsForVendor()`) is a bit trickier.</span></span> <span data-ttu-id="cec38-142">Prima di tutto, è necessario determinare il fornitore selezionato nel primo elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="cec38-142">First of all, the vendor which has been selected in the first dropdown list must be determined.</span></span> <span data-ttu-id="cec38-143">Il Toolkit di controllo definisce un metodo helper per l'attività: il metodo `ParseKnownCategoryValuesString()` restituisce un elemento `StringDictionary` con i dati dell'elenco a discesa:</span><span class="sxs-lookup"><span data-stu-id="cec38-143">The Control Toolkit defines a helper method for that task: The `ParseKnownCategoryValuesString()` method returns a `StringDictionary` element with the dropdown data:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample8.cs)]

<span data-ttu-id="cec38-144">Per motivi di sicurezza, questi dati devono essere convalidati per primi.</span><span class="sxs-lookup"><span data-stu-id="cec38-144">For security reasons, this data must be validated first.</span></span> <span data-ttu-id="cec38-145">Quindi, se è presente una voce del fornitore, perché la proprietà `Category` del primo elemento CascadingDropDown è impostata su `"Vendor"`), è possibile che venga recuperato l'ID del fornitore selezionato:</span><span class="sxs-lookup"><span data-stu-id="cec38-145">So if there is a Vendor entry (because the `Category` property of the first CascadingDropDown element is set to `"Vendor"`), the ID of the selected vendor may be retrieved:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample9.cs)]

<span data-ttu-id="cec38-146">Il resto del metodo è piuttosto semplice, quindi.</span><span class="sxs-lookup"><span data-stu-id="cec38-146">The rest of the method is fairly straight-forward, then.</span></span> <span data-ttu-id="cec38-147">L'ID del fornitore viene utilizzato come parametro per una query SQL che recupera tutti i contatti associati per tale fornitore.</span><span class="sxs-lookup"><span data-stu-id="cec38-147">The vendor's ID is used as a parameter for an SQL query that retrieves all associated contacts for that vendor.</span></span> <span data-ttu-id="cec38-148">Ancora una volta, il metodo restituisce una matrice di tipo `CascadingDropDownNameValue`.</span><span class="sxs-lookup"><span data-stu-id="cec38-148">Once again, the method returns an array of type `CascadingDropDownNameValue`.</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample10.cs)]

<span data-ttu-id="cec38-149">Caricare la pagina ASP.NET e, dopo un breve periodo di tempo, l'elenco dei fornitori viene riempito con 25 voci.</span><span class="sxs-lookup"><span data-stu-id="cec38-149">Load the ASP.NET page, and after a short while the vendor list is filled with 25 entries.</span></span> <span data-ttu-id="cec38-150">Selezionare una voce e notare il modo in cui il secondo elenco a discesa viene riempito con i dati.</span><span class="sxs-lookup"><span data-stu-id="cec38-150">Pick one entry and notice how the second dropdown list is filled with data.</span></span>

<span data-ttu-id="cec38-151">[![il primo elenco viene compilato automaticamente](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="cec38-151">[![The first list is filled automatically](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span></span>

<span data-ttu-id="cec38-152">Il primo elenco viene compilato automaticamente ([fare clic per visualizzare l'immagine con dimensioni complete](using-cascadingdropdown-with-a-database-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="cec38-152">The first list is filled automatically ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image3.png))</span></span>

<span data-ttu-id="cec38-153">[![il secondo elenco viene compilato in base alla selezione nel primo elenco](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="cec38-153">[![The second list is filled according to the selection in the first list](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span></span>

<span data-ttu-id="cec38-154">Il secondo elenco viene compilato in base alla selezione nel primo elenco ([fare clic per visualizzare l'immagine con dimensioni complete](using-cascadingdropdown-with-a-database-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="cec38-154">The second list is filled according to the selection in the first list ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image6.png))</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cec38-155">[Precedente](filling-a-list-using-cascadingdropdown-cs.md)
> [Successivo](presetting-list-entries-with-cascadingdropdown-cs.md)</span><span class="sxs-lookup"><span data-stu-id="cec38-155">[Previous](filling-a-list-using-cascadingdropdown-cs.md)
[Next](presetting-list-entries-with-cascadingdropdown-cs.md)</span></span>
