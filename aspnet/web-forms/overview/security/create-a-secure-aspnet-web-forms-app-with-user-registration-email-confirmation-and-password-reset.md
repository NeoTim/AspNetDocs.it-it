---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Creare un'app Web Form ASP.NET sicura con registrazione utente, conferma tramite posta elettronica e reimpostazione della password (C#) | Microsoft Docs
author: Erikre
description: Questa esercitazione illustra come creare un'app Web Form ASP.NET con la registrazione dell'utente, la conferma tramite posta elettronica e la reimpostazione della password usando il membro ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78625153"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="1d998-103">Creare un'app Web Forms ASP.NET sicura con registrazione utente, messaggi di posta elettronica di conferma e reimpostazione della password (C#)</span><span class="sxs-lookup"><span data-stu-id="1d998-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="1d998-104">di [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="1d998-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="1d998-105">Questa esercitazione illustra come creare un'app Web Form ASP.NET con la registrazione dell'utente, la conferma tramite posta elettronica e la reimpostazione della password usando il sistema di appartenenze ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="1d998-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="1d998-106">Questa esercitazione è basata sull' [esercitazione su MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)di Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="1d998-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="1d998-107">Introduzione</span><span class="sxs-lookup"><span data-stu-id="1d998-107">Introduction</span></span>

<span data-ttu-id="1d998-108">Questa esercitazione illustra i passaggi necessari per creare un'applicazione Web Form ASP.NET con Visual Studio e ASP.NET 4,5 per creare un'app Web form sicura con registrazione utente, conferma tramite posta elettronica e reimpostazione della password.</span><span class="sxs-lookup"><span data-stu-id="1d998-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="1d998-109">Attività e informazioni dell'esercitazione:</span><span class="sxs-lookup"><span data-stu-id="1d998-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="1d998-110">Creare un'app Web Form ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1d998-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="1d998-111">Associare SendGrid</span><span class="sxs-lookup"><span data-stu-id="1d998-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="1d998-112">Richiedi conferma posta elettronica prima dell'accesso</span><span class="sxs-lookup"><span data-stu-id="1d998-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="1d998-113">Ripristino e reimpostazione della password</span><span class="sxs-lookup"><span data-stu-id="1d998-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="1d998-114">Invia nuovamente il collegamento di conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="1d998-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="1d998-115">Risoluzione dei problemi dell'app</span><span class="sxs-lookup"><span data-stu-id="1d998-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="1d998-116">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="1d998-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="1d998-117">Creare un'app Web Form ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1d998-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="1d998-118">Per iniziare, installare ed eseguire [Visual Studio Express 2013 per il Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="1d998-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="1d998-119">Installare anche [Visual Studio 2013 aggiornamento 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="1d998-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="1d998-120">Avviso: per completare questa esercitazione, è necessario installare [Visual Studio 2013 aggiornamento 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="1d998-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="1d998-121">Creare un nuovo progetto (**File** -&gt; **nuovo progetto**) e selezionare il modello **applicazione Web ASP.NET** e la versione più recente del .NET Framework dalla finestra di dialogo **nuovo progetto** .</span><span class="sxs-lookup"><span data-stu-id="1d998-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="1d998-122">Nella finestra di dialogo **nuovo progetto ASP.NET** selezionare il modello **Web Form** .</span><span class="sxs-lookup"><span data-stu-id="1d998-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="1d998-123">Lasciare l'autenticazione predefinita come **account utente singoli**.</span><span class="sxs-lookup"><span data-stu-id="1d998-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="1d998-124">Se si vuole ospitare l'app in Azure, lasciare selezionata la casella **di controllo host nel cloud** .</span><span class="sxs-lookup"><span data-stu-id="1d998-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="1d998-125">Quindi, fare clic su **OK** per creare il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="1d998-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="1d998-126">![Finestra di dialogo Nuovo progetto ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1d998-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="1d998-127">Abilitare Secure Sockets Layer (SSL) per il progetto.</span><span class="sxs-lookup"><span data-stu-id="1d998-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="1d998-128">Attenersi alla procedura disponibile nella sezione **abilitare SSL per il progetto** della serie di [esercitazioni introduzione con Web Form](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="1d998-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="1d998-129">Eseguire l'app, fare clic sul collegamento **Register** e registrare un nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="1d998-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="1d998-130">A questo punto, l'unica convalida sul messaggio di posta elettronica è basata sull'attributo [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) per assicurarsi che l'indirizzo di posta elettronica sia ben formato.</span><span class="sxs-lookup"><span data-stu-id="1d998-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="1d998-131">Il codice viene modificato per aggiungere la conferma tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="1d998-132">Chiudere la finestra del browser.</span><span class="sxs-lookup"><span data-stu-id="1d998-132">Close the browser window.</span></span>
5. <span data-ttu-id="1d998-133">In **Esplora server** di Visual Studio (**visualizza** -&gt; **Esplora server**) passare a **Data Connections\DefaultConnection\Tables\AspNetUsers**, fare clic con il pulsante destro del mouse e selezionare **Apri definizione tabella**.</span><span class="sxs-lookup"><span data-stu-id="1d998-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="1d998-134">Nella figura seguente viene illustrato lo schema della tabella `AspNetUsers`:</span><span class="sxs-lookup"><span data-stu-id="1d998-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schema della tabella AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="1d998-136">In **Esplora server**fare clic con il pulsante destro del mouse sulla tabella **AspNetUsers** e scegliere **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="1d998-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Dati della tabella AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="1d998-138">A questo punto, il messaggio di posta elettronica per l'utente registrato non è stato confermato.</span><span class="sxs-lookup"><span data-stu-id="1d998-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="1d998-139">Fare clic sulla riga e selezionare Elimina per eliminare l'utente.</span><span class="sxs-lookup"><span data-stu-id="1d998-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="1d998-140">Questo messaggio di posta elettronica verrà aggiunto di nuovo nel passaggio successivo e verrà inviato un messaggio di conferma all'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="1d998-141">Conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="1d998-141">Email Confirmation</span></span>

<span data-ttu-id="1d998-142">È consigliabile confermare il messaggio di posta elettronica durante la registrazione di un nuovo utente per verificare che non stiano usando un altro utente, ovvero che non sono stati registrati con la posta elettronica di un altro utente.</span><span class="sxs-lookup"><span data-stu-id="1d998-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="1d998-143">Si supponga di avere un forum di discussione che si vuole impedire che `"bob@cpandl.com"` venga registrato come `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="1d998-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="1d998-144">Senza la conferma della posta elettronica, `"joe@contoso.com"` possibile ricevere messaggi di posta elettronica indesiderati dall'app.</span><span class="sxs-lookup"><span data-stu-id="1d998-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="1d998-145">Supponiamo che Bob sia stato accidentalmente registrato come `"bib@cpandl.com"` e non sia stato notato, non sarebbe in grado di usare il ripristino della password perché l'app non ha la posta elettronica corretta.</span><span class="sxs-lookup"><span data-stu-id="1d998-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="1d998-146">La conferma tramite posta elettronica offre solo una protezione limitata dai bot e non fornisce protezione da spammer determinati.</span><span class="sxs-lookup"><span data-stu-id="1d998-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="1d998-147">In genere si vuole impedire ai nuovi utenti di inviare dati al sito Web prima che siano stati confermati tramite posta elettronica, un SMS o un altro meccanismo.</span><span class="sxs-lookup"><span data-stu-id="1d998-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="1d998-148">Nelle sezioni riportate di seguito verrà abilitata la conferma tramite posta elettronica e verrà modificato il codice per impedire l'accesso degli utenti appena registrati fino alla conferma della posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="1d998-149">In questa esercitazione verrà usato il servizio di posta elettronica SendGrid.</span><span class="sxs-lookup"><span data-stu-id="1d998-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="1d998-150">Associare SendGrid</span><span class="sxs-lookup"><span data-stu-id="1d998-150">Hook up SendGrid</span></span>

<span data-ttu-id="1d998-151">SendGrid ha modificato l'API perché questa esercitazione è stata scritta.</span><span class="sxs-lookup"><span data-stu-id="1d998-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="1d998-152">Per le istruzioni SendGrid correnti, vedere [SendGrid](http://sendgrid.com/) o [abilitare la conferma dell'account e il recupero della password](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="1d998-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="1d998-153">Sebbene questa esercitazione mostri solo come aggiungere notifiche tramite posta elettronica tramite [SendGrid](http://sendgrid.com/), è possibile inviare messaggi di posta elettronica usando SMTP e altri meccanismi (vedere [risorse aggiuntive](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="1d998-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="1d998-154">In Visual Studio aprire la **console di gestione pacchetti** (**strumenti** -&gt; gestione **pacchetti NuGet** -&gt; **console di gestione pacchetti**) e immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="1d998-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="1d998-155">Accedere alla [pagina di iscrizione di Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) e registrarsi per ottenere un account SendGrid gratuito.</span><span class="sxs-lookup"><span data-stu-id="1d998-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="1d998-156">È anche possibile iscriversi per ottenere un account SendGrid gratuito direttamente nel [sito di SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="1d998-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="1d998-157">Da **Esplora soluzioni** aprire il file *IdentityConfig.cs* nell' *app\_* cartella di avvio e aggiungere il codice seguente evidenziato in giallo alla classe `EmailService` per configurare **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="1d998-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="1d998-158">Aggiungere inoltre le seguenti istruzioni `using` all'inizio del file *IdentityConfig.cs* :</span><span class="sxs-lookup"><span data-stu-id="1d998-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="1d998-159">Per semplificare l'esempio, archiviare i valori dell'account del servizio di posta elettronica nella sezione `appSettings` del file *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="1d998-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="1d998-160">Aggiungere il codice XML seguente evidenziato in giallo al file *Web. config* nella radice del progetto:</span><span class="sxs-lookup"><span data-stu-id="1d998-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="1d998-161">Sicurezza: non archiviare mai dati sensibili nel codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="1d998-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="1d998-162">In questo esempio, l'account e le credenziali vengono archiviati nella sezione **appSetting** del file *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="1d998-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="1d998-163">In Azure è possibile archiviare in modo sicuro questi valori nella scheda **[Configura](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** della portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="1d998-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="1d998-164">Per informazioni correlate, vedere l'argomento di Rick Anderson intitolato [procedure consigliate per la distribuzione di password e altri dati sensibili in ASP.NET e Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="1d998-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="1d998-165">Aggiungere i valori del servizio di posta elettronica per riflettere i valori di autenticazione SendGrid (nome utente e password) in modo da poter inviare messaggi di posta elettronica dall'app.</span><span class="sxs-lookup"><span data-stu-id="1d998-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="1d998-166">Assicurarsi di usare il nome dell'account SendGrid anziché l'indirizzo di posta elettronica fornito da SendGrid.</span><span class="sxs-lookup"><span data-stu-id="1d998-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="1d998-167">Abilita conferma posta elettronica</span><span class="sxs-lookup"><span data-stu-id="1d998-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="1d998-168">Per abilitare la conferma tramite posta elettronica, è necessario modificare il codice di registrazione attenendosi alla procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="1d998-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="1d998-169">Nella cartella *account* aprire il code-behind *Register.aspx.cs* e aggiornare il metodo `CreateUser_Click` per abilitare le modifiche evidenziate di seguito:</span><span class="sxs-lookup"><span data-stu-id="1d998-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="1d998-170">In **Esplora soluzioni**fare clic con il pulsante destro del mouse su *default. aspx* e selezionare **Imposta come pagina iniziale**.</span><span class="sxs-lookup"><span data-stu-id="1d998-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="1d998-171">Eseguire l'app premendo **F5.**</span><span class="sxs-lookup"><span data-stu-id="1d998-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="1d998-172">Dopo la visualizzazione della pagina, fare clic sul collegamento **Register (registra** ) per visualizzare la pagina Register (registra).</span><span class="sxs-lookup"><span data-stu-id="1d998-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="1d998-173">Immettere la posta elettronica e la password, quindi fare clic sul pulsante **Register (registra** ) per inviare un messaggio di posta elettronica tramite SendGrid.</span><span class="sxs-lookup"><span data-stu-id="1d998-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="1d998-174">Lo stato corrente del progetto e del codice consentirà all'utente di accedere dopo aver completato il modulo di registrazione, anche se non ha confermato il proprio account.</span><span class="sxs-lookup"><span data-stu-id="1d998-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="1d998-175">Controllare l'account di posta elettronica e fare clic sul collegamento per confermare la posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="1d998-176">Una volta inviato il modulo di registrazione, si verrà connessi.</span><span class="sxs-lookup"><span data-stu-id="1d998-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Sito Web di esempio-accesso](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="1d998-178">Richiedi conferma posta elettronica prima dell'accesso</span><span class="sxs-lookup"><span data-stu-id="1d998-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="1d998-179">Anche se l'account di posta elettronica è stato confermato, a questo punto non è necessario fare clic sul collegamento contenuto nel messaggio di posta elettronica di verifica per eseguire l'accesso completo.</span><span class="sxs-lookup"><span data-stu-id="1d998-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="1d998-180">Nella sezione seguente verrà modificato il codice che richiede che i nuovi utenti dispongano di un messaggio di posta elettronica confermato prima dell'accesso (autenticato).</span><span class="sxs-lookup"><span data-stu-id="1d998-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="1d998-181">In **Esplora soluzioni** di Visual Studio aggiornare l'evento `CreateUser_Click` nel code-behind *Register.aspx.cs* contenuto nella cartella *account* con le modifiche evidenziate di seguito:</span><span class="sxs-lookup"><span data-stu-id="1d998-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="1d998-182">Aggiornare il metodo `LogIn` nel code-behind *login.aspx.cs* con le modifiche evidenziate seguenti:</span><span class="sxs-lookup"><span data-stu-id="1d998-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="1d998-183">Esecuzione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="1d998-183">Run the Application</span></span>

 <span data-ttu-id="1d998-184">Ora che è stato implementato il codice per verificare se l'indirizzo di posta elettronica di un utente è stato confermato, è possibile controllare la funzionalità nelle pagine di **registrazione** e di **accesso** .</span><span class="sxs-lookup"><span data-stu-id="1d998-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="1d998-185">Eliminare tutti gli account nella tabella **AspNetUsers** che contengono l'alias di posta elettronica che si desidera testare.</span><span class="sxs-lookup"><span data-stu-id="1d998-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="1d998-186">Eseguire l'app (**F5**) e verificare che non sia possibile registrarsi come utente fino a quando non viene confermato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="1d998-187">Prima di confermare il nuovo account tramite l'indirizzo di posta elettronica appena inviato, provare ad accedere con il nuovo account.</span><span class="sxs-lookup"><span data-stu-id="1d998-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="1d998-188">Si noterà che non è possibile accedere e che è necessario avere un account di posta elettronica confermato.</span><span class="sxs-lookup"><span data-stu-id="1d998-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="1d998-189">Dopo aver confermato l'indirizzo di posta elettronica, accedere all'app.</span><span class="sxs-lookup"><span data-stu-id="1d998-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="1d998-190">Ripristino e reimpostazione della password</span><span class="sxs-lookup"><span data-stu-id="1d998-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="1d998-191">In Visual Studio rimuovere i caratteri di commento dal metodo `Forgot` nel code-behind *Forgot.aspx.cs* contenuto nella cartella *account* , in modo che il metodo venga visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="1d998-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="1d998-192">Aprire la pagina *login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="1d998-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="1d998-193">Sostituire il markup vicino alla fine della sezione **LoginForm** come evidenziato di seguito:</span><span class="sxs-lookup"><span data-stu-id="1d998-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="1d998-194">Aprire il code-behind *login.aspx.cs* e rimuovere il commento dalla seguente riga di codice evidenziata in giallo dal gestore dell'evento `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="1d998-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="1d998-195">Eseguire l'app premendo **F5.**</span><span class="sxs-lookup"><span data-stu-id="1d998-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="1d998-196">Dopo la visualizzazione della pagina, fare clic sul collegamento **Accedi** .</span><span class="sxs-lookup"><span data-stu-id="1d998-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="1d998-197">Fare clic sul collegamento **password dimenticata?** per visualizzare la pagina **password dimenticata** .</span><span class="sxs-lookup"><span data-stu-id="1d998-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="1d998-198">Immettere l'indirizzo di posta elettronica e fare clic sul pulsante **Submit (Invia** ) per inviare un messaggio di posta elettronica all'indirizzo che consente di reimpostare la password.</span><span class="sxs-lookup"><span data-stu-id="1d998-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="1d998-199">Controllare l'account di posta elettronica e fare clic sul collegamento per visualizzare la pagina **Reimposta password** .</span><span class="sxs-lookup"><span data-stu-id="1d998-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="1d998-200">Nella pagina **Reimposta password** immettere l'indirizzo di posta elettronica, la password e la password confermata.</span><span class="sxs-lookup"><span data-stu-id="1d998-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="1d998-201">Quindi, fare clic sul pulsante **Reimposta** .</span><span class="sxs-lookup"><span data-stu-id="1d998-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="1d998-202">Quando la password viene reimpostata correttamente, viene visualizzata la pagina **password modificata** .</span><span class="sxs-lookup"><span data-stu-id="1d998-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="1d998-203">A questo punto è possibile accedere con la nuova password.</span><span class="sxs-lookup"><span data-stu-id="1d998-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="1d998-204">Invia nuovamente il collegamento di conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="1d998-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="1d998-205">Quando un utente crea un nuovo account locale, riceve un messaggio di posta elettronica con un collegamento di conferma che è necessario usare per poter accedere.</span><span class="sxs-lookup"><span data-stu-id="1d998-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="1d998-206">Se l'utente elimina accidentalmente il messaggio di posta elettronica di conferma o il messaggio di posta elettronica non arriva mai, sarà necessario inviare nuovamente il collegamento di conferma.</span><span class="sxs-lookup"><span data-stu-id="1d998-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="1d998-207">Le modifiche al codice seguenti illustrano come abilitare questa operazione.</span><span class="sxs-lookup"><span data-stu-id="1d998-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="1d998-208">In Visual Studio aprire il code-behind **login.aspx.cs** e aggiungere il gestore eventi seguente dopo il gestore dell'evento `LogIn`:</span><span class="sxs-lookup"><span data-stu-id="1d998-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="1d998-209">Modificare il gestore dell'evento `LogIn` nel code-behind *login.aspx.cs* modificando il codice evidenziato in giallo come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="1d998-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="1d998-210">Aggiornare la pagina *login. aspx* aggiungendo il codice evidenziato in giallo come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="1d998-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="1d998-211">Eliminare tutti gli account nella tabella **AspNetUsers** che contengono l'alias di posta elettronica che si desidera testare.</span><span class="sxs-lookup"><span data-stu-id="1d998-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="1d998-212">Eseguire l'app (**F5**) e registrare l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="1d998-213">Prima di confermare il nuovo account tramite l'indirizzo di posta elettronica appena inviato, provare ad accedere con il nuovo account.</span><span class="sxs-lookup"><span data-stu-id="1d998-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="1d998-214">Si noterà che non è possibile accedere e che è necessario avere un account di posta elettronica confermato.</span><span class="sxs-lookup"><span data-stu-id="1d998-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="1d998-215">Inoltre, è ora possibile inviare nuovamente un messaggio di conferma al proprio account di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="1d998-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="1d998-216">Immettere l'indirizzo di posta elettronica e la password, quindi premere il pulsante Invia di nuovo la **conferma** .</span><span class="sxs-lookup"><span data-stu-id="1d998-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="1d998-217">Dopo aver confermato l'indirizzo di posta elettronica in base al messaggio di posta elettronica appena inviato, accedere all'app.</span><span class="sxs-lookup"><span data-stu-id="1d998-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="1d998-218">Risoluzione dei problemi dell'app</span><span class="sxs-lookup"><span data-stu-id="1d998-218">Troubleshooting the App</span></span>

<span data-ttu-id="1d998-219">Se non si riceve un messaggio di posta elettronica contenente il collegamento per verificare le credenziali:</span><span class="sxs-lookup"><span data-stu-id="1d998-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="1d998-220">Controllare la cartella della posta indesiderata.</span><span class="sxs-lookup"><span data-stu-id="1d998-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="1d998-221">Accedere all'account SendGrid e fare clic sul [collegamento attività posta elettronica](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="1d998-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="1d998-222">Assicurarsi di aver usato il nome dell'account utente SendGrid come valore di *Web. config* anziché l'indirizzo di posta elettronica dell'account SendGrid.</span><span class="sxs-lookup"><span data-stu-id="1d998-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="1d998-223">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="1d998-223">Additional Resources</span></span>

- [<span data-ttu-id="1d998-224">Collegamenti a ASP.NET Identity risorse consigliate</span><span class="sxs-lookup"><span data-stu-id="1d998-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="1d998-225">Conferma dell'account e recupero della password con ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="1d998-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="1d998-226">Serie di esercitazioni su Web Form ASP.NET-aggiungere un provider OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="1d998-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="1d998-227">Distribuire un'app Web Form ASP.NET sicura con appartenenza, OAuth e database SQL al servizio app Azure</span><span class="sxs-lookup"><span data-stu-id="1d998-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="1d998-228">Serie di esercitazioni su Web Form ASP.NET-Abilita SSL per il progetto</span><span class="sxs-lookup"><span data-stu-id="1d998-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
