---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Utilizzo di Entity Framework 4.0 e il controllo ObjectDataSource, parte 1: Guida introduttiva | Microsoft Docs'
author: tdykstra
description: Questa serie di esercitazioni si basa sull'applicazione web di Contoso University specificano che viene creato da Getting Started with serie di esercitazioni in Entity Framework. Se yo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131346"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="0bdf9-104">Utilizzo di Entity Framework 4.0 e il controllo ObjectDataSource, parte 1: Introduzione</span><span class="sxs-lookup"><span data-stu-id="0bdf9-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="0bdf9-105">da [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="0bdf9-106">Questa serie di esercitazioni si basa sull'applicazione web Contoso University specificano che viene creato per il [Introduzione a Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) serie di esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="0bdf9-107">Se si non è stato completato le esercitazioni precedenti, come punto di partenza per questa esercitazione è possibile [scaricare l'applicazione](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) verrebbe creato.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="0bdf9-108">È anche possibile [scaricare l'applicazione](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) creato dalla serie di esercitazioni complete.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="0bdf9-109">L'applicazione web di esempio Contoso University illustra come creare applicazioni Web Form ASP.NET usando il Entity Framework 4.0 e Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="0bdf9-110">L'applicazione di esempio è un sito Web per una fittizia Contoso University.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="0bdf9-111">Include funzionalità, come ad esempio l'ammissione di studenti, la creazione di corsi e le assegnazioni di insegnati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="0bdf9-112">L'esercitazione illustra alcuni esempi in c#.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="0bdf9-113">Il [esempio scaricabile](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contiene il codice in c# e Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="0bdf9-114">Prima di tutto di database</span><span class="sxs-lookup"><span data-stu-id="0bdf9-114">Database First</span></span>
> 
> <span data-ttu-id="0bdf9-115">Esistono tre modi per utilizzare i dati in Entity Framework: *Database First*, *Model First*, e *Code First*.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="0bdf9-116">Questa esercitazione è destinata prima di Database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-116">This tutorial is for Database First.</span></span> <span data-ttu-id="0bdf9-117">Per informazioni sulle differenze tra questi flussi di lavoro e linee guida su come scegliere quello più adatto per lo scenario, vedere [flussi di lavoro sviluppo di Entity Framework](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="0bdf9-118">Web Form</span><span class="sxs-lookup"><span data-stu-id="0bdf9-118">Web Forms</span></span>
> 
> <span data-ttu-id="0bdf9-119">Ad esempio la serie di guide introduttive, questa serie di esercitazioni viene utilizzato il modello Web Form ASP.NET e si presuppone che si sappia usare con Web Form ASP.NET in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="0bdf9-120">Se non, viene visualizzato [Introduzione a Web Form ASP.NET 4.5](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="0bdf9-121">Se si preferisce usare il framework ASP.NET MVC, vedere [Introduzione a Entity Framework con MVC ASP.NET](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="0bdf9-122">Versioni del software</span><span class="sxs-lookup"><span data-stu-id="0bdf9-122">Software versions</span></span>
> 
> | <span data-ttu-id="0bdf9-123">**Illustrato nell'esercitazione**</span><span class="sxs-lookup"><span data-stu-id="0bdf9-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="0bdf9-124">**Si integra inoltre con**</span><span class="sxs-lookup"><span data-stu-id="0bdf9-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="0bdf9-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="0bdf9-125">Windows 7</span></span> | <span data-ttu-id="0bdf9-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="0bdf9-126">Windows 8</span></span> |
> | <span data-ttu-id="0bdf9-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="0bdf9-127">Visual Studio 2010</span></span> | <span data-ttu-id="0bdf9-128">Visual Studio 2010 Express per Web.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="0bdf9-129">L'esercitazione non è stata testata con le versioni successive di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="0bdf9-130">Esistono numerose differenze nelle opzioni del menu, finestre di dialogo e modelli.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="0bdf9-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="0bdf9-131">.NET 4</span></span> | <span data-ttu-id="0bdf9-132">.NET 4.5 è compatibile con .NET 4, ma non l'esercitazione è stata testata con .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="0bdf9-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="0bdf9-133">Entity Framework 4</span></span> | <span data-ttu-id="0bdf9-134">L'esercitazione non è stata testata con le versioni successive di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="0bdf9-135">A partire da Entity Framework 5, Entity Framework Usa per impostazione predefinita il `DbContext API` che è stata introdotta con Entity Framework 4.1.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="0bdf9-136">Il controllo EntityDataSource è stato progettato per utilizzare il `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="0bdf9-137">Per informazioni su come usare EntityDataSource controllare con il `DbContext` API, vedere [questo post di blog](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="0bdf9-138">Domande</span><span class="sxs-lookup"><span data-stu-id="0bdf9-138">Questions</span></span>
> 
> <span data-ttu-id="0bdf9-139">Se hai domande che non sono direttamente correlate con l'esercitazione, è possibile pubblicarli per i [forum di ASP.NET Entity Framework](https://forums.asp.net/1227.aspx), il [Entity Framework e LINQ al forum su entità](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), o [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="0bdf9-140">Il `EntityDataSource` controllo consente di creare un'applicazione molto rapidamente, ma è possibile mantenere una quantità significativa di logica di business e logica di accesso ai dati richiede in genere il *aspx* pagine.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="0bdf9-141">Se si prevede che l'applicazione all'aumento della complessità e richiedono una manutenzione continua, puoi investire di più tempo di sviluppo fin dall'inizio per creare un *livelli* oppure *layered* struttura dell'applicazione che è più facile da gestire.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="0bdf9-142">Per implementare questa architettura, il livello di presentazione separare dal livello della logica di business (BLL) e il livello di accesso ai dati (DAL).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="0bdf9-143">Un modo per implementare questa struttura consiste nell'utilizzare il `ObjectDataSource` invece di controllare il `EntityDataSource` controllo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="0bdf9-144">Quando si usa la `ObjectDataSource` (controllo), si implementa il proprio codice di accesso ai dati e quindi richiamarlo in *aspx* pagine usando un controllo dotato di molte delle stesse funzionalità degli altri controlli origine dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="0bdf9-145">Ciò consente di combinare i vantaggi di un approccio a più livelli con i vantaggi dell'uso di un controllo Web Form per l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="0bdf9-146">Il `ObjectDataSource` controllo ti offre una maggiore flessibilità in anche altri modi.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="0bdf9-147">Dal momento che si scrittura il proprio codice di accesso ai dati, è più semplice oltre la semplice leggere, inserire, aggiornare o eliminare un tipo di entità specifiche, quali sono le attività che il `EntityDataSource` controllo progettato per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="0bdf9-148">Ad esempio, è possibile eseguire la registrazione di ogni volta che viene aggiornata un'entità, archiviare i dati ogni volta che viene eliminata un'entità, o automaticamente verificare e aggiornare dati correlati in base alle necessità durante l'inserimento di una riga con un valore di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="0bdf9-149">La logica di business e le classi di Repository</span><span class="sxs-lookup"><span data-stu-id="0bdf9-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="0bdf9-150">Un `ObjectDataSource` funzionamento del controllo tramite la chiamata di una classe che viene creata.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="0bdf9-151">La classe include metodi che recuperano e aggiornano i dati e si deve forniscono i nomi di questi metodi per il `ObjectDataSource` controllo nel markup.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="0bdf9-152">Durante il rendering o l'elaborazione di postback, il `ObjectDataSource` chiama i metodi che è stato specificato.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="0bdf9-153">Oltre alle operazioni CRUD di base, la classe che viene creata per l'uso con il `ObjectDataSource` controllo potrebbe essere necessario eseguire la logica di business quando il `ObjectDataSource` legge o aggiorna i dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="0bdf9-154">Ad esempio, quando si aggiorna un reparto, potrebbe essere necessario convalidare che non gli altri reparti abbiano lo stesso amministratore perché una persona non può essere amministratore di più di un reparto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="0bdf9-155">In alcuni `ObjectDataSource` documentazione, ad esempio il [Cenni preliminari sulla classe ObjectDataSource](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), il controllo chiama una classe definita un *oggetto business* che include la logica di business sia per la logica di accesso ai dati .</span><span class="sxs-lookup"><span data-stu-id="0bdf9-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="0bdf9-156">In questa esercitazione si creerà classi separate per la logica di business e per la logica di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="0bdf9-157">La classe che incapsula la logica di accesso ai dati viene chiamata un *repository*.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="0bdf9-158">La classe per la logica di business include metodi la logica di business sia i metodi di accesso ai dati, ma il repository per eseguire attività di accesso ai dati di chiamare i metodi di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="0bdf9-159">Verrà inoltre creato un livello di astrazione tra il livello BLL e DAL che facilita l'unit test automatizzati di test del livello BLL.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="0bdf9-160">Questo livello di astrazione viene implementato creando un'interfaccia e usando l'interfaccia quando si crea un'istanza del repository nella classe della logica di business.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="0bdf9-161">Questo rende possibile per ottenere la classe di logica di business con un riferimento a qualsiasi oggetto che implementa l'interfaccia del repository.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="0bdf9-162">Per il normale funzionamento, è fornire un oggetto di repository che funziona con Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="0bdf9-163">Per i test, è fornire un oggetto di repository che funziona con i dati archiviati in modo che è possibile gestire facilmente, ad esempio le variabili di classe definite come le raccolte.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="0bdf9-164">Nella figura seguente mostra la differenza tra una classe di logica di business che include la logica di accesso ai dati senza un repository e uno che usa un repository.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="0bdf9-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="0bdf9-166">Inizierà creando pagine web in cui il `ObjectDataSource` è associato direttamente a un repository in quanto esegue solo le attività di base di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="0bdf9-167">Nella prossima esercitazione si crea una classe per la logica di business con la logica di convalida e associa il `ObjectDataSource` controllo invece di tale classe per la classe di repository.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="0bdf9-168">Si creerà anche unit test per la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="0bdf9-169">Nella terza esercitazione di questa serie si aggiungerà l'ordinamento e filtrare le funzionalità all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="0bdf9-170">Le pagine create in questa esercitazione usare il `Departments` set di entità del modello di dati che è stato creato nel [serie di esercitazioni con guide introduttive](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="0bdf9-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="0bdf9-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="0bdf9-173">L'aggiornamento del Database e il modello di dati</span><span class="sxs-lookup"><span data-stu-id="0bdf9-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="0bdf9-174">Iniziare l'esercitazione da apportare due modifiche al database, che richiedono le modifiche corrispondenti nel modello di dati che è stato creato nel [Introduzione a Entity Framework e Web Form](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="0bdf9-175">In uno di tali esercitazioni, sono apportate modifiche nella finestra di progettazione manualmente per sincronizzare il modello di dati con il database dopo una modifica al database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="0bdf9-176">In questa esercitazione si utilizzerà la finestra di progettazione **Aggiorna modello da Database** dello strumento per aggiornare automaticamente il modello di dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="0bdf9-177">Aggiunta di una relazione al Database</span><span class="sxs-lookup"><span data-stu-id="0bdf9-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="0bdf9-178">In Visual Studio, aprire l'applicazione web di Contoso University è stato creato nel [Introduzione a Entity Framework e Web Form](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) serie di esercitazioni e quindi aprire il `SchoolDiagram` diagramma di database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="0bdf9-179">Se si esamina il `Department` tabella nel diagramma di database, si noterà che contiene un `Administrator` colonna.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="0bdf9-180">Questa colonna è una chiave esterna per il `Person` tabella, ma nessuna relazione di chiave esterna viene definita nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="0bdf9-181">È necessario creare la relazione e aggiornare il modello di dati in modo che Entity Framework può gestire automaticamente questa relazione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="0bdf9-182">Nel diagramma di database, fare doppio clic il `Department` tabella e selezionare **relazioni**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="0bdf9-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="0bdf9-184">Nel **Foreign Key Relationships** fare clic su casella **Add**, quindi fare clic sui puntini di sospensione per **specifica tabelle e colonne**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="0bdf9-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="0bdf9-186">Nel **tabelle e colonne** finestra di dialogo casella, impostare la tabella della chiave primaria e campo `Person` e `PersonID`e impostare la tabella di chiave esterna e campo `Department` e `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="0bdf9-187">(Quando si esegue questa operazione, il nome della relazione verrà modificato da `FK_Department_Department` a `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="0bdf9-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="0bdf9-189">Fare clic su **OK** nel **tabelle e colonne** fare clic su **Chiudi** nel **Foreign Key Relationships** casella e salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="0bdf9-190">Se viene chiesto se si desidera salvare il `Person` e `Department` tabelle, fare clic su **Yes**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="0bdf9-191">Se è stata eliminata `Person` righe corrispondenti ai dati che sono già presente nel `Administrator` colonna, non sarà in grado di salvare questa modifica.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="0bdf9-192">In tal caso, usare l'editor di tabella in **Esplora Server** assicurarsi che le `Administrator` valore in ogni `Department` riga contiene l'ID di un record che esista effettivamente nel `Person` tabella.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="0bdf9-193">Dopo aver salvato la modifica, non sarà in grado di eliminare una riga dal `Person` tabella se tale utente è un amministratore del reparto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="0bdf9-194">In un'applicazione di produzione, si fornirebbe un messaggio di errore specifico quando un vincolo di database impedisce un'operazione di eliminazione oppure è possibile specificare un'operazione di eliminazione a catena.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="0bdf9-195">Per un esempio di come specificare un'operazione di eliminazione a catena, vedere [Entity Framework e ASP.NET-Guida introduttiva parte 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="0bdf9-196">Aggiunta di una vista nel database</span><span class="sxs-lookup"><span data-stu-id="0bdf9-196">Adding a View to the Database</span></span>

<span data-ttu-id="0bdf9-197">Nel nuovo *Departments.aspx* pagina che si crea, si desidera fornire un elenco di riepilogo a discesa di instructors (insegnanti), con nomi nel formato "cognome, nome" in modo che gli utenti possono selezionare gli amministratori di reparto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="0bdf9-198">Per renderne più semplice per farlo, si creerà una vista nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="0bdf9-199">La visualizzazione sarà costituito semplicemente i dati necessari per l'elenco a discesa: il nome completo (correttamente formattato) e la chiave del record.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="0bdf9-200">Nelle **Esplora Server**, espandere *School. mdf*, fare doppio clic sui **viste** cartella e selezionare **Aggiungi nuova vista**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="0bdf9-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="0bdf9-202">Fare clic su **Close** quando il **Aggiungi tabella** viene visualizzata la finestra di dialogo e incollare l'istruzione SQL seguente nel riquadro SQL:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="0bdf9-203">Salvare la vista come `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="0bdf9-204">L'aggiornamento del modello di dati</span><span class="sxs-lookup"><span data-stu-id="0bdf9-204">Updating the Data Model</span></span>

<span data-ttu-id="0bdf9-205">Nel *DAL* cartella, aprire il *SchoolModel* del file, fare doppio clic nell'area di progettazione e selezionare **Aggiorna modello da Database**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="0bdf9-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="0bdf9-207">Nel **Scegli oggetti di Database** finestra di dialogo, seleziona la **Add** scheda e selezionare la vista appena creata.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="0bdf9-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="0bdf9-209">Scegliere **Fine**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-209">Click **Finish**.</span></span>

<span data-ttu-id="0bdf9-210">Nella finestra di progettazione, si noterà che lo strumento è stato creato un `vInstructorName` entità e una nuova associazione tra il `Department` e `Person` entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="0bdf9-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="0bdf9-212">Nel **Output** e **elenco errori** tasti di windows si potrebbero ricevere un messaggio di avviso che informa che lo strumento creato automaticamente un database primario per il nuovo `vInstructorName` visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="0bdf9-213">Si tratta di un comportamento previsto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-213">This is expected behavior.</span></span>

<span data-ttu-id="0bdf9-214">Quando si fa riferimento al nuovo `vInstructorName` entità nel codice, non si desidera utilizzare la convenzione di database apponendo il prefisso "v" minuscolo ad esso.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="0bdf9-215">Pertanto, verranno rinominate le entità e set di entità nel modello.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="0bdf9-216">Aprire il **modellare Browser**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-216">Open the **Model Browser**.</span></span> <span data-ttu-id="0bdf9-217">Noterete che `vInstructorName` elencato come un tipo di entità e una visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="0bdf9-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="0bdf9-219">Sotto **SchoolModel** (non **SchoolModel. Store**), fare doppio clic su **vInstructorName** e selezionare **proprietà**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="0bdf9-220">Nel **delle proprietà** finestra Modifica il **nome** proprietà su "InstructorName" e modificare il **nome Set entità** proprietà su "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="0bdf9-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="0bdf9-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="0bdf9-222">Salvare e chiudere il modello di dati e quindi ricompilare il progetto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="0bdf9-223">Utilizzo di una classe di Repository e un controllo ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="0bdf9-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="0bdf9-224">Creare un nuovo file di classe nel *DAL* cartella, denominarla *SchoolRepository.cs*e sostituire il codice esistente con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="0bdf9-225">Questo codice fornisce un'unica `GetDepartments` metodo che restituisce tutte le entità nel `Departments` set di entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="0bdf9-226">Poiché è certo che si accede il `Person` proprietà di navigazione per ogni riga restituita, si specifica il caricamento eager per tale proprietà utilizzando il `Include` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="0bdf9-227">La classe implementa anche il `IDisposable` interfaccia per garantire che la connessione al database viene rilasciata quando viene eliminato l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="0bdf9-228">Una procedura comune consiste nel creare una classe di repository per ogni tipo di entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="0bdf9-229">In questa esercitazione viene usata una classe di repository per più tipi di entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="0bdf9-230">Per altre informazioni sul modello di repository, vedere i post in [blog del team di Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) e [blog di Julie](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="0bdf9-231">Il `GetDepartments` metodo restituisce un `IEnumerable` oggetto anziché un' `IQueryable` oggetto per garantire che la raccolta restituita è utilizzabile anche dopo aver eliminato l'oggetto repository stesso.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="0bdf9-232">Un `IQueryable` oggetto può causare l'accesso al database ogni volta che è possibile accedervi, ma l'oggetto repository può essere eliminato entro l'ora di un controllo con associazione a dati tenta di eseguire il rendering dei dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="0bdf9-233">È possibile restituire un altro tipo di raccolta, ad esempio un `IList` dell'oggetto anziché un `IEnumerable` oggetto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="0bdf9-234">Tuttavia, restituendo un' `IEnumerable` oggetto assicura che è possibile eseguire le attività di elaborazione tipica elenco di sola lettura, ad esempio `foreach` cicli e query LINQ, ma è Impossibile aggiungere o rimuovere gli elementi nella raccolta, che potrebbe implicare che sarebbero stati tali modifiche resi persistenti nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="0bdf9-235">Creare un *Departments.aspx* pagina che utilizza il *Site* pagina master e aggiungere il markup seguente nel `Content` controllo denominato `Content2`:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="0bdf9-236">Questo codice crea un' `ObjectDataSource` controllo che usa la classe di repository appena creato, e un `GridView` controllo per visualizzare i dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="0bdf9-237">Il `GridView` specifica di controllo **modificare** e **eliminare** comandi, ma non sono stati aggiunti per supportarli ancora codice.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="0bdf9-238">Utilizzano diverse colonne `DynamicField` controlla in modo da poter usufruire della funzionalità di formattazione e convalida automatica dei dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="0bdf9-239">Per questo scopo, è necessario chiamare il `EnableDynamicData` metodo nella `Page_Init` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="0bdf9-240">(`DynamicControl` controlli non vengono usati nel `Administrator` campo perché non funzionano con le proprietà di navigazione.)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="0bdf9-241">Il `Vertical-Align="Top"` attributi verranno diventano importanti in un secondo momento quando si aggiunge una colonna che nidificato `GridView` controllo alla griglia.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="0bdf9-242">Aprire il *Departments.aspx.cs* del file e aggiungere quanto segue `using` istruzione:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="0bdf9-243">Quindi aggiungere il gestore seguente per la pagina `Init` evento:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="0bdf9-244">Nel *DAL* cartella, creare un nuovo file di classe denominato *Department.cs* e sostituire il codice esistente con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="0bdf9-245">Questo codice aggiunge i metadati nel modello di dati.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="0bdf9-246">Specifica che il `Budget` proprietà del `Department` entità rappresenta in effetti valuta anche se il tipo di dati è `Decimal`, e specifica che il valore deve essere compreso tra 0 e $1,000,000.00.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="0bdf9-247">Specifica inoltre che il `StartDate` proprietà deve essere formattata come una data nel formato mm/gg/aaaa.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="0bdf9-248">Eseguire la *Departments.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="0bdf9-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="0bdf9-250">Si noti che anche se non è stato specificato in una stringa di formato il *Departments.aspx* markup della pagina per il **Budget** oppure **data di inizio** predefinito di colonne, valuta e date è stata applicata la formattazione a essi dal `DynamicField` controlla, utilizzando i metadati forniti nel *Department.cs* file.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="0bdf9-251">Aggiunta di inserimento e la funzionalità di eliminazione</span><span class="sxs-lookup"><span data-stu-id="0bdf9-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="0bdf9-252">Aprire *SchoolRepository.cs*, aggiungere il codice seguente per creare un `Insert` metodo e un `Delete` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="0bdf9-253">Il codice include anche un metodo denominato `GenerateDepartmentID` che calcola il valore della chiave record disponibile successivo per l'uso dal `Insert` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="0bdf9-254">Questa operazione è necessaria perché il database non è configurato per questa operazione automaticamente per calcolare il `Department` tabella.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="0bdf9-255">Il metodo di collegamento</span><span class="sxs-lookup"><span data-stu-id="0bdf9-255">The Attach Method</span></span>

<span data-ttu-id="0bdf9-256">Il `DeleteDepartment` chiamate al metodo il `Attach` metodo per ristabilire il collegamento che viene mantenuto nel gestore di stato oggetto di contesto dell'oggetto tra l'entità in memoria e il database di riga rappresenta.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="0bdf9-257">Ciò deve precedere le chiamate al metodo il `SaveChanges` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="0bdf9-258">Il termine *contesto dell'oggetto* fa riferimento alla classe che deriva da Entity Framework il `ObjectContext` classi utilizzabili per accedere ai set di entità e le entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="0bdf9-259">Nel codice per questo progetto, la classe è denominata `SchoolEntities`, e un'istanza è sempre denominata `context`.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="0bdf9-260">Contesto dell'oggetto *di gestione dello stato degli oggetti* è una classe che deriva dal `ObjectStateManager` classe.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="0bdf9-261">Contattare l'oggetto usa la gestione dello stato degli oggetti per archiviare gli oggetti entità e di tenere traccia se ognuno di essi è sincronizzato con la riga corrispondente nella tabella o le righe nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="0bdf9-262">Quando si legge un'entità, il contesto dell'oggetto viene memorizzato nel gestore di stato oggetto e consente di determinare se tale rappresentazione dell'oggetto è sincronizzato con il database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="0bdf9-263">Ad esempio, se si modifica un valore della proprietà, viene impostato un flag per indicare che la proprietà che è stata modificata non è più sincronizzata con il database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="0bdf9-264">Quando si chiama quindi il `SaveChanges` metodo, il contesto dell'oggetto individua le operazioni da eseguire nel database perché l'oggetto stato in grado di indicare esattamente ciò che è diverso tra lo stato corrente dell'entità e lo stato del database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="0bdf9-265">Tuttavia, questo processo in genere non funziona in un'applicazione web, perché l'istanza contesto dell'oggetto che legge un'entità, insieme a tutti gli elementi nel relativo gestore di stato di oggetto, viene eliminato dopo il rendering di una pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="0bdf9-266">Istanza dell'oggetto di contesto che debba applicare le modifiche è una nuova istanza che viene creata un'istanza per l'elaborazione di postback.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="0bdf9-267">Nel caso del `DeleteDepartment` metodo, il `ObjectDataSource` controllo crea nuovamente la versione originale dell'entità per l'utente dai valori nello stato di visualizzazione, ma ciò ricreato `Department` entità non esiste nel gestore degli stati di oggetti.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="0bdf9-268">Se è stato chiamato il `DeleteObject` metodo su questa entità creata di nuovo, la chiamata avrà esito negativo perché il contesto dell'oggetto non sa se l'entità è sincronizzato con il database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="0bdf9-269">Tuttavia, la chiamata di `Attach` metodo ristabilisce di rilevamento stesso tra ricreate entità e i valori nel database che è stato originariamente eseguito automaticamente quando l'entità è stata letta in un'istanza precedente del contesto dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="0bdf9-270">Vi sono casi quando non si desidera che il contesto dell'oggetto per tenere traccia delle entità nel gestore degli stati di oggetti, ed è possibile impostare flag per evitare che tale operazione.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="0bdf9-271">Nelle esercitazioni successive di questa serie sono riportati alcuni esempi di questo oggetto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="0bdf9-272">Il metodo SaveChanges</span><span class="sxs-lookup"><span data-stu-id="0bdf9-272">The SaveChanges Method</span></span>

<span data-ttu-id="0bdf9-273">Questa classe di repository semplice illustra i principi di base di come eseguire operazioni CRUD.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="0bdf9-274">In questo esempio, il `SaveChanges` metodo viene chiamato immediatamente dopo ogni aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="0bdf9-275">In un'applicazione di produzione è possibile chiamare il `SaveChanges` metodo da un metodo separato per fornire maggiore controllo sulla quando viene aggiornato il database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="0bdf9-276">(Alla fine della prossima esercitazione è possibile trovare un collegamento a un white paper che illustra lo schema unit of work che è un approccio per coordinare gli aggiornamenti correlati.) Si noti inoltre che nell'esempio di `DeleteDepartment` (metodo) non include codice per gestire i conflitti di concorrenza; verrà aggiunto codice per eseguire questa operazione in un'esercitazione successiva di questa serie.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="0bdf9-277">Recuperare i nomi dei docenti per selezionare durante l'inserimento</span><span class="sxs-lookup"><span data-stu-id="0bdf9-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="0bdf9-278">Gli utenti devono essere in grado di selezionare un amministratore da un elenco degli insegnanti in un elenco a discesa durante la creazione di nuovi reparti.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="0bdf9-279">Pertanto, aggiungere il codice seguente al *SchoolRepository.cs* per creare un metodo per recuperare l'elenco degli insegnanti con la vista creata in precedenza:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="0bdf9-280">Creazione di una pagina per l'inserimento di reparti</span><span class="sxs-lookup"><span data-stu-id="0bdf9-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="0bdf9-281">Creare un *DepartmentsAdd.aspx* pagina che utilizza il *Site* pagina e aggiungere il markup seguente nel `Content` controllo denominato `Content2`:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="0bdf9-282">Questo codice crea due `ObjectDataSource` controlli, uno per l'inserimento di nuove `Department` entità e uno per recuperare i nomi dei docenti per il `DropDownList` controllo utilizzato per la selezione agli amministratori di reparto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="0bdf9-283">Crea il markup una `DetailsView` per immettere nuovi reparti che specifica un gestore per il controllo di controllo `ItemInserting` eventi in modo che sia possibile impostare il `Administrator` valore di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="0bdf9-284">Alla fine è un `ValidationSummary` controllo per visualizzare i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="0bdf9-285">Aprire *DepartmentsAdd.aspx.cs* e aggiungere quanto segue `using` istruzione:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="0bdf9-286">Aggiungere i metodi e la variabile di classe seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="0bdf9-287">Il `Page_Init` metodo abilita la funzionalità di Dynamic Data.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="0bdf9-288">Il gestore per il `DropDownList` del controllo `Init` evento consente di salvare un riferimento al controllo e il gestore per il `DetailsView` del controllo `Inserting` evento usa tale riferimento per ottenere il `PersonID` valore l'insegnante selezionato e l'aggiornamento il `Administrator` proprietà di chiave esterna del `Department` entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="0bdf9-289">Esecuzione della pagina, aggiungere le informazioni per un nuovo reparto e quindi scegliere il **Inserisci** collegamento.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="0bdf9-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="0bdf9-291">Immettere i valori per un altro nuovo reparto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-291">Enter values for another new department.</span></span> <span data-ttu-id="0bdf9-292">Immettere un numero maggiore di 1,000,000.00 nel **Budget** campo e pressione di tab per il campo successivo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="0bdf9-293">Viene visualizzato un asterisco nel campo e se si posiziona il puntatore del mouse su di esso, noterete il messaggio di errore immessi nei metadati per il campo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="0bdf9-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="0bdf9-295">Fare clic su **inserire**, e viene visualizzato il messaggio di errore visualizzato per il `ValidationSummary` controllo nella parte inferiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="0bdf9-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="0bdf9-297">Quindi, chiudere il browser e aprire il *Departments.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="0bdf9-298">Aggiungere funzionalità di eliminazione per il *Departments.aspx* pagina mediante l'aggiunta di un `DeleteMethod` dell'attributo il `ObjectDataSource` (controllo) e un `DataKeyNames` dell'attributo di `GridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="0bdf9-299">I tag di apertura per questi controlli saranno ora simile all'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="0bdf9-300">Eseguire la pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-300">Run the page.</span></span>

<span data-ttu-id="0bdf9-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="0bdf9-302">Eliminare il reparto è stato aggiunto durante l'esecuzione di *DepartmentsAdd.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="0bdf9-303">Aggiunta di funzionalità di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="0bdf9-303">Adding Update Functionality</span></span>

<span data-ttu-id="0bdf9-304">Aprire *SchoolRepository.cs* e aggiungere quanto segue `Update` metodo:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="0bdf9-305">Quando fa clic su **Update** nel *Departments.aspx* pagina, il `ObjectDataSource` controllo crea due `Department` entità da passare al `UpdateDepartment` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="0bdf9-306">Una contiene i valori originali che sono stati archiviati nello stato di visualizzazione e l'altro contenente i nuovi valori immessi nel `GridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="0bdf9-307">Il codice nel `UpdateDepartment` metodo passa il `Department` entità con i valori originali per il `Attach` metodo per stabilire la tracciabilità tra l'entità e ciò che si trova nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="0bdf9-308">Quindi il codice passa il `Department` entità con i nuovi valori per il `ApplyCurrentValues` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="0bdf9-309">Il contesto dell'oggetto confronta i valori vecchi e nuovi.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-309">The object context compares the old and new values.</span></span> <span data-ttu-id="0bdf9-310">Se un nuovo valore è diverso da un valore precedente, il contesto dell'oggetto viene modificato il valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="0bdf9-311">Il `SaveChanges` metodo aggiorna quindi solo le colonne modificate nel database.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="0bdf9-312">(Tuttavia, se la funzione di aggiornamento per questa entità è stato eseguito il mapping a una stored procedure, l'intera riga verrà aggiornata indipendentemente da quali colonne sono state modificate.)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="0bdf9-313">Aprire il *Departments.aspx* file e aggiungere i seguenti attributi per il `DepartmentsObjectDataSource` controllo:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="0bdf9-314">Questo cause per i precedenti valori archiviati in stato di visualizzazione in modo che essi possano essere confrontati con i nuovi valori nel `Update` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0bdf9-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="0bdf9-315">Ciò indica al controllo che è il nome del parametro originale del valori `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="0bdf9-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="0bdf9-316">Il markup per il tag di apertura di `ObjectDataSource` controllo sarà ora simile all'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="0bdf9-317">Aggiungere un `OnRowUpdating="DepartmentsGridView_RowUpdating"` dell'attributo di `GridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="0bdf9-318">Verrà usato per impostare il `Administrator` valore della proprietà in base alla riga a cui l'utente seleziona in un elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="0bdf9-319">Il `GridView` ora tag di apertura è simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="0bdf9-320">Aggiungere un `EditItemTemplate` di controllo per il `Administrator` colonna il `GridView` controllare, subito dopo il `ItemTemplate` controllo per la colonna:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="0bdf9-321">Ciò `EditItemTemplate` è simile al controllo il `InsertItemTemplate` controllare nel *DepartmentsAdd.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="0bdf9-322">La differenza è che il valore iniziale del controllo è impostato tramite il `SelectedValue` attributo.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="0bdf9-323">Prima di `GridView` controllo, aggiungere un `ValidationSummary` controllare come è stato fatto *DepartmentsAdd.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="0bdf9-324">Aprire *Departments.aspx.cs* immediatamente dopo la dichiarazione di classe parziale, aggiungere il codice seguente per creare un campo privato per fare riferimento il `DropDownList` controllo:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="0bdf9-325">Quindi aggiungere i gestori per il `DropDownList` del controllo `Init` evento e il `GridView` del controllo `RowUpdating` evento:</span><span class="sxs-lookup"><span data-stu-id="0bdf9-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="0bdf9-326">Il gestore per il `Init` evento consente di salvare un riferimento al `DropDownList` controllo nel campo della classe.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="0bdf9-327">Il gestore per il `RowUpdating` evento utilizza il riferimento per ottenere il valore specificato dall'utente e metterle in pratica per la `Administrator` proprietà del `Department` entità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="0bdf9-328">Usare il *DepartmentsAdd.aspx* pagina per aggiungere un nuovo reparto, quindi eseguire il *Departments.aspx* e fare clic su **Edit** sulla riga che è stato aggiunto.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="0bdf9-329">Non sarà in grado di modificare le righe che non è stato aggiunto (vale a dire che erano già presenti nel database), a causa di dati non validi nel database. gli amministratori per le righe che sono stati creati con il database sono gli studenti.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="0bdf9-330">Se si prova a modificare uno di essi, si otterrà una pagina di errore che segnala un errore, ad esempio `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="0bdf9-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="0bdf9-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="0bdf9-332">Se si immette un valore non valido **Budget** amount e quindi fare clic su **Update**, asterisco stesso e il messaggio di errore che si è visto nella vengono visualizzati i *Departments.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="0bdf9-333">Modificare un valore del campo o selezionare un altro amministratore e fare clic su **Update**.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="0bdf9-334">Viene visualizzata la modifica.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-334">The change is displayed.</span></span>

<span data-ttu-id="0bdf9-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="0bdf9-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="0bdf9-336">In questo argomento completa l'introduzione all'uso del `ObjectDataSource` controllo per CRUD di base (creare, leggere, aggiornare ed eliminare) le operazioni con Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="0bdf9-337">È stata creata una semplice applicazione a più livelli, ma il livello di logica di business è ancora strettamente associato a livello di accesso ai dati, che rende più difficile il testing unità automatizzato.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="0bdf9-338">Nell'esercitazione verrà illustrato come implementare il modello di repository per facilitare il testing unità.</span><span class="sxs-lookup"><span data-stu-id="0bdf9-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="0bdf9-339">avanti</span><span class="sxs-lookup"><span data-stu-id="0bdf9-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
