---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
title: Ottimizzazione delle prestazioni con la Entity Framework 4,0 in un'applicazione Web ASP.NET 4 | Microsoft Docs
author: tdykstra
description: Questa serie di esercitazioni si basa sull'applicazione Web Contoso University creata dal Introduzione con la serie di esercitazioni Entity Framework 4,0. È...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 4e43455e-dfa1-42db-83cb-c987703f04b5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: 5630200a1ad1d30f6d89b38e15179f15b699fa9f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78545962"
---
# <a name="maximizing-performance-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="f8e54-104">Ottimizzazione delle prestazioni con la Entity Framework 4,0 in un'applicazione Web ASP.NET 4</span><span class="sxs-lookup"><span data-stu-id="f8e54-104">Maximizing Performance with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>

<span data-ttu-id="f8e54-105">di [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f8e54-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="f8e54-106">Questa serie di esercitazioni si basa sull'applicazione Web Contoso University creata dal [Introduzione con la](https://asp.net/entity-framework/tutorials#Getting%20Started) serie di esercitazioni Entity Framework 4,0.</span><span class="sxs-lookup"><span data-stu-id="f8e54-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="f8e54-107">Se le esercitazioni precedenti non sono state completate, come punto di partenza per questa esercitazione è possibile [scaricare l'applicazione](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) creata.</span><span class="sxs-lookup"><span data-stu-id="f8e54-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="f8e54-108">È anche possibile [scaricare l'applicazione](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) creata dalla serie di esercitazioni complete.</span><span class="sxs-lookup"><span data-stu-id="f8e54-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="f8e54-109">In caso di domande sulle esercitazioni, è possibile pubblicarle nel [Forum di ASP.NET Entity Framework](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8e54-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>

<span data-ttu-id="f8e54-110">Nell'esercitazione precedente si è visto come gestire i conflitti di concorrenza.</span><span class="sxs-lookup"><span data-stu-id="f8e54-110">In the previous tutorial, you saw how to handle concurrency conflicts.</span></span> <span data-ttu-id="f8e54-111">Questa esercitazione mostra le opzioni per migliorare le prestazioni di un'applicazione Web ASP.NET che usa la Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f8e54-111">This tutorial shows options for improving the performance of an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="f8e54-112">Verranno illustrati diversi metodi per ottimizzare le prestazioni o per diagnosticare problemi di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-112">You'll learn several methods for maximizing performance or for diagnosing performance problems.</span></span>

<span data-ttu-id="f8e54-113">Le informazioni presentate nelle sezioni seguenti possono essere utili in un'ampia gamma di scenari:</span><span class="sxs-lookup"><span data-stu-id="f8e54-113">Information presented in the following sections is likely to be useful in a broad variety of scenarios:</span></span>

- <span data-ttu-id="f8e54-114">Caricare in modo efficiente i dati correlati.</span><span class="sxs-lookup"><span data-stu-id="f8e54-114">Efficiently load related data.</span></span>
- <span data-ttu-id="f8e54-115">Gestire lo stato di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-115">Manage view state.</span></span>

<span data-ttu-id="f8e54-116">Le informazioni presentate nelle sezioni seguenti potrebbero risultare utili se si dispone di singole query che presentano problemi di prestazioni:</span><span class="sxs-lookup"><span data-stu-id="f8e54-116">Information presented in the following sections might be useful if you have individual queries that present performance problems:</span></span>

- <span data-ttu-id="f8e54-117">Utilizzare l'opzione di Unione `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-117">Use the `NoTracking` merge option.</span></span>
- <span data-ttu-id="f8e54-118">Pre-compilare le query LINQ.</span><span class="sxs-lookup"><span data-stu-id="f8e54-118">Pre-compile LINQ queries.</span></span>
- <span data-ttu-id="f8e54-119">Esaminare i comandi di query inviati al database.</span><span class="sxs-lookup"><span data-stu-id="f8e54-119">Examine query commands sent to the database.</span></span>

<span data-ttu-id="f8e54-120">Le informazioni presentate nella sezione seguente sono potenzialmente utili per le applicazioni che dispongono di modelli di dati di dimensioni molto grandi:</span><span class="sxs-lookup"><span data-stu-id="f8e54-120">Information presented in the following section is potentially useful for applications that have extremely large data models:</span></span>

- <span data-ttu-id="f8e54-121">Pre-genera viste.</span><span class="sxs-lookup"><span data-stu-id="f8e54-121">Pre-generate views.</span></span>

> [!NOTE]
> <span data-ttu-id="f8e54-122">Le prestazioni dell'applicazione Web sono influenzate da molti fattori, tra cui le dimensioni dei dati di richiesta e risposta, la velocità delle query del database, il numero di richieste che il server può accodare e la rapidità di manutenzione e persino l'efficienza di qualsiasi librerie di script client che è possibile usare.</span><span class="sxs-lookup"><span data-stu-id="f8e54-122">Web application performance is affected by many factors, including things like the size of request and response data, the speed of database queries, how many requests the server can queue and how quickly it can service them, and even the efficiency of any client-script libraries you might be using.</span></span> <span data-ttu-id="f8e54-123">Se le prestazioni sono critiche nell'applicazione o se i test o l'esperienza mostrano che le prestazioni dell'applicazione non sono soddisfacenti, è consigliabile seguire il protocollo normale per l'ottimizzazione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-123">If performance is critical in your application, or if testing or experience shows that application performance isn't satisfactory, you should follow normal protocol for performance tuning.</span></span> <span data-ttu-id="f8e54-124">Misura per determinare la posizione in cui si verificano i colli di bottiglia delle prestazioni e quindi indirizzare le aree che avranno il maggior effetto sulle prestazioni complessive dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-124">Measure to determine where performance bottlenecks are occurring, and then address the areas that will have the greatest impact on overall application performance.</span></span>
> 
> <span data-ttu-id="f8e54-125">Questo argomento è incentrato principalmente sui modi in cui è possibile migliorare potenzialmente le prestazioni specifiche del Entity Framework in ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f8e54-125">This topic focuses mainly on ways in which you can potentially improve the performance specifically of the Entity Framework in ASP.NET.</span></span> <span data-ttu-id="f8e54-126">I suggerimenti riportati di seguito sono utili se si determina che l'accesso ai dati è uno dei colli di bottiglia delle prestazioni nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-126">The suggestions here are useful if you determine that data access is one of the performance bottlenecks in your application.</span></span> <span data-ttu-id="f8e54-127">Ad eccezione di quanto indicato, i metodi descritti in questo articolo non devono essere considerati &quot;procedure consigliate&quot; in generale, molti dei quali sono appropriati solo in situazioni eccezionali o per risolvere tipi molto specifici di colli di bottiglia delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-127">Except as noted, the methods explained here shouldn't be considered &quot;best practices&quot; in general — many of them are appropriate only in exceptional situations or to address very specific kinds of performance bottlenecks.</span></span>

<span data-ttu-id="f8e54-128">Per avviare l'esercitazione, avviare Visual Studio e aprire l'applicazione Web Contoso University in cui si stava lavorando nell'esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="f8e54-128">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="efficiently-loading-related-data"></a><span data-ttu-id="f8e54-129">Caricamento efficace dei dati correlati</span><span class="sxs-lookup"><span data-stu-id="f8e54-129">Efficiently Loading Related Data</span></span>

<span data-ttu-id="f8e54-130">I Entity Framework possono caricare i dati correlati nelle proprietà di navigazione di un'entità in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="f8e54-130">There are several ways that the Entity Framework can load related data into the navigation properties of an entity:</span></span>

- <span data-ttu-id="f8e54-131">*Caricamento lazy*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-131">*Lazy loading*.</span></span> <span data-ttu-id="f8e54-132">Quando un'entità viene letta per la prima volta, i dati correlati non vengono recuperati.</span><span class="sxs-lookup"><span data-stu-id="f8e54-132">When the entity is first read, related data isn't retrieved.</span></span> <span data-ttu-id="f8e54-133">La prima volta che si tenta di accedere a una proprietà di navigazione, tuttavia, i dati necessari per quest'ultima vengono recuperati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f8e54-133">However, the first time you attempt to access a navigation property, the data required for that navigation property is automatically retrieved.</span></span> <span data-ttu-id="f8e54-134">Questo comporta l'invio di più query al database, una per l'entità stessa e una ogni volta che devono essere recuperati i dati correlati per l'entità.</span><span class="sxs-lookup"><span data-stu-id="f8e54-134">This results in multiple queries sent to the database — one for the entity itself and one each time that related data for the entity must be retrieved.</span></span> 

    <span data-ttu-id="f8e54-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="f8e54-136">*Caricamento eager*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-136">*Eager loading*.</span></span> <span data-ttu-id="f8e54-137">Quando l'entità viene letta, i dati correlati corrispondenti vengono recuperati insieme ad essa.</span><span class="sxs-lookup"><span data-stu-id="f8e54-137">When the entity is read, related data is retrieved along with it.</span></span> <span data-ttu-id="f8e54-138">Ciò in genere ha come risultato una query join singola che recupera tutti i dati necessari.</span><span class="sxs-lookup"><span data-stu-id="f8e54-138">This typically results in a single join query that retrieves all of the data that's needed.</span></span> <span data-ttu-id="f8e54-139">È possibile specificare il caricamento eager usando il metodo `Include`, come illustrato in precedenza in queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-139">You specify eager loading by using the `Include` method, as you've seen already in these tutorials.</span></span>

<span data-ttu-id="f8e54-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

- <span data-ttu-id="f8e54-141">*Caricamento esplicito*</span><span class="sxs-lookup"><span data-stu-id="f8e54-141">*Explicit loading*.</span></span> <span data-ttu-id="f8e54-142">Questa operazione è simile al caricamento lazy, ad eccezione del fatto che i dati correlati vengono recuperati in modo esplicito nel codice. non viene eseguita automaticamente quando si accede a una proprietà di navigazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-142">This is similar to lazy loading, except that you explicitly retrieve the related data in code; it doesn't happen automatically when you access a navigation property.</span></span> <span data-ttu-id="f8e54-143">I dati correlati vengono caricati manualmente usando il metodo `Load` della proprietà di navigazione per le raccolte oppure si usa il metodo `Load` della proprietà Reference per le proprietà che contengono un singolo oggetto.</span><span class="sxs-lookup"><span data-stu-id="f8e54-143">You load related data manually using the `Load` method of the navigation property for collections, or you use the `Load` method of the reference property for properties that hold a single object.</span></span> <span data-ttu-id="f8e54-144">(Ad esempio, si chiama il metodo `PersonReference.Load` per caricare la proprietà di navigazione `Person` di un'entità `Department`).</span><span class="sxs-lookup"><span data-stu-id="f8e54-144">(For example, you call the `PersonReference.Load` method to load the `Person` navigation property of a `Department` entity.)</span></span>

    <span data-ttu-id="f8e54-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="f8e54-146">Poiché non recuperano immediatamente i valori delle proprietà, il caricamento lazy e il caricamento esplicito sono noti anche come *caricamento posticipato*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-146">Because they don't immediately retrieve the property values, lazy loading and explicit loading are also both known as *deferred loading*.</span></span>

<span data-ttu-id="f8e54-147">Il caricamento lazy è il comportamento predefinito per un contesto dell'oggetto generato dalla finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-147">Lazy loading is the default behavior for an object context that has been generated by the designer.</span></span> <span data-ttu-id="f8e54-148">Se si apre il file *SchoolModel.designer.cs* che definisce la classe del contesto dell'oggetto, sono disponibili tre metodi del costruttore, ognuno dei quali include l'istruzione seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-148">If you open the *SchoolModel.Designer.cs* file that defines the object context class, you'll find three constructor methods, and each of them includes the following statement:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="f8e54-149">In generale, se si sa che sono necessari dati correlati per ogni entità recuperata, il caricamento eager offre le migliori prestazioni, perché una singola query inviata al database è in genere più efficiente rispetto alle query separate per ogni entità recuperata.</span><span class="sxs-lookup"><span data-stu-id="f8e54-149">In general, if you know you need related data for every entity retrieved, eager loading offers the best performance, because a single query sent to the database is typically more efficient than separate queries for each entity retrieved.</span></span> <span data-ttu-id="f8e54-150">D'altra parte, se è necessario accedere alle proprietà di navigazione di un'entità solo raramente o solo per un piccolo set di entità, il caricamento lazy o il caricamento esplicito possono essere più efficienti, perché il caricamento eager potrebbe recuperare più dati del necessario.</span><span class="sxs-lookup"><span data-stu-id="f8e54-150">On the other hand, if you need to access an entity's navigation properties only infrequently or only for a small set of the entities, lazy loading or explicit loading may be more efficient, because eager loading would retrieve more data than you need.</span></span>

<span data-ttu-id="f8e54-151">In un'applicazione Web, il caricamento lazy può essere comunque di un valore relativamente ridotto, perché le azioni dell'utente che influiscono sulla necessità di dati correlati avvengono nel browser, che non ha una connessione al contesto dell'oggetto che ha eseguito il rendering della pagina.</span><span class="sxs-lookup"><span data-stu-id="f8e54-151">In a web application, lazy loading may be of relatively little value anyway, because user actions that affect the need for related data take place in the browser, which has no connection to the object context that rendered the page.</span></span> <span data-ttu-id="f8e54-152">D'altra parte, quando si esegue l'associazione di un controllo, in genere si conoscono i dati necessari ed è quindi consigliabile scegliere il caricamento eager o il caricamento posticipato in base a quanto è appropriato in ogni scenario.</span><span class="sxs-lookup"><span data-stu-id="f8e54-152">On the other hand, when you databind a control, you typically know what data you need, and so it's generally best to choose eager loading or deferred loading based on what's appropriate in each scenario.</span></span>

<span data-ttu-id="f8e54-153">Inoltre, un controllo con associazione a oggetti può utilizzare un oggetto entità dopo che il contesto dell'oggetto è stato eliminato.</span><span class="sxs-lookup"><span data-stu-id="f8e54-153">In addition, a databound control might use an entity object after the object context is disposed.</span></span> <span data-ttu-id="f8e54-154">In tal caso, un tentativo di caricamento lazy di una proprietà di navigazione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="f8e54-154">In that case, an attempt to lazy-load a navigation property would fail.</span></span> <span data-ttu-id="f8e54-155">Il messaggio di errore ricevuto è chiaro: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span><span class="sxs-lookup"><span data-stu-id="f8e54-155">The error message you receive is clear: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span></span>

<span data-ttu-id="f8e54-156">Per impostazione predefinita, il controllo `EntityDataSource` Disabilita il caricamento lazy.</span><span class="sxs-lookup"><span data-stu-id="f8e54-156">The `EntityDataSource` control disables lazy loading by default.</span></span> <span data-ttu-id="f8e54-157">Per il controllo `ObjectDataSource` che si sta usando per l'esercitazione corrente (o se si accede al contesto dell'oggetto dal codice della pagina), è possibile disabilitare il caricamento lazy per impostazione predefinita in diversi modi.</span><span class="sxs-lookup"><span data-stu-id="f8e54-157">For the `ObjectDataSource` control that you're using for the current tutorial (or if you access the object context from page code), there are several ways you can make lazy loading disabled by default.</span></span> <span data-ttu-id="f8e54-158">È possibile disabilitarla quando si crea un'istanza di un contesto dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="f8e54-158">You can disable it when you instantiate an object context.</span></span> <span data-ttu-id="f8e54-159">Ad esempio, è possibile aggiungere la riga seguente al metodo del costruttore della classe `SchoolRepository`:</span><span class="sxs-lookup"><span data-stu-id="f8e54-159">For example, you can add the following line to the constructor method of the `SchoolRepository` class:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="f8e54-160">Per l'applicazione Contoso University, il contesto dell'oggetto Disabilita automaticamente il caricamento lazy in modo che non sia necessario impostare questa proprietà ogni volta che viene creata un'istanza di un contesto.</span><span class="sxs-lookup"><span data-stu-id="f8e54-160">For the Contoso University application, you'll make the object context automatically disable lazy loading so that this property doesn't have to be set whenever a context is instantiated.</span></span>

<span data-ttu-id="f8e54-161">Aprire il modello di dati *SchoolModel. edmx* , fare clic sull'area di progettazione e quindi nel riquadro Proprietà impostare la proprietà **Lazy Loading Enabled** su `False`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-161">Open the *SchoolModel.edmx* data model, click the design surface, and then in the properties pane set the **Lazy Loading Enabled** property to `False`.</span></span> <span data-ttu-id="f8e54-162">Salvare e chiudere il modello di dati.</span><span class="sxs-lookup"><span data-stu-id="f8e54-162">Save and close the data model.</span></span>

<span data-ttu-id="f8e54-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

## <a name="managing-view-state"></a><span data-ttu-id="f8e54-164">Gestione dello stato di visualizzazione</span><span class="sxs-lookup"><span data-stu-id="f8e54-164">Managing View State</span></span>

<span data-ttu-id="f8e54-165">Per fornire funzionalità di aggiornamento, una pagina Web ASP.NET deve archiviare i valori delle proprietà originali di un'entità quando viene eseguito il rendering di una pagina.</span><span class="sxs-lookup"><span data-stu-id="f8e54-165">In order to provide update functionality, an ASP.NET web page must store the original property values of an entity when a page is rendered.</span></span> <span data-ttu-id="f8e54-166">Durante l'elaborazione del postback, il controllo può creare nuovamente lo stato originale dell'entità e chiamare il metodo di `Attach` dell'entità prima di applicare le modifiche e chiamare il metodo `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-166">During postback processing the control can re-create the original state of the entity and call the entity's `Attach` method before applying changes and calling the `SaveChanges` method.</span></span> <span data-ttu-id="f8e54-167">Per impostazione predefinita, i controlli dati di ASP.NET Web Form utilizzano lo stato di visualizzazione per archiviare i valori originali.</span><span class="sxs-lookup"><span data-stu-id="f8e54-167">By default, ASP.NET Web Forms data controls use view state to store the original values.</span></span> <span data-ttu-id="f8e54-168">Lo stato di visualizzazione può tuttavia influire sulle prestazioni, perché viene archiviato in campi nascosti che possono aumentare notevolmente le dimensioni della pagina inviata al e dal browser.</span><span class="sxs-lookup"><span data-stu-id="f8e54-168">However, view state can affect performance, because it's stored in hidden fields that can substantially increase the size of the page that's sent to and from the browser.</span></span>

<span data-ttu-id="f8e54-169">Le tecniche per la gestione dello stato di visualizzazione, o alternative, ad esempio lo stato della sessione, non sono univoche per il Entity Framework, quindi questa esercitazione non viene illustrata in dettaglio in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="f8e54-169">Techniques for managing view state, or alternatives such as session state, aren't unique to the Entity Framework, so this tutorial doesn't go into this topic in detail.</span></span> <span data-ttu-id="f8e54-170">Per ulteriori informazioni, vedere i collegamenti alla fine dell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-170">For more information see the links at the end of the tutorial.</span></span>

<span data-ttu-id="f8e54-171">Tuttavia, la versione 4 di ASP.NET fornisce un nuovo modo per lavorare con lo stato di visualizzazione che tutti gli sviluppatori ASP.NET di applicazioni Web Form devono conoscere: la proprietà `ViewStateMode`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-171">However, version 4 of ASP.NET provides a new way of working with view state that every ASP.NET developer of Web Forms applications should be aware of: the `ViewStateMode` property.</span></span> <span data-ttu-id="f8e54-172">Questa nuova proprietà può essere impostata a livello di pagina o di controllo e consente di disabilitare lo stato di visualizzazione per impostazione predefinita per una pagina e di abilitarla solo per i controlli che lo richiedono.</span><span class="sxs-lookup"><span data-stu-id="f8e54-172">This new property can be set at the page or control level, and it enables you to disable view state by default for a page and enable it only for controls that need it.</span></span>

<span data-ttu-id="f8e54-173">Per le applicazioni in cui le prestazioni sono importanti, è consigliabile disabilitare sempre lo stato di visualizzazione a livello di pagina e abilitarlo solo per i controlli che lo richiedono.</span><span class="sxs-lookup"><span data-stu-id="f8e54-173">For applications where performance is critical, a good practice is to always disable view state at the page level and enable it only for controls that require it.</span></span> <span data-ttu-id="f8e54-174">La dimensione dello stato di visualizzazione nelle pagine di Contoso University non verrà sostanzialmente ridotta da questo metodo, ma per verificarne il funzionamento, verrà eseguita per la pagina *Instructors. aspx* .</span><span class="sxs-lookup"><span data-stu-id="f8e54-174">The size of view state in the Contoso University pages wouldn't be substantially decreased by this method, but to see how it works, you'll do it for the *Instructors.aspx* page.</span></span> <span data-ttu-id="f8e54-175">Questa pagina contiene molti controlli, incluso un controllo `Label` con lo stato di visualizzazione disabilitato.</span><span class="sxs-lookup"><span data-stu-id="f8e54-175">That page contains many controls, including a `Label` control that has view state disabled.</span></span> <span data-ttu-id="f8e54-176">Nessuno dei controlli in questa pagina deve avere lo stato di visualizzazione abilitato.</span><span class="sxs-lookup"><span data-stu-id="f8e54-176">None of the controls on this page actually need to have view state enabled.</span></span> <span data-ttu-id="f8e54-177">(La proprietà `DataKeyNames` del controllo `GridView` specifica lo stato che deve essere mantenuto tra i postback, ma questi valori vengono mantenuti nello stato del controllo, che non è influenzato dalla proprietà `ViewStateMode`).</span><span class="sxs-lookup"><span data-stu-id="f8e54-177">(The `DataKeyNames` property of the `GridView` control specifies state that must be maintained between postbacks, but these values are kept in control state, which isn't affected by the `ViewStateMode` property.)</span></span>

<span data-ttu-id="f8e54-178">La direttiva `Page` e il markup del controllo `Label` sono attualmente simili all'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-178">The `Page` directive and `Label` control markup currently resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="f8e54-179">Apportare le modifiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="f8e54-179">Make the following changes:</span></span>

- <span data-ttu-id="f8e54-180">Aggiungere `ViewStateMode="Disabled"` alla direttiva `Page`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-180">Add `ViewStateMode="Disabled"` to the `Page` directive.</span></span>
- <span data-ttu-id="f8e54-181">Rimuovere `ViewStateMode="Disabled"` dal controllo `Label`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-181">Remove `ViewStateMode="Disabled"` from the `Label` control.</span></span>

<span data-ttu-id="f8e54-182">Il markup è ora simile all'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-182">The markup now resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="f8e54-183">Lo stato di visualizzazione è ora disabilitato per tutti i controlli.</span><span class="sxs-lookup"><span data-stu-id="f8e54-183">View state is now disabled for all controls.</span></span> <span data-ttu-id="f8e54-184">Se in un secondo momento si aggiunge un controllo che deve usare lo stato di visualizzazione, è sufficiente includere l'attributo `ViewStateMode="Enabled"` per quel controllo.</span><span class="sxs-lookup"><span data-stu-id="f8e54-184">If you later add a control that does need to use view state, all you need to do is include the `ViewStateMode="Enabled"` attribute for that control.</span></span>

## <a name="using-the-notracking-merge-option"></a><span data-ttu-id="f8e54-185">Utilizzo dell'opzione di merge NoTracking</span><span class="sxs-lookup"><span data-stu-id="f8e54-185">Using The NoTracking Merge Option</span></span>

<span data-ttu-id="f8e54-186">Quando un contesto dell'oggetto recupera le righe del database e crea oggetti entità che li rappresentano, per impostazione predefinita tiene anche traccia degli oggetti entità utilizzando il relativo gestore dello stato dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="f8e54-186">When an object context retrieves database rows and creates entity objects that represent them, by default it also tracks those entity objects using its object state manager.</span></span> <span data-ttu-id="f8e54-187">Questi dati di rilevamento agiscono come una cache e vengono usati quando si aggiorna un'entità.</span><span class="sxs-lookup"><span data-stu-id="f8e54-187">This tracking data acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="f8e54-188">Poiché un'applicazione Web in genere dispone di istanze di contesto degli oggetti di breve durata, le query restituiscono spesso dati che non devono essere rilevati, perché il contesto dell'oggetto che li legge verrà eliminato prima che le entità lette vengano riutilizzate o aggiornate.</span><span class="sxs-lookup"><span data-stu-id="f8e54-188">Because a web application typically has short-lived object context instances, queries often return data that doesn't need to be tracked, because the object context that reads them will be disposed before any of the entities it reads are used again or updated.</span></span>

<span data-ttu-id="f8e54-189">Nella Entity Framework è possibile specificare se il contesto dell'oggetto tiene traccia degli oggetti entità impostando un' *opzione di Unione*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-189">In the Entity Framework, you can specify whether the object context tracks entity objects by setting a *merge option*.</span></span> <span data-ttu-id="f8e54-190">È possibile impostare l'opzione di Unione per le singole query o per i set di entità.</span><span class="sxs-lookup"><span data-stu-id="f8e54-190">You can set the merge option for individual queries or for entity sets.</span></span> <span data-ttu-id="f8e54-191">Se viene impostata per un set di entità, significa che si sta impostando l'opzione di merge predefinita per tutte le query create per il set di entità.</span><span class="sxs-lookup"><span data-stu-id="f8e54-191">If you set it for an entity set, that means that you're setting the default merge option for all queries that are created for that entity set.</span></span>

<span data-ttu-id="f8e54-192">Per l'applicazione Contoso University, il rilevamento non è necessario per i set di entità a cui si accede dal repository, quindi è possibile impostare l'opzione di Unione su `NoTracking` per tali set di entità quando si crea un'istanza del contesto dell'oggetto nella classe del repository.</span><span class="sxs-lookup"><span data-stu-id="f8e54-192">For the Contoso University application, tracking isn't needed for any of the entity sets that you access from the repository, so you can set the merge option to `NoTracking` for those entity sets when you instantiate the object context in the repository class.</span></span> <span data-ttu-id="f8e54-193">Si noti che in questa esercitazione l'impostazione dell'opzione di merge non avrà un effetto significativo sulle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-193">(Note that in this tutorial, setting the merge option won't have a noticeable effect on the application's performance.</span></span> <span data-ttu-id="f8e54-194">È probabile che l'opzione `NoTracking` faccia un miglioramento delle prestazioni osservabile solo in alcuni scenari con volumi elevati di dati.</span><span class="sxs-lookup"><span data-stu-id="f8e54-194">The `NoTracking` option is likely to make an observable performance improvement only in certain high-data-volume scenarios.)</span></span>

<span data-ttu-id="f8e54-195">Nella cartella DAL aprire il file *SchoolRepository.cs* e aggiungere un metodo del costruttore che imposta l'opzione di merge per i set di entità a cui accede il repository:</span><span class="sxs-lookup"><span data-stu-id="f8e54-195">In the DAL folder, open the *SchoolRepository.cs* file and add a constructor method that sets the merge option for the entity sets that the repository accesses:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

## <a name="pre-compiling-linq-queries"></a><span data-ttu-id="f8e54-196">Pre-compilazione di query LINQ</span><span class="sxs-lookup"><span data-stu-id="f8e54-196">Pre-Compiling LINQ Queries</span></span>

<span data-ttu-id="f8e54-197">La prima volta che il Entity Framework esegue una query Entity SQL all'interno del ciclo di vita di un'istanza di `ObjectContext` specificata, la compilazione della query richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="f8e54-197">The first time that the Entity Framework executes an Entity SQL query within the life of a given `ObjectContext` instance, it takes some time to compile the query.</span></span> <span data-ttu-id="f8e54-198">Il risultato della compilazione viene memorizzato nella cache, il che significa che le successive esecuzioni della query sono molto più veloci.</span><span class="sxs-lookup"><span data-stu-id="f8e54-198">The result of compilation is cached, which means that subsequent executions of the query are much quicker.</span></span> <span data-ttu-id="f8e54-199">Le query LINQ seguono un modello simile, ad eccezione del fatto che parte del lavoro necessario per compilare la query viene eseguita ogni volta che viene eseguita la query.</span><span class="sxs-lookup"><span data-stu-id="f8e54-199">LINQ queries follow a similar pattern, except that some of the work required to compile the query is done every time the query is executed.</span></span> <span data-ttu-id="f8e54-200">In altre parole, per le query LINQ, per impostazione predefinita non tutti i risultati della compilazione vengono memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="f8e54-200">In other words, for LINQ queries, by default not all of the results of compilation are cached.</span></span>

<span data-ttu-id="f8e54-201">Se si dispone di una query LINQ che si prevede di eseguire ripetutamente durante il ciclo di vita di un contesto dell'oggetto, è possibile scrivere codice che causa la memorizzazione nella cache di tutti i risultati della compilazione la prima volta che si esegue la query LINQ.</span><span class="sxs-lookup"><span data-stu-id="f8e54-201">If you have a LINQ query that you expect to run repeatedly in the life of an object context, you can write code that causes all of the results of compilation to be cached the first time the LINQ query is run.</span></span>

<span data-ttu-id="f8e54-202">Come esempio, si eseguirà questa operazione per due metodi `Get` nella classe `SchoolRepository`, uno dei quali non accetta parametri (il metodo `GetInstructorNames`) e uno che richiede un parametro (il metodo `GetDepartmentsByAdministrator`).</span><span class="sxs-lookup"><span data-stu-id="f8e54-202">As an illustration, you'll do this for two `Get` methods in the `SchoolRepository` class, one of which doesn't take any parameters (the `GetInstructorNames` method), and one that does require a parameter (the `GetDepartmentsByAdministrator` method).</span></span> <span data-ttu-id="f8e54-203">Questi metodi non sono attualmente necessari per la compilazione perché non sono query LINQ:</span><span class="sxs-lookup"><span data-stu-id="f8e54-203">These methods as they stand now actually don't need to be compiled because they aren't LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

<span data-ttu-id="f8e54-204">Tuttavia, per poter provare le query compilate, si procederà come se fossero scritte come le query LINQ seguenti:</span><span class="sxs-lookup"><span data-stu-id="f8e54-204">However, so that you can try out compiled queries, you'll proceed as if these had been written as the following LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="f8e54-205">È possibile modificare il codice in questi metodi in base a quanto illustrato in precedenza ed eseguire l'applicazione per verificarne il funzionamento prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="f8e54-205">You could change the code in these methods to what's shown above and run the application to verify that it works before continuing.</span></span> <span data-ttu-id="f8e54-206">Tuttavia, le istruzioni seguenti consentono di creare versioni precompilate.</span><span class="sxs-lookup"><span data-stu-id="f8e54-206">But the following instructions jump right into creating pre-compiled versions of them.</span></span>

<span data-ttu-id="f8e54-207">Creare un file di classe nella cartella *dal* , denominarlo *SchoolEntities.cs*e sostituire il codice esistente con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-207">Create a class file in the *DAL* folder, name it *SchoolEntities.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="f8e54-208">Questo codice crea una classe parziale che estende la classe del contesto dell'oggetto generata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f8e54-208">This code creates a partial class that extends the automatically generated object context class.</span></span> <span data-ttu-id="f8e54-209">La classe parziale include due query LINQ compilate usando il metodo `Compile` della classe `CompiledQuery`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-209">The partial class includes two compiled LINQ queries using the `Compile` method of the `CompiledQuery` class.</span></span> <span data-ttu-id="f8e54-210">Vengono inoltre creati metodi che è possibile utilizzare per chiamare le query.</span><span class="sxs-lookup"><span data-stu-id="f8e54-210">It also creates methods that you can use to call the queries.</span></span> <span data-ttu-id="f8e54-211">Salvare e chiudere il file.</span><span class="sxs-lookup"><span data-stu-id="f8e54-211">Save and close this file.</span></span>

<span data-ttu-id="f8e54-212">Successivamente, in *SchoolRepository.cs*modificare i metodi `GetInstructorNames` e `GetDepartmentsByAdministrator` esistenti nella classe repository in modo che chiamino le query compilate:</span><span class="sxs-lookup"><span data-stu-id="f8e54-212">Next, in *SchoolRepository.cs*, change the existing `GetInstructorNames` and `GetDepartmentsByAdministrator` methods in the repository class so that they call the compiled queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

<span data-ttu-id="f8e54-213">Eseguire la pagina *Departments. aspx* per verificare che funzioni come in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f8e54-213">Run the *Departments.aspx* page to verify that it works as it did before.</span></span> <span data-ttu-id="f8e54-214">Il metodo `GetInstructorNames` viene chiamato per popolare l'elenco a discesa amministratore e viene chiamato il metodo `GetDepartmentsByAdministrator` quando si fa clic su **Aggiorna** per verificare che nessun istruttore sia un amministratore di più di un reparto.</span><span class="sxs-lookup"><span data-stu-id="f8e54-214">The `GetInstructorNames` method is called in order to populate the administrator drop-down list, and the `GetDepartmentsByAdministrator` method is called when you click **Update** in order to verify that no instructor is an administrator of more than one department.</span></span>

<span data-ttu-id="f8e54-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

<span data-ttu-id="f8e54-216">Sono state eseguite query pre-compilate nell'applicazione Contoso University solo per vedere come eseguire questa operazione e non per migliorare significativamente le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-216">You've pre-compiled queries in the Contoso University application only to see how to do it, not because it would measurably improve performance.</span></span> <span data-ttu-id="f8e54-217">La precompilazione delle query LINQ consente di aggiungere un livello di complessità al codice. Assicurarsi quindi di eseguire questa operazione solo per le query che rappresentano effettivamente colli di bottiglia delle prestazioni nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-217">Pre-compiling LINQ queries does add a level of complexity to your code, so make sure you do it only for queries that actually represent performance bottlenecks in your application.</span></span>

## <a name="examining-queries-sent-to-the-database"></a><span data-ttu-id="f8e54-218">Analisi delle query inviate al database</span><span class="sxs-lookup"><span data-stu-id="f8e54-218">Examining Queries Sent to the Database</span></span>

<span data-ttu-id="f8e54-219">Quando si esaminano i problemi di prestazioni, a volte è utile individuare i comandi SQL esatti inviati dal Entity Framework al database.</span><span class="sxs-lookup"><span data-stu-id="f8e54-219">When you're investigating performance issues, sometimes it's helpful to know the exact SQL commands that the Entity Framework is sending to the database.</span></span> <span data-ttu-id="f8e54-220">Se si lavora con un oggetto `IQueryable`, a tale scopo è possibile usare il metodo `ToTraceString`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-220">If you're working with an `IQueryable` object, one way to do this is to use the `ToTraceString` method.</span></span>

<span data-ttu-id="f8e54-221">In *SchoolRepository.cs*modificare il codice nel metodo `GetDepartmentsByName` in modo che corrisponda all'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-221">In *SchoolRepository.cs*, change the code in the `GetDepartmentsByName` method to match the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.cs)]

<span data-ttu-id="f8e54-222">È necessario eseguire il cast della variabile `departments` a un tipo di `ObjectQuery` solo perché il metodo `Where` alla fine della riga precedente crea un oggetto `IQueryable`; senza il metodo `Where`, il cast non è necessario.</span><span class="sxs-lookup"><span data-stu-id="f8e54-222">The `departments` variable must be cast to an `ObjectQuery` type only because the `Where` method at the end of the preceding line creates an `IQueryable` object; without the `Where` method, the cast would not be necessary.</span></span>

<span data-ttu-id="f8e54-223">Impostare un punto di interruzione nella riga `return`, quindi eseguire la pagina *repartis. aspx* nel debugger.</span><span class="sxs-lookup"><span data-stu-id="f8e54-223">Set a breakpoint on the `return` line, and then run the *Departments.aspx* page in the debugger.</span></span> <span data-ttu-id="f8e54-224">Quando si raggiunge il punto di interruzione, esaminare la variabile `commandText` nella finestra variabili **locali** e utilizzare il Visualizzatore di testo (la lente di ingrandimento nella colonna **valore** ) per visualizzare il relativo valore nella finestra **Visualizzatore di testo** .</span><span class="sxs-lookup"><span data-stu-id="f8e54-224">When you hit the breakpoint, examine the `commandText` variable in the **Locals** window and use the text visualizer (the magnifying glass in the **Value** column) to display its value in the **Text Visualizer** window.</span></span> <span data-ttu-id="f8e54-225">È possibile visualizzare l'intero comando SQL risultante dal codice seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-225">You can see the entire SQL command that results from this code:</span></span>

<span data-ttu-id="f8e54-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="f8e54-227">In alternativa, la funzionalità IntelliTrace di Visual Studio Ultimate consente di visualizzare i comandi SQL generati dal Entity Framework che non richiede la modifica del codice o anche l'impostazione di un punto di interruzione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-227">As an alternative, the IntelliTrace feature in Visual Studio Ultimate provides a way to view SQL commands generated by the Entity Framework that doesn't require you to change your code or even set a breakpoint.</span></span>

> [!NOTE]
> <span data-ttu-id="f8e54-228">È possibile eseguire le procedure seguenti solo se si dispone di Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="f8e54-228">You can perform the following procedures only if you have Visual Studio Ultimate.</span></span>

<span data-ttu-id="f8e54-229">Ripristinare il codice originale nel metodo `GetDepartmentsByName` e quindi eseguire la pagina *Departments. aspx* nel debugger.</span><span class="sxs-lookup"><span data-stu-id="f8e54-229">Restore the original code in the `GetDepartmentsByName` method, and then run the *Departments.aspx* page in the debugger.</span></span>

<span data-ttu-id="f8e54-230">In Visual Studio selezionare il menu **debug** , **IntelliTrace**, quindi **eventi IntelliTrace**.</span><span class="sxs-lookup"><span data-stu-id="f8e54-230">In Visual Studio, select the **Debug** menu, then **IntelliTrace**, and then **IntelliTrace Events**.</span></span>

<span data-ttu-id="f8e54-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="f8e54-232">Nella finestra **IntelliTrace** fare clic su **Interrompi tutto**.</span><span class="sxs-lookup"><span data-stu-id="f8e54-232">In the **IntelliTrace** window, click **Break All**.</span></span>

<span data-ttu-id="f8e54-233">[![IMAGE12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="f8e54-234">Nella finestra **IntelliTrace** viene visualizzato un elenco di eventi recenti:</span><span class="sxs-lookup"><span data-stu-id="f8e54-234">The **IntelliTrace** window displays a list of recent events:</span></span>

<span data-ttu-id="f8e54-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="f8e54-236">Fare clic sulla riga **ADO.NET** .</span><span class="sxs-lookup"><span data-stu-id="f8e54-236">Click the **ADO.NET** line.</span></span> <span data-ttu-id="f8e54-237">Si espande per visualizzare il testo del comando:</span><span class="sxs-lookup"><span data-stu-id="f8e54-237">It expands to show you the command text:</span></span>

<span data-ttu-id="f8e54-238">[![image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="f8e54-239">È possibile copiare l'intera stringa di testo del comando negli Appunti dalla finestra **variabili locali** .</span><span class="sxs-lookup"><span data-stu-id="f8e54-239">You can copy the entire command text string to the clipboard from the **Locals** window.</span></span>

<span data-ttu-id="f8e54-240">Si supponga di utilizzare un database con più tabelle, relazioni e colonne rispetto alla semplice `School` database.</span><span class="sxs-lookup"><span data-stu-id="f8e54-240">Suppose you were working with a database with more tables, relationships, and columns than the simple `School` database.</span></span> <span data-ttu-id="f8e54-241">Si potrebbe notare che una query che raccoglie tutte le informazioni necessarie in una singola istruzione `Select` contenente più clausole `Join` diventa troppo complessa per funzionare in modo efficiente.</span><span class="sxs-lookup"><span data-stu-id="f8e54-241">You might find that a query that gathers all the information you need in a single `Select` statement containing multiple `Join` clauses becomes too complex to work efficiently.</span></span> <span data-ttu-id="f8e54-242">In tal caso, è possibile passare dal caricamento eager al caricamento esplicito per semplificare la query.</span><span class="sxs-lookup"><span data-stu-id="f8e54-242">In that case you can switch from eager loading to explicit loading to simplify the query.</span></span>

<span data-ttu-id="f8e54-243">Provare ad esempio a modificare il codice nel metodo `GetDepartmentsByName` in *SchoolRepository.cs*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-243">For example, try changing the code in the `GetDepartmentsByName` method in *SchoolRepository.cs*.</span></span> <span data-ttu-id="f8e54-244">Attualmente in questo metodo è presente una query oggetto con metodi `Include` per le proprietà di navigazione `Person` e `Courses`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-244">Currently in that method you have an object query that has `Include` methods for the `Person` and `Courses` navigation properties.</span></span> <span data-ttu-id="f8e54-245">Sostituire l'istruzione `return` con il codice che esegue il caricamento esplicito, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-245">Replace the `return` statement with code that performs explicit loading, as shown in the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="f8e54-246">Eseguire la pagina *repartitions. aspx* nel debugger e controllare di nuovo la finestra **IntelliTrace** come in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f8e54-246">Run the *Departments.aspx* page in the debugger and check the **IntelliTrace** window again as you did before.</span></span> <span data-ttu-id="f8e54-247">A questo punto, dove era presente una singola query prima, viene visualizzata una sequenza molto lungo.</span><span class="sxs-lookup"><span data-stu-id="f8e54-247">Now, where there was a single query before, you see a long sequence of them.</span></span>

<span data-ttu-id="f8e54-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="f8e54-249">Fare clic sulla prima riga di **ADO.NET** per vedere cosa è accaduto alla query complessa visualizzata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f8e54-249">Click the first **ADO.NET** line to see what has happened to the complex query you viewed earlier.</span></span>

<span data-ttu-id="f8e54-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

<span data-ttu-id="f8e54-251">La query dai reparti è diventata una semplice query di `Select` senza clausola `Join`, ma è seguita da query separate che recuperano i corsi correlati e un amministratore, usando un set di due query per ogni reparto restituito dalla query originale.</span><span class="sxs-lookup"><span data-stu-id="f8e54-251">The query from Departments has become a simple `Select` query with no `Join` clause, but it's followed by separate queries that retrieve related courses and an administrator, using a set of two queries for each department returned by the original query.</span></span>

> [!NOTE]
> <span data-ttu-id="f8e54-252">Se si lascia abilitato il caricamento lazy, il modello visualizzato qui, con la stessa query ripetuta più volte, potrebbe risultare dal caricamento lazy.</span><span class="sxs-lookup"><span data-stu-id="f8e54-252">If you leave lazy loading enabled, the pattern you see here, with the same query repeated many times, might result from lazy loading.</span></span> <span data-ttu-id="f8e54-253">Un modello che in genere si vuole evitare è il caricamento lazy dei dati correlati per ogni riga della tabella primaria.</span><span class="sxs-lookup"><span data-stu-id="f8e54-253">A pattern that you typically want to avoid is lazy-loading related data for every row of the primary table.</span></span> <span data-ttu-id="f8e54-254">A meno che non sia stato verificato che una singola query di join sia troppo complessa per essere efficiente, in genere è possibile migliorare le prestazioni in questi casi cambiando la query primaria per usare il caricamento eager.</span><span class="sxs-lookup"><span data-stu-id="f8e54-254">Unless you've verified that a single join query is too complex to be efficient, you'd typically be able to improve performance in such cases by changing the primary query to use eager loading.</span></span>

## <a name="pre-generating-views"></a><span data-ttu-id="f8e54-255">Visualizzazione pre-generazione</span><span class="sxs-lookup"><span data-stu-id="f8e54-255">Pre-Generating Views</span></span>

<span data-ttu-id="f8e54-256">Quando un oggetto `ObjectContext` viene creato per la prima volta in un nuovo dominio applicazione, il Entity Framework genera un set di classi che utilizza per accedere al database.</span><span class="sxs-lookup"><span data-stu-id="f8e54-256">When an `ObjectContext` object is first created in a new application domain, the Entity Framework generates a set of classes that it uses to access the database.</span></span> <span data-ttu-id="f8e54-257">Queste classi sono denominate *viste*e, se si dispone di un modello di dati di grandi dimensioni, la generazione di queste viste può ritardare la risposta del sito Web alla prima richiesta di una pagina dopo l'inizializzazione di un nuovo dominio applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-257">These classes are called *views*, and if you have a very large data model, generating these views can delay the web site's response to the first request for a page after a new application domain is initialized.</span></span> <span data-ttu-id="f8e54-258">È possibile ridurre questo ritardo della prima richiesta creando le visualizzazioni in fase di compilazione anziché in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-258">You can reduce this first-request delay by creating the views at compile time rather than at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="f8e54-259">Se l'applicazione non dispone di un modello di dati molto grande o se dispone di un modello di dati di grandi dimensioni ma non si è interessati a un problema di prestazioni che influisca solo sulla prima richiesta di pagina dopo il riciclaggio di IIS, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-259">If your application doesn't have an extremely large data model, or if it does have a large data model but you aren't concerned about a performance problem that affects only the very first page request after IIS is recycled, you can skip this section.</span></span> <span data-ttu-id="f8e54-260">La creazione della visualizzazione non viene eseguita ogni volta che si crea un'istanza di un oggetto `ObjectContext`, perché le visualizzazioni vengono memorizzate nella cache nel dominio applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8e54-260">View creation doesn't happen every time you instantiate an `ObjectContext` object, because the views are cached in the application domain.</span></span> <span data-ttu-id="f8e54-261">Pertanto, a meno che non si ricicli spesso l'applicazione in IIS, poche richieste di pagina possono trarre vantaggio dalle visualizzazioni pregenerate.</span><span class="sxs-lookup"><span data-stu-id="f8e54-261">Therefore, unless you're frequently recycling your application in IIS, very few page requests would benefit from pre-generated views.</span></span>

<span data-ttu-id="f8e54-262">È possibile pregenerare le visualizzazioni utilizzando lo strumento da riga di comando *EdmGen. exe* o un modello T4 ( *Text Template Transformation Toolkit* ).</span><span class="sxs-lookup"><span data-stu-id="f8e54-262">You can pre-generate views using the *EdmGen.exe* command-line tool or by using a *Text Template Transformation Toolkit* (T4) template.</span></span> <span data-ttu-id="f8e54-263">In questa esercitazione verrà usato un modello T4.</span><span class="sxs-lookup"><span data-stu-id="f8e54-263">In this tutorial you'll use a T4 template.</span></span>

<span data-ttu-id="f8e54-264">Nella cartella *dal* aggiungere un file usando il modello di **modello di testo** (si trova sotto il **nodo Generale** nell'elenco **modelli installati** ) e denominarlo *SchoolModel.views.TT*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-264">In the *DAL* folder, add a file using the **Text Template** template (it's under the **General** node in the **Installed Templates** list), and name it *SchoolModel.Views.tt*.</span></span> <span data-ttu-id="f8e54-265">Sostituire il codice esistente nel file con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="f8e54-265">Replace the existing code in the file with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

<span data-ttu-id="f8e54-266">Questo codice genera visualizzazioni per un file con estensione *edmx* che si trova nella stessa cartella del modello e con lo stesso nome del file modello.</span><span class="sxs-lookup"><span data-stu-id="f8e54-266">This code generates views for an *.edmx* file that's located in the same folder as the template and that has the same name as the template file.</span></span> <span data-ttu-id="f8e54-267">Se, ad esempio, il file modello è denominato *SchoolModel.views.TT*, cercherà un file del modello di dati denominato *SchoolModel. edmx*.</span><span class="sxs-lookup"><span data-stu-id="f8e54-267">For example, if your template file is named *SchoolModel.Views.tt*, it will look for a data model file named *SchoolModel.edmx*.</span></span>

<span data-ttu-id="f8e54-268">Salvare il file, quindi fare clic con il pulsante destro del mouse sul file in **Esplora soluzioni** e scegliere **Esegui strumento personalizzato**.</span><span class="sxs-lookup"><span data-stu-id="f8e54-268">Save the file, then right-click the file in **Solution Explorer** and select **Run Custom Tool**.</span></span>

<span data-ttu-id="f8e54-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="f8e54-270">Visual Studio genera un file di codice che crea le visualizzazioni, denominato *SchoolModel.views.cs* in base al modello.</span><span class="sxs-lookup"><span data-stu-id="f8e54-270">Visual Studio generates a code file that creates the views, which is named *SchoolModel.Views.cs* based on the template.</span></span> <span data-ttu-id="f8e54-271">Si potrebbe notare che il file di codice viene generato anche prima di selezionare **Esegui strumento personalizzato**, non appena si salva il file modello.</span><span class="sxs-lookup"><span data-stu-id="f8e54-271">(You might have noticed that the code file is generated even before you select **Run Custom Tool**, as soon as you save the template file.)</span></span>

<span data-ttu-id="f8e54-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="f8e54-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="f8e54-273">È ora possibile eseguire l'applicazione e verificare che funzioni come in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f8e54-273">You can now run the application and verify that it works as it did before.</span></span>

<span data-ttu-id="f8e54-274">Per ulteriori informazioni sulle visualizzazioni generate in precedenza, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="f8e54-274">For more information about pre-generated views, see the following resources:</span></span>

- <span data-ttu-id="f8e54-275">[Procedura: pre-generare viste per migliorare le prestazioni delle query](https://msdn.microsoft.com/library/bb896240.aspx) nel sito Web MSDN.</span><span class="sxs-lookup"><span data-stu-id="f8e54-275">[How to: Pre-Generate Views to Improve Query Performance](https://msdn.microsoft.com/library/bb896240.aspx) on the MSDN web site.</span></span> <span data-ttu-id="f8e54-276">Viene illustrato come utilizzare lo strumento da riga di comando `EdmGen.exe` per generare in modo preliminare le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-276">Explains how to use the `EdmGen.exe` command-line tool to pre-generate views.</span></span>
- <span data-ttu-id="f8e54-277">[Isolamento delle prestazioni con le viste precompilate/generate in precedenza nella Entity Framework 4 nel](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) Blog del team di consulenza clienti di Windows Server AppFabric.</span><span class="sxs-lookup"><span data-stu-id="f8e54-277">[Isolating Performance with Precompiled/Pre-generated Views in the Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) on the Windows Server AppFabric Customer Advisory Team blog.</span></span>

<span data-ttu-id="f8e54-278">Questa operazione completa l'introduzione al miglioramento delle prestazioni in un'applicazione Web ASP.NET che usa la Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f8e54-278">This completes the introduction to improving performance in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="f8e54-279">Per altre informazioni, vedere le seguenti risorse:</span><span class="sxs-lookup"><span data-stu-id="f8e54-279">For more information, see the following resources:</span></span>

- <span data-ttu-id="f8e54-280">[Considerazioni sulle prestazioni (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) sul sito Web MSDN.</span><span class="sxs-lookup"><span data-stu-id="f8e54-280">[Performance Considerations (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) on the MSDN web site.</span></span>
- <span data-ttu-id="f8e54-281">[Post correlati alle prestazioni nel Blog del team di Entity Framework](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span><span class="sxs-lookup"><span data-stu-id="f8e54-281">[Performance-related posts on the Entity Framework Team blog](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span></span>
- <span data-ttu-id="f8e54-282">[Opzioni di Unione EF e query compilate](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8e54-282">[EF Merge Options and Compiled Queries](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span></span> <span data-ttu-id="f8e54-283">Post di Blog in cui vengono illustrati i comportamenti imprevisti delle query compilate e le opzioni di Unione come `NoTracking`.</span><span class="sxs-lookup"><span data-stu-id="f8e54-283">Blog post that explains unexpected behaviors of compiled queries and merge options such as `NoTracking`.</span></span> <span data-ttu-id="f8e54-284">Se si prevede di usare query compilate o modificare le impostazioni delle opzioni di merge nell'applicazione, leggere prima di tutto questo.</span><span class="sxs-lookup"><span data-stu-id="f8e54-284">If you plan to use compiled queries or manipulate merge option settings in your application, read this first.</span></span>
- <span data-ttu-id="f8e54-285">[Post correlati a Entity Framework nel Blog del team di consulenza sui dati e la modellazione](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span><span class="sxs-lookup"><span data-stu-id="f8e54-285">[Entity Framework-related posts in the Data and Modeling Customer Advisory Team blog](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span></span> <span data-ttu-id="f8e54-286">Include i post sulle query compilate e l'uso del profiler di Visual Studio 2010 per individuare i problemi di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8e54-286">Includes posts on compiled queries and using the Visual Studio 2010 Profiler to discover performance issues.</span></span>
- <span data-ttu-id="f8e54-287">[Entity Framework thread del forum con suggerimenti su come migliorare le prestazioni delle query estremamente complesse](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span><span class="sxs-lookup"><span data-stu-id="f8e54-287">[Entity Framework forum thread with advice on improving performance of highly complex queries](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span></span>
- <span data-ttu-id="f8e54-288">[Consigli sulla gestione dello stato di ASP.NET](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8e54-288">[ASP.NET State Management Recommendations](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span></span>
- <span data-ttu-id="f8e54-289">[Utilizzando il Entity Framework e il paging ObjectDataSource: Custom](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8e54-289">[Using the Entity Framework and the ObjectDataSource: Custom Paging](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span></span> <span data-ttu-id="f8e54-290">Post di Blog che si basa sull'applicazione ContosoUniversity creata in queste esercitazioni per spiegare come implementare il paging nella pagina *Departments. aspx* .</span><span class="sxs-lookup"><span data-stu-id="f8e54-290">Blog post that builds on the ContosoUniversity application created in these tutorials to explain how to implement paging in the *Departments.aspx* page.</span></span>

<span data-ttu-id="f8e54-291">Nell'esercitazione successiva vengono esaminati alcuni dei principali miglioramenti apportati alla Entity Framework nuova versione 4.</span><span class="sxs-lookup"><span data-stu-id="f8e54-291">The next tutorial reviews some of the important enhancements to the Entity Framework that are new in version 4.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f8e54-292">[Precedente](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
> [Successivo](what-s-new-in-the-entity-framework-4.md)</span><span class="sxs-lookup"><span data-stu-id="f8e54-292">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Next](what-s-new-in-the-entity-framework-4.md)</span></span>
