---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
title: Introduzione a Entity Framework 4.0 Database First e ASP.NET 4 Web Form - parte 4 | Microsoft Docs
author: tdykstra
description: L'applicazione web di esempio Contoso University illustra come creare applicazioni Web Form ASP.NET utilizzando Entity Framework. L'applicazione di esempio è...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ceb9e60f-957c-4d25-9331-cc527de96a33
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
msc.type: authoredcontent
ms.openlocfilehash: 94318068e0fb550f5c6a4250e369000a23507a91
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59394354"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-4"></a><span data-ttu-id="c4d1e-104">Introduzione a Entity Framework 4.0 Database First e ASP.NET 4 Web Form - parte 4</span><span class="sxs-lookup"><span data-stu-id="c4d1e-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 4</span></span>

<span data-ttu-id="c4d1e-105">da [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="c4d1e-106">L'applicazione web di esempio Contoso University illustra come creare applicazioni Web Form ASP.NET usando il Entity Framework 4.0 e Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="c4d1e-107">Per informazioni sulla serie di esercitazioni, vedere [la prima esercitazione della serie](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="working-with-related-data"></a><span data-ttu-id="c4d1e-108">Utilizzo dei dati correlati</span><span class="sxs-lookup"><span data-stu-id="c4d1e-108">Working with Related Data</span></span>

<span data-ttu-id="c4d1e-109">Nell'esercitazione precedente è stato usato il `EntityDataSource` controllo da filtrare, ordinare e raggruppare i dati.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-109">In the previous tutorial you used the `EntityDataSource` control to filter, sort, and group data.</span></span> <span data-ttu-id="c4d1e-110">In questa esercitazione verrà visualizzare e aggiornare i dati correlati.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-110">In this tutorial you'll display and update related data.</span></span>

<span data-ttu-id="c4d1e-111">Si creerà la pagina instructors (insegnanti) Mostra un elenco degli insegnanti.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-111">You'll create the Instructors page that shows a list of instructors.</span></span> <span data-ttu-id="c4d1e-112">Quando si seleziona un insegnante, viene visualizzato un elenco dei corsi tenuti da tale insegnante.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-112">When you select an instructor, you see a list of courses taught by that instructor.</span></span> <span data-ttu-id="c4d1e-113">Quando si seleziona un corso, vengono visualizzati i dettagli per il corso e un elenco di studenti iscritti al corso.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-113">When you select a course, you see details for the course and a list of students enrolled in the course.</span></span> <span data-ttu-id="c4d1e-114">È possibile modificare il nome insegnante, data di assunzione e assegnazione di ufficio.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-114">You can edit the instructor name, hire date, and office assignment.</span></span> <span data-ttu-id="c4d1e-115">L'assegnazione dell'ufficio è un set di entità separati che si accede tramite una proprietà di navigazione.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-115">The office assignment is a separate entity set that you access through a navigation property.</span></span>

<span data-ttu-id="c4d1e-116">È possibile collegare dati master per i dati di dettaglio nel markup o nel codice.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-116">You can link master data to detail data in markup or in code.</span></span> <span data-ttu-id="c4d1e-117">In questa parte dell'esercitazione, si userà entrambi i metodi.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-117">In this part of the tutorial, you'll use both methods.</span></span>

<span data-ttu-id="c4d1e-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span></span>

## <a name="displaying-and-updating-related-entities-in-a-gridview-control"></a><span data-ttu-id="c4d1e-119">Visualizzazione e l'aggiornamento di entità correlate in un controllo GridView</span><span class="sxs-lookup"><span data-stu-id="c4d1e-119">Displaying and Updating Related Entities in a GridView Control</span></span>

<span data-ttu-id="c4d1e-120">Creare una nuova pagina web denominata *Instructors.aspx* che usa le *Site. master* pagina master e aggiungere il markup seguente per il `Content` controllo denominato `Content2`:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-120">Create a new web page named *Instructors.aspx* that uses the *Site.Master* master page, and add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample1.aspx)]

<span data-ttu-id="c4d1e-121">Questo codice crea un `EntityDataSource` controllo che seleziona instructors (insegnanti) e consente gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-121">This markup creates an `EntityDataSource` control that selects instructors and enables updates.</span></span> <span data-ttu-id="c4d1e-122">Il `div` elemento configura markup per il rendering a sinistra, in modo che sia possibile aggiungere una colonna a destra in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-122">The `div` element configures markup to render on the left so that you can add a column on the right later.</span></span>

<span data-ttu-id="c4d1e-123">Tra i `EntityDataSource` markup e chiusura `</div>` tag, aggiungere il markup seguente che crea un `GridView` controllo e un `Label` controllo che si userà per i messaggi di errore:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-123">Between the `EntityDataSource` markup and the closing `</div>` tag, add the following markup that creates a `GridView` control and a `Label` control that you'll use for error messages:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample2.aspx)]

<span data-ttu-id="c4d1e-124">Ciò `GridView` controllo consente la selezione di riga, evidenzia la riga selezionata con un colore di sfondo grigio chiaro e specifica i gestori (che si creerà più avanti) per il `SelectedIndexChanged` e `Updating` eventi.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-124">This `GridView` control enables row selection, highlights the selected row with a light gray background color, and specifies handlers (which you'll create later) for the `SelectedIndexChanged` and `Updating` events.</span></span> <span data-ttu-id="c4d1e-125">Specifica inoltre `PersonID` per il `DataKeyNames` proprietà, in modo che il valore della chiave della riga selezionata può essere passato a un altro controllo che verrà aggiunto in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-125">It also specifies `PersonID` for the `DataKeyNames` property, so that the key value of the selected row can be passed to another control that you'll add later.</span></span>

<span data-ttu-id="c4d1e-126">L'ultima colonna contiene l'assegnazione dell'ufficio, che viene archiviato in una proprietà di navigazione del `Person` entità perché proviene da un'entità associata.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-126">The last column contains the instructor's office assignment, which is stored in a navigation property of the `Person` entity because it comes from an associated entity.</span></span> <span data-ttu-id="c4d1e-127">Si noti che il `EditItemTemplate` elemento specifica `Eval` invece di `Bind`, in quanto il `GridView` controllo non è possibile associare direttamente alle proprietà di navigazione per aggiornarli.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-127">Notice that the `EditItemTemplate` element specifies `Eval` instead of `Bind`, because the `GridView` control cannot directly bind to navigation properties in order to update them.</span></span> <span data-ttu-id="c4d1e-128">È possibile aggiornare l'assegnazione dell'ufficio nel codice.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-128">You'll update the office assignment in code.</span></span> <span data-ttu-id="c4d1e-129">A tale scopo, è necessario un riferimento per il `TextBox` controllo, si sarà ottenere e salvare nel `TextBox` del controllo `Init` evento.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-129">To do that, you'll need a reference to the `TextBox` control, and you'll get and save that in the `TextBox` control's `Init` event.</span></span>

<span data-ttu-id="c4d1e-130">Seguendo la `GridView` controllo è un `Label` controllo utilizzato per i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-130">Following the `GridView` control is a `Label` control that's used for error messages.</span></span> <span data-ttu-id="c4d1e-131">Il controllo `Visible` è di proprietà `false`, e lo stato di visualizzazione è stato disattivata, in modo che l'etichetta verrà visualizzata solo quando codice rende visibile in risposta a un errore.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-131">The control's `Visible` property is `false`, and view state is turned off, so that the label will appear only when code makes it visible in response to an error.</span></span>

<span data-ttu-id="c4d1e-132">Aprire il *Instructors.aspx.cs* del file e aggiungere quanto segue `using` istruzione:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-132">Open the *Instructors.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample3.cs)]

<span data-ttu-id="c4d1e-133">Aggiungere un campo di classe privata immediatamente dopo la dichiarazione del nome di classe parziale che include un riferimento alla casella di testo di assegnazione di ufficio.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-133">Add a private class field immediately after the partial-class name declaration to hold a reference to the office assignment text box.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample4.cs)]

<span data-ttu-id="c4d1e-134">Aggiungere uno stub per il `SelectedIndexChanged` gestore dell'evento che si aggiungerà codice per un uso successivo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-134">Add a stub for the `SelectedIndexChanged` event handler that you'll add code for later.</span></span> <span data-ttu-id="c4d1e-135">Aggiungere anche un gestore per l'assegnazione dell'ufficio `TextBox` del controllo `Init` eventi in modo che è possibile archiviare un riferimento al `TextBox` controllo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-135">Also add a handler for the office assignment `TextBox` control's `Init` event so that you can store a reference to the `TextBox` control.</span></span> <span data-ttu-id="c4d1e-136">Si userà questo riferimento per ottenere il valore immesso per aggiornare l'entità associata alla proprietà di navigazione.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-136">You'll use this reference to get the value the user entered in order to update the entity associated with the navigation property.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample5.cs)]

<span data-ttu-id="c4d1e-137">Si userà il `GridView` del controllo `Updating` evento da aggiornare la `Location` proprietà della classe associata `OfficeAssignment` entità.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-137">You'll use the `GridView` control's `Updating` event to update the `Location` property of the associated `OfficeAssignment` entity.</span></span> <span data-ttu-id="c4d1e-138">Aggiungere il gestore seguente per il `Updating` evento:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-138">Add the following handler for the `Updating` event:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample6.cs)]

<span data-ttu-id="c4d1e-139">Questo codice viene eseguito quando l'utente sceglie **Update** in un `GridView` riga.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-139">This code is run when the user clicks **Update** in a `GridView` row.</span></span> <span data-ttu-id="c4d1e-140">Il codice Usa LINQ to Entities per recuperare il `OfficeAssignment` entità a cui è associato all'oggetto corrente `Person` entità, utilizzando il `PersonID` della riga selezionata dall'argomento dell'evento.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-140">The code uses LINQ to Entities to retrieve the `OfficeAssignment` entity that's associated with the current `Person` entity, using the `PersonID` of the selected row from the event argument.</span></span>

<span data-ttu-id="c4d1e-141">Il codice accetta quindi una delle azioni seguenti a seconda del valore nel `InstructorOfficeTextBox` controllo:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-141">The code then takes one of the following actions depending on the value in the `InstructorOfficeTextBox` control:</span></span>

- <span data-ttu-id="c4d1e-142">Se la casella di testo ha un valore ed è presente alcun `OfficeAssignment` entità da aggiornare, ne crea uno.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-142">If the text box has a value and there's no `OfficeAssignment` entity to update, it creates one.</span></span>
- <span data-ttu-id="c4d1e-143">Se la casella di testo ha un valore ed è presente un' `OfficeAssignment` entità, viene aggiornata la `Location` valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-143">If the text box has a value and there's an `OfficeAssignment` entity, it updates the `Location` property value.</span></span>
- <span data-ttu-id="c4d1e-144">Se la casella di testo è vuota e un' `OfficeAssignment` entità esiste, viene eliminata l'entità.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-144">If the text box is empty and an `OfficeAssignment` entity exists, it deletes the entity.</span></span>

<span data-ttu-id="c4d1e-145">Al termine, Salva le modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-145">After this, it saves the changes to the database.</span></span> <span data-ttu-id="c4d1e-146">Se si verifica un'eccezione, viene visualizzato un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-146">If an exception occurs, it displays an error message.</span></span>

<span data-ttu-id="c4d1e-147">Eseguire la pagina.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-147">Run the page.</span></span>

<span data-ttu-id="c4d1e-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span></span>

<span data-ttu-id="c4d1e-149">Fare clic su **modifica** e modificare tutti i campi alle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-149">Click **Edit** and all fields change to text boxes.</span></span>

<span data-ttu-id="c4d1e-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span></span>

<span data-ttu-id="c4d1e-151">Modificare uno di questi valori, inclusi **assegnazione dell'ufficio**.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-151">Change any of these values, including **Office Assignment**.</span></span> <span data-ttu-id="c4d1e-152">Fare clic su **Update** si noterà che le modifiche riflesse nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-152">Click **Update** and you'll see the changes reflected in the list.</span></span>

## <a name="displaying-related-entities-in-a-separate-control"></a><span data-ttu-id="c4d1e-153">Visualizzare le entità correlate in un controllo separato</span><span class="sxs-lookup"><span data-stu-id="c4d1e-153">Displaying Related Entities in a Separate Control</span></span>

<span data-ttu-id="c4d1e-154">Ogni insegnante può tenere uno o più corsi, pertanto si aggiungerà un' `EntityDataSource` controllo e una `GridView` controllo per visualizzare l'elenco di corsi associati a qualunque sia il docente selezionato in insegnanti `GridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-154">Each instructor can teach one or more courses, so you'll add an `EntityDataSource` control and a `GridView` control to list the courses associated with whichever instructor is selected in the instructors `GridView` control.</span></span> <span data-ttu-id="c4d1e-155">Per creare un'intestazione e il `EntityDataSource` controllo per le entità di corsi, aggiungere il markup seguente tra il messaggio di errore `Label` controllo e la chiusura `</div>` tag:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-155">To create a heading and the `EntityDataSource` control for courses entities, add the following markup between the error message `Label` control and the closing `</div>` tag:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample7.aspx)]

<span data-ttu-id="c4d1e-156">Il `Where` parametro contiene il valore della `PersonID` dell'insegnante cui la riga è selezionata nel `InstructorsGridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-156">The `Where` parameter contains the value of the `PersonID` of the instructor whose row is selected in the `InstructorsGridView` control.</span></span> <span data-ttu-id="c4d1e-157">Il `Where` proprietà contiene un comando sub-SELECT che ottiene tutti i relativi `Person` entità da una `Course` dell'entità `People` proprietà di navigazione e seleziona il `Course` solo se entità tra i associato`Person`entità contiene selezionato `PersonID` valore.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-157">The `Where` property contains a subselect command that gets all associated `Person` entities from a `Course` entity's `People` navigation property and selects the `Course` entity only if one of the associated `Person` entities contains the selected `PersonID` value.</span></span>

<span data-ttu-id="c4d1e-158">Per creare il `GridView` del controllo., aggiungere il markup seguente subito dopo il `CoursesEntityDataSource` controllo (prima della chiusura `</div>` tag):</span><span class="sxs-lookup"><span data-stu-id="c4d1e-158">To create the `GridView` control., add the following markup immediately following the `CoursesEntityDataSource` control (before the closing `</div>` tag):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample8.aspx)]

<span data-ttu-id="c4d1e-159">Perché non viene visualizzato alcun corso se non è selezionato alcun insegnante, un `EmptyDataTemplate` elemento è incluso.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-159">Because no courses will be displayed if no instructor is selected, an `EmptyDataTemplate` element is included.</span></span>

<span data-ttu-id="c4d1e-160">Eseguire la pagina.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-160">Run the page.</span></span>

<span data-ttu-id="c4d1e-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span></span>

<span data-ttu-id="c4d1e-162">Selezionare un insegnante che dispone di uno o più corsi assegnati e al corso o corsi visualizzato nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-162">Select an instructor who has one or more courses assigned, and the course or courses appear in the list.</span></span> <span data-ttu-id="c4d1e-163">(Nota: anche se lo schema del database consente più corsi, nei dati di test forniti con il database non insegnante effettivamente ha più di un corso.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-163">(Note: although the database schema allows multiple courses, in the test data supplied with the database no instructor actually has more than one course.</span></span> <span data-ttu-id="c4d1e-164">È possibile aggiungere corsi per il database manualmente utilizzando il **Esplora Server** finestra o il *CoursesAdd.aspx* pagina nella quale verrà aggiunto in un'esercitazione successiva.)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-164">You can add courses to the database yourself using the **Server Explorer** window or the *CoursesAdd.aspx* page, which you'll add in a later tutorial.)</span></span>

<span data-ttu-id="c4d1e-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span></span>

<span data-ttu-id="c4d1e-166">Il `CoursesGridView` controllo Mostra solo pochi campi di corsi.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-166">The `CoursesGridView` control shows only a few course fields.</span></span> <span data-ttu-id="c4d1e-167">Per visualizzare tutti i dettagli per un corso, si userà un `DetailsView` controllo per il corso selezionato dall'utente.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-167">To display all the details for a course, you'll use a `DetailsView` control for the course that the user selects.</span></span> <span data-ttu-id="c4d1e-168">Nelle *Instructors.aspx*, aggiungere il markup seguente dopo la chiusura `</div>` tag (assicurarsi di inserire questo markup **dopo** un tag div di chiusura, non preceduto da):</span><span class="sxs-lookup"><span data-stu-id="c4d1e-168">In *Instructors.aspx*, add the following markup after the closing `</div>` tag (make sure you place this markup **after** the closing div tag, not before it):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample9.aspx)]

<span data-ttu-id="c4d1e-169">Questo codice crea un' `EntityDataSource` controllo a cui è associato il `Courses` set di entità.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-169">This markup creates an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span> <span data-ttu-id="c4d1e-170">Il `Where` proprietà consente di selezionare un corso usando il `CourseID` valore della riga selezionata in corsi `GridView` controllo.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-170">The `Where` property selects a course using the `CourseID` value of the selected row in the courses `GridView` control.</span></span> <span data-ttu-id="c4d1e-171">Il markup specifica un gestore per il `Selected` evento, che verrà usato in un secondo momento per la visualizzazione dei voti, vale a dire un altro livello inferiore nella gerarchia.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-171">The markup specifies a handler for the `Selected` event, which you'll use later for displaying student grades, which is another level lower in the hierarchy.</span></span>

<span data-ttu-id="c4d1e-172">Nelle *Instructors.aspx.cs*, lo stub seguente per creare il `CourseDetailsEntityDataSource_Selected` (metodo).</span><span class="sxs-lookup"><span data-stu-id="c4d1e-172">In *Instructors.aspx.cs*, create the following stub for the `CourseDetailsEntityDataSource_Selected` method.</span></span> <span data-ttu-id="c4d1e-173">(È possibile compilare questo stub più avanti nell'esercitazione, per il momento, è necessario affinché la pagina verrà compilata ed eseguita).</span><span class="sxs-lookup"><span data-stu-id="c4d1e-173">(You'll fill this stub out later in the tutorial; for now, you need it so that the page will compile and run.)</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample10.cs)]

<span data-ttu-id="c4d1e-174">Eseguire la pagina.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-174">Run the page.</span></span>

<span data-ttu-id="c4d1e-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span></span>

<span data-ttu-id="c4d1e-176">Inizialmente non sono disponibili dettagli corso perché non è selezionato alcun corso.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-176">Initially there are no course details because no course is selected.</span></span> <span data-ttu-id="c4d1e-177">Selezionare un insegnante che dispone di un corso assegnato e quindi selezionare un corso per visualizzare i dettagli.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-177">Select an instructor who has a course assigned, and then select a course to see the details.</span></span>

<span data-ttu-id="c4d1e-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span></span>

## <a name="using-the-entitydatasource-selected-event-to-display-related-data"></a><span data-ttu-id="c4d1e-179">Utilizzo di EntityDataSource "selezionati" evento per visualizzare i dati correlati</span><span class="sxs-lookup"><span data-stu-id="c4d1e-179">Using the EntityDataSource "Selected" Event to Display Related Data</span></span>

<span data-ttu-id="c4d1e-180">Infine, si desidera visualizzare tutti gli studenti iscritti e i voti corrispondenti per il corso selezionato.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-180">Finally, you want to show all of the enrolled students and their grades for the selected course.</span></span> <span data-ttu-id="c4d1e-181">A tale scopo, si userà il `Selected` eventi del `EntityDataSource` controllo associato al corso `DetailsView`.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-181">To do this, you'll use the `Selected` event of the `EntityDataSource` control bound to the course `DetailsView`.</span></span>

<span data-ttu-id="c4d1e-182">Nelle *Instructors.aspx*, aggiungere il seguente markup dopo la `DetailsView` controllo:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-182">In *Instructors.aspx*, add the following markup after the `DetailsView` control:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample11.aspx)]

<span data-ttu-id="c4d1e-183">Questo codice crea un `ListView` controllo che visualizza un elenco degli studenti e i voti corrispondenti per il corso selezionato.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-183">This markup creates a `ListView` control that displays a list of students and their grades for the selected course.</span></span> <span data-ttu-id="c4d1e-184">Viene specificata alcuna origine dati perché si imposterà un metodo databind del controllo nel codice.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-184">No data source is specified because you'll databind the control in code.</span></span> <span data-ttu-id="c4d1e-185">Il `EmptyDataTemplate` elemento fornisce un messaggio da visualizzare quando non è selezionato alcun corso, in tal caso, non esistono Nessun studenti da visualizzare.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-185">The `EmptyDataTemplate` element provides a message to display when no course is selected—in that case, there are no students to display.</span></span> <span data-ttu-id="c4d1e-186">Il `LayoutTemplate` elemento crea una tabella HTML per visualizzare l'elenco e il `ItemTemplate` specifica le colonne da visualizzare.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-186">The `LayoutTemplate` element creates an HTML table to display the list, and the `ItemTemplate` specifies the columns to display.</span></span> <span data-ttu-id="c4d1e-187">L'ID dello studente e il livello degli studenti provengono dal `StudentGrade` entità e il nome di uno studente proviene il `Person` entità che rende disponibili in Entity Framework il `Person` proprietà di navigazione del `StudentGrade` entità.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-187">The student ID and the student grade are from the `StudentGrade` entity, and the student name is from the `Person` entity that the Entity Framework makes available in the `Person` navigation property of the `StudentGrade` entity.</span></span>

<span data-ttu-id="c4d1e-188">Nelle *Instructors.aspx.cs*, sostituire la sottoposto a stub orizzontale `CourseDetailsEntityDataSource_Selected` metodo con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-188">In *Instructors.aspx.cs*, replace the stubbed-out `CourseDetailsEntityDataSource_Selected` method with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample12.cs)]

<span data-ttu-id="c4d1e-189">L'argomento dell'evento per questo evento fornisce i dati sotto forma di una raccolta, che conterrà zero elementi se non è selezionato o un elemento selezionati se un `Course` entità sia selezionata.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-189">The event argument for this event provides the selected data in the form of a collection, which will have zero items if nothing is selected or one item if a `Course` entity is selected.</span></span> <span data-ttu-id="c4d1e-190">Se un `Course` entità è selezionata, il codice Usa il `First` metodo per convertire la raccolta a un singolo oggetto.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-190">If a `Course` entity is selected, the code uses the `First` method to convert the collection to a single object.</span></span> <span data-ttu-id="c4d1e-191">Quindi, recupera `StudentGrade` entità dalla proprietà di navigazione, li converte in una raccolta e associa il `GradesListView` controllo alla raccolta.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-191">It then gets `StudentGrade` entities from the navigation property, converts them to a collection, and binds the `GradesListView` control to the collection.</span></span>

<span data-ttu-id="c4d1e-192">Ciò è sufficiente per visualizzare, gradi da, ma si desidera assicurarsi che il messaggio nel modello di dati vuoto viene visualizzato la prima volta che viene visualizzata la pagina e ogni volta che un corso non è selezionato.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-192">This is sufficient to display grades, but you want to make sure that the message in the empty data template is displayed the first time the page is displayed and whenever a course is not selected.</span></span> <span data-ttu-id="c4d1e-193">A tale scopo, creare il metodo seguente, che verrà chiamata da due posizioni:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-193">To do that, create the following method, which you'll call from two places:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample13.cs)]

<span data-ttu-id="c4d1e-194">Questo nuovo metodo da chiamare il `Page_Load` metodo per visualizzare i dati vuoti la prima volta che viene visualizzata la pagina.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-194">Call this new method from the `Page_Load` method to display the empty data template the first time the page is displayed.</span></span> <span data-ttu-id="c4d1e-195">E chiamarlo dal `InstructorsGridView_SelectedIndexChanged` metodo perché tale evento viene generato quando viene selezionato un insegnante, ovvero nuovi corsi vengono caricati i corsi `GridView` controllo e nessuno è stato ancora selezionato.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-195">And call it from the `InstructorsGridView_SelectedIndexChanged` method because that event is raised when an instructor is selected, which means new courses are loaded into the courses `GridView` control and none is selected yet.</span></span> <span data-ttu-id="c4d1e-196">Di seguito sono le due chiamate:</span><span class="sxs-lookup"><span data-stu-id="c4d1e-196">Here are the two calls:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample14.cs)]

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample15.cs)]

<span data-ttu-id="c4d1e-197">Eseguire la pagina.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-197">Run the page.</span></span>

<span data-ttu-id="c4d1e-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span></span>

<span data-ttu-id="c4d1e-199">Selezionare un insegnante che dispone di un corso assegnato e quindi selezionare il corso.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-199">Select an instructor that has a course assigned, and then select the course.</span></span>

<span data-ttu-id="c4d1e-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span></span>

<span data-ttu-id="c4d1e-201">Si sono visto alcuni modi per lavorare con i dati correlati.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-201">You have now seen a few ways to work with related data.</span></span> <span data-ttu-id="c4d1e-202">Nell'esercitazione seguente, si apprenderà come aggiungere le relazioni tra entità esistenti, come rimuovere le relazioni e come aggiungere una nuova entità che ha una relazione a un'entità esistente.</span><span class="sxs-lookup"><span data-stu-id="c4d1e-202">In the following tutorial, you'll learn how to add relationships between existing entities, how to remove relationships, and how to add a new entity that has a relationship to an existing entity.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c4d1e-203">[Precedente](the-entity-framework-and-aspnet-getting-started-part-3.md)
> [Successivo](the-entity-framework-and-aspnet-getting-started-part-5.md)</span><span class="sxs-lookup"><span data-stu-id="c4d1e-203">[Previous](the-entity-framework-and-aspnet-getting-started-part-3.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-5.md)</span></span>
