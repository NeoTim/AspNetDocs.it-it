---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: Elaborazione delle eccezioni non gestite (C#) | Microsoft Docs
author: rick-anderson
description: Quando si verifica un errore di runtime in un'applicazione Web nell'ambiente di produzione, è importante informare uno sviluppatore e registrare l'errore in modo che possa essere diagnosticato in una...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 27d827238d944f86cd913d2b8ecd12729b99f391
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78629269"
---
# <a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="27301-103">Elaborazione delle eccezioni non gestite (C#)</span><span class="sxs-lookup"><span data-stu-id="27301-103">Processing Unhandled Exceptions (C#)</span></span>

<span data-ttu-id="27301-104">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="27301-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="27301-105">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([procedura per il download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="27301-105">[View or download sample code](https://github.com/dotnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="27301-106">Quando si verifica un errore di runtime in un'applicazione Web nell'ambiente di produzione, è importante informare uno sviluppatore e registrare l'errore in modo che possa essere diagnosticato in un momento successivo.</span><span class="sxs-lookup"><span data-stu-id="27301-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="27301-107">Questa esercitazione offre una panoramica del modo in cui ASP.NET elabora gli errori di runtime e analizza un modo per eseguire il codice personalizzato ogni volta che un'eccezione non gestita si propaga al runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="27301-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>

## <a name="introduction"></a><span data-ttu-id="27301-108">Introduzione</span><span class="sxs-lookup"><span data-stu-id="27301-108">Introduction</span></span>

<span data-ttu-id="27301-109">Quando si verifica un'eccezione non gestita in un'applicazione ASP.NET, si esegue il bubbling fino al runtime di ASP.NET, che genera l'evento `Error` e visualizza la pagina di errore appropriata.</span><span class="sxs-lookup"><span data-stu-id="27301-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="27301-110">Sono disponibili tre tipi diversi di pagine di errore: lo schermo di errore di runtime giallo (YSOD); Dettagli eccezione YSOD; e pagine di errore personalizzate.</span><span class="sxs-lookup"><span data-stu-id="27301-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="27301-111">Nell' [esercitazione precedente](displaying-a-custom-error-page-cs.md) è stata configurata l'applicazione per usare una pagina di errore personalizzata per gli utenti remoti e i dettagli dell'eccezione YSOD per gli utenti che visitano localmente.</span><span class="sxs-lookup"><span data-stu-id="27301-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="27301-112">L'uso di una pagina di errore personalizzata che corrisponde all'aspetto del sito è preferibile all'errore di runtime predefinito YSOD, ma la visualizzazione di una pagina di errore personalizzata è solo una parte di una soluzione completa di gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="27301-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="27301-113">Quando si verifica un errore in un'applicazione nell'ambiente di produzione, è importante che gli sviluppatori ricevano la notifica dell'errore, in modo che possano scoprire la ragione dell'eccezione e risolverla.</span><span class="sxs-lookup"><span data-stu-id="27301-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="27301-114">Inoltre, è necessario registrare i dettagli dell'errore in modo che l'errore possa essere esaminato e diagnosticato in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="27301-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="27301-115">Questa esercitazione illustra come accedere ai dettagli di un'eccezione non gestita in modo che possano essere registrati e uno sviluppatore abbia inviato una notifica.</span><span class="sxs-lookup"><span data-stu-id="27301-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="27301-116">Le due esercitazioni successive esaminano le librerie di registrazione degli errori che, dopo un po' di configurazione, invieranno automaticamente notifiche agli sviluppatori di errori di runtime e registreranno i dettagli.</span><span class="sxs-lookup"><span data-stu-id="27301-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="27301-117">Le informazioni esaminate in questa esercitazione sono particolarmente utili se è necessario elaborare le eccezioni non gestite in modo univoco o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="27301-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="27301-118">Nei casi in cui è necessario registrare l'eccezione e inviare una notifica a uno sviluppatore, è possibile usare una libreria di registrazione degli errori.</span><span class="sxs-lookup"><span data-stu-id="27301-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="27301-119">Le due esercitazioni successive forniscono una panoramica di due librerie di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="27301-119">The next two tutorials provide an overview of two such libraries.</span></span>

## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="27301-120">Esecuzione del codice quando viene generato l'evento`Error`</span><span class="sxs-lookup"><span data-stu-id="27301-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="27301-121">Gli eventi forniscono a un oggetto un meccanismo per segnalare che si è verificato un evento interessante e che un altro oggetto può eseguire il codice in risposta.</span><span class="sxs-lookup"><span data-stu-id="27301-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="27301-122">Gli sviluppatori ASP.NET sono abituati a pensare in termini di eventi.</span><span class="sxs-lookup"><span data-stu-id="27301-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="27301-123">Se si vuole eseguire codice quando il visitatore fa clic su un pulsante particolare, si crea un gestore eventi per l'evento `Click` del pulsante e si inserisce il codice.</span><span class="sxs-lookup"><span data-stu-id="27301-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="27301-124">Dato che il runtime di ASP.NET genera l' [evento`Error`](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) ogni volta che si verifica un'eccezione non gestita, il codice per la registrazione dei dettagli dell'errore verrebbe inserito in un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="27301-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="27301-125">Ma come si crea un gestore eventi per l'evento `Error`?</span><span class="sxs-lookup"><span data-stu-id="27301-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="27301-126">L'evento `Error` è uno dei numerosi eventi nella [classe`HttpApplication`](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) generati in determinate fasi della pipeline HTTP durante il ciclo di vita di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="27301-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="27301-127">Ad esempio, l' [evento`BeginRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) della classe `HttpApplication` viene generato all'inizio di ogni richiesta; il relativo [evento`AuthenticateRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) viene generato quando un modulo di sicurezza ha identificato il richiedente.</span><span class="sxs-lookup"><span data-stu-id="27301-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="27301-128">Questi eventi `HttpApplication` offrono allo sviluppatore della pagina un mezzo per eseguire la logica personalizzata nei vari punti della durata di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="27301-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="27301-129">I gestori eventi per gli eventi di `HttpApplication` possono essere inseriti in un file speciale denominato `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="27301-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="27301-130">Per creare questo file nel sito Web, aggiungere un nuovo elemento alla radice del sito Web usando il modello di classe dell'applicazione globale con il nome `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="27301-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="27301-131">**Figura 1**: aggiungere `Global.asax` all'applicazione Web</span><span class="sxs-lookup"><span data-stu-id="27301-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="27301-132">([Fare clic per visualizzare l'immagine con dimensioni complete](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="27301-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="27301-133">Il contenuto e la struttura del file di `Global.asax` creato da Visual Studio differiscono leggermente a seconda che si usi un progetto di applicazione Web (WAP) o un progetto di sito Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="27301-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="27301-134">Con un WAP, il `Global.asax` viene implementato come due file distinti `Global.asax` e `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="27301-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="27301-135">Il file di `Global.asax` non contiene elementi, ma una direttiva `@Application` che fa riferimento al file di `.cs`; i gestori di eventi di interesse vengono definiti nel file di `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="27301-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="27301-136">Per WSPs, viene creato un solo file, `Global.asax`e i gestori eventi sono definiti in un blocco di `<script runat="server">`.</span><span class="sxs-lookup"><span data-stu-id="27301-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="27301-137">Il file di `Global.asax` creato in un modello di classe di applicazione globale del WAP da Visual Studio include i gestori eventi denominati `Application_BeginRequest`, `Application_AuthenticateRequest`e `Application_Error`, ovvero i gestori eventi per gli eventi `HttpApplication` `BeginRequest`, `AuthenticateRequest`e `Error`rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="27301-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="27301-138">Sono inoltre presenti gestori eventi denominati `Application_Start`, `Session_Start`, `Application_End`e `Session_End`, ovvero gestori eventi che vengono attivati all'avvio dell'applicazione Web, quando viene avviata una nuova sessione, al termine dell'applicazione e al termine di una sessione.</span><span class="sxs-lookup"><span data-stu-id="27301-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="27301-139">Il file di `Global.asax` creato in un oggetto WSP da Visual Studio contiene solo i gestori eventi `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`e `Session_End`.</span><span class="sxs-lookup"><span data-stu-id="27301-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="27301-140">Quando si distribuisce l'applicazione ASP.NET, è necessario copiare il file di `Global.asax` nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="27301-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="27301-141">Il file di `Global.asax.cs`, creato nel WAP, non deve essere copiato in produzione perché questo codice viene compilato nell'assembly del progetto.</span><span class="sxs-lookup"><span data-stu-id="27301-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>

<span data-ttu-id="27301-142">I gestori eventi creati dal modello della classe di applicazione globale di Visual Studio non sono esaustivi.</span><span class="sxs-lookup"><span data-stu-id="27301-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="27301-143">È possibile aggiungere un gestore eventi per qualsiasi evento di `HttpApplication` assegnando un nome al gestore eventi `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="27301-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="27301-144">Ad esempio, è possibile aggiungere il codice seguente al file di `Global.asax` per creare un gestore eventi per l' [evento`AuthorizeRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="27301-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-cs[Main](processing-unhandled-exceptions-cs/samples/sample1.cs)]

<span data-ttu-id="27301-145">Analogamente, è possibile rimuovere qualsiasi gestore eventi creato dal modello di classe dell'applicazione globale che non è necessario.</span><span class="sxs-lookup"><span data-stu-id="27301-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="27301-146">Per questa esercitazione è necessario solo un gestore eventi per l'evento `Error`; è possibile rimuovere gli altri gestori eventi dal file di `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="27301-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="27301-147">I *moduli HTTP* offrono un altro modo per definire i gestori eventi per `HttpApplication` eventi.</span><span class="sxs-lookup"><span data-stu-id="27301-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="27301-148">I moduli HTTP vengono creati come file di classe che possono essere inseriti direttamente nel progetto di applicazione Web o separati in una libreria di classi separata.</span><span class="sxs-lookup"><span data-stu-id="27301-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="27301-149">Poiché possono essere separate in una libreria di classi, i moduli HTTP offrono un modello più flessibile e riutilizzabile per la creazione di `HttpApplication` gestori di eventi.</span><span class="sxs-lookup"><span data-stu-id="27301-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="27301-150">Mentre il file di `Global.asax` è specifico dell'applicazione Web in cui risiede, i moduli HTTP possono essere compilati in assembly. a questo punto, l'aggiunta del modulo HTTP a un sito Web è semplice come eliminare l'assembly nella cartella `Bin` e registrare il modulo in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="27301-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="27301-151">Questa esercitazione non illustra la creazione e l'uso di moduli HTTP, ma le due librerie di registrazione degli errori usate nelle due esercitazioni seguenti sono implementate come moduli HTTP.</span><span class="sxs-lookup"><span data-stu-id="27301-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="27301-152">Per altre informazioni sui vantaggi dei moduli HTTP [, vedere uso di moduli e gestori HTTP per creare componenti ASP.NET collegabili](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="27301-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>

## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="27301-153">Recupero delle informazioni sull'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="27301-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="27301-154">A questo punto è presente un file Global. asax con un gestore dell'evento `Application_Error`.</span><span class="sxs-lookup"><span data-stu-id="27301-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="27301-155">Quando questo gestore dell'evento viene eseguito, è necessario notificare allo sviluppatore l'errore e registrarne i dettagli.</span><span class="sxs-lookup"><span data-stu-id="27301-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="27301-156">Per eseguire queste attività, è necessario innanzitutto determinare i dettagli dell'eccezione generata.</span><span class="sxs-lookup"><span data-stu-id="27301-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="27301-157">Utilizzare il [metodo di`GetLastError`](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) dell'oggetto server per recuperare i dettagli dell'eccezione non gestita che ha causato l'attivazione dell'evento `Error`.</span><span class="sxs-lookup"><span data-stu-id="27301-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="27301-158">Il metodo `GetLastError` restituisce un oggetto di tipo `Exception`, che è il tipo di base per tutte le eccezioni nella .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="27301-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="27301-159">Tuttavia, nel codice precedente si sta eseguendo il cast dell'oggetto eccezione restituito da `GetLastError` in un oggetto `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="27301-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="27301-160">Se l'evento `Error` viene generato perché è stata generata un'eccezione durante l'elaborazione di una risorsa ASP.NET, l'eccezione generata viene inserita all'interno di un `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="27301-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="27301-161">Per ottenere l'eccezione effettiva che ha provocato l'evento Error, utilizzare la proprietà `InnerException`.</span><span class="sxs-lookup"><span data-stu-id="27301-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="27301-162">Se l'evento `Error` è stato generato a causa di un'eccezione basata su HTTP, ad esempio una richiesta di una pagina inesistente, viene generata una `HttpException`, ma non è presente un'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="27301-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="27301-163">Il codice seguente usa il `GetLastErrormessage` per recuperare informazioni sull'eccezione che ha attivato l'evento `Error`, archiviando il `HttpException` in una variabile denominata `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="27301-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="27301-164">Archivia quindi il tipo, il messaggio e la traccia dello stack dell'eccezione di origine in tre variabili stringa, verificando se la `lastErrorWrapper` è l'eccezione effettiva che ha generato l'evento `Error` (nel caso di eccezioni basate su HTTP) o se si tratta semplicemente di un wrapper per un'eccezione generata durante l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="27301-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="27301-165">A questo punto sono disponibili tutte le informazioni necessarie per scrivere codice che registrerà i dettagli dell'eccezione in una tabella di database.</span><span class="sxs-lookup"><span data-stu-id="27301-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="27301-166">È possibile creare una tabella di database con colonne per tutti i dettagli dell'errore di interesse, ovvero il tipo, il messaggio, l'analisi dello stack e così via, insieme ad altre informazioni utili, ad esempio l'URL della pagina richiesta e il nome dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="27301-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="27301-167">Nel gestore dell'evento `Application_Error` connettersi al database e inserire un record nella tabella.</span><span class="sxs-lookup"><span data-stu-id="27301-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="27301-168">Analogamente, è possibile aggiungere codice per avvisare lo sviluppatore dell'errore tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="27301-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="27301-169">Le librerie di registrazione degli errori esaminate nelle due esercitazioni successive forniscono la funzionalità predefinita, quindi non è necessario compilare manualmente la registrazione e la notifica degli errori.</span><span class="sxs-lookup"><span data-stu-id="27301-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="27301-170">Tuttavia, per illustrare che è in corso la generazione dell'evento `Error` e che il gestore dell'evento `Application_Error` può essere usato per registrare i dettagli dell'errore e inviare una notifica a uno sviluppatore, aggiungere il codice che notifica a uno sviluppatore quando si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="27301-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="27301-171">Notifica a uno sviluppatore quando si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="27301-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="27301-172">Quando si verifica un'eccezione non gestita nell'ambiente di produzione, è importante informare il team di sviluppo in modo che sia in grado di valutare l'errore e determinare quali azioni devono essere eseguite.</span><span class="sxs-lookup"><span data-stu-id="27301-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="27301-173">Se, ad esempio, si verifica un errore durante la connessione al database, sarà necessario controllare la stringa di connessione e, forse, aprire un ticket di supporto con la società di hosting Web.</span><span class="sxs-lookup"><span data-stu-id="27301-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="27301-174">Se si è verificata un'eccezione a causa di un errore di programmazione, potrebbe essere necessario aggiungere codice aggiuntivo o logica di convalida per evitare tali errori in futuro.</span><span class="sxs-lookup"><span data-stu-id="27301-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="27301-175">Le classi .NET Framework nello [spazio dei nomi`System.Net.Mail`](https://msdn.microsoft.com/library/system.net.mail.aspx) facilitano l'invio di un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="27301-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="27301-176">La [classe`MailMessage`](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) rappresenta un messaggio di posta elettronica con proprietà quali `To`, `From`, `Subject`, `Body`e `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="27301-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="27301-177">Il `SmtpClass` viene utilizzato per inviare un oggetto `MailMessage` utilizzando un server SMTP specificato. le impostazioni del server SMTP possono essere specificate a livello di programmazione o in modo dichiarativo nell' [elemento`<system.net>`](https://msdn.microsoft.com/library/6484zdc1.aspx) del `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="27301-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="27301-178">Per altre informazioni sull'invio di messaggi di posta elettronica in un'applicazione ASP.NET, vedere l'articolo relativo all' [invio di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)e alle [domande frequenti su System .NET. mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="27301-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="27301-179">L'elemento `<system.net>` contiene le impostazioni del server SMTP utilizzate dalla classe `SmtpClient` quando si invia un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="27301-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="27301-180">È probabile che la società di hosting Web disponga di un server SMTP che è possibile usare per inviare messaggi di posta elettronica dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="27301-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="27301-181">Per informazioni sulle impostazioni del server SMTP da utilizzare nell'applicazione Web, consultare la sezione supporto dell'host Web.</span><span class="sxs-lookup"><span data-stu-id="27301-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>

<span data-ttu-id="27301-182">Aggiungere il codice seguente al gestore eventi `Application_Error` per inviare a uno sviluppatore un messaggio di posta elettronica quando si verifica un errore:</span><span class="sxs-lookup"><span data-stu-id="27301-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="27301-183">Sebbene il codice precedente sia abbastanza lungo, la maggior parte di esso crea il codice HTML visualizzato nel messaggio di posta elettronica inviato allo sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="27301-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="27301-184">Il codice inizia facendo riferimento al `HttpException` restituito dal metodo `GetLastError` (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="27301-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="27301-185">L'eccezione effettiva generata dalla richiesta viene recuperata tramite `lastErrorWrapper.InnerException` e viene assegnata alla variabile `lastError`.</span><span class="sxs-lookup"><span data-stu-id="27301-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="27301-186">Le informazioni sul tipo, il messaggio e la traccia dello stack vengono recuperate da `lastError` e archiviate in tre variabili di stringa.</span><span class="sxs-lookup"><span data-stu-id="27301-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="27301-187">Viene quindi creato un oggetto `MailMessage` denominato `mm`.</span><span class="sxs-lookup"><span data-stu-id="27301-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="27301-188">Il corpo del messaggio di posta elettronica è formattato in formato HTML e visualizza l'URL della pagina richiesta, il nome dell'utente attualmente connesso e le informazioni sull'eccezione (tipo, messaggio e traccia dello stack).</span><span class="sxs-lookup"><span data-stu-id="27301-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="27301-189">Una delle cose più interessanti sulla classe `HttpException` è che è possibile generare il codice HTML usato per creare la schermata gialla della morte (YSOD) dei dettagli dell'eccezione chiamando il [Metodo GetHtmlErrorMessage](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="27301-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="27301-190">Questo metodo viene usato qui per recuperare i dettagli dell'eccezione YSOD markup e aggiungerlo al messaggio di posta elettronica come allegato.</span><span class="sxs-lookup"><span data-stu-id="27301-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="27301-191">Una parola di attenzione: se l'eccezione che ha generato l'evento `Error` era un'eccezione basata su HTTP, ad esempio una richiesta per una pagina inesistente, il metodo `GetHtmlErrorMessage` restituirà `null`.</span><span class="sxs-lookup"><span data-stu-id="27301-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="27301-192">Il passaggio finale consiste nell'inviare il `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="27301-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="27301-193">Questa operazione viene eseguita creando un nuovo metodo `SmtpClient` e chiamando il relativo metodo `Send`.</span><span class="sxs-lookup"><span data-stu-id="27301-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="27301-194">Prima di usare questo codice nell'applicazione Web, è necessario modificare i valori nel `ToAddress` e `FromAddress` costanti da support@example.com a qualsiasi indirizzo di posta elettronica a cui inviare il messaggio di notifica di errore e che provengono da.</span><span class="sxs-lookup"><span data-stu-id="27301-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="27301-195">È inoltre necessario specificare le impostazioni del server SMTP nella sezione `<system.net>` `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="27301-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="27301-196">Per determinare le impostazioni del server SMTP da utilizzare, consultare il provider dell'host Web.</span><span class="sxs-lookup"><span data-stu-id="27301-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>

<span data-ttu-id="27301-197">Con questo codice quando si verifica un errore, lo sviluppatore riceve un messaggio di posta elettronica che riepiloga l'errore e include YSOD.</span><span class="sxs-lookup"><span data-stu-id="27301-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="27301-198">Nell'esercitazione precedente è stato illustrato un errore di runtime visitando Genre. aspx e passando un valore di `ID` non valido attraverso la QueryString, ad esempio `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="27301-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="27301-199">Visitare la pagina con il file di `Global.asax` sul posto produce la stessa esperienza utente dell'esercitazione precedente. nell'ambiente di sviluppo, si continuerà a visualizzare la schermata gialla Dettagli eccezione, mentre nell'ambiente di produzione verrà visualizzata la pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="27301-200">Oltre a questo comportamento esistente, lo sviluppatore riceve un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="27301-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="27301-201">La **Figura 2** illustra il messaggio di posta elettronica ricevuto durante la visita `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="27301-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="27301-202">Il corpo del messaggio riepiloga le informazioni sull'eccezione, mentre l'allegato `YSOD.htm` Visualizza il contenuto illustrato nei dettagli dell'eccezione YSOD (vedere la **Figura 3**).</span><span class="sxs-lookup"><span data-stu-id="27301-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="27301-203">**Figura 2**: lo sviluppatore riceve una notifica di posta elettronica ogni volta che si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="27301-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="27301-204">([Fare clic per visualizzare l'immagine con dimensioni complete](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="27301-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="27301-205">**Figura 3**: la notifica tramite posta elettronica include i dettagli dell'eccezione YSOD come allegato</span><span class="sxs-lookup"><span data-stu-id="27301-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="27301-206">([Fare clic per visualizzare l'immagine con dimensioni complete](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="27301-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="27301-207">Che cosa si sta usando la pagina di errore personalizzata?</span><span class="sxs-lookup"><span data-stu-id="27301-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="27301-208">In questa esercitazione è stato illustrato come utilizzare `Global.asax` e il gestore dell'evento `Application_Error` per eseguire il codice quando si verifica un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="27301-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="27301-209">In particolare, questo gestore eventi è stato usato per notificare a uno sviluppatore un errore. è possibile estenderlo per registrare anche i dettagli dell'errore in un database.</span><span class="sxs-lookup"><span data-stu-id="27301-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="27301-210">La presenza del gestore dell'evento `Application_Error` non influisce sull'esperienza dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="27301-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="27301-211">Visualizzano comunque la pagina di errore configurata, i dettagli dell'errore YSOD, l'errore di runtime YSOD o la pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="27301-212">È naturale chiedersi se il file `Global.asax` e l'evento `Application_Error` sono necessari quando si usa una pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="27301-213">Quando si verifica un errore, l'utente Visualizza la pagina di errore personalizzata, quindi perché non è possibile inserire il codice per inviare una notifica allo sviluppatore e registrare i dettagli dell'errore nella classe code-behind della pagina di errore personalizzata?</span><span class="sxs-lookup"><span data-stu-id="27301-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="27301-214">Sebbene sia certamente possibile aggiungere codice alla classe code-behind della pagina di errore personalizzata, non è possibile accedere ai dettagli dell'eccezione che ha attivato l'evento `Error` quando si usa la tecnica esplorata nell'esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="27301-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="27301-215">La chiamata del metodo `GetLastError` dalla pagina di errore personalizzata restituisce `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="27301-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="27301-216">Il motivo di questo comportamento è dovuto al fatto che la pagina di errore personalizzata viene raggiunta tramite un reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="27301-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="27301-217">Quando un'eccezione non gestita raggiunge il runtime ASP.NET, il motore ASP.NET genera il relativo evento `Error` (che esegue il gestore dell'evento `Application_Error`) e quindi *reindirizza* l'utente alla pagina di errore personalizzata emettendo un `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="27301-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="27301-218">Il metodo `Response.Redirect` invia una risposta al client con un codice di stato HTTP 302, indicando al browser di richiedere un nuovo URL, ovvero la pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="27301-219">Il browser richiede quindi automaticamente la nuova pagina.</span><span class="sxs-lookup"><span data-stu-id="27301-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="27301-220">È possibile indicare che la pagina di errore personalizzata è stata richiesta separatamente dalla pagina in cui ha avuto origine l'errore perché la barra degli indirizzi del browser viene modificata nell'URL della pagina di errore personalizzata (vedere la **Figura 4**).</span><span class="sxs-lookup"><span data-stu-id="27301-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="27301-221">**Figura 4**: quando si verifica un errore, il browser viene reindirizzato all'URL della pagina di errore personalizzata</span><span class="sxs-lookup"><span data-stu-id="27301-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="27301-222">([Fare clic per visualizzare l'immagine con dimensioni complete](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="27301-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="27301-223">Il risultato finale è che la richiesta in cui si è verificata l'eccezione non gestita termina quando il server risponde con il reindirizzamento HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="27301-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="27301-224">La richiesta successiva alla pagina di errore personalizzata è una nuova richiesta. a questo punto il motore ASP.NET ha ignorato le informazioni sull'errore e, inoltre, non ha modo di associare l'eccezione non gestita nella richiesta precedente con la nuova richiesta per la pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="27301-225">Questo è il motivo per cui `GetLastError` restituisce `null` quando viene chiamato dalla pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="27301-226">Tuttavia, è possibile che la pagina di errore personalizzata venga eseguita durante la stessa richiesta che ha causato l'errore.</span><span class="sxs-lookup"><span data-stu-id="27301-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="27301-227">Il metodo [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) trasferisce l'esecuzione all'URL specificato e lo elabora all'interno della stessa richiesta.</span><span class="sxs-lookup"><span data-stu-id="27301-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="27301-228">È possibile spostare il codice nel gestore eventi `Application_Error` nella classe code-behind della pagina di errore personalizzata, sostituendo tale codice in `Global.asax` con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="27301-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="27301-229">A questo punto, quando si verifica un'eccezione non gestita, il gestore eventi `Application_Error` trasferisce il controllo alla pagina di errore personalizzata appropriata in base al codice di stato HTTP.</span><span class="sxs-lookup"><span data-stu-id="27301-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="27301-230">Poiché il controllo è stato trasferito, la pagina di errore personalizzata ha accesso alle informazioni sulle eccezioni non gestite tramite `Server.GetLastError` e può inviare una notifica a uno sviluppatore dell'errore e registrarne i dettagli.</span><span class="sxs-lookup"><span data-stu-id="27301-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="27301-231">La chiamata `Server.Transfer` impedisce al motore ASP.NET di reindirizzare l'utente alla pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="27301-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="27301-232">Al contrario, il contenuto della pagina di errore personalizzata viene restituito come risposta alla pagina che ha generato l'errore.</span><span class="sxs-lookup"><span data-stu-id="27301-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="27301-233">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="27301-233">Summary</span></span>

<span data-ttu-id="27301-234">Quando si verifica un'eccezione non gestita in un'applicazione Web ASP.NET, il runtime di ASP.NET genera l'evento `Error` e visualizza la pagina di errore configurata.</span><span class="sxs-lookup"><span data-stu-id="27301-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="27301-235">È possibile notificare allo sviluppatore l'errore, registrarne i dettagli o elaborarlo in altro modo, creando un gestore eventi per l'evento di errore.</span><span class="sxs-lookup"><span data-stu-id="27301-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="27301-236">Esistono due modi per creare un gestore eventi per `HttpApplication` eventi come `Error`: nel file di `Global.asax` o da un modulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="27301-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="27301-237">In questa esercitazione è stato illustrato come creare un gestore dell'evento `Error` nel file di `Global.asax` che informa gli sviluppatori di un errore per mezzo di un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="27301-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="27301-238">La creazione di un gestore eventi `Error` è utile se è necessario elaborare le eccezioni non gestite in modo univoco o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="27301-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="27301-239">Tuttavia, la creazione di un gestore dell'evento `Error` per registrare l'eccezione o per inviare una notifica a uno sviluppatore non è il modo più efficiente del tempo poiché esiste già una raccolta di log degli errori gratuita e facile da usare che può essere configurata in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="27301-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="27301-240">Le due esercitazioni successive esaminano due librerie di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="27301-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="27301-241">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="27301-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="27301-242">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="27301-242">Further Reading</span></span>

<span data-ttu-id="27301-243">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="27301-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="27301-244">Cenni preliminari sui moduli HTTP ASP.NET e sui gestori HTTP</span><span class="sxs-lookup"><span data-stu-id="27301-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="27301-245">Risposta normale a eccezioni non gestite-elaborazione di eccezioni non gestite</span><span class="sxs-lookup"><span data-stu-id="27301-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="27301-246">Classe `HttpApplication` e oggetto applicazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="27301-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="27301-247">Gestori HTTP e moduli HTTP in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="27301-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="27301-248">Invio di messaggi di posta elettronica in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="27301-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="27301-249">Informazioni sul file di `Global.asax`</span><span class="sxs-lookup"><span data-stu-id="27301-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="27301-250">Uso di moduli e gestori HTTP per creare componenti ASP.NET collegabili</span><span class="sxs-lookup"><span data-stu-id="27301-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="27301-251">Uso del file di `Global.asax` ASP.NET</span><span class="sxs-lookup"><span data-stu-id="27301-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="27301-252">Utilizzo delle istanze di `HttpApplication`</span><span class="sxs-lookup"><span data-stu-id="27301-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="27301-253">[Precedente](displaying-a-custom-error-page-cs.md)
> [Successivo](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="27301-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
