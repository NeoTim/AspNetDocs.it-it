---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: L'elaborazione di eccezioni non gestite (c#) | Microsoft Docs
author: rick-anderson
description: Quando si verifica un errore di runtime in un'applicazione web nell'ambiente di produzione è importante per notificare a uno sviluppatore e di registrare l'errore, in modo che potrebbe essere diagnosticato in un oggetto la...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: d94f0a3c931100d2c79513b1ad7ae0e77d7fcff6
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/01/2019
ms.locfileid: "57060708"
---
<a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="053ac-103">Elaborazione delle eccezioni non gestite (C#)</span><span class="sxs-lookup"><span data-stu-id="053ac-103">Processing Unhandled Exceptions (C#)</span></span>
====================
<span data-ttu-id="053ac-104">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="053ac-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="053ac-105">[Visualizzare o scaricare il codice di esempio](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([procedura per il download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="053ac-105">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="053ac-106">Quando si verifica un errore di runtime in un'applicazione web nell'ambiente di produzione è importante per notificare a uno sviluppatore e di registrare l'errore, in modo che potrebbe essere diagnosticato in un secondo momento nel tempo.</span><span class="sxs-lookup"><span data-stu-id="053ac-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="053ac-107">Questa esercitazione offre una panoramica su come ASP.NET elabora gli errori in fase di esecuzione ed esamina un modo per eseguire codice personalizzato ogni volta che un bolle di eccezione non gestita al runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="053ac-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="053ac-108">Introduzione</span><span class="sxs-lookup"><span data-stu-id="053ac-108">Introduction</span></span>

<span data-ttu-id="053ac-109">Quando si verifica un'eccezione non gestita in un'applicazione ASP.NET, viene propagato al runtime di ASP.NET, che genera il `Error` evento e viene visualizzata la pagina di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="053ac-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="053ac-110">Esistono tre tipi diversi di pagine di errore: il Runtime errore giallo schermata di morte (YSOD); i dettagli dell'eccezione YSOD; e pagine errori personalizzati.</span><span class="sxs-lookup"><span data-stu-id="053ac-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="053ac-111">Nel [esercitazione precedente](displaying-a-custom-error-page-cs.md) è stata configurata l'applicazione per usare una pagina di errore personalizzato per gli utenti remoti e il YSOD Dettagli eccezione per gli utenti che visitano in locale.</span><span class="sxs-lookup"><span data-stu-id="053ac-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="053ac-112">Utilizzo di una pagina di errore personalizzato Converto corrispondente l'aspetto del sito è preferito per il valore predefinito YSOD di errore di Runtime, ma la visualizzazione di una pagina di errore personalizzata è solo una parte di una soluzione di gestione degli errori completo.</span><span class="sxs-lookup"><span data-stu-id="053ac-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="053ac-113">Quando si verifica un errore in un'applicazione nell'ambiente di produzione, è importante che gli sviluppatori ricevono una notifica dell'errore, in modo che possano scoprirle la causa dell'eccezione e risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="053ac-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="053ac-114">Inoltre, i dettagli dell'errore devono essere registrati in modo che l'errore può essere esaminato e diagnosticato in un secondo momento nel tempo.</span><span class="sxs-lookup"><span data-stu-id="053ac-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="053ac-115">Questa esercitazione illustra come accedere ai dettagli di un'eccezione non gestita in modo che essi possono essere registrate e uno sviluppatore di una notifica.</span><span class="sxs-lookup"><span data-stu-id="053ac-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="053ac-116">Le due esercitazioni seguendo questo esplorare librerie di registrazione errore che, dopo un po' di configurazione, verranno automaticamente notificare agli sviluppatori di errori di runtime e i relativi dettagli di log.</span><span class="sxs-lookup"><span data-stu-id="053ac-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="053ac-117">Le informazioni esaminate in questa esercitazione sono particolarmente utile se è necessario elaborare le eccezioni non gestite in modo esclusivo o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="053ac-118">Nei casi in cui è solo necessario registrare l'eccezione e invia una notifica di uno sviluppatore, con un'errore durante la registrazione libreria è la soluzione.</span><span class="sxs-lookup"><span data-stu-id="053ac-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="053ac-119">Le due esercitazioni offrono una panoramica delle due librerie di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="053ac-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="053ac-120">L'esecuzione di codice quando il`Error`viene generato l'evento</span><span class="sxs-lookup"><span data-stu-id="053ac-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="053ac-121">Eventi forniscono un oggetto di un meccanismo per segnalare che si è verificato qualcosa di interessante e per un altro oggetto eseguire il codice nella risposta.</span><span class="sxs-lookup"><span data-stu-id="053ac-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="053ac-122">Uno sviluppatore ASP.NET si è abituati a pensare in termini di eventi.</span><span class="sxs-lookup"><span data-stu-id="053ac-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="053ac-123">Se si desidera eseguire il codice quando il visitatore sceglie un pulsante particolare, si crea un gestore eventi per tale pulsante `Click` eventi e inserire il codice non esiste.</span><span class="sxs-lookup"><span data-stu-id="053ac-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="053ac-124">Dato che il runtime ASP.NET genera relativi [ `Error` evento](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) ogni volta che si verifica un'eccezione non gestita, ne consegue che il codice per la registrazione dei dettagli dell'errore verrà inserito in un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="053ac-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="053ac-125">Ma come si crea un gestore eventi per il `Error` evento?</span><span class="sxs-lookup"><span data-stu-id="053ac-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="053ac-126">Il `Error` eventi sono uno dei molti eventi di [ `HttpApplication` classe](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) che vengono generati in determinate fasi della pipeline HTTP nel corso della durata di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="053ac-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="053ac-127">Ad esempio, il `HttpApplication` della classe [ `BeginRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) viene generato all'inizio di ogni richiesta; relativo [ `AuthenticateRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) viene generato quando un modulo di protezione ha identificato il richiedente.</span><span class="sxs-lookup"><span data-stu-id="053ac-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="053ac-128">Questi `HttpApplication` eventi offrono allo sviluppatore un mezzo per eseguire la logica personalizzata in vari momenti nel corso della durata di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="053ac-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="053ac-129">I gestori eventi per il `HttpApplication` eventi possono essere inseriti in un file speciale denominato `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="053ac-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="053ac-130">Per creare questo file nel sito Web, aggiungere un nuovo elemento alla radice del proprio sito Web usando il modello di classe di applicazione globale con il nome `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="053ac-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="053ac-131">**Figura 1**: Aggiungere `Global.asax` all'applicazione Web</span><span class="sxs-lookup"><span data-stu-id="053ac-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="053ac-132">([Fare clic per visualizzare l'immagine con dimensioni normali](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="053ac-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="053ac-133">Il contenuto e la struttura del `Global.asax` file creato da Visual Studio differisce leggermente in base al fatto che si usa un progetto di applicazione Web (WAP) o un progetto sito Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="053ac-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="053ac-134">Con un WAF, le `Global.asax` viene implementata come due file diversi - `Global.asax` e `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="053ac-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="053ac-135">Il `Global.asax` file non contiene alcun elemento, ma un `@Application` direttiva che fa riferimento il `.cs` file; l'evento in cui sono stati definiti gestori di interesse il `Global.asax.cs` file.</span><span class="sxs-lookup"><span data-stu-id="053ac-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="053ac-136">Per WSPs, viene creato solo un singolo file, `Global.asax`, e i gestori di eventi sono definiti in un `<script runat="server">` blocco.</span><span class="sxs-lookup"><span data-stu-id="053ac-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="053ac-137">Il `Global.asax` file creato in un WAF dal modello di classe di applicazione globale di Visual Studio include i gestori di eventi denominati `Application_BeginRequest`, `Application_AuthenticateRequest`, e `Application_Error`, che sono i gestori eventi per il `HttpApplication` eventi `BeginRequest`, `AuthenticateRequest`, e `Error`, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="053ac-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="053ac-138">Sono disponibili anche i gestori eventi denominati `Application_Start`, `Session_Start`, `Application_End`, e `Session_End`, quali sono i gestori di eventi che vengono generati all'avvio dell'applicazione web, quando viene avviata una nuova sessione, al termine dell'applicazione e quando termina una sessione, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="053ac-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="053ac-139">Il `Global.asax` file creato da Visual Studio in un WSP contiene solo le `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, e `Session_End` gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="053ac-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="053ac-140">Quando si distribuisce l'applicazione ASP.NET è necessario copiare il `Global.asax` file nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="053ac-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="053ac-141">Il `Global.asax.cs` file, che viene creato in WAP, non dovrà essere copiati nell'ambiente di produzione perché questo codice viene compilato nell'assembly del progetto.</span><span class="sxs-lookup"><span data-stu-id="053ac-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="053ac-142">I gestori di eventi creati dal modello di classe di applicazione globale di Visual Studio non sono esaustivi.</span><span class="sxs-lookup"><span data-stu-id="053ac-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="053ac-143">È possibile aggiungere un gestore eventi per qualsiasi `HttpApplication` evento assegnando un gestore dell'evento `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="053ac-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="053ac-144">Ad esempio, è possibile aggiungere il codice seguente per il `Global.asax` file per creare un gestore eventi per il [ `AuthorizeRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="053ac-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-cs[Main](processing-unhandled-exceptions-cs/samples/sample1.cs)]

<span data-ttu-id="053ac-145">Analogamente, è possibile rimuovere i gestori degli eventi creati dal modello di classe di applicazione globale non sono necessari.</span><span class="sxs-lookup"><span data-stu-id="053ac-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="053ac-146">Per questa esercitazione ti chiediamo solo un gestore eventi per il `Error` eventi; è possibile rimuovere altri gestori di eventi dal `Global.asax` file.</span><span class="sxs-lookup"><span data-stu-id="053ac-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="053ac-147">*Moduli HTTP* offrono un altro modo per definire i gestori eventi per `HttpApplication` gli eventi.</span><span class="sxs-lookup"><span data-stu-id="053ac-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="053ac-148">Moduli HTTP vengono creati come un file di classe che può essere inserito direttamente all'interno del progetto di applicazione web o suddivisi in una libreria di classi separata.</span><span class="sxs-lookup"><span data-stu-id="053ac-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="053ac-149">Poiché essi possono essere suddivisi tra una libreria di classi, moduli HTTP offrono un modello più flessibile e riutilizzabile per la creazione di `HttpApplication` gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="053ac-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="053ac-150">Mentre il `Global.asax` è specifico all'applicazione web in cui risiedono, moduli HTTP possono essere compilati in assembly, a questo punto aggiungere il modulo HTTP a un sito Web è semplice come l'eliminazione di assembly `Bin` cartella e la registrazione di Modulo in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="053ac-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="053ac-151">Questa esercitazione non ha l'aspetto nella creazione e uso di moduli HTTP, ma le librerie di registrazione degli errori due usate le esercitazioni seguenti mostrano due vengono implementate come moduli HTTP.</span><span class="sxs-lookup"><span data-stu-id="053ac-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="053ac-152">Per altre informazioni sui vantaggi di moduli HTTP si intende [usando moduli e gestori HTTP per creare componenti ASP.NET collegabili](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="053ac-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="053ac-153">Il recupero delle informazioni relative all'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="053ac-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="053ac-154">A questo punto si dispone di un file Global. asax con un `Application_Error` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="053ac-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="053ac-155">Quando si esegue questo gestore eventi è necessario inviare una notifica di uno sviluppatore dell'errore e i dettagli di log.</span><span class="sxs-lookup"><span data-stu-id="053ac-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="053ac-156">Per eseguire queste operazioni è necessario innanzitutto determinare i dettagli dell'eccezione generata.</span><span class="sxs-lookup"><span data-stu-id="053ac-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="053ac-157">Usare l'oggetto di Server [ `GetLastError` metodo](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) per recuperare i dettagli dell'eccezione non gestita che ha causato il `Error` dell'evento da generare.</span><span class="sxs-lookup"><span data-stu-id="053ac-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="053ac-158">Il `GetLastError` metodo restituisce un oggetto di tipo `Exception`, ovvero il tipo di base per tutte le eccezioni in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="053ac-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="053ac-159">Tuttavia, nel codice precedente sono cast l'oggetto di eccezione restituito da `GetLastError` in un `HttpException` oggetto.</span><span class="sxs-lookup"><span data-stu-id="053ac-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="053ac-160">Se il `Error` evento viene generato perché è stata generata un'eccezione durante l'elaborazione di una risorsa di ASP.NET, quindi viene eseguito il wrapping l'eccezione generata all'interno di un `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="053ac-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="053ac-161">Per ottenere l'eccezione che ha causato l'utilizzo di eventi di errore di `InnerException` proprietà.</span><span class="sxs-lookup"><span data-stu-id="053ac-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="053ac-162">Se il `Error` è stato generato l'evento a causa di un'eccezione basata su HTTP, ad esempio una richiesta per una pagina inesistente, un `HttpException` viene generata un'eccezione, ma non dispone di un'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="053ac-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="053ac-163">Il codice seguente usa il `GetLastErrormessage` per recuperare le informazioni relative all'eccezione che ha attivato il `Error` evento, l'archiviazione di `HttpException` in una variabile denominata `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="053ac-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="053ac-164">Quindi archivia il tipo di messaggio e analisi dello stack dell'eccezione origine in tre variabili stringa, un controllo per verificare se il `lastErrorWrapper` è l'eccezione che ha attivato il `Error` eventi (nel caso di eccezioni basato su HTTP) o se è semplicemente un wrapper per un'eccezione generata durante l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="053ac-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="053ac-165">A questo punto si dispongano di tutte le informazioni necessarie per scrivere codice che verrà registrati i dettagli dell'eccezione in una tabella di database.</span><span class="sxs-lookup"><span data-stu-id="053ac-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="053ac-166">È possibile creare una tabella di database con colonne per ognuno dei dettagli dell'errore di interesse - il tipo, il messaggio, l'analisi dello stack e così via - assieme ad altre utili informazioni, ad esempio l'URL della pagina richiesta e il nome dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="053ac-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="053ac-167">Nel `Application_Error` gestore eventi verrebbe quindi connettersi al database e inserire un record nella tabella.</span><span class="sxs-lookup"><span data-stu-id="053ac-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="053ac-168">Analogamente, è possibile aggiungere codice per uno sviluppatore dell'errore tramite posta elettronica di avviso.</span><span class="sxs-lookup"><span data-stu-id="053ac-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="053ac-169">Le librerie di registrazione errore esaminate nelle esercitazioni seguenti due forniscono tale funzionalità per impostazione predefinita, in modo che non è necessario creare questa registrazione degli errori e notifica.</span><span class="sxs-lookup"><span data-stu-id="053ac-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="053ac-170">Tuttavia, per illustrare che il `Error` evento viene generato e che il `Application_Error` gestore eventi può essere utilizzato per registrare i dettagli dell'errore e inviare una notifica di uno sviluppatore, aggiungere codice che invia una notifica di uno sviluppatore quando si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="053ac-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="053ac-171">Avvisare gli sviluppatori quando si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="053ac-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="053ac-172">Quando si verifica un'eccezione non gestita nell'ambiente di produzione è importante avvisare il team di sviluppo in modo da poter valutare l'errore e determinare cosa è necessario eseguire alcune azioni.</span><span class="sxs-lookup"><span data-stu-id="053ac-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="053ac-173">Ad esempio, se è presente un errore durante la connessione al database, è necessario in double controllare la stringa di connessione e, forse, aprire un ticket di supporto con le società di hosting web.</span><span class="sxs-lookup"><span data-stu-id="053ac-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="053ac-174">Se si è verificata l'eccezione a causa di un errore di programmazione, potrebbe essere necessario codice aggiuntivo o la logica di convalida da aggiungere per evitare tali errori in futuro.</span><span class="sxs-lookup"><span data-stu-id="053ac-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="053ac-175">Le classi .NET Framework nel [ `System.Net.Mail` dello spazio dei nomi](https://msdn.microsoft.com/library/system.net.mail.aspx) rendono semplice inviare un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="053ac-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="053ac-176">Il [ `MailMessage` classe](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) rappresenta un messaggio di posta elettronica e dispone di proprietà quali `To`, `From`, `Subject`, `Body`, e `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="053ac-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="053ac-177">Il `SmtpClass` viene usato per inviare un `MailMessage` utilizza un server SMTP specificato dell'oggetto; le impostazioni del server SMTP possono essere specificate a livello di programmazione o in modo dichiarativo nel [ `<system.net>` elemento](https://msdn.microsoft.com/library/6484zdc1.aspx) nel `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="053ac-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="053ac-178">Per altre informazioni sull'invio di posta elettronica dei messaggi in un'applicazione ASP.NET consultare il mio articolo [l'invio di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)e il [domande frequenti su System.NET. Mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="053ac-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="053ac-179">Il `<system.net>` elemento contiene le impostazioni del server SMTP utilizzate dal `SmtpClient` classe quando si invia un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="053ac-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="053ac-180">Le società di web hosting probabilmente ha un server SMTP che è possibile usare per inviare posta elettronica dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="053ac-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="053ac-181">Per informazioni sulle impostazioni di server SMTP, che è consigliabile usare nell'applicazione web, vedere sezione relativa al supporto dell'host web.</span><span class="sxs-lookup"><span data-stu-id="053ac-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="053ac-182">Aggiungere il codice seguente per il `Application_Error` gestore eventi per inviare uno sviluppatore di un messaggio di posta elettronica quando si verifica un errore:</span><span class="sxs-lookup"><span data-stu-id="053ac-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="053ac-183">Mentre il codice sopra riportato è piuttosto lungo, la maggior parte di esso crea il codice HTML visualizzato nel messaggio di posta elettronica inviato agli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="053ac-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="053ac-184">Inizia il codice facendo riferimento il `HttpException` restituito dal `GetLastError` metodo (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="053ac-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="053ac-185">L'eccezione che è stato generato dalla richiesta viene recuperato tramite `lastErrorWrapper.InnerException` e viene assegnato alla variabile `lastError`.</span><span class="sxs-lookup"><span data-stu-id="053ac-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="053ac-186">Il tipo di messaggio e stack le informazioni di traccia viene recuperate da `lastError` e archiviati in tre variabili di stringa.</span><span class="sxs-lookup"><span data-stu-id="053ac-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="053ac-187">Successivamente, una `MailMessage` oggetto denominato `mm` viene creato.</span><span class="sxs-lookup"><span data-stu-id="053ac-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="053ac-188">Il corpo del messaggio di posta elettronica è HTML formattato e visualizza l'URL della pagina richiesta, il nome dell'utente attualmente connesso e informazioni sull'eccezione (il tipo di messaggio e analisi dello stack).</span><span class="sxs-lookup"><span data-stu-id="053ac-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="053ac-189">Uno degli aspetti interessanti le `HttpException` classe è che è possibile generare il codice HTML utilizzato per creare l'eccezione dettagli giallo schermata di morte (YSOD) chiamando il [metodo GetHtmlErrorMessage](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="053ac-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="053ac-190">Questo metodo viene usato qui per recuperare il markup YSOD Dettagli eccezione e aggiungerlo al messaggio di posta elettronica come allegato.</span><span class="sxs-lookup"><span data-stu-id="053ac-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="053ac-191">Attenzione: se l'eccezione che ha attivato la `Error` evento è verificata un'eccezione basata su HTTP (ad esempio una richiesta per una pagina inesistente) il `GetHtmlErrorMessage` metodo restituirà `null`.</span><span class="sxs-lookup"><span data-stu-id="053ac-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="053ac-192">Il passaggio finale consiste nell'inviare il `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="053ac-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="053ac-193">Questa operazione viene eseguita creando un nuovo `SmtpClient` metodo e chiamando il metodo relativo `Send` (metodo).</span><span class="sxs-lookup"><span data-stu-id="053ac-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="053ac-194">Prima di usare questo codice nell'applicazione web è opportuno modificare i valori nel `ToAddress` e `FromAddress` costanti da support@example.com a qualsiasi messaggio di posta elettronica indirizzo l'e-mail di notifica di errore devono essere inviati a e hanno origine da.</span><span class="sxs-lookup"><span data-stu-id="053ac-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="053ac-195">È anche necessario specificare le impostazioni server SMTP nel `<system.net>` sezione `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="053ac-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="053ac-196">Consultare il provider di hosting web per determinare le impostazioni del server SMTP da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="053ac-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="053ac-197">Con questo codice attivo ogni volta che si verifica un errore allo sviluppatore viene inviato un messaggio di posta elettronica che riepiloga l'errore e include il YSOD.</span><span class="sxs-lookup"><span data-stu-id="053ac-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="053ac-198">Nell'esercitazione precedente è stato illustrato un errore di runtime che visitano Genre.aspx e passando un valore non valido `ID` valore tramite la stringa di query, ad esempio `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="053ac-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="053ac-199">Visita la pagina con il `Global.asax` file sul posto genera la stessa esperienza utente, come nell'esercitazione precedente, nell'ambiente di sviluppo si continuerà a vedere l'eccezione dettagli giallo schermata di morte, mentre nell'ambiente di produzione sarà vedere la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="053ac-200">Oltre a questo comportamento esistente, lo sviluppatore viene inviato un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="053ac-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="053ac-201">**Figura 2** Mostra il messaggio di posta elettronica ricevuto quando si visita `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="053ac-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="053ac-202">Il corpo del messaggio di posta elettronica sono riepilogate le informazioni sull'eccezione, mentre il `YSOD.htm` allegato viene visualizzato il contenuto disponibile nella finestra di YSOD Dettagli eccezione (vedere **figura 3**).</span><span class="sxs-lookup"><span data-stu-id="053ac-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="053ac-203">**Figura 2**: Lo sviluppatore viene inviato una notifica di posta elettronica ogni volta che si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="053ac-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="053ac-204">([Fare clic per visualizzare l'immagine con dimensioni normali](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="053ac-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="053ac-205">**Figura 3**: La notifica di posta elettronica include i dettagli dell'eccezione YSOD come allegato</span><span class="sxs-lookup"><span data-stu-id="053ac-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="053ac-206">([Fare clic per visualizzare l'immagine con dimensioni normali](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="053ac-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="053ac-207">Che cosa succede su come utilizzare la pagina di errore personalizzato?</span><span class="sxs-lookup"><span data-stu-id="053ac-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="053ac-208">Questa esercitazione ha illustrato come usare `Global.asax` e il `Application_Error` gestore eventi per eseguire codice quando si verifica un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="053ac-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="053ac-209">In particolare, è stato usato questo gestore dell'evento per notificare lo sviluppatore di un errore. può essere esteso in modo da registrare anche i dettagli dell'errore in un database.</span><span class="sxs-lookup"><span data-stu-id="053ac-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="053ac-210">La presenza del `Application_Error` gestore eventi non influisce sul esperienza dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="053ac-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="053ac-211">Sono ancora visualizzata la pagina degli errori configurato, sia esso YSOD di dettagli di errore, YSOD l'errore di Runtime o la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="053ac-212">È naturale chiedersi se il `Global.asax` file e `Application_Error` eventi sono necessario quando si usa una pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="053ac-213">Quando si verifica un errore all'utente viene visualizzata la pagina di errore personalizzato perché non possiamo è inseriamo il codice per notificare lo sviluppatore e registrare i dettagli dell'errore nella classe code-behind della pagina di errore personalizzato?</span><span class="sxs-lookup"><span data-stu-id="053ac-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="053ac-214">Mentre è certamente possibile aggiungere codice alla classe code-behind della pagina errori personalizzati non si sono disponibili per i dettagli dell'eccezione che ha attivato il `Error` eventi quando si usa la tecnica sono stati presentati nell'esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="053ac-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="053ac-215">Chiama il `GetLastError` metodo dalla pagina di errore personalizzato restituisce `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="053ac-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="053ac-216">Il motivo per questo comportamento è che la pagina di errore personalizzato viene raggiunta tramite un reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="053ac-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="053ac-217">Quando un'eccezione non gestita raggiunge il runtime ASP.NET il motore ASP.NET genera relativi `Error` eventi (che viene eseguito il `Application_Error` gestore eventi) e quindi *reindirizza* l'utente alla pagina di errore personalizzato tramite l'esecuzione di una `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="053ac-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="053ac-218">Il `Response.Redirect` metodo invia una risposta al client con un codice di stato HTTP 302, che indicano il browser per richiedere un nuovo URL, vale a dire la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="053ac-219">Il browser richiede quindi automaticamente la nuova pagina.</span><span class="sxs-lookup"><span data-stu-id="053ac-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="053ac-220">È possibile indicare che la pagina di errore personalizzato è stato richiesto separatamente dalla pagina in cui è verificato l'errore poiché viene modificata la barra degli indirizzi del browser all'URL pagina di errore personalizzata (vedere **figura 4**).</span><span class="sxs-lookup"><span data-stu-id="053ac-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="053ac-221">**Figura 4**: Quando si verifica un errore nel Browser viene reindirizzato all'URL pagina di errore personalizzato</span><span class="sxs-lookup"><span data-stu-id="053ac-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="053ac-222">([Fare clic per visualizzare l'immagine con dimensioni normali](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="053ac-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="053ac-223">Il risultato finale è che la richiesta in cui si è verificata un'eccezione non gestita termina quando il server risponde con il reindirizzamento HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="053ac-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="053ac-224">La richiesta successiva alla pagina di errore personalizzato è una nuova richiesta. a questo punto ASP.NET motore ha eliminato le informazioni sull'errore e, inoltre, non è possibile associare all'eccezione non gestita nella richiesta precedente con la nuova richiesta per la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="053ac-225">È per questo motivo `GetLastError` restituisce `null` quando viene chiamato dalla pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="053ac-226">Tuttavia, è possibile inserire la pagina di errore personalizzato eseguita durante la stessa richiesta che ha causato l'errore.</span><span class="sxs-lookup"><span data-stu-id="053ac-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="053ac-227">Il [ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) metodo trasferisce l'esecuzione all'URL specificato e lo elabora all'interno della stessa richiesta.</span><span class="sxs-lookup"><span data-stu-id="053ac-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="053ac-228">È possibile spostare il codice `Application_Error` gestore eventi per classe code-behind della pagina di errore personalizzata, sostituirla in `Global.asax` con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="053ac-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="053ac-229">A questo punto quando si verifica un'eccezione non gestita di `Application_Error` gestore dell'evento trasferisce il controllo alla pagina di errore personalizzato appropriato in base al codice di stato HTTP.</span><span class="sxs-lookup"><span data-stu-id="053ac-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="053ac-230">Poiché il controllo è stato trasferito, la pagina di errore personalizzato ha accesso alle informazioni relative all'eccezione non gestita tramite `Server.GetLastError` e possono notificare a uno sviluppatore dell'errore e i dettagli di log.</span><span class="sxs-lookup"><span data-stu-id="053ac-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="053ac-231">Il `Server.Transfer` chiamata si arresta il motore ASP.NET da reindirizzare l'utente alla pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="053ac-232">Contenuto della pagina errori personalizzati, invece, viene restituito come la risposta alla pagina che ha generato l'errore.</span><span class="sxs-lookup"><span data-stu-id="053ac-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="053ac-233">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="053ac-233">Summary</span></span>

<span data-ttu-id="053ac-234">Quando si verifica un'eccezione non gestita in un'applicazione web ASP.NET il runtime ASP.NET genera il `Error` eventi e consente di visualizzare la pagina di errore configurata.</span><span class="sxs-lookup"><span data-stu-id="053ac-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="053ac-235">Si riceverà lo sviluppatore dell'errore, i dettagli di log o elaborarli in qualche altro modo, tramite la creazione di un gestore eventi per l'evento di errore.</span><span class="sxs-lookup"><span data-stu-id="053ac-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="053ac-236">Esistono due modi per creare un gestore eventi per `HttpApplication` eventi come `Error`: nel `Global.asax` file o da un modulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="053ac-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="053ac-237">Questa esercitazione ha illustrato come creare un `Error` gestore dell'evento nel `Global.asax` file che invia una notifica agli sviluppatori di un errore per mezzo di un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="053ac-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="053ac-238">Creazione di un `Error` gestore eventi è utile se è necessario elaborare le eccezioni non gestite in modo esclusivo o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="053ac-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="053ac-239">Tuttavia, crearne una propria `Error` gestore dell'evento per registrare l'eccezione o per inviare una notifica di uno sviluppatore non è ottimizzare l'uso del tuo tempo perché esistono già librerie di registrazione errore gratuito e facile da usare che possono essere configurata in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="053ac-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="053ac-240">Le due esercitazioni esaminare due librerie di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="053ac-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="053ac-241">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="053ac-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="053ac-242">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="053ac-242">Further Reading</span></span>

<span data-ttu-id="053ac-243">Per altre informazioni sugli argomenti trattati in questa esercitazione, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="053ac-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="053ac-244">Cenni preliminari sui gestori HTTP e moduli HTTP ASP.NET</span><span class="sxs-lookup"><span data-stu-id="053ac-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="053ac-245">Risponde correttamente alle eccezioni non gestite - l'elaborazione di eccezioni non gestite</span><span class="sxs-lookup"><span data-stu-id="053ac-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="053ac-246">`HttpApplication` Classe e l'oggetto di applicazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="053ac-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="053ac-247">I gestori HTTP e moduli HTTP in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="053ac-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="053ac-248">L'invio di posta elettronica in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="053ac-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="053ac-249">La comprensione di `Global.asax` File</span><span class="sxs-lookup"><span data-stu-id="053ac-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="053ac-250">Uso di moduli e gestori HTTP per creare componenti ASP.NET collegabili</span><span class="sxs-lookup"><span data-stu-id="053ac-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="053ac-251">Utilizzo di ASP.NET `Global.asax` File</span><span class="sxs-lookup"><span data-stu-id="053ac-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="053ac-252">Utilizzo di `HttpApplication` istanze</span><span class="sxs-lookup"><span data-stu-id="053ac-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="053ac-253">[Precedente](displaying-a-custom-error-page-cs.md)
> [Successivo](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="053ac-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
