---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: Autorizzazione basata sull'utente (VB) | Microsoft Docs
author: rick-anderson
description: In questa esercitazione verrà illustrato come limitare l'accesso alle pagine e come limitare la funzionalità a livello di pagina tramite diverse tecniche.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: dfac0c6fa955e59c6ea996533f2447e89ec8d468
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588209"
---
# <a name="user-based-authorization-vb"></a><span data-ttu-id="5b8d1-103">Autorizzazione basata sull'utente (VB)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-103">User-Based Authorization (VB)</span></span>

<span data-ttu-id="5b8d1-104">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5b8d1-105">[Scarica codice](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) o [Scarica PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-105">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="5b8d1-106">In questa esercitazione verrà illustrato come limitare l'accesso alle pagine e come limitare la funzionalità a livello di pagina tramite diverse tecniche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="5b8d1-107">Introduzione</span><span class="sxs-lookup"><span data-stu-id="5b8d1-107">Introduction</span></span>

<span data-ttu-id="5b8d1-108">La maggior parte delle applicazioni Web che offrono account utente consente di limitare l'accesso di determinati utenti a determinate pagine all'interno del sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="5b8d1-109">Nella maggior parte dei siti messageboard online, ad esempio tutti gli utenti anonimi e autenticati, sono in grado di visualizzare i post di messageboard, ma solo gli utenti autenticati possono visitare la pagina Web per creare un nuovo post.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="5b8d1-110">Potrebbero essere presenti pagine amministrative accessibili solo a un determinato utente (o a un particolare gruppo di utenti).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="5b8d1-111">Inoltre, le funzionalità a livello di pagina possono variare in base agli utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="5b8d1-112">Quando si visualizza un elenco di post, agli utenti autenticati viene mostrata un'interfaccia per la classificazione di ogni post, mentre questa interfaccia non è disponibile per i visitatori anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="5b8d1-113">ASP.NET semplifica la definizione delle regole di autorizzazione basate sugli utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="5b8d1-114">Con un semplice markup in `Web.config`, è possibile bloccare pagine Web specifiche o intere directory in modo che siano accessibili solo a un subset di utenti specificato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="5b8d1-115">La funzionalità a livello di pagina può essere attivata o disattivata in base all'utente attualmente connesso tramite un metodo programmatico e dichiarativo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="5b8d1-116">In questa esercitazione verrà illustrato come limitare l'accesso alle pagine e come limitare la funzionalità a livello di pagina tramite diverse tecniche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="5b8d1-117">Iniziamo!</span><span class="sxs-lookup"><span data-stu-id="5b8d1-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="5b8d1-118">Esaminare il flusso di lavoro di autorizzazione URL</span><span class="sxs-lookup"><span data-stu-id="5b8d1-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="5b8d1-119">Come illustrato nell'esercitazione [*Panoramica dell'autenticazione basata su form*](../introduction/an-overview-of-forms-authentication-vb.md) , quando il runtime ASP.NET elabora una richiesta di una risorsa ASP.NET, la richiesta genera un certo numero di eventi durante il ciclo di vita.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="5b8d1-120">I *moduli HTTP* sono classi gestite il cui codice viene eseguito in risposta a un evento specifico nel ciclo di vita della richiesta.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="5b8d1-121">ASP.NET viene fornito con una serie di moduli HTTP che eseguono attività essenziali dietro le quinte.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="5b8d1-122">Uno di questi moduli HTTP è [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="5b8d1-123">Come illustrato nelle esercitazioni precedenti, la funzione principale del `FormsAuthenticationModule` consiste nel determinare l'identità della richiesta corrente.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="5b8d1-124">Questa operazione viene eseguita controllando il ticket di autenticazione basata su form, che si trova in un cookie o incorporato all'interno dell'URL.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="5b8d1-125">Questa identificazione si verifica durante l' [evento`AuthenticateRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="5b8d1-126">Un altro modulo HTTP importante è il [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), che viene generato in risposta all' [evento di`AuthorizeRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (che si verifica dopo l'evento di `AuthenticateRequest`).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="5b8d1-127">Il `UrlAuthorizationModule` esamina il markup di configurazione in `Web.config` per determinare se l'identità corrente dispone dell'autorità per visitare la pagina specificata.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="5b8d1-128">Questo processo è denominato *autorizzazione URL*.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="5b8d1-129">Si esaminerà la sintassi per le regole di autorizzazione dell'URL nel passaggio 1, ma prima di tutto si osserverà il risultato della `UrlAuthorizationModule` a seconda che la richiesta sia autorizzata o meno.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="5b8d1-130">Se il `UrlAuthorizationModule` determina che la richiesta è autorizzata, non esegue alcuna operazione e la richiesta continua con il ciclo di vita.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="5b8d1-131">Tuttavia, se la richiesta non è autorizzata, il `UrlAuthorizationModule` interrompe il ciclo di vita e indica all'oggetto `Response` di restituire uno stato *non* [autorizzato HTTP 401](http://www.checkupdown.com/status/E401.html) .</span><span class="sxs-lookup"><span data-stu-id="5b8d1-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="5b8d1-132">Quando si usa l'autenticazione basata su form, questo stato HTTP 401 non viene mai restituito al client perché se il `FormsAuthenticationModule` rileva uno stato HTTP 401, lo stato viene modificato in un [reindirizzamento http 302](http://www.checkupdown.com/status/E302.html) alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="5b8d1-133">Nella figura 1 viene illustrato il flusso di lavoro della pipeline ASP.NET, il `FormsAuthenticationModule`e il `UrlAuthorizationModule` quando arriva una richiesta non autorizzata.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="5b8d1-134">In particolare, nella figura 1 viene illustrata una richiesta da parte di un visitatore anonimo per `ProtectedPage.aspx`, ovvero una pagina che nega l'accesso agli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="5b8d1-135">Poiché il visitatore è anonimo, il `UrlAuthorizationModule` interrompe la richiesta e restituisce uno stato non autorizzato HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="5b8d1-136">Il `FormsAuthenticationModule` converte quindi lo stato 401 in una pagina di accesso Reindirizzamento a 302.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="5b8d1-137">Dopo che l'utente è stato autenticato tramite la pagina di accesso, viene reindirizzato a `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="5b8d1-138">Questa volta il `FormsAuthenticationModule` identifica l'utente in base al ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="5b8d1-139">Ora che il visitatore è autenticato, il `UrlAuthorizationModule` consente l'accesso alla pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="5b8d1-140">[![il flusso di lavoro di autenticazione basata su form e autorizzazione URL](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="5b8d1-141">**Figura 1**: flusso di lavoro di autenticazione basata su form e autorizzazione URL ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>

<span data-ttu-id="5b8d1-142">Nella figura 1 viene illustrata l'interazione che si verifica quando un visitatore anonimo tenta di accedere a una risorsa che non è disponibile per gli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="5b8d1-143">In tal caso, il visitatore anonimo viene reindirizzato alla pagina di accesso con la pagina che ha tentato di visitare specificata nella QueryString.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="5b8d1-144">Una volta che l'utente ha effettuato l'accesso, verrà automaticamente reindirizzato alla risorsa che stava tentando inizialmente di visualizzare.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="5b8d1-145">Quando la richiesta non autorizzata viene effettuata da un utente anonimo, questo flusso di lavoro è semplice ed è facile per il visitatore capire cosa si è verificato e perché.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="5b8d1-146">Tenere tuttavia presente che il `FormsAuthenticationModule` reindirizza *eventuali* utenti non autorizzati alla pagina di accesso, anche se la richiesta viene effettuata da un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="5b8d1-147">Questo può comportare un'esperienza utente confusa se un utente autenticato tenta di visitare una pagina per la quale non dispone di autorità.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="5b8d1-148">Si supponga che il sito Web abbia le regole di autorizzazione URL configurate in modo che la pagina ASP.NET `OnlyTito.aspx` sia accessibilmente solo a Tito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="5b8d1-149">A questo punto, si supponga che Sam visiti il sito, acceda e tenti di visitare `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="5b8d1-150">Il `UrlAuthorizationModule` arresterà il ciclo di vita della richiesta e restituirà uno stato non autorizzato HTTP 401, che verrà rilevato dal `FormsAuthenticationModule` e quindi reindirizza Sam alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="5b8d1-151">Poiché Sam ha già eseguito l'accesso, tuttavia, può chiedersi perché è stato inviato nuovamente alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="5b8d1-152">Potrebbe essere il motivo per cui le credenziali di accesso sono state perse in qualche modo o che ha immesso credenziali non valide.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="5b8d1-153">Se Sam riimmette le proprie credenziali nella pagina di accesso, si sarà connessi (nuovamente) e verrà reindirizzato a `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="5b8d1-154">Il `UrlAuthorizationModule` rileverà che Sam non può visitare questa pagina e verrà restituita alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="5b8d1-155">Nella figura 2 viene illustrato questo flusso di lavoro confuso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="5b8d1-156">[![il flusso di lavoro predefinito può causare un ciclo confusione](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="5b8d1-157">**Figura 2**: il flusso di lavoro predefinito può causare un ciclo confusionario ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>

<span data-ttu-id="5b8d1-158">Il flusso di lavoro illustrato nella figura 2 può Befuddle rapidamente anche il visitatore più esperto di computer.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="5b8d1-159">Si esamineranno i modi per evitare questo ciclo di confusione nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-160">ASP.NET utilizza due meccanismi per determinare se l'utente corrente può accedere a una particolare pagina Web: autorizzazione URL e autorizzazione file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="5b8d1-161">L'autorizzazione file viene implementata dal [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), che determina l'autorità consultando gli ACL dei file richiesti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="5b8d1-162">L'autorizzazione per i file viene usata più di frequente con l'autenticazione di Windows poiché gli ACL sono autorizzazioni valide per gli account di Windows.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="5b8d1-163">Quando si usa l'autenticazione basata su form, tutte le richieste a livello di sistema operativo e di file system vengono eseguite dallo stesso account di Windows, indipendentemente dall'utente che visita il sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="5b8d1-164">Poiché questa serie di esercitazioni è incentrata sull'autenticazione basata su form, non verrà discussa l'autorizzazione per i file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="5b8d1-165">Ambito dell'autorizzazione URL</span><span class="sxs-lookup"><span data-stu-id="5b8d1-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="5b8d1-166">Il `UrlAuthorizationModule` è codice gestito che fa parte del runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="5b8d1-167">Prima della versione 7 del server Web di Microsoft [Internet Information Services (IIS)](https://www.iis.net/) , esisteva una barriera distinta tra la pipeline HTTP di IIS e la pipeline del runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="5b8d1-168">In breve, in IIS 6 e versioni precedenti, ASP. La `UrlAuthorizationModule` di rete viene eseguita solo quando una richiesta viene delegata da IIS al runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="5b8d1-169">Per impostazione predefinita, IIS elabora il contenuto statico, ad esempio pagine HTML e CSS, JavaScript e file di immagine, e invia le richieste al runtime ASP.NET solo quando viene richiesta una pagina con estensione `.aspx`, `.asmx`o `.ashx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="5b8d1-170">IIS 7, tuttavia, consente le pipeline IIS e ASP.NET integrate.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="5b8d1-171">Con alcune impostazioni di configurazione è possibile configurare IIS 7 per richiamare il `UrlAuthorizationModule` per *tutte* le richieste, vale a dire che è possibile definire le regole di autorizzazione dell'URL per i file di qualsiasi tipo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="5b8d1-172">Inoltre, IIS 7 include il proprio motore di autorizzazione URL.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="5b8d1-173">Per ulteriori informazioni sull'integrazione di ASP.NET e sulla funzionalità di autorizzazione URL nativa di IIS 7, vedere [informazioni sull'autorizzazione dell'URL IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="5b8d1-174">Per un'analisi più approfondita dell'integrazione di ASP.NET e IIS 7, è prevedibile una copia del libro di Khosravi di, *Professional IIS 7 e ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="5b8d1-175">In breve, nelle versioni precedenti a IIS 7, le regole di autorizzazione URL vengono applicate solo alle risorse gestite dal runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="5b8d1-176">Con IIS 7 è tuttavia possibile utilizzare la funzionalità di autorizzazione URL nativa di IIS o per integrare ASP. `UrlAuthorizationModule` NET nella pipeline HTTP di IIS, estendendo così questa funzionalità a tutte le richieste.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-177">Esistono alcune differenze significative ma importanti per la modalità di ASP. La funzionalità di autorizzazione URL di NET `UrlAuthorizationModule` e IIS 7 elabora le regole di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="5b8d1-178">In questa esercitazione non vengono esaminate le funzionalità di autorizzazione URL di IIS 7 o le differenze nella modalità di analisi delle regole di autorizzazione rispetto al `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="5b8d1-179">Per ulteriori informazioni su questi argomenti, vedere la documentazione di IIS 7 su MSDN o all'indirizzo [www.IIS.NET](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="5b8d1-180">Passaggio 1: definizione delle regole di autorizzazione URL in`Web.config`</span><span class="sxs-lookup"><span data-stu-id="5b8d1-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="5b8d1-181">Il `UrlAuthorizationModule` determina se concedere o negare l'accesso a una risorsa richiesta per una determinata identità in base alle regole di autorizzazione URL definite nella configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="5b8d1-182">Le regole di autorizzazione vengono digitate nell' [elemento`<authorization>`](https://msdn.microsoft.com/library/8d82143t.aspx) sotto forma di `<allow>` e `<deny>` elementi figlio.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="5b8d1-183">Ogni `<allow>` e `<deny>` elemento figlio può specificare:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="5b8d1-184">Un utente specifico</span><span class="sxs-lookup"><span data-stu-id="5b8d1-184">A particular user</span></span>
- <span data-ttu-id="5b8d1-185">Elenco delimitato da virgole di utenti</span><span class="sxs-lookup"><span data-stu-id="5b8d1-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="5b8d1-186">Tutti gli utenti anonimi, identificati da un punto interrogativo (?)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="5b8d1-187">Tutti gli utenti, identificati da un asterisco (\*)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="5b8d1-188">Il markup seguente illustra come usare le regole di autorizzazione dell'URL per consentire agli utenti Tito e Scott e di negare tutti gli altri:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="5b8d1-189">L'elemento `<allow>` definisce quali utenti sono consentiti, Tito e Scott, mentre l'elemento `<deny>` indica che *tutti* gli utenti sono stati negati.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-190">Gli elementi `<allow>` e `<deny>` possono inoltre specificare le regole di autorizzazione per i ruoli.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="5b8d1-191">Si esaminerà l'autorizzazione basata sui ruoli in un'esercitazione futura.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="5b8d1-192">L'impostazione seguente concede l'accesso a utenti diversi da Sam (inclusi i visitatori anonimi):</span><span class="sxs-lookup"><span data-stu-id="5b8d1-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="5b8d1-193">Per consentire solo gli utenti autenticati, usare la configurazione seguente, che nega l'accesso a tutti gli utenti anonimi:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="5b8d1-194">Le regole di autorizzazione vengono definite all'interno dell'elemento `<system.web>` in `Web.config` e si applicano a tutte le risorse ASP.NET nell'applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="5b8d1-195">Spesso un'applicazione dispone di regole di autorizzazione diverse per le diverse sezioni.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="5b8d1-196">Ad esempio, in un sito di eCommerce, tutti i visitatori possono sfogliare i prodotti, vedere le recensioni dei prodotti, eseguire ricerche nel catalogo e così via.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="5b8d1-197">Tuttavia, solo gli utenti autenticati possono raggiungere il checkout o le pagine per gestire la cronologia delle spedizioni.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="5b8d1-198">Potrebbero inoltre essere presenti parti del sito accessibili solo agli utenti selezionati, ad esempio gli amministratori del sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="5b8d1-199">ASP.NET semplifica la definizione di regole di autorizzazione diverse per file e cartelle diversi nel sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="5b8d1-200">Le regole di autorizzazione specificate nel file di `Web.config` della cartella radice si applicano a tutte le risorse ASP.NET nel sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="5b8d1-201">Tuttavia, è possibile eseguire l'override di queste impostazioni di autorizzazione predefinite per una cartella specifica aggiungendo un `Web.config` con una sezione di `<authorization>`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="5b8d1-202">Aggiornare il sito Web in modo che solo gli utenti autenticati possano visitare le pagine ASP.NET nella cartella `Membership`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="5b8d1-203">A tale scopo, è necessario aggiungere un file di `Web.config` alla cartella `Membership` e impostare le impostazioni di autorizzazione per negare gli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="5b8d1-204">Fare clic con il pulsante destro del mouse sulla cartella `Membership` nel Esplora soluzioni, scegliere il menu Aggiungi nuovo elemento dal menu di scelta rapida e aggiungere un nuovo file di configurazione Web denominato `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="5b8d1-205">[![aggiungere un file Web. config alla cartella di appartenenza](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="5b8d1-206">**Figura 3**: aggiungere un File di `Web.config` alla cartella `Membership` ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>

<span data-ttu-id="5b8d1-207">A questo punto il progetto deve contenere due file di `Web.config`: uno nella directory radice e uno nella cartella `Membership`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="5b8d1-208">[![l'applicazione dovrebbe ora contenere due file Web. config](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="5b8d1-209">**Figura 4**: l'applicazione dovrebbe ora contenere due file di `Web.config` ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>

<span data-ttu-id="5b8d1-210">Aggiornare il file di configurazione nella cartella `Membership` in modo da impedire l'accesso agli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="5b8d1-211">Questo è tutto.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-211">That's all there is to it!</span></span>

<span data-ttu-id="5b8d1-212">Per testare questa modifica, visitare la Home page in un browser e assicurarsi di essere disconnessi. Poiché il comportamento predefinito di un'applicazione ASP.NET è consentire tutti i visitatori e poiché non sono state apportate modifiche di autorizzazione al file di `Web.config` della directory radice, è possibile visitare i file nella directory radice come visitatore anonimo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="5b8d1-213">Fare clic sul collegamento creazione di account utente disponibile nella colonna a sinistra.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="5b8d1-214">Verrà visualizzata la `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="5b8d1-215">Poiché il file `Web.config` nella cartella `Membership` definisce le regole di autorizzazione per impedire l'accesso anonimo, il `UrlAuthorizationModule` interrompe la richiesta e restituisce uno stato HTTP 401 non autorizzato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="5b8d1-216">Il `FormsAuthenticationModule` lo modifica in uno stato di reindirizzamento 302, inviando la pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="5b8d1-217">Si noti che la pagina a cui si sta tentando di accedere (`CreatingUserAccounts.aspx`) viene passata alla pagina di accesso tramite il `ReturnUrl` parametro QueryString.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="5b8d1-218">[![poiché le regole di autorizzazione URL non consentono l'accesso anonimo, viene reindirizzato alla pagina di accesso](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="5b8d1-219">**Figura 5**: poiché le regole di autorizzazione dell'URL proibiscono l'accesso anonimo, si viene reindirizzati alla pagina di accesso ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>

<span data-ttu-id="5b8d1-220">Dopo aver eseguito l'accesso, si verrà reindirizzati alla pagina `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="5b8d1-221">Questa volta il `UrlAuthorizationModule` consente l'accesso alla pagina perché non è più anonimo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="5b8d1-222">Applicazione delle regole di autorizzazione URL a una posizione specifica</span><span class="sxs-lookup"><span data-stu-id="5b8d1-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="5b8d1-223">Le impostazioni di autorizzazione definite nella sezione `<system.web>` di `Web.config` si applicano a tutte le risorse di ASP.NET nella directory e nelle relative sottodirectory (fino a quando non viene eseguito l'override di un altro file di `Web.config`).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="5b8d1-224">In alcuni casi, tuttavia, potrebbe essere necessario che tutte le risorse di ASP.NET in una determinata directory dispongano di una particolare configurazione di autorizzazione, ad eccezione di una o due pagine specifiche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="5b8d1-225">Questa operazione può essere eseguita aggiungendo un elemento `<location>` in `Web.config`, puntando al file le cui regole di autorizzazione sono diverse e definendo le relative regole di autorizzazione univoche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="5b8d1-226">Per illustrare l'uso dell'elemento `<location>` per eseguire l'override delle impostazioni di configurazione per una risorsa specifica, è possibile personalizzare le impostazioni di autorizzazione in modo da consentire solo a Tito di visitare `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="5b8d1-227">A tale scopo, aggiungere un elemento `<location>` al file `Web.config` della cartella `Membership` e aggiornarne il markup in modo che abbia un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="5b8d1-228">L'elemento `<authorization>` in `<system.web>` definisce le regole di autorizzazione URL predefinite per le risorse ASP.NET nella cartella `Membership` e nelle relative sottocartelle.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="5b8d1-229">L'elemento `<location>` consente di eseguire l'override di queste regole per una determinata risorsa.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="5b8d1-230">Nel markup precedente l'elemento `<location>` fa riferimento alla pagina `CreatingUserAccounts.aspx` e specifica le regole di autorizzazione, ad esempio per consentire Tito, ma negare tutti gli altri.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="5b8d1-231">Per testare questa modifica dell'autorizzazione, iniziare visitando il sito Web come utente anonimo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="5b8d1-232">Se si tenta di visitare qualsiasi pagina nella cartella `Membership`, ad esempio `UserBasedAuthorization.aspx`, il `UrlAuthorizationModule` negherà la richiesta e si verrà reindirizzati alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="5b8d1-233">Dopo aver eseguito l'accesso come, ad esempio, Scott, è possibile visitare qualsiasi pagina nella cartella `Membership` *ad eccezione* di `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="5b8d1-234">Il tentativo di visitare `CreatingUserAccounts.aspx` connessi come utente, ma Tito comporterà un tentativo di accesso non autorizzato, reindirizzando di nuovo la pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-235">L'elemento `<location>` deve essere visualizzato all'esterno dell'elemento `<system.web>` della configurazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="5b8d1-236">È necessario usare un elemento `<location>` separato per ogni risorsa di cui si vuole eseguire l'override delle impostazioni di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="5b8d1-237">Esaminare il modo in cui il`UrlAuthorizationModule`usa le regole di autorizzazione per concedere o negare l'accesso</span><span class="sxs-lookup"><span data-stu-id="5b8d1-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="5b8d1-238">Il `UrlAuthorizationModule` determina se autorizzare una determinata identità per un particolare URL analizzando le regole di autorizzazione dell'URL una alla volta, a partire dal primo e funzionante.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="5b8d1-239">Non appena viene rilevata una corrispondenza, all'utente viene concesso o negato l'accesso, a seconda se la corrispondenza è stata trovata in un elemento `<allow>` o `<deny>`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="5b8d1-240"><strong>Se non viene trovata alcuna corrispondenza, all'utente viene concesso l'accesso.</strong></span><span class="sxs-lookup"><span data-stu-id="5b8d1-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="5b8d1-241">Di conseguenza, se si vuole limitare l'accesso, è fondamentale usare un elemento `<deny>` come ultimo elemento nella configurazione dell'autorizzazione URL.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="5b8d1-242"><strong>Se si omette un</strong> elemento<strong>`<deny>`</strong> <strong>, viene concesso l'accesso a tutti gli utenti.</strong></span><span class="sxs-lookup"><span data-stu-id="5b8d1-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="5b8d1-243">Per comprendere meglio il processo usato dalla `UrlAuthorizationModule` per determinare l'autorità, prendere in considerazione le regole di autorizzazione dell'URL di esempio esaminate in precedenza in questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="5b8d1-244">La prima regola è un elemento `<allow>` che consente l'accesso a Tito e Scott.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="5b8d1-245">La seconda regola è un elemento `<deny>` che nega l'accesso a tutti gli utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="5b8d1-246">Se un utente anonimo visita, il `UrlAuthorizationModule` inizia chiedendo, è anonimo o Scott o Tito?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="5b8d1-247">La risposta, ovviamente, è No, quindi procede alla seconda regola.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="5b8d1-248">È anonimo nel set di tutti?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="5b8d1-249">Poiché la risposta è sì, la regola `<deny>` viene applicata e il visitatore viene reindirizzato alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="5b8d1-250">Analogamente, se Jisun viene visitato, il `UrlAuthorizationModule` inizia chiedendo, è Jisun Scott o Tito?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="5b8d1-251">Dal momento che non lo è, il `UrlAuthorizationModule` procede alla seconda domanda, Jisun nel set di tutti?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="5b8d1-252">A questo proposito, viene negato l'accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="5b8d1-253">Infine, se Tito visita, la prima domanda rappresentata dal `UrlAuthorizationModule` è una risposta affermativa, quindi Tito viene concesso l'accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="5b8d1-254">Poiché il `UrlAuthorizationModule` elabora le regole di autorizzazione dall'alto verso il basso, arrestandosi in corrispondenza di qualsiasi corrispondenza, è importante che le regole più specifiche vengano prima di quelle meno specifiche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="5b8d1-255">Ovvero, per definire le regole di autorizzazione che impediscono l'Jisun e gli utenti anonimi, ma consentono tutti gli altri utenti autenticati, si inizierà con la regola più specifica, ovvero quella che ha un effetto su Jisun e quindi si procede con le regole meno specifiche, che consentono tutti gli altri utenti autenticati, ma che negano tutti gli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="5b8d1-256">Le seguenti regole di autorizzazione URL implementano questi criteri negando prima Jisun e quindi negando qualsiasi utente anonimo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="5b8d1-257">A qualsiasi utente autenticato diverso da Jisun verrà concesso l'accesso perché nessuna di queste `<deny>` istruzioni corrisponderà.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="5b8d1-258">Passaggio 2: correzione del flusso di lavoro per utenti autenticati non autorizzati</span><span class="sxs-lookup"><span data-stu-id="5b8d1-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="5b8d1-259">Come illustrato in precedenza in questa esercitazione, nella sezione relativa al flusso di lavoro di autorizzazione URL, ogni volta che una richiesta non autorizzata traspare, il `UrlAuthorizationModule` interrompe la richiesta e restituisce uno stato HTTP 401 non autorizzato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="5b8d1-260">Questo stato 401 viene modificato dal `FormsAuthenticationModule` in uno stato di reindirizzamento 302 che invia l'utente alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="5b8d1-261">Questo flusso di lavoro viene eseguito su qualsiasi richiesta non autorizzata, anche se l'utente è autenticato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="5b8d1-262">È probabile che la restituzione di un utente autenticato alla pagina di accesso consentirà di confonderle perché sono già state registrate nel sistema.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="5b8d1-263">Con un po' di lavoro è possibile migliorare questo flusso di lavoro reindirizzando gli utenti autenticati che effettuano richieste non autorizzate a una pagina che spiega che hanno tentato di accedere a una pagina con restrizioni.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="5b8d1-264">Per iniziare, creare una nuova pagina ASP.NET nella cartella radice dell'applicazione Web denominata `UnauthorizedAccess.aspx`; non dimenticare di associare questa pagina alla pagina master `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="5b8d1-265">Dopo aver creato questa pagina, rimuovere il controllo contenuto che fa riferimento al `LoginContent` ContentPlaceHolder in modo che venga visualizzato il contenuto predefinito della pagina master.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="5b8d1-266">Aggiungere quindi un messaggio che spieghi la situazione, ovvero che l'utente ha tentato di accedere a una risorsa protetta.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="5b8d1-267">Dopo l'aggiunta di un messaggio di questo tipo, il markup dichiarativo della pagina `UnauthorizedAccess.aspx` dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="5b8d1-268">A questo punto è necessario modificare il flusso di lavoro in modo che se una richiesta non autorizzata viene eseguita da un utente autenticato, questi vengono inviati alla pagina `UnauthorizedAccess.aspx` invece che alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="5b8d1-269">La logica che reindirizza le richieste non autorizzate alla pagina di accesso viene nascosta all'interno di un metodo privato della classe `FormsAuthenticationModule`, pertanto non è possibile personalizzare questo comportamento.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="5b8d1-270">Tuttavia, è possibile aggiungere la propria logica alla pagina di accesso per reindirizzare l'utente a `UnauthorizedAccess.aspx`, se necessario.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="5b8d1-271">Quando il `FormsAuthenticationModule` reindirizza un visitatore non autorizzato alla pagina di accesso, accoda l'URL richiesto, non autorizzato, alla QueryString con il nome `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="5b8d1-272">Se, ad esempio, un utente non autorizzato tenta di visitare `OnlyTito.aspx`, il `FormsAuthenticationModule` li reindirizza al `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="5b8d1-273">Se quindi la pagina di accesso viene raggiunta da un utente autenticato con una stringa QueryString che include il parametro `ReturnUrl`, è possibile che l'utente non autenticato abbia tentato di visitare una pagina che non è autorizzato a visualizzare.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="5b8d1-274">In tal caso, si desidera reindirizzare l'utente a `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="5b8d1-275">A tale scopo, aggiungere il codice seguente al gestore dell'evento `Page_Load` della pagina di accesso:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="5b8d1-276">Il codice riportato sopra reindirizza gli utenti autenticati e non autorizzati alla pagina `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="5b8d1-277">Per visualizzare questa logica in azione, visitare il sito come visitatore anonimo e fare clic sul collegamento creazione di account utente nella colonna a sinistra.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="5b8d1-278">Verrà visualizzata la pagina `~/Membership/CreatingUserAccounts.aspx`, che nel passaggio 1 è stato configurato in modo da consentire l'accesso solo a Tito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="5b8d1-279">Poiché gli utenti anonimi non sono consentiti, il `FormsAuthenticationModule` reindirizza nuovamente alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="5b8d1-280">A questo punto è anonimo, quindi `Request.IsAuthenticated` restituisce `False` e non viene reindirizzato al `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="5b8d1-281">Viene invece visualizzata la pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="5b8d1-282">Accedere come utente diverso da Tito, ad esempio Bruce.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="5b8d1-283">Dopo aver immesso le credenziali appropriate, la pagina di accesso reindirizza a `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="5b8d1-284">Tuttavia, poiché questa pagina è accessibile solo a Tito, l'utente non è autorizzato a visualizzarlo e viene restituito tempestivamente alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="5b8d1-285">Questa volta, tuttavia, `Request.IsAuthenticated` restituisce `True` (e il `ReturnUrl` parametro QueryString esiste), quindi viene reindirizzato alla pagina `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="5b8d1-286">[![autenticati, gli utenti non autorizzati vengono reindirizzati a UnauthorizedAccess. aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="5b8d1-287">**Figura 6**: gli utenti autenticati e non autorizzati vengono reindirizzati a `UnauthorizedAccess.aspx` ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>

<span data-ttu-id="5b8d1-288">Questo flusso di lavoro personalizzato presenta un'esperienza utente più sensata e semplice mediante cortocircuito del ciclo illustrato nella figura 2.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="5b8d1-289">Passaggio 3: limitazione della funzionalità in base all'utente attualmente connesso</span><span class="sxs-lookup"><span data-stu-id="5b8d1-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="5b8d1-290">L'autorizzazione URL consente di specificare facilmente le regole di autorizzazione grossolane.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="5b8d1-291">Come illustrato nel passaggio 1, con l'autorizzazione URL è possibile indicare in modo conciso quali identità sono consentite e quali vengono negate alla visualizzazione di una particolare pagina o di tutte le pagine in una cartella.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="5b8d1-292">In alcuni scenari, tuttavia, potrebbe essere necessario consentire a tutti gli utenti di visitare una pagina, ma limitare le funzionalità della pagina in base all'utente che lo visita.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="5b8d1-293">Si consideri il caso di un sito Web di eCommerce che consente ai visitatori autenticati di esaminare i prodotti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="5b8d1-294">Quando un utente anonimo visita la pagina di un prodotto, Visualizza solo le informazioni sul prodotto e non ha la possibilità di uscire da una recensione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="5b8d1-295">Tuttavia, un utente autenticato che visita la stessa pagina vedrà l'interfaccia di revisione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="5b8d1-296">Se l'utente autenticato non ha ancora esaminato questo prodotto, l'interfaccia consentirebbe di inviare una verifica; in caso contrario, verrebbe visualizzata la revisione inviata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="5b8d1-297">Per eseguire ulteriormente questo scenario, la pagina del prodotto potrebbe visualizzare informazioni aggiuntive e offrire funzionalità estese per gli utenti che lavorano per l'azienda di eCommerce.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="5b8d1-298">La pagina del prodotto, ad esempio, potrebbe elencare l'inventario in magazzino e includere opzioni per modificare il prezzo e la descrizione del prodotto quando visitati da un dipendente.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="5b8d1-299">Le regole di autorizzazione per granularità fine possono essere implementate in modo dichiarativo o a livello di codice o tramite una combinazione dei due.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="5b8d1-300">Nella sezione successiva verrà illustrato come implementare l'autorizzazione con granularità fine tramite il controllo LoginView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="5b8d1-301">In seguito, si esamineranno le tecniche programmatiche.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="5b8d1-302">Prima di poter esaminare l'applicazione di regole di autorizzazione granulari, è necessario innanzitutto creare una pagina la cui funzionalità dipende dall'utente che la visita.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="5b8d1-303">Viene ora creata una pagina in cui sono elencati i file in una particolare directory all'interno di un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="5b8d1-304">Oltre a elencare il nome, le dimensioni e altre informazioni di ogni file, GridView includerà due colonne di LinkButton: una per la visualizzazione denominata e una con titolo Delete.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="5b8d1-305">Se si fa clic sull'LinkButton di visualizzazione, verrà visualizzato il contenuto del file selezionato; Se si fa clic su Elimina LinkButton, il file verrà eliminato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="5b8d1-306">Si creerà inizialmente questa pagina in modo che la relativa funzionalità di visualizzazione ed eliminazione sia disponibile per tutti gli utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="5b8d1-307">Nella sezione Utilizzo del controllo LoginView e limitazione delle funzionalità a livello di codice si vedrà come abilitare o disabilitare queste funzionalità in base all'utente che visita la pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-308">La pagina ASP.NET da compilare usa un controllo GridView per visualizzare un elenco di file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="5b8d1-309">Poiché questa serie di esercitazioni è incentrata sull'autenticazione basata su form, sull'autorizzazione, sugli account utente e sui ruoli, non desidero dedicare troppo tempo alla discussione dei lavori interni del controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="5b8d1-310">Sebbene in questa esercitazione siano disponibili istruzioni dettagliate per la configurazione di questa pagina, non vengono esaminati i dettagli del motivo per cui sono state apportate determinate scelte o l'effetto sulle proprietà specifiche dell'output sottoposto a rendering.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="5b8d1-311">Per un esame approfondito del controllo GridView, vedere la serie di esercitazioni sull' *[uso dei dati in ASP.NET 2,0](../../data-access/index.md)* .</span><span class="sxs-lookup"><span data-stu-id="5b8d1-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="5b8d1-312">Per iniziare, aprire il file `UserBasedAuthorization.aspx` nella cartella `Membership` e aggiungere un controllo GridView alla pagina denominata `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="5b8d1-313">Dallo smart tag di GridView fare clic sul collegamento Modifica colonne per aprire la finestra di dialogo campi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="5b8d1-314">Da qui, deselezionare la casella di controllo genera automaticamente campi nell'angolo in basso a sinistra.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="5b8d1-315">Aggiungere quindi un pulsante Select, un pulsante Delete e due BoundField dall'angolo superiore sinistro (i pulsanti SELECT ed Delete si trovano nel tipo CommandField).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="5b8d1-316">Impostare la proprietà `SelectText` del pulsante Seleziona su Visualizza e le proprietà `HeaderText` e `DataField` del primo BoundField su nome.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="5b8d1-317">Impostare la proprietà `HeaderText` del secondo BoundField su size in byte, la relativa proprietà `DataField` su length, la relativa proprietà `DataFormatString` su {0:N0} e la relativa proprietà `HtmlEncode` su false.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="5b8d1-318">Dopo aver configurato le colonne di GridView, fare clic su OK per chiudere la finestra di dialogo campi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="5b8d1-319">Dalla Finestra Proprietà impostare la proprietà `DataKeyNames` di GridView su `FullName`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="5b8d1-320">A questo punto, il markup dichiarativo di GridView dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="5b8d1-321">Con il markup di GridView creato, è possibile scrivere il codice che recupererà i file in una determinata directory e li associerà a GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="5b8d1-322">Aggiungere il codice seguente al gestore dell'evento `Page_Load` della pagina:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="5b8d1-323">Il codice precedente usa la [classe`DirectoryInfo`](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) per ottenere un elenco dei file nella cartella radice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="5b8d1-324">Il [metodo`GetFiles()`](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) restituisce tutti i file nella directory come una matrice di [oggetti`FileInfo`](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), che viene quindi associata a GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="5b8d1-325">L'oggetto `FileInfo` dispone di un'ampia gamma di proprietà, ad esempio `Name`, `Length`e `IsReadOnly`, tra le altre.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="5b8d1-326">Come si può notare dal markup dichiarativo, GridView visualizza solo le proprietà `Name` e `Length`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-327">Le classi `DirectoryInfo` e `FileInfo` si trovano nello [spazio dei nomi`System.IO`](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="5b8d1-328">Pertanto, è necessario anteporre questi nomi di classe con i nomi degli spazi dei nomi o fare in modo che lo spazio dei nomi sia importato nel file di classe (tramite `Imports System.IO`).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>

<span data-ttu-id="5b8d1-329">Visita la pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="5b8d1-330">Verrà visualizzato l'elenco dei file che risiedono nella directory radice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="5b8d1-331">Se si fa clic su uno degli LinkButton di visualizzazione o di eliminazione, si verificherà un postback, ma non verrà eseguita alcuna azione perché è ancora necessario creare i gestori eventi necessari.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="5b8d1-332">[![GridView elenca i file nella directory radice dell'applicazione Web](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="5b8d1-333">**Figura 7**: GridView elenca i file nella directory radice dell'applicazione Web ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>

<span data-ttu-id="5b8d1-334">È necessario un mezzo per visualizzare il contenuto del file selezionato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="5b8d1-335">Tornare a Visual Studio e aggiungere una casella di testo denominata `FileContents` sopra GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="5b8d1-336">Impostare la relativa proprietà `TextMode` su `MultiLine` e le proprietà `Columns` e `Rows` rispettivamente su 95% e 10.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="5b8d1-337">Successivamente, creare un gestore eventi per l' [evento`SelectedIndexChanged`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) di GridView e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="5b8d1-338">Questo codice usa la proprietà `SelectedValue` di GridView per determinare il nome file completo del file selezionato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="5b8d1-339">Internamente, per ottenere la `SelectedValue`viene fatto riferimento alla raccolta di `DataKeys`, quindi è fondamentale impostare la proprietà `DataKeyNames` di GridView su Name, come descritto in precedenza in questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="5b8d1-340">La [classe`File`](https://msdn.microsoft.com/library/system.io.file.aspx) viene utilizzata per leggere il contenuto del file selezionato in una stringa, che viene quindi assegnata alla proprietà `Text` della `FileContents` casella di testo, visualizzando quindi il contenuto del file selezionato nella pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="5b8d1-341">[![il contenuto del file selezionato viene visualizzato nella casella di testo](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="5b8d1-342">**Figura 8**: il contenuto del file selezionato viene visualizzato nella casella di testo ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-343">Se si Visualizza il contenuto di un file che contiene markup HTML, quindi si tenta di visualizzare o eliminare un file, si riceverà un errore di `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="5b8d1-344">Questo problema si verifica perché durante il postback il contenuto della casella di testo viene restituito al server Web.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="5b8d1-345">Per impostazione predefinita, ASP.NET genera un errore di `HttpRequestValidationException` ogni volta che viene rilevato contenuto di postback potenzialmente pericoloso, ad esempio il markup HTML.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="5b8d1-346">Per impedire che si verifichi questo errore, disattivare la convalida delle richieste per la pagina aggiungendo `ValidateRequest="false"` alla direttiva `@Page`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="5b8d1-347">Per ulteriori informazioni sui vantaggi derivanti dalla convalida delle richieste e sulle precauzioni da intraprendere per la relativa disabilitazione, vedere la pagina relativa alla [convalida delle richieste che impedisce gli attacchi di script](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="5b8d1-348">Infine, aggiungere un gestore eventi con il codice seguente per l' [evento`RowDeleting`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx)di GridView:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="5b8d1-349">Il codice visualizza semplicemente il nome completo del file da eliminare nella casella di testo `FileContents` *senza* eliminare effettivamente il file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="5b8d1-350">[![facendo clic sul pulsante Elimina non viene effettivamente eliminato il file](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="5b8d1-351">**Figura 9**: facendo clic sul pulsante Elimina il file non viene effettivamente eliminato ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>

<span data-ttu-id="5b8d1-352">Nel passaggio 1 sono state configurate le regole di autorizzazione URL per impedire agli utenti anonimi di visualizzare le pagine nella cartella `Membership`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="5b8d1-353">Per una migliore esposizione dell'autenticazione con granularità fine, consentire agli utenti anonimi di visitare la pagina `UserBasedAuthorization.aspx`, ma con funzionalità limitate.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="5b8d1-354">Per aprire questa pagina per accedere a tutti gli utenti, aggiungere il seguente elemento `<location>` al file `Web.config` nella cartella `Membership`:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="5b8d1-355">Dopo aver aggiunto questo elemento `<location>`, testare le nuove regole di autorizzazione URL disconnettendosi dal sito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="5b8d1-356">Un utente anonimo dovrebbe essere autorizzato a visitare la pagina `UserBasedAuthorization.aspx`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="5b8d1-357">Attualmente, qualsiasi utente autenticato o anonimo può visitare la pagina `UserBasedAuthorization.aspx` e visualizzare o eliminare i file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="5b8d1-358">Si può fare in modo che solo gli utenti autenticati possano visualizzare il contenuto di un file e solo Tito possa eliminare un file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="5b8d1-359">Le regole di autorizzazione per granularità fine possono essere applicate in modo dichiarativo, a livello di codice o tramite una combinazione di entrambi i metodi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="5b8d1-360">Si userà l'approccio dichiarativo per limitare gli utenti che possono visualizzare il contenuto di un file; per limitare gli utenti che possono eliminare un file, verrà usato l'approccio programmatico.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="5b8d1-361">Uso del controllo LoginView</span><span class="sxs-lookup"><span data-stu-id="5b8d1-361">Using the LoginView Control</span></span>

<span data-ttu-id="5b8d1-362">Come illustrato nelle esercitazioni precedenti, il controllo LoginView è utile per visualizzare interfacce diverse per utenti autenticati e anonimi e offre un modo semplice per nascondere funzionalità non accessibili agli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="5b8d1-363">Poiché gli utenti anonimi non possono visualizzare o eliminare i file, è sufficiente visualizzare la casella di testo `FileContents` quando la pagina viene visitata da un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="5b8d1-364">A tale scopo, aggiungere un controllo LoginView alla pagina, denominarlo `LoginViewForFileContentsTextBox`e spostare il markup dichiarativo `FileContents` casella di testo nel `LoggedInTemplate`del controllo LoginView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="5b8d1-365">I controlli Web nei modelli di LoginView non sono più direttamente accessibili dalla classe code-behind.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="5b8d1-366">Ad esempio, i gestori eventi di `SelectedIndexChanged` e `RowDeleting` di GridView `FilesGrid` fanno attualmente riferimento al controllo TextBox `FileContents` con codice simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="5b8d1-367">Tuttavia, questo codice non è più valido.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-367">However, this code is no longer valid.</span></span> <span data-ttu-id="5b8d1-368">Spostando la casella di testo `FileContents` in `LoggedInTemplate` non è possibile accedere direttamente alla casella di testo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="5b8d1-369">Al contrario, è necessario usare il metodo `FindControl("controlId")` per fare riferimento a un controllo a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="5b8d1-370">Aggiornare i gestori eventi `FilesGrid` per fare riferimento alla casella di testo in modo analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="5b8d1-371">Dopo aver spostato la casella di testo nel `LoggedInTemplate` di LoginView e aver aggiornato il codice della pagina in modo che faccia riferimento alla casella di testo usando il modello di `FindControl("controlId")`, visitare la pagina come utente anonimo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="5b8d1-372">Come illustrato nella figura 10, la casella di testo `FileContents` non viene visualizzata.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="5b8d1-373">Tuttavia, la visualizzazione LinkButton è ancora visualizzata.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="5b8d1-374">[![il controllo LoginView esegue il rendering solo della casella di testo fileContents per gli utenti autenticati](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="5b8d1-375">**Figura 10**: il controllo LoginView esegue il rendering solo della casella di testo `FileContents` per gli utenti autenticati ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>

<span data-ttu-id="5b8d1-376">Un modo per nascondere il pulsante Visualizza per gli utenti anonimi consiste nel convertire il campo GridView in un TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="5b8d1-377">Verrà generato un modello che contiene il markup dichiarativo per il LinkButton della vista.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="5b8d1-378">È quindi possibile aggiungere un controllo LoginView a TemplateField e inserire il LinkButton all'interno del `LoggedInTemplate`di LoginView, nascondendo quindi il pulsante View da visitatori anonimi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="5b8d1-379">A tale scopo, fare clic sul collegamento Modifica colonne dallo smart tag di GridView per avviare la finestra di dialogo campi.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="5b8d1-380">Selezionare quindi il pulsante Seleziona dall'elenco nell'angolo in basso a sinistra e quindi fare clic sul collegamento Converti questo campo in un TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="5b8d1-381">In questo modo, il markup dichiarativo del campo viene modificato da:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="5b8d1-382">A:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="5b8d1-383">A questo punto, è possibile aggiungere un oggetto LoginView a TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="5b8d1-384">Nel markup seguente viene visualizzato l'oggetto LinkButton di visualizzazione solo per gli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="5b8d1-385">Come illustrato nella figura 11, il risultato finale non è analogo a quanto la colonna della vista viene ancora visualizzata anche se gli oggetti LinkButton della vista nella colonna sono nascosti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="5b8d1-386">Nella sezione successiva verrà illustrato come nascondere l'intera colonna GridView (e non solo LinkButton).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="5b8d1-387">[![il controllo LoginView nasconde gli LinkButton di visualizzazione per i visitatori anonimi](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="5b8d1-388">**Figura 11**: il controllo LoginView nasconde gli LinkButton di visualizzazione per i visitatori anonimi ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="5b8d1-389">Limitazione delle funzionalità a livello di codice</span><span class="sxs-lookup"><span data-stu-id="5b8d1-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="5b8d1-390">In alcune circostanze, le tecniche dichiarative non sono sufficienti per limitare la funzionalità a una pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="5b8d1-391">È ad esempio possibile che la disponibilità di determinate funzionalità della pagina dipenda da criteri che esulano dal fatto che l'utente che visita la pagina sia anonimo o autenticato.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="5b8d1-392">In questi casi, i vari elementi dell'interfaccia utente possono essere visualizzati o nascosti tramite mezzi programmatici.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="5b8d1-393">Per limitare la funzionalità a livello di codice, è necessario eseguire due attività:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="5b8d1-394">Determinare se l'utente che visita la pagina può accedere alla funzionalità e</span><span class="sxs-lookup"><span data-stu-id="5b8d1-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="5b8d1-395">Modificare a livello di codice l'interfaccia utente a seconda che l'utente abbia accesso alla funzionalità in questione.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="5b8d1-396">Per illustrare l'applicazione di queste due attività, è possibile consentire solo a Tito di eliminare i file dal controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="5b8d1-397">La prima attività, quindi, consiste nel determinare se è Tito visitare la pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="5b8d1-398">Una volta determinato, è necessario nascondere o mostrare la colonna Delete di GridView.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="5b8d1-399">Le colonne di GridView sono accessibili tramite la relativa proprietà `Columns`; viene eseguito il rendering di una colonna solo se la relativa proprietà `Visible` è impostata su `True` (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="5b8d1-400">Aggiungere il codice seguente al gestore eventi `Page_Load` prima di associare i dati a GridView:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="5b8d1-401">Come illustrato nell'esercitazione [*Panoramica dell'autenticazione basata su form*](../introduction/an-overview-of-forms-authentication-vb.md) , `User.Identity.Name` restituisce il nome dell'identità.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="5b8d1-402">Corrisponde al nome utente immesso nel controllo di accesso.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="5b8d1-403">Se è Tito visitare la pagina, la proprietà `Visible` della seconda colonna di GridView è impostata su `True`; in caso contrario, è impostato su `False`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="5b8d1-404">Il risultato finale è che quando un utente diverso da Tito visita la pagina, ovvero un altro utente autenticato o un utente anonimo, non viene eseguito il rendering della colonna Delete (vedere la figura 12). Tuttavia, quando Tito visita la pagina, è presente la colonna Delete (vedere la figura 13).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="5b8d1-405">[![non viene eseguito il rendering della colonna DELETE se visitata da un utente diverso da Tito (ad esempio Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="5b8d1-406">**Figura 12**: non viene eseguito il rendering della colonna DELETE se visitata da un utente diverso da Tito (ad esempio Bruce) ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>

<span data-ttu-id="5b8d1-407">[![viene eseguito il rendering della colonna Delete per Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="5b8d1-408">**Figura 13**: viene eseguito il rendering della colonna Delete per Tito ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="5b8d1-409">Passaggio 4: applicazione di regole di autorizzazione a classi e metodi</span><span class="sxs-lookup"><span data-stu-id="5b8d1-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="5b8d1-410">Nel passaggio 3 non è stato consentito agli utenti anonimi di visualizzare il contenuto di un file e non è stato consentito a tutti gli utenti, ma a Tito di eliminare i file.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="5b8d1-411">Questa operazione è stata eseguita nascondendo gli elementi dell'interfaccia utente associati per i visitatori non autorizzati tramite tecniche dichiarative e a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="5b8d1-412">Per questo semplice esempio, nascondere correttamente gli elementi dell'interfaccia utente è stato semplice, ma cosa accade per i siti più complessi in cui possono essere disponibili diversi modi per eseguire la stessa funzionalità?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="5b8d1-413">Quando si limita la funzionalità a utenti non autorizzati, cosa accade se si dimentica di nascondere o disabilitare tutti gli elementi dell'interfaccia utente applicabili?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="5b8d1-414">Un modo semplice per evitare che un utente non autorizzato possa accedere a una particolare parte della funzionalità consiste nel decorare tale classe o metodo con l' [attributo`PrincipalPermission`](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="5b8d1-415">Quando il Runtime .NET usa una classe o esegue uno dei relativi metodi, verifica che il contesto di sicurezza corrente disponga delle autorizzazioni per usare la classe o eseguire il metodo.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="5b8d1-416">L'attributo `PrincipalPermission` fornisce un meccanismo tramite il quale è possibile definire queste regole.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="5b8d1-417">Viene ora illustrato l'utilizzo dell'attributo `PrincipalPermission` sui `SelectedIndexChanged` e `RowDeleting` gestori di eventi di GridView per impedire l'esecuzione da parte di utenti anonimi e utenti diversi da Tito, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="5b8d1-418">È sufficiente aggiungere l'attributo appropriato in cima a ogni definizione di funzione:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="5b8d1-419">L'attributo per il gestore dell'evento `SelectedIndexChanged` impone che solo gli utenti autenticati possano eseguire il gestore eventi, dove l'attributo nel gestore dell'evento `RowDeleting` limita l'esecuzione a Tito.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-420">Un attributo può essere applicato a una classe, a un metodo, a una proprietà o a un evento.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="5b8d1-421">Quando si aggiunge un attributo, deve far parte della classe, del metodo, della proprietà o dell'istruzione di dichiarazione di evento.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="5b8d1-422">Poiché Visual Basic usa le interruzioni di riga come delimitatori di istruzione, gli attributi devono essere visualizzati nella stessa riga della dichiarazione o direttamente al di sopra di esso con un carattere di continuazione di riga (il carattere di sottolineatura).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="5b8d1-423">Nel frammento di codice precedente, il carattere di continuazione di riga viene usato per inserire l'attributo in una riga e la dichiarazione del metodo in un altro.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>

<span data-ttu-id="5b8d1-424">Se, in qualche modo, un utente diverso da Tito tenta di eseguire il gestore dell'evento `RowDeleting` o un utente non autenticato tenta di eseguire il gestore dell'evento `SelectedIndexChanged`, il runtime di .NET genererà un `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="5b8d1-425">[![se il contesto di sicurezza non è autorizzato a eseguire il metodo, viene generata un'eccezione SecurityException](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="5b8d1-426">**Figura 14**: se il contesto di sicurezza non è autorizzato a eseguire il metodo, viene generata un'`SecurityException` ([fare clic per visualizzare l'immagine con dimensioni complete](user-based-authorization-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="5b8d1-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5b8d1-427">Per consentire a più contesti di sicurezza di accedere a una classe o a un metodo, decorare la classe o il metodo con un attributo `PrincipalPermission` per ogni contesto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="5b8d1-428">Per consentire a Tito e Bruce di eseguire il gestore dell'evento `RowDeleting`, aggiungere *due* attributi `PrincipalPermission`:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="5b8d1-429">Oltre alle pagine ASP.NET, molte applicazioni hanno anche un'architettura che include diversi livelli, ad esempio la logica di business e i livelli di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="5b8d1-430">Questi livelli vengono in genere implementati come librerie di classi e offrono classi e metodi per l'esecuzione di funzionalità relative alla logica di business e ai dati.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="5b8d1-431">L'attributo `PrincipalPermission` è utile per applicare le regole di autorizzazione a tali livelli.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="5b8d1-432">Per altre informazioni sull'uso dell'attributo `PrincipalPermission` per definire le regole di autorizzazione per le classi e i metodi, vedere la voce del Blog di [Scott Guthrie](https://weblogs.asp.net/scottgu/) [aggiunta di regole di autorizzazione ai livelli business e dati usando `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="5b8d1-433">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="5b8d1-433">Summary</span></span>

<span data-ttu-id="5b8d1-434">In questa esercitazione è stato esaminato come applicare le regole di autorizzazione basate sugli utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="5b8d1-435">È stata avviata un'occhiata a ASP. Framework di autorizzazione dell'URL di NET.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="5b8d1-436">Per ogni richiesta, il `UrlAuthorizationModule` del motore ASP.NET controlla le regole di autorizzazione dell'URL definite nella configurazione dell'applicazione per determinare se l'identità è autorizzata ad accedere alla risorsa richiesta.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="5b8d1-437">In breve, l'autorizzazione URL consente di specificare facilmente le regole di autorizzazione per una pagina specifica o per tutte le pagine in una directory specifica.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="5b8d1-438">Il Framework di autorizzazione URL applica le regole di autorizzazione in base alla pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="5b8d1-439">Con l'autorizzazione URL, l'identità richiedente è autorizzata ad accedere a una determinata risorsa.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="5b8d1-440">Molti scenari, tuttavia, chiamano per le regole di autorizzazione granularità più fine.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="5b8d1-441">Anziché definire gli utenti autorizzati ad accedere a una pagina, potrebbe essere necessario consentire a tutti di accedere a una pagina, ma per visualizzare dati diversi o offrire funzionalità diverse a seconda dell'utente che visita la pagina.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="5b8d1-442">Per evitare che utenti non autorizzati accedano alla funzionalità non consentita, l'autorizzazione a livello di pagina comporta in genere l'occultamento di elementi specifici dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="5b8d1-443">Inoltre, è possibile utilizzare gli attributi per limitare l'accesso alle classi e l'esecuzione dei relativi metodi per determinati utenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="5b8d1-444">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="5b8d1-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="5b8d1-445">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="5b8d1-445">Further Reading</span></span>

<span data-ttu-id="5b8d1-446">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="5b8d1-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="5b8d1-447">Aggiunta di regole di autorizzazione ai livelli business e dati mediante `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="5b8d1-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="5b8d1-448">Autorizzazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="5b8d1-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="5b8d1-449">Modifiche tra IIS6 e IIS7 Security</span><span class="sxs-lookup"><span data-stu-id="5b8d1-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="5b8d1-450">Configurazione di file e sottodirectory specifici</span><span class="sxs-lookup"><span data-stu-id="5b8d1-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="5b8d1-451">Limitazione della funzionalità di modifica dei dati in base all'utente</span><span class="sxs-lookup"><span data-stu-id="5b8d1-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="5b8d1-452">Guide introduttive del controllo LoginView</span><span class="sxs-lookup"><span data-stu-id="5b8d1-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="5b8d1-453">Informazioni sull'autorizzazione dell'URL IIS7</span><span class="sxs-lookup"><span data-stu-id="5b8d1-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="5b8d1-454">Documentazione tecnica di `UrlAuthorizationModule`</span><span class="sxs-lookup"><span data-stu-id="5b8d1-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="5b8d1-455">Uso dei dati in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="5b8d1-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="5b8d1-456">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="5b8d1-456">About the Author</span></span>

<span data-ttu-id="5b8d1-457">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5b8d1-458">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5b8d1-459">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="5b8d1-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="5b8d1-460">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="5b8d1-461">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="5b8d1-461">Special Thanks To</span></span>

<span data-ttu-id="5b8d1-462">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="5b8d1-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5b8d1-463">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="5b8d1-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5b8d1-464">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="5b8d1-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5b8d1-465">[Precedente](validating-user-credentials-against-the-membership-user-store-vb.md)
> [Successivo](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5b8d1-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
