---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
title: Archiviazione di informazioni utente aggiuntiveC#() | Microsoft Docs
author: rick-anderson
description: In questa esercitazione si risponderà a questa domanda compilando un'applicazione guestbook molto rudimentale. In questo modo, si esamineranno diverse opzioni per modeli...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 1642132a-1ca5-4872-983f-ab59fc8865d3
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 24b96e86bc93e03d2639b73e35ed1fd1271bac5a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74641456"
---
# <a name="storing-additional-user-information-c"></a><span data-ttu-id="0d40e-104">Archiviazione di informazioni utente aggiuntive (C#)</span><span class="sxs-lookup"><span data-stu-id="0d40e-104">Storing Additional User Information (C#)</span></span>

<span data-ttu-id="0d40e-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0d40e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0d40e-106">[Scarica codice](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) o [Scarica PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="0d40e-106">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span></span>

> <span data-ttu-id="0d40e-107">In questa esercitazione si risponderà a questa domanda compilando un'applicazione guestbook molto rudimentale.</span><span class="sxs-lookup"><span data-stu-id="0d40e-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="0d40e-108">In questo modo, si esamineranno diverse opzioni per la modellazione delle informazioni utente in un database e quindi si vedrà come associare questi dati agli account utente creati dal framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d40e-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>

## <a name="introduction"></a><span data-ttu-id="0d40e-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="0d40e-109">Introduction</span></span>

<span data-ttu-id="0d40e-110">ASP. Il Framework di appartenenza di NET offre un'interfaccia flessibile per la gestione degli utenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="0d40e-111">L'API di appartenenza include metodi per la convalida delle credenziali, il recupero delle informazioni sull'utente attualmente connesso, la creazione di un nuovo account utente e l'eliminazione di un account utente, tra gli altri.</span><span class="sxs-lookup"><span data-stu-id="0d40e-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="0d40e-112">Ogni account utente nel Framework di appartenenza contiene solo le proprietà necessarie per la convalida delle credenziali e l'esecuzione di attività essenziali relative agli account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="0d40e-113">Questa operazione viene evidenziata dai metodi e dalle proprietà della [classe`MembershipUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), che modella un account utente nel framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d40e-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="0d40e-114">Questa classe dispone di proprietà quali [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx)e [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx)e metodi come [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) e [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="0d40e-115">Spesso, le applicazioni devono archiviare informazioni aggiuntive sull'utente non incluse nel framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d40e-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="0d40e-116">Ad esempio, un rivenditore online potrebbe dover consentire a ogni utente di archiviare gli indirizzi di spedizione e fatturazione, le informazioni di pagamento, le preferenze di recapito e il numero di telefono di contatto.</span><span class="sxs-lookup"><span data-stu-id="0d40e-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="0d40e-117">Ogni ordine del sistema è inoltre associato a un determinato account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="0d40e-118">La classe `MembershipUser` non include proprietà come `PhoneNumber` o `DeliveryPreferences` o `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="0d40e-119">Quindi, in che modo è possibile tenere traccia delle informazioni utente richieste dall'applicazione e integrarle con il framework delle appartenenze?</span><span class="sxs-lookup"><span data-stu-id="0d40e-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="0d40e-120">In questa esercitazione si risponderà a questa domanda compilando un'applicazione guestbook molto rudimentale.</span><span class="sxs-lookup"><span data-stu-id="0d40e-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="0d40e-121">In questo modo, si esamineranno diverse opzioni per la modellazione delle informazioni utente in un database e quindi si vedrà come associare questi dati agli account utente creati dal framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d40e-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="0d40e-122">Iniziamo!</span><span class="sxs-lookup"><span data-stu-id="0d40e-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="0d40e-123">Passaggio 1: creazione del modello di dati dell'applicazione Guestbook</span><span class="sxs-lookup"><span data-stu-id="0d40e-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="0d40e-124">Sono disponibili diverse tecniche che è possibile utilizzare per acquisire le informazioni sugli utenti in un database e associarle agli account utente creati dal framework di appartenenza.</span><span class="sxs-lookup"><span data-stu-id="0d40e-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="0d40e-125">Per illustrare queste tecniche, è necessario potenziare l'applicazione Web tutorial in modo che acquisisca alcuni dati correlati all'utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="0d40e-126">Attualmente, il modello di dati dell'applicazione contiene solo le tabelle dei servizi dell'applicazione necessarie per la `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="0d40e-127">Viene ora creata un'applicazione guestbook molto semplice in cui un utente autenticato può lasciare un commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="0d40e-128">Oltre a archiviare i commenti del Guestbook, consentire a ogni utente di archiviare la propria città, la Home page e la firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="0d40e-129">Se specificato, la città, la Home page e la firma dell'utente verranno visualizzate in ogni messaggio che ha lasciato nel guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="0d40e-130">Aggiunta della tabella`GuestbookComments`</span><span class="sxs-lookup"><span data-stu-id="0d40e-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="0d40e-131">Per acquisire i commenti del Guestbook, è necessario creare una tabella di database denominata `GuestbookComments` con colonne quali `CommentId`, `Subject`, `Body`e `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="0d40e-132">È anche necessario che ogni record nella tabella `GuestbookComments` faccia riferimento all'utente che ha lasciato il commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="0d40e-133">Per aggiungere la tabella al database, passare al Esplora database in Visual Studio ed eseguire il drill-down nel database `SecurityTutorials`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="0d40e-134">Fare clic con il pulsante destro del mouse sulla cartella tabelle e scegliere Aggiungi nuova tabella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="0d40e-135">Viene visualizzata un'interfaccia che consente di definire le colonne per la nuova tabella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-135">This brings up an interface that allows us to define the columns for the new table.</span></span>

<span data-ttu-id="0d40e-136">[![aggiungere una nuova tabella al database SecurityTutorials](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="0d40e-137">**Figura 1**: aggiungere una nuova tabella al Database di `SecurityTutorials` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-cs/_static/image3.png))</span></span>

<span data-ttu-id="0d40e-138">Definire quindi le colonne del `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="0d40e-139">Per iniziare, aggiungere una colonna denominata `CommentId` di tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="0d40e-140">Questa colonna identificherà in modo univoco ogni commento nel guestbook, quindi non consentire `NULL` s e contrassegnarlo come chiave primaria della tabella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="0d40e-141">Anziché fornire un valore per il campo `CommentId` in ogni `INSERT`, è possibile indicare che per questo campo è necessario generare automaticamente un nuovo valore `uniqueidentifier`, impostando il valore predefinito della colonna `INSERT` su `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="0d40e-142">Dopo aver aggiunto il primo campo, contrassegnato come chiave primaria e impostato il valore predefinito, la schermata dovrebbe essere simile allo screenshot illustrato nella figura 2.</span><span class="sxs-lookup"><span data-stu-id="0d40e-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>

<span data-ttu-id="0d40e-143">[![aggiungere una colonna primaria denominata CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="0d40e-144">**Figura 2**: aggiungere una colonna primaria denominata `CommentId` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-cs/_static/image6.png))</span></span>

<span data-ttu-id="0d40e-145">Successivamente, aggiungere una colonna denominata `Subject` di tipo `nvarchar(50)` e una colonna denominata `Body` di tipo `nvarchar(MAX)`, disabilitando `NULL` s in entrambe le colonne.</span><span class="sxs-lookup"><span data-stu-id="0d40e-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="0d40e-146">Successivamente, aggiungere una colonna denominata `CommentDate` di tipo `datetime`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="0d40e-147">Non consentire `NULL` s e impostare il valore predefinito della colonna `CommentDate` su `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="0d40e-148">Rimane solo l'aggiunta di una colonna che associa un account utente a ogni commento del Guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="0d40e-149">Un'opzione consiste nell'aggiungere una colonna denominata `UserName` di tipo `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="0d40e-150">Si tratta di una scelta appropriata quando si usa un provider di appartenenze diverso dal `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="0d40e-151">Tuttavia, quando si usa la `SqlMembershipProvider`, come in questa serie di esercitazioni, la colonna `UserName` della tabella `aspnet_Users` non è necessariamente univoca.</span><span class="sxs-lookup"><span data-stu-id="0d40e-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="0d40e-152">La chiave primaria della tabella `aspnet_Users` è `UserId` ed è di tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="0d40e-153">Per questo motivo, la tabella `GuestbookComments` necessita di una colonna denominata `UserId` di tipo `uniqueidentifier` (che non consente valori `NULL`).</span><span class="sxs-lookup"><span data-stu-id="0d40e-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="0d40e-154">Procedere e aggiungere questa colonna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-155">Come illustrato nell'esercitazione [*creazione dello schema di appartenenza in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) , il Framework di appartenenza è progettato per consentire a più applicazioni Web con account utente diversi di condividere lo stesso archivio utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="0d40e-156">Questa operazione viene eseguita tramite il partizionamento degli account utente in applicazioni diverse.</span><span class="sxs-lookup"><span data-stu-id="0d40e-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="0d40e-157">Mentre ogni nome utente è sicuramente univoco all'interno di un'applicazione, lo stesso nome utente può essere usato in applicazioni diverse con lo stesso archivio utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="0d40e-158">È presente un vincolo di `UNIQUE` composito nella tabella `aspnet_Users` dei campi `UserName` e `ApplicationId`, ma non uno solo nel campo `UserName`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="0d40e-159">Di conseguenza, è possibile che la tabella ASPNET\_Users disponga di due o più record con lo stesso valore `UserName`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="0d40e-160">Esiste, tuttavia, un vincolo `UNIQUE` nel campo `UserId` della tabella `aspnet_Users` (poiché si tratta della chiave primaria).</span><span class="sxs-lookup"><span data-stu-id="0d40e-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="0d40e-161">Un vincolo di `UNIQUE` è importante perché senza di esso non è possibile stabilire un vincolo di chiave esterna tra le tabelle `GuestbookComments` e `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>

<span data-ttu-id="0d40e-162">Dopo aver aggiunto la colonna `UserId`, salvare la tabella facendo clic sull'icona Salva sulla barra degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="0d40e-163">Assegnare un nome alla nuova tabella `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="0d40e-164">È stato riscontrato un ultimo problema da partecipare alla tabella `GuestbookComments`: è necessario creare un [vincolo FOREIGN KEY](https://msdn.microsoft.com/library/ms175464.aspx) tra la colonna `GuestbookComments.UserId` e la colonna `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="0d40e-165">A tale scopo, fare clic sull'icona relazione sulla barra degli strumenti per aprire la finestra di dialogo relazioni di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="0d40e-166">In alternativa, è possibile avviare questa finestra di dialogo passando al menu Progettazione tabelle e scegliendo relazioni.</span><span class="sxs-lookup"><span data-stu-id="0d40e-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="0d40e-167">Fare clic sul pulsante Aggiungi nell'angolo inferiore sinistro della finestra di dialogo relazioni di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="0d40e-168">Verrà aggiunto un nuovo vincolo FOREIGN KEY, sebbene sia ancora necessario definire le tabelle che fanno parte della relazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>

<span data-ttu-id="0d40e-169">[![utilizzare la finestra di dialogo Relazioni chiavi esterne per gestire i vincoli di chiave esterna di una tabella](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="0d40e-170">**Figura 3**: utilizzare la finestra di dialogo relazioni di chiave esterna per gestire i vincoli di chiave esterna di una tabella ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-cs/_static/image9.png))</span></span>

<span data-ttu-id="0d40e-171">Fare quindi clic sull'icona con i puntini di sospensione nella riga "specifiche tabelle e colonne" a destra.</span><span class="sxs-lookup"><span data-stu-id="0d40e-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="0d40e-172">Verrà avviata la finestra di dialogo tabelle e colonne dalla quale è possibile specificare la tabella e la colonna della chiave primaria e la colonna chiave esterna della tabella `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="0d40e-173">In particolare, selezionare `aspnet_Users` e `UserId` come colonna e tabella chiave primaria e `UserId` dalla tabella `GuestbookComments` come colonna chiave esterna (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="0d40e-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="0d40e-174">Dopo aver definito le colonne e le tabelle di chiave primaria ed esterna, fare clic su OK per tornare alla finestra di dialogo relazioni di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>

<span data-ttu-id="0d40e-175">[![stabilire un vincolo di chiave esterna tra le tabelle aspnet_Users e GuesbookComments](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="0d40e-176">**Figura 4**: stabilire un vincolo di chiave esterna tra le tabelle `aspnet_Users` e `GuesbookComments` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image12.png))</span></span>

<span data-ttu-id="0d40e-177">A questo punto è stato stabilito il vincolo FOREIGN KEY.</span><span class="sxs-lookup"><span data-stu-id="0d40e-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="0d40e-178">La presenza di questo vincolo garantisce l' [integrità relazionale](http://en.wikipedia.org/wiki/Referential_integrity) tra le due tabelle garantendo che non vi sia mai una voce del guestbook che fa riferimento a un account utente non esistente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="0d40e-179">Per impostazione predefinita, un vincolo di chiave esterna non consente l'eliminazione di un record padre se sono presenti record figlio corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="0d40e-180">Ovvero, se un utente crea uno o più commenti del Guestbook e si tenta di eliminare l'account utente, l'eliminazione avrà esito negativo a meno che i commenti del Guestbook non vengano eliminati per primi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="0d40e-181">È possibile configurare vincoli di chiave esterna per eliminare automaticamente i record figlio associati quando viene eliminato un record padre.</span><span class="sxs-lookup"><span data-stu-id="0d40e-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="0d40e-182">In altre parole, è possibile configurare questo vincolo FOREIGN KEY in modo che le voci del Guestbook di un utente vengano eliminate automaticamente quando viene eliminato l'account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="0d40e-183">A tale scopo, espandere la sezione "specifica di inserimento e aggiornamento" e impostare la proprietà "Elimina regola" su Cascade.</span><span class="sxs-lookup"><span data-stu-id="0d40e-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>

<span data-ttu-id="0d40e-184">[![configurare il vincolo FOREIGN KEY per le eliminazioni a catena](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="0d40e-185">**Figura 5**: configurare il vincolo FOREIGN KEY per le eliminazioni a catena ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-cs/_static/image15.png))</span></span>

<span data-ttu-id="0d40e-186">Per salvare il vincolo FOREIGN KEY, fare clic sul pulsante Chiudi per uscire dalle relazioni di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="0d40e-187">Fare quindi clic sull'icona Salva sulla barra degli strumenti per salvare la tabella e la relazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="0d40e-188">Archiviazione della città, della Home page e della firma dell'utente</span><span class="sxs-lookup"><span data-stu-id="0d40e-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="0d40e-189">Nella tabella `GuestbookComments` viene illustrato come archiviare informazioni che condividono una relazione uno-a-molti con gli account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="0d40e-190">Poiché ogni account utente può avere un numero arbitrario di commenti associati, questa relazione viene modellata creando una tabella per contenere il set di commenti che include una colonna che collega ogni commento a un determinato utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="0d40e-191">Quando si usa la `SqlMembershipProvider`, questo collegamento viene stabilito in modo ottimale creando una colonna denominata `UserId` di tipo `uniqueidentifier` e un vincolo di chiave esterna tra la colonna e `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="0d40e-192">È ora necessario associare tre colonne a ogni account utente per archiviare la città, la Home page e la firma dell'utente, che verranno visualizzate nei commenti del Guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="0d40e-193">Per eseguire questa operazione è possibile procedere in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="0d40e-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="0d40e-194"><strong>Aggiungere nuove colonne alle</strong> tabelle<strong>`aspnet_Users`</strong> <strong>o</strong> <strong>`aspnet_Membership`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="0d40e-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="0d40e-195">Questo approccio non è consigliato perché modifica lo schema utilizzato dal `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="0d40e-196">Questa decisione potrebbe tornare a ricorrere a una strada.</span><span class="sxs-lookup"><span data-stu-id="0d40e-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="0d40e-197">Ad esempio, cosa accade se una versione futura di ASP.NET usa uno schema di `SqlMembershipProvider` diverso.</span><span class="sxs-lookup"><span data-stu-id="0d40e-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="0d40e-198">Microsoft può includere uno strumento per eseguire la migrazione dei dati di `SqlMembershipProvider` ASP.NET 2,0 al nuovo schema, ma se è stato modificato lo schema `SqlMembershipProvider` ASP.NET 2,0, tale conversione potrebbe non essere possibile.</span><span class="sxs-lookup"><span data-stu-id="0d40e-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="0d40e-199">**Utilizzare ASP. Framework del profilo di NET, che definisce una proprietà del profilo per la città, la Home page e la firma.**</span><span class="sxs-lookup"><span data-stu-id="0d40e-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="0d40e-200">ASP.NET include un Framework del profilo progettato per archiviare dati aggiuntivi specifici dell'utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="0d40e-201">Come il Framework di appartenenza, il Framework del profilo è compilato in cima al modello del provider.</span><span class="sxs-lookup"><span data-stu-id="0d40e-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="0d40e-202">Il .NET Framework viene fornito con un `SqlProfileProvider` Federazione completata archivia i dati di profilo in un database SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0d40e-202">The .NET Framework ships with a `SqlProfileProvider` sthat stores profile data in a SQL Server database.</span></span> <span data-ttu-id="0d40e-203">Infatti, il database dispone già della tabella usata dal `SqlProfileProvider` (`aspnet_Profile`), perché è stata aggiunta quando i servizi dell'applicazione sono stati aggiunti di nuovo nell' <a id="_msoanchor_2"> </a>esercitazione [*creazione dello schema di appartenenza in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="0d40e-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial.</span></span>   
  <span data-ttu-id="0d40e-204">Il vantaggio principale del Framework del profilo è che consente agli sviluppatori di definire le proprietà del profilo in `Web.config`: non è necessario scrivere codice per serializzare i dati del profilo da e verso l'archivio dati sottostante.</span><span class="sxs-lookup"><span data-stu-id="0d40e-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="0d40e-205">In breve, è estremamente facile definire un set di proprietà del profilo e utilizzarle nel codice.</span><span class="sxs-lookup"><span data-stu-id="0d40e-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="0d40e-206">Tuttavia, il sistema del profilo lascia molto da desiderare per quanto riguarda il controllo delle versioni, pertanto se si dispone di un'applicazione in cui si prevede di aggiungere nuove proprietà specifiche dell'utente in un secondo momento oppure di quelle esistenti da rimuovere o modificare, il Framework del profilo potrebbe non essere il  opzione migliore.</span><span class="sxs-lookup"><span data-stu-id="0d40e-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="0d40e-207">Inoltre, il `SqlProfileProvider` archivia le proprietà del profilo in modo estremamente denormalizzato, rendendo impossibile l'esecuzione delle query direttamente sui dati del profilo, ad esempio il numero di utenti che hanno una città di New York.</span><span class="sxs-lookup"><span data-stu-id="0d40e-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="0d40e-208">Per ulteriori informazioni sul Framework del profilo, consultare la sezione "ulteriori letture" alla fine di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="0d40e-209"><strong>Aggiungere queste tre colonne a una nuova tabella nel database e stabilire una relazione uno-a-uno tra la tabella e</strong> <strong>`aspnet_Users`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="0d40e-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="0d40e-210">Questo approccio richiede un po' più di lavoro rispetto al Framework del profilo, ma offre la massima flessibilità nel modo in cui le proprietà utente aggiuntive vengono modellate nel database.</span><span class="sxs-lookup"><span data-stu-id="0d40e-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="0d40e-211">Questa è l'opzione che verrà usata in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="0d40e-212">Viene creata una nuova tabella denominata `UserProfiles` per salvare la città, la Home page e la firma per ogni utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="0d40e-213">Fare clic con il pulsante destro del mouse sulla cartella tabelle nella finestra Esplora database e scegliere di creare una nuova tabella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="0d40e-214">Denominare la prima colonna `UserId` e impostarne il tipo su `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="0d40e-215">Non consentire i valori `NULL` e contrassegnare la colonna come chiave primaria.</span><span class="sxs-lookup"><span data-stu-id="0d40e-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="0d40e-216">Successivamente, aggiungere le colonne denominate: `HomeTown` di tipo `nvarchar(50)`; `HomepageUrl` di tipo `nvarchar(100)`; e firma di tipo `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="0d40e-217">Ognuna di queste tre colonne può accettare un valore `NULL`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-217">Each of these three columns can accept a `NULL` value.</span></span>

<span data-ttu-id="0d40e-218">[![creare la tabella UserProfiles](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-218">[![Create the UserProfiles Table](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span></span>

<span data-ttu-id="0d40e-219">**Figura 6**: creare la tabella `UserProfiles` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image18.png))</span></span>

<span data-ttu-id="0d40e-220">Salvare la tabella e denominarla `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="0d40e-221">Infine, stabilire un vincolo FOREIGN KEY tra il campo `UserId` della tabella `UserProfiles` e il campo `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="0d40e-222">Come è stato fatto con il vincolo FOREIGN KEY tra le tabelle `GuestbookComments` e `aspnet_Users`, è necessario eliminare questo vincolo a cascata.</span><span class="sxs-lookup"><span data-stu-id="0d40e-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="0d40e-223">Poiché il campo `UserId` in `UserProfiles` è la chiave primaria, in questo modo si garantisce che non siano presenti più record nella tabella `UserProfiles` per ogni account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="0d40e-224">Questo tipo di relazione viene definito uno-a-uno.</span><span class="sxs-lookup"><span data-stu-id="0d40e-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="0d40e-225">Ora che è stato creato il modello di dati, è possibile usarlo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="0d40e-226">Nei passaggi 2 e 3 si osserverà il modo in cui l'utente attualmente connesso può visualizzare e modificare le informazioni relative alla città, alla Home page e alla firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="0d40e-227">Nel passaggio 4 viene creata l'interfaccia per consentire agli utenti autenticati di inviare nuovi commenti al guestbook e visualizzare quelli esistenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="0d40e-228">Passaggio 2: visualizzazione della città, della Home page e della firma dell'utente</span><span class="sxs-lookup"><span data-stu-id="0d40e-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="0d40e-229">Esistono diversi modi per consentire all'utente che ha eseguito l'accesso di visualizzare e modificare le informazioni relative alla città, alla Home page e alla firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="0d40e-230">È possibile creare manualmente l'interfaccia utente con i controlli TextBox e Label oppure è possibile usare uno dei controlli Web dei dati, ad esempio il controllo DetailsView.</span><span class="sxs-lookup"><span data-stu-id="0d40e-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="0d40e-231">Per eseguire il `SELECT` di database e le istruzioni `UPDATE` è possibile scrivere codice ADO.NET nella classe code-behind della pagina o, in alternativa, utilizzare un approccio dichiarativo con il SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0d40e-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="0d40e-232">Idealmente, l'applicazione conterrà un'architettura a più livelli, che è possibile richiamare a livello di codice dalla classe code-behind della pagina o in modo dichiarativo tramite il controllo ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="0d40e-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="0d40e-233">Poiché questa serie di esercitazioni è incentrata sull'autenticazione basata su form, sull'autorizzazione, sugli account utente e sui ruoli, non sarà disponibile una descrizione approfondita di queste diverse opzioni di accesso ai dati o perché un'architettura a più livelli è preferibile rispetto all'esecuzione diretta di istruzioni SQL dalla pagina ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0d40e-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="0d40e-234">Illustrerò l'utilizzo di DetailsView e SqlDataSource, l'opzione più rapida e più semplice, ma i concetti discussi possono essere certamente applicati a controlli Web alternativi e alla logica di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="0d40e-235">Per altre informazioni sull'uso dei dati in ASP.NET, vedere la serie di esercitazioni sull' *[uso dei dati in ASP.NET 2,0](../../data-access/index.md)* .</span><span class="sxs-lookup"><span data-stu-id="0d40e-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="0d40e-236">Aprire la pagina `AdditionalUserInfo.aspx` nella cartella `Membership` e aggiungere un controllo DetailsView alla pagina, impostando la relativa proprietà `ID` su `UserProfile` e deselezionando le proprietà `Width` e `Height`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its `ID` property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="0d40e-237">Espandere lo smart tag di DetailsView e scegliere di associarlo a un nuovo controllo origine dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="0d40e-238">Verrà avviata la configurazione guidata origine dati (vedere la figura 7).</span><span class="sxs-lookup"><span data-stu-id="0d40e-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="0d40e-239">Il primo passaggio richiede di specificare il tipo di origine dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="0d40e-240">Poiché ci si connette direttamente al database di `SecurityTutorials`, scegliere l'icona del database, specificando il `ID` come `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>

<span data-ttu-id="0d40e-241">[![aggiungere un nuovo controllo SqlDataSource denominato UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span></span>

<span data-ttu-id="0d40e-242">**Figura 7**: aggiungere un nuovo controllo SqlDataSource denominato `UserProfileDataSource` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-cs/_static/image21.png))</span></span>

<span data-ttu-id="0d40e-243">La schermata successiva richiede il database da usare.</span><span class="sxs-lookup"><span data-stu-id="0d40e-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="0d40e-244">È già stata definita una stringa di connessione in `Web.config` per il database `SecurityTutorials`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="0d40e-245">Il nome della stringa di connessione, `SecurityTutorialsConnectionString`, deve essere presente nell'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="0d40e-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="0d40e-246">Selezionare questa opzione e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-246">Select this option and click Next.</span></span>

<span data-ttu-id="0d40e-247">[![scegliere SecurityTutorialsConnectionString dall'elenco a discesa](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span></span>

<span data-ttu-id="0d40e-248">**Figura 8**: scegliere `SecurityTutorialsConnectionString` dall'elenco a discesa ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-cs/_static/image24.png))</span></span>

<span data-ttu-id="0d40e-249">Nella schermata successiva viene richiesto di specificare la tabella e le colonne per cui eseguire la query.</span><span class="sxs-lookup"><span data-stu-id="0d40e-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="0d40e-250">Scegliere la tabella `UserProfiles` dall'elenco a discesa e selezionare tutte le colonne.</span><span class="sxs-lookup"><span data-stu-id="0d40e-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>

<span data-ttu-id="0d40e-251">[![ripristinare tutte le colonne dalla tabella UserProfiles](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span></span>

<span data-ttu-id="0d40e-252">**Figura 9**: ripristinare tutte le colonne dalla tabella `UserProfiles` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image27.png))</span></span>

<span data-ttu-id="0d40e-253">La query corrente nella figura 9 restituisce *tutti* i record in `UserProfiles`, ma è interessato solo al record dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="0d40e-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="0d40e-254">Per aggiungere una clausola `WHERE`, fare clic sul pulsante `WHERE` per visualizzare la finestra di dialogo Aggiungi clausola `WHERE` (vedere la figura 10).</span><span class="sxs-lookup"><span data-stu-id="0d40e-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="0d40e-255">Qui è possibile selezionare la colonna in base a cui filtrare, l'operatore e l'origine del parametro Filter.</span><span class="sxs-lookup"><span data-stu-id="0d40e-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="0d40e-256">Selezionare `UserId` come colonna e "=" come operatore.</span><span class="sxs-lookup"><span data-stu-id="0d40e-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="0d40e-257">Sfortunatamente non è disponibile un'origine di parametro predefinita per restituire il valore `UserId` dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="0d40e-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="0d40e-258">È necessario acquisire questo valore a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="0d40e-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="0d40e-259">Quindi, impostare l'elenco a discesa origine su "nessuno", fare clic sul pulsante Aggiungi per aggiungere il parametro e quindi fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="0d40e-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>

<span data-ttu-id="0d40e-260">[![aggiungere un parametro di filtro nella colonna UserId](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span></span>

<span data-ttu-id="0d40e-261">**Figura 10**: aggiungere un parametro di filtro nella colonna `UserId` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-cs/_static/image30.png))</span></span>

<span data-ttu-id="0d40e-262">Dopo aver fatto clic su OK, verrà visualizzata la schermata illustrata nella figura 9.</span><span class="sxs-lookup"><span data-stu-id="0d40e-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="0d40e-263">Questa volta, tuttavia, la query SQL nella parte inferiore della schermata deve includere una clausola `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="0d40e-264">Fare clic su Avanti per passare alla schermata "query di test".</span><span class="sxs-lookup"><span data-stu-id="0d40e-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="0d40e-265">Qui è possibile eseguire la query e visualizzare i risultati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="0d40e-266">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0d40e-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="0d40e-267">Al termine della configurazione guidata origine dati, Visual Studio crea il controllo SqlDataSource in base alle impostazioni specificate nella procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0d40e-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="0d40e-268">Inoltre, aggiunge manualmente i BoundField al DetailsView per ogni colonna restituita dal `SelectCommand`di SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0d40e-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="0d40e-269">Non è necessario visualizzare il campo `UserId` in DetailsView, perché non è necessario che l'utente conosca questo valore.</span><span class="sxs-lookup"><span data-stu-id="0d40e-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="0d40e-270">È possibile rimuovere questo campo direttamente dal markup dichiarativo del controllo DetailsView o facendo clic sul collegamento "modifica campi" dal relativo smart tag.</span><span class="sxs-lookup"><span data-stu-id="0d40e-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="0d40e-271">A questo punto il markup dichiarativo della pagina avrà un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample1.aspx)]

<span data-ttu-id="0d40e-272">È necessario impostare a livello di codice il parametro `UserId` del controllo SqlDataSource sul `UserId` dell'utente attualmente connesso prima che i dati siano selezionati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="0d40e-273">Questa operazione può essere eseguita creando un gestore eventi per l'evento `Selecting` di SqlDataSource e aggiungendo il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample2.cs)]

<span data-ttu-id="0d40e-274">Il codice precedente inizia ottenendo un riferimento all'utente attualmente connesso chiamando il metodo `GetUser` della classe `Membership`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="0d40e-275">Viene restituito un oggetto `MembershipUser`, la cui proprietà `ProviderUserKey` contiene il `UserId`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="0d40e-276">Il valore `UserId` viene quindi assegnato al parametro `@UserId` di SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0d40e-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-277">Il metodo `Membership.GetUser()` restituisce informazioni sull'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="0d40e-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="0d40e-278">Se un utente anonimo sta visitando la pagina, restituirà il valore `null`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-278">If an anonymous user is visiting the page, it will return a value of `null`.</span></span> <span data-ttu-id="0d40e-279">In tal caso, si verificherà un `NullReferenceException` sulla riga di codice seguente quando si tenta di leggere la proprietà `ProviderUserKey`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="0d40e-280">Naturalmente, non è necessario preoccuparsi `Membership.GetUser()` restituire un valore `null` nella pagina `AdditionalUserInfo.aspx` perché è stata configurata l'autorizzazione URL in un'esercitazione precedente, in modo che solo gli utenti autenticati possano accedere alle risorse ASP.NET in questa cartella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-280">Of course, we don't have to worry about `Membership.GetUser()` returning a `null` value in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="0d40e-281">Se è necessario accedere alle informazioni sull'utente attualmente connesso in una pagina in cui è consentito l'accesso anonimo, assicurarsi di controllare che un oggetto non`null MembershipUser` venga restituito dal metodo `GetUser()` prima di fare riferimento alle relative proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d40e-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that a non-`null MembershipUser` object is returned from the `GetUser()` method before referencing its properties.</span></span>

<span data-ttu-id="0d40e-282">Se si visita la pagina `AdditionalUserInfo.aspx` tramite un browser, viene visualizzata una pagina vuota perché è ancora necessario aggiungere righe alla tabella `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="0d40e-283">Nel passaggio 6 verrà illustrato come personalizzare il controllo CreateUserWizard per aggiungere automaticamente una nuova riga alla tabella `UserProfiles` quando viene creato un nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="0d40e-284">Per il momento, tuttavia, è necessario creare manualmente un record nella tabella.</span><span class="sxs-lookup"><span data-stu-id="0d40e-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="0d40e-285">Passare alla Esplora database in Visual Studio ed espandere la cartella tabelle.</span><span class="sxs-lookup"><span data-stu-id="0d40e-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="0d40e-286">Fare clic con il pulsante destro del mouse sulla tabella `aspnet_Users` e scegliere "Mostra dati tabella" per visualizzare i record nella tabella. eseguire la stessa operazione per la tabella `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="0d40e-287">La figura 11 Mostra questi risultati quando viene affiancato verticalmente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="0d40e-288">Nel database sono attualmente presenti `aspnet_Users` record per Bruce, Fred e Tito, ma nessun record nella tabella `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>

<span data-ttu-id="0d40e-289">[![viene visualizzato il contenuto delle tabelle aspnet_Users e UserProfiles](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span></span>

<span data-ttu-id="0d40e-290">**Figura 11**: viene visualizzato il contenuto delle tabelle `aspnet_Users` e `UserProfiles` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-cs/_static/image33.png))</span></span>

<span data-ttu-id="0d40e-291">Aggiungere un nuovo record alla tabella `UserProfiles` digitando manualmente i valori per i campi `HomeTown`, `HomepageUrl`e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="0d40e-292">Il modo più semplice per ottenere un valore `UserId` valido nel nuovo record `UserProfiles` consiste nel selezionare il campo `UserId` da un determinato account utente nella tabella `aspnet_Users` e copiarlo e incollarlo nel campo `UserId` in `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="0d40e-293">La figura 12 Mostra la tabella `UserProfiles` dopo l'aggiunta di un nuovo record per Bruce.</span><span class="sxs-lookup"><span data-stu-id="0d40e-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>

<span data-ttu-id="0d40e-294">[![è stato aggiunto un record a UserProfiles per Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span></span>

<span data-ttu-id="0d40e-295">**Figura 12**: è stato aggiunto un Record a `UserProfiles` per Bruce ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-cs/_static/image36.png))</span></span>

<span data-ttu-id="0d40e-296">Tornare alla pagina `AdditionalUserInfo.aspx`, accedere come Bruce.</span><span class="sxs-lookup"><span data-stu-id="0d40e-296">Return to the `AdditionalUserInfo.aspx` page, logged in as Bruce.</span></span> <span data-ttu-id="0d40e-297">Come illustrato nella figura 13, vengono visualizzate le impostazioni di Bruce.</span><span class="sxs-lookup"><span data-stu-id="0d40e-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>

<span data-ttu-id="0d40e-298">[![l'utente attualmente visitato viene visualizzato le impostazioni](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span></span>

<span data-ttu-id="0d40e-299">**Figura 13**: l'utente attualmente visitato viene visualizzato le impostazioni ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-cs/_static/image39.png))</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-300">Procedere e aggiungere manualmente i record nella tabella `UserProfiles` per ogni utente di appartenenza.</span><span class="sxs-lookup"><span data-stu-id="0d40e-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="0d40e-301">Nel passaggio 6 verrà illustrato come personalizzare il controllo CreateUserWizard per aggiungere automaticamente una nuova riga alla tabella `UserProfiles` quando viene creato un nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>

## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="0d40e-302">Passaggio 3: consentire all'utente di modificare la propria città, la Home page e la firma</span><span class="sxs-lookup"><span data-stu-id="0d40e-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="0d40e-303">A questo punto, l'utente attualmente connesso può visualizzare la propria città, la Home page e l'impostazione della firma, ma non possono ancora modificarle.</span><span class="sxs-lookup"><span data-stu-id="0d40e-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="0d40e-304">Verrà ora aggiornato il controllo DetailsView in modo che i dati possano essere modificati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="0d40e-305">Per prima cosa è necessario aggiungere un `UpdateCommand` per il SqlDataSource, specificando l'istruzione `UPDATE` da eseguire e i parametri corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="0d40e-306">Selezionare il SqlDataSource e, dal Finestra Proprietà, fare clic sui puntini di sospensione accanto alla proprietà UpdateQuery per visualizzare la finestra di dialogo Editor comandi e parametri.</span><span class="sxs-lookup"><span data-stu-id="0d40e-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="0d40e-307">Immettere la seguente istruzione `UPDATE` nella casella di testo:</span><span class="sxs-lookup"><span data-stu-id="0d40e-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-cs/samples/sample3.sql)]

<span data-ttu-id="0d40e-308">Fare quindi clic sul pulsante "Aggiorna parametri" per creare un parametro nella raccolta `UpdateParameters` del controllo SqlDataSource per ognuno dei parametri nell'istruzione `UPDATE`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="0d40e-309">Lasciare l'origine di tutti i parametri impostati su None e fare clic sul pulsante OK per completare la finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>

<span data-ttu-id="0d40e-310">[![specificare l'oggetto UpdateCommand e UpdateParameters di SqlDataSource](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span></span>

<span data-ttu-id="0d40e-311">**Figura 14**: specificare il `UpdateCommand` e il `UpdateParameters` del SqlDataSource ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-cs/_static/image42.png))</span></span>

<span data-ttu-id="0d40e-312">A causa delle aggiunte apportate al controllo SqlDataSource, il controllo DetailsView può ora supportare la modifica.</span><span class="sxs-lookup"><span data-stu-id="0d40e-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="0d40e-313">Dallo smart tag di DetailsView, selezionare la casella di controllo "Abilita modifica".</span><span class="sxs-lookup"><span data-stu-id="0d40e-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="0d40e-314">Viene aggiunto un oggetto CommandField alla raccolta `Fields` del controllo con la relativa proprietà `ShowEditButton` impostata su true.</span><span class="sxs-lookup"><span data-stu-id="0d40e-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="0d40e-315">Viene eseguito il rendering di un pulsante modifica quando DetailsView viene visualizzato in modalità di sola lettura e pulsanti Aggiorna e Annulla quando viene visualizzato in modalità di modifica.</span><span class="sxs-lookup"><span data-stu-id="0d40e-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="0d40e-316">Anziché richiedere all'utente di fare clic su modifica, tuttavia, è possibile eseguire il rendering di DetailsView in uno stato "sempre modificabile" impostando la [proprietà`DefaultMode`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) del controllo detailsview su `Edit`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="0d40e-317">Con queste modifiche, il markup dichiarativo del controllo DetailsView dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample4.aspx)]

<span data-ttu-id="0d40e-318">Si noti l'aggiunta di CommandField e della proprietà `DefaultMode`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="0d40e-319">Procedere e testare questa pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0d40e-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="0d40e-320">Quando si visita un utente con un record corrispondente in `UserProfiles`, le impostazioni dell'utente vengono visualizzate in un'interfaccia modificabile.</span><span class="sxs-lookup"><span data-stu-id="0d40e-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>

<span data-ttu-id="0d40e-321">[![DetailsView esegue il rendering di un'interfaccia modificabile](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span></span>

<span data-ttu-id="0d40e-322">**Figura 15**: il DetailsView esegue il rendering di un'interfaccia modificabile ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-cs/_static/image45.png))</span></span>

<span data-ttu-id="0d40e-323">Provare a modificare i valori e fare clic sul pulsante Aggiorna.</span><span class="sxs-lookup"><span data-stu-id="0d40e-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="0d40e-324">Sembra che non accada nulla.</span><span class="sxs-lookup"><span data-stu-id="0d40e-324">It appears as if nothing happens.</span></span> <span data-ttu-id="0d40e-325">È presente un postback e i valori vengono salvati nel database, ma non è presente alcun feedback visivo che si è verificato durante il salvataggio.</span><span class="sxs-lookup"><span data-stu-id="0d40e-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="0d40e-326">Per risolvere questo problema, tornare a Visual Studio e aggiungere un controllo etichetta sopra il DetailsView.</span><span class="sxs-lookup"><span data-stu-id="0d40e-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="0d40e-327">Impostare la relativa `ID` su `SettingsUpdatedMessage`, la relativa proprietà `Text` su "le impostazioni sono state aggiornate" e le proprietà `Visible` e `EnableViewState` per `false`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `false`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample5.aspx)]

<span data-ttu-id="0d40e-328">È necessario visualizzare l'etichetta di `SettingsUpdatedMessage` ogni volta che DetailsView viene aggiornato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="0d40e-329">A tale scopo, creare un gestore eventi per l'evento `ItemUpdated` di DetailsView e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample6.cs)]

<span data-ttu-id="0d40e-330">Tornare alla pagina `AdditionalUserInfo.aspx` tramite un browser e aggiornare i dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="0d40e-331">Questa volta, viene visualizzato un messaggio di stato utile.</span><span class="sxs-lookup"><span data-stu-id="0d40e-331">This time, a helpful status message is displayed.</span></span>

<span data-ttu-id="0d40e-332">[![viene visualizzato un breve messaggio quando le impostazioni vengono aggiornate](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span></span>

<span data-ttu-id="0d40e-333">**Figura 16**: viene visualizzato un breve messaggio quando le impostazioni vengono aggiornate ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-cs/_static/image48.png))</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-334">L'interfaccia di modifica del controllo DetailsView lascia molto da desiderare.</span><span class="sxs-lookup"><span data-stu-id="0d40e-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="0d40e-335">USA caselle di testo di dimensioni standard, ma il campo della firma deve essere probabilmente una casella di testo a più righe.</span><span class="sxs-lookup"><span data-stu-id="0d40e-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="0d40e-336">È consigliabile usare un RegularExpressionValidator per assicurarsi che l'URL della Home page, se immesso, inizi con "http://" o "https://".</span><span class="sxs-lookup"><span data-stu-id="0d40e-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="0d40e-337">Inoltre, poiché il controllo DetailsView ha la proprietà `DefaultMode` impostata su `Edit`, il pulsante Annulla non esegue alcuna operazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="0d40e-338">Deve essere rimosso o, se selezionato, reindirizzare l'utente a un'altra pagina, ad esempio `~/Default.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="0d40e-339">Lascio questi miglioramenti come esercizio per il lettore.</span><span class="sxs-lookup"><span data-stu-id="0d40e-339">I leave these enhancements as an exercise for the reader.</span></span>

### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="0d40e-340">Aggiunta di un collegamento alla pagina`AdditionalUserInfo.aspx`nella pagina master</span><span class="sxs-lookup"><span data-stu-id="0d40e-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="0d40e-341">Attualmente, il sito Web non fornisce alcun collegamento alla pagina `AdditionalUserInfo.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="0d40e-342">L'unico modo per raggiungerlo consiste nell'immettere l'URL della pagina direttamente nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="0d40e-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="0d40e-343">Verrà ora aggiunto un collegamento a questa pagina nella pagina master `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="0d40e-344">Si ricordi che la pagina master contiene un controllo Web LoginView nella `LoginContent` ContentPlaceHolder che visualizza un markup diverso per i visitatori autenticati e anonimi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="0d40e-345">Aggiornare la `LoggedInTemplate` del controllo LoginView per includere un collegamento alla pagina di `AdditionalUserInfo.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="0d40e-346">Dopo avere apportato queste modifiche, il markup dichiarativo del controllo LoginView dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample7.aspx)]

<span data-ttu-id="0d40e-347">Si noti l'aggiunta del controllo collegamento ipertestuale `lnkUpdateSettings` al `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="0d40e-348">Con questo collegamento, gli utenti autenticati possono passare rapidamente alla pagina per visualizzare e modificare le impostazioni della città, della Home page e della firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="0d40e-349">Passaggio 4: aggiunta di nuovi commenti del Guestbook</span><span class="sxs-lookup"><span data-stu-id="0d40e-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="0d40e-350">La pagina `Guestbook.aspx` consente agli utenti autenticati di visualizzare il Guestbook e lasciare un commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="0d40e-351">Iniziamo con la creazione dell'interfaccia per aggiungere nuovi commenti del Guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="0d40e-352">Aprire la pagina `Guestbook.aspx` in Visual Studio e creare un'interfaccia utente costituita da due controlli TextBox, uno per l'oggetto del nuovo commento e uno per il corpo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="0d40e-353">Impostare la proprietà `ID` del primo controllo TextBox su `Subject` e la relativa proprietà `Columns` su 40; impostare la `ID` del secondo su `Body`, la relativa `TextMode` su `MultiLine`e le proprietà `Width` e `Rows` rispettivamente su "95%" e 8.</span><span class="sxs-lookup"><span data-stu-id="0d40e-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="0d40e-354">Per completare l'interfaccia utente, aggiungere un controllo Web Button denominato `PostCommentButton` e impostare la relativa proprietà `Text` su "pubblicare il commento".</span><span class="sxs-lookup"><span data-stu-id="0d40e-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="0d40e-355">Poiché ogni commento del Guestbook richiede un oggetto e un corpo, aggiungere un RequiredFieldValidator per ciascuna casella di testo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="0d40e-356">Impostare la proprietà `ValidationGroup` di questi controlli su "EnterComment"; allo stesso modo, impostare la proprietà `ValidationGroup` del controllo `PostCommentButton` su "EnterComment".</span><span class="sxs-lookup"><span data-stu-id="0d40e-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="0d40e-357">Per ulteriori informazioni su ASP. I controlli di convalida di NET, la verifica della [convalida dei moduli in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [la dissezione dei controlli di convalida in ASP.NET 2,0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)e l' [esercitazione sui controlli server di convalida](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) in [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="0d40e-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="0d40e-358">Dopo aver creato l'interfaccia utente, il markup dichiarativo della pagina avrà un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample8.aspx)]

<span data-ttu-id="0d40e-359">Con l'interfaccia utente completata, l'attività successiva consiste nell'inserire un nuovo record nella tabella `GuestbookComments` quando si fa clic sull'`PostCommentButton`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="0d40e-360">Questa operazione può essere eseguita in diversi modi: è possibile scrivere codice ADO.NET nel gestore dell'evento `Click` del pulsante; è possibile aggiungere un controllo SqlDataSource alla pagina, configurare la relativa `InsertCommand`e quindi chiamare il relativo metodo `Insert` dal gestore dell'evento `Click`; in alternativa, è possibile creare un livello intermedio responsabile dell'inserimento dei nuovi commenti del Guestbook e richiamare questa funzionalità dal gestore dell'evento `Click`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="0d40e-361">Dal momento che è stato esaminato l'uso di un SqlDataSource nel passaggio 3, è ora usato il codice ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="0d40e-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-362">Le classi ADO.NET utilizzate per accedere a livello di codice ai dati da un database di Microsoft SQL Server si trovano nello spazio dei nomi `System.Data.SqlClient`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="0d40e-363">Potrebbe essere necessario importare questo spazio dei nomi nella classe code-behind della pagina, ad esempio `using System.Data.SqlClient;`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-363">You may need to import this namespace into your page's code-behind class (i.e., `using System.Data.SqlClient;`).</span></span>

<span data-ttu-id="0d40e-364">Creare un gestore eventi per l'evento `Click` del `PostCommentButton`e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample9.cs)]

<span data-ttu-id="0d40e-365">Il gestore dell'evento `Click` inizia verificando che i dati specificati dall'utente siano validi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="0d40e-366">In caso contrario, il gestore eventi viene chiuso prima di inserire un record.</span><span class="sxs-lookup"><span data-stu-id="0d40e-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="0d40e-367">Supponendo che i dati specificati siano validi, il valore `UserId` dell'utente attualmente connesso viene recuperato e archiviato nella variabile locale `currentUserId`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="0d40e-368">Questo valore è necessario perché è necessario fornire un valore `UserId` quando si inserisce un record in `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="0d40e-369">In seguito, la stringa di connessione per il database `SecurityTutorials` viene recuperata da `Web.config` e viene specificata l'istruzione SQL `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="0d40e-370">Viene quindi creato e aperto un oggetto `SqlConnection`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="0d40e-371">Viene quindi creato un oggetto `SqlCommand` e vengono assegnati i valori per i parametri utilizzati nella query `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="0d40e-372">L'istruzione `INSERT` viene quindi eseguita e la connessione viene chiusa.</span><span class="sxs-lookup"><span data-stu-id="0d40e-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="0d40e-373">Alla fine del gestore dell'evento, le `Subject` e `Body` le caselle di testo ' `Text` le proprietà vengono cancellate in modo che i valori dell'utente non siano salvati in modo permanente nel postback.</span><span class="sxs-lookup"><span data-stu-id="0d40e-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="0d40e-374">Procedere e testare questa pagina in un browser.</span><span class="sxs-lookup"><span data-stu-id="0d40e-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="0d40e-375">Poiché questa pagina si trova nella cartella `Membership` non è accessibile ai visitatori anonimi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="0d40e-376">Pertanto, sarà necessario prima accedere (se non è già stato fatto).</span><span class="sxs-lookup"><span data-stu-id="0d40e-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="0d40e-377">Immettere un valore nelle caselle di testo `Subject` e `Body` e fare clic sul pulsante `PostCommentButton`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="0d40e-378">In questo modo verrà aggiunto un nuovo record a `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="0d40e-379">Durante il postback, l'oggetto e il corpo specificati vengono cancellati dalle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="0d40e-380">Dopo aver fatto clic sul pulsante `PostCommentButton` non sono presenti commenti visivi che il commento è stato aggiunto al guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="0d40e-381">È ancora necessario aggiornare questa pagina per visualizzare i commenti del Guestbook esistente, che verrà eseguita nel passaggio 5.</span><span class="sxs-lookup"><span data-stu-id="0d40e-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="0d40e-382">Al termine di questa operazione, il commento appena aggiunto verrà visualizzato nell'elenco di commenti, fornendo un feedback visivo adeguato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="0d40e-383">Per il momento, verificare che il commento del Guestbook sia stato salvato esaminando il contenuto della tabella `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="0d40e-384">Nella figura 17 viene illustrato il contenuto della tabella `GuestbookComments` dopo che sono stati lasciati due commenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>

<span data-ttu-id="0d40e-385">[![è possibile visualizzare i commenti del Guestbook nella tabella GuestbookComments](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span></span>

<span data-ttu-id="0d40e-386">**Figura 17**: è possibile visualizzare i commenti del Guestbook nella tabella `GuestbookComments` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image51.png))</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-387">Se un utente tenta di inserire un commento del guestbook che contiene un markup potenzialmente pericoloso, ad esempio HTML – ASP.NET genererà un `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="0d40e-388">Per altre informazioni su questa eccezione, perché viene generata e come consentire agli utenti di inviare valori potenzialmente pericolosi, vedere il [white paper sulla convalida della richiesta](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="0d40e-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>

## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="0d40e-389">Passaggio 5: elencare i commenti del Guestbook esistente</span><span class="sxs-lookup"><span data-stu-id="0d40e-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="0d40e-390">Oltre a lasciare commenti, un utente che visita la pagina `Guestbook.aspx` dovrebbe anche poter visualizzare i commenti esistenti del Guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="0d40e-391">A tale scopo, aggiungere un controllo ListView denominato `CommentList` nella parte inferiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="0d40e-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-392">Il controllo ListView è una novità della versione 3,5 di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0d40e-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="0d40e-393">È progettato per visualizzare un elenco di elementi in un layout molto personalizzabile e flessibile, pur continuando a offrire funzionalità predefinite di modifica, inserimento, eliminazione, paging e ordinamento come GridView.</span><span class="sxs-lookup"><span data-stu-id="0d40e-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="0d40e-394">Se si usa ASP.NET 2,0, sarà necessario usare invece il controllo DataList o Repeater.</span><span class="sxs-lookup"><span data-stu-id="0d40e-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="0d40e-395">Per altre informazioni sull'uso di ListView, vedere il post del Blog di [Scott Guthrie](https://weblogs.asp.net/scottgu/), [il controllo ASP: ListView](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)e il mio articolo, che [Visualizza i dati con il controllo ListView](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>

<span data-ttu-id="0d40e-396">Aprire lo smart tag del ListView e, dall'elenco a discesa Scegli origine dati, associare il controllo a una nuova origine dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="0d40e-397">Come illustrato nel passaggio 2, verrà avviata la configurazione guidata origine dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="0d40e-398">Selezionare l'icona del database, denominare il `CommentsDataSource`SqlDataSource risultante e fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="0d40e-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="0d40e-399">Selezionare quindi la stringa di connessione `SecurityTutorialsConnectionString` dall'elenco a discesa e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="0d40e-400">A questo punto nel passaggio 2 sono stati specificati i dati da interrogare selezionando la tabella `UserProfiles` dall'elenco a discesa e selezionando le colonne da restituire (fare riferimento alla figura 9).</span><span class="sxs-lookup"><span data-stu-id="0d40e-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="0d40e-401">Questa volta, tuttavia, si vuole creare un'istruzione SQL che estrae non solo i record da `GuestbookComments`, ma anche la città principale, la firma e il nome utente del commentatore.</span><span class="sxs-lookup"><span data-stu-id="0d40e-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="0d40e-402">Selezionare quindi il pulsante di opzione "specificare un'istruzione SQL personalizzata o stored procedure" e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="0d40e-403">Verrà visualizzata la schermata "Definisci istruzioni personalizzate o stored procedure".</span><span class="sxs-lookup"><span data-stu-id="0d40e-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="0d40e-404">Per compilare graficamente la query, fare clic sul pulsante Generatore di query.</span><span class="sxs-lookup"><span data-stu-id="0d40e-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="0d40e-405">Il Generatore di query inizia richiedendo di specificare le tabelle da cui si desidera eseguire una query.</span><span class="sxs-lookup"><span data-stu-id="0d40e-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="0d40e-406">Selezionare le tabelle `GuestbookComments`, `UserProfiles`e `aspnet_Users`, quindi fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="0d40e-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="0d40e-407">In questo modo, tutte e tre le tabelle vengono aggiunte all'area di progettazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="0d40e-408">Poiché esistono vincoli di chiave esterna tra le tabelle `GuestbookComments`, `UserProfiles`e `aspnet_Users`, il Generatore di query automaticamente `JOIN` le tabelle.</span><span class="sxs-lookup"><span data-stu-id="0d40e-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="0d40e-409">Non resta che specificare le colonne da restituire.</span><span class="sxs-lookup"><span data-stu-id="0d40e-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="0d40e-410">Dalla tabella `GuestbookComments` selezionare le colonne `Subject`, `Body`e `CommentDate`; restituire le colonne `HomeTown`, `HomepageUrl`e `Signature` della tabella `UserProfiles`; e restituiscono `UserName` da `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="0d40e-411">Aggiungere anche "`ORDER BY CommentDate DESC`" alla fine della query `SELECT` in modo che vengano restituiti per primi i post più recenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="0d40e-412">Dopo aver effettuato queste selezioni, l'interfaccia Generatore di query dovrebbe essere simile a quella illustrata nella figura 18.</span><span class="sxs-lookup"><span data-stu-id="0d40e-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>

<span data-ttu-id="0d40e-413">[![la query costruita unisce le tabelle GuestbookComments, UserProfile e aspnet_Users](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span></span>

<span data-ttu-id="0d40e-414">**Figura 18**: la Query costruita `JOIN` s le tabelle `GuestbookComments`, `UserProfiles`e `aspnet_Users` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image54.png))</span></span>

<span data-ttu-id="0d40e-415">Fare clic su OK per chiudere la finestra di Generatore di query e tornare alla schermata "Definisci istruzioni personalizzate o stored procedure".</span><span class="sxs-lookup"><span data-stu-id="0d40e-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="0d40e-416">Fare clic su Avanti per passare alla schermata "Test query", in cui è possibile visualizzare i risultati della query facendo clic sul pulsante Test query.</span><span class="sxs-lookup"><span data-stu-id="0d40e-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="0d40e-417">Quando si è pronti, fare clic su fine per completare la procedura guidata Configura origine dati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="0d40e-418">Al termine della configurazione guidata origine dati nel passaggio 2, l'insieme di `Fields` del controllo DetailsView associato è stato aggiornato in modo da includere un BoundField per ogni colonna restituita dall'`SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="0d40e-419">Il controllo ListView, tuttavia, rimane invariato; è comunque necessario definirne il layout.</span><span class="sxs-lookup"><span data-stu-id="0d40e-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="0d40e-420">Il layout di ListView può essere costruito manualmente tramite il markup dichiarativo o dall'opzione "Configura ListView" nello smart tag.</span><span class="sxs-lookup"><span data-stu-id="0d40e-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="0d40e-421">Generalmente preferisco definire il markup manualmente, ma usare qualsiasi metodo più naturale.</span><span class="sxs-lookup"><span data-stu-id="0d40e-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="0d40e-422">Ho terminato di usare i seguenti `LayoutTemplate`, `ItemTemplate`e `ItemSeparatorTemplate` per il controllo ListView:</span><span class="sxs-lookup"><span data-stu-id="0d40e-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample10.aspx)]

<span data-ttu-id="0d40e-423">Il `LayoutTemplate` definisce il markup emesso dal controllo, mentre il `ItemTemplate` esegue il rendering di ogni elemento restituito dal SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0d40e-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="0d40e-424">Il markup risultante del `ItemTemplate`viene inserito nel controllo `itemPlaceholder` di `LayoutTemplate`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="0d40e-425">Oltre al `itemPlaceholder`, il `LayoutTemplate` include un controllo DataPager, che limita il ListView a visualizzare solo 10 commenti del Guestbook per pagina (impostazione predefinita) ed esegue il rendering di un'interfaccia di paging.</span><span class="sxs-lookup"><span data-stu-id="0d40e-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="0d40e-426">My `ItemTemplate` Visualizza l'oggetto del commento di ogni Guestbook in un elemento `<h4>` con il corpo situato al di sotto dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="0d40e-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="0d40e-427">Si noti che la sintassi utilizzata per la visualizzazione del corpo prende i dati restituiti dall'istruzione `Eval("Body")` DataBinding, li converte in una stringa e sostituisce le interruzioni di riga con l'elemento `<br />`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="0d40e-428">Questa conversione è necessaria per mostrare le interruzioni di riga immesse durante l'invio del commento poiché lo spazio vuoto viene ignorato da HTML.</span><span class="sxs-lookup"><span data-stu-id="0d40e-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="0d40e-429">La firma dell'utente viene visualizzata sotto il corpo in corsivo, seguita dalla Home page dell'utente, da un collegamento alla Home page, dalla data e dall'ora in cui è stato creato il commento e dal nome utente della persona che ha lasciato il commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="0d40e-430">È possibile visualizzare la pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0d40e-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="0d40e-431">Verranno visualizzati i commenti aggiunti al guestbook nel passaggio 5 visualizzato qui.</span><span class="sxs-lookup"><span data-stu-id="0d40e-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>

<span data-ttu-id="0d40e-432">[![Guestbook. aspx ora Visualizza i commenti del Guestbook](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span></span>

<span data-ttu-id="0d40e-433">**Figura 19**: `Guestbook.aspx` ora Visualizza i commenti del Guestbook ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-cs/_static/image57.png))</span></span>

<span data-ttu-id="0d40e-434">Provare ad aggiungere un nuovo commento al guestbook.</span><span class="sxs-lookup"><span data-stu-id="0d40e-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="0d40e-435">Quando si fa clic sul pulsante `PostCommentButton` viene eseguito il postback della pagina e il commento viene aggiunto al database, ma il controllo ListView non viene aggiornato per visualizzare il nuovo commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="0d40e-436">Questo problema può essere risolto da uno dei seguenti valori:</span><span class="sxs-lookup"><span data-stu-id="0d40e-436">This can be fixed by either:</span></span>

- <span data-ttu-id="0d40e-437">Aggiornamento del gestore dell'evento `Click` del pulsante `PostCommentButton` in modo che richiami il metodo di `DataBind()` del controllo ListView dopo l'inserimento del nuovo commento nel database.</span><span class="sxs-lookup"><span data-stu-id="0d40e-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="0d40e-438">Impostazione della proprietà `EnableViewState` del controllo ListView su `false`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-438">Setting the ListView control's `EnableViewState` property to `false`.</span></span> <span data-ttu-id="0d40e-439">Questo approccio funziona perché disabilitando lo stato di visualizzazione del controllo, deve essere riassociato ai dati sottostanti in ogni postback.</span><span class="sxs-lookup"><span data-stu-id="0d40e-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="0d40e-440">Il sito Web dell'esercitazione scaricabile da questa esercitazione illustra entrambe le tecniche.</span><span class="sxs-lookup"><span data-stu-id="0d40e-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="0d40e-441">Il `EnableViewState` proprietà del controllo ListView da `false` e il codice necessario per riassociare i dati al controllo ListView sono presenti nel gestore dell'evento `Click`, ma è impostato come commento.</span><span class="sxs-lookup"><span data-stu-id="0d40e-441">The ListView control's `EnableViewState` property to `false` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-442">Attualmente la pagina `AdditionalUserInfo.aspx` consente all'utente di visualizzare e modificare le impostazioni della città, della Home page e della firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="0d40e-443">Potrebbe essere utile aggiornare `AdditionalUserInfo.aspx` per visualizzare i commenti del Guestbook dell'utente connesso.</span><span class="sxs-lookup"><span data-stu-id="0d40e-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="0d40e-444">Ovvero, oltre a esaminare e modificare le informazioni, un utente può visitare la pagina `AdditionalUserInfo.aspx` per vedere quali commenti del Guestbook è stato fatto in passato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="0d40e-445">Lo lascio come esercizio per il lettore interessato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-445">I leave this as an exercise for the interested reader.</span></span>

## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="0d40e-446">Passaggio 6: personalizzazione del controllo CreateUserWizard per includere un'interfaccia per la città, la Home page e la firma</span><span class="sxs-lookup"><span data-stu-id="0d40e-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="0d40e-447">La query `SELECT` utilizzata dalla pagina `Guestbook.aspx` utilizza un `INNER JOIN` per combinare i record correlati tra le tabelle `GuestbookComments`, `UserProfiles`e `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="0d40e-448">Se un utente privo di record in `UserProfiles` crea un commento del Guestbook, il commento non verrà visualizzato in ListView perché il `INNER JOIN` restituisce solo `GuestbookComments` record quando sono presenti record corrispondenti in `UserProfiles` e `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="0d40e-449">Come illustrato nel passaggio 3, se un utente non dispone di un record in `UserProfiles` non è in grado di visualizzare o modificare le impostazioni nella pagina `AdditionalUserInfo.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="0d40e-450">Inutile dire che, a causa delle decisioni di progettazione, è importante che ogni account utente nel sistema di appartenenza disponga di un record corrispondente nella tabella `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="0d40e-451">Si vuole che un record corrispondente venga aggiunto a `UserProfiles` ogni volta che viene creato un nuovo account utente di appartenenza tramite CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="0d40e-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="0d40e-452">Come illustrato nell'esercitazione [*creazione di account utente*](creating-user-accounts-cs.md) , dopo la creazione del nuovo account utente di appartenenza, il controllo CreateUserWizard genera il relativo [evento`CreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="0d40e-453">È possibile creare un gestore eventi per questo evento, ottenere l'ID utente per l'utente appena creato e quindi inserire un record nella tabella `UserProfiles` con i valori predefiniti per le colonne `HomeTown`, `HomepageUrl`e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="0d40e-454">Inoltre, è possibile richiedere all'utente questi valori personalizzando l'interfaccia del controllo CreateUserWizard per includere altre caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="0d40e-455">Si osservi innanzitutto come aggiungere una nuova riga alla tabella `UserProfiles` nel gestore eventi `CreatedUser` con i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="0d40e-456">In seguito, si vedrà come personalizzare l'interfaccia utente del controllo CreateUserWizard per includere campi modulo aggiuntivi per raccogliere la Home page, la Home page e la firma del nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="0d40e-457">Aggiunta di una riga predefinita a`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="0d40e-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="0d40e-458">Nell'esercitazione [*creazione di account utente*](creating-user-accounts-cs.md) è stato aggiunto un controllo CreateUserWizard alla pagina `CreatingUserAccounts.aspx` nella cartella `Membership`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-458">In the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="0d40e-459">Per fare in modo che il controllo CreateUserWizard aggiunga un record a `UserProfiles` tabella durante la creazione dell'account utente, è necessario aggiornare la funzionalità del controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="0d40e-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="0d40e-460">Invece di apportare queste modifiche alla pagina `CreatingUserAccounts.aspx`, è necessario aggiungere un nuovo controllo CreateUserWizard a `EnhancedCreateUserWizard.aspx` pagina e apportare le modifiche per questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="0d40e-461">Aprire la pagina `EnhancedCreateUserWizard.aspx` in Visual Studio e trascinare un controllo CreateUserWizard dalla casella degli strumenti nella pagina.</span><span class="sxs-lookup"><span data-stu-id="0d40e-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="0d40e-462">Impostare la proprietà `ID` del controllo CreateUserWizard su `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="0d40e-463">Come illustrato nell' <a id="_msoanchor_5"> </a>esercitazione [*creazione di account utente*](creating-user-accounts-cs.md) , l'interfaccia utente predefinita di CreateUserWizard richiede al visitatore le informazioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="0d40e-463">As we discussed in the <a id="_msoanchor_5"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="0d40e-464">Una volta fornite queste informazioni, il controllo crea internamente un nuovo account utente nel Framework di appartenenza, il tutto senza dover scrivere una sola riga di codice.</span><span class="sxs-lookup"><span data-stu-id="0d40e-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="0d40e-465">Il controllo CreateUserWizard genera un certo numero di eventi durante il relativo flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="0d40e-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="0d40e-466">Quando un visitatore fornisce le informazioni sulla richiesta e invia il modulo, il controllo CreateUserWizard genera inizialmente il relativo [evento`CreatingUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="0d40e-467">Se si verifica un problema durante il processo di creazione, viene generato l' [evento`CreateUserError`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) ; Tuttavia, se l'utente viene creato correttamente, viene generato l' [evento`CreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) .</span><span class="sxs-lookup"><span data-stu-id="0d40e-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="0d40e-468"><a id="_msoanchor_6"> </a>Nell'esercitazione [*creazione di account utente*](creating-user-accounts-cs.md) è stato creato un gestore eventi per l'evento `CreatingUser` per garantire che il nome utente fornito non contenesse spazi iniziali o finali e che il nome utente non fosse presente in nessun punto della password.</span><span class="sxs-lookup"><span data-stu-id="0d40e-468">In the <a id="_msoanchor_6"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="0d40e-469">Per aggiungere una riga nella tabella `UserProfiles` per l'utente appena creato, è necessario creare un gestore eventi per l'evento `CreatedUser`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="0d40e-470">Nel momento in cui è stato generato l'evento `CreatedUser`, l'account utente è già stato creato nel Framework di appartenenza, consentendo di recuperare il valore UserId dell'account.</span><span class="sxs-lookup"><span data-stu-id="0d40e-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="0d40e-471">Creare un gestore eventi per l'evento `CreatedUser` del `NewUserWizard`e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample11.cs)]

<span data-ttu-id="0d40e-472">Gli esseri di codice precedenti recuperano l'ID utente dell'account utente appena aggiunto.</span><span class="sxs-lookup"><span data-stu-id="0d40e-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="0d40e-473">Questa operazione viene eseguita utilizzando il metodo `Membership.GetUser(username)` per restituire informazioni su un utente specifico e quindi utilizzando la proprietà `ProviderUserKey` per recuperare l'ID utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="0d40e-474">Il nome utente immesso dall'utente nel controllo CreateUserWizard è disponibile tramite la relativa [proprietà`UserName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="0d40e-475">Successivamente, la stringa di connessione viene recuperata da `Web.config` e viene specificata l'istruzione `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="0d40e-476">Viene creata un'istanza degli oggetti ADO.NET necessari e viene eseguito il comando.</span><span class="sxs-lookup"><span data-stu-id="0d40e-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="0d40e-477">Il codice assegna un'istanza di [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) ai parametri `@HomeTown`, `@HomepageUrl`e `@Signature`, che ha l'effetto di inserire i valori di `NULL` database per i campi `HomeTown`, `HomepageUrl`e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="0d40e-478">Visitare la pagina `EnhancedCreateUserWizard.aspx` tramite un browser e creare un nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="0d40e-479">Al termine di questa operazione, tornare a Visual Studio ed esaminare il contenuto delle tabelle `aspnet_Users` e `UserProfiles`, come è stato riportato nella figura 12.</span><span class="sxs-lookup"><span data-stu-id="0d40e-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="0d40e-480">Verrà visualizzato il nuovo account utente in `aspnet_Users` e una riga `UserProfiles` corrispondente (con `NULL` valori per `HomeTown`, `HomepageUrl`e `Signature`).</span><span class="sxs-lookup"><span data-stu-id="0d40e-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>

<span data-ttu-id="0d40e-481">[![è stato aggiunto un nuovo account utente e un record UserProfile](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span></span>

<span data-ttu-id="0d40e-482">**Figura 20**: è stato aggiunto un nuovo account utente e `UserProfiles` record ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-cs/_static/image60.png))</span></span>

<span data-ttu-id="0d40e-483">Dopo che il visitatore ha fornito le informazioni sul nuovo account e ha fatto clic sul pulsante "Crea utente", l'account utente viene creato e viene aggiunta una riga alla tabella `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="0d40e-484">L'oggetto CreateUserWizard Visualizza quindi la `CompleteWizardStep`, che visualizza un messaggio di operazione riuscita e un pulsante continua.</span><span class="sxs-lookup"><span data-stu-id="0d40e-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="0d40e-485">Se si fa clic sul pulsante continua, viene generato un postback, ma non viene eseguita alcuna azione, lasciando l'utente bloccato nella pagina `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="0d40e-486">È possibile specificare un URL a cui inviare l'utente quando si fa clic sul pulsante continua tramite la [proprietà`ContinueDestinationPageUrl`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx)del controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="0d40e-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="0d40e-487">Impostare la proprietà `ContinueDestinationPageUrl` su "~/Membership/AdditionalUserInfo.aspx".</span><span class="sxs-lookup"><span data-stu-id="0d40e-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="0d40e-488">In questo modo il nuovo utente sarà `AdditionalUserInfo.aspx`, dove potranno visualizzare e aggiornare le impostazioni.</span><span class="sxs-lookup"><span data-stu-id="0d40e-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="0d40e-489">Personalizzazione dell'interfaccia di CreateUserWizard per la richiesta della città, della Home page e della firma del nuovo utente</span><span class="sxs-lookup"><span data-stu-id="0d40e-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="0d40e-490">L'interfaccia predefinita del controllo CreateUserWizard è sufficiente per gli scenari di creazione di account semplici in cui è necessario raccogliere solo le informazioni relative all'account utente di base, ad esempio nome utente, password e posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0d40e-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="0d40e-491">Ma cosa accade se si vuole chiedere al visitatore di immettere la propria città, la Home page e la firma durante la creazione dell'account?</span><span class="sxs-lookup"><span data-stu-id="0d40e-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="0d40e-492">È possibile personalizzare l'interfaccia del controllo CreateUserWizard per raccogliere informazioni aggiuntive all'iscrizione e tali informazioni possono essere utilizzate nel gestore eventi `CreatedUser` per inserire record aggiuntivi nel database sottostante.</span><span class="sxs-lookup"><span data-stu-id="0d40e-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="0d40e-493">Il controllo CreateUserWizard estende il controllo della procedura guidata ASP.NET, un controllo che consente a uno sviluppatore di pagine di definire una serie di `WizardSteps`ordinati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="0d40e-494">Il controllo procedura guidata esegue il rendering del passaggio attivo e fornisce un'interfaccia di navigazione che consente al visitatore di spostarsi attraverso questi passaggi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="0d40e-495">Il controllo della procedura guidata è ideale per suddividere una grande attività in diversi brevi passaggi.</span><span class="sxs-lookup"><span data-stu-id="0d40e-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="0d40e-496">Per ulteriori informazioni sul controllo della procedura guidata, vedere la pagina relativa alla [creazione di un'interfaccia utente dettagliata con il controllo ASP.NET 2,0 Wizard](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d40e-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="0d40e-497">Il markup predefinito del controllo CreateUserWizard definisce due `WizardSteps`: `CreateUserWizardStep` e `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample12.aspx)]

<span data-ttu-id="0d40e-498">Il primo `WizardStep`, `CreateUserWizardStep`, esegue il rendering dell'interfaccia che richiede il nome utente, la password, l'indirizzo di posta elettronica e così via.</span><span class="sxs-lookup"><span data-stu-id="0d40e-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="0d40e-499">Quando il visitatore fornisce queste informazioni e fa clic su "Crea utente", viene visualizzata la `CompleteWizardStep`, che mostra il messaggio di operazione riuscita e un pulsante continua.</span><span class="sxs-lookup"><span data-stu-id="0d40e-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="0d40e-500">Per personalizzare l'interfaccia del controllo CreateUserWizard per includere altri campi del modulo, è possibile:</span><span class="sxs-lookup"><span data-stu-id="0d40e-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="0d40e-501"><strong>Creare uno o più nuovi</strong> <strong>`WizardStep`</strong> <strong>per contenere gli elementi aggiuntivi dell'interfaccia utente</strong>.</span><span class="sxs-lookup"><span data-stu-id="0d40e-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="0d40e-502">Per aggiungere un nuovo `WizardStep` a CreateUserWizard, fare clic sul collegamento "Aggiungi/Rimuovi `WizardSteps`" dal relativo smart tag per avviare l'editor della raccolta `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardSteps`" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="0d40e-503">Da qui è possibile aggiungere, rimuovere o riordinare i passaggi nella procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0d40e-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="0d40e-504">Questo è l'approccio che verrà usato per questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="0d40e-505"><strong>Converte il</strong> <strong>`CreateUserWizardStep`</strong> <strong>in un`WizardStep`modificabile</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="0d40e-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="0d40e-506">Questa operazione sostituisce la `CreateUserWizardStep` con un `WizardStep` equivalente il cui markup definisce un'interfaccia utente che corrisponde al `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="0d40e-507">Convertendo il `CreateUserWizardStep` in una `WizardStep` è possibile riposizionare i controlli o aggiungere altri elementi dell'interfaccia utente a questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="0d40e-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="0d40e-508">Per convertire il `CreateUserWizardStep` o `CompleteWizardStep` in un `WizardStep`modificabile, fare clic sul collegamento "Personalizza passaggio Crea utente" o "Personalizza passaggio completo" dallo smart tag del controllo.</span><span class="sxs-lookup"><span data-stu-id="0d40e-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="0d40e-509">**Usare una combinazione delle due opzioni precedenti.**</span><span class="sxs-lookup"><span data-stu-id="0d40e-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="0d40e-510">Un aspetto importante da tenere presente è che il controllo CreateUserWizard esegue il processo di creazione dell'account utente quando si fa clic sul pulsante "Crea utente" dall'interno del `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="0d40e-511">Non è importante se sono presenti ulteriori `WizardStep` dopo il `CreateUserWizardStep` o meno.</span><span class="sxs-lookup"><span data-stu-id="0d40e-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="0d40e-512">Quando si aggiunge un `WizardStep` personalizzato al controllo CreateUserWizard per raccogliere un input utente aggiuntivo, il `WizardStep` personalizzato può essere inserito prima o dopo il `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="0d40e-513">Se precede il `CreateUserWizardStep`, l'input utente aggiuntivo raccolto dal `WizardStep` personalizzato sarà disponibile per il gestore dell'evento `CreatedUser`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="0d40e-514">Tuttavia, se il `WizardStep` personalizzato viene eseguito dopo `CreateUserWizardStep` quindi al momento della visualizzazione del `WizardStep` personalizzato, il nuovo account utente è già stato creato e l'evento `CreatedUser` è già stato attivato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="0d40e-515">Nella figura 21 viene illustrato il flusso di lavoro quando il `WizardStep` aggiunto precede l'`CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="0d40e-516">Poiché le informazioni aggiuntive sull'utente sono state raccolte nel momento in cui viene generato l'evento `CreatedUser`, è sufficiente aggiornare il gestore dell'evento `CreatedUser` per recuperare questi input e utilizzarli per i valori dei parametri dell'istruzione `INSERT` (anziché `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="0d40e-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>

<span data-ttu-id="0d40e-517">[![il flusso di lavoro CreateUserWizard quando un WizardStep aggiuntivo precede CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span></span>

<span data-ttu-id="0d40e-518">**Figura 21**: flusso di lavoro di CreateUserWizard quando un `WizardStep` aggiuntivo precede il `CreateUserWizardStep` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image63.png))</span></span>

<span data-ttu-id="0d40e-519">Se la `WizardStep` personalizzata viene posizionata *dopo* il `CreateUserWizardStep`, tuttavia, il processo di creazione dell'account utente si verifica prima che l'utente abbia la possibilità di immettere la propria città, la Home page o la firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="0d40e-520">In tal caso, è necessario inserire queste informazioni aggiuntive nel database dopo che è stato creato l'account utente, come illustrato nella figura 22.</span><span class="sxs-lookup"><span data-stu-id="0d40e-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>

<span data-ttu-id="0d40e-521">[![il flusso di lavoro CreateUserWizard quando un WizardStep aggiuntivo viene eseguito dopo CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span></span>

<span data-ttu-id="0d40e-522">**Figura 22**: flusso di lavoro di CreateUserWizard quando un `WizardStep` aggiuntivo viene eseguito dopo il `CreateUserWizardStep` ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image66.png))</span></span>

<span data-ttu-id="0d40e-523">Il flusso di lavoro illustrato nella figura 22 attende di inserire un record nella tabella `UserProfiles` finché non viene completato il passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0d40e-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="0d40e-524">Se il visitatore chiude il browser dopo il passaggio 1, tuttavia, verrà raggiunto uno stato in cui è stato creato un account utente, ma non è stato aggiunto alcun record a `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="0d40e-525">Una soluzione alternativa consiste nel disporre di un record con `NULL` o valori predefiniti inseriti in `UserProfiles` nel gestore dell'evento `CreatedUser` (che viene attivato dopo il passaggio 1) e quindi aggiornare il record dopo il completamento del passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0d40e-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="0d40e-526">In questo modo si garantisce che venga aggiunto un record `UserProfiles` per l'account utente, anche se l'utente chiude il processo di registrazione a metà.</span><span class="sxs-lookup"><span data-stu-id="0d40e-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="0d40e-527">Per questa esercitazione verrà creato un nuovo `WizardStep` che si verifica dopo il `CreateUserWizardStep` ma prima del `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="0d40e-528">Per prima cosa è necessario ottenere il WizardStep e configurarlo e quindi esaminare il codice.</span><span class="sxs-lookup"><span data-stu-id="0d40e-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="0d40e-529">Dallo smart tag del controllo CreateUserWizard selezionare "Aggiungi/Rimuovi `WizardStep` s", che visualizza la finestra di dialogo Editor dell'insieme di `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="0d40e-530">Aggiungere una nuova `WizardStep`, impostando la relativa `ID` su `UserSettings`, la `Title` su "Impostazioni" e il `StepType` `Step`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="0d40e-531">Quindi posizionarlo in modo che venga eseguito dopo il `CreateUserWizardStep` ("iscriversi al nuovo account") e prima della `CompleteWizardStep` ("completa"), come illustrato nella figura 23.</span><span class="sxs-lookup"><span data-stu-id="0d40e-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>

<span data-ttu-id="0d40e-532">[![aggiungere un nuovo WizardStep al controllo CreateUserWizard](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="0d40e-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span></span>

<span data-ttu-id="0d40e-533">**Figura 23**: aggiungere un nuovo `WizardStep` al controllo CreateUserWizard ([fare clic per visualizzare l'immagine con dimensioni complete](storing-additional-user-information-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="0d40e-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-cs/_static/image69.png))</span></span>

<span data-ttu-id="0d40e-534">Fare clic su OK per chiudere la finestra di dialogo Editor della raccolta `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="0d40e-535">Il nuovo `WizardStep` viene evidenziato dal markup dichiarativo aggiornato del controllo CreateUserWizard:</span><span class="sxs-lookup"><span data-stu-id="0d40e-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample13.aspx)]

<span data-ttu-id="0d40e-536">Si noti il nuovo elemento `<asp:WizardStep>`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="0d40e-537">È necessario aggiungere l'interfaccia utente per raccogliere qui la città, la Home page e la firma del nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="0d40e-538">È possibile immettere questo contenuto nella sintassi dichiarativa o nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="0d40e-539">Per usare la finestra di progettazione, selezionare il passaggio "Impostazioni" dall'elenco a discesa nello smart tag per visualizzare il passaggio nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="0d40e-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-540">Se si seleziona un passaggio nell'elenco a discesa smart tag, viene aggiornata la [proprietà`ActiveStepIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx)del controllo CreateUserWizard, che specifica l'indice del passaggio iniziale.</span><span class="sxs-lookup"><span data-stu-id="0d40e-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="0d40e-541">Se pertanto si utilizza questo elenco a discesa per modificare il passaggio "Impostazioni" nella finestra di progettazione, assicurarsi di impostarlo di nuovo su "iscrizione al nuovo account" in modo che questo passaggio venga visualizzato quando gli utenti visitano prima la pagina `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="0d40e-542">Creare un'interfaccia utente nel passaggio "Your Settings" (impostazioni) contenente tre controlli TextBox denominati `HomeTown`, `HomepageUrl`e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="0d40e-543">Dopo la costruzione di questa interfaccia, il markup dichiarativo di CreateUserWizard dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample14.aspx)]

<span data-ttu-id="0d40e-544">Andare avanti e visitare questa pagina tramite un browser e creare un nuovo account utente, specificando i valori per la città Home, la Home page e la firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="0d40e-545">Al termine dell'`CreateUserWizardStep` viene creato l'account utente nel Framework di appartenenza e viene eseguito il gestore eventi `CreatedUser`, che aggiunge una nuova riga a `UserProfiles`, ma con un valore `NULL` database per `HomeTown`, `HomepageUrl`e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="0d40e-546">I valori immessi per la città principale, la Home page e la firma non vengono mai usati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="0d40e-547">Il risultato finale è un nuovo account utente con un record `UserProfiles` i cui campi `HomeTown`, `HomepageUrl`e `Signature` devono ancora essere specificati.</span><span class="sxs-lookup"><span data-stu-id="0d40e-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="0d40e-548">È necessario eseguire il codice dopo il passaggio "Your Settings" (impostazioni) che accetta i valori della città iniziale, della honepage e della firma immessi dall'utente e aggiorna il record `UserProfiles` appropriato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="0d40e-549">Ogni volta che l'utente passa da una procedura all'altra in un controllo della procedura guidata, viene generato l' [evento`ActiveStepChanged`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) della procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0d40e-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="0d40e-550">È possibile creare un gestore eventi per questo evento e aggiornare la tabella `UserProfiles` quando il passaggio "Impostazioni" è stato completato.</span><span class="sxs-lookup"><span data-stu-id="0d40e-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="0d40e-551">Aggiungere un gestore eventi per l'evento `ActiveStepChanged` di CreateUserWizard e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d40e-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample15.cs)]

<span data-ttu-id="0d40e-552">Il codice precedente inizia determinando se è stato appena raggiunto il passaggio "completo".</span><span class="sxs-lookup"><span data-stu-id="0d40e-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="0d40e-553">Poiché il passaggio "complete" si verifica immediatamente dopo il passaggio "Your Settings" (impostazioni), quando il visitatore raggiunge il passaggio "complete" significa che ha appena terminato il passaggio "Your Settings" (impostazioni).</span><span class="sxs-lookup"><span data-stu-id="0d40e-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="0d40e-554">In tal caso, è necessario fare riferimento a livello di codice ai controlli TextBox all'interno del `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="0d40e-555">Questa operazione viene eseguita usando prima il metodo `FindControl` per fare riferimento a a livello di codice al `UserSettings WizardStep`e quindi di nuovo per fare riferimento alle caselle di testo all'interno della `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="0d40e-556">Una volta fatto riferimento alle caselle di testo, è possibile eseguire l'istruzione `UPDATE`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="0d40e-557">L'istruzione `UPDATE` ha lo stesso numero di parametri dell'istruzione `INSERT` nel gestore dell'evento `CreatedUser`, ma in questo caso vengono usati i valori della città, della Home page e della firma forniti dall'utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="0d40e-558">Con questo gestore eventi, visitare la pagina `EnhancedCreateUserWizard.aspx` tramite un browser e creare un nuovo account utente specificando i valori per la città, la Home page e la firma.</span><span class="sxs-lookup"><span data-stu-id="0d40e-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="0d40e-559">Dopo aver creato il nuovo account, è necessario reindirizzare alla pagina `AdditionalUserInfo.aspx`, in cui vengono visualizzate le informazioni relative alla Home page, alla Home page e alla firma appena immesse.</span><span class="sxs-lookup"><span data-stu-id="0d40e-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="0d40e-560">Il sito Web include attualmente due pagine da cui un visitatore può creare un nuovo account: `CreatingUserAccounts.aspx` e `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="0d40e-561">La pagina Sitemap e l'account di accesso del sito Web puntano alla pagina `CreatingUserAccounts.aspx`, ma la pagina `CreatingUserAccounts.aspx` non richiede all'utente le informazioni relative alla città iniziale, alla Home page e alla firma e non aggiunge una riga corrispondente a `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="0d40e-562">Aggiornare quindi la pagina `CreatingUserAccounts.aspx` in modo che offra questa funzionalità oppure aggiornare la pagina Sitemap e l'account di accesso per fare riferimento `EnhancedCreateUserWizard.aspx` invece di `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="0d40e-563">Se si sceglie la seconda opzione, assicurarsi di aggiornare il file di `Web.config` della cartella `Membership` in modo da consentire agli utenti anonimi di accedere alla pagina `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d40e-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>

## <a name="summary"></a><span data-ttu-id="0d40e-564">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="0d40e-564">Summary</span></span>

<span data-ttu-id="0d40e-565">In questa esercitazione sono state esaminate le tecniche per la modellazione dei dati correlati agli account utente all'interno del framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d40e-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="0d40e-566">In particolare, è stata esaminata la modellazione delle entità che condividono una relazione uno-a-molti con gli account utente e i dati che condividono una relazione uno-a-uno.</span><span class="sxs-lookup"><span data-stu-id="0d40e-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="0d40e-567">È stato inoltre illustrato come visualizzare, inserire e aggiornare le informazioni correlate, con alcuni esempi che usano il controllo SqlDataSource e altre che usano il codice ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="0d40e-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="0d40e-568">Questa esercitazione completa l'aspetto degli account utente.</span><span class="sxs-lookup"><span data-stu-id="0d40e-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="0d40e-569">A partire dall'esercitazione successiva, verrà rivolto l'attenzione ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="0d40e-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="0d40e-570">Nelle varie esercitazioni successive verrà esaminato il Framework dei ruoli, viene illustrato come creare nuovi ruoli, come assegnare i ruoli agli utenti, come determinare i ruoli a cui un utente appartiene e come applicare l'autorizzazione basata sui ruoli.</span><span class="sxs-lookup"><span data-stu-id="0d40e-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="0d40e-571">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="0d40e-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="0d40e-572">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="0d40e-572">Further Reading</span></span>

<span data-ttu-id="0d40e-573">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="0d40e-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="0d40e-574">Accesso e aggiornamento dei dati in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="0d40e-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="0d40e-575">Controllo procedura guidata ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="0d40e-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="0d40e-576">Creazione di un'interfaccia utente dettagliata con il controllo procedura guidata ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="0d40e-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="0d40e-577">Creazione di parametri di controllo DataSource personalizzati</span><span class="sxs-lookup"><span data-stu-id="0d40e-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="0d40e-578">Personalizzazione del controllo CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="0d40e-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="0d40e-579">Guide introduttive del controllo DetailsView</span><span class="sxs-lookup"><span data-stu-id="0d40e-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="0d40e-580">Visualizzazione di dati con il controllo ListView</span><span class="sxs-lookup"><span data-stu-id="0d40e-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="0d40e-581">Dissezione dei controlli di convalida in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="0d40e-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="0d40e-582">Modifica di inserimento ed eliminazione di dati</span><span class="sxs-lookup"><span data-stu-id="0d40e-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="0d40e-583">Convalida del modulo in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="0d40e-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="0d40e-584">Raccolta di informazioni di registrazione utente personalizzate</span><span class="sxs-lookup"><span data-stu-id="0d40e-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="0d40e-585">Profili in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="0d40e-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="0d40e-586">Il controllo ASP: ListView</span><span class="sxs-lookup"><span data-stu-id="0d40e-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="0d40e-587">Guida introduttiva ai profili utente</span><span class="sxs-lookup"><span data-stu-id="0d40e-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="0d40e-588">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="0d40e-588">About the Author</span></span>

<span data-ttu-id="0d40e-589">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="0d40e-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0d40e-590">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="0d40e-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0d40e-591">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="0d40e-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="0d40e-592">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="0d40e-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="0d40e-593">Ringraziamento speciale a...</span><span class="sxs-lookup"><span data-stu-id="0d40e-593">Special Thanks To…</span></span>

<span data-ttu-id="0d40e-594">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="0d40e-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0d40e-595">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="0d40e-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0d40e-596">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="0d40e-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0d40e-597">[Precedente](user-based-authorization-cs.md)
> [Successivo](creating-the-membership-schema-in-sql-server-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0d40e-597">[Previous](user-based-authorization-cs.md)
[Next](creating-the-membership-schema-in-sql-server-vb.md)</span></span>
