---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Configurazione dell'autenticazione basata su form eC#argomenti avanzati () | Microsoft Docs
author: rick-anderson
description: In questa esercitazione si esamineranno le varie impostazioni di autenticazione basata su form e si vedrà come modificarle tramite l'elemento Forms. Questa operazione comporterà una descrizione dettagliata...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: b296f31da1c73df97175d94402b4d618df425d8d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74579434"
---
# <a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="f4f8c-104">Configurazione dell'autenticazione basata su form e argomenti avanzati (C#)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>

<span data-ttu-id="f4f8c-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f4f8c-106">[Scarica codice](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) o [Scarica PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="f4f8c-107">In questa esercitazione si esamineranno le varie impostazioni di autenticazione basata su form e si vedrà come modificarle tramite l'elemento Forms.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="f4f8c-108">Questo comporterà una descrizione dettagliata della personalizzazione del valore di timeout del ticket di autenticazione basata su form, usando una pagina di accesso con un URL personalizzato, ad esempio signin. aspx anziché login. aspx, e ticket di autenticazione basata su form senza cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="f4f8c-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-109">Introduction</span></span>

<span data-ttu-id="f4f8c-110">Nell' [esercitazione precedente](an-overview-of-forms-authentication-cs.md) sono stati esaminati i passaggi necessari per implementare l'autenticazione basata su form in un'applicazione ASP.NET, da specificare le impostazioni di configurazione in Web. config per creare una pagina di accesso per visualizzare contenuti diversi per utenti autenticati e anonimi.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="f4f8c-111">Si ricordi che il sito Web è stato configurato per l'uso dell'autenticazione basata su form impostando l'attributo mode dell'elemento &lt;Authentication&gt; su Forms.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="f4f8c-112">L'elemento &lt;Authentication&gt; può includere facoltativamente un elemento &lt;Forms&gt; elemento figlio, tramite il quale è possibile specificare un'ampia gamma di impostazioni di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="f4f8c-113">In questa esercitazione vengono esaminate le diverse impostazioni di autenticazione basata su form e viene illustrato come modificarle tramite l'elemento &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="f4f8c-114">Questo comporterà una descrizione dettagliata della personalizzazione del valore di timeout del ticket di autenticazione basata su form, usando una pagina di accesso con un URL personalizzato, ad esempio signin. aspx anziché login. aspx, e ticket di autenticazione basata su form senza cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="f4f8c-115">Si esaminerà anche il trucco del ticket di autenticazione basata su form e si vedranno le precauzioni necessarie per assicurarsi che i dati del ticket siano protetti da ispezione e manomissioni.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="f4f8c-116">Infine, si esaminerà come archiviare dati utente aggiuntivi nel ticket di autenticazione basata su form e come modellare i dati tramite un oggetto Principal personalizzato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="f4f8c-117">Passaggio 1: esame dei moduli &lt;&gt; impostazioni di configurazione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="f4f8c-118">Il sistema di autenticazione basata su form in ASP.NET offre una serie di impostazioni di configurazione che possono essere personalizzate in base alle singole applicazioni.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="f4f8c-119">Sono incluse impostazioni come: la durata del ticket di autenticazione basata su form; quale tipo di protezione viene applicato al ticket; in quali condizioni vengono usati i ticket di autenticazione senza cookie; percorso della pagina di accesso. e altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="f4f8c-120">Per modificare i valori predefiniti, aggiungere un [&lt;forms&gt; elemento](https://msdn.microsoft.com/library/1d3t3c61.aspx) come figlio dell' [elemento&lt;Authentication&gt;](https://msdn.microsoft.com/library/532aee0e.aspx), specificando i valori di proprietà che si desidera personalizzare come attributi XML come segue:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="f4f8c-121">Nella tabella 1 sono riepilogate le proprietà che è possibile personalizzare tramite l'elemento &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="f4f8c-122">Poiché Web. config è un file XML, i nomi degli attributi nella colonna sinistra fanno distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="f4f8c-123"><strong>Attributo</strong></span><span class="sxs-lookup"><span data-stu-id="f4f8c-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="f4f8c-124"><strong>Descrizione</strong></span><span class="sxs-lookup"><span data-stu-id="f4f8c-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="f4f8c-125">Cookieless</span><span class="sxs-lookup"><span data-stu-id="f4f8c-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="f4f8c-126">Questo attributo specifica le condizioni in base alle quali il ticket di autenticazione viene archiviato in un cookie anziché incorporato nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="f4f8c-127">I valori consentiti sono: UseCookies; UseUri Rilevamento automatico e UseDeviceProfile (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="f4f8c-128">Il passaggio 2 esamina questa impostazione in modo più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="f4f8c-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="f4f8c-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="f4f8c-130">Indica l'URL a cui gli utenti vengono reindirizzati dopo l'accesso dalla pagina di accesso se non è stato specificato alcun valore RedirectUrl in QueryString.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="f4f8c-131">Il valore predefinito è default. aspx.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="f4f8c-132">dominio</span><span class="sxs-lookup"><span data-stu-id="f4f8c-132">domain</span></span>           | <span data-ttu-id="f4f8c-133">Quando si usano i ticket di autenticazione basati su cookie, questa impostazione specifica il valore del dominio del cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="f4f8c-134">Il valore predefinito è una stringa vuota, che fa sì che il browser usi il dominio da cui è stato emesso, ad esempio www.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="f4f8c-135">In questo caso, il cookie <strong>non</strong> verrà inviato quando si effettuano richieste a sottodomini, ad esempio admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="f4f8c-136">Se si desidera che il cookie venga passato a tutti i sottodomini, è necessario personalizzare l'attributo di dominio impostandolo su yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="f4f8c-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="f4f8c-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="f4f8c-138">Valore booleano che indica se gli utenti autenticati vengono ricordati quando vengono reindirizzati agli URL in altre applicazioni Web nello stesso server.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="f4f8c-139">Il valore predefinito è false.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="f4f8c-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="f4f8c-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="f4f8c-141">URL della pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-141">The URL of the login page.</span></span> <span data-ttu-id="f4f8c-142">Il valore predefinito è login. aspx.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="f4f8c-143">nome</span><span class="sxs-lookup"><span data-stu-id="f4f8c-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="f4f8c-144">Quando si usano i ticket di autenticazione basati su cookie, il nome del cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="f4f8c-145">Il valore predefinito è. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="f4f8c-146">path</span><span class="sxs-lookup"><span data-stu-id="f4f8c-146">path</span></span>            |                                                                             <span data-ttu-id="f4f8c-147">Quando si usano i ticket di autenticazione basati su cookie, questa impostazione specifica l'attributo path del cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="f4f8c-148">L'attributo Path consente a uno sviluppatore di limitare l'ambito di un cookie a una particolare gerarchia di directory.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="f4f8c-149">Il valore predefinito è/, che informa il browser di inviare il cookie del ticket di autenticazione a qualsiasi richiesta effettuata al dominio.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="f4f8c-150">protezione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="f4f8c-151">Indica le tecniche utilizzate per proteggere il ticket di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="f4f8c-152">I valori consentiti sono: All (impostazione predefinita); Crittografia Nessuno e la convalida.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="f4f8c-153">Queste impostazioni sono descritte in dettaglio nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="f4f8c-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="f4f8c-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="f4f8c-155">Valore booleano che indica se è necessaria una connessione SSL per trasmettere il cookie di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="f4f8c-156">Il valore predefinito è false.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="f4f8c-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="f4f8c-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="f4f8c-158">Valore booleano che indica se il timeout del cookie di autenticazione viene reimpostato ogni volta che l'utente visita il sito durante una singola sessione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="f4f8c-159">Il valore predefinito è true.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-159">The default value is true.</span></span> <span data-ttu-id="f4f8c-160">I criteri di timeout dei ticket di autenticazione vengono descritti in modo più dettagliato nella sezione specifica del valore di timeout del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="f4f8c-161">timeout</span><span class="sxs-lookup"><span data-stu-id="f4f8c-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="f4f8c-162">Specifica il tempo, in minuti, trascorso il quale il cookie del ticket di autenticazione scade.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="f4f8c-163">Il valore predefinito è 30.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-163">The default value is 30.</span></span> <span data-ttu-id="f4f8c-164">I criteri di timeout dei ticket di autenticazione vengono descritti in modo più dettagliato nella sezione specifica del valore di timeout del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="f4f8c-165">**Tabella 1**: riepilogo degli attributi dell'elemento &lt;forms&gt;</span><span class="sxs-lookup"><span data-stu-id="f4f8c-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="f4f8c-166">In ASP.NET 2,0 e versioni successive i valori predefiniti di autenticazione basata su form sono hardcoded nella classe FormsAuthenticationConfiguration della .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="f4f8c-167">Tutte le modifiche devono essere applicate a un'applicazione in base all'applicazione nel file Web. config.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="f4f8c-168">Questo comportamento è diverso da ASP.NET 1. x, in cui i valori predefiniti di autenticazione basata su form sono stati archiviati nel file Machine. config (e possono quindi essere modificati tramite la modifica di Machine. config).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="f4f8c-169">Nell'argomento di ASP.NET 1. x, vale la pena ricordare che alcune impostazioni del sistema di autenticazione basata su form hanno valori predefiniti diversi in ASP.NET 2,0 e oltre a ASP.NET 1. x.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="f4f8c-170">Se si esegue la migrazione dell'applicazione da un ambiente ASP.NET 1. x, è importante tenere presente queste differenze.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="f4f8c-171">Per un elenco delle differenze, consultare [la documentazione tecnica sull'elemento &lt;forms&gt;](https://msdn.microsoft.com/library/1d3t3c61.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-172">Diverse impostazioni di autenticazione basata su form, ad esempio il timeout, il dominio e il percorso, specificano i dettagli per il cookie del ticket di autenticazione basata su form risultante.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="f4f8c-173">Per altre informazioni sui cookie, sul loro funzionamento e sulle relative proprietà, vedere [l'esercitazione](http://www.quirksmode.org/js/cookies.html)relativa ai cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="f4f8c-174">Specifica del valore di timeout del ticket</span><span class="sxs-lookup"><span data-stu-id="f4f8c-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="f4f8c-175">Il ticket di autenticazione basata su form è un token che rappresenta un'identità.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="f4f8c-176">Con i ticket di autenticazione basati su cookie, questo token viene mantenuto sotto forma di cookie e inviato al server Web a ogni richiesta.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="f4f8c-177">Il possesso del token, in sostanza, dichiara, il *nome utente*, è già stato effettuato l'accesso e viene usato in modo che l'identità di un utente possa essere memorizzata nelle visite di pagina.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="f4f8c-178">Il ticket di autenticazione basata su form non solo include l'identità dell'utente, ma contiene anche informazioni che consentono di garantire l'integrità e la sicurezza del token.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="f4f8c-179">Dopotutto, non si vuole che un utente maldato sia in grado di creare un token contraffatto o di modificare un token legit in un certo modo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="f4f8c-180">Una di queste informazioni incluse nel ticket è una *scadenza*, ovvero la data e l'ora in cui il ticket non è più valido.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="f4f8c-181">Ogni volta che il FormsAuthenticationModule controlla un ticket di autenticazione, garantisce che la scadenza del ticket non sia stata ancora superata.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="f4f8c-182">In caso contrario, ignora il ticket e identifica l'utente come anonimo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="f4f8c-183">Questa protezione consente di proteggersi da attacchi di riproduzione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="f4f8c-184">Senza una scadenza, se un pirata informatico è stato in grado di ottenere il ticket di autenticazione valido di un utente, probabilmente ottenendo l'accesso fisico al computer e la radice dei cookie, può inviare una richiesta al server con il ticket di autenticazione rubato e ottenere una voce.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="f4f8c-185">Mentre la scadenza non impedisce questo scenario, limita la finestra durante la quale un attacco può avere esito positivo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-186">Il passaggio 3 illustra le tecniche aggiuntive usate dal sistema di autenticazione basata su form per proteggere il ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="f4f8c-187">Quando si crea il ticket di autenticazione, il sistema di autenticazione basata su form ne determina la scadenza consultando l'impostazione del timeout.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="f4f8c-188">Come indicato nella tabella 1, per impostazione predefinita il timeout è di 30 minuti, quindi, quando viene creato il ticket di autenticazione basata su form, la scadenza viene impostata su una data e un'ora di 30 minuti in futuro.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="f4f8c-189">La scadenza definisce un tempo assoluto in futuro al termine del ticket di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="f4f8c-190">Tuttavia, in genere gli sviluppatori vogliono implementare una scadenza variabile, una che viene reimpostata ogni volta che l'utente visita il sito.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="f4f8c-191">Questo comportamento è determinato dalle impostazioni slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="f4f8c-192">Se è impostato su true (impostazione predefinita), ogni volta che il FormsAuthenticationModule autentica un utente, viene aggiornata la scadenza del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="f4f8c-193">Se è impostato su false, la scadenza non viene aggiornata per ogni richiesta, causando in tal modo la scadenza esatta del ticket per il numero di minuti passati dalla prima creazione del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-194">La scadenza archiviata nel ticket di autenticazione è un valore di data e ora assoluto, ad esempio il 2 agosto 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="f4f8c-195">Inoltre, la data e l'ora sono relative all'ora locale del server Web.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="f4f8c-196">Questa decisione di progettazione può avere effetti collaterali interessanti sull'ora legale (DST), ovvero quando gli orologi nel Stati Uniti vengono spostati avanti di un'ora (presupponendo che il server Web sia ospitato in impostazioni locali in cui si osserva l'ora legale).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="f4f8c-197">Si consideri cosa accadrebbe per un sito Web ASP.NET con una scadenza di 30 minuti vicino all'ora di inizio dell'ora legale (2:00 AM).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="f4f8c-198">Si supponga che un visitatore acceda al sito l'11 marzo 2008 alle 1:55.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="f4f8c-199">Verrà generato un ticket di autenticazione basata su form che scade l'11 marzo 2008 alle 2:25 AM (30 minuti in futuro).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="f4f8c-200">Tuttavia, una volta 2:00, il clock passa a 3:00 AM a causa dell'ora legale.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="f4f8c-201">Quando l'utente carica una nuova pagina sei minuti dopo l'accesso (alle 3:01 AM), FormsAuthenticationModule rileva che il ticket è scaduto e reindirizza l'utente alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="f4f8c-202">Per una discussione più approfondita su questa e altre stranezze per il timeout dei ticket di autenticazione, nonché per le soluzioni alternative, è possibile scegliere una copia della *sicurezza, dell'appartenenza e della gestione dei ruoli di Stefan Schackow Professional ASP.NET 2,0* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="f4f8c-203">Nella figura 1 viene illustrato il flusso di lavoro quando slidingExpiration è impostato su false e timeout è impostato su 30.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="f4f8c-204">Si noti che il ticket di autenticazione generato al momento dell'accesso contiene la data di scadenza e questo valore non viene aggiornato nelle richieste successive.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="f4f8c-205">Se il FormsAuthenticationModule rileva che il ticket è scaduto, lo ignora e considera la richiesta come anonima.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="f4f8c-206">[![una rappresentazione grafica della scadenza del ticket di autenticazione basata su form quando slidingExpiration è false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="f4f8c-207">**Figura 01**: rappresentazione grafica della scadenza del ticket di autenticazione basata su form quando slidingExpiration è false ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>

<span data-ttu-id="f4f8c-208">Nella figura 2 viene illustrato il flusso di lavoro quando slidingExpiration è impostato su true e timeout è impostato su 30.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="f4f8c-209">Quando viene ricevuta una richiesta autenticata (con un ticket non scaduto), la relativa scadenza viene aggiornata in base al numero di minuti di timeout in futuro.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="f4f8c-210">[![una rappresentazione grafica del ticket di autenticazione basata su form quando slidingExpiration è true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="f4f8c-211">**Figura 02**: rappresentazione grafica del ticket di autenticazione basata su form quando slidingExpiration è true ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>

<span data-ttu-id="f4f8c-212">Quando si usano i ticket di autenticazione basati su cookie (impostazione predefinita), questa discussione diventa leggermente più confusa perché i cookie possono anche avere una scadenza specifica.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="f4f8c-213">La scadenza o la mancanza di un cookie indica al browser quando il cookie deve essere eliminato definitivamente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="f4f8c-214">Se il cookie non dispone di una scadenza, viene eliminato definitivamente quando il browser viene arrestato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="f4f8c-215">Se è presente una scadenza, tuttavia, il cookie rimane archiviato nel computer dell'utente finché non vengono superate la data e l'ora specificate nella scadenza.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="f4f8c-216">Quando un cookie viene eliminato dal browser, non viene più inviato al server Web.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="f4f8c-217">Di conseguenza, l'eliminazione di un cookie è analoga alla disconnessione dell'utente dal sito.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-218">Naturalmente, un utente può rimuovere in modo proattivo tutti i cookie archiviati nel computer.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="f4f8c-219">In Internet Explorer 7 passare a strumenti, opzioni e fare clic sul pulsante Elimina nella sezione cronologia esplorazioni.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="f4f8c-220">Da qui, fare clic sul pulsante Elimina cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="f4f8c-221">Il sistema di autenticazione basata su form crea cookie basati sulla sessione o sulla scadenza a seconda del valore passato al parametro *persistCookie* .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="f4f8c-222">Ricordare che i metodi GetAuthCookie, SetAuthCookie e RedirectFromLoginPage della classe FormsAuthentication accettano due parametri di input: *username* e *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="f4f8c-223">La pagina di accesso creata nell'esercitazione precedente include la casella di controllo memorizza me, che determina se è stato creato un cookie permanente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="f4f8c-224">I cookie permanenti sono basati sulla scadenza; i cookie non permanenti sono basati sulla sessione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="f4f8c-225">I concetti di timeout e di slidingExpiration già illustrati si applicano allo stesso modo ai cookie basati sulla sessione e sulla scadenza.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="f4f8c-226">Esiste una sola differenza secondaria nell'esecuzione: quando si usano i cookie basati sulla scadenza con slidingTimeout impostato su true, la scadenza del cookie viene aggiornata solo quando è trascorso più della metà del tempo specificato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="f4f8c-227">Aggiornare i criteri di timeout dei ticket di autenticazione del sito Web in modo che il timeout dei ticket venga effettuato dopo un'ora (60 minuti), usando una scadenza variabile.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="f4f8c-228">Per applicare questa modifica, aggiornare il file Web. config, aggiungendo un elemento &lt;Forms&gt; all'elemento &lt;Authentication&gt; con il markup seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="f4f8c-229">Utilizzo di un URL della pagina di accesso diverso da login. aspx</span><span class="sxs-lookup"><span data-stu-id="f4f8c-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="f4f8c-230">Poiché FormsAuthenticationModule reindirizza automaticamente gli utenti non autorizzati alla pagina di accesso, deve essere a conoscenza dell'URL della pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="f4f8c-231">Questo URL viene specificato dall'attributo loginUrl nell'elemento &lt;Forms&gt; e per impostazione predefinita è login. aspx.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="f4f8c-232">Se si esegue il porting su un sito Web esistente, è possibile che sia già presente una pagina di accesso con un URL diverso, che è già stato aggiunto a un segnalibro e indicizzato dai motori di ricerca.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="f4f8c-233">Anziché ridenominare la pagina di accesso esistente a login. aspx e ai segnalibri dei collegamenti e degli utenti, è possibile modificare l'attributo loginUrl in modo che punti alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="f4f8c-234">Ad esempio, se la pagina di accesso è denominata signin. aspx e si trova nella directory Users, è possibile puntare l'impostazione di configurazione loginUrl a ~/Users/SignIn.aspx come segue:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="f4f8c-235">Poiché l'applicazione corrente dispone già di una pagina di accesso denominata Login. aspx, non è necessario specificare un valore personalizzato nell'elemento &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="f4f8c-236">Passaggio 2: uso di ticket di autenticazione basata su form senza cookie</span><span class="sxs-lookup"><span data-stu-id="f4f8c-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="f4f8c-237">Per impostazione predefinita, il sistema di autenticazione basata su form determina se archiviare i ticket di autenticazione nella raccolta dei cookie o incorporarli nell'URL in base all'agente utente che visita il sito.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="f4f8c-238">Tutti i principali browser desktop come Internet Explorer, Firefox, opera e Safari supportano i cookie, ma non tutti i dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="f4f8c-239">I criteri dei cookie usati dal sistema di autenticazione basata su form dipendono dall'impostazione senza cookie nell'elemento &lt;Forms&gt;, a cui è possibile assegnare uno dei quattro valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="f4f8c-240">UseCookies: specifica che verranno sempre usati i ticket di autenticazione basati su cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="f4f8c-241">UseUri: indica che i ticket di autenticazione basati su cookie non verranno mai usati.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="f4f8c-242">Rilevamento automatico: se il profilo del dispositivo non supporta i cookie, i ticket di autenticazione basati su cookie non vengono usati. Se il profilo del dispositivo supporta i cookie, viene usato un meccanismo di probe per determinare se i cookie sono abilitati.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="f4f8c-243">UseDeviceProfile: valore predefinito. USA i ticket di autenticazione basati su cookie solo se il profilo del dispositivo supporta i cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="f4f8c-244">Non viene usato alcun meccanismo di probe.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-244">No probing mechanism is used.</span></span>

<span data-ttu-id="f4f8c-245">Le impostazioni di rilevamento automatico e UseDeviceProfile si basano su un *profilo di dispositivo* per verificare se usare i ticket di autenticazione cookie o basati su cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="f4f8c-246">ASP.NET gestisce un database di diversi dispositivi e delle relative funzionalità, ad esempio se supportano i cookie, la versione di JavaScript supportata e così via.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="f4f8c-247">Ogni volta che un dispositivo richiede una pagina Web da un server Web invia lungo un'intestazione HTTP *dell'agente utente* che identifica il tipo di dispositivo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="f4f8c-248">ASP.NET corrisponde automaticamente alla stringa dell'agente utente fornita con il profilo corrispondente specificato nel relativo database.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-249">Questo database di funzionalità del dispositivo viene archiviato in una serie di file XML che rispettano lo [schema del file di definizione del browser](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="f4f8c-250">I file del profilo di dispositivo predefiniti si trovano in%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="f4f8c-251">È anche possibile aggiungere file personalizzati alla cartella app\_browser dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="f4f8c-252">Per altre informazioni, vedere [procedura: rilevare i tipi di browser in pagine Web ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="f4f8c-253">Poiché l'impostazione predefinita è UseDeviceProfile, i ticket di autenticazione basata su form senza cookie verranno usati quando il sito viene visitato da un dispositivo il cui profilo segnala che non supporta i cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="f4f8c-254">Codifica del ticket di autenticazione nell'URL</span><span class="sxs-lookup"><span data-stu-id="f4f8c-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="f4f8c-255">I cookie sono un supporto naturale per includere le informazioni del browser in ogni richiesta a un particolare sito Web, motivo per cui le impostazioni di autenticazione basata su form predefinite utilizzano i cookie se il dispositivo di visita li supporta.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="f4f8c-256">Se i cookie non sono supportati, è necessario utilizzare un metodo alternativo per passare il ticket di autenticazione dal client al server.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="f4f8c-257">Una soluzione alternativa comune utilizzata negli ambienti senza cookie consiste nel codificare i dati dei cookie nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="f4f8c-258">Il modo migliore per vedere come tali informazioni possono essere incorporate all'interno dell'URL consiste nel forzare il sito a usare i ticket di autenticazione senza cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="f4f8c-259">Questa operazione può essere eseguita impostando l'impostazione di configurazione senza cookie su UseUri:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="f4f8c-260">Dopo aver apportato questa modifica, visitare il sito tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="f4f8c-261">Quando si visita come utente anonimo, gli URL avranno un aspetto analogo al precedente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="f4f8c-262">Ad esempio, quando si visita la pagina default. aspx la barra degli indirizzi del browser Mostra l'URL seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="f4f8c-263">Tuttavia, al momento dell'accesso, il ticket di autenticazione basata su form viene incorporato nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="f4f8c-264">Ad esempio, dopo aver visitato la pagina di accesso e aver eseguito l'accesso come Sam, viene restituita la pagina default. aspx, ma l'URL è il seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="f4f8c-265">Il ticket di autenticazione basata su form è stato incorporato nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="f4f8c-266">La stringa (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) rappresenta le informazioni del ticket di autenticazione con codifica esadecimale ed è costituita dagli stessi dati archiviati in genere all'interno di un cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="f4f8c-267">Per il corretto funzionamento dei ticket di autenticazione senza cookie, il sistema deve codificare tutti gli URL della pagina in modo da includere i dati del ticket di autenticazione. in caso contrario, il ticket di autenticazione andrà perso quando l'utente fa clic su un collegamento.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="f4f8c-268">Fortunatamente, questa logica di incorporamento viene eseguita automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="f4f8c-269">Per illustrare questa funzionalità, aprire la pagina default. aspx e aggiungere un controllo collegamento ipertestuale, impostando le proprietà Text e NavigateUrl su test link e SomePage. aspx, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="f4f8c-270">Non è importante che nel progetto sia presente una pagina denominata SomePage. aspx.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="f4f8c-271">Salvare le modifiche apportate a default. aspx e quindi visitarle tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="f4f8c-272">Accedere al sito in modo che il ticket di autenticazione basata su form sia incorporato nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="f4f8c-273">Quindi, da default. aspx, fare clic sul collegamento test link.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="f4f8c-274">Cosa è successo?</span><span class="sxs-lookup"><span data-stu-id="f4f8c-274">What happened?</span></span> <span data-ttu-id="f4f8c-275">Se non esiste alcuna pagina denominata SomePage. aspx, si è verificato un errore 404, ma ciò non è importante.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="f4f8c-276">Concentrarsi invece sulla barra degli indirizzi nel browser.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="f4f8c-277">Si noti che include il ticket di autenticazione basata su form nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="f4f8c-278">L'URL SomePage. aspx nel collegamento è stato convertito automaticamente in un URL che includeva il ticket di autenticazione. non è stato necessario scrivere un codice.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="f4f8c-279">Il ticket di autenticazione del modulo verrà incorporato automaticamente nell'URL per qualsiasi collegamento ipertestuale che non inizia con `http://` o `/`.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="f4f8c-280">Non è importante se il collegamento ipertestuale viene visualizzato in una chiamata a Response. redirect, in un controllo collegamento ipertestuale o in un elemento HTML di ancoraggio, ad esempio `<a href="...">...</a>`.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="f4f8c-281">Fino a quando l'URL non è simile `http://www.someserver.com/SomePage.aspx` o `/SomePage.aspx`, il ticket di autenticazione basata su form verrà incorporato per noi.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-282">I ticket di autenticazione basata su form senza cookie rispettano gli stessi criteri di timeout dei ticket di autenticazione basati su cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="f4f8c-283">Tuttavia, i ticket di autenticazione senza cookie sono più soggetti a attacchi di riproduzione poiché il ticket di autenticazione è incorporato direttamente nell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="f4f8c-284">Immaginate un utente che visita un sito Web, esegue l'accesso e incolla l'URL in un messaggio di posta elettronica a un collega.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="f4f8c-285">Se il collega fa clic su tale collegamento prima che venga raggiunta la scadenza, verrà eseguito l'accesso come utente che ha inviato il messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="f4f8c-286">Passaggio 3: protezione del ticket di autenticazione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="f4f8c-287">Il ticket di autenticazione basata su form viene trasmesso in transito in un cookie o incorporato direttamente all'interno dell'URL.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="f4f8c-288">Oltre alle informazioni di identità, il ticket di autenticazione può includere anche i dati utente (come si vedrà nel passaggio 4).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="f4f8c-289">Di conseguenza, è importante che i dati del ticket vengano crittografati da occhi indiscreti e (ancora più importante) che il sistema di autenticazione basata su form sia in grado di garantire che il ticket non sia stato alterato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="f4f8c-290">Per garantire la privacy dei dati del ticket, il sistema di autenticazione basata su form può crittografare i dati del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="f4f8c-291">La mancata crittografia dei dati del ticket invia informazioni potenzialmente riservate in transito in testo normale.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="f4f8c-292">Per garantire l'autenticità di un ticket, il sistema di autenticazione basata su form deve *convalidare* il ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="f4f8c-293">La convalida è l'atto di garantire che una particolare porzione di dati non sia stata modificata e venga eseguita tramite un *[codice Mac (Message Authentication Code)](http://en.wikipedia.org/wiki/Message_authentication_code)* .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="f4f8c-294">In breve, il MAC è costituito da una piccola quantità di informazioni che identifica i dati che devono essere convalidati (in questo caso, il ticket).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="f4f8c-295">Se i dati rappresentati dal MAC vengono modificati, il MAC e i dati non corrisponderanno.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="f4f8c-296">Inoltre, è difficile dal punto di vista del calcolo per un pirata informatico modificare i dati e generare il proprio MAC in modo che corrisponda ai dati modificati.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="f4f8c-297">Quando si crea o si modifica un ticket, il sistema di autenticazione basata su form crea un MAC e lo collega ai dati del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="f4f8c-298">Quando arriva una richiesta successiva, il sistema di autenticazione basata su form Confronta i dati MAC e ticket per convalidare l'autenticità dei dati del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="f4f8c-299">Nella figura 3 viene illustrato il flusso di lavoro graficamente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="f4f8c-300">[![l'autenticità del ticket viene garantita tramite un MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="f4f8c-301">**Figura 03**: l'autenticità del ticket è garantita tramite un Mac ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>

<span data-ttu-id="f4f8c-302">Le misure di sicurezza applicate al ticket di autenticazione variano a seconda dell'impostazione di protezione nell'elemento &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="f4f8c-303">L'impostazione di protezione può essere assegnata a uno dei tre valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="f4f8c-304">Tutto-il ticket è crittografato e con firma digitale (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="f4f8c-305">Viene applicata la crittografia di sola crittografia. non viene generato alcun MAC.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="f4f8c-306">None: il ticket non è né crittografato né firmato digitalmente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="f4f8c-307">Convalida: viene generato un MAC, ma i dati del ticket vengono inviati in rete in formato testo normale.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="f4f8c-308">Microsoft consiglia vivamente di utilizzare l'impostazione tutte.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="f4f8c-309">Impostazione delle chiavi di convalida e decrittografia</span><span class="sxs-lookup"><span data-stu-id="f4f8c-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="f4f8c-310">Gli algoritmi di crittografia e hashing utilizzati dal sistema di autenticazione basata su form per crittografare e convalidare il ticket di autenticazione sono personalizzabili tramite l' [elemento&gt; machineKey di&lt;](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web. config. Nella tabella 2 sono descritti gli attributi dell'elemento&gt; di &lt;machineKey e i relativi valori possibili.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="f4f8c-311">**Attributo**</span><span class="sxs-lookup"><span data-stu-id="f4f8c-311">**Attribute**</span></span> | <span data-ttu-id="f4f8c-312">**Descrizione**</span><span class="sxs-lookup"><span data-stu-id="f4f8c-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="f4f8c-313">decrittografia</span><span class="sxs-lookup"><span data-stu-id="f4f8c-313">decryption</span></span> | <span data-ttu-id="f4f8c-314">Indica l'algoritmo utilizzato per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="f4f8c-315">Questo attributo può avere uno dei quattro valori seguenti:-auto-l'impostazione predefinita; determina l'algoritmo in base alla lunghezza dell'attributo decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="f4f8c-316">-AES-usa l'algoritmo di [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="f4f8c-317">-DES-usa il [Data Encryption Standard (des)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) questo algoritmo è considerato vulnerabile dal punto di vista del calcolo e non deve essere usato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="f4f8c-318">-3DES: usa l'algoritmo [triple des](http://en.wikipedia.org/wiki/Triple_DES) , che funziona applicando l'algoritmo des tre volte.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="f4f8c-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="f4f8c-319">decryptionKey</span></span> | <span data-ttu-id="f4f8c-320">Chiave privata usata dall'algoritmo di crittografia.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="f4f8c-321">Questo valore deve essere una stringa esadecimale della lunghezza appropriata (in base al valore nella decrittografia), generare automaticamente o uno dei valori aggiunti con, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="f4f8c-322">L'aggiunta di IsolateApps indica a ASP.NET di usare un valore univoco per ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="f4f8c-323">Il valore predefinito è AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="f4f8c-324">convalida</span><span class="sxs-lookup"><span data-stu-id="f4f8c-324">validation</span></span> | <span data-ttu-id="f4f8c-325">Indica l'algoritmo utilizzato per la convalida.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="f4f8c-326">Questo attributo può avere uno dei quattro valori seguenti:-AES-usa l'algoritmo di Advanced Encryption Standard (AES).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="f4f8c-327">-MD5: usa l'algoritmo [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="f4f8c-328">-SHA1: usa l'algoritmo [SHA1](http://en.wikipedia.org/wiki/Sha1) (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="f4f8c-329">-3DES: usa l'algoritmo Triple DES.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="f4f8c-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="f4f8c-330">validationKey</span></span> | <span data-ttu-id="f4f8c-331">Chiave privata usata dall'algoritmo di convalida.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="f4f8c-332">Questo valore deve essere una stringa esadecimale della lunghezza appropriata (in base al valore in Validation), genera automaticamente o uno dei valori aggiunti a, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="f4f8c-333">L'aggiunta di IsolateApps indica a ASP.NET di usare un valore univoco per ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="f4f8c-334">Il valore predefinito è AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="f4f8c-335">**Tabella 2**: attributi dell'elemento&gt; di &lt;machineKey</span><span class="sxs-lookup"><span data-stu-id="f4f8c-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="f4f8c-336">Una descrizione approfondita di queste opzioni di crittografia e convalida e i vantaggi e gli svantaggi dei vari algoritmi esulano dall'ambito di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="f4f8c-337">Per una descrizione approfondita di questi problemi, incluse informazioni aggiuntive sugli algoritmi di crittografia e convalida da usare, sulle lunghezze delle chiavi da usare e sul modo migliore per generare queste chiavi, vedere la sezione relativa alla *sicurezza, all'appartenenza e alla gestione dei ruoli di Professional ASP.NET 2,0*.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="f4f8c-338">Per impostazione predefinita, le chiavi usate per la crittografia e la convalida vengono generate automaticamente per ogni applicazione e le chiavi vengono archiviate nell'autorità di sicurezza locale (LSA).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="f4f8c-339">In breve, le impostazioni predefinite garantiscono chiavi univoche in base al server Web e all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="f4f8c-340">Di conseguenza, questo comportamento predefinito non funzionerà per i due scenari seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="f4f8c-341">**Web farm** : in uno scenario di [Web farm](http://en.wikipedia.org/wiki/Web_farm) , una singola applicazione Web è ospitata in più server Web per finalità di scalabilità e ridondanza.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="f4f8c-342">Ogni richiesta in ingresso viene inviata a un server nella farm, vale a dire che, per la durata della sessione di un utente, possono essere usati server diversi per gestire le varie richieste.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="f4f8c-343">Ogni server deve quindi utilizzare le stesse chiavi di crittografia e convalida, in modo che il ticket di autenticazione basata su form creato, crittografato e convalidato in un server possa essere decrittografato e convalidato in un server diverso della farm.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="f4f8c-344">**Condivisione di ticket tra applicazioni** : un singolo server Web può ospitare più applicazioni ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="f4f8c-345">Se è necessario che le diverse applicazioni condividano un singolo ticket di autenticazione basata su form, è essenziale che le chiavi di crittografia e convalida corrispondano.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="f4f8c-346">Quando si utilizza un'impostazione Web farm o si condividono i ticket di autenticazione tra le applicazioni sullo stesso server, sarà necessario configurare l'elemento&gt; &lt;machineKey nelle applicazioni interessate in modo che i valori decryptionKey e validationKey corrispondano.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="f4f8c-347">Sebbene nessuno degli scenari descritti in precedenza venga applicato all'applicazione di esempio, è comunque possibile specificare valori decryptionKey e validationKey espliciti e definire gli algoritmi da usare.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="f4f8c-348">Aggiungere un'impostazione di&gt; &lt;machineKey al file Web. config:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="f4f8c-349">Per altre informazioni, vedere [procedura: configurare MachineKey in ASP.NET 2,0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-350">I valori decryptionKey e validationKey sono stati presi dalla [pagina Web delle password perfette](https://www.grc.com/passwords.htm)di [Steve Gibson](http://www.grc.com/stevegibson.htm), che genera 64 caratteri esadecimali casuali in ogni pagina visitata.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="f4f8c-351">Per ridurre la probabilità che queste chiavi si trovino nelle applicazioni di produzione, è consigliabile sostituire le chiavi sopra elencate con quelle generate in modo casuale dalla pagina delle password perfette.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="f4f8c-352">Passaggio 4: archiviazione di dati utente aggiuntivi nel ticket</span><span class="sxs-lookup"><span data-stu-id="f4f8c-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="f4f8c-353">In molte applicazioni Web vengono visualizzate informazioni sulla visualizzazione della pagina o sulla base dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="f4f8c-354">Ad esempio, una pagina Web potrebbe visualizzare il nome dell'utente e la data dell'ultimo accesso nell'angolo superiore di ogni pagina.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="f4f8c-355">Il ticket di autenticazione basata su form archivia il nome utente dell'utente attualmente connesso, ma quando sono necessarie altre informazioni, è necessario che la pagina venga inviata all'archivio utenti, in genere un database, per cercare le informazioni non archiviate nel ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="f4f8c-356">Con un po' di codice è possibile archiviare informazioni aggiuntive sull'utente nel ticket di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="f4f8c-357">Tali dati possono essere espressi tramite la [Proprietà UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)della [classe FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="f4f8c-358">Si tratta di una posizione utile per inserire piccole quantità di informazioni sull'utente in genere necessarie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="f4f8c-359">Il valore specificato nella proprietà UserData è incluso come parte del cookie del ticket di autenticazione e, analogamente agli altri campi del ticket, viene crittografato e convalidato in base alla configurazione del sistema di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="f4f8c-360">Per impostazione predefinita, UserData è una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="f4f8c-361">Per archiviare i dati utente nel ticket di autenticazione, è necessario scrivere un po' di codice nella pagina di accesso che acquisisce le informazioni specifiche dell'utente e le archivia nel ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="f4f8c-362">Poiché UserData è una proprietà di tipo String, i dati archiviati in tale proprietà devono essere serializzati correttamente sotto forma di stringa.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="f4f8c-363">Si supponga, ad esempio, che il nostro archivio utenti includa la data di nascita di ogni utente e il nome del proprio datore di lavoro e che si desideri archiviare questi due valori di proprietà nel ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="f4f8c-364">È possibile serializzare questi valori in una stringa concatenando la data della stringa di nascita dell'utente con una pipe (|), seguita dal nome del datore di lavoro.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="f4f8c-365">Per un utente Nato il 15 agosto 1974 che funziona per Northwind Traders, la proprietà UserData viene assegnata alla stringa: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="f4f8c-366">Ogni volta che è necessario accedere ai dati archiviati nel ticket, è possibile farlo afferrando la FormsAuthenticationTicket della richiesta corrente e deserializzando la proprietà UserData.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="f4f8c-367">Nel caso della data di nascita e del nome del datore di lavoro, si suddividerebbe la stringa UserData in due sottostringhe in base al delimitatore (|).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="f4f8c-368">[![informazioni aggiuntive sull'utente possono essere archiviate nel ticket di autenticazione](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="f4f8c-369">**Figura 04**: le informazioni sull'utente aggiuntive possono essere archiviate nel ticket[di autenticazione (fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="f4f8c-370">Scrittura di informazioni in UserData</span><span class="sxs-lookup"><span data-stu-id="f4f8c-370">Writing Information to UserData</span></span>

<span data-ttu-id="f4f8c-371">Sfortunatamente, l'aggiunta di informazioni specifiche dell'utente a un ticket di autenticazione basata su form non è così semplice come si può aspettarsi.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="f4f8c-372">La proprietà UserData della classe FormsAuthenticationTicket è di sola lettura e può essere specificata solo tramite il costruttore della classe FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="f4f8c-373">Quando si specifica la proprietà UserData nel costruttore, è necessario specificare anche gli altri valori del ticket: il nome utente, la data del problema, la scadenza e così via.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="f4f8c-374">Quando è stata creata la pagina di accesso nell'esercitazione precedente, questa operazione è stata gestita automaticamente dalla classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="f4f8c-375">Quando si aggiunge UserData a FormsAuthenticationTicket, è necessario scrivere il codice per replicare gran parte della funzionalità già fornita dalla classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="f4f8c-376">Esaminare il codice necessario per l'utilizzo di UserData aggiornando la pagina login. aspx per registrare informazioni aggiuntive sull'utente sul ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="f4f8c-377">Tenere presente che l'archivio dell'utente contiene informazioni sull'azienda a cui l'utente lavora e il relativo titolo e che si desidera acquisire tali informazioni nel ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="f4f8c-378">Aggiornare il gestore dell'evento Click LoginButton della pagina login. aspx in modo che il codice risulti analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="f4f8c-379">Esaminiamo il codice una riga alla volta.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="f4f8c-380">Il metodo inizia definendo quattro matrici di stringhe: Users, passwords, companyName e titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="f4f8c-381">Questi array contengono i nomi utente, le password, i nomi delle società e i titoli per gli account utente nel sistema, di cui sono presenti tre: Scott, Jisun e Sam.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="f4f8c-382">In un'applicazione reale, questi valori vengono sottoposti a query dall'archivio utenti, non hardcoded nel codice sorgente della pagina.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="f4f8c-383">Nell'esercitazione precedente, se le credenziali specificate erano valide, abbiamo semplicemente chiamato FormsAuthentication. RedirectFromLoginPage (UserName. text, RememberMe. Checked), che ha eseguito i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="f4f8c-384">Creazione del ticket di autenticazione basata su form</span><span class="sxs-lookup"><span data-stu-id="f4f8c-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="f4f8c-385">Ha scritto il ticket nell'archivio appropriato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="f4f8c-386">Per i ticket di autenticazione basati su cookie, viene utilizzata la raccolta di cookie del browser. per i ticket di autenticazione senza cookie, i dati del ticket vengono serializzati nell'URL</span><span class="sxs-lookup"><span data-stu-id="f4f8c-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="f4f8c-387">Reindirizzare l'utente alla pagina appropriata</span><span class="sxs-lookup"><span data-stu-id="f4f8c-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="f4f8c-388">Questi passaggi vengono replicati nel codice riportato sopra.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="f4f8c-389">In primo luogo, la stringa che verrà archiviata nella proprietà UserData viene formata combinando il nome della società e il titolo, delimitando i due valori con un carattere barra verticale (|).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="f4f8c-390">String userDataString = stringa. Concat (companyName [i], "|", titleAtCompany [i]);</span><span class="sxs-lookup"><span data-stu-id="f4f8c-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="f4f8c-391">Viene quindi richiamato il metodo FormsAuthentication. GetAuthCookie, che crea il ticket di autenticazione, ne esegue la crittografia e la convalida in base alle impostazioni di configurazione e lo inserisce in un oggetto HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="f4f8c-392">HttpCookie authCookie = FormsAuthentication. GetAuthCookie (UserName. text, RememberMe. Checked);</span><span class="sxs-lookup"><span data-stu-id="f4f8c-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="f4f8c-393">Per lavorare con FormAuthenticationTicket Embedded all'interno del cookie, è necessario chiamare il [metodo Decrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)della classe FormAuthentication, passando il valore del cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="f4f8c-394">FormsAuthenticationTicket ticket = FormsAuthentication. Decrypt (authCookie. Value);</span><span class="sxs-lookup"><span data-stu-id="f4f8c-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="f4f8c-395">Viene quindi creata una *nuova* istanza di FormsAuthenticationTicket in base ai valori di FormsAuthenticationTicket esistenti.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="f4f8c-396">Tuttavia, questo nuovo ticket include le informazioni specifiche dell'utente (userDataString).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="f4f8c-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket (ticket. Versione, ticket. Nome, ticket. Emesso, ticket. Scadenza, ticket. Persistente, userDataString);</span><span class="sxs-lookup"><span data-stu-id="f4f8c-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="f4f8c-398">Viene quindi crittografata (e convalidata) la nuova istanza di FormsAuthenticationTicket chiamando il [metodo Encrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)e vengono inseriti i dati crittografati (e convalidati) in authCookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="f4f8c-399">authCookie. Value = FormsAuthentication. Encrypt (newTicket);</span><span class="sxs-lookup"><span data-stu-id="f4f8c-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="f4f8c-400">Infine, authCookie viene aggiunto alla raccolta Response. cookies e viene chiamato il metodo GetRedirectUrl per determinare la pagina appropriata per l'invio dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="f4f8c-401">Tutto questo codice è necessario perché la proprietà UserData è di sola lettura e la classe FormsAuthentication non fornisce metodi per specificare le informazioni di UserData nei metodi GetAuthCookie, SetAuthCookie o RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-402">Il codice appena esaminato archivia le informazioni specifiche dell'utente in un ticket di autenticazione basato su cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="f4f8c-403">Le classi responsabili della serializzazione del ticket di autenticazione basata su form per l'URL sono interne al .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="f4f8c-404">A breve, non è possibile archiviare i dati utente in un ticket di autenticazione basata su form senza cookie.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="f4f8c-405">Accesso alle informazioni di UserData</span><span class="sxs-lookup"><span data-stu-id="f4f8c-405">Accessing the UserData Information</span></span>

<span data-ttu-id="f4f8c-406">A questo punto, il nome e il titolo della società di ogni utente vengono archiviati nella proprietà UserData del ticket di autenticazione basata su form al momento dell'accesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="f4f8c-407">È possibile accedere a queste informazioni dal ticket di autenticazione in qualsiasi pagina senza richiedere un viaggio all'archivio utenti.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="f4f8c-408">Per illustrare il modo in cui queste informazioni possono essere recuperate dalla proprietà UserData, è necessario aggiornare default. aspx in modo che il messaggio di benvenuto includa non solo il nome dell'utente, ma anche la società a cui lavorano e il titolo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="f4f8c-409">Attualmente, default. aspx contiene un pannello AuthenticatedMessagePanel con un controllo Label denominato WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="f4f8c-410">Questo pannello viene visualizzato solo per gli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="f4f8c-411">Aggiornare il codice nella pagina default. aspx\_caricare il gestore eventi in modo che abbia un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="f4f8c-412">Se request. IsAuthenticated è true, la proprietà Text di WelcomeBackMessage è impostata per la prima volta su Welcome back, *username*.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="f4f8c-413">Quindi, viene eseguito il cast della proprietà User. Identity a un oggetto FormsIdentity in modo che sia possibile accedere al FormsAuthenticationTicket sottostante.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="f4f8c-414">Una volta ottenuto il FormsAuthenticationTicket, deserializzare la proprietà UserData nel nome e nel titolo della società.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="f4f8c-415">Questa operazione viene eseguita suddividendo la stringa sul carattere barra verticale.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="f4f8c-416">Il nome e il titolo della società vengono quindi visualizzati nell'etichetta WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="f4f8c-417">Nella figura 5 viene illustrata una schermata di questa visualizzazione in azione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="f4f8c-418">Quando si accede a Scott, viene visualizzato un messaggio di benvenuto che include la società e il titolo di Scott.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="f4f8c-419">[![viene visualizzata la società e il titolo dell'utente attualmente connesso](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="f4f8c-420">**Figura 05**: vengono visualizzate la società e il titolo dell'utente attualmente connesso ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-421">La proprietà UserData del ticket di autenticazione funge da cache per l'archivio utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="f4f8c-422">Analogamente a qualsiasi cache, è necessario aggiornarla quando vengono modificati i dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="f4f8c-423">Se, ad esempio, è presente una pagina Web da cui gli utenti possono aggiornare il proprio profilo, è necessario aggiornare i campi memorizzati nella cache della proprietà UserData in modo da riflettere le modifiche apportate dall'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="f4f8c-424">Passaggio 5: uso di un'entità personalizzata</span><span class="sxs-lookup"><span data-stu-id="f4f8c-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="f4f8c-425">Per ogni richiesta in ingresso, il FormsAuthenticationModule tenta di autenticare l'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="f4f8c-426">Se è presente un ticket di autenticazione non scaduto, FormsAuthenticationModule assegna la proprietà HttpContext. User a un nuovo oggetto GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="f4f8c-427">Questo oggetto GenericPrincipal ha un'identità di tipo FormsIdentity, che include un riferimento al ticket di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="f4f8c-428">La classe GenericPrincipal contiene le funzionalità minime minime richieste da una classe che implementa IPrincipal, ma ha solo una proprietà Identity e un metodo IsInRole.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="f4f8c-429">L'oggetto principal dispone di due responsabilità: per indicare i ruoli a cui appartiene l'utente e per fornire informazioni sull'identità.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="f4f8c-430">Questa operazione viene eseguita tramite il metodo IsInRole (*roleName*) e la proprietà Identity dell'interfaccia IPrincipal, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="f4f8c-431">La classe GenericPrincipal consente di specificare una matrice di stringhe di nomi di ruoli tramite il relativo costruttore. il metodo IsInRole (*roleName*) verifica semplicemente se il passato *roleName* è presente nella matrice di stringhe.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="f4f8c-432">Quando FormsAuthenticationModule crea il GenericPrincipal, passa una matrice di stringhe vuota al costruttore del GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="f4f8c-433">Di conseguenza, qualsiasi chiamata a IsInRole restituirà sempre false.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="f4f8c-434">La classe GenericPrincipal soddisfa le esigenze per la maggior parte degli scenari di autenticazione basata su form in cui non vengono utilizzati i ruoli.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="f4f8c-435">Per le situazioni in cui la gestione dei ruoli predefinita non è sufficiente o quando è necessario associare un oggetto IIdentity personalizzato all'utente, è possibile creare un oggetto IPrincipal personalizzato durante il flusso di lavoro di autenticazione e assegnarlo alla proprietà HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-436">Come si vedrà nelle esercitazioni future, quando ASP. Il Framework dei ruoli di NET è abilitato. crea un oggetto Principal personalizzato di tipo [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) e sovrascrive l'oggetto GenericPrincipal creato dall'autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="f4f8c-437">Questa operazione viene eseguita in modo da personalizzare il metodo IsInRole dell'entità per l'interfaccia con l'API del Framework dei ruoli.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="f4f8c-438">Poiché non ci preoccupiamo ancora dei ruoli, l'unico motivo per creare un'entità personalizzata in questo frangente è associare un oggetto IIdentity personalizzato al server principale.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="f4f8c-439">Nel passaggio 4 è stata esaminata l'archiviazione di informazioni utente aggiuntive nella proprietà UserData del ticket di autenticazione, in particolare il nome della società e il titolo dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="f4f8c-440">Tuttavia, le informazioni di UserData sono accessibili solo tramite il ticket di autenticazione e solo in seguito come stringa serializzata, vale a dire che ogni volta che si desidera visualizzare le informazioni utente archiviate nel ticket è necessario analizzare la proprietà UserData.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="f4f8c-441">Per migliorare l'esperienza dello sviluppatore, è possibile creare una classe che implementi IIdentity e includa proprietà CompanyName e title.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="f4f8c-442">In questo modo, uno sviluppatore può accedere al nome della società e al titolo dell'utente attualmente connesso direttamente tramite le proprietà CompanyName e title senza che sia necessario per comprendere come analizzare la proprietà UserData.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="f4f8c-443">Creazione delle classi Identity e Principal personalizzate</span><span class="sxs-lookup"><span data-stu-id="f4f8c-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="f4f8c-444">Per questa esercitazione, è ora di creare gli oggetti Principal e Identity personalizzati nella cartella app\_code.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="f4f8c-445">Per iniziare, aggiungere un'app\_codice alla cartella del progetto, fare clic con il pulsante destro del mouse sul nome del progetto in Esplora soluzioni, selezionare l'opzione Aggiungi cartella ASP.NET e scegliere app\_codice.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="f4f8c-446">La cartella del codice\_app è una cartella ASP.NET speciale che include i file di classe specifici del sito Web.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="f4f8c-447">La cartella del codice dell'app\_deve essere usata solo quando si gestisce il progetto tramite il modello di progetto del sito Web.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="f4f8c-448">Se si usa il [modello di progetto applicazione Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), creare una cartella standard e aggiungervi le classi.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="f4f8c-449">Ad esempio, è possibile aggiungere una nuova cartella denominata Classis e inserire il codice qui.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="f4f8c-450">Aggiungere quindi due nuovi file di classe alla cartella del codice dell'app\_, uno denominato CustomIdentity.cs e uno denominato CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>

<span data-ttu-id="f4f8c-451">[![aggiungere le classi CustomIdentity e CustomPrincipal al progetto](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="f4f8c-452">**Figura 06**: aggiungere le classi CustomIdentity e CustomPrincipal al progetto ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>

<span data-ttu-id="f4f8c-453">La classe CustomIdentity è responsabile dell'implementazione dell'interfaccia IIdentity, che definisce le proprietà AuthenticationType, IsAuthenticated e Name.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="f4f8c-454">Oltre alle proprietà obbligatorie, è possibile esporre il ticket di autenticazione basata su form sottostante, nonché le proprietà per il nome e il titolo della società dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="f4f8c-455">Immettere il codice seguente nella classe CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="f4f8c-456">Si noti che la classe include una variabile membro FormsAuthenticationTicket (ticket\_) e che queste informazioni del ticket devono essere fornite tramite il costruttore.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="f4f8c-457">Questi dati del ticket vengono usati per restituire il nome dell'identità; viene analizzata la relativa proprietà UserData per restituire i valori per le proprietà CompanyName e title.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="f4f8c-458">Successivamente, creare la classe CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="f4f8c-459">Poiché in questo frangente non sono interessati i ruoli, il costruttore della classe CustomPrincipal accetta solo un oggetto CustomIdentity. il metodo IsInRole restituisce sempre false.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="f4f8c-460">Assegnazione di un oggetto CustomPrincipal al contesto di sicurezza della richiesta in ingresso</span><span class="sxs-lookup"><span data-stu-id="f4f8c-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="f4f8c-461">È ora disponibile una classe che estende la specifica IIdentity predefinita per includere le proprietà CompanyName e title, oltre a una classe Principal personalizzata che usa l'identità personalizzata.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="f4f8c-462">È ora possibile passare alla pipeline ASP.NET e assegnare l'oggetto entità personalizzata al contesto di sicurezza della richiesta in ingresso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="f4f8c-463">La pipeline ASP.NET accetta una richiesta in ingresso e la elabora attraverso una serie di passaggi.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="f4f8c-464">In ogni fase viene generato un particolare evento, che consente agli sviluppatori di accedere alla pipeline ASP.NET e modificare la richiesta in determinati punti del ciclo di vita.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="f4f8c-465">FormsAuthenticationModule, ad esempio, attende che ASP.NET generi l' [evento AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx). a questo punto controlla la richiesta in ingresso per un ticket di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="f4f8c-466">Se viene trovato un ticket di autenticazione, viene creato un oggetto GenericPrincipal che viene assegnato alla proprietà HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="f4f8c-467">Dopo l'evento AuthenticateRequest, la pipeline ASP.NET genera l' [evento PostAuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), in cui è possibile sostituire l'oggetto GenericPrincipal creato da FormsAuthenticationModule con un'istanza dell'oggetto CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="f4f8c-468">Nella figura 7 viene illustrato questo flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="f4f8c-469">[![GenericPrincipal viene sostituito da un CustomPrincipal nell'evento PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="f4f8c-470">**Figura 07**: il GenericPrincipal viene sostituito da un CustomPrincipal nell'evento PostAuthenticationRequest ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>

<span data-ttu-id="f4f8c-471">Per eseguire il codice in risposta a un evento della pipeline ASP.NET, è possibile creare il gestore eventi appropriato in Global. asax o creare un modulo HTTP personalizzato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="f4f8c-472">Per questa esercitazione verrà creato il gestore eventi in Global. asax.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="f4f8c-473">Per iniziare, aggiungere Global. asax al sito Web.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="f4f8c-474">Fare clic con il pulsante destro del mouse sul nome del progetto in Esplora soluzioni e aggiungere un elemento di tipo Global Application Class denominato Global. asax.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="f4f8c-475">[![aggiungere un file Global. asax al sito Web](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="f4f8c-476">**Figura 08**: aggiungere un file Global. asax al sito Web ([fare clic per visualizzare l'immagine con dimensioni complete](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f4f8c-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>

<span data-ttu-id="f4f8c-477">Il modello Global. asax predefinito include i gestori eventi per un numero di eventi della pipeline ASP.NET, tra cui l'evento di inizio, di fine e di [errore](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), tra gli altri.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="f4f8c-478">È possibile rimuovere questi gestori eventi, perché non sono necessari per questa applicazione.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="f4f8c-479">L'evento a cui si è interessati è PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="f4f8c-480">Aggiornare il file Global. asax in modo che il relativo markup risulti simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="f4f8c-481">Il Metodo OnPostAuthenticateRequest dell'applicazione\_viene eseguito ogni volta che il runtime di ASP.NET genera l'evento PostAuthenticateRequest, che si verifica una volta per ogni richiesta di pagina in arrivo.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="f4f8c-482">Il gestore eventi inizia controllando se l'utente è autenticato ed è stato autenticato tramite l'autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="f4f8c-483">In tal caso, viene creato un nuovo oggetto CustomIdentity e viene passato il ticket di autenticazione della richiesta corrente nel relativo costruttore.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="f4f8c-484">In seguito, viene creato un oggetto CustomPrincipal e viene passato l'oggetto CustomIdentity appena creato nel relativo costruttore.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="f4f8c-485">Infine, il contesto di sicurezza della richiesta corrente viene assegnato all'oggetto CustomPrincipal appena creato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="f4f8c-486">Si noti che l'ultimo passaggio, che associa l'oggetto CustomPrincipal al contesto di sicurezza della richiesta, assegna l'entità a due proprietà: HttpContext. User e thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="f4f8c-487">Queste due assegnazioni sono necessarie a causa del modo in cui i contesti di sicurezza vengono gestiti in ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="f4f8c-488">Il .NET Framework associa un contesto di sicurezza a ogni thread in esecuzione; Queste informazioni sono disponibili come oggetto IPrincipal tramite la [proprietà CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)dell' [oggetto thread](https://msdn.microsoft.com/library/system.threading.thread.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="f4f8c-489">Si tratta di una confusione che ASP.NET dispone di proprie informazioni sul contesto di sicurezza (HttpContext. User).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="f4f8c-490">In alcuni scenari, la proprietà thread. CurrentPrincipal viene esaminata quando si determina il contesto di sicurezza. in altri scenari, viene usato HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="f4f8c-491">In .NET, ad esempio, sono disponibili funzionalità di sicurezza che consentono agli sviluppatori di dichiarare in modo dichiarativo quali utenti o ruoli possono creare un'istanza di una classe o richiamare metodi specifici (vedere [aggiunta di regole di autorizzazione ai livelli business e dati tramite PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="f4f8c-492">Dietro le quinte, queste tecniche dichiarative determinano il contesto di sicurezza tramite la proprietà thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="f4f8c-493">In altri scenari, viene utilizzata la proprietà HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="f4f8c-494">Nell'esercitazione precedente, ad esempio, è stata usata questa proprietà per visualizzare il nome utente dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="f4f8c-495">Ovviamente, è fondamentale che le informazioni sul contesto di sicurezza nelle proprietà thread. CurrentPrincipal e HttpContext. User corrispondano.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="f4f8c-496">Il runtime di ASP.NET sincronizza automaticamente questi valori di proprietà.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="f4f8c-497">Questa sincronizzazione viene tuttavia eseguita dopo l'evento AuthenticateRequest, ma *prima* dell'evento PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="f4f8c-498">Di conseguenza, quando si aggiunge un'entità personalizzata nell'evento PostAuthenticateRequest, è necessario essere certi di assegnare manualmente il thread. CurrentPrincipal o else thread. CurrentPrincipal e HttpContext. User non saranno sincronizzati. Per una descrizione più dettagliata di questo problema, vedere [context. User vs. thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="f4f8c-499">Accesso alle proprietà CompanyName e title</span><span class="sxs-lookup"><span data-stu-id="f4f8c-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="f4f8c-500">Ogni volta che una richiesta arriva e viene inviata al motore ASP.NET, l'applicazione\_gestore dell'evento OnPostAuthenticateRequest in Global. asax viene attivato.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="f4f8c-501">Se la richiesta è stata autenticata correttamente da FormsAuthenticationModule, il gestore eventi creerà un nuovo oggetto CustomPrincipal con un oggetto CustomIdentity basato sul ticket di autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="f4f8c-502">Con questa logica, l'accesso alle informazioni relative al nome e al titolo della società dell'utente attualmente connesso è estremamente semplice.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="f4f8c-503">Tornare al gestore eventi di caricamento della pagina\_in default. aspx, dove nel passaggio 4 è stato scritto il codice per recuperare il ticket di autenticazione del modulo e analizzare la proprietà UserData per visualizzare il nome e il titolo della società dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="f4f8c-504">Con gli oggetti CustomPrincipal e CustomIdentity attualmente in uso, non è necessario analizzare i valori fuori dalla proprietà UserData del ticket.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="f4f8c-505">È invece sufficiente ottenere un riferimento all'oggetto CustomIdentity e utilizzare le proprietà CompanyName e title:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="f4f8c-506">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="f4f8c-506">Summary</span></span>

<span data-ttu-id="f4f8c-507">In questa esercitazione è stato esaminato come personalizzare le impostazioni del sistema di autenticazione basata su form tramite Web. config. È stato esaminato il modo in cui viene gestita la scadenza del ticket di autenticazione e il modo in cui vengono usate le misure di sicurezza per la crittografia e la convalida per proteggere il ticket dall'ispezione e dalla modifica.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="f4f8c-508">Infine, è stato illustrato l'uso della proprietà UserData del ticket di autenticazione per archiviare informazioni aggiuntive sull'utente nel ticket stesso e come usare oggetti Principal e Identity personalizzati per esporre queste informazioni in modo più semplice per gli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="f4f8c-509">Questa esercitazione conclude l'esame dell'autenticazione basata su form in ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="f4f8c-510">L'esercitazione successiva avvia il passaggio al framework delle appartenenze.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="f4f8c-511">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="f4f8c-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="f4f8c-512">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="f4f8c-512">Further Reading</span></span>

<span data-ttu-id="f4f8c-513">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4f8c-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f4f8c-514">Dissezione dell'autenticazione basata su form</span><span class="sxs-lookup"><span data-stu-id="f4f8c-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="f4f8c-515">Spiegazione: autenticazione basata su form in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="f4f8c-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="f4f8c-516">Procedura: proteggere l'autenticazione basata su form in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="f4f8c-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="f4f8c-517">[Sicurezza, appartenenza e gestione dei ruoli Professional ASP.NET 2,0](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="f4f8c-518">Protezione dei controlli di accesso</span><span class="sxs-lookup"><span data-stu-id="f4f8c-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="f4f8c-519">Elemento&gt; di autenticazione &lt;</span><span class="sxs-lookup"><span data-stu-id="f4f8c-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="f4f8c-520">Elemento &lt;Forms&gt; per &lt;Authentication&gt;</span><span class="sxs-lookup"><span data-stu-id="f4f8c-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="f4f8c-521">Elemento&gt; machineKey &lt;</span><span class="sxs-lookup"><span data-stu-id="f4f8c-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="f4f8c-522">Informazioni sul ticket e sul cookie di autenticazione basata su form</span><span class="sxs-lookup"><span data-stu-id="f4f8c-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="f4f8c-523">Formazione video sugli argomenti contenuti in questa esercitazione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="f4f8c-524">Come modificare le proprietà di autenticazione basata su form</span><span class="sxs-lookup"><span data-stu-id="f4f8c-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="f4f8c-525">Come configurare e usare l'autenticazione senza cookie in un'applicazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f4f8c-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="f4f8c-526">Rilocazione dell'accesso ai moduli ASP</span><span class="sxs-lookup"><span data-stu-id="f4f8c-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="f4f8c-527">Configurazione della chiave personalizzata di accesso ai moduli</span><span class="sxs-lookup"><span data-stu-id="f4f8c-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="f4f8c-528">Aggiungere dati personalizzati al metodo di autenticazione</span><span class="sxs-lookup"><span data-stu-id="f4f8c-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="f4f8c-529">Usare oggetti Principal personalizzati</span><span class="sxs-lookup"><span data-stu-id="f4f8c-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="f4f8c-530">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="f4f8c-530">About the Author</span></span>

<span data-ttu-id="f4f8c-531">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f4f8c-532">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f4f8c-533">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="f4f8c-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="f4f8c-534">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="f4f8c-535">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="f4f8c-535">Special Thanks To</span></span>

<span data-ttu-id="f4f8c-536">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f4f8c-537">Il revisore responsabile di questa esercitazione è Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="f4f8c-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="f4f8c-538">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="f4f8c-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f4f8c-539">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="f4f8c-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f4f8c-540">[Precedente](an-overview-of-forms-authentication-cs.md)
> [Successivo](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="f4f8c-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
