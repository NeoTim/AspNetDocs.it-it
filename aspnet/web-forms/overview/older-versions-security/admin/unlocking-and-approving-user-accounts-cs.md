---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
title: Sblocco e approvazione degli account utente (C#) | Microsoft Docs
author: rick-anderson
description: Questa esercitazione illustra come creare una pagina Web che consente agli amministratori di gestire gli stati bloccati e approvati degli utenti. Si vedrà anche come approvare nuovi utenti o...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 5346aab1-9974-489f-a065-ae3883b8a350
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: c19f7dfac0ddd12c2b4f3388a71a8ca0f71cbb18
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78545521"
---
# <a name="unlocking-and-approving-user-accounts-c"></a><span data-ttu-id="45140-104">Sblocco e approvazione degli account utente (C#)</span><span class="sxs-lookup"><span data-stu-id="45140-104">Unlocking and Approving User Accounts (C#)</span></span>

<span data-ttu-id="45140-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="45140-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="45140-106">[Scarica codice](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) o [Scarica PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="45140-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span></span>

> <span data-ttu-id="45140-107">Questa esercitazione illustra come creare una pagina Web che consente agli amministratori di gestire gli stati bloccati e approvati degli utenti.</span><span class="sxs-lookup"><span data-stu-id="45140-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="45140-108">Si vedrà anche come approvare nuovi utenti solo dopo aver verificato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="45140-108">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="introduction"></a><span data-ttu-id="45140-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="45140-109">Introduction</span></span>

<span data-ttu-id="45140-110">Insieme a un nome utente, una password e un indirizzo di posta elettronica, ogni account utente dispone di due campi di stato che stabiliscono se l'utente può accedere al sito: bloccato e approvato.</span><span class="sxs-lookup"><span data-stu-id="45140-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="45140-111">Un utente viene bloccato automaticamente se fornisce credenziali non valide un numero specificato di volte entro un numero specificato di minuti (le impostazioni predefinite bloccano l'utente dopo 5 tentativi di accesso non validi entro 10 minuti).</span><span class="sxs-lookup"><span data-stu-id="45140-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="45140-112">Lo stato approvato è utile negli scenari in cui è necessario che un'azione riemerga prima che un nuovo utente possa accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="45140-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="45140-113">Ad esempio, un utente potrebbe dover prima verificare il proprio indirizzo di posta elettronica o essere approvato da un amministratore prima di poter eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="45140-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="45140-114">Poiché un utente bloccato o non approvato non è in grado di eseguire l'accesso, è naturale sapere come questi Stati possono essere reimpostati.</span><span class="sxs-lookup"><span data-stu-id="45140-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="45140-115">ASP.NET non include alcuna funzionalità incorporata o controlli Web per la gestione degli stati bloccati e approvati degli utenti, in parte perché queste decisioni devono essere gestite per ogni sito.</span><span class="sxs-lookup"><span data-stu-id="45140-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="45140-116">Alcuni siti potrebbero approvare automaticamente tutti i nuovi account utente (comportamento predefinito).</span><span class="sxs-lookup"><span data-stu-id="45140-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="45140-117">Altri hanno un amministratore che approva nuovi account o non approva gli utenti fino a quando non visitano un collegamento inviato all'indirizzo di posta elettronica fornito al momento dell'iscrizione.</span><span class="sxs-lookup"><span data-stu-id="45140-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="45140-118">Analogamente, è possibile che alcuni siti blocchino gli utenti fino a quando un amministratore non reimposta il proprio stato, mentre altri siti inviano un messaggio di posta elettronica all'utente bloccato con un URL che possono visitare per sbloccare l'account.</span><span class="sxs-lookup"><span data-stu-id="45140-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="45140-119">Questa esercitazione illustra come creare una pagina Web che consente agli amministratori di gestire gli stati bloccati e approvati degli utenti.</span><span class="sxs-lookup"><span data-stu-id="45140-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="45140-120">Si vedrà anche come approvare nuovi utenti solo dopo aver verificato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="45140-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="45140-121">Passaggio 1: gestione degli stati bloccati e approvati degli utenti</span><span class="sxs-lookup"><span data-stu-id="45140-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="45140-122"><a id="Tutorial12"> </a>Nell'esercitazione [*creazione di un'interfaccia per selezionare un account utente da molti*](building-an-interface-to-select-one-user-account-from-many-cs.md) è stata creata una pagina che elenca ogni account utente in un GridView filtrato con paging.</span><span class="sxs-lookup"><span data-stu-id="45140-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-cs.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="45140-123">La griglia elenca il nome e l'indirizzo di posta elettronica di ogni utente, i relativi stati approvati e bloccati, sia che siano attualmente online, sia eventuali commenti sull'utente.</span><span class="sxs-lookup"><span data-stu-id="45140-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="45140-124">Per gestire gli stati approvati e bloccati degli utenti, è possibile rendere questa griglia modificabile.</span><span class="sxs-lookup"><span data-stu-id="45140-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="45140-125">Per modificare lo stato approvato da un utente, l'amministratore deve innanzitutto individuare l'account utente e quindi modificare la riga GridView corrispondente, selezionando o deselezionando la casella di controllo approvato.</span><span class="sxs-lookup"><span data-stu-id="45140-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="45140-126">In alternativa, è possibile gestire gli stati approvati e bloccati tramite una pagina ASP.NET separata.</span><span class="sxs-lookup"><span data-stu-id="45140-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="45140-127">Per questa esercitazione si useranno due pagine ASP.NET: `ManageUsers.aspx` e `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="45140-128">L'idea è che `ManageUsers.aspx` elenca gli account utente nel sistema, mentre `UserInformation.aspx` consente all'amministratore di gestire gli stati approvati e bloccati per un utente specifico.</span><span class="sxs-lookup"><span data-stu-id="45140-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="45140-129">Il primo ordine di business consiste nell'aumentare il controllo GridView in `ManageUsers.aspx` per includere un HyperLinkField, che viene visualizzato come una colonna di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="45140-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="45140-130">Si vuole che ogni collegamento punti a `UserInformation.aspx?user=UserName`, dove *username* è il nome dell'utente da modificare.</span><span class="sxs-lookup"><span data-stu-id="45140-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="45140-131">Se è stato scaricato il codice per <a id="Tutorial13"> </a>l'esercitazione sul [*ripristino e la modifica delle password*](recovering-and-changing-passwords-cs.md) , è possibile notare che la pagina `ManageUsers.aspx` contiene già un set di collegamenti "Gestisci" e la pagina `UserInformation.aspx` fornisce un'interfaccia per la modifica della password dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="45140-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-cs.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="45140-132">Ho deciso di non replicare questa funzionalità nel codice associato a questa esercitazione, perché funzionava aggirando l'API di appartenenza e agendo direttamente con il database di SQL Server per modificare la password di un utente.</span><span class="sxs-lookup"><span data-stu-id="45140-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="45140-133">Questa esercitazione inizia da zero con la pagina `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>

### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="45140-134">Aggiunta dei collegamenti "Gestisci" al`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="45140-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="45140-135">Aprire la pagina `ManageUsers.aspx` e aggiungere un HyperLinkField al `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="45140-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="45140-136">Impostare la proprietà `Text` di HyperLinkField su "Manage" e le proprietà `DataNavigateUrlFields` e `DataNavigateUrlFormatString` su `UserName` e "UserInformation. aspx? User ={0}", rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="45140-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="45140-137">Queste impostazioni configurano il HyperLinkField in modo che tutti i collegamenti ipertestuali visualizzino il testo "Manage", ma ogni collegamento passa il valore del *nome utente* appropriato in QueryString.</span><span class="sxs-lookup"><span data-stu-id="45140-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="45140-138">Dopo aver aggiunto HyperLinkField a GridView, è possibile visualizzare la pagina di `ManageUsers.aspx` tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="45140-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="45140-139">Come illustrato nella figura 1, ogni riga GridView include ora un collegamento "Gestisci".</span><span class="sxs-lookup"><span data-stu-id="45140-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="45140-140">Il collegamento "Gestisci" per Bruce punta a `UserInformation.aspx?user=Bruce`, mentre il collegamento "Gestisci" per Dave punta a `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="45140-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>

<span data-ttu-id="45140-141">[![HyperLinkField aggiunge un](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="45140-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span></span>

<span data-ttu-id="45140-142">**Figura 1**: HyperLinkField aggiunge un collegamento "Gestisci" per ogni account utente ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="45140-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span></span>

<span data-ttu-id="45140-143">L'interfaccia utente e il codice per la pagina `UserInformation.aspx` vengono creati in un attimo, ma prima di tutto viene illustrato come modificare a livello di codice gli stati bloccati e approvati di un utente.</span><span class="sxs-lookup"><span data-stu-id="45140-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="45140-144">La [classe`MembershipUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) dispone di proprietà [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) e [`IsApproved`](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="45140-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="45140-145">La proprietà `IsLockedOut` è di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="45140-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="45140-146">Non esiste alcun meccanismo per bloccare un utente a livello di codice. per sbloccare un utente, usare il [metodo di`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx)della classe `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="45140-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="45140-147">La proprietà `IsApproved` è leggibile e scrivibile.</span><span class="sxs-lookup"><span data-stu-id="45140-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="45140-148">Per salvare le modifiche apportate a questa proprietà, è necessario chiamare il [metodo`UpdateUser`](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx)della classe `Membership`, passando l'oggetto `MembershipUser` modificato.</span><span class="sxs-lookup"><span data-stu-id="45140-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="45140-149">Poiché la proprietà `IsApproved` è leggibile e scrivibile, un controllo CheckBox è probabilmente l'elemento dell'interfaccia utente migliore per la configurazione di questa proprietà.</span><span class="sxs-lookup"><span data-stu-id="45140-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="45140-150">Tuttavia, una casella di controllo non funzionerà per la proprietà `IsLockedOut` perché un amministratore non è in grado di bloccare un utente, può solo sbloccare un utente.</span><span class="sxs-lookup"><span data-stu-id="45140-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="45140-151">Un'interfaccia utente adatta per la proprietà `IsLockedOut` è un pulsante che, se selezionato, Sblocca l'account utente.</span><span class="sxs-lookup"><span data-stu-id="45140-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="45140-152">Questo pulsante dovrebbe essere abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="45140-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="45140-153">Creazione della pagina`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="45140-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="45140-154">A questo punto è possibile implementare l'interfaccia utente in `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="45140-155">Aprire questa pagina e aggiungere i controlli Web seguenti:</span><span class="sxs-lookup"><span data-stu-id="45140-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="45140-156">Un controllo collegamento ipertestuale che, quando selezionato, restituisce l'amministratore alla pagina `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="45140-157">Controllo Web etichetta per visualizzare il nome dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="45140-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="45140-158">Impostare `ID` dell'etichetta su `UserNameLabel` e deselezionare la relativa proprietà `Text`.</span><span class="sxs-lookup"><span data-stu-id="45140-158">Set this Label's `ID` to `UserNameLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="45140-159">Controllo CheckBox denominato `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="45140-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="45140-160">Impostarne la proprietà `AutoPostBack` su `true`.</span><span class="sxs-lookup"><span data-stu-id="45140-160">Set its `AutoPostBack` property to `true`.</span></span>
- <span data-ttu-id="45140-161">Controllo etichetta per la visualizzazione della data dell'ultimo blocco dell'utente.</span><span class="sxs-lookup"><span data-stu-id="45140-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="45140-162">Assegnare all'etichetta il nome `LastLockedOutDateLabel` e deselezionare la relativa proprietà `Text`.</span><span class="sxs-lookup"><span data-stu-id="45140-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="45140-163">Pulsante per sbloccare l'utente.</span><span class="sxs-lookup"><span data-stu-id="45140-163">A Button for unlocking the user.</span></span> <span data-ttu-id="45140-164">Assegnare un nome al pulsante `UnlockUserButton` e impostare la relativa proprietà `Text` su "Sblocca utente".</span><span class="sxs-lookup"><span data-stu-id="45140-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="45140-165">Controllo Label per la visualizzazione dei messaggi di stato, ad esempio, "lo stato approvato dall'utente è stato aggiornato".</span><span class="sxs-lookup"><span data-stu-id="45140-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="45140-166">Assegnare un nome a questo controllo `StatusMessage`, deselezionare la relativa proprietà `Text` e impostare la relativa proprietà `CssClass` su `Important`.</span><span class="sxs-lookup"><span data-stu-id="45140-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="45140-167">Il `Important` classe CSS è definito nel file di foglio di stile `Styles.css`; Visualizza il testo corrispondente in un tipo di carattere rosso grande.</span><span class="sxs-lookup"><span data-stu-id="45140-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="45140-168">Dopo l'aggiunta di questi controlli, la visualizzazione progettazione in Visual Studio dovrebbe avere un aspetto simile allo screenshot della figura 2.</span><span class="sxs-lookup"><span data-stu-id="45140-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>

<span data-ttu-id="45140-169">[![creare l'interfaccia utente per UserInformation. aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="45140-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span></span>

<span data-ttu-id="45140-170">**Figura 2**: creare l'interfaccia utente per `UserInformation.aspx` ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="45140-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span></span>

<span data-ttu-id="45140-171">Con l'interfaccia utente completata, l'attività successiva consiste nell'impostare la casella di controllo `IsApproved` e gli altri controlli in base alle informazioni dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="45140-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="45140-172">Creare un gestore eventi per l'evento `Load` della pagina e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="45140-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample1.cs)]

<span data-ttu-id="45140-173">Il codice precedente inizia assicurandosi che questa sia la prima visita alla pagina e non un postback successivo.</span><span class="sxs-lookup"><span data-stu-id="45140-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="45140-174">Legge quindi il nome utente passato attraverso il `user` campo QueryString e recupera le informazioni sull'account utente tramite il metodo `Membership.GetUser(username)`.</span><span class="sxs-lookup"><span data-stu-id="45140-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="45140-175">Se non è stato fornito alcun nome utente tramite la QueryString o se l'utente specificato non è stato trovato, l'amministratore viene restituito alla pagina `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="45140-176">Il valore di `UserName` dell'oggetto `MembershipUser` viene quindi visualizzato nella `UserNameLabel` e la casella di controllo `IsApproved` viene controllata in base al valore della proprietà `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="45140-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="45140-177">La [proprietà`LastLockoutDate`](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) dell'oggetto `MembershipUser` restituisce un valore `DateTime` che indica la data dell'ultimo blocco dell'utente. Se l'utente non è mai stato bloccato, il valore restituito dipende dal provider di appartenenze.</span><span class="sxs-lookup"><span data-stu-id="45140-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="45140-178">Quando viene creato un nuovo account, il `SqlMembershipProvider` imposta il campo `LastLockoutDate` della tabella `aspnet_Membership` su `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="45140-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="45140-179">Il codice precedente Visualizza una stringa vuota nel `LastLockoutDateLabel` se la proprietà `LastLockoutDate` si verifica prima dell'anno 2000; in caso contrario, la parte relativa alla data della proprietà `LastLockoutDate` viene visualizzata nell'etichetta.</span><span class="sxs-lookup"><span data-stu-id="45140-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="45140-180">La proprietà `Enabled` `UnlockUserButton'` s è impostata sullo stato di blocco dell'utente, ovvero il pulsante verrà abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="45140-180">The `UnlockUserButton'` s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="45140-181">È possibile eseguire il test della pagina `UserInformation.aspx` tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="45140-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="45140-182">Naturalmente, sarà necessario iniziare da `ManageUsers.aspx` e selezionare un account utente da gestire.</span><span class="sxs-lookup"><span data-stu-id="45140-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="45140-183">Quando si arriva in `UserInformation.aspx`, si noti che la casella di controllo `IsApproved` viene verificata solo se l'utente è approvato.</span><span class="sxs-lookup"><span data-stu-id="45140-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="45140-184">Se l'utente non è mai stato bloccato, viene visualizzata la data dell'ultimo blocco.</span><span class="sxs-lookup"><span data-stu-id="45140-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="45140-185">Il pulsante Sblocca utente è abilitato solo se l'utente è attualmente bloccato. Selezionando o deselezionando la casella di controllo `IsApproved` o facendo clic sul pulsante Sblocca utente viene generato un postback, ma non vengono apportate modifiche all'account utente perché è ancora necessario creare i gestori eventi per questi eventi.</span><span class="sxs-lookup"><span data-stu-id="45140-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="45140-186">Tornare a Visual Studio e creare i gestori eventi per l'evento `CheckedChanged` della casella di controllo `IsApproved` e l'evento `Click` del pulsante `UnlockUser`.</span><span class="sxs-lookup"><span data-stu-id="45140-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="45140-187">Nel gestore dell'evento `CheckedChanged` impostare la proprietà `IsApproved` dell'utente sulla proprietà `Checked` della casella di controllo e quindi salvare le modifiche tramite una chiamata a `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="45140-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="45140-188">Nel gestore dell'evento `Click`, è sufficiente chiamare il metodo `UnlockUser` dell'oggetto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="45140-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="45140-189">In entrambi i gestori eventi, visualizzare un messaggio appropriato nell'etichetta `StatusMessage`.</span><span class="sxs-lookup"><span data-stu-id="45140-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample2.cs)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="45140-190">Test della pagina`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="45140-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="45140-191">Con questi gestori eventi sul posto, rivedere la pagina e non approvare un utente.</span><span class="sxs-lookup"><span data-stu-id="45140-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="45140-192">Come illustrato nella figura 3, viene visualizzato un breve messaggio nella pagina che indica che la proprietà `IsApproved` dell'utente è stata modificata correttamente.</span><span class="sxs-lookup"><span data-stu-id="45140-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>

<span data-ttu-id="45140-193">[![Chris non è stato approvato](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="45140-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span></span>

<span data-ttu-id="45140-194">**Figura 3**: Chris è stato non approvato ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="45140-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span></span>

<span data-ttu-id="45140-195">Successivamente, disconnettersi e provare ad accedere come utente il cui account è semplicemente unapproved.</span><span class="sxs-lookup"><span data-stu-id="45140-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="45140-196">Poiché l'utente non è approvato, non è in grado di eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="45140-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="45140-197">Per impostazione predefinita, il controllo Login Visualizza lo stesso messaggio se l'utente non è in grado di eseguire l'accesso, indipendentemente dal motivo.</span><span class="sxs-lookup"><span data-stu-id="45140-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="45140-198">Tuttavia, nell' <a id="Tutorial6"> </a>esercitazione [*convalida delle credenziali utente rispetto all'archivio utenti di appartenenza*](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) è stato esaminato il miglioramento del controllo di accesso per visualizzare un messaggio più appropriato.</span><span class="sxs-lookup"><span data-stu-id="45140-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="45140-199">Come illustrato nella figura 4, Chris viene visualizzato un messaggio che informa che non è possibile eseguire l'accesso perché il suo account non è ancora approvato.</span><span class="sxs-lookup"><span data-stu-id="45140-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>

<span data-ttu-id="45140-200">[Non è possibile eseguire l'accesso ![Chris perché il suo account non è approvato](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="45140-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span></span>

<span data-ttu-id="45140-201">**Figura 4**: Chris non può eseguire l'accesso perché il suo account non è approvato ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="45140-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span></span>

<span data-ttu-id="45140-202">Per testare la funzionalità di blocco, provare ad accedere come utente approvato, ma usare una password non corretta.</span><span class="sxs-lookup"><span data-stu-id="45140-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="45140-203">Ripetere questo processo per il numero di volte necessario fino a quando l'account dell'utente non è stato bloccato. Il controllo Login è stato aggiornato anche per visualizzare un messaggio personalizzato se si tenta di eseguire l'accesso da un account bloccato.</span><span class="sxs-lookup"><span data-stu-id="45140-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="45140-204">Si è certi che un account è stato bloccato una volta visualizzato il messaggio seguente nella pagina di accesso: "l'account è stato bloccato a causa di un numero eccessivo di tentativi di accesso non validi.</span><span class="sxs-lookup"><span data-stu-id="45140-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="45140-205">Per sbloccare l'account, contattare l'amministratore.</span><span class="sxs-lookup"><span data-stu-id="45140-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="45140-206">Tornare alla pagina `ManageUsers.aspx` e fare clic sul collegamento Gestisci per l'utente bloccato.</span><span class="sxs-lookup"><span data-stu-id="45140-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="45140-207">Come illustrato nella figura 5, dovrebbe essere visualizzato un valore nel `LastLockedOutDateLabel` il pulsante Sblocca utente deve essere abilitato.</span><span class="sxs-lookup"><span data-stu-id="45140-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="45140-208">Fare clic sul pulsante Sblocca utente per sbloccare l'account utente.</span><span class="sxs-lookup"><span data-stu-id="45140-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="45140-209">Dopo aver sbloccato l'utente, sarà possibile eseguire di nuovo l'accesso.</span><span class="sxs-lookup"><span data-stu-id="45140-209">Once you have unlocked the user, they will be able to login again.</span></span>

<span data-ttu-id="45140-210">[![Dave è stato bloccato dal sistema](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="45140-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span></span>

<span data-ttu-id="45140-211">**Figura 5**: Dave è stato bloccato dal sistema ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="45140-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span></span>

## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="45140-212">Passaggio 2: specifica dello stato approvato per i nuovi utenti</span><span class="sxs-lookup"><span data-stu-id="45140-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="45140-213">Lo stato approvato è utile negli scenari in cui si desidera eseguire un'azione prima che un nuovo utente sia in grado di accedere alle funzionalità specifiche dell'utente del sito.</span><span class="sxs-lookup"><span data-stu-id="45140-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="45140-214">Ad esempio, è possibile che sia in esecuzione un sito web privato in cui tutte le pagine, ad eccezione delle pagine di accesso e di iscrizione, sono accessibili solo agli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="45140-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="45140-215">Ma cosa accade se un estraneo raggiunge il sito Web, trova la pagina di iscrizione e crea un account?</span><span class="sxs-lookup"><span data-stu-id="45140-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="45140-216">Per evitare che ciò accada, è possibile spostare la pagina di iscrizione in una cartella `Administration` e richiedere che un amministratore crei manualmente ogni account.</span><span class="sxs-lookup"><span data-stu-id="45140-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="45140-217">In alternativa, è possibile consentire a chiunque di iscriversi, ma proibire l'accesso al sito finché un amministratore non approva l'account utente.</span><span class="sxs-lookup"><span data-stu-id="45140-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="45140-218">Per impostazione predefinita, il controllo CreateUserWizard approva nuovi account.</span><span class="sxs-lookup"><span data-stu-id="45140-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="45140-219">È possibile configurare questo comportamento usando la [proprietà`DisableCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx)del controllo.</span><span class="sxs-lookup"><span data-stu-id="45140-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="45140-220">Impostare questa proprietà su `true` per non approvare nuovi account utente.</span><span class="sxs-lookup"><span data-stu-id="45140-220">Set this property to `true` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="45140-221">Per impostazione predefinita, il controllo CreateUserWizard registra automaticamente il nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="45140-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="45140-222">Questo comportamento è determinato dalla [proprietà`LoginCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx)del controllo.</span><span class="sxs-lookup"><span data-stu-id="45140-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="45140-223">Poiché gli utenti non approvati non possono accedere al sito, quando `DisableCreatedUser` viene `true` il nuovo account utente non viene registrato nel sito, indipendentemente dal valore della proprietà `LoginCreatedUser`.</span><span class="sxs-lookup"><span data-stu-id="45140-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `true` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>

<span data-ttu-id="45140-224">Se si creano nuovi account utente a livello di codice tramite il metodo `Membership.CreateUser`, per creare un account utente non approvato usare uno degli overload che accettano il valore della proprietà `IsApproved` del nuovo utente come parametro di input.</span><span class="sxs-lookup"><span data-stu-id="45140-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="45140-225">Passaggio 3: approvazione degli utenti tramite la verifica dell'indirizzo di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="45140-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="45140-226">Molti siti Web che supportano gli account utente non approvano i nuovi utenti fino a quando non verificano l'indirizzo di posta elettronica fornito durante la registrazione.</span><span class="sxs-lookup"><span data-stu-id="45140-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="45140-227">Questo processo di verifica viene in genere usato per contrastare i bot, gli spammer e altri mai-do-pozzi perché richiede un indirizzo di posta elettronica univoco e verificato e aggiunge un passaggio aggiuntivo nel processo di iscrizione.</span><span class="sxs-lookup"><span data-stu-id="45140-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="45140-228">Con questo modello, quando un nuovo utente si iscrive, viene inviato un messaggio di posta elettronica che include un collegamento a una pagina di verifica.</span><span class="sxs-lookup"><span data-stu-id="45140-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="45140-229">Visitando il collegamento, l'utente ha provato a ricevere il messaggio di posta elettronica e, di conseguenza, l'indirizzo di posta elettronica specificato è valido.</span><span class="sxs-lookup"><span data-stu-id="45140-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="45140-230">La pagina di verifica è responsabile dell'approvazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="45140-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="45140-231">Questa operazione può essere eseguita automaticamente, in modo da approvare qualsiasi utente che raggiunge questa pagina o solo dopo che l'utente fornisce informazioni aggiuntive, ad esempio un [captcha](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="45140-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="45140-232">Per gestire questo flusso di lavoro, è necessario prima aggiornare la pagina di creazione dell'account in modo che i nuovi utenti non siano approvati.</span><span class="sxs-lookup"><span data-stu-id="45140-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="45140-233">Aprire la pagina `EnhancedCreateUserWizard.aspx` nella cartella `Membership` e impostare la proprietà `DisableCreatedUser` del controllo CreateUserWizard su `true`.</span><span class="sxs-lookup"><span data-stu-id="45140-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `true`.</span></span>

<span data-ttu-id="45140-234">Successivamente, è necessario configurare il controllo CreateUserWizard per inviare un messaggio di posta elettronica al nuovo utente con istruzioni su come verificare il proprio account.</span><span class="sxs-lookup"><span data-stu-id="45140-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="45140-235">In particolare, si includerà un collegamento nel messaggio di posta elettronica alla pagina `Verification.aspx` (che è ancora necessario creare), passando la `UserId` del nuovo utente tramite la QueryString.</span><span class="sxs-lookup"><span data-stu-id="45140-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="45140-236">La pagina `Verification.aspx` eseguirà la ricerca dell'utente specificato e la contrassegnerà approvata.</span><span class="sxs-lookup"><span data-stu-id="45140-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="45140-237">Invio di un messaggio di posta elettronica di verifica ai nuovi utenti</span><span class="sxs-lookup"><span data-stu-id="45140-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="45140-238">Per inviare un messaggio di posta elettronica dal controllo CreateUserWizard, configurare la relativa proprietà `MailDefinition` in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="45140-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="45140-239">Come illustrato nell' <a id="Tutorial13"> </a> [esercitazione precedente](recovering-and-changing-passwords-cs.md), i controlli ChangePassword e PasswordRecovery includono una [Proprietà`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) che funziona nello stesso modo in cui si trova il controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="45140-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-cs.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="45140-240">Per utilizzare la proprietà `MailDefinition` è necessario specificare le opzioni di recapito della posta elettronica in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="45140-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="45140-241">Per ulteriori informazioni, vedere l'articolo relativo all' [invio di messaggi di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="45140-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>

<span data-ttu-id="45140-242">Per iniziare, creare un nuovo modello di messaggio di posta elettronica denominato `CreateUserWizard.txt` nella cartella `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="45140-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="45140-243">Usare il testo seguente per il modello:</span><span class="sxs-lookup"><span data-stu-id="45140-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-cs/samples/sample3.aspx)]

<span data-ttu-id="45140-244">Impostare la proprietà `MailDefinition'` s `BodyFileName` su "~/EmailTemplates/CreateUserWizard.txt" e la relativa proprietà `Subject` su "Benvenuti nel sito Web.</span><span class="sxs-lookup"><span data-stu-id="45140-244">Set the `MailDefinition'` s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="45140-245">Attiva l'account ".</span><span class="sxs-lookup"><span data-stu-id="45140-245">Please activate your account."</span></span>

<span data-ttu-id="45140-246">Si noti che il modello di posta elettronica `CreateUserWizard.txt` include un segnaposto di `<%VerificationUrl%>`.</span><span class="sxs-lookup"><span data-stu-id="45140-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="45140-247">Questo è il punto in cui verrà inserito l'URL per la pagina `Verification.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="45140-248">Il CreateUserWizard sostituisce automaticamente i segnaposto `<%UserName%>` e `<%Password%>` con il nome utente e la password del nuovo account, ma non esiste alcun segnaposto di `<%VerificationUrl%>` incorporato.</span><span class="sxs-lookup"><span data-stu-id="45140-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="45140-249">È necessario sostituirlo manualmente con l'URL di verifica appropriato.</span><span class="sxs-lookup"><span data-stu-id="45140-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="45140-250">A tale scopo, creare un gestore eventi per l' [evento`SendingMail`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) di CreateUserWizard e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="45140-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample4.cs)]

<span data-ttu-id="45140-251">L'evento `SendingMail` viene generato dopo l'evento `CreatedUser`, vale a dire che nel momento in cui il gestore dell'evento precedente esegue il nuovo account utente è già stato creato.</span><span class="sxs-lookup"><span data-stu-id="45140-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="45140-252">È possibile accedere al valore `UserId` del nuovo utente chiamando il metodo `Membership.GetUser`, passando il `UserName` immesso nel controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="45140-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="45140-253">Quindi, viene creato l'URL di verifica.</span><span class="sxs-lookup"><span data-stu-id="45140-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="45140-254">L'istruzione `Request.Url.GetLeftPart(UriPartial.Authority)` restituisce la parte `http://yourserver.com` dell'URL. `Request.ApplicationPath` restituisce il percorso in cui si trova la radice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="45140-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="45140-255">L'URL di verifica viene quindi definito come `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="45140-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="45140-256">Queste due stringhe vengono quindi concatenate per formare l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="45140-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="45140-257">Infine, il corpo del messaggio di posta elettronica (`e.Message.Body`) ha tutte le occorrenze di `<%VerificationUrl%>` sostituite con l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="45140-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="45140-258">Il risultato finale è che i nuovi utenti non sono approvati, vale a dire che non possono accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="45140-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="45140-259">Inoltre, viene inviato automaticamente un messaggio di posta elettronica con un collegamento all'URL di verifica (vedere la figura 6).</span><span class="sxs-lookup"><span data-stu-id="45140-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>

<span data-ttu-id="45140-260">[![il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="45140-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span></span>

<span data-ttu-id="45140-261">**Figura 6**: il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="45140-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="45140-262">Il passaggio predefinito di CreateUserWizard del controllo CreateUserWizard Visualizza un messaggio che informa l'utente che il proprio account è stato creato e visualizza un pulsante continua.</span><span class="sxs-lookup"><span data-stu-id="45140-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="45140-263">Quando si fa clic su questa opzione, l'utente viene specificato dall'URL specificato dalla proprietà `ContinueDestinationPageUrl` del controllo.</span><span class="sxs-lookup"><span data-stu-id="45140-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="45140-264">CreateUserWizard in `EnhancedCreateUserWizard.aspx` è configurato per l'invio di nuovi utenti al `~/Membership/AdditionalUserInfo.aspx`, che richiede all'utente la propria città, l'URL della Home page e la firma.</span><span class="sxs-lookup"><span data-stu-id="45140-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="45140-265">Poiché queste informazioni possono essere aggiunte solo dagli utenti connessi, è consigliabile aggiornare questa proprietà per restituire gli utenti alla Home page del sito (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="45140-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="45140-266">Inoltre, è necessario aumentare la pagina `EnhancedCreateUserWizard.aspx` o il passaggio CreateUserWizard per informare l'utente che è stato inviato un messaggio di posta elettronica di verifica e che il relativo account non verrà attivato fino a quando non seguiranno le istruzioni riportate in questo messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="45140-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="45140-267">Lascio queste modifiche come esercizio per il lettore.</span><span class="sxs-lookup"><span data-stu-id="45140-267">I leave these modifications as an exercise for the reader.</span></span>

### <a name="creating-the-verification-page"></a><span data-ttu-id="45140-268">Creazione della pagina di verifica</span><span class="sxs-lookup"><span data-stu-id="45140-268">Creating the Verification Page</span></span>

<span data-ttu-id="45140-269">L'attività finale consiste nel creare la pagina `Verification.aspx`.</span><span class="sxs-lookup"><span data-stu-id="45140-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="45140-270">Aggiungere questa pagina alla cartella radice, associando la pagina alla pagina master `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="45140-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="45140-271">Come è stato fatto con la maggior parte delle pagine di contenuto precedenti aggiunte al sito, rimuovere il controllo contenuto che fa riferimento al `LoginContent` ContentPlaceHolder in modo che la pagina contenuto usi il contenuto predefinito della pagina master.</span><span class="sxs-lookup"><span data-stu-id="45140-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="45140-272">Aggiungere un controllo Web Label alla pagina `Verification.aspx`, impostare la relativa `ID` su `StatusMessage` e deselezionare la relativa proprietà Text.</span><span class="sxs-lookup"><span data-stu-id="45140-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="45140-273">Successivamente, creare il gestore dell'evento `Page_Load` e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="45140-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample5.cs)]

<span data-ttu-id="45140-274">La maggior parte del codice precedente verifica che il `UserId` fornito tramite la QueryString esista, che si tratta di un valore `Guid` valido e che faccia riferimento a un account utente esistente.</span><span class="sxs-lookup"><span data-stu-id="45140-274">The bulk of the above code verifies that the `UserId` supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="45140-275">Se vengono superati tutti questi controlli, l'account utente viene approvato; in caso contrario, viene visualizzato un messaggio di stato appropriato.</span><span class="sxs-lookup"><span data-stu-id="45140-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="45140-276">Nella figura 7 viene illustrata la pagina `Verification.aspx` se visitata tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="45140-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>

<span data-ttu-id="45140-277">[![l'account del nuovo utente è ora approvato](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="45140-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span></span>

<span data-ttu-id="45140-278">**Figura 7**: l'account del nuovo utente è ora approvato ([fare clic per visualizzare l'immagine con dimensioni complete](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="45140-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span></span>

## <a name="summary"></a><span data-ttu-id="45140-279">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="45140-279">Summary</span></span>

<span data-ttu-id="45140-280">Tutti gli account utente di appartenenza hanno due Stati che determinano se l'utente può accedere al sito: `IsLockedOut` e `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="45140-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="45140-281">Entrambe le proprietà devono essere `true` per l'accesso dell'utente.</span><span class="sxs-lookup"><span data-stu-id="45140-281">Both of these properties must be `true` for the user to login.</span></span>

<span data-ttu-id="45140-282">Lo stato di blocco dell'utente viene usato come misura di sicurezza per ridurre la probabilità che un pirata informatico si rompa in un sito tramite metodi di forza bruta.</span><span class="sxs-lookup"><span data-stu-id="45140-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="45140-283">In particolare, un utente viene bloccato se è presente un certo numero di tentativi di accesso non validi entro un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="45140-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="45140-284">Questi limiti sono configurabili tramite le impostazioni del provider di appartenenza in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="45140-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="45140-285">Lo stato approvato viene comunemente usato come mezzo per impedire ai nuovi utenti di accedere fino a quando non si è verificato un intervento.</span><span class="sxs-lookup"><span data-stu-id="45140-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="45140-286">Probabilmente il sito richiede che i nuovi account siano prima approvati dall'amministratore o, come illustrato nel passaggio 3, verificando il proprio indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="45140-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="45140-287">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="45140-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="45140-288">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="45140-288">About the Author</span></span>

<span data-ttu-id="45140-289">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="45140-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="45140-290">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="45140-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="45140-291">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="45140-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="45140-292">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="45140-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="45140-293">Ringraziamento speciale a...</span><span class="sxs-lookup"><span data-stu-id="45140-293">Special Thanks To…</span></span>

<span data-ttu-id="45140-294">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="45140-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="45140-295">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="45140-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="45140-296">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="45140-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="45140-297">[Precedente](recovering-and-changing-passwords-cs.md)
> [Successivo](building-an-interface-to-select-one-user-account-from-many-vb.md)</span><span class="sxs-lookup"><span data-stu-id="45140-297">[Previous](recovering-and-changing-passwords-cs.md)
[Next](building-an-interface-to-select-one-user-account-from-many-vb.md)</span></span>
