---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
title: Lo sblocco e approvazione degli account utente (c#) | Microsoft Docs
author: rick-anderson
description: Questa esercitazione illustra come creare una pagina web per gli amministratori per la gestione degli utenti bloccati e approvato gli stati. Si vedrà anche come approvare di nuovo o gli utenti...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 5346aab1-9974-489f-a065-ae3883b8a350
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: d4e8591f3090de8f931ffd8eb1dd0a1138674842
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59410045"
---
# <a name="unlocking-and-approving-user-accounts-c"></a><span data-ttu-id="0d144-104">Sblocco e approvazione degli account utente (C#)</span><span class="sxs-lookup"><span data-stu-id="0d144-104">Unlocking and Approving User Accounts (C#)</span></span>

<span data-ttu-id="0d144-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0d144-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0d144-106">[Scaricare il codice](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) o [Scarica il PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="0d144-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span></span>

> <span data-ttu-id="0d144-107">Questa esercitazione illustra come creare una pagina web per gli amministratori per la gestione degli utenti bloccati e approvato gli stati.</span><span class="sxs-lookup"><span data-stu-id="0d144-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="0d144-108">Si vedrà anche come approvare i nuovi utenti solo dopo che si è verificato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0d144-108">We will also see how to approve new users only after they have verified their email address.</span></span>


## <a name="introduction"></a><span data-ttu-id="0d144-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="0d144-109">Introduction</span></span>

<span data-ttu-id="0d144-110">Insieme a un nome utente, password e messaggio di posta elettronica, ognuno dei quali include due campi di stato che determinano se l'utente può accedere al sito: bloccati e approvata.</span><span class="sxs-lookup"><span data-stu-id="0d144-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="0d144-111">Un utente venga bloccato automaticamente se forniscono credenziali non valide un numero specificato di volte all'interno di un numero specificato di minuti (le impostazioni predefinite bloccano un utente dopo 5 tentativi di accesso non valido all'interno di 10 minuti).</span><span class="sxs-lookup"><span data-stu-id="0d144-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="0d144-112">Lo stato approvato è utile negli scenari in cui un'azione deve trascorrere prima che un nuovo utente è in grado di accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="0d144-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="0d144-113">Ad esempio, un utente potrebbe dover verificare innanzitutto l'indirizzo di posta elettronica o essere approvata da un amministratore prima di essere in grado di account di accesso.</span><span class="sxs-lookup"><span data-stu-id="0d144-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="0d144-114">Poiché un blocco obsoleto o non approvate utente non è possibile eseguire l'accesso, si tratta solo naturale chiedersi come questi stati possono essere reimpostati.</span><span class="sxs-lookup"><span data-stu-id="0d144-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="0d144-115">ASP.NET non include una funzionalità incorporata o controlli Web per la gestione degli utenti bloccati e approvato gli stati, in parte perché queste decisioni devono essere gestiti in modo da sito a sito.</span><span class="sxs-lookup"><span data-stu-id="0d144-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="0d144-116">Alcuni siti potrebbero approvare automaticamente tutti i nuovi account utente (il comportamento predefinito).</span><span class="sxs-lookup"><span data-stu-id="0d144-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="0d144-117">Altri utenti hanno un amministratore di approvare i nuovi account o non si approva gli utenti fino a quando non accedono a un collegamento inviato all'indirizzo di posta elettronica fornito quando si hanno effettuato l'iscrizione.</span><span class="sxs-lookup"><span data-stu-id="0d144-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="0d144-118">Analogamente, alcuni siti potrebbero bloccare gli utenti fino a quando un amministratore reimposta il relativo stato, mentre altri siti di inviano un messaggio di posta elettronica all'utente bloccato con un URL possono accedere per sbloccare l'account.</span><span class="sxs-lookup"><span data-stu-id="0d144-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="0d144-119">Questa esercitazione illustra come creare una pagina web per gli amministratori per la gestione degli utenti bloccati e approvato gli stati.</span><span class="sxs-lookup"><span data-stu-id="0d144-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="0d144-120">Si vedrà anche come approvare i nuovi utenti solo dopo che si è verificato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0d144-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="0d144-121">Passaggio 1: La gestione degli utenti bloccati e approvato gli Stati</span><span class="sxs-lookup"><span data-stu-id="0d144-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="0d144-122">Nel <a id="Tutorial12"> </a> [ *creazione di un'interfaccia per selezionare un Account utente da molti* ](building-an-interface-to-select-one-user-account-from-many-cs.md) esercitazione sono state create una pagina elencata ogni account utente in un paging, filtrati GridView.</span><span class="sxs-lookup"><span data-stu-id="0d144-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-cs.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="0d144-123">La griglia elenca ogni nome utente e indirizzo di posta elettronica, i relativi stati approvati e bloccati, che siano connessi attualmente online e i commenti relativi all'utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="0d144-124">Per la gestione degli utenti approvati e bloccati gli stati, possiamo rendere questa griglia modificabile.</span><span class="sxs-lookup"><span data-stu-id="0d144-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="0d144-125">Per modificare lo stato di approvazione dell'utente, l'amministratore potrebbe innanzitutto individuare l'account utente e quindi modificare la riga corrispondente di GridView, selezionando o deselezionando la casella di controllo approvato.</span><span class="sxs-lookup"><span data-stu-id="0d144-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="0d144-126">In alternativa, è possibile gestire gli stati approvati e bloccati tramite una pagina ASP.NET separata.</span><span class="sxs-lookup"><span data-stu-id="0d144-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="0d144-127">Per questa esercitazione si userà due pagine ASP.NET: `ManageUsers.aspx` e `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d144-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="0d144-128">L'idea è che `ManageUsers.aspx` Elenca gli account utente nel sistema, mentre `UserInformation.aspx` consente all'amministratore di gestire gli stati approvati e bloccati per un utente specifico.</span><span class="sxs-lookup"><span data-stu-id="0d144-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="0d144-129">Il primo è per aumentare il controllo GridView in `ManageUsers.aspx` per includere un HyperLinkField, che esegue il rendering come una colonna di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="0d144-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="0d144-130">Vogliamo ogni collegamento in modo che punti `UserInformation.aspx?user=UserName`, dove *UserName* è il nome dell'utente da modificare.</span><span class="sxs-lookup"><span data-stu-id="0d144-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="0d144-131">Se è stato scaricato il codice per il <a id="Tutorial13"> </a> [ *recupero e modifica delle password* ](recovering-and-changing-passwords-cs.md) esercitazione si è notato che la `ManageUsers.aspx` pagina contiene già un set di " Gestire"collegamenti e `UserInformation.aspx` pagina fornisce un'interfaccia per modificare la password dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="0d144-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-cs.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="0d144-132">Ho deciso di non replicare tale funzionalità nel codice associato a questa esercitazione perché ha funzionato per eludere l'API di appartenenza e l'uso direttamente con il database di SQL Server per modificare la password dell'utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="0d144-133">Questa esercitazione inizia da zero con la `UserInformation.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="0d144-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>


### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="0d144-134">Aggiunta di "Manage" collegamenti al`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="0d144-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="0d144-135">Aprire il `ManageUsers.aspx` pagina e aggiungere un HyperLinkField al `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="0d144-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="0d144-136">Impostare il HyperLinkField `Text` proprietà su "Gestisci" e la relativa `DataNavigateUrlFields` e `DataNavigateUrlFormatString` delle proprietà per `UserName` e "UserInformation.aspx?user={0}" rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0d144-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="0d144-137">Queste impostazioni configurano il HyperLinkField in modo che tutti i collegamenti ipertestuali visualizzare il testo "Manage", ma ogni collegamento passa nelle rispettive caselle *UserName* valore nella stringa di query.</span><span class="sxs-lookup"><span data-stu-id="0d144-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="0d144-138">Dopo aver aggiunto il HyperLinkField GridView, si consiglia di visualizzare il `ManageUsers.aspx` pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0d144-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="0d144-139">Come illustrato nella figura 1, ogni riga GridView ora include un collegamento "Gestisci".</span><span class="sxs-lookup"><span data-stu-id="0d144-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="0d144-140">Il collegamento "Manage" per Bruce rimanda `UserInformation.aspx?user=Bruce`, mentre il collegamento "Manage" per Dave punta a `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="0d144-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>


<span data-ttu-id="0d144-141">[![Aggiunge il HyperLinkField un](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span></span>

<span data-ttu-id="0d144-142">**Figura 1**: Il HyperLinkField aggiunge un collegamento "Manage" per ogni Account utente ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span></span>


<span data-ttu-id="0d144-143">Verrà creato l'interfaccia utente e del codice per il `UserInformation.aspx` pagina in un momento, ma prima si discorso su come modificare a livello di codice un utente bloccato e approvato gli stati.</span><span class="sxs-lookup"><span data-stu-id="0d144-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="0d144-144">Il [ `MembershipUser` classe](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) ha [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) e [ `IsApproved` proprietà](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d144-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="0d144-145">Il `IsLockedOut` proprietà è di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="0d144-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="0d144-146">Non è disponibile alcun meccanismo venga bloccato a livello di codice utente. Per sbloccare un utente, usare il `MembershipUser` della classe [ `UnlockUser` metodo](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d144-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="0d144-147">Il `IsApproved` proprietà è leggibile e modificabile.</span><span class="sxs-lookup"><span data-stu-id="0d144-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="0d144-148">Per salvare eventuali modifiche a questa proprietà, è necessario chiamare il `Membership` della classe [ `UpdateUser` metodo](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx)passando modificato `MembershipUser` oggetto.</span><span class="sxs-lookup"><span data-stu-id="0d144-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="0d144-149">Poiché il `IsApproved` proprietà è leggibile e scrivibile, una casella di controllo è probabilmente il migliore elemento dell'interfaccia utente per la configurazione di questa proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="0d144-150">Tuttavia, una casella di controllo non funziona per le `IsLockedOut` proprietà perché un amministratore non è possibile bloccare un utente, Anna può sbloccare solo un utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="0d144-151">Un'interfaccia utente adatta per il `IsLockedOut` proprietà è un pulsante che, quando si fa clic, sblocca l'account utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="0d144-152">Questo pulsante deve essere abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="0d144-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="0d144-153">Creazione di`UserInformation.aspx`pagina</span><span class="sxs-lookup"><span data-stu-id="0d144-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="0d144-154">A questo punto siamo pronti implementare l'interfaccia utente in `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="0d144-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="0d144-155">Aprire questa pagina e aggiungere i controlli Web seguenti:</span><span class="sxs-lookup"><span data-stu-id="0d144-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="0d144-156">Controllare un collegamento ipertestuale che, quando si fa clic, l'amministratore restituisce il `ManageUsers.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="0d144-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="0d144-157">Controllo etichetta Web per visualizzare il nome dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="0d144-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="0d144-158">Impostare questa etichetta `ID` al `UserNameLabel` e cancellare il `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-158">Set this Label's `ID` to `UserNameLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="0d144-159">Una casella di controllo denominato `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="0d144-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="0d144-160">Impostare relativi `AutoPostBack` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="0d144-160">Set its `AutoPostBack` property to `true`.</span></span>
- <span data-ttu-id="0d144-161">Data dell'ultimo blocco un controllo etichetta per la visualizzazione all'utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="0d144-162">Denominare questa etichetta `LastLockedOutDateLabel` e cancellare il `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="0d144-163">Pulsante per sbloccare l'utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-163">A Button for unlocking the user.</span></span> <span data-ttu-id="0d144-164">Denominare il pulsante `UnlockUserButton` e impostare il `Text` proprietà su "Sblocca utente".</span><span class="sxs-lookup"><span data-stu-id="0d144-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="0d144-165">Un controllo etichetta per la visualizzazione dei messaggi di stato, ad esempio, "stato di approvazione dell'utente è stato aggiornato".</span><span class="sxs-lookup"><span data-stu-id="0d144-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="0d144-166">Denominare questo controllo `StatusMessage`, deselezionare le relative `Text` proprietà e set relativo `CssClass` proprietà `Important`.</span><span class="sxs-lookup"><span data-stu-id="0d144-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="0d144-167">(Il `Important` classe CSS viene definito nel `Styles.css` file foglio di stile; Visualizza il testo corrispondente in un tipo di carattere di grandi dimensioni, di colore rosso.)</span><span class="sxs-lookup"><span data-stu-id="0d144-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="0d144-168">Dopo l'aggiunta di questi controlli, la visualizzazione di progettazione in Visual Studio dovrebbe essere simile allo screenshot nella figura 2.</span><span class="sxs-lookup"><span data-stu-id="0d144-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>


<span data-ttu-id="0d144-169">[![Creare l'interfaccia utente per UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span></span>

<span data-ttu-id="0d144-170">**Figura 2**: Creare l'interfaccia utente per `UserInformation.aspx` ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span></span>


<span data-ttu-id="0d144-171">Con l'interfaccia utente completa, l'attività successiva consiste nell'impostare il `IsApproved` casella di controllo e altri controlli in base alle informazioni dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="0d144-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="0d144-172">Creare un gestore eventi per la pagina `Load` eventi e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d144-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample1.cs)]

<span data-ttu-id="0d144-173">Il codice sopra riportato viene avviato, garantendo che questa è la prima visita alla pagina e non un postback successivi.</span><span class="sxs-lookup"><span data-stu-id="0d144-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="0d144-174">Quindi legge il nome utente passato tramite la `user` campo stringa di query e recupera le informazioni relative all'account utente tramite la `Membership.GetUser(username)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0d144-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="0d144-175">Se tramite la stringa di query è stato fornito alcun nome utente, oppure se non è stato possibile trovare l'utente specificato, l'amministratore viene inviato il `ManageUsers.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="0d144-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="0d144-176">Il `MembershipUser` dell'oggetto `UserName` valore viene quindi visualizzato nel `UserNameLabel` e il `IsApproved` casella di controllo viene verificata in base il `IsApproved` valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="0d144-177">Il `MembershipUser` dell'oggetto [ `LastLockoutDate` proprietà](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) restituisce un `DateTime` valore che indica quando l'utente è l'ultimo viene bloccato. Se l'utente non è stato bloccato, il valore restituito dipende dal provider di appartenenze.</span><span class="sxs-lookup"><span data-stu-id="0d144-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="0d144-178">Quando viene creato un nuovo account, il `SqlMembershipProvider` imposta la `aspnet_Membership` della tabella `LastLockoutDate` campo `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="0d144-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="0d144-179">Il codice sopra riportato consente di visualizzare una stringa vuota nel `LastLockoutDateLabel` se il `LastLockoutDate` proprietà si verifica prima dell'anno 2000; in caso contrario, la parte relativa alla data del `LastLockoutDate` proprietà sia visualizzata nell'etichetta.</span><span class="sxs-lookup"><span data-stu-id="0d144-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="0d144-180">Il `UnlockUserButton'` s `Enabled` viene impostata per l'utente bloccato sullo stato, vale a dire che questo pulsante viene abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="0d144-180">The `UnlockUserButton'` s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="0d144-181">Si consiglia di testare il `UserInformation.aspx` pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0d144-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="0d144-182">È, naturalmente, necessario per l'avvio al `ManageUsers.aspx` e selezionare un account utente da gestire.</span><span class="sxs-lookup"><span data-stu-id="0d144-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="0d144-183">Al momento in arrivo presso `UserInformation.aspx`, si noti che il `IsApproved` casella di controllo viene verificata solo se l'utente è approvato.</span><span class="sxs-lookup"><span data-stu-id="0d144-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="0d144-184">Se l'utente è mai stato bloccato, viene visualizzato l'ultimo bloccata di Data.</span><span class="sxs-lookup"><span data-stu-id="0d144-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="0d144-185">Pulsante Sblocca utente è attivato solo se l'utente è attualmente bloccato. Selezionare o deselezionare il `IsApproved` casella di controllo o facendo clic sul pulsante Sblocca utente provoca un postback, ma non vengono eseguite modifiche all'account utente perché dobbiamo ancora creare gestori eventi per questi eventi.</span><span class="sxs-lookup"><span data-stu-id="0d144-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="0d144-186">Tornare a Visual Studio e creare i gestori eventi per il `IsApproved` della casella di controllo `CheckedChanged` evento e il `UnlockUser` del pulsante `Click` evento.</span><span class="sxs-lookup"><span data-stu-id="0d144-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="0d144-187">Nel `CheckedChanged` gestore dell'evento, impostare l'utente `IsApproved` proprietà per il `Checked` proprietà della casella di controllo, quindi salvare le modifiche tramite una chiamata a `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="0d144-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="0d144-188">Nel `Click` gestore dell'evento, semplicemente chiamare la `MembershipUser` dell'oggetto `UnlockUser` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0d144-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="0d144-189">In entrambi i gestori eventi, visualizzare un messaggio appropriato nella `StatusMessage` etichetta.</span><span class="sxs-lookup"><span data-stu-id="0d144-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample2.cs)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="0d144-190">Test di`UserInformation.aspx`pagina</span><span class="sxs-lookup"><span data-stu-id="0d144-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="0d144-191">In questi gestori eventi posto, visitare di nuovo la pagina e non approvato un utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="0d144-192">Come illustrato nella figura 3, verrà visualizzato una breve messaggio nella pagina indicante che l'utente `IsApproved` proprietà è stata modificata correttamente.</span><span class="sxs-lookup"><span data-stu-id="0d144-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>


<span data-ttu-id="0d144-193">[![Chris è stato Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span></span>

<span data-ttu-id="0d144-194">**Figura 3**: Chris è stato Unapproved ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span></span>


<span data-ttu-id="0d144-195">Successivamente, disconnessione e provare a eseguire l'accesso come utente con un account è stato semplicemente non approvati.</span><span class="sxs-lookup"><span data-stu-id="0d144-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="0d144-196">Poiché l'utente non viene approvata, essi non è possibile eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="0d144-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="0d144-197">Per impostazione predefinita, il controllo Login consente di visualizzare lo stesso messaggio se l'utente non è possibile eseguire l'accesso, indipendentemente dal motivo.</span><span class="sxs-lookup"><span data-stu-id="0d144-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="0d144-198">Ma nel <a id="Tutorial6"> </a> [ *convalida utente credenziali contro l'appartenenza utente Store* ](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) esercitazione è stata esaminata migliorando il controllo di accesso per visualizzare un messaggio più appropriato.</span><span class="sxs-lookup"><span data-stu-id="0d144-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="0d144-199">Come illustrato nella figura 4, Chris viene visualizzata un messaggio che spiega che egli non può eseguire l'accesso perché il suo account non è ancora approvati.</span><span class="sxs-lookup"><span data-stu-id="0d144-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>


<span data-ttu-id="0d144-200">[![Chris non è possibile perché His Account di accesso è non approvato](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span></span>

<span data-ttu-id="0d144-201">**Figura 4**: Chris non è possibile perché His Account di accesso è non approvati ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span></span>


<span data-ttu-id="0d144-202">Per testare la funzionalità di bloccata, provare a eseguire l'accesso come utente autorizzato, ma usare una password errata.</span><span class="sxs-lookup"><span data-stu-id="0d144-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="0d144-203">Ripetere questo processo il numero di volte fino a quando non è stato bloccato l'account utente necessari. Il controllo di accesso è stato inoltre aggiornato per mostrare un personalizzato il messaggio se il tentativo di eseguire l'accesso da un account bloccato.</span><span class="sxs-lookup"><span data-stu-id="0d144-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="0d144-204">Si sa che un account è stato bloccato dopo aver avviato il seguente messaggio viene visualizzato nella pagina di accesso: "L'account è stato bloccato a causa di troppi tentativi di accesso non è valido.</span><span class="sxs-lookup"><span data-stu-id="0d144-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="0d144-205">Contattare l'amministratore per l'account sbloccato."</span><span class="sxs-lookup"><span data-stu-id="0d144-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="0d144-206">Tornare al `ManageUsers.aspx` pagina e fare clic sul collegamento Manage per l'utente bloccato.</span><span class="sxs-lookup"><span data-stu-id="0d144-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="0d144-207">Come illustrato nella figura 5, si dovrebbe essere un valore nel `LastLockedOutDateLabel` pulsante Sblocca utente deve essere abilitato.</span><span class="sxs-lookup"><span data-stu-id="0d144-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="0d144-208">Fare clic sul pulsante Sblocca utente per sbloccare l'account utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="0d144-209">Dopo aver sbloccato l'utente, saranno in grado di accedere di nuovo.</span><span class="sxs-lookup"><span data-stu-id="0d144-209">Once you have unlocked the user, they will be able to login again.</span></span>


<span data-ttu-id="0d144-210">[![Dave è stato bloccato dal sistema](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span></span>

<span data-ttu-id="0d144-211">**Figura 5**: Dave è stata bloccata Out del sistema ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span></span>


## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="0d144-212">Passaggio 2: Specifica di nuovi utenti approvati stato</span><span class="sxs-lookup"><span data-stu-id="0d144-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="0d144-213">Lo stato approvato è utile in scenari in cui si vuole che un'azione da eseguire prima un nuovo utente è in grado di eseguire l'accesso e accedere alle funzionalità specifiche dell'utente del sito.</span><span class="sxs-lookup"><span data-stu-id="0d144-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="0d144-214">Ad esempio, si potrebbe essere in esecuzione un sito Web privato in cui tutte le pagine, fatta eccezione per le pagine di accesso e l'iscrizione, sono accessibili solo agli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="0d144-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="0d144-215">Ma cosa accade se un estraneo raggiunge il sito Web, consente di trovare la pagina di iscrizione e crea un account?</span><span class="sxs-lookup"><span data-stu-id="0d144-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="0d144-216">Per evitare questa situazione è possibile spostare la pagina di iscrizione per un `Administration` cartella e richiede che un amministratore crei manualmente ogni account.</span><span class="sxs-lookup"><span data-stu-id="0d144-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="0d144-217">In alternativa, è possibile consentire tutti gli utenti per l'iscrizione, ma non consentono l'accesso al sito fino a quando un amministratore ha approvato l'account utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="0d144-218">Per impostazione predefinita, il controllo CreateUserWizard Approva nuovi account.</span><span class="sxs-lookup"><span data-stu-id="0d144-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="0d144-219">È possibile configurare questo comportamento usando il controllo [ `DisableCreatedUser` proprietà](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d144-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="0d144-220">Impostare questa proprietà su `true` di non approvare i nuovi account utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-220">Set this property to `true` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="0d144-221">Per impostazione predefinita il controllo CreateUserWizard accede automaticamente al nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="0d144-222">Questo comportamento è determinato del controllo [ `LoginCreatedUser` proprietà](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d144-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="0d144-223">Poiché non approvati utenti non possono accedere al sito, quando `DisableCreatedUser` viene `true` il nuovo account utente non è connesso al sito, indipendentemente dal valore della `LoginCreatedUser` proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `true` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>


<span data-ttu-id="0d144-224">Se si crea a livello di codice nuovi account utente tramite il `Membership.CreateUser` metodi, per creare un account utente non approvate di usare uno degli overload che accettano il nuovo utente `IsApproved` valore della proprietà come un parametro di input.</span><span class="sxs-lookup"><span data-stu-id="0d144-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="0d144-225">Passaggio 3: L'approvazione degli utenti tramite la verifica indirizzo di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="0d144-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="0d144-226">Molti siti Web che supportano gli account utente non si approva i nuovi utenti fino a quando non si verifica l'indirizzo di posta elettronica che vengono forniti durante la registrazione.</span><span class="sxs-lookup"><span data-stu-id="0d144-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="0d144-227">Questo processo di verifica viene comunemente utilizzato per contrastare Bot, gli spammer e altri ne'er-do-wells perché richiede un indirizzo di posta elettronica univoco e soggetti a verifica e aggiunge un ulteriore passaggio nel processo di iscrizione.</span><span class="sxs-lookup"><span data-stu-id="0d144-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="0d144-228">Con questo modello, quando un nuovo utente effettua l'iscrizione vengono inviati un messaggio di posta elettronica che include un collegamento a una pagina di verifica.</span><span class="sxs-lookup"><span data-stu-id="0d144-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="0d144-229">Visitando il collegamento utente ha dimostrato che ricevono il messaggio di posta elettronica e, pertanto, che l'indirizzo e-mail fornito sia valido.</span><span class="sxs-lookup"><span data-stu-id="0d144-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="0d144-230">La pagina di verifica è responsabile per l'approvazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="0d144-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="0d144-231">Ciò può verificarsi automaticamente, in tal modo l'approvazione di tutti gli utenti che raggiungono questa pagina, o solo dopo che l'utente fornisce informazioni aggiuntive, ad esempio un [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="0d144-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="0d144-232">Per ospitare il flusso di lavoro, è necessario innanzitutto aggiornare la pagina di creazione di account in modo che i nuovi utenti siano non approvati.</span><span class="sxs-lookup"><span data-stu-id="0d144-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="0d144-233">Aprire il `EnhancedCreateUserWizard.aspx` nella pagina la `Membership` cartella e dell'impostare il controllo CreateUserWizard `DisableCreatedUser` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="0d144-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `true`.</span></span>

<span data-ttu-id="0d144-234">Successivamente, è necessario configurare il controllo CreateUserWizard per inviare un messaggio di posta elettronica al nuovo utente con istruzioni su come verificare il proprio account.</span><span class="sxs-lookup"><span data-stu-id="0d144-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="0d144-235">In particolare, si includerà un collegamento nel messaggio di posta elettronica per il `Verification.aspx` pagina (che dobbiamo ancora creare), passando il nuovo utente `UserId` tramite la stringa di query.</span><span class="sxs-lookup"><span data-stu-id="0d144-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="0d144-236">Il `Verification.aspx` pagina verrà cercare l'utente specificato e contrassegnarli approvati.</span><span class="sxs-lookup"><span data-stu-id="0d144-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="0d144-237">L'invio di un messaggio di verifica per i nuovi utenti</span><span class="sxs-lookup"><span data-stu-id="0d144-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="0d144-238">Per inviare un messaggio di posta elettronica dal controllo CreateUserWizard, configurare relativo `MailDefinition` proprietà in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="0d144-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="0d144-239">Come descritto nel <a id="Tutorial13"> </a> [esercitazione precedente](recovering-and-changing-passwords-cs.md), i controlli ChangePassword e PassaggiwordRecovery includono una [ `MailDefinition` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) che funziona in modo analogo CreateUserWizard del controllo.</span><span class="sxs-lookup"><span data-stu-id="0d144-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-cs.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="0d144-240">Usare la `MailDefinition` opzioni di proprietà è necessario specificare il recapito della posta in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="0d144-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="0d144-241">Per altre informazioni, consultare [l'invio di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="0d144-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>


<span data-ttu-id="0d144-242">Iniziare creando un nuovo modello di messaggio di posta elettronica denominato `CreateUserWizard.txt` nella `EmailTemplates` cartella.</span><span class="sxs-lookup"><span data-stu-id="0d144-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="0d144-243">Per il modello, usare il testo seguente:</span><span class="sxs-lookup"><span data-stu-id="0d144-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-cs/samples/sample3.aspx)]

<span data-ttu-id="0d144-244">Impostare il `MailDefinition'` s `BodyFileName` proprietà su "~ / EmailTemplates/CreateUserWizard.txt" e il relativo `Subject` proprietà su "Benvenuti nel sito Web.</span><span class="sxs-lookup"><span data-stu-id="0d144-244">Set the `MailDefinition'` s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="0d144-245">Attivare l'account."</span><span class="sxs-lookup"><span data-stu-id="0d144-245">Please activate your account."</span></span>

<span data-ttu-id="0d144-246">Si noti che il `CreateUserWizard.txt` modello di messaggio di posta elettronica include un `<%VerificationUrl%>` segnaposto.</span><span class="sxs-lookup"><span data-stu-id="0d144-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="0d144-247">Si tratta di dove l'URL per il `Verification.aspx` pagina verrà inserita.</span><span class="sxs-lookup"><span data-stu-id="0d144-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="0d144-248">CreateUserWizard sostituisce automaticamente il `<%UserName%>` e `<%Password%>` segnaposto con il nuovo account nome utente e password, ma non esiste alcun incorporati `<%VerificationUrl%>` segnaposto.</span><span class="sxs-lookup"><span data-stu-id="0d144-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="0d144-249">È necessario sostituire manualmente con l'URL di verifica appropriati.</span><span class="sxs-lookup"><span data-stu-id="0d144-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="0d144-250">A tale scopo, creare un gestore eventi per il CreateUserWizard [ `SendingMail` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d144-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample4.cs)]

<span data-ttu-id="0d144-251">Il `SendingMail` evento viene generato dopo il `CreatedUser` evento, vale a dire che nel momento in cui il gestore dell'evento precedente esegue il nuovo utente account sia già stato creato.</span><span class="sxs-lookup"><span data-stu-id="0d144-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="0d144-252">È possibile accedere del nuovo utente `UserId` valore chiamando il `Membership.GetUser` metodo, passando il `UserName` immessi nel controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="0d144-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="0d144-253">Successivamente, l'URL di verifica è nel formato corretto.</span><span class="sxs-lookup"><span data-stu-id="0d144-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="0d144-254">L'istruzione `Request.Url.GetLeftPart(UriPartial.Authority)` restituisce il `http://yourserver.com` parte dell'URL; `Request.ApplicationPath` restituisce il percorso in cui è possibile eseguire l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0d144-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="0d144-255">La verifica URL viene quindi definito come `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="0d144-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="0d144-256">Questi due stringhe vengono quindi concatenate per comporre l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="0d144-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="0d144-257">Infine, il corpo del messaggio di posta elettronica (`e.Message.Body`) ha tutte le occorrenze di `<%VerificationUrl%>` sostituito con l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="0d144-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="0d144-258">Il risultato finale è che i nuovi utenti siano non approvati, vale a dire che essi non possono accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="0d144-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="0d144-259">Inoltre, essi vengono inviati automaticamente un messaggio di posta elettronica con un collegamento all'URL di verifica (vedere la figura 6).</span><span class="sxs-lookup"><span data-stu-id="0d144-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>


<span data-ttu-id="0d144-260">[![Il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span></span>

<span data-ttu-id="0d144-261">**Figura 6**: Il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="0d144-262">Passaggio CreateUserWizard predefinito del controllo CreateUserWizard consente di visualizzare un messaggio che informa l'utente il proprio account è stato creato e viene visualizzato un pulsante Continua.</span><span class="sxs-lookup"><span data-stu-id="0d144-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="0d144-263">Facendo clic su questa indirizza l'utente all'URL specificato per il controllo `ContinueDestinationPageUrl` proprietà.</span><span class="sxs-lookup"><span data-stu-id="0d144-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="0d144-264">CreateUserWizard nella `EnhancedCreateUserWizard.aspx` è configurato per l'invio di nuovi utenti per il `~/Membership/AdditionalUserInfo.aspx`, che richiede all'utente le città di residenza, URL della home page e firma.</span><span class="sxs-lookup"><span data-stu-id="0d144-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="0d144-265">Poiché queste informazioni possono essere aggiunti solo da utenti connessi, è opportuno aggiornare questa proprietà per l'invio agli utenti di tornare alla home page del sito (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="0d144-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="0d144-266">Inoltre, il `EnhancedCreateUserWizard.aspx` pagina o il passaggio CreateUserWizard deve essere ampliata in modo da informare l'utente che sono stati inviati un messaggio di verifica e l'account non verranno attivato fino a quando non seguono le istruzioni riportate in questo messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0d144-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="0d144-267">Queste modifiche lascia come esercizio per il lettore.</span><span class="sxs-lookup"><span data-stu-id="0d144-267">I leave these modifications as an exercise for the reader.</span></span>


### <a name="creating-the-verification-page"></a><span data-ttu-id="0d144-268">Creazione della pagina di verifica</span><span class="sxs-lookup"><span data-stu-id="0d144-268">Creating the Verification Page</span></span>

<span data-ttu-id="0d144-269">L'attività finale consiste nel creare il `Verification.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="0d144-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="0d144-270">Aggiungere questa pagina per la cartella radice, associandolo al `Site.master` pagina master.</span><span class="sxs-lookup"><span data-stu-id="0d144-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="0d144-271">Come illustrato con la maggior parte delle pagine di contenuto precedente aggiunte al sito, rimuovere il controllo contenuto che fa riferimento il `LoginContent` ContentPlaceHolder in modo che la pagina di contenuto Usa la pagina master di contenuto predefinito.</span><span class="sxs-lookup"><span data-stu-id="0d144-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="0d144-272">Aggiungere un controllo Web Label per il `Verification.aspx` pagina, impostare relativi `ID` a `StatusMessage` e cancellare la relativa proprietà text.</span><span class="sxs-lookup"><span data-stu-id="0d144-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="0d144-273">A questo punto, creare il `Page_Load` gestore dell'evento e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0d144-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample5.cs)]

<span data-ttu-id="0d144-274">La maggior parte del codice precedente verifica che il `UserId` fornito tramite il parametro querystring esista, che è un valido `Guid` valore e che fa riferimento a un account utente esistente.</span><span class="sxs-lookup"><span data-stu-id="0d144-274">The bulk of the above code verifies that the `UserId` supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="0d144-275">Se tutti questi controlli di esito positivo, l'account utente è approvato; in caso contrario, viene visualizzato un messaggio di stato appropriato.</span><span class="sxs-lookup"><span data-stu-id="0d144-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="0d144-276">Figura 7 mostra il `Verification.aspx` pagina quando visitati tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0d144-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>


<span data-ttu-id="0d144-277">[![Il Account utente nuovo viene ora approvata](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0d144-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span></span>

<span data-ttu-id="0d144-278">**Figura 7**: Il Account utente nuovo viene ora approvate ([fare clic per visualizzare l'immagine con dimensioni normali](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0d144-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span></span>


## <a name="summary"></a><span data-ttu-id="0d144-279">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="0d144-279">Summary</span></span>

<span data-ttu-id="0d144-280">Tutti gli account utente di appartenenza dispongano di due stati che determinano se l'utente può accedere al sito: `IsLockedOut` e `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="0d144-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="0d144-281">Entrambe queste proprietà devono essere `true` per l'utente all'account di accesso.</span><span class="sxs-lookup"><span data-stu-id="0d144-281">Both of these properties must be `true` for the user to login.</span></span>

<span data-ttu-id="0d144-282">L'utente del blocco dello stato viene usato come misura di sicurezza per ridurre la probabilità che un pirata informatico suddividendo in un sito tramite i metodi di attacco di forza bruta.</span><span class="sxs-lookup"><span data-stu-id="0d144-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="0d144-283">In particolare, un utente viene bloccato se sono presenti un certo numero di tentativi di accesso non valido all'interno di un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="0d144-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="0d144-284">Questi limiti possono essere configurati tramite le impostazioni del provider di appartenenza in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="0d144-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="0d144-285">Lo stato approvato viene comunemente usato come mezzo per impedire l'accesso fino a quando non è verificata un'azione di nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="0d144-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="0d144-286">Ad esempio il sito Web richiede che i nuovi account prima di tutto devono essere approvate dall'amministratore o, come mostrato nel passaggio 3, tramite la verifica indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0d144-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="0d144-287">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="0d144-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="0d144-288">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="0d144-288">About the Author</span></span>

<span data-ttu-id="0d144-289">Scott Mitchell, autore di più libri e fondatore di 4GuysFromRolla.com, ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="0d144-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0d144-290">Lavora come un consulente, formatore e autore.</span><span class="sxs-lookup"><span data-stu-id="0d144-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0d144-291">Il suo ultimo libro si intitola  *[Sams Teach Yourself ASP.NET 2.0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="0d144-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="0d144-292">È possibile contattarlo Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o il suo blog all'indirizzo [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="0d144-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="0d144-293">Ringraziamenti speciali...</span><span class="sxs-lookup"><span data-stu-id="0d144-293">Special Thanks To…</span></span>

<span data-ttu-id="0d144-294">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="0d144-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0d144-295">Se si è interessati prossimi articoli MSDN dello?</span><span class="sxs-lookup"><span data-stu-id="0d144-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0d144-296">In questo caso, Inviami un messaggio nella [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0d144-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0d144-297">[Precedente](recovering-and-changing-passwords-cs.md)
> [Successivo](building-an-interface-to-select-one-user-account-from-many-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0d144-297">[Previous](recovering-and-changing-passwords-cs.md)
[Next](building-an-interface-to-select-one-user-account-from-many-vb.md)</span></span>
