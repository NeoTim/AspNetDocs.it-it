---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: Recupero e modifica delle password (C#) | Microsoft Docs
author: rick-anderson
description: ASP.NET include due controlli Web che consentono di recuperare e modificare le password. Il controllo PasswordRecovery consente a un visitatore di recuperare il suo PA perso...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: 8c07b8a3c36e4863c6d2d356b8483544ac4cafeb
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78566878"
---
# <a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="c08a6-104">Recupero e modifica delle password (C#)</span><span class="sxs-lookup"><span data-stu-id="c08a6-104">Recovering and Changing Passwords (C#)</span></span>

<span data-ttu-id="c08a6-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c08a6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c08a6-106">[Scarica codice](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) o [Scarica PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="c08a6-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="c08a6-107">ASP.NET include due controlli Web che consentono di recuperare e modificare le password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c08a6-108">Il controllo PasswordRecovery consente a un visitatore di recuperare la password persa.</span><span class="sxs-lookup"><span data-stu-id="c08a6-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c08a6-109">Il controllo ChangePassword consente all'utente di aggiornare la propria password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c08a6-110">Analogamente agli altri controlli Web correlati all'accesso che abbiamo visto in questa serie di esercitazioni, i controlli PasswordRecovery e ChangePassword funzionano con il Framework di appartenenza dietro le quinte per reimpostare o modificare le password degli utenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

## <a name="introduction"></a><span data-ttu-id="c08a6-111">Introduzione</span><span class="sxs-lookup"><span data-stu-id="c08a6-111">Introduction</span></span>

<span data-ttu-id="c08a6-112">Tra i siti Web per la mia banca, l'azienda di utilità, la società telefonica, gli account di posta elettronica e i portali Web personalizzati, I, come la maggior parte delle persone, hanno dozzine di password diverse da ricordare.</span><span class="sxs-lookup"><span data-stu-id="c08a6-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="c08a6-113">Con un numero così elevato di credenziali per memorizzare questi giorni, non è insolito che gli utenti dimentichino la propria password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="c08a6-114">Per tenere conto di questo, i siti Web che offrono account utente devono includere un modo per consentire a un utente di recuperare la propria password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="c08a6-115">Questo processo in genere comporta la generazione di una nuova password casuale e l'invio di un messaggio di posta elettronica all'indirizzo di posta elettronica dell'utente nel file.</span><span class="sxs-lookup"><span data-stu-id="c08a6-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="c08a6-116">Una volta ricevuta la nuova password, la maggior parte degli utenti torna al sito e cambia la password da quella generata in modo casuale a una più memorabile.</span><span class="sxs-lookup"><span data-stu-id="c08a6-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="c08a6-117">ASP.NET include due controlli Web che consentono di recuperare e modificare le password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c08a6-118">Il controllo PasswordRecovery consente a un visitatore di recuperare la password persa.</span><span class="sxs-lookup"><span data-stu-id="c08a6-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c08a6-119">Il controllo ChangePassword consente all'utente di aggiornare la propria password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c08a6-120">Analogamente agli altri controlli Web correlati all'accesso che abbiamo visto in questa serie di esercitazioni, i controlli PasswordRecovery e ChangePassword funzionano con il Framework di appartenenza dietro le quinte per reimpostare o modificare le password degli utenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="c08a6-121">In questa esercitazione verrà esaminato l'utilizzo di questi due controlli.</span><span class="sxs-lookup"><span data-stu-id="c08a6-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="c08a6-122">Si vedrà anche come modificare e reimpostare a livello di codice la password di un utente tramite i metodi `ChangePassword` e `ResetPassword` della classe `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="c08a6-123">Passaggio 1: consentire agli utenti di recuperare le password perse</span><span class="sxs-lookup"><span data-stu-id="c08a6-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="c08a6-124">Tutti i siti Web che supportano gli account utente devono fornire agli utenti un meccanismo per il recupero delle password dimenticate.</span><span class="sxs-lookup"><span data-stu-id="c08a6-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="c08a6-125">La novità è che l'implementazione di tale funzionalità in ASP.NET è una brezza grazie al controllo Web PasswordRecovery.</span><span class="sxs-lookup"><span data-stu-id="c08a6-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="c08a6-126">Il controllo PasswordRecovery esegue il rendering di un'interfaccia che richiede all'utente il nome utente e, se necessario, la risposta alla domanda di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="c08a6-127">Invia quindi un email all'utente per la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-128">Poiché i messaggi di posta elettronica vengono trasmessi in rete in testo normale, vi sono rischi per la sicurezza di inviare la password di un utente tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c08a6-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>

<span data-ttu-id="c08a6-129">Il controllo PasswordRecovery è costituito da tre visualizzazioni:</span><span class="sxs-lookup"><span data-stu-id="c08a6-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="c08a6-130">**Nome utente** : richiede al visitatore il nome utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="c08a6-131">Questa è la visualizzazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="c08a6-131">This is the initial view.</span></span>
- <span data-ttu-id="c08a6-132">**Domanda**: Visualizza il nome utente e la domanda di sicurezza come testo, insieme a una casella di testo in cui l'utente deve immettere la risposta alla domanda di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="c08a6-133">**Operazione completata**: Visualizza un messaggio che informa l'utente che la password è stata inviata tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c08a6-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="c08a6-134">Le visualizzazioni visualizzate e le azioni eseguite dal controllo PasswordRecovery dipendono dalle impostazioni di configurazione di appartenenza seguenti:</span><span class="sxs-lookup"><span data-stu-id="c08a6-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="c08a6-135">L'impostazione `RequiresQuestionAndAnswer` del Framework di appartenenza indica se gli utenti devono specificare una domanda e una risposta di sicurezza per la registrazione per un account.</span><span class="sxs-lookup"><span data-stu-id="c08a6-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="c08a6-136">Come illustrato nell'esercitazione <a id="_msoanchor_1"> </a> [*creazione di account utente*](../membership/creating-user-accounts-cs.md) , se `RequiresQuestionAndAnswer` è true (impostazione predefinita), l'interfaccia di CreateUserWizard include i controlli TextBox per la domanda e la risposta di sicurezza del nuovo utente. Se `RequiresQuestionAndAnswer` è false, non viene raccolta alcuna informazione di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="c08a6-137">Analogamente, se `RequiresQuestionAndAnswer` è true, il controllo PasswordRecovery Visualizza la visualizzazione delle domande dopo che l'utente ha immesso il nome utente. la password viene recuperata solo se l'utente immette la risposta di sicurezza corretta.</span><span class="sxs-lookup"><span data-stu-id="c08a6-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="c08a6-138">Se `RequiresQuestionAndAnswer` è false, tuttavia, il controllo PasswordRecovery si sposta direttamente dalla visualizzazione nome utente alla visualizzazione Operazione riuscita.</span><span class="sxs-lookup"><span data-stu-id="c08a6-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="c08a6-139">Dopo che l'utente ha fornito il nome utente o il nome utente e la risposta di sicurezza, se `RequiresQuestionAndAnswer` è true, PasswordRecovery invia all'utente la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="c08a6-140">Se l'opzione `EnablePasswordRetrieval` è impostata su true, all'utente viene inviato un messaggio di posta elettronica con la password corrente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="c08a6-141">Se è impostato su false e `EnablePasswordReset` è impostato su true, il controllo PasswordRecovery genera una nuova password casuale per l'utente e invia ai messaggi di posta elettronica la nuova password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="c08a6-142">Se sia `EnablePasswordRetrieval` che `EnablePasswordReset` sono false, il controllo PasswordRecovery genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="c08a6-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-143">Ricordare che il `SqlMembershipProvider` archivia le password degli utenti in uno dei tre formati seguenti: Clear, Hashed (impostazione predefinita) o Encrypted.</span><span class="sxs-lookup"><span data-stu-id="c08a6-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="c08a6-144">Il meccanismo di archiviazione utilizzato dipende dalle impostazioni di configurazione dell'appartenenza. l'applicazione demo usa il formato di password con hash.</span><span class="sxs-lookup"><span data-stu-id="c08a6-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="c08a6-145">Quando si utilizza il formato con hash della password, l'opzione `EnablePasswordRetrieval` deve essere impostata su false perché il sistema non è in grado di determinare la password effettiva dell'utente dalla versione con hash archiviata nel database.</span><span class="sxs-lookup"><span data-stu-id="c08a6-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>

<span data-ttu-id="c08a6-146">Nella figura 1 viene illustrato il modo in cui l'interfaccia e il comportamento di PasswordRecovery sono influenzati dalla configurazione dell'appartenenza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>

<span data-ttu-id="c08a6-147">[![RequiresQuestionAndAnswer, EnablePasswordRetrieval e EnablePasswordReset influenzano l'aspetto e il comportamento del controllo PasswordRecovery](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span></span>

<span data-ttu-id="c08a6-148">**Figura 1**: le `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`e `EnablePasswordReset` influenzano l'aspetto e il comportamento del controllo PasswordRecovery ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-149"><a id="_msoanchor_2"> </a>Nell'esercitazione [*creazione dello schema di appartenenza in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) è stato configurato il provider di appartenenze impostando `RequiresQuestionAndAnswer` su true, `EnablePasswordRetrieval` su false e `EnablePasswordReset` su true.</span><span class="sxs-lookup"><span data-stu-id="c08a6-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>

### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="c08a6-150">Uso del controllo PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="c08a6-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="c08a6-151">Esaminiamo ora l'uso del controllo PasswordRecovery in una pagina ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c08a6-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="c08a6-152">Aprire `RecoverPassword.aspx` e trascinare un controllo PasswordRecovery dalla casella degli strumenti nella finestra di progettazione; impostare la relativa `ID` su `RecoverPwd`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="c08a6-153">Analogamente ai controlli Web login e CreateUserWizard, le visualizzazioni del controllo PasswordRecovery eseguono il rendering di un'interfaccia composita avanzata che include etichette, caselle di testo, pulsanti e controlli di convalida.</span><span class="sxs-lookup"><span data-stu-id="c08a6-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="c08a6-154">È possibile personalizzare l'aspetto delle visualizzazioni tramite le proprietà di stile del controllo o convertendo le visualizzazioni in modelli.</span><span class="sxs-lookup"><span data-stu-id="c08a6-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="c08a6-155">Lo lascio come esercizio per il lettore interessato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="c08a6-156">Quando un utente visita la pagina, immetterà il proprio nome utente e fare clic sul pulsante Invia.</span><span class="sxs-lookup"><span data-stu-id="c08a6-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="c08a6-157">Poiché la proprietà `RequiresQuestionAndAnswer` è stata impostata su true nelle impostazioni di configurazione dell'appartenenza, il controllo PasswordRecovery visualizzerà quindi la visualizzazione domanda.</span><span class="sxs-lookup"><span data-stu-id="c08a6-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="c08a6-158">Dopo che l'utente immette la risposta di sicurezza corretta e fa clic su Invia, il controllo PasswordRecovery aggiornerà la password dell'utente a una generata in modo casuale e invierà la password all'indirizzo di posta elettronica nel file.</span><span class="sxs-lookup"><span data-stu-id="c08a6-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="c08a6-159">Tutto ciò era possibile senza dover scrivere una sola riga di codice.</span><span class="sxs-lookup"><span data-stu-id="c08a6-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="c08a6-160">Prima di eseguire il test di questa pagina, è necessario specificare le impostazioni per il recapito della posta in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="c08a6-161">Il controllo PasswordRecovery si basa su queste impostazioni per l'invio del messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c08a6-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="c08a6-162">La configurazione per il recapito tramite posta elettronica viene specificata tramite l' [elemento`<mailSettings>`](https://msdn.microsoft.com/library/w355a94k.aspx)dell' [elemento`<system.net>`](https://msdn.microsoft.com/library/6484zdc1.aspx).</span><span class="sxs-lookup"><span data-stu-id="c08a6-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="c08a6-163">Utilizzare l' [elemento`<smtp>`](https://msdn.microsoft.com/library/ms164240.aspx) per indicare il metodo di recapito e l'indirizzo predefinito da.</span><span class="sxs-lookup"><span data-stu-id="c08a6-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="c08a6-164">Il markup seguente consente di configurare le impostazioni di posta elettronica per l'utilizzo di un server SMTP di rete denominato `smtp.example.com` sulla porta 25 e con le credenziali nome utente e password del nome utente e della password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-165">`<system.net>` è un elemento figlio dell'elemento `<configuration>` radice e un elemento di pari livello di `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="c08a6-166">Pertanto, non inserire l'elemento `<system.net>` all'interno dell'elemento `<system.web>`; è invece necessario inserirlo nello stesso livello.</span><span class="sxs-lookup"><span data-stu-id="c08a6-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>

[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="c08a6-167">Oltre a utilizzare un server SMTP nella rete, è possibile specificare una directory di prelievo in cui devono essere inseriti i messaggi di posta elettronica da inviare.</span><span class="sxs-lookup"><span data-stu-id="c08a6-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="c08a6-168">Una volta configurate le impostazioni SMTP, visitare la pagina `RecoverPassword.aspx` tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="c08a6-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="c08a6-169">Per prima cosa, provare a immettere un nome utente che non esiste nell'archivio utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="c08a6-170">Come illustrato nella figura 2, il controllo PasswordRecovery Visualizza un messaggio che indica che non è possibile accedere alle informazioni utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="c08a6-171">Il testo del messaggio può essere personalizzato tramite la [proprietà`UserNameFailureText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)del controllo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>

<span data-ttu-id="c08a6-172">[![viene visualizzato un messaggio di errore se viene immesso un nome utente non valido](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span></span>

<span data-ttu-id="c08a6-173">**Figura 2**: viene visualizzato un messaggio di errore se viene immesso un nome utente non valido ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>

<span data-ttu-id="c08a6-174">Immettere ora un nome utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-174">Now enter a username.</span></span> <span data-ttu-id="c08a6-175">Usare il nome utente di un account del sistema con un indirizzo di posta elettronica a cui è possibile accedere e di cui si conosce la risposta di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="c08a6-176">Dopo aver immesso il nome utente e aver fatto clic su Submit, il controllo PasswordRecovery Visualizza la visualizzazione della domanda.</span><span class="sxs-lookup"><span data-stu-id="c08a6-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="c08a6-177">Come per la visualizzazione nome utente, se si immette una risposta non corretta, il controllo PasswordRecovery Visualizza un messaggio di errore (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="c08a6-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="c08a6-178">Per personalizzare questo messaggio di errore, utilizzare la [proprietà`QuestionFailureText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c08a6-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>

<span data-ttu-id="c08a6-179">[![viene visualizzato un messaggio di errore se l'utente immette una risposta di sicurezza non valida](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span></span>

<span data-ttu-id="c08a6-180">**Figura 3**: viene visualizzato un messaggio di errore se l'utente immette una risposta di sicurezza non valida ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>

<span data-ttu-id="c08a6-181">Infine, immettere la risposta di sicurezza corretta e fare clic su Submit (Invia).</span><span class="sxs-lookup"><span data-stu-id="c08a6-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="c08a6-182">Dietro le quinte, il controllo PasswordRecovery genera una password casuale, la assegna all'account utente, invia un messaggio di posta elettronica che informa l'utente della nuova password (vedere la figura 4), quindi Visualizza la visualizzazione Operazione riuscita.</span><span class="sxs-lookup"><span data-stu-id="c08a6-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>

<span data-ttu-id="c08a6-183">[![all'utente viene inviato un messaggio di posta elettronica con la nuova password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span></span>

<span data-ttu-id="c08a6-184">**Figura 4**: all'utente viene inviato un messaggio di posta elettronica con la nuova password ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>

### <a name="customizing-the-email"></a><span data-ttu-id="c08a6-185">Personalizzazione del messaggio di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="c08a6-185">Customizing the Email</span></span>

<span data-ttu-id="c08a6-186">Il messaggio di posta elettronica predefinito inviato dal controllo PasswordRecovery è piuttosto noioso (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="c08a6-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="c08a6-187">Il messaggio viene inviato dall'account specificato nell'attributo `from` dell'elemento `<smtp>` con la password dell'oggetto e il corpo del testo normale:</span><span class="sxs-lookup"><span data-stu-id="c08a6-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="c08a6-188">Tornare al sito e accedere usando le informazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="c08a6-189">Nome utente: *username*</span><span class="sxs-lookup"><span data-stu-id="c08a6-189">User Name: *username*</span></span>

<span data-ttu-id="c08a6-190">Password: *password*</span><span class="sxs-lookup"><span data-stu-id="c08a6-190">Password: *password*</span></span>

<span data-ttu-id="c08a6-191">Questo messaggio può essere personalizzato a livello di codice tramite un gestore eventi per l' [evento`SendingMail`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)del controllo PasswordRecovery oppure in modo dichiarativo tramite la [Proprietà`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="c08a6-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="c08a6-192">Si analizzeranno entrambe le opzioni.</span><span class="sxs-lookup"><span data-stu-id="c08a6-192">Let's explore both of these options.</span></span>

<span data-ttu-id="c08a6-193">L'evento `SendingMail` viene generato immediatamente prima dell'invio del messaggio di posta elettronica e rappresenta l'ultima possibilità di modificare a livello di codice il messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c08a6-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="c08a6-194">Quando viene generato questo evento, al gestore dell'evento viene passato un oggetto di tipo [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), la cui proprietà `Message` contiene un riferimento al messaggio di posta elettronica che sta per essere inviato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="c08a6-195">Creare un gestore eventi per l'evento `SendingMail` e aggiungere il codice seguente, che aggiunge `webmaster@example.com` a livello di codice all'elenco CC.</span><span class="sxs-lookup"><span data-stu-id="c08a6-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="c08a6-196">Il messaggio di posta elettronica può essere configurato anche tramite mezzi dichiarativi.</span><span class="sxs-lookup"><span data-stu-id="c08a6-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="c08a6-197">La proprietà `MailDefinition` di PasswordRecovery è un oggetto di tipo [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="c08a6-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="c08a6-198">La classe `MailDefinition` offre un host di proprietà correlate alla posta elettronica, tra cui `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`e altro.</span><span class="sxs-lookup"><span data-stu-id="c08a6-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="c08a6-199">Per i principianti, impostare la [proprietà`Subject`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) su un elemento più descrittivo rispetto a quello usato per impostazione predefinita (password), ad esempio la password è stata reimpostata...</span><span class="sxs-lookup"><span data-stu-id="c08a6-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="c08a6-200">Per personalizzare il corpo del messaggio di posta elettronica, è necessario creare un file di modello di posta elettronica separato che contenga il contenuto del corpo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="c08a6-201">Per iniziare, creare una nuova cartella nel sito Web denominato `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="c08a6-202">Aggiungere quindi un nuovo file di testo a questa cartella denominata `PasswordRecovery.txt` e aggiungere il contenuto seguente:</span><span class="sxs-lookup"><span data-stu-id="c08a6-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="c08a6-203">Si noti l'uso dei segnaposto `<%UserName%>` e `<%Password%>`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="c08a6-204">Il controllo PasswordRecovery sostituisce automaticamente questi due segnaposto con il nome utente e la password recuperati prima di inviare il messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c08a6-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="c08a6-205">Infine, puntare la [proprietà`BodyFileName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) del `MailDefinition`al modello di messaggio di posta elettronica appena creato (`~/EmailTemplates/PasswordRecovery.txt`).</span><span class="sxs-lookup"><span data-stu-id="c08a6-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="c08a6-206">Dopo aver apportato queste modifiche, visitare la pagina `RecoverPassword.aspx` e immettere il nome utente e la risposta di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="c08a6-207">Si riceve un messaggio di posta elettronica simile a quello illustrato nella figura 5.</span><span class="sxs-lookup"><span data-stu-id="c08a6-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="c08a6-208">Si noti che `webmaster@example.com` è stato CC e che l'oggetto e il corpo sono stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="c08a6-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>

<span data-ttu-id="c08a6-209">[![l'oggetto, il corpo e l'elenco CC sono stati aggiornati](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span></span>

<span data-ttu-id="c08a6-210">**Figura 5**: l'elenco oggetto, corpo e CC è stato aggiornato ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>

<span data-ttu-id="c08a6-211">Per inviare un set di messaggi di posta elettronica in formato HTML [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) true (il valore predefinito è false) e aggiornare il modello di messaggio di posta elettronica per includere HTML.</span><span class="sxs-lookup"><span data-stu-id="c08a6-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="c08a6-212">La proprietà `MailDefinition` non è univoca per la classe PasswordRecovery.</span><span class="sxs-lookup"><span data-stu-id="c08a6-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="c08a6-213">Come si vedrà nel passaggio 2, il controllo ChangePassword offre anche una proprietà `MailDefinition`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="c08a6-214">Inoltre, il controllo CreateUserWizard include tale proprietà che è possibile configurare per inviare automaticamente un messaggio di posta elettronica di benvenuto ai nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-215">Attualmente non sono presenti collegamenti nel percorso di navigazione a sinistra per raggiungere la pagina `RecoverPassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="c08a6-216">Un utente è interessato a visitare questa pagina solo se non è stato in grado di accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="c08a6-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="c08a6-217">Aggiornare quindi la pagina `Login.aspx` per includere un collegamento alla pagina `RecoverPassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>

### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="c08a6-218">Reimpostazione della password di un utente a livello di codice</span><span class="sxs-lookup"><span data-stu-id="c08a6-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="c08a6-219">Quando si ripristina la password di un utente, il controllo PasswordRecovery chiama il [metodo`ResetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx)dell'oggetto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="c08a6-220">Questo metodo presenta due overload:</span><span class="sxs-lookup"><span data-stu-id="c08a6-220">This method has two overloads:</span></span>

- <span data-ttu-id="c08a6-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** : Reimposta la password di un utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="c08a6-222">Utilizzare questo overload se `RequiresQuestionAndAnswer` è false.</span><span class="sxs-lookup"><span data-stu-id="c08a6-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="c08a6-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** : Reimposta la password di un utente solo se la *securityAnswer* fornita è corretta.</span><span class="sxs-lookup"><span data-stu-id="c08a6-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="c08a6-224">Utilizzare questo overload se `RequiresQuestionAndAnswer` è true.</span><span class="sxs-lookup"><span data-stu-id="c08a6-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="c08a6-225">Entrambi gli overload restituiscono la nuova password generata in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="c08a6-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="c08a6-226">Analogamente agli altri metodi del Framework di appartenenza, il `ResetPassword` metodo delega al provider configurato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="c08a6-227">Il `SqlMembershipProvider` richiama il stored procedure di `aspnet_Membership_ResetPassword`, passando il nome utente dell'utente, la nuova password e la risposta alla password fornita, tra gli altri campi.</span><span class="sxs-lookup"><span data-stu-id="c08a6-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="c08a6-228">Il stored procedure garantisce che la risposta alla password corrisponda, quindi aggiorna la password dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="c08a6-229">Alcune note sull'implementazione di basso livello:</span><span class="sxs-lookup"><span data-stu-id="c08a6-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="c08a6-230">Un utente bloccato non può reimpostare la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="c08a6-231">Tuttavia, un utente non approvato può.</span><span class="sxs-lookup"><span data-stu-id="c08a6-231">However, an unapproved user may.</span></span> <span data-ttu-id="c08a6-232">Gli stati bloccati e approvati verranno illustrati più dettagliatamente nell' <a id="_msoanchor_3"> </a>esercitazione [*sblocco e approvazione*](unlocking-and-approving-user-accounts-cs.md) degli account utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="c08a6-233">Se la risposta alla password non è corretta, viene incrementato il numero di tentativi di risposta alla password non riusciti dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="c08a6-234">Se si verifica un numero specificato di tentativi di risposta di sicurezza non validi entro un intervallo di tempo specificato, l'utente viene bloccato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="c08a6-235">Una parola sulla modalità di generazione delle password casuali</span><span class="sxs-lookup"><span data-stu-id="c08a6-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="c08a6-236">Le password generate in modo casuale visualizzate nei messaggi di posta elettronica nelle figure 4 e 5 vengono create dal [metodo`GeneratePassword`](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)della classe di appartenenza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="c08a6-237">Questo metodo accetta due valori integer parametri- *length* e *numberOfNonAlphanumericCharacters* -e restituisce una stringa di *lunghezza* minima di caratteri con almeno *numberOfNonAlphanumericCharacters* di caratteri non alfanumerici.</span><span class="sxs-lookup"><span data-stu-id="c08a6-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="c08a6-238">Quando questo metodo viene chiamato dall'interno delle classi di appartenenza o dei controlli Web correlati all'accesso, i valori per questi due parametri sono determinati dalle proprietà `MinRequiredPasswordLength` e `MinRequiredNonalphanumericCharacters` della configurazione di appartenenza, che vengono impostate rispettivamente su 7 e 1.</span><span class="sxs-lookup"><span data-stu-id="c08a6-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="c08a6-239">Il metodo `GeneratePassword` usa un generatore di numeri casuali crittograficamente sicuro per assicurarsi che non esistano distorsioni nei caratteri casuali selezionati.</span><span class="sxs-lookup"><span data-stu-id="c08a6-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="c08a6-240">Inoltre, `GeneratePassword` è `public`, vale a dire che è possibile usarlo direttamente dall'applicazione ASP.NET se è necessario generare stringhe o password casuali.</span><span class="sxs-lookup"><span data-stu-id="c08a6-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-241">La classe `SqlMembershipProvider` genera sempre una password casuale di almeno 14 caratteri, pertanto se `MinRequiredPasswordLength` è inferiore a 14, il valore viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>

## <a name="step-2-changing-passwords"></a><span data-ttu-id="c08a6-242">Passaggio 2: modifica delle password</span><span class="sxs-lookup"><span data-stu-id="c08a6-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="c08a6-243">Le password generate in modo casuale sono difficili da ricordare.</span><span class="sxs-lookup"><span data-stu-id="c08a6-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="c08a6-244">Si consideri la password illustrata nella figura 4: `WWGUZv(f2yM:Bd`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="c08a6-245">Provare a eseguire il commit della memoria.</span><span class="sxs-lookup"><span data-stu-id="c08a6-245">Try committing that to memory!</span></span> <span data-ttu-id="c08a6-246">Inutile dire che, dopo che un utente ha inviato una password generata in modo casuale di questo tipo, potrà modificare la password in modo più memorabile.</span><span class="sxs-lookup"><span data-stu-id="c08a6-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="c08a6-247">Utilizzare il controllo ChangePassword per creare un'interfaccia che consentirà a un utente di modificare la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="c08a6-248">Analogamente al controllo PasswordRecovery, il controllo ChangePassword è costituito da due visualizzazioni: Change password e Success.</span><span class="sxs-lookup"><span data-stu-id="c08a6-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="c08a6-249">La visualizzazione cambia password richiede all'utente le password precedenti e nuove.</span><span class="sxs-lookup"><span data-stu-id="c08a6-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="c08a6-250">Quando si specifica la password precedente corretta e una nuova password che soddisfa i requisiti di lunghezza minima e caratteri non alfanumerici, il controllo ChangePassword aggiorna la password dell'utente e visualizza la visualizzazione Operazione riuscita.</span><span class="sxs-lookup"><span data-stu-id="c08a6-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-251">Il controllo ChangePassword modifica la password dell'utente richiamando il [metodo`ChangePassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx)dell'oggetto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="c08a6-252">Il metodo ChangePassword accetta due `string` parametri di input, *oldPassword* e *newPassword*, e aggiorna l'account dell'utente con il *newPassword*, supponendo che il *oldPassword* fornito sia corretto.</span><span class="sxs-lookup"><span data-stu-id="c08a6-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>

<span data-ttu-id="c08a6-253">Aprire la pagina `ChangePassword.aspx` e aggiungere un controllo ChangePassword alla pagina, denominarlo `ChangePwd`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="c08a6-254">A questo punto, nella visualizzazione progettazione dovrebbe essere visualizzata la visualizzazione cambia password (vedere la figura 6).</span><span class="sxs-lookup"><span data-stu-id="c08a6-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="c08a6-255">Analogamente al controllo PasswordRecovery, è possibile passare da una visualizzazione all'altra tramite lo smart tag del controllo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="c08a6-256">Inoltre, questi aspetti delle visualizzazioni sono personalizzabili tramite le proprietà di stile assorted o mediante la conversione in un modello.</span><span class="sxs-lookup"><span data-stu-id="c08a6-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>

<span data-ttu-id="c08a6-257">[![aggiungere un controllo ChangePassword alla pagina](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span></span>

<span data-ttu-id="c08a6-258">**Figura 6**: aggiungere un controllo ChangePassword alla pagina ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>

<span data-ttu-id="c08a6-259">Il controllo ChangePassword può aggiornare la password dell'utente attualmente connesso *o* la password di un altro utente specificato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="c08a6-260">Come illustrato nella figura 6, la visualizzazione predefinita per la modifica della password consente di eseguire solo tre controlli TextBox: uno per la vecchia password e due per la nuova password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="c08a6-261">Questa interfaccia predefinita viene usata per aggiornare la password dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="c08a6-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="c08a6-262">Per utilizzare il controllo ChangePassword per aggiornare la password di un altro utente, impostare la [proprietà`DisplayUserName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) del controllo su true.</span><span class="sxs-lookup"><span data-stu-id="c08a6-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="c08a6-263">In questo modo viene aggiunta una quarta casella di testo alla pagina, in cui viene richiesto il nome utente dell'utente la cui password deve essere modificata.</span><span class="sxs-lookup"><span data-stu-id="c08a6-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="c08a6-264">L'impostazione di `DisplayUserName` su true è utile se si desidera consentire a un utente disconnesso di modificare la password senza dover effettuare l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c08a6-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="c08a6-265">Personalmente, penso che non ci siano problemi a richiedere a un utente di effettuare l'accesso prima di consentire la modifica della password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="c08a6-266">Lasciare quindi `DisplayUserName` impostato su false (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="c08a6-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="c08a6-267">Per prendere questa decisione, tuttavia, gli utenti anonimi non possono raggiungere questa pagina.</span><span class="sxs-lookup"><span data-stu-id="c08a6-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="c08a6-268">Aggiornare le regole di autorizzazione dell'URL del sito in modo da impedire agli utenti anonimi di visitare `ChangePassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="c08a6-269">Se è necessario aggiornare la memoria nella sintassi della regola di <a id="_msoanchor_4"> </a>autorizzazione dell'URL, fare riferimento all'esercitazione sull' [*autorizzazione basata sull'utente*](../membership/user-based-authorization-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="c08a6-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-270">Potrebbe sembrare che la proprietà `DisplayUserName` sia utile per consentire agli amministratori di modificare le password di altri utenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="c08a6-271">Tuttavia, anche quando `DisplayUserName` è impostato su true, è necessario conoscere e immettere la password precedente corretta.</span><span class="sxs-lookup"><span data-stu-id="c08a6-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="c08a6-272">Si parlerà di tecniche che consentono agli amministratori di modificare le password degli utenti nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="c08a6-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>

<span data-ttu-id="c08a6-273">Visitare la pagina `ChangePassword.aspx` tramite un browser e modificare la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="c08a6-274">Si noti che viene visualizzato un messaggio di errore se si immette una nuova password che non soddisfa i requisiti per la lunghezza della password e i caratteri non alfanumerici specificati nella configurazione delle appartenenze (vedere la figura 7).</span><span class="sxs-lookup"><span data-stu-id="c08a6-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>

<span data-ttu-id="c08a6-275">[![aggiungere un controllo ChangePassword alla pagina](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span></span>

<span data-ttu-id="c08a6-276">**Figura 7**: aggiungere un controllo ChangePassword alla pagina ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>

<span data-ttu-id="c08a6-277">Quando si immette la password precedente corretta e una nuova password valida, la password dell'utente connesso viene modificata e viene visualizzata la visualizzazione Operazione riuscita.</span><span class="sxs-lookup"><span data-stu-id="c08a6-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="c08a6-278">Invio di un messaggio di posta elettronica di conferma</span><span class="sxs-lookup"><span data-stu-id="c08a6-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="c08a6-279">Per impostazione predefinita, il controllo ChangePassword non invia un messaggio di posta elettronica all'utente la cui password è stata appena aggiornata.</span><span class="sxs-lookup"><span data-stu-id="c08a6-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="c08a6-280">Se si vuole inviare un messaggio di posta elettronica, è sufficiente configurare la proprietà `MailDefinition` del controllo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="c08a6-281">Verrà ora configurato il controllo ChangePassword in modo che all'utente venga inviato un messaggio di posta elettronica in formato HTML che contiene la nuova password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="c08a6-282">Per iniziare, creare un nuovo file nella cartella `EmailTemplates` denominata `ChangePassword.htm`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="c08a6-283">Aggiungere il markup seguente:</span><span class="sxs-lookup"><span data-stu-id="c08a6-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="c08a6-284">Impostare quindi le proprietà `BodyFileName`, `IsBodyHtml`e `Subject` della proprietà del `MailDefinition` controllo ChangePassword su ~/EmailTemplates/ChangePassword.htm, true e che la password sia stata modificata. rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="c08a6-285">Dopo aver apportato queste modifiche, rivedere la pagina e modificare di nuovo la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="c08a6-286">Questa volta, il controllo ChangePassword Invia un messaggio di posta elettronica in formato HTML personalizzato all'indirizzo di posta elettronica dell'utente nel file (vedere la figura 8).</span><span class="sxs-lookup"><span data-stu-id="c08a6-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>

<span data-ttu-id="c08a6-287">[![un messaggio di posta elettronica informa l'utente che la password è stata modificata](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span></span>

<span data-ttu-id="c08a6-288">**Figura 8**: un messaggio di posta elettronica informa l'utente che la password è stata modificata ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>

## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="c08a6-289">Passaggio 3: consentire agli amministratori di modificare le password degli utenti</span><span class="sxs-lookup"><span data-stu-id="c08a6-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="c08a6-290">Una funzionalità comune delle applicazioni che supportano gli account utente è la possibilità per un utente amministratore di modificare le password di altri utenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="c08a6-291">Questa funzionalità è a volte necessaria perché il sistema non dispone della possibilità per gli utenti di modificare le proprie password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="c08a6-292">In tal caso, l'unico modo in cui un utente può recuperare la password dimenticata è l'amministratore ad assegnare loro una nuova password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="c08a6-293">Con i controlli PasswordRecovery e ChangePassword, tuttavia, gli utenti amministrativi non devono occuparsi di modificare le password degli utenti, in quanto gli utenti sono in grado di eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="c08a6-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="c08a6-294">Ma cosa succede se il client insiste sul fatto che gli utenti amministratori devono essere in grado di modificare le password degli altri utenti?</span><span class="sxs-lookup"><span data-stu-id="c08a6-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="c08a6-295">Sfortunatamente, l'aggiunta di questa funzionalità può rivelarsi un po' di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c08a6-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="c08a6-296">Per modificare la password di un utente, è necessario fornire la password precedente e la nuova password al metodo `ChangePassword` dell'oggetto `MembershipUser`, ma un amministratore non deve conoscerne la password per modificarlo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="c08a6-297">Una soluzione alternativa consiste nel reimpostare la password dell'utente e quindi modificarla con la nuova password usando un codice simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="c08a6-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="c08a6-298">Questo codice inizia recuperando le informazioni relative al *nome utente*, ovvero l'utente la cui password si desidera modificare.</span><span class="sxs-lookup"><span data-stu-id="c08a6-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="c08a6-299">Viene quindi richiamato il metodo `ResetPassword`, che assegna a e all'utente una nuova password casuale.</span><span class="sxs-lookup"><span data-stu-id="c08a6-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="c08a6-300">Questa password generata in modo casuale viene restituita dal metodo e archiviata nella variabile `resetPwd`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="c08a6-301">Ora che si conosce la password dell'utente, è possibile modificarla tramite una chiamata a `ChangePassword`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="c08a6-302">Il problema è che il codice funziona solo se la configurazione del sistema di appartenenze è impostata in modo tale che `RequiresQuestionAndAnswer` è false.</span><span class="sxs-lookup"><span data-stu-id="c08a6-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="c08a6-303">Se `RequiresQuestionAndAnswer` è true, così com'è con l'applicazione, è necessario che al metodo `ResetPassword` venga passata la risposta di sicurezza. in caso contrario, verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="c08a6-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="c08a6-304">Se il Framework di appartenenza è configurato in modo da richiedere una domanda e una risposta di sicurezza, ma il client insiste sul fatto che gli amministratori sono in grado di modificare le password degli utenti, sono disponibili tre opzioni:</span><span class="sxs-lookup"><span data-stu-id="c08a6-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="c08a6-305">Per comunicare al client che si tratta di un'unica cosa che non è possibile eseguire.</span><span class="sxs-lookup"><span data-stu-id="c08a6-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="c08a6-306">Impostare `RequiresQuestionAndAnswer` su false.</span><span class="sxs-lookup"><span data-stu-id="c08a6-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="c08a6-307">In questo modo si ottiene un'applicazione meno sicura.</span><span class="sxs-lookup"><span data-stu-id="c08a6-307">This results in a less secure application.</span></span> <span data-ttu-id="c08a6-308">Si supponga che un utente nefasto abbia ottenuto l'accesso alla posta in arrivo di un altro utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="c08a6-309">Forse l'utente compromesso ha lasciato la propria scrivania per andare a pranzo e non ha bloccato la workstation o forse ha eseguito l'accesso alla posta elettronica da un terminale pubblico senza disconnettersi. In entrambi i casi, l'utente nefasto può visitare la pagina `RecoverPassword.aspx` e immettere il nome utente dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="c08a6-310">Il sistema invia quindi tramite posta elettronica la password ripristinata senza richiedere la risposta di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c08a6-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="c08a6-311">Ignorare il livello di astrazione creato dal framework di appartenenza e utilizzare direttamente il database SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c08a6-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="c08a6-312">Lo schema di appartenenza include un stored procedure denominato `aspnet_Membership_SetPassword` che imposta la password di un utente e non richiede la risposta di sicurezza o la vecchia password per completare l'attività.</span><span class="sxs-lookup"><span data-stu-id="c08a6-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="c08a6-313">Nessuna di queste opzioni è particolarmente interessante, ma questo è il modo in cui la vita di uno sviluppatore a volte.</span><span class="sxs-lookup"><span data-stu-id="c08a6-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="c08a6-314">Ho implementato il terzo approccio, scrivendo codice che ignora le classi `Membership` e `MembershipUser` e opera direttamente nel database `SecurityTutorials`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-315">Lavorando direttamente con il database, l'incapsulamento fornito dal framework di appartenenza viene frantumato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="c08a6-316">Questa decisione ci lega alla `SqlMembershipProvider`, rendendo il codice meno portabile.</span><span class="sxs-lookup"><span data-stu-id="c08a6-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="c08a6-317">Inoltre, questo codice potrebbe non funzionare come previsto nelle future versioni di ASP.NET se lo schema di appartenenza viene modificato.</span><span class="sxs-lookup"><span data-stu-id="c08a6-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="c08a6-318">Questo approccio è una soluzione alternativa e, come la maggior parte delle soluzioni alternative, non è un esempio di procedure consigliate.</span><span class="sxs-lookup"><span data-stu-id="c08a6-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>

<span data-ttu-id="c08a6-319">Il codice presenta alcuni bit non attraenti ed è molto lungo.</span><span class="sxs-lookup"><span data-stu-id="c08a6-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="c08a6-320">Quindi, non voglio ingombrare questa esercitazione con un esame approfondito del problema.</span><span class="sxs-lookup"><span data-stu-id="c08a6-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="c08a6-321">Se si è interessati a saperne di più, scaricare il codice per questa esercitazione e visitare la pagina `~/Administration/ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="c08a6-322">Questa pagina, creata nell' <a id="_msoanchor_5"> </a> [esercitazione precedente](building-an-interface-to-select-one-user-account-from-many-cs.md), elenca ogni utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="c08a6-323">Il controllo GridView è stato aggiornato in modo da includere un collegamento alla pagina `UserInformation.aspx`, passando il nome utente dell'utente selezionato tramite la QueryString.</span><span class="sxs-lookup"><span data-stu-id="c08a6-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="c08a6-324">Nella pagina `UserInformation.aspx` vengono visualizzate le informazioni sull'utente selezionato e le caselle di testo per la modifica della password (vedere la figura 9).</span><span class="sxs-lookup"><span data-stu-id="c08a6-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="c08a6-325">Dopo aver immesso la nuova password, confermarla nella seconda casella di testo e fare clic sul pulsante Aggiorna utente, viene eseguito un postback e viene richiamato il `aspnet_Membership_SetPassword` stored procedure, che aggiorna la password dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c08a6-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="c08a6-326">I lettori interessati a questa funzionalità possono acquisire familiarità con il codice e provare a estendere la funzionalità per includere l'invio di un messaggio di posta elettronica all'utente la cui password è stata modificata.</span><span class="sxs-lookup"><span data-stu-id="c08a6-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>

<span data-ttu-id="c08a6-327">[![un amministratore può modificare la password di un utente](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c08a6-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span></span>

<span data-ttu-id="c08a6-328">**Figura 9**: un amministratore può modificare la password di un utente ([fare clic per visualizzare l'immagine con dimensioni complete](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c08a6-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c08a6-329">La pagina `UserInformation.aspx` attualmente funziona solo se il Framework di appartenenza è configurato per archiviare le password in formato non crittografato o con hash.</span><span class="sxs-lookup"><span data-stu-id="c08a6-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="c08a6-330">Manca il codice per crittografare la nuova password, anche se si è invitati ad aggiungere questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="c08a6-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="c08a6-331">Il modo in cui si consiglia di aggiungere il codice necessario consiste nell'usare un decompilatore come [Reflector](http://www.aisto.com/roeder/dotnet/) per esaminare il codice sorgente per i metodi nel .NET Framework; per iniziare, esaminare il metodo di `ChangePassword` della classe `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="c08a6-332">Questa è la tecnica utilizzata per scrivere il codice per la creazione di un hash della password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-332">This is the technique I used to write the code for creating a hash of the password.</span></span>

## <a name="summary"></a><span data-ttu-id="c08a6-333">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="c08a6-333">Summary</span></span>

<span data-ttu-id="c08a6-334">ASP.NET offre due controlli che consentono agli utenti di gestire la propria password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="c08a6-335">Il controllo PasswordRecovery è utile per gli utenti che hanno dimenticato la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="c08a6-336">A seconda della configurazione del Framework di appartenenza, l'utente invia tramite posta elettronica la password esistente o una nuova password generata in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="c08a6-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="c08a6-337">Il controllo ChangePassword consente a un utente di aggiornare la password.</span><span class="sxs-lookup"><span data-stu-id="c08a6-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="c08a6-338">Analogamente ai controlli Login e CreateUserWizard, i controlli PasswordRecovery e ChangePassword eseguono il rendering di un'interfaccia utente avanzata senza dover scrivere un Lick del markup dichiarativo o della riga di codice.</span><span class="sxs-lookup"><span data-stu-id="c08a6-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="c08a6-339">Se l'interfaccia utente predefinita non soddisfa le proprie esigenze, è possibile personalizzarla tramite una varietà di proprietà di stile.</span><span class="sxs-lookup"><span data-stu-id="c08a6-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="c08a6-340">In alternativa, le interfacce dei controlli possono essere convertite in modelli, per un livello di controllo ancora più preciso.</span><span class="sxs-lookup"><span data-stu-id="c08a6-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="c08a6-341">Dietro le quinte questi controlli usano l'API di appartenenza, richiamando i metodi `ResetPassword` e `ChangePassword` dell'oggetto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="c08a6-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="c08a6-342">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="c08a6-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c08a6-343">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="c08a6-343">Further Reading</span></span>

<span data-ttu-id="c08a6-344">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="c08a6-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c08a6-345">Guide introduttive al controllo ChangePassword</span><span class="sxs-lookup"><span data-stu-id="c08a6-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="c08a6-346">Guide introduttive al controllo PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="c08a6-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="c08a6-347">Invio di messaggi di posta elettronica in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c08a6-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="c08a6-348">Domande frequenti `System.Net.Mail`</span><span class="sxs-lookup"><span data-stu-id="c08a6-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="c08a6-349">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="c08a6-349">About the Author</span></span>

<span data-ttu-id="c08a6-350">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="c08a6-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c08a6-351">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="c08a6-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c08a6-352">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="c08a6-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c08a6-353">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="c08a6-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c08a6-354">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="c08a6-354">Special Thanks To</span></span>

<span data-ttu-id="c08a6-355">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="c08a6-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c08a6-356">I revisori del lead per questa esercitazione includono Michael Emmings e Suchi bottle.</span><span class="sxs-lookup"><span data-stu-id="c08a6-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="c08a6-357">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="c08a6-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c08a6-358">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c08a6-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c08a6-359">[Precedente](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [Successivo](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c08a6-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
