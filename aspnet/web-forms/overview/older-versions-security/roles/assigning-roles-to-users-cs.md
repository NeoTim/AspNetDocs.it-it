---
uid: web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
title: Assegnazione di ruoli agli utenti (C#) | Microsoft Docs
author: rick-anderson
description: In questa esercitazione vengono create due pagine di ASP.NET per semplificare la gestione degli utenti che appartengono ai ruoli. La prima pagina includerà le funzionalità per vedere cosa...
ms.author: riande
ms.date: 03/24/2008
ms.assetid: d522639a-5aca-421e-9a76-d73f95607f57
msc.legacyurl: /web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
msc.type: authoredcontent
ms.openlocfilehash: 3346e47cf604ed1d4003ca83203116666e37cb1b
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74633769"
---
# <a name="assigning-roles-to-users-c"></a><span data-ttu-id="72ad4-104">Assegnazione di ruoli agli utenti (C#)</span><span class="sxs-lookup"><span data-stu-id="72ad4-104">Assigning Roles to Users (C#)</span></span>

<span data-ttu-id="72ad4-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="72ad4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="72ad4-106">[Scarica codice](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip) o [Scarica PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="72ad4-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span></span>

> <span data-ttu-id="72ad4-107">In questa esercitazione vengono create due pagine di ASP.NET per semplificare la gestione degli utenti che appartengono ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-107">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="72ad4-108">La prima pagina includerà le funzionalità per visualizzare gli utenti che appartengono a un determinato ruolo, i ruoli a cui appartiene un determinato utente e la possibilità di assegnare o rimuovere un determinato utente da un particolare ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-108">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="72ad4-109">Nella seconda pagina verrà aumentato il controllo CreateUserWizard in modo da includere un passaggio per specificare i ruoli a cui appartiene l'utente appena creato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-109">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="72ad4-110">Questa operazione è utile negli scenari in cui un amministratore è in grado di creare nuovi account utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-110">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

## <a name="introduction"></a><span data-ttu-id="72ad4-111">Introduzione</span><span class="sxs-lookup"><span data-stu-id="72ad4-111">Introduction</span></span>

<span data-ttu-id="72ad4-112">L' <a id="_msoanchor_1"> </a> [esercitazione precedente](creating-and-managing-roles-cs.md) ha esaminato il Framework dei ruoli e il `SqlRoleProvider`; Abbiamo visto come usare la classe `Roles` per creare, recuperare ed eliminare ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-112">The <a id="_msoanchor_1"></a>[previous tutorial](creating-and-managing-roles-cs.md) examined the Roles framework and the `SqlRoleProvider`; we saw how to use the `Roles` class to create, retrieve, and delete roles.</span></span> <span data-ttu-id="72ad4-113">Oltre alla creazione e all'eliminazione di ruoli, è necessario essere in grado di assegnare o rimuovere utenti da un ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-113">In addition to creating and deleting roles, we need to be able to assign or remove users from a role.</span></span> <span data-ttu-id="72ad4-114">Sfortunatamente, ASP.NET non viene fornito con alcun controllo Web per la gestione degli utenti che appartengono ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-114">Unfortunately, ASP.NET does not ship with any Web controls for managing what users belong to what roles.</span></span> <span data-ttu-id="72ad4-115">Al contrario, è necessario creare le proprie pagine ASP.NET per gestire queste associazioni.</span><span class="sxs-lookup"><span data-stu-id="72ad4-115">Instead, we must create our own ASP.NET pages to manage these associations.</span></span> <span data-ttu-id="72ad4-116">L'aspetto positivo è che l'aggiunta e la rimozione di utenti ai ruoli è piuttosto semplice.</span><span class="sxs-lookup"><span data-stu-id="72ad4-116">The good news is that adding and removing users to roles is quite easy.</span></span> <span data-ttu-id="72ad4-117">La classe `Roles` contiene una serie di metodi per l'aggiunta di uno o più utenti a uno o più ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-117">The `Roles` class contains a number of methods for adding one or more users to one or more roles.</span></span>

<span data-ttu-id="72ad4-118">In questa esercitazione vengono create due pagine di ASP.NET per semplificare la gestione degli utenti che appartengono ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-118">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="72ad4-119">La prima pagina includerà le funzionalità per visualizzare gli utenti che appartengono a un determinato ruolo, i ruoli a cui appartiene un determinato utente e la possibilità di assegnare o rimuovere un determinato utente da un particolare ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-119">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="72ad4-120">Nella seconda pagina verrà aumentato il controllo CreateUserWizard in modo da includere un passaggio per specificare i ruoli a cui appartiene l'utente appena creato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-120">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="72ad4-121">Questa operazione è utile negli scenari in cui un amministratore è in grado di creare nuovi account utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-121">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

<span data-ttu-id="72ad4-122">Iniziamo!</span><span class="sxs-lookup"><span data-stu-id="72ad4-122">Let's get started!</span></span>

## <a name="listing-what-users-belong-to-what-roles"></a><span data-ttu-id="72ad4-123">Elenco degli utenti che appartengono ai ruoli</span><span class="sxs-lookup"><span data-stu-id="72ad4-123">Listing What Users Belong To What Roles</span></span>

<span data-ttu-id="72ad4-124">Il primo ordine aziendale per questa esercitazione consiste nel creare una pagina Web da cui gli utenti possono essere assegnati ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-124">The first order of business for this tutorial is to create a web page from which users can be assigned to roles.</span></span> <span data-ttu-id="72ad4-125">Prima di dedicarsi a come assegnare gli utenti ai ruoli, si concentrerà innanzitutto su come determinare quali utenti appartengono ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-125">Before we concern ourselves with how to assign users to roles, let's first concentrate on how to determine what users belong to what roles.</span></span> <span data-ttu-id="72ad4-126">Esistono due modi per visualizzare queste informazioni: "per ruolo" o "per utente".</span><span class="sxs-lookup"><span data-stu-id="72ad4-126">There are two ways to display this information: "by role" or "by user."</span></span> <span data-ttu-id="72ad4-127">È possibile consentire al visitatore di selezionare un ruolo e quindi visualizzare tutti gli utenti che appartengono al ruolo (visualizzazione "per ruolo"), oppure è possibile chiedere al visitatore di selezionare un utente e quindi di visualizzare i ruoli assegnati a tale utente (la visualizzazione "da parte dell'utente").</span><span class="sxs-lookup"><span data-stu-id="72ad4-127">We could allow the visitor to select a role and then show them all of the users that belong to the role (the "by role" display), or we could prompt the visitor to select a user and then show them the roles assigned to that user (the "by user" display).</span></span>

<span data-ttu-id="72ad4-128">La vista "per ruolo" è utile nei casi in cui il visitatore desidera conoscere il set di utenti che appartengono a un ruolo specifico. la visualizzazione "per utente" è la scelta ideale quando il visitatore deve essere a conoscenza dei ruoli specifici di un utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-128">The "by role" view is useful in circumstances where the visitor wants to know the set of users that belong to a particular role; the "by user" view is ideal when the visitor needs to know a particular user's role(s).</span></span> <span data-ttu-id="72ad4-129">Nella pagina sono incluse le interfacce "per ruolo" e "per utente".</span><span class="sxs-lookup"><span data-stu-id="72ad4-129">Let's have our page include both "by role" and "by user" interfaces.</span></span>

<span data-ttu-id="72ad4-130">Si inizierà con la creazione dell'interfaccia "by User".</span><span class="sxs-lookup"><span data-stu-id="72ad4-130">We will start with creating the "by user" interface.</span></span> <span data-ttu-id="72ad4-131">Questa interfaccia è costituita da un elenco a discesa e da un elenco di caselle di controllo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-131">This interface will consist of a drop-down list and a list of checkboxes.</span></span> <span data-ttu-id="72ad4-132">L'elenco a discesa verrà popolato con il set di utenti nel sistema; le caselle di controllo enumerano i ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-132">The drop-down list will be populated with the set of users in the system; the checkboxes will enumerate the roles.</span></span> <span data-ttu-id="72ad4-133">Selezionando un utente dall'elenco a discesa, verranno verificati i ruoli a cui appartiene l'utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-133">Selecting a user from the drop-down list will check those roles the user belongs to.</span></span> <span data-ttu-id="72ad4-134">La persona che visita la pagina può quindi selezionare o deselezionare le caselle di controllo per aggiungere o rimuovere l'utente selezionato dai ruoli corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-134">The person visiting the page can then check or uncheck the checkboxes to add or remove the selected user from the corresponding roles.</span></span>

> [!NOTE]
> <span data-ttu-id="72ad4-135">L'uso di un elenco a discesa per elencare gli account utente non è la scelta ideale per i siti Web in cui potrebbero essere presenti centinaia di account utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-135">Using a drop-down list to list the user accounts is not an ideal choice for websites where there may be hundreds of user accounts.</span></span> <span data-ttu-id="72ad4-136">Un elenco a discesa è progettato per consentire a un utente di selezionare un elemento da un elenco di opzioni relativamente breve.</span><span class="sxs-lookup"><span data-stu-id="72ad4-136">A drop-down list is designed to allow a user to pick one item from a relatively short list of options.</span></span> <span data-ttu-id="72ad4-137">Il numero di elementi dell'elenco cresce rapidamente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-137">It quickly becomes unwieldy as the number of list items grows.</span></span> <span data-ttu-id="72ad4-138">Se si compila un sito Web che avrà un numero potenzialmente elevato di account utente, potrebbe essere necessario considerare l'utilizzo di un'interfaccia utente alternativa, ad esempio un controllo GridView paginabile o un'interfaccia filtrabile che elenca la richiesta al visitatore di scegliere una lettera e quindi solo Mostra gli utenti il cui nome utente inizia con la lettera selezionata.</span><span class="sxs-lookup"><span data-stu-id="72ad4-138">If you are building a website that will have potentially large numbers of user accounts, you may want to consider using an alternative user interface, such as a pageable GridView or a filterable interface that lists prompts the visitor to choose a letter and then only shows those users whose username starts with the selected letter.</span></span>

## <a name="step-1-building-the-by-user-user-interface"></a><span data-ttu-id="72ad4-139">Passaggio 1: compilazione dell'interfaccia utente "per utente"</span><span class="sxs-lookup"><span data-stu-id="72ad4-139">Step 1: Building the "By User" User Interface</span></span>

<span data-ttu-id="72ad4-140">Aprire la pagina `UsersAndRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-140">Open the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="72ad4-141">Nella parte superiore della pagina aggiungere un controllo Web Label denominato `ActionStatus` e deselezionare la relativa proprietà `Text`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-141">At the top of the page, add a Label Web control named `ActionStatus` and clear out its `Text` property.</span></span> <span data-ttu-id="72ad4-142">Questa etichetta verrà usata per fornire commenti e suggerimenti sulle azioni eseguite, visualizzando messaggi quali "l'utente Tito è stato aggiunto al ruolo di amministratore" o "l'utente Jisun è stato rimosso dal ruolo Supervisore".</span><span class="sxs-lookup"><span data-stu-id="72ad4-142">We will use this Label to provide feedback on the actions performed, displaying messages like, "User Tito has been added to the Administrators role," or "User Jisun has been removed from the Supervisors role."</span></span> <span data-ttu-id="72ad4-143">Per far emergere questi messaggi, impostare la proprietà `CssClass` dell'etichetta su "important".</span><span class="sxs-lookup"><span data-stu-id="72ad4-143">In order to make these messages stand out, set the Label's `CssClass` property to "Important".</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample1.aspx)]

<span data-ttu-id="72ad4-144">Successivamente, aggiungere la seguente definizione di classe CSS al foglio di stile `Styles.css`:</span><span class="sxs-lookup"><span data-stu-id="72ad4-144">Next, add the following CSS class definition to the `Styles.css` stylesheet:</span></span>

[!code-css[Main](assigning-roles-to-users-cs/samples/sample2.css)]

<span data-ttu-id="72ad4-145">Questa definizione CSS indica al browser di visualizzare l'etichetta usando un tipo di carattere rosso grande.</span><span class="sxs-lookup"><span data-stu-id="72ad4-145">This CSS definition instructs the browser to display the Label using a large, red font.</span></span> <span data-ttu-id="72ad4-146">La figura 1 Mostra questo effetto tramite la finestra di progettazione di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="72ad4-146">Figure 1 shows this effect through the Visual Studio Designer.</span></span>

<span data-ttu-id="72ad4-147">[![la proprietà CssClass dell'etichetta restituisce un tipo di carattere rosso grande](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-147">[![The Label's CssClass Property Results in a Large, Red Font](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span></span>

<span data-ttu-id="72ad4-148">**Figura 1**: la proprietà `CssClass` dell'etichetta restituisce un carattere di colore rosso grande ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-148">**Figure 1**: The Label's `CssClass` Property Results in a Large, Red Font  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image3.png))</span></span>

<span data-ttu-id="72ad4-149">Successivamente, aggiungere un oggetto DropDownList alla pagina, impostare la relativa proprietà `ID` su `UserList`e impostare la relativa proprietà `AutoPostBack` su true.</span><span class="sxs-lookup"><span data-stu-id="72ad4-149">Next, add a DropDownList to the page, set its `ID` property to `UserList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="72ad4-150">Questo DropDownList verrà usato per elencare tutti gli utenti del sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-150">We will use this DropDownList to list all of the users in the system.</span></span> <span data-ttu-id="72ad4-151">Questo DropDownList verrà associato a una raccolta di oggetti MembershipUser.</span><span class="sxs-lookup"><span data-stu-id="72ad4-151">This DropDownList will be bound to a collection of MembershipUser objects.</span></span> <span data-ttu-id="72ad4-152">Poiché si desidera che la DropDownList visualizzi la proprietà UserName dell'oggetto MembershipUser (e la utilizzi come valore degli elementi dell'elenco), impostare le proprietà `DataTextField` e `DataValueField` di DropDownList su "UserName".</span><span class="sxs-lookup"><span data-stu-id="72ad4-152">Because we want the DropDownList to display the UserName property of the MembershipUser object (and use it as the value of the list items), set the DropDownList's `DataTextField` and `DataValueField` properties to "UserName".</span></span>

<span data-ttu-id="72ad4-153">Sotto il DropDownList aggiungere un Repeater denominato `UsersRoleList`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-153">Underneath the DropDownList, add a Repeater named `UsersRoleList`.</span></span> <span data-ttu-id="72ad4-154">Questo Repeater elenca tutti i ruoli del sistema sotto forma di una serie di caselle di controllo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-154">This Repeater will list all of the roles in the system as a series of checkboxes.</span></span> <span data-ttu-id="72ad4-155">Definire la `ItemTemplate` del Repeater usando il markup dichiarativo seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-155">Define the Repeater's `ItemTemplate` using the following declarative markup:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample3.aspx)]

<span data-ttu-id="72ad4-156">Il markup `ItemTemplate` include un singolo controllo Web CheckBox denominato `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-156">The `ItemTemplate` markup includes a single CheckBox Web control named `RoleCheckBox`.</span></span> <span data-ttu-id="72ad4-157">La proprietà `AutoPostBack` della casella di controllo è impostata su true e la proprietà `Text` è associata a `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-157">The CheckBox's `AutoPostBack` property is set to True and the `Text` property is bound to `Container.DataItem`.</span></span> <span data-ttu-id="72ad4-158">Il motivo della sintassi di DataBinding è semplicemente `Container.DataItem` perché il Framework dei ruoli restituisce l'elenco di nomi di ruoli come matrice di stringhe ed è questa matrice di stringhe che verrà associato al ripetitore.</span><span class="sxs-lookup"><span data-stu-id="72ad4-158">The reason the databinding syntax is simply `Container.DataItem` is because the Roles framework returns the list of role names as a string array, and it is this string array that we will be binding to the Repeater.</span></span> <span data-ttu-id="72ad4-159">Una descrizione dettagliata del motivo per cui questa sintassi viene utilizzata per visualizzare il contenuto di una matrice associata a un controllo Web dati esula dall'ambito di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="72ad4-159">A thorough description of why this syntax is used to display the contents of an array bound to a data Web control is beyond the scope of this tutorial.</span></span> <span data-ttu-id="72ad4-160">Per ulteriori informazioni su questo argomento, vedere [associazione di una matrice scalare a un controllo Web di dati](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="72ad4-160">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="72ad4-161">A questo punto il markup dichiarativo dell'interfaccia "by User" dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-161">At this point your "by user" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample4.aspx)]

<span data-ttu-id="72ad4-162">A questo punto è possibile scrivere il codice per associare il set di account utente al DropDownList e il set di ruoli al Repeater.</span><span class="sxs-lookup"><span data-stu-id="72ad4-162">We are now ready to write the code to bind the set of user accounts to the DropDownList and the set of roles to the Repeater.</span></span> <span data-ttu-id="72ad4-163">Nella classe code-behind della pagina aggiungere un metodo denominato `BindUsersToUserList` e un altro `BindRolesList`denominato, usando il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-163">In the page's code-behind class, add a method named `BindUsersToUserList` and another named `BindRolesList`, using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample5.cs)]

<span data-ttu-id="72ad4-164">Il metodo `BindUsersToUserList` recupera tutti gli account utente nel sistema tramite il [metodo`Membership.GetAllUsers`](https://msdn.microsoft.com/library/dy8swhya.aspx).</span><span class="sxs-lookup"><span data-stu-id="72ad4-164">The `BindUsersToUserList` method retrieves all of the user accounts in the system via the [`Membership.GetAllUsers` method](https://msdn.microsoft.com/library/dy8swhya.aspx).</span></span> <span data-ttu-id="72ad4-165">Viene restituito un [oggetto`MembershipUserCollection`](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), ovvero una raccolta di [istanze di`MembershipUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="72ad4-165">This returns a [`MembershipUserCollection` object](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), which is a collection of [`MembershipUser` instances](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span></span> <span data-ttu-id="72ad4-166">Questa raccolta viene quindi associata al `UserList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-166">This collection is then bound to the `UserList` DropDownList.</span></span> <span data-ttu-id="72ad4-167">Le istanze `MembershipUser` che comportano il makeup della raccolta contengono diverse proprietà, ad esempio `UserName`, `Email`, `CreationDate`e `IsOnline`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-167">The `MembershipUser` instances that makeup the collection contain a variety of properties, like `UserName`, `Email`, `CreationDate`, and `IsOnline`.</span></span> <span data-ttu-id="72ad4-168">Per indicare al DropDownList di visualizzare il valore della proprietà `UserName`, assicurarsi che le proprietà `DataTextField` e `DataValueField` del `UserList` DropDownList siano state impostate su "UserName".</span><span class="sxs-lookup"><span data-stu-id="72ad4-168">In order to instruct the DropDownList to display the value of the `UserName` property, ensure that the `UserList` DropDownList's `DataTextField` and `DataValueField` properties have been set to "UserName".</span></span>

> [!NOTE]
> <span data-ttu-id="72ad4-169">Il metodo `Membership.GetAllUsers` dispone di due overload: uno che non accetta parametri di input e restituisce tutti gli utenti e uno che accetta valori integer per l'indice e le dimensioni della pagina e restituisce solo il subset specificato di utenti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-169">The `Membership.GetAllUsers` method has two overloads: one that accepts no input parameters and returns all of the users, and one that takes in integer values for the page index and page size, and returns only the specified subset of the users.</span></span> <span data-ttu-id="72ad4-170">Quando sono presenti grandi quantità di account utente visualizzati in un elemento dell'interfaccia utente di cui è possibile eseguire il paging, il secondo overload può essere usato per passare in modo più efficiente alle pagine degli utenti, perché restituisce solo il subset preciso di account utente anziché tutti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-170">When there are large amounts of user accounts being displayed in a pageable user interface element, the second overload can be used to more efficiently page through the users since it returns just the precise subset of user accounts rather than all of them.</span></span>

<span data-ttu-id="72ad4-171">Il metodo `BindRolesToList` inizia chiamando il [metodo`GetAllRoles`](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)della classe `Roles`, che restituisce una matrice di stringhe contenente i ruoli nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-171">The `BindRolesToList` method starts by calling the `Roles` class's [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), which returns a string array containing the roles in the system.</span></span> <span data-ttu-id="72ad4-172">Questa matrice di stringhe viene quindi associata al Repeater.</span><span class="sxs-lookup"><span data-stu-id="72ad4-172">This string array is then bound to the Repeater.</span></span>

<span data-ttu-id="72ad4-173">Infine, è necessario chiamare questi due metodi quando la pagina viene caricata per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="72ad4-173">Finally, we need to call these two methods when the page is first loaded.</span></span> <span data-ttu-id="72ad4-174">Aggiungere il codice seguente al gestore eventi `Page_Load` :</span><span class="sxs-lookup"><span data-stu-id="72ad4-174">Add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample6.cs)]

<span data-ttu-id="72ad4-175">Con questo codice, dedicare un po' di tempo alla visita della pagina tramite un browser. la schermata dovrebbe essere simile alla figura 2.</span><span class="sxs-lookup"><span data-stu-id="72ad4-175">With this code in place, take a moment to visit the page through a browser; your screen should look similar to Figure 2.</span></span> <span data-ttu-id="72ad4-176">Tutti gli account utente vengono popolati nell'elenco a discesa e, sotto questo, ogni ruolo viene visualizzato come casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-176">All of the user accounts are populated in the drop-down list and, underneath that, each role appears as a checkbox.</span></span> <span data-ttu-id="72ad4-177">Poiché si impostano le proprietà `AutoPostBack` di DropDownList e le caselle di controllo su true, la modifica dell'utente selezionato o la verifica o la deselezione di un ruolo causa un postback.</span><span class="sxs-lookup"><span data-stu-id="72ad4-177">Because we set the `AutoPostBack` properties of the DropDownList and CheckBoxes to True, changing the selected user or checking or unchecking a role causes a postback.</span></span> <span data-ttu-id="72ad4-178">Tuttavia, non viene eseguita alcuna azione, perché è ancora necessario scrivere codice per gestire queste azioni.</span><span class="sxs-lookup"><span data-stu-id="72ad4-178">No action is performed, however, because we have yet to write code to handle these actions.</span></span> <span data-ttu-id="72ad4-179">Queste attività verranno affrontate nelle due sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="72ad4-179">We'll tackle these tasks in the next two sections.</span></span>

<span data-ttu-id="72ad4-180">[![la pagina Visualizza gli utenti e i ruoli](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-180">[![The Page Displays the Users and Roles](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span></span>

<span data-ttu-id="72ad4-181">**Figura 2**: la pagina Visualizza gli utenti e i ruoli ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-181">**Figure 2**: The Page Displays the Users and Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image6.png))</span></span>

### <a name="checking-the-roles-the-selected-user-belongs-to"></a><span data-ttu-id="72ad4-182">Verifica dei ruoli a cui appartiene l'utente selezionato</span><span class="sxs-lookup"><span data-stu-id="72ad4-182">Checking the Roles the Selected User Belongs To</span></span>

<span data-ttu-id="72ad4-183">Quando la pagina viene caricata per la prima volta o ogni volta che il visitatore seleziona un nuovo utente dall'elenco a discesa, è necessario aggiornare le caselle di controllo della `UsersRoleList`in modo che la casella di controllo del ruolo specificato venga controllata solo se l'utente selezionato appartiene a tale ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-183">When the page is first loaded, or whenever the visitor selects a new user from the drop-down list, we need to update the `UsersRoleList`'s checkboxes so that a given role checkbox is checked only if the selected user belongs to that role.</span></span> <span data-ttu-id="72ad4-184">A tale scopo, creare un metodo denominato `CheckRolesForSelectedUser` con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-184">To accomplish this, create a method named `CheckRolesForSelectedUser` with the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample7.cs)]

<span data-ttu-id="72ad4-185">Il codice precedente inizia determinando l'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-185">The above code starts by determining who the selected user is.</span></span> <span data-ttu-id="72ad4-186">USA quindi il [metodo`GetRolesForUser(userName)`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) della classe Roles per restituire il set di ruoli dell'utente specificato come matrice di stringhe.</span><span class="sxs-lookup"><span data-stu-id="72ad4-186">It then uses the Roles class's [`GetRolesForUser(userName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) to return the specified user's set of roles as a string array.</span></span> <span data-ttu-id="72ad4-187">Vengono quindi enumerati gli elementi del Repeater e viene fatto riferimento a a livello di codice a ogni elemento della casella di controllo `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-187">Next, the Repeater's items are enumerated and each item's `RoleCheckBox` CheckBox is programmatically referenced.</span></span> <span data-ttu-id="72ad4-188">La casella di controllo viene controllata solo se il ruolo a cui corrisponde è contenuto all'interno della matrice di stringhe `selectedUsersRoles`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-188">The CheckBox is checked only if the role it corresponds to is contained within the `selectedUsersRoles` string array.</span></span>

> [!NOTE]
> <span data-ttu-id="72ad4-189">Se si usa ASP.NET versione 2,0, la sintassi del `selectedUserRoles.Contains<string>(...)` non verrà compilata.</span><span class="sxs-lookup"><span data-stu-id="72ad4-189">The `selectedUserRoles.Contains<string>(...)` syntax will not compile if you are using ASP.NET version 2.0.</span></span> <span data-ttu-id="72ad4-190">Il `Contains<string>` metodo fa parte della [libreria LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query), che è una novità di ASP.NET 3,5.</span><span class="sxs-lookup"><span data-stu-id="72ad4-190">The `Contains<string>` method is part of the [LINQ library](http://en.wikipedia.org/wiki/Language_Integrated_Query), which is new to ASP.NET 3.5.</span></span> <span data-ttu-id="72ad4-191">Se si sta ancora usando ASP.NET versione 2,0, usare invece il [metodo`Array.IndexOf<string>`](https://msdn.microsoft.com/library/eha9t187.aspx) .</span><span class="sxs-lookup"><span data-stu-id="72ad4-191">If you are still using ASP.NET version 2.0, use the [`Array.IndexOf<string>` method](https://msdn.microsoft.com/library/eha9t187.aspx) instead.</span></span>

<span data-ttu-id="72ad4-192">È necessario chiamare il metodo `CheckRolesForSelectedUser` in due casi: quando la pagina viene caricata per la prima volta e ogni volta che viene modificato l'indice selezionato del `UserList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-192">The `CheckRolesForSelectedUser` method needs to be called in two cases: when the page is first loaded and whenever the `UserList` DropDownList's selected index is changed.</span></span> <span data-ttu-id="72ad4-193">Chiamare pertanto questo metodo dal gestore dell'evento `Page_Load` (dopo le chiamate a `BindUsersToUserList` e `BindRolesToList`).</span><span class="sxs-lookup"><span data-stu-id="72ad4-193">Therefore, call this method from the `Page_Load` event handler (after the calls to `BindUsersToUserList` and `BindRolesToList`).</span></span> <span data-ttu-id="72ad4-194">Inoltre, creare un gestore eventi per l'evento `SelectedIndexChanged` di DropDownList e chiamare questo metodo da questa posizione.</span><span class="sxs-lookup"><span data-stu-id="72ad4-194">Also, create an event handler for the DropDownList's `SelectedIndexChanged` event and call this method from there.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample8.cs)]

<span data-ttu-id="72ad4-195">Con questo codice, è possibile eseguire il test della pagina tramite il browser.</span><span class="sxs-lookup"><span data-stu-id="72ad4-195">With this code in place, you can test the page through the browser.</span></span> <span data-ttu-id="72ad4-196">Tuttavia, poiché la pagina `UsersAndRoles.aspx` attualmente non dispone della possibilità di assegnare utenti ai ruoli, nessun utente dispone di ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-196">However, since the `UsersAndRoles.aspx` page currently lacks the ability to assign users to roles, no users have roles.</span></span> <span data-ttu-id="72ad4-197">Verrà creata l'interfaccia per l'assegnazione di utenti ai ruoli in un determinato momento, pertanto è possibile utilizzare la parola che il codice funziona e verificare che venga eseguito in un secondo momento oppure è possibile aggiungere manualmente utenti ai ruoli inserendo i record nella tabella `aspnet_UsersInRoles` per testare subito questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="72ad4-197">We will create the interface for assigning users to roles in a moment, so you can either take my word that this code works and verify that it does so later, or you can manually add users to roles by inserting records into the `aspnet_UsersInRoles` table in order to test this functionality now.</span></span>

### <a name="assigning-and-removing-users-from-roles"></a><span data-ttu-id="72ad4-198">Assegnazione e rimozione di utenti dai ruoli</span><span class="sxs-lookup"><span data-stu-id="72ad4-198">Assigning and Removing Users from Roles</span></span>

<span data-ttu-id="72ad4-199">Quando il visitatore controlla o deseleziona una casella di controllo in `UsersRoleList` Repeater è necessario aggiungere o rimuovere l'utente selezionato dal ruolo corrispondente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-199">When the visitor checks or unchecks a CheckBox in the `UsersRoleList` Repeater we need to add or remove the selected user from the corresponding role.</span></span> <span data-ttu-id="72ad4-200">La proprietà `AutoPostBack` della casella di controllo è attualmente impostata su true, causando un postback ogni volta che una casella di controllo nel ripetitore viene selezionata o deselezionata.</span><span class="sxs-lookup"><span data-stu-id="72ad4-200">The CheckBox's `AutoPostBack` property is currently set to True, which causes a postback anytime a CheckBox in the Repeater is checked or unchecked.</span></span> <span data-ttu-id="72ad4-201">In breve, è necessario creare un gestore eventi per l'evento `CheckChanged` della casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-201">In short, we need to create an event handler for the CheckBox's `CheckChanged` event.</span></span> <span data-ttu-id="72ad4-202">Poiché la casella di controllo si trova in un controllo Repeater, è necessario aggiungere manualmente il plumbing del gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="72ad4-202">Since the CheckBox is in a Repeater control, we need to manually add the event handler plumbing.</span></span> <span data-ttu-id="72ad4-203">Per iniziare, aggiungere il gestore eventi alla classe code-behind come metodo di `protected`, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="72ad4-203">Start by adding the event handler to the code-behind class as a `protected` method, like so:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample9.cs)]

<span data-ttu-id="72ad4-204">Si tornerà a scrivere il codice per questo gestore eventi in un determinato momento.</span><span class="sxs-lookup"><span data-stu-id="72ad4-204">We will return to write the code for this event handler in a moment.</span></span> <span data-ttu-id="72ad4-205">Tuttavia, prima di tutto è necessario completare il plumbing di gestione degli eventi.</span><span class="sxs-lookup"><span data-stu-id="72ad4-205">But first let's complete the event handling plumbing.</span></span> <span data-ttu-id="72ad4-206">Dalla casella di controllo all'interno del `ItemTemplate`del Repeater aggiungere `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-206">From the CheckBox within the Repeater's `ItemTemplate`, add `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span></span> <span data-ttu-id="72ad4-207">Questa sintassi consente di collegare il gestore dell'evento `RoleCheckBox_CheckChanged` all'evento `CheckedChanged` di `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-207">This syntax wires the `RoleCheckBox_CheckChanged` event handler to the `RoleCheckBox`'s `CheckedChanged` event.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample10.aspx)]

<span data-ttu-id="72ad4-208">L'attività finale consiste nel completare il gestore dell'evento `RoleCheckBox_CheckChanged`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-208">Our final task is to complete the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="72ad4-209">È necessario iniziare facendo riferimento al controllo CheckBox che ha generato l'evento perché questa istanza di CheckBox indica il ruolo selezionato o deselezionato tramite le proprietà `Text` e `Checked`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-209">We need to start by referencing the CheckBox control that raised the event because this CheckBox instance tells us what role was checked or unchecked via its `Text` and `Checked` properties.</span></span> <span data-ttu-id="72ad4-210">Usando queste informazioni insieme al nome utente dell'utente selezionato, l'utente viene aggiunto o rimosso dal ruolo tramite il metodo [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) o [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)della classe `Roles`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-210">Using this information along with the UserName of the selected user, we add or remove the user from the role via the `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) or [`RemoveUserFromRole` method](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample11.cs)]

<span data-ttu-id="72ad4-211">Il codice precedente inizia con un riferimento a livello di codice alla casella di controllo che ha generato l'evento, disponibile tramite il parametro di input `sender`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-211">The above code starts by programmatically referencing the CheckBox that raised the event, which is available via the `sender` input parameter.</span></span> <span data-ttu-id="72ad4-212">Se la casella di controllo è selezionata, l'utente selezionato viene aggiunto al ruolo specificato; in caso contrario, viene rimosso dal ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-212">If the CheckBox is checked, the selected user is added to the specified role, otherwise they are removed from the role.</span></span> <span data-ttu-id="72ad4-213">In entrambi i casi, nell'etichetta `ActionStatus` viene visualizzato un messaggio in cui viene riepilogata l'azione appena eseguita.</span><span class="sxs-lookup"><span data-stu-id="72ad4-213">In either case, the `ActionStatus` Label displays a message summarizing the action just performed.</span></span>

<span data-ttu-id="72ad4-214">È possibile eseguire il test di questa pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="72ad4-214">Take a moment to test out this page through a browser.</span></span> <span data-ttu-id="72ad4-215">Selezionare utente Tito, quindi aggiungere Tito ai ruoli amministratori e supervisori.</span><span class="sxs-lookup"><span data-stu-id="72ad4-215">Select user Tito and then add Tito to both the Administrators and Supervisors roles.</span></span>

<span data-ttu-id="72ad4-216">[![Tito è stato aggiunto ai ruoli amministratori e supervisori](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-216">[![Tito Has Been Added to the Administrators and Supervisors Roles](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span></span>

<span data-ttu-id="72ad4-217">**Figura 3**: Tito è stato aggiunto ai ruoli Administrators e Supervisors ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-217">**Figure 3**: Tito Has Been Added to the Administrators and Supervisors Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image9.png))</span></span>

<span data-ttu-id="72ad4-218">Selezionare quindi utente Bruce dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="72ad4-218">Next, select user Bruce from the drop-down list.</span></span> <span data-ttu-id="72ad4-219">Viene eseguito un postback e le caselle di controllo del Repeater vengono aggiornate tramite il `CheckRolesForSelectedUser`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-219">There is a postback and the Repeater's CheckBoxes are updated via the `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="72ad4-220">Poiché Bruce non appartiene ancora ad alcun ruolo, le due caselle di controllo sono deselezionate.</span><span class="sxs-lookup"><span data-stu-id="72ad4-220">Since Bruce does not yet belong to any roles, the two checkboxes are unchecked.</span></span> <span data-ttu-id="72ad4-221">Aggiungere quindi Bruce al ruolo supervisori.</span><span class="sxs-lookup"><span data-stu-id="72ad4-221">Next, add Bruce to the Supervisors role.</span></span>

<span data-ttu-id="72ad4-222">[![Bruce è stato aggiunto al ruolo supervisori](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-222">[![Bruce Has Been Added to the Supervisors Role](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span></span>

<span data-ttu-id="72ad4-223">**Figura 4**: Bruce è stato aggiunto al ruolo supervisori ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-223">**Figure 4**: Bruce Has Been Added to the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image12.png))</span></span>

<span data-ttu-id="72ad4-224">Per verificare ulteriormente la funzionalità del metodo di `CheckRolesForSelectedUser`, selezionare un utente diverso da Tito o Bruce.</span><span class="sxs-lookup"><span data-stu-id="72ad4-224">To further verify the functionality of the `CheckRolesForSelectedUser` method, select a user other than Tito or Bruce.</span></span> <span data-ttu-id="72ad4-225">Si noti che le caselle di controllo vengono deselezionate automaticamente, indicando che non appartengono ad alcun ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-225">Note how the checkboxes are automatically unchecked, denoting that they do not belong to any roles.</span></span> <span data-ttu-id="72ad4-226">Tornare a Tito.</span><span class="sxs-lookup"><span data-stu-id="72ad4-226">Return to Tito.</span></span> <span data-ttu-id="72ad4-227">È necessario selezionare le caselle di controllo amministratori e supervisori.</span><span class="sxs-lookup"><span data-stu-id="72ad4-227">Both the Administrators and Supervisors checkboxes should be checked.</span></span>

## <a name="step-2-building-the-by-roles-user-interface"></a><span data-ttu-id="72ad4-228">Passaggio 2: compilazione dell'interfaccia utente "per ruoli"</span><span class="sxs-lookup"><span data-stu-id="72ad4-228">Step 2: Building the "By Roles" User Interface</span></span>

<span data-ttu-id="72ad4-229">A questo punto è stata completata l'interfaccia "by users" e si è pronti per iniziare a affrontare l'interfaccia "by Roles".</span><span class="sxs-lookup"><span data-stu-id="72ad4-229">At this point we have completed the "by users" interface and are ready to start tackling the "by roles" interface.</span></span> <span data-ttu-id="72ad4-230">L'interfaccia "per ruoli" richiede all'utente di selezionare un ruolo da un elenco a discesa e quindi Visualizza il set di utenti che appartengono a tale ruolo in GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-230">The "by roles" interface prompts the user to select a role from a drop-down list and then displays the set of users that belong to that role in a GridView.</span></span>

<span data-ttu-id="72ad4-231">Aggiungere un altro controllo DropDownList alla pagina `UsersAndRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-231">Add another DropDownList control to the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="72ad4-232">Inserire questo oggetto sotto il controllo Repeater, denominarlo `RoleList`e impostare la relativa proprietà `AutoPostBack` su true.</span><span class="sxs-lookup"><span data-stu-id="72ad4-232">Place this one beneath the Repeater control, name it `RoleList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="72ad4-233">Al di sotto, aggiungere un controllo GridView e denominarlo `RolesUserList`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-233">Underneath that, add a GridView and name it `RolesUserList`.</span></span> <span data-ttu-id="72ad4-234">In questo GridView vengono elencati gli utenti che appartengono al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-234">This GridView will list the users that belong to the selected role.</span></span> <span data-ttu-id="72ad4-235">Impostare la proprietà `AutoGenerateColumns` di GridView su false, aggiungere un TemplateField alla raccolta `Columns` della griglia e impostare la relativa proprietà `HeaderText` su "Users".</span><span class="sxs-lookup"><span data-stu-id="72ad4-235">Set the GridView's `AutoGenerateColumns` property to False, add a TemplateField to the grid's `Columns` collection, and set its `HeaderText` property to "Users".</span></span> <span data-ttu-id="72ad4-236">Definire il `ItemTemplate` di TemplateField in modo che visualizzi il valore dell'espressione DataBinding `Container.DataItem` nella proprietà `Text` di un'etichetta denominata `UserNameLabel`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-236">Define the TemplateField's `ItemTemplate` so that it displays the value of the databinding expression `Container.DataItem` in the `Text` property of a Label named `UserNameLabel`.</span></span>

<span data-ttu-id="72ad4-237">Dopo l'aggiunta e la configurazione di GridView, il markup dichiarativo dell'interfaccia "by Role" dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-237">After adding and configuring the GridView, your "by role" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample12.aspx)]

<span data-ttu-id="72ad4-238">È necessario popolare il `RoleList` DropDownList con il set di ruoli nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-238">We need to populate the `RoleList` DropDownList with the set of roles in the system.</span></span> <span data-ttu-id="72ad4-239">A tale scopo, aggiornare il metodo `BindRolesToList` in modo che associ la matrice di stringhe restituita dal metodo `Roles.GetAllRoles` al `RolesList` DropDownList (e `UsersRoleList` Repeater).</span><span class="sxs-lookup"><span data-stu-id="72ad4-239">To accomplish this, update the `BindRolesToList` method so that is binds the string array returned by the `Roles.GetAllRoles` method to the `RolesList` DropDownList (as well as the `UsersRoleList` Repeater).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample13.cs)]

<span data-ttu-id="72ad4-240">Le ultime due righe nel metodo `BindRolesToList` sono state aggiunte per associare il set di ruoli al controllo `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-240">The last two lines in the `BindRolesToList` method have been added to bind the set of roles to the `RoleList` DropDownList control.</span></span> <span data-ttu-id="72ad4-241">La figura 5 Mostra il risultato finale quando viene visualizzato tramite un browser, ovvero un elenco a discesa popolato con i ruoli del sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-241">Figure 5 shows the end result when viewed through a browser – a drop-down list populated with the system's roles.</span></span>

<span data-ttu-id="72ad4-242">[![i ruoli vengono visualizzati nell'oggetto DropDownList del ruolo](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-242">[![The Roles are Displayed in the RoleList DropDownList](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span></span>

<span data-ttu-id="72ad4-243">**Figura 5**: i ruoli vengono visualizzati nel `RoleList` DropDownList ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-243">**Figure 5**: The Roles are Displayed in the `RoleList` DropDownList  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image15.png))</span></span>

### <a name="displaying-the-users-that-belong-to-the-selected-role"></a><span data-ttu-id="72ad4-244">Visualizzazione degli utenti che appartengono al ruolo selezionato</span><span class="sxs-lookup"><span data-stu-id="72ad4-244">Displaying the Users That Belong To the Selected Role</span></span>

<span data-ttu-id="72ad4-245">Quando la pagina viene caricata per la prima volta o quando viene selezionato un nuovo ruolo dal `RoleList` DropDownList, è necessario visualizzare l'elenco di utenti che appartengono a tale ruolo in GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-245">When the page is first loaded, or when a new role is selected from the `RoleList` DropDownList, we need to display the list of users that belong to that role in the GridView.</span></span> <span data-ttu-id="72ad4-246">Creare un metodo denominato `DisplayUsersBelongingToRole` usando il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-246">Create a method named `DisplayUsersBelongingToRole` using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample14.cs)]

<span data-ttu-id="72ad4-247">Questo metodo inizia ottenendo il ruolo selezionato dal `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-247">This method starts by getting the selected role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="72ad4-248">USA quindi il [metodo`Roles.GetUsersInRole(roleName)`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) per recuperare una matrice di stringhe dei nomi utente degli utenti che appartengono a tale ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-248">It then uses the [`Roles.GetUsersInRole(roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) to retrieve a string array of the UserNames of the users that belong to that role.</span></span> <span data-ttu-id="72ad4-249">Questa matrice viene quindi associata al `RolesUserList` GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-249">This array is then bound to the `RolesUserList` GridView.</span></span>

<span data-ttu-id="72ad4-250">Questo metodo deve essere chiamato in due circostanze: quando la pagina viene caricata inizialmente e quando viene modificato il ruolo selezionato nell'`RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-250">This method needs to be called in two circumstances: when the page is initially loaded and when the selected role in the `RoleList` DropDownList changes.</span></span> <span data-ttu-id="72ad4-251">Aggiornare quindi il gestore dell'evento `Page_Load` in modo che questo metodo venga richiamato dopo la chiamata a `CheckRolesForSelectedUser`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-251">Therefore, update the `Page_Load` event handler so that this method is invoked after the call to `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="72ad4-252">Successivamente, creare un gestore eventi per l'evento `SelectedIndexChanged` del `RoleList`e chiamare anche questo metodo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-252">Next, create an event handler for the `RoleList`'s `SelectedIndexChanged` event, and call this method from there, too.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample15.cs)]

<span data-ttu-id="72ad4-253">Con questo codice, il `RolesUserList` GridView dovrebbe visualizzare gli utenti che appartengono al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-253">With this code in place, the `RolesUserList` GridView should display those users that belong to the selected role.</span></span> <span data-ttu-id="72ad4-254">Come illustrato nella figura 6, il ruolo supervisori è costituito da due membri: Bruce e Tito.</span><span class="sxs-lookup"><span data-stu-id="72ad4-254">As Figure 6 shows, the Supervisors role consists of two members: Bruce and Tito.</span></span>

<span data-ttu-id="72ad4-255">[![GridView elenca gli utenti che appartengono al ruolo selezionato](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-255">[![The GridView Lists Those Users That Belong to the Selected Role](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span></span>

<span data-ttu-id="72ad4-256">**Figura 6**: GridView elenca gli utenti che appartengono al ruolo selezionato ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-256">**Figure 6**: The GridView Lists Those Users That Belong to the Selected Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image18.png))</span></span>

### <a name="removing-users-from-the-selected-role"></a><span data-ttu-id="72ad4-257">Rimozione degli utenti dal ruolo selezionato</span><span class="sxs-lookup"><span data-stu-id="72ad4-257">Removing Users from the Selected Role</span></span>

<span data-ttu-id="72ad4-258">Verrà ora aumentata la `RolesUserList` GridView in modo che includa una colonna di pulsanti "Rimuovi".</span><span class="sxs-lookup"><span data-stu-id="72ad4-258">Let's augment the `RolesUserList` GridView so that it includes a column of "Remove" buttons.</span></span> <span data-ttu-id="72ad4-259">Se si fa clic sul pulsante "Rimuovi" per un determinato utente, questi vengono rimossi da tale ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-259">Clicking the "Remove" button for a particular user will remove them from that role.</span></span>

<span data-ttu-id="72ad4-260">Per iniziare, aggiungere un campo pulsante Elimina al controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-260">Start by adding a Delete button field to the GridView.</span></span> <span data-ttu-id="72ad4-261">Fare in modo che questo campo appaia come il più a sinistra e modificare la proprietà `DeleteText` da "Delete" (impostazione predefinita) a "Remove".</span><span class="sxs-lookup"><span data-stu-id="72ad4-261">Make this field appear as the left most filed and change its `DeleteText` property from "Delete" (the default) to "Remove".</span></span>

<span data-ttu-id="72ad4-262">[![aggiungere il](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-262">[![Add the](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span></span>

<span data-ttu-id="72ad4-263">**Figura 7**: aggiungere il pulsante "Rimuovi" al GridView ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-263">**Figure 7**: Add the "Remove" Button to the GridView  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image21.png))</span></span>

<span data-ttu-id="72ad4-264">Quando si fa clic sul pulsante "Rimuovi", viene restituito un postback e viene generato l'evento `RowDeleting` di GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-264">When the "Remove" button is clicked a postback ensues and the GridView's `RowDeleting` event is raised.</span></span> <span data-ttu-id="72ad4-265">È necessario creare un gestore eventi per questo evento e scrivere codice per rimuovere l'utente dal ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-265">We need to create an event handler for this event and write code that removes the user from the selected role.</span></span> <span data-ttu-id="72ad4-266">Creare il gestore eventi e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-266">Create the event handler and then add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample16.cs)]

<span data-ttu-id="72ad4-267">Il codice inizia determinando il nome del ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-267">The code starts by determining the selected role name.</span></span> <span data-ttu-id="72ad4-268">Quindi fa riferimento a livello di codice al controllo `UserNameLabel` dalla riga di cui è stato fatto clic sul pulsante "Rimuovi" per determinare il nome utente dell'utente da rimuovere.</span><span class="sxs-lookup"><span data-stu-id="72ad4-268">It then programmatically references the `UserNameLabel` control from the row whose "Remove" button was clicked in order to determine the UserName of the user to remove.</span></span> <span data-ttu-id="72ad4-269">L'utente viene quindi rimosso dal ruolo tramite una chiamata al metodo `Roles.RemoveUserFromRole`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-269">The user is then removed from the role via a call to the `Roles.RemoveUserFromRole` method.</span></span> <span data-ttu-id="72ad4-270">Il `RolesUserList` GridView viene quindi aggiornato e viene visualizzato un messaggio tramite il controllo `ActionStatus` Label.</span><span class="sxs-lookup"><span data-stu-id="72ad4-270">The `RolesUserList` GridView is then refreshed and a message is displayed via the `ActionStatus` Label control.</span></span>

> [!NOTE]
> <span data-ttu-id="72ad4-271">Il pulsante "Rimuovi" non richiede alcun tipo di conferma da parte dell'utente prima di rimuovere l'utente dal ruolo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-271">The "Remove" button does not require any sort of confirmation from the user before removing the user from the role.</span></span> <span data-ttu-id="72ad4-272">Invito ad aggiungere un certo livello di conferma dell'utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-272">I invite you to add some level of user confirmation.</span></span> <span data-ttu-id="72ad4-273">Uno dei modi più semplici per confermare un'azione è tramite una finestra di dialogo di conferma lato client.</span><span class="sxs-lookup"><span data-stu-id="72ad4-273">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="72ad4-274">Per ulteriori informazioni su questa tecnica, vedere [aggiunta di una conferma lato client durante l'eliminazione](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span><span class="sxs-lookup"><span data-stu-id="72ad4-274">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>

<span data-ttu-id="72ad4-275">Nella figura 8 viene illustrata la pagina dopo la rimozione dell'utente Tito dal gruppo Supervisors.</span><span class="sxs-lookup"><span data-stu-id="72ad4-275">Figure 8 shows the page after user Tito has been removed from the Supervisors group.</span></span>

<span data-ttu-id="72ad4-276">[![ahimè, Tito non è più un supervisore](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-276">[![Alas, Tito is No Longer a Supervisor](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span></span>

<span data-ttu-id="72ad4-277">**Figura 8**: Ahimè, Tito non è più un supervisore ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-277">**Figure 8**: Alas, Tito is No Longer a Supervisor  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image24.png))</span></span>

### <a name="adding-new-users-to-the-selected-role"></a><span data-ttu-id="72ad4-278">Aggiunta di nuovi utenti al ruolo selezionato</span><span class="sxs-lookup"><span data-stu-id="72ad4-278">Adding New Users to the Selected Role</span></span>

<span data-ttu-id="72ad4-279">Insieme alla rimozione di utenti dal ruolo selezionato, anche il visitatore di questa pagina deve essere in grado di aggiungere un utente al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-279">Along with removing users from the selected role, the visitor to this page should also be able to add a user to the selected role.</span></span> <span data-ttu-id="72ad4-280">La migliore interfaccia per l'aggiunta di un utente al ruolo selezionato dipende dal numero di account utente previsti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-280">The best interface for adding a user to the selected role depends on the number of user accounts you expect to have.</span></span> <span data-ttu-id="72ad4-281">Se il sito Web ospita solo alcune dozzine di account utente o meno, è possibile usare un oggetto DropDownList qui.</span><span class="sxs-lookup"><span data-stu-id="72ad4-281">If your website will house just a few dozen user accounts or less, you could use a DropDownList here.</span></span> <span data-ttu-id="72ad4-282">Se potrebbero essere presenti migliaia di account utente, è opportuno includere un'interfaccia utente che consenta al visitatore di spostarsi tra gli account, cercare un account specifico o filtrare gli account utente in un altro modo.</span><span class="sxs-lookup"><span data-stu-id="72ad4-282">If there might be thousands of user accounts, you would want to include a user interface that permits the visitor to page through the accounts, search for a particular account, or filter the user accounts in some other fashion.</span></span>

<span data-ttu-id="72ad4-283">Per questa pagina, si userà un'interfaccia molto semplice che funziona indipendentemente dal numero di account utente nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-283">For this page let's use a very simple interface that works regardless of the number of user accounts in the system.</span></span> <span data-ttu-id="72ad4-284">In particolare, verrà usata una casella di testo che richiede al visitatore di digitare il nome utente dell'utente che desidera aggiungere al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-284">Namely, we will use a TextBox, prompting the visitor to type in the username of the user she wants to add to the selected role.</span></span> <span data-ttu-id="72ad4-285">Se non esiste alcun utente con lo stesso nome o se l'utente è già un membro del ruolo, verrà visualizzato un messaggio nell'etichetta `ActionStatus`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-285">If no user with that name exists, or if the user is already a member of the role, we'll display a message in `ActionStatus` Label.</span></span> <span data-ttu-id="72ad4-286">Tuttavia, se l'utente esiste e non è un membro del ruolo, verranno aggiunti al ruolo e verrà aggiornata la griglia.</span><span class="sxs-lookup"><span data-stu-id="72ad4-286">But if the user exists and is not a member of the role, we'll add them to the role and refresh the grid.</span></span>

<span data-ttu-id="72ad4-287">Aggiungere una casella di testo e un pulsante sotto GridView.</span><span class="sxs-lookup"><span data-stu-id="72ad4-287">Add a TextBox and Button beneath the GridView.</span></span> <span data-ttu-id="72ad4-288">Impostare la `ID` della casella di testo su `UserNameToAddToRole` e impostare le proprietà `ID` e `Text` del pulsante su `AddUserToRoleButton` e "Aggiungi utente al ruolo", rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-288">Set the TextBox's `ID` to `UserNameToAddToRole` and set the Button's `ID` and `Text` properties to `AddUserToRoleButton` and "Add User to Role", respectively.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample17.aspx)]

<span data-ttu-id="72ad4-289">Successivamente, creare un gestore dell'evento `Click` per il `AddUserToRoleButton` e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-289">Next, create a `Click` event handler for the `AddUserToRoleButton` and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample18.cs)]

<span data-ttu-id="72ad4-290">La maggior parte del codice nel gestore dell'evento `Click` esegue diversi controlli di convalida.</span><span class="sxs-lookup"><span data-stu-id="72ad4-290">The majority of the code in the `Click` event handler performs various validation checks.</span></span> <span data-ttu-id="72ad4-291">Garantisce che il visitatore abbia fornito un nome utente nella casella di testo `UserNameToAddToRole`, che l'utente esista nel sistema e che non appartenga già al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-291">It ensures that the visitor supplied a username in the `UserNameToAddToRole` TextBox, that the user exists in the system, and that they don't already belong to the selected role.</span></span> <span data-ttu-id="72ad4-292">Se uno di questi controlli ha esito negativo, viene visualizzato un messaggio appropriato in `ActionStatus` e il gestore eventi viene terminato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-292">If any of these checks fails, an appropriate message is displayed in `ActionStatus` and the event handler is exited.</span></span> <span data-ttu-id="72ad4-293">Se tutti i controlli vengono superati, l'utente viene aggiunto al ruolo tramite il metodo `Roles.AddUserToRole`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-293">If all of the checks pass, the user is added to the role via the `Roles.AddUserToRole` method.</span></span> <span data-ttu-id="72ad4-294">In seguito, la proprietà `Text` della casella di testo viene cancellata, il GridView viene aggiornato e l'etichetta `ActionStatus` Visualizza un messaggio che indica che l'utente specificato è stato aggiunto correttamente al ruolo selezionato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-294">Following that, the TextBox's `Text` property is cleared out, the GridView is refreshed, and the `ActionStatus` Label displays a message indicating that the specified user was successfully added to the selected role.</span></span>

> [!NOTE]
> <span data-ttu-id="72ad4-295">Per assicurarsi che l'utente specificato non appartenga già al ruolo selezionato, viene usato il [metodo`Roles.IsUserInRole(userName, roleName)`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), che restituisce un valore booleano che indica se *username* è un membro di *roleName*.</span><span class="sxs-lookup"><span data-stu-id="72ad4-295">To ensure that the specified user does not already belong to the selected role, we use the [`Roles.IsUserInRole(userName, roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), which returns a Boolean value indicating whether *userName* is a member of *roleName*.</span></span> <span data-ttu-id="72ad4-296">Questo metodo verrà usato nuovamente nell' <a id="_msoanchor_2"> </a> [esercitazione successiva](role-based-authorization-cs.md) quando si esamina l'autorizzazione basata sui ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-296">We will use this method again in the <a id="_msoanchor_2"></a>[next tutorial](role-based-authorization-cs.md) when we look at role-based authorization.</span></span>

<span data-ttu-id="72ad4-297">Visitare la pagina tramite un browser e selezionare il ruolo supervisori dal `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-297">Visit the page through a browser and select the Supervisors role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="72ad4-298">Provare a immettere un nome utente non valido. verrà visualizzato un messaggio che informa che l'utente non esiste nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-298">Try entering an invalid username – you should see a message explaining that the user does not exist in the system.</span></span>

<span data-ttu-id="72ad4-299">[![non è possibile aggiungere un utente non esistente a un ruolo](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-299">[![You Cannot Add a Non-Existent User to a Role](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span></span>

<span data-ttu-id="72ad4-300">**Figura 9**: non è possibile aggiungere un utente non esistente a un ruolo ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-300">**Figure 9**: You Cannot Add a Non-Existent User to a Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image27.png))</span></span>

<span data-ttu-id="72ad4-301">A questo punto, provare ad aggiungere un utente valido.</span><span class="sxs-lookup"><span data-stu-id="72ad4-301">Now try adding a valid user.</span></span> <span data-ttu-id="72ad4-302">Procedere e aggiungere nuovamente Tito al ruolo supervisori.</span><span class="sxs-lookup"><span data-stu-id="72ad4-302">Go ahead and re-add Tito to the Supervisors role.</span></span>

<span data-ttu-id="72ad4-303">[![Tito è ancora una volta un supervisore.](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-303">[![Tito Is Once Again a Supervisor!](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span></span>

<span data-ttu-id="72ad4-304">**Figura 10**: Tito è ancora una volta un supervisore.</span><span class="sxs-lookup"><span data-stu-id="72ad4-304">**Figure 10**: Tito Is Once Again a Supervisor!</span></span>  <span data-ttu-id="72ad4-305">([Fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-305">([Click to view full-size image](assigning-roles-to-users-cs/_static/image30.png))</span></span>

## <a name="step-3-cross-updating-the-by-user-and-by-role-interfaces"></a><span data-ttu-id="72ad4-306">Passaggio 3: aggiornamento incrociato delle interfacce "per utente" e "per ruolo"</span><span class="sxs-lookup"><span data-stu-id="72ad4-306">Step 3: Cross-Updating the "By User" and "By Role" Interfaces</span></span>

<span data-ttu-id="72ad4-307">La pagina `UsersAndRoles.aspx` offre due interfacce distinte per la gestione di utenti e ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-307">The `UsersAndRoles.aspx` page offers two distinct interfaces for managing users and roles.</span></span> <span data-ttu-id="72ad4-308">Attualmente, queste due interfacce agiscono in modo indipendente l'una dall'altra, quindi è possibile che una modifica apportata in un'interfaccia non venga riflessa immediatamente nell'altra.</span><span class="sxs-lookup"><span data-stu-id="72ad4-308">Currently, these two interfaces act independently of one another so it is possible that a change made in one interface will not be reflected immediately in the other.</span></span> <span data-ttu-id="72ad4-309">Si supponga, ad esempio, che il visitatore della pagina selezioni il ruolo Supervisore dalla `RoleList` DropDownList, che elenca Bruce e Tito come membri.</span><span class="sxs-lookup"><span data-stu-id="72ad4-309">For example, imagine that the visitor to the page selects the Supervisors role from the `RoleList` DropDownList, which lists Bruce and Tito as its members.</span></span> <span data-ttu-id="72ad4-310">Successivamente, il visitatore seleziona Tito dal `UserList` DropDownList, che controlla le caselle di controllo amministratori e supervisori nel `UsersRoleList` Repeater.</span><span class="sxs-lookup"><span data-stu-id="72ad4-310">Next, the visitor selects Tito from the `UserList` DropDownList, which checks the Administrators and Supervisors checkboxes in the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="72ad4-311">Se il visitatore deseleziona il ruolo di supervisore dal Repeater, Tito viene rimosso dal ruolo supervisori, ma questa modifica non viene riflessa nell'interfaccia "per ruolo".</span><span class="sxs-lookup"><span data-stu-id="72ad4-311">If the visitor then unchecks the Supervisor role from the Repeater, Tito is removed from the Supervisors role, but this modification is not reflected in the "by role" interface.</span></span> <span data-ttu-id="72ad4-312">Il controllo GridView mostrerà ancora Tito come membro del ruolo supervisori.</span><span class="sxs-lookup"><span data-stu-id="72ad4-312">The GridView will still show Tito as being a member of the Supervisors role.</span></span>

<span data-ttu-id="72ad4-313">Per risolvere questo problema, è necessario aggiornare GridView ogni volta che un ruolo viene selezionato o deselezionato dal ripetitore `UsersRoleList`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-313">To fix this we need to refresh the GridView whenever a role is checked or unchecked from the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="72ad4-314">Analogamente, è necessario aggiornare il ripetitore ogni volta che un utente viene rimosso o aggiunto a un ruolo dall'interfaccia "by Role".</span><span class="sxs-lookup"><span data-stu-id="72ad4-314">Likewise, we need to refresh the Repeater whenever a user is removed or added to a role from the "by role" interface.</span></span>

<span data-ttu-id="72ad4-315">Il ripetitore nell'interfaccia "da utente" viene aggiornato chiamando il metodo `CheckRolesForSelectedUser`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-315">The Repeater in the "by user" interface is refreshed by calling the `CheckRolesForSelectedUser` method.</span></span> <span data-ttu-id="72ad4-316">L'interfaccia "per ruolo" può essere modificata nel gestore dell'evento `RolesUserList` GridView `RowDeleting` e nel gestore dell'evento `Click` del pulsante `AddUserToRoleButton`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-316">The "by role" interface can be modified in the `RolesUserList` GridView's `RowDeleting` event handler and the `AddUserToRoleButton` Button's `Click` event handler.</span></span> <span data-ttu-id="72ad4-317">Pertanto, è necessario chiamare il metodo `CheckRolesForSelectedUser` da ognuno di questi metodi.</span><span class="sxs-lookup"><span data-stu-id="72ad4-317">Therefore, we need to call the `CheckRolesForSelectedUser` method from each of these methods.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample19.cs)]

<span data-ttu-id="72ad4-318">Analogamente, GridView nell'interfaccia "by Role" viene aggiornato chiamando il metodo `DisplayUsersBelongingToRole` e l'interfaccia "by User" viene modificata tramite il gestore dell'evento `RoleCheckBox_CheckChanged`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-318">Similarly, the GridView in the "by role" interface is refreshed by calling the `DisplayUsersBelongingToRole` method and the "by user" interface is modified through the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="72ad4-319">Pertanto, è necessario chiamare il metodo `DisplayUsersBelongingToRole` da questo gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="72ad4-319">Therefore, we need to call the `DisplayUsersBelongingToRole` method from this event handler.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample20.cs)]

<span data-ttu-id="72ad4-320">Con queste modifiche minime al codice, le interfacce "per utente" e "per ruolo" ora vengono correttamente incrociate.</span><span class="sxs-lookup"><span data-stu-id="72ad4-320">With these minor code changes, the "by user" and "by role" interfaces now correctly cross-update.</span></span> <span data-ttu-id="72ad4-321">Per verificarlo, visitare la pagina tramite un browser e selezionare Tito e Supervisors rispettivamente dal `UserList` e `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-321">To verify this, visit the page through a browser and select Tito and Supervisors from the `UserList` and `RoleList` DropDownLists, respectively.</span></span> <span data-ttu-id="72ad4-322">Si noti che quando si deseleziona il ruolo Supervisors per Tito dal Repeater nell'interfaccia "by User", Tito viene rimosso automaticamente da GridView nell'interfaccia "by Role".</span><span class="sxs-lookup"><span data-stu-id="72ad4-322">Note that as you uncheck the Supervisors role for Tito from the Repeater in the "by user" interface, Tito is automatically removed from the GridView in the "by role" interface.</span></span> <span data-ttu-id="72ad4-323">L'aggiunta di Tito al ruolo Supervisore dall'interfaccia "per ruolo" Ricontrolla automaticamente la casella di controllo supervisori nell'interfaccia "da utente".</span><span class="sxs-lookup"><span data-stu-id="72ad4-323">Adding Tito back to the Supervisors role from the "by role" interface automatically re-checks the Supervisors checkbox in the "by user" interface.</span></span>

## <a name="step-4-customizing-the-createuserwizard-to-include-a-specify-roles-step"></a><span data-ttu-id="72ad4-324">Passaggio 4: personalizzazione di CreateUserWizard per includere un passaggio "specifica ruoli"</span><span class="sxs-lookup"><span data-stu-id="72ad4-324">Step 4: Customizing the CreateUserWizard to Include a "Specify Roles" Step</span></span>

<span data-ttu-id="72ad4-325"><a id="_msoanchor_3"> </a>Nell'esercitazione [*creazione di account utente*](../membership/creating-user-accounts-cs.md) è stato illustrato come utilizzare il controllo Web CreateUserWizard per fornire un'interfaccia per la creazione di un nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-325">In the <a id="_msoanchor_3"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial we saw how to use the CreateUserWizard Web control to provide an interface for creating a new user account.</span></span> <span data-ttu-id="72ad4-326">Il controllo CreateUserWizard può essere utilizzato in uno dei due modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="72ad4-326">The CreateUserWizard control can be used in one of two ways:</span></span>

- <span data-ttu-id="72ad4-327">Come mezzo per i visitatori per creare il proprio account utente nel sito e</span><span class="sxs-lookup"><span data-stu-id="72ad4-327">As a means for visitors to create their own user account on the site, and</span></span>
- <span data-ttu-id="72ad4-328">Come mezzo per gli amministratori per la creazione di nuovi account</span><span class="sxs-lookup"><span data-stu-id="72ad4-328">As a means for administrators to create new accounts</span></span>

<span data-ttu-id="72ad4-329">Nel primo caso di utilizzo, un visitatore si avvicina al sito e compila l'oggetto CreateUserWizard, immettendo le informazioni per la registrazione sul sito.</span><span class="sxs-lookup"><span data-stu-id="72ad4-329">In the first use case, a visitor comes to the site and fills out the CreateUserWizard, entering their information in order to register on the site.</span></span> <span data-ttu-id="72ad4-330">Nel secondo caso, un amministratore crea un nuovo account per un altro utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-330">In the second case, an administrator creates a new account for another person.</span></span>

<span data-ttu-id="72ad4-331">Quando un account viene creato da un amministratore per un altro utente, può essere utile consentire all'amministratore di specificare a quali ruoli appartiene il nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-331">When an account is being created by an administrator for some other person, it might be helpful to allow the administrator to specify what roles the new user account belongs to.</span></span> <span data-ttu-id="72ad4-332">Nell'esercitazione sull' [ *archiviazione* di *informazioni utente aggiuntive* ](../membership/storing-additional-user-information-cs.md) è stato illustrato come personalizzare l'oggetto CreateUserWizard aggiungendo ulteriori `WizardSteps`. <a id="_msoanchor_4"> </a></span><span class="sxs-lookup"><span data-stu-id="72ad4-332">In the <a id="_msoanchor_4"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we saw how to customize the CreateUserWizard by adding additional `WizardSteps`.</span></span> <span data-ttu-id="72ad4-333">Viene ora illustrato come aggiungere un passaggio aggiuntivo a CreateUserWizard per specificare i ruoli del nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-333">Let's look at how to add an additional step to the CreateUserWizard in order to specify the new user's roles.</span></span>

<span data-ttu-id="72ad4-334">Aprire la pagina `CreateUserWizardWithRoles.aspx` e aggiungere un controllo CreateUserWizard denominato `RegisterUserWithRoles`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-334">Open the `CreateUserWizardWithRoles.aspx` page and add a CreateUserWizard control named `RegisterUserWithRoles`.</span></span> <span data-ttu-id="72ad4-335">Impostare la proprietà `ContinueDestinationPageUrl` del controllo su "~/default.aspx".</span><span class="sxs-lookup"><span data-stu-id="72ad4-335">Set the control's `ContinueDestinationPageUrl` property to "~/Default.aspx".</span></span> <span data-ttu-id="72ad4-336">Poiché l'idea è che un amministratore utilizzerà questo controllo CreateUserWizard per creare nuovi account utente, impostare la proprietà `LoginCreatedUser` del controllo su false.</span><span class="sxs-lookup"><span data-stu-id="72ad4-336">Because the idea here is that an administrator will be using this CreateUserWizard control to create new user accounts, set the control's `LoginCreatedUser` property to False.</span></span> <span data-ttu-id="72ad4-337">Questa proprietà `LoginCreatedUser` specifica se il visitatore viene automaticamente connesso come utente appena creato e il valore predefinito è true.</span><span class="sxs-lookup"><span data-stu-id="72ad4-337">This `LoginCreatedUser` property specifies whether the visitor is automatically logged on as the just-created user, and it defaults to True.</span></span> <span data-ttu-id="72ad4-338">Il valore è impostato su false, perché quando un amministratore crea un nuovo account si vuole mantenerlo connesso come se stesso.</span><span class="sxs-lookup"><span data-stu-id="72ad4-338">We set it to False because when an administrator creates a new account we want to keep him signed in as himself.</span></span>

<span data-ttu-id="72ad4-339">Selezionare quindi "Aggiungi/Rimuovi `WizardSteps`..." dallo smart tag di CreateUserWizard e aggiungere una nuova `WizardStep`, impostando la relativa `ID` su `SpecifyRolesStep`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-339">Next, select the "Add/Remove `WizardSteps`…" option from the CreateUserWizard's Smart Tag and add a new `WizardStep`, setting its `ID` to `SpecifyRolesStep`.</span></span> <span data-ttu-id="72ad4-340">Spostare il `SpecifyRolesStep WizardStep` in modo che venga eseguito dopo il passaggio "iscrizione al nuovo account", ma prima del passaggio "completo".</span><span class="sxs-lookup"><span data-stu-id="72ad4-340">Move the `SpecifyRolesStep WizardStep` so that it comes after the "Sign Up for Your New Account" step, but before the "Complete" step.</span></span> <span data-ttu-id="72ad4-341">Impostare la proprietà `Title` di `WizardStep`su "specifica ruoli", la relativa proprietà `StepType` su `Step`e la relativa proprietà `AllowReturn` su false.</span><span class="sxs-lookup"><span data-stu-id="72ad4-341">Set the `WizardStep`'s `Title` property to "Specify Roles", its `StepType` property to `Step`, and its `AllowReturn` property to False.</span></span>

<span data-ttu-id="72ad4-342">[![aggiungere il](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-342">[![Add the](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span></span>

<span data-ttu-id="72ad4-343">**Figura 11**: aggiungere il `WizardStep` "specificare i ruoli" a CreateUserWizard ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-343">**Figure 11**: Add the "Specify Roles" `WizardStep` to the CreateUserWizard  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image33.png))</span></span>

<span data-ttu-id="72ad4-344">Dopo questa modifica, il markup dichiarativo di CreateUserWizard dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-344">After this change your CreateUserWizard's declarative markup should look like the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample21.aspx)]

<span data-ttu-id="72ad4-345">Nella `WizardStep`"impostazione ruoli" aggiungere un oggetto CheckBoxList denominato `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-345">In the "Specify Roles" `WizardStep`, add a CheckBoxList named `RoleList`.</span></span> <span data-ttu-id="72ad4-346">Questo elemento CheckBoxList elenca i ruoli disponibili, consentendo all'utente che visita la pagina di verificare i ruoli a cui appartiene l'utente appena creato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-346">This CheckBoxList will list the available roles, enabling the person visiting the page to check what roles the newly created user belongs to.</span></span>

<span data-ttu-id="72ad4-347">Si rimane con due attività di codifica: prima di tutto è necessario popolare il `RoleList` CheckBoxList con i ruoli del sistema; in secondo luogo, è necessario aggiungere l'utente creato ai ruoli selezionati quando l'utente passa dal passaggio "specifica ruoli" al passaggio "completato".</span><span class="sxs-lookup"><span data-stu-id="72ad4-347">We are left with two coding tasks: first we must populate the `RoleList` CheckBoxList with the roles in the system; second, we need to add the created user to the selected roles when the user moves from the "Specify Roles" step to the "Complete" step.</span></span> <span data-ttu-id="72ad4-348">È possibile eseguire la prima attività nel gestore dell'evento `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-348">We can accomplish the first task in the `Page_Load` event handler.</span></span> <span data-ttu-id="72ad4-349">Il codice seguente fa riferimento a livello di codice alla casella di controllo `RoleList` alla prima visita alla pagina e associa i ruoli nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-349">The following code programmatically references the `RoleList` CheckBox on the first visit to the page and binds the roles in the system to it.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample22.cs)]

<span data-ttu-id="72ad4-350">Il codice precedente dovrebbe avere un aspetto familiare.</span><span class="sxs-lookup"><span data-stu-id="72ad4-350">The above code should look familiar.</span></span> <span data-ttu-id="72ad4-351">Nell'esercitazione <a id="_msoanchor_5"> </a> [ *archiviazione* di *informazioni aggiuntive sull'utente* ](../membership/storing-additional-user-information-cs.md) sono state usate due istruzioni `FindControl` per fare riferimento a un controllo Web dall'interno di un `WizardStep`personalizzato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-351">In the <a id="_msoanchor_5"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we used two `FindControl` statements to reference a Web control from within a custom `WizardStep`.</span></span> <span data-ttu-id="72ad4-352">Il codice che associa i ruoli al CheckBoxList è stato ricavato precedentemente in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="72ad4-352">And the code that binds the roles to the CheckBoxList was taken from earlier in this tutorial.</span></span>

<span data-ttu-id="72ad4-353">Per eseguire la seconda attività di programmazione, è necessario stabilire quando è stato completato il passaggio "specifica ruoli".</span><span class="sxs-lookup"><span data-stu-id="72ad4-353">In order to perform the second programming task we need to know when the "Specify Roles" step has been completed.</span></span> <span data-ttu-id="72ad4-354">Tenere presente che CreateUserWizard ha un evento `ActiveStepChanged`, che viene attivato ogni volta che il visitatore passa da un passaggio a un altro.</span><span class="sxs-lookup"><span data-stu-id="72ad4-354">Recall that the CreateUserWizard has an `ActiveStepChanged` event, which fires each time the visitor navigates from one step to another.</span></span> <span data-ttu-id="72ad4-355">Qui è possibile determinare se l'utente ha raggiunto il passaggio "completo"; in tal caso, è necessario aggiungere l'utente ai ruoli selezionati.</span><span class="sxs-lookup"><span data-stu-id="72ad4-355">Here we can determine if the user has reached the "Complete" step; if so, we need to add the user to the selected roles.</span></span>

<span data-ttu-id="72ad4-356">Creare un gestore eventi per l'evento `ActiveStepChanged` e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="72ad4-356">Create an event handler for the `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample23.cs)]

<span data-ttu-id="72ad4-357">Se l'utente ha appena raggiunto il passaggio "completato", il gestore eventi enumera gli elementi del `RoleList` CheckBoxList e l'utente appena creato viene assegnato ai ruoli selezionati.</span><span class="sxs-lookup"><span data-stu-id="72ad4-357">If the user has just reached the "Completed" step, the event handler enumerates the items of the `RoleList` CheckBoxList and the just-created user is assigned to the selected roles.</span></span>

<span data-ttu-id="72ad4-358">Visitare questa pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="72ad4-358">Visit this page through a browser.</span></span> <span data-ttu-id="72ad4-359">Il primo passaggio di CreateUserWizard è il passaggio standard "iscrizione al nuovo account", che richiede il nome utente, la password, la posta elettronica e altre informazioni chiave del nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-359">The first step in the CreateUserWizard is the standard "Sign Up for Your New Account" step, which prompts for the new user's username, password, email, and other key information.</span></span> <span data-ttu-id="72ad4-360">Immettere le informazioni per creare un nuovo utente denominato Wanda.</span><span class="sxs-lookup"><span data-stu-id="72ad4-360">Enter the information to create a new user named Wanda.</span></span>

<span data-ttu-id="72ad4-361">[![creare un nuovo utente denominato Wanda](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-361">[![Create a New User Named Wanda](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span></span>

<span data-ttu-id="72ad4-362">**Figura 12**: creare un nuovo utente denominato Wanda ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-362">**Figure 12**: Create a New User Named Wanda  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image36.png))</span></span>

<span data-ttu-id="72ad4-363">Fare clic sul pulsante "Crea utente".</span><span class="sxs-lookup"><span data-stu-id="72ad4-363">Click the "Create User" button.</span></span> <span data-ttu-id="72ad4-364">L'oggetto CreateUserWizard chiama internamente il metodo `Membership.CreateUser`, creando il nuovo account utente e quindi procede al passaggio successivo, "specifica ruoli".</span><span class="sxs-lookup"><span data-stu-id="72ad4-364">The CreateUserWizard internally calls the `Membership.CreateUser` method, creating the new user account, and then progresses to the next step, "Specify Roles."</span></span> <span data-ttu-id="72ad4-365">Qui vengono elencati i ruoli di sistema.</span><span class="sxs-lookup"><span data-stu-id="72ad4-365">Here the system roles are listed.</span></span> <span data-ttu-id="72ad4-366">Controllare la casella di controllo supervisori e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-366">Check the Supervisors checkbox and click Next.</span></span>

<span data-ttu-id="72ad4-367">[![rendere Wanda un membro del ruolo supervisori](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-367">[![Make Wanda a Member of the Supervisors Role](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span></span>

<span data-ttu-id="72ad4-368">**Figura 13**: rendere Wanda un membro del ruolo supervisori ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-368">**Figure 13**: Make Wanda a Member of the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image39.png))</span></span>

<span data-ttu-id="72ad4-369">Se si fa clic su Next, viene attivato un postback e viene aggiornato il `ActiveStep` al passaggio "complete".</span><span class="sxs-lookup"><span data-stu-id="72ad4-369">Clicking Next causes a postback and updates the `ActiveStep` to the "Complete" step.</span></span> <span data-ttu-id="72ad4-370">Nel gestore dell'evento `ActiveStepChanged`, l'account utente creato di recente viene assegnato al ruolo Supervisore.</span><span class="sxs-lookup"><span data-stu-id="72ad4-370">In the `ActiveStepChanged` event handler, the recently-created user account is assigned to the Supervisors role.</span></span> <span data-ttu-id="72ad4-371">Per verificarlo, tornare alla pagina `UsersAndRoles.aspx` e selezionare supervisori dall'`RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="72ad4-371">To verify this, return to the `UsersAndRoles.aspx` page and select Supervisors from the `RoleList` DropDownList.</span></span> <span data-ttu-id="72ad4-372">Come illustrato nella figura 14, i supervisori sono ora costituiti da tre utenti: Bruce, Tito e Wanda.</span><span class="sxs-lookup"><span data-stu-id="72ad4-372">As Figure 14 shows, the Supervisors are now made up of three users: Bruce, Tito, and Wanda.</span></span>

<span data-ttu-id="72ad4-373">[![Bruce, Tito e Wanda sono tutti i supervisori](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="72ad4-373">[![Bruce, Tito, and Wanda are All Supervisors](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span></span>

<span data-ttu-id="72ad4-374">**Figura 14**: Bruce, Tito e Wanda sono tutti i supervisori ([fare clic per visualizzare l'immagine con dimensioni complete](assigning-roles-to-users-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="72ad4-374">**Figure 14**: Bruce, Tito, and Wanda are All Supervisors  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image42.png))</span></span>

## <a name="summary"></a><span data-ttu-id="72ad4-375">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="72ad4-375">Summary</span></span>

<span data-ttu-id="72ad4-376">Il Framework dei ruoli offre metodi per il recupero di informazioni sui ruoli e i metodi di un utente specifico per determinare gli utenti che appartengono a un ruolo specificato.</span><span class="sxs-lookup"><span data-stu-id="72ad4-376">The Roles framework offers methods for retrieving information about a particular user's roles and methods for determining what users belong to a specified role.</span></span> <span data-ttu-id="72ad4-377">Sono inoltre disponibili diversi metodi per l'aggiunta e la rimozione di uno o più utenti in uno o più ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-377">Furthermore, there are a number of methods for adding and removing one or more users to one or more roles.</span></span> <span data-ttu-id="72ad4-378">In questa esercitazione sono stati concentrati solo due di questi metodi: `AddUserToRole` e `RemoveUserFromRole`.</span><span class="sxs-lookup"><span data-stu-id="72ad4-378">In this tutorial we focused on just two of these methods: `AddUserToRole` and `RemoveUserFromRole`.</span></span> <span data-ttu-id="72ad4-379">Sono disponibili varianti aggiuntive progettate per aggiungere più utenti a un singolo ruolo e per assegnare più ruoli a un singolo utente.</span><span class="sxs-lookup"><span data-stu-id="72ad4-379">There are additional variants designed to add multiple users to a single role and to assign multiple roles to a single user.</span></span>

<span data-ttu-id="72ad4-380">Questa esercitazione include anche un'estensione del controllo CreateUserWizard per includere un `WizardStep` per specificare i ruoli utente appena creati.</span><span class="sxs-lookup"><span data-stu-id="72ad4-380">This tutorial also included a look at extending the CreateUserWizard control to include a `WizardStep` to specify the newly-created user's roles.</span></span> <span data-ttu-id="72ad4-381">Questo passaggio potrebbe consentire a un amministratore di semplificare il processo di creazione di account utente per i nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-381">Such a step could help an administrator streamline the process of creating user accounts for new users.</span></span>

<span data-ttu-id="72ad4-382">A questo punto è stato illustrato come creare ed eliminare ruoli e come aggiungere e rimuovere utenti dai ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-382">At this point we have seen how to create and delete roles and how to add and remove users from roles.</span></span> <span data-ttu-id="72ad4-383">Tuttavia è ancora necessario esaminare l'applicazione dell'autorizzazione basata sui ruoli.</span><span class="sxs-lookup"><span data-stu-id="72ad4-383">But we have yet to look at applying role-based authorization.</span></span> <span data-ttu-id="72ad4-384"><a id="_msoanchor_6"> </a>Nell' [esercitazione seguente](role-based-authorization-cs.md) si esaminerà la definizione delle regole di autorizzazione degli URL in base al ruolo, nonché come limitare la funzionalità a livello di pagina in base ai ruoli dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="72ad4-384">In the <a id="_msoanchor_6"></a>[following tutorial](role-based-authorization-cs.md) we will look at defining URL authorization rules on a role-by-role basis, as well as how to limit page-level functionality based on the currently logged in user's roles.</span></span>

<span data-ttu-id="72ad4-385">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="72ad4-385">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="72ad4-386">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="72ad4-386">Further Reading</span></span>

<span data-ttu-id="72ad4-387">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="72ad4-387">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="72ad4-388">Panoramica dello strumento Amministrazione sito Web di ASP.NET</span><span class="sxs-lookup"><span data-stu-id="72ad4-388">ASP.NET Web Site Administration Tool Overview</span></span>](https://msdn.microsoft.com/library/ms228053.aspx)
- [<span data-ttu-id="72ad4-389">Esame di ASP. Appartenenza, ruoli e profilo di NET</span><span class="sxs-lookup"><span data-stu-id="72ad4-389">Examining ASP.NET's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="72ad4-390">Implementazione dello strumento di amministrazione del sito Web</span><span class="sxs-lookup"><span data-stu-id="72ad4-390">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="72ad4-391">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="72ad4-391">About the Author</span></span>

<span data-ttu-id="72ad4-392">Scott Mitchell, autore di più libri ASP/ASP. NET e fondatore di 4GuysFromRolla.com, collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="72ad4-392">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="72ad4-393">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="72ad4-393">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="72ad4-394">Il suo ultimo libro è *[Sams Teach Yourself ASP.NET 2,0 in 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="72ad4-394">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="72ad4-395">Scott può essere raggiunto in [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog al [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="72ad4-395">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="72ad4-396">Ringraziamento speciale a...</span><span class="sxs-lookup"><span data-stu-id="72ad4-396">Special Thanks To…</span></span>

<span data-ttu-id="72ad4-397">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="72ad4-397">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="72ad4-398">Il revisore principale di questa esercitazione era Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="72ad4-398">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="72ad4-399">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="72ad4-399">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="72ad4-400">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="72ad4-400">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="72ad4-401">[Precedente](creating-and-managing-roles-cs.md)
> [Successivo](role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="72ad4-401">[Previous](creating-and-managing-roles-cs.md)
[Next](role-based-authorization-cs.md)</span></span>
