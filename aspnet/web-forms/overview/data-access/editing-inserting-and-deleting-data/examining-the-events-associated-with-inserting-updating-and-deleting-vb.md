---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
title: Analisi degli eventi associati a inserimento, aggiornamento ed eliminazione (VB) | Microsoft Docs
author: rick-anderson
description: In questa esercitazione verranno esaminati gli eventi che si verificano prima, durante e dopo un'operazione di inserimento, aggiornamento o eliminazione di un controllo Web di dati ASP.NET. N...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: c9bd10a7-eff8-4d8c-bec9-963c2aef2d6e
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
msc.type: authoredcontent
ms.openlocfilehash: 35edb3cefc6fe23bb56e667c02d10dc7798f730d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74633131"
---
# <a name="examining-the-events-associated-with-inserting-updating-and-deleting-vb"></a><span data-ttu-id="303fc-104">Analisi degli eventi associati a inserimento, aggiornamento ed eliminazione (VB)</span><span class="sxs-lookup"><span data-stu-id="303fc-104">Examining the Events Associated with Inserting, Updating, and Deleting (VB)</span></span>

<span data-ttu-id="303fc-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="303fc-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="303fc-106">[Scaricare l'app di esempio](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe) o [scaricare il file PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="303fc-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span></span>

> <span data-ttu-id="303fc-107">In questa esercitazione verranno esaminati gli eventi che si verificano prima, durante e dopo un'operazione di inserimento, aggiornamento o eliminazione di un controllo Web di dati ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="303fc-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="303fc-108">Verrà inoltre illustrato come personalizzare l'interfaccia di modifica per aggiornare solo un subset dei campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="introduction"></a><span data-ttu-id="303fc-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="303fc-109">Introduction</span></span>

<span data-ttu-id="303fc-110">Quando si usano le funzionalità di inserimento, modifica o eliminazione predefinite dei controlli GridView, DetailsView o FormView, una serie di passaggi traspare quando l'utente finale completa il processo di aggiunta di un nuovo record o di aggiornamento o eliminazione di un record esistente.</span><span class="sxs-lookup"><span data-stu-id="303fc-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="303fc-111">Come illustrato nell' [esercitazione precedente](an-overview-of-inserting-updating-and-deleting-data-vb.md), quando una riga viene modificata in GridView il pulsante modifica viene sostituito dai pulsanti Aggiorna e Annulla e i BoundField diventano caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="303fc-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-vb.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="303fc-112">Dopo che l'utente finale ha aggiornato i dati e fa clic su Aggiorna, durante il postback vengono eseguiti i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="303fc-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="303fc-113">GridView popola la `UpdateParameters` di ObjectDataSource con i campi di identificazione univoci del record modificato (tramite la proprietà `DataKeyNames`) insieme ai valori immessi dall'utente.</span><span class="sxs-lookup"><span data-stu-id="303fc-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="303fc-114">GridView richiama il metodo di `Update()` di ObjectDataSource, che a sua volta richiama il metodo appropriato nell'oggetto sottostante (`ProductsDAL.UpdateProduct`, nell'esercitazione precedente)</span><span class="sxs-lookup"><span data-stu-id="303fc-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="303fc-115">I dati sottostanti, che ora includono le modifiche aggiornate, vengono riassociati a GridView</span><span class="sxs-lookup"><span data-stu-id="303fc-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="303fc-116">Durante questa sequenza di passaggi, viene attivato un certo numero di eventi che consente di creare gestori di eventi per aggiungere la logica personalizzata laddove necessario.</span><span class="sxs-lookup"><span data-stu-id="303fc-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="303fc-117">Ad esempio, prima del passaggio 1, viene generato l'evento `RowUpdating` di GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="303fc-118">A questo punto, è possibile annullare la richiesta di aggiornamento se si verifica un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="303fc-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="303fc-119">Quando viene richiamato il metodo `Update()`, viene generato l'evento `Updating` di ObjectDataSource, che offre la possibilità di aggiungere o personalizzare i valori di uno qualsiasi dei `UpdateParameters`.</span><span class="sxs-lookup"><span data-stu-id="303fc-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="303fc-120">Al termine dell'esecuzione del metodo dell'oggetto sottostante di ObjectDataSource, viene generato l'evento `Updated` di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="303fc-121">Un gestore eventi per l'evento `Updated` può ispezionare i dettagli relativi all'operazione di aggiornamento, ad esempio il numero di righe interessate e se si è verificata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="303fc-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="303fc-122">Infine, dopo il passaggio 2, viene generato l'evento `RowUpdated` di GridView; un gestore eventi per questo evento può esaminare informazioni aggiuntive sull'operazione di aggiornamento appena eseguita.</span><span class="sxs-lookup"><span data-stu-id="303fc-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="303fc-123">Nella figura 1 viene illustrata questa serie di eventi e passaggi quando si aggiorna un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="303fc-124">Il modello di eventi nella figura 1 non è univoco per l'aggiornamento con un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="303fc-125">L'inserimento, l'aggiornamento o l'eliminazione di dati da GridView, DetailsView o FormView precipita la stessa sequenza di eventi di pre-e post-livello sia per il controllo Web dati che per ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>

<span data-ttu-id="303fc-126">[![una serie di eventi pre-e post-evento attivati durante l'aggiornamento dei dati in un controllo GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span></span>

<span data-ttu-id="303fc-127">**Figura 1**: una serie di eventi pre-e post-evento attivati durante l'aggiornamento dei dati in un controllo GridView ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span></span>

<span data-ttu-id="303fc-128">In questa esercitazione verrà esaminato l'uso di questi eventi per estendere le funzionalità di inserimento, aggiornamento ed eliminazione predefinite dei controlli Web dei dati di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="303fc-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="303fc-129">Verrà inoltre illustrato come personalizzare l'interfaccia di modifica per aggiornare solo un subset dei campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="303fc-130">Passaggio 1: aggiornamento dei campi di`ProductName`e`UnitPrice`di un prodotto</span><span class="sxs-lookup"><span data-stu-id="303fc-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="303fc-131">Nelle interfacce di modifica dell'esercitazione precedente sono stati inclusi *tutti i* campi di prodotto che non erano di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="303fc-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="303fc-132">Se dovessimo rimuovere un campo dall'`QuantityPerUnit` GridView-Say quando si aggiornano i dati, il controllo Web dei dati non imposterà il valore del `UpdateParameters` `QuantityPerUnit` di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="303fc-133">ObjectDataSource passa quindi un valore di `Nothing` al metodo `UpdateProduct` Business Logic Layer (BLL), che modifica la colonna di `QuantityPerUnit` del record del database modificato in un valore di `NULL`.</span><span class="sxs-lookup"><span data-stu-id="303fc-133">The ObjectDataSource would then pass in a value of `Nothing` into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="303fc-134">Analogamente, se un campo obbligatorio, ad esempio `ProductName`, viene rimosso dall'interfaccia di modifica, l'aggiornamento avrà esito negativo con un'eccezione "*Column ' ProductName ' non consente valori null*".</span><span class="sxs-lookup"><span data-stu-id="303fc-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="303fc-135">Il motivo di questo comportamento è dovuto al fatto che ObjectDataSource è stato configurato per chiamare il metodo `UpdateProduct` della classe `ProductsBLL`, che prevede un parametro di input per ognuno dei campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="303fc-136">Pertanto, la raccolta `UpdateParameters` di ObjectDataSource conteneva un parametro per ognuno dei parametri di input del metodo.</span><span class="sxs-lookup"><span data-stu-id="303fc-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="303fc-137">Se si vuole fornire un controllo Web dati che consente all'utente finale di aggiornare solo un subset di campi, è necessario impostare a livello di codice i valori di `UpdateParameters` mancanti nel gestore eventi di ObjectDataSource `Updating` oppure creare e chiamare un metodo BLL che prevede solo un subset dei campi.</span><span class="sxs-lookup"><span data-stu-id="303fc-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="303fc-138">Si analizzerà questo secondo approccio.</span><span class="sxs-lookup"><span data-stu-id="303fc-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="303fc-139">In particolare, creiamo una pagina che visualizzi solo i campi `ProductName` e `UnitPrice` in un GridView modificabile.</span><span class="sxs-lookup"><span data-stu-id="303fc-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="303fc-140">Questa interfaccia di modifica di GridView consente solo all'utente di aggiornare i due campi visualizzati, `ProductName` e `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="303fc-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="303fc-141">Poiché questa interfaccia di modifica fornisce solo un subset dei campi di un prodotto, è necessario creare un ObjectDataSource che usi il metodo di `UpdateProduct` del BLL esistente e che i valori dei campi prodotto mancanti siano impostati a livello di codice nel gestore eventi `Updating` oppure è necessario creare un nuovo metodo BLL che prevede solo il subset di campi definiti in GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="303fc-142">Per questa esercitazione, si userà la seconda opzione e si creerà un overload del metodo `UpdateProduct`, uno che accetta solo tre parametri di input: `productName`, `unitPrice`e `productID`:</span><span class="sxs-lookup"><span data-stu-id="303fc-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample1.vb)]

<span data-ttu-id="303fc-143">Come il metodo di `UpdateProduct` originale, questo overload inizia controllando la presenza di un prodotto nel database con la `ProductID`specificata.</span><span class="sxs-lookup"><span data-stu-id="303fc-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="303fc-144">In caso contrario, restituisce `False`, che indica che la richiesta di aggiornamento delle informazioni sul prodotto non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="303fc-144">If not, it returns `False`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="303fc-145">In caso contrario, aggiorna i campi `ProductName` e `UnitPrice` del record del prodotto esistente ed effettua il commit dell'aggiornamento chiamando il metodo `Update()` del TableAdapter, passando l'istanza di `ProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="303fc-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdapter's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="303fc-146">Con questa aggiunta alla classe `ProductsBLL`, è possibile creare l'interfaccia GridView semplificata.</span><span class="sxs-lookup"><span data-stu-id="303fc-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="303fc-147">Aprire il `DataModificationEvents.aspx` nella cartella `EditInsertDelete` e aggiungere un controllo GridView alla pagina.</span><span class="sxs-lookup"><span data-stu-id="303fc-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="303fc-148">Creare un nuovo ObjectDataSource e configurarlo per l'uso della classe `ProductsBLL` con il relativo mapping del metodo `Select()` per `GetProducts` e il metodo di `Update()` mapping all'overload `UpdateProduct` che accetta solo i parametri di input `productName`, `unitPrice`e `productID`.</span><span class="sxs-lookup"><span data-stu-id="303fc-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="303fc-149">Nella figura 2 viene illustrata la creazione guidata origine dati quando si esegue il mapping del metodo `Update()` di ObjectDataSource al nuovo overload del metodo `UpdateProduct` della classe `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="303fc-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>

<span data-ttu-id="303fc-150">[![mappare il metodo Update () di ObjectDataSource al nuovo overload UpdateProduct](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span></span>

<span data-ttu-id="303fc-151">**Figura 2**: eseguire il mapping del metodo di `Update()` di ObjectDataSource al nuovo overload `UpdateProduct` ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span></span>

<span data-ttu-id="303fc-152">Poiché in questo esempio inizialmente è sufficiente avere la possibilità di modificare i dati, ma non di inserire o eliminare i record, è necessario indicare in modo esplicito che i metodi di `Insert()` e `Delete()` di ObjectDataSource non devono essere mappati a uno dei metodi della classe `ProductsBLL` passando alle schede Inserisci ed Elimina e scegliendo (nessuno) dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="303fc-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>

<span data-ttu-id="303fc-153">[![scegliere (nessuno) dall'elenco a discesa per le schede Inserisci ed Elimina](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span></span>

<span data-ttu-id="303fc-154">**Figura 3**: scegliere (nessuno) dall'elenco a discesa per le schede Inserisci ed Elimina ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span></span>

<span data-ttu-id="303fc-155">Al termine della procedura guidata, selezionare la casella di controllo Abilita modifica dallo smart tag di GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="303fc-156">Con il completamento della creazione guidata origine dati e l'associazione a GridView, Visual Studio ha creato la sintassi dichiarativa per entrambi i controlli.</span><span class="sxs-lookup"><span data-stu-id="303fc-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="303fc-157">Passare alla visualizzazione origine per esaminare il markup dichiarativo di ObjectDataSource, illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="303fc-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample2.aspx)]

<span data-ttu-id="303fc-158">Poiché non sono disponibili mapping per i metodi `Insert()` e `Delete()` di ObjectDataSource, non sono presenti sezioni `InsertParameters` o `DeleteParameters`.</span><span class="sxs-lookup"><span data-stu-id="303fc-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="303fc-159">Inoltre, poiché il metodo `Update()` viene mappato all'overload del metodo `UpdateProduct` che accetta solo tre parametri di input, la sezione `UpdateParameters` ha solo tre istanze di `Parameter`.</span><span class="sxs-lookup"><span data-stu-id="303fc-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="303fc-160">Si noti che la proprietà `OldValuesParameterFormatString` di ObjectDataSource è impostata su `original_{0}`.</span><span class="sxs-lookup"><span data-stu-id="303fc-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="303fc-161">Questa proprietà viene impostata automaticamente da Visual Studio quando si utilizza la configurazione guidata origine dati.</span><span class="sxs-lookup"><span data-stu-id="303fc-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="303fc-162">Tuttavia, poiché i metodi BLL non prevedono il passaggio del valore di `ProductID` originale, rimuovere completamente questa assegnazione della proprietà dalla sintassi dichiarativa di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="303fc-163">Se si deseleziona semplicemente il valore della proprietà `OldValuesParameterFormatString` dal Finestra Proprietà nella visualizzazione progettazione, la proprietà sarà ancora presente nella sintassi dichiarativa, ma verrà impostata su una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="303fc-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="303fc-164">Rimuovere interamente la proprietà dalla sintassi dichiarativa oppure, dal Finestra Proprietà, impostare il valore predefinito, `{0}`.</span><span class="sxs-lookup"><span data-stu-id="303fc-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>

<span data-ttu-id="303fc-165">Mentre ObjectDataSource ha solo `UpdateParameters` per il nome, il prezzo e l'ID del prodotto, Visual Studio ha aggiunto un BoundField o CheckBoxField in GridView per ognuno dei campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>

<span data-ttu-id="303fc-166">[![GridView contiene un BoundField o CheckBoxField per ognuno dei campi del prodotto](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span></span>

<span data-ttu-id="303fc-167">**Figura 4**: GridView contiene un BoundField o CheckBoxField per ognuno dei campi del prodotto ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span></span>

<span data-ttu-id="303fc-168">Quando l'utente finale modifica un prodotto e fa clic sul pulsante Aggiorna, GridView enumera i campi che non sono di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="303fc-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="303fc-169">Imposta quindi il valore del parametro corrispondente nella raccolta `UpdateParameters` di ObjectDataSource sul valore immesso dall'utente.</span><span class="sxs-lookup"><span data-stu-id="303fc-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="303fc-170">Se non è presente un parametro corrispondente, GridView ne aggiunge uno alla raccolta.</span><span class="sxs-lookup"><span data-stu-id="303fc-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="303fc-171">Pertanto, se il controllo GridView contiene BoundField e CheckBoxFields per tutti i campi del prodotto, ObjectDataSource richiamerà l'overload `UpdateProduct` che accetta tutti questi parametri, nonostante il fatto che il markup dichiarativo di ObjectDataSource specifichi solo tre parametri di input (vedere la figura 5).</span><span class="sxs-lookup"><span data-stu-id="303fc-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="303fc-172">Analogamente, se in GridView è presente una combinazione di campi di prodotto non di sola lettura che non corrisponde ai parametri di input per un overload di `UpdateProduct`, viene generata un'eccezione durante il tentativo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="303fc-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>

<span data-ttu-id="303fc-173">[![GridView aggiungerà parametri alla raccolta UpdateParameters di ObjectDataSource](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span></span>

<span data-ttu-id="303fc-174">**Figura 5**: GridView aggiungerà parametri alla raccolta di `UpdateParameters` di ObjectDataSource ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span></span>

<span data-ttu-id="303fc-175">Per assicurarsi che ObjectDataSource richiami l'overload del `UpdateProduct` che accetta solo il nome, il prezzo e l'ID del prodotto, è necessario limitare il controllo GridView alla presenza di campi modificabili solo per `ProductName` e `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="303fc-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="303fc-176">Questa operazione può essere eseguita rimuovendo gli altri BoundField e CheckBoxFields, impostando tali campi `ReadOnly` proprietà su `True`o una combinazione dei due.</span><span class="sxs-lookup"><span data-stu-id="303fc-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `True`, or by some combination of the two.</span></span> <span data-ttu-id="303fc-177">Per questa esercitazione, è sufficiente rimuovere tutti i campi GridView eccetto i BoundField `ProductName` e `UnitPrice`, dopo i quali il markup dichiarativo di GridView sarà simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="303fc-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample3.aspx)]

<span data-ttu-id="303fc-178">Anche se l'overload di `UpdateProduct` prevede tre parametri di input, sono disponibili solo due BoundField in GridView.</span><span class="sxs-lookup"><span data-stu-id="303fc-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="303fc-179">Questo perché il parametro di input `productID` è un valore di chiave primaria e viene passato tramite il valore della proprietà `DataKeyNames` per la riga modificata.</span><span class="sxs-lookup"><span data-stu-id="303fc-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="303fc-180">Il GridView, insieme all'overload `UpdateProduct`, consente a un utente di modificare solo il nome e il prezzo di un prodotto senza perdere gli altri campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>

<span data-ttu-id="303fc-181">[![l'interfaccia consente di modificare solo il nome e il prezzo del prodotto](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span></span>

<span data-ttu-id="303fc-182">**Figura 6**: l'interfaccia consente di modificare solo il nome e il prezzo del prodotto ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="303fc-183">Come illustrato nell'esercitazione precedente, è estremamente importante che lo stato di visualizzazione di GridView s sia abilitato (comportamento predefinito).</span><span class="sxs-lookup"><span data-stu-id="303fc-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="303fc-184">Se si imposta la proprietà `EnableViewState` GridView s su `false`, si rischia di avere utenti simultanei che eliminano o modificano inavvertitamente i record.</span><span class="sxs-lookup"><span data-stu-id="303fc-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="303fc-185">Vedere [Avviso: problema di concorrenza con ASP.NET 2,0 GridView/DetailsView/formviews che supportano la modifica e/o l'eliminazione e il cui stato di visualizzazione è disabilitato](http://scottonwriting.net/sowblog/posts/10054.aspx) per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="303fc-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="303fc-186">Miglioramento della formattazione`UnitPrice`</span><span class="sxs-lookup"><span data-stu-id="303fc-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="303fc-187">Mentre l'esempio di GridView illustrato nella figura 6 funziona, il campo `UnitPrice` non è formattato, ottenendo una visualizzazione dei prezzi priva di simboli di valuta e con quattro posizioni decimali.</span><span class="sxs-lookup"><span data-stu-id="303fc-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="303fc-188">Per applicare una formattazione di valuta per le righe non modificabili, è sufficiente impostare la proprietà `DataFormatString` di `UnitPrice` BoundField su `{0:c}` e la relativa proprietà `HtmlEncode` su `False`.</span><span class="sxs-lookup"><span data-stu-id="303fc-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `False`.</span></span>

<span data-ttu-id="303fc-189">[![impostare le proprietà DataFormatString e HtmlEncode di PrezzoUnitario di conseguenza](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span></span>

<span data-ttu-id="303fc-190">**Figura 7**: impostare di conseguenza le proprietà `DataFormatString` e `HtmlEncode` di `UnitPrice`([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span></span>

<span data-ttu-id="303fc-191">Con questa modifica, le righe non modificabili formattano il prezzo come valuta; la riga modificata, tuttavia, Visualizza comunque il valore senza il simbolo di valuta e con quattro posizioni decimali.</span><span class="sxs-lookup"><span data-stu-id="303fc-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>

<span data-ttu-id="303fc-192">[![le righe non modificabili sono ora formattate come valori di valuta](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-192">[![The Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span></span>

<span data-ttu-id="303fc-193">**Figura 8**: le righe non modificabili sono ora formattate come valori di valuta ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-193">**Figure 8**: The Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span></span>

<span data-ttu-id="303fc-194">Le istruzioni di formattazione specificate nella proprietà `DataFormatString` possono essere applicate all'interfaccia di modifica impostando la proprietà di `ApplyFormatInEditMode` del BoundField su `True` (il valore predefinito è `False`).</span><span class="sxs-lookup"><span data-stu-id="303fc-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `True` (the default is `False`).</span></span> <span data-ttu-id="303fc-195">Impostare questa proprietà su `True`.</span><span class="sxs-lookup"><span data-stu-id="303fc-195">Take a moment to set this property to `True`.</span></span>

<span data-ttu-id="303fc-196">[![impostare la proprietà ApplyFormatInEditMode di PrezzoUnitario BoundField su true](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span></span>

<span data-ttu-id="303fc-197">**Figura 9**: impostare la proprietà `ApplyFormatInEditMode` di `UnitPrice` BoundField su `True` ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `True` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span></span>

<span data-ttu-id="303fc-198">Con questa modifica, il valore della `UnitPrice` visualizzata nella riga modificata viene anche formattato come valuta.</span><span class="sxs-lookup"><span data-stu-id="303fc-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>

<span data-ttu-id="303fc-199">[![il valore PrezzoUnitario della riga modificata ora è formattato come valuta](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span></span>

<span data-ttu-id="303fc-200">**Figura 10**: il valore `UnitPrice` della riga modificata è ora formattato come valuta ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span></span>

<span data-ttu-id="303fc-201">Tuttavia, l'aggiornamento di un prodotto con il simbolo di valuta nella casella di testo, ad esempio $19,00, genera un'`FormatException`.</span><span class="sxs-lookup"><span data-stu-id="303fc-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="303fc-202">Quando GridView tenta di assegnare i valori forniti dall'utente alla raccolta `UpdateParameters` di ObjectDataSource, non è in grado di convertire la stringa `UnitPrice` "$19,00" nel `Decimal` richiesto dal parametro (vedere la figura 11).</span><span class="sxs-lookup"><span data-stu-id="303fc-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `Decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="303fc-203">Per ovviare a questo problema, è possibile creare un gestore eventi per l'evento `RowUpdating` di GridView e fare in modo che analizzi il `UnitPrice` fornito dall'utente come `Decimal`formattato per la valuta.</span><span class="sxs-lookup"><span data-stu-id="303fc-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `Decimal`.</span></span>

<span data-ttu-id="303fc-204">L'evento `RowUpdating` di GridView accetta come secondo parametro un oggetto di tipo [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), che include un dizionario `NewValues` come una delle proprietà che contiene i valori forniti dall'utente pronti per essere assegnati alla raccolta di `UpdateParameters` di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="303fc-205">È possibile sovrascrivere il valore di `UnitPrice` esistente nella raccolta `NewValues` con un valore decimale analizzato utilizzando il formato di valuta con le righe di codice seguenti nel gestore dell'evento `RowUpdating`:</span><span class="sxs-lookup"><span data-stu-id="303fc-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample4.vb)]

<span data-ttu-id="303fc-206">Se l'utente ha fornito un valore `UnitPrice` (ad esempio "$19,00"), questo valore viene sovrascritto con il valore decimale calcolato da [Decimal. Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), analizzando il valore come valuta.</span><span class="sxs-lookup"><span data-stu-id="303fc-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="303fc-207">Questo analizzerà correttamente il separatore decimale in caso di simboli di valuta, virgole, separatori decimali e così via e usa l' [enumerazione NumberStyles](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) nello spazio dei nomi [System. Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) .</span><span class="sxs-lookup"><span data-stu-id="303fc-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="303fc-208">Nella figura 11 viene illustrato il problema causato da simboli di valuta nel `UnitPrice`fornito dall'utente, insieme a come il gestore dell'evento `RowUpdating` di GridView può essere utilizzato per analizzare correttamente tale input.</span><span class="sxs-lookup"><span data-stu-id="303fc-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>

<span data-ttu-id="303fc-209">[![il valore PrezzoUnitario della riga modificata ora è formattato come valuta](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span></span>

<span data-ttu-id="303fc-210">**Figura 11**: il valore `UnitPrice` della riga modificata è ora formattato come valuta ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span></span>

## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="303fc-211">Passaggio 2: divieto di`NULL UnitPrices`</span><span class="sxs-lookup"><span data-stu-id="303fc-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="303fc-212">Mentre il database è configurato in modo da consentire `NULL` valori nella colonna `UnitPrice` della tabella `Products`, potrebbe essere necessario impedire agli utenti che visitano questa particolare pagina di specificare un valore di `UnitPrice` `NULL`.</span><span class="sxs-lookup"><span data-stu-id="303fc-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="303fc-213">Ovvero, se un utente non è in grado di immettere un valore `UnitPrice` durante la modifica di una riga di prodotto, anziché salvare i risultati nel database, si desidera visualizzare un messaggio che informa l'utente che in questa pagina tutti i prodotti modificati devono avere un prezzo specificato.</span><span class="sxs-lookup"><span data-stu-id="303fc-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="303fc-214">L'oggetto `GridViewUpdateEventArgs` passato nel gestore dell'evento `RowUpdating` di GridView contiene una proprietà `Cancel` che, se impostata su `True`, termina il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="303fc-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `True`, terminates the updating process.</span></span> <span data-ttu-id="303fc-215">Si estenderà il gestore dell'evento `RowUpdating` per impostare `e.Cancel` su `True` e viene visualizzato un messaggio che spiega il motivo per cui il valore `UnitPrice` nella raccolta `NewValues` ha un valore di `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="303fc-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `True` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection has a value of `Nothing`.</span></span>

<span data-ttu-id="303fc-216">Per iniziare, aggiungere un controllo Web Label alla pagina denominata `MustProvideUnitPriceMessage`.</span><span class="sxs-lookup"><span data-stu-id="303fc-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="303fc-217">Questo controllo etichetta viene visualizzato se l'utente non è in grado di specificare un valore `UnitPrice` durante l'aggiornamento di un prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="303fc-218">Impostare la proprietà `Text` dell'etichetta su "è necessario fornire un prezzo per il prodotto".</span><span class="sxs-lookup"><span data-stu-id="303fc-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="303fc-219">Ho creato anche una nuova classe CSS in `Styles.css` denominata `Warning` con la definizione seguente:</span><span class="sxs-lookup"><span data-stu-id="303fc-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>

[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample5.css)]

<span data-ttu-id="303fc-220">Infine, impostare la proprietà `CssClass` dell'etichetta su `Warning`.</span><span class="sxs-lookup"><span data-stu-id="303fc-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="303fc-221">A questo punto, nella finestra di progettazione dovrebbe essere visualizzato il messaggio di avviso in una dimensione del carattere di colore rosso, grassetto, corsivo e molto grande sopra GridView, come illustrato nella figura 12.</span><span class="sxs-lookup"><span data-stu-id="303fc-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>

<span data-ttu-id="303fc-222">[![è stata aggiunta un'etichetta sopra GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span></span>

<span data-ttu-id="303fc-223">**Figura 12**: è stata aggiunta un'etichetta sopra il GridView ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span></span>

<span data-ttu-id="303fc-224">Per impostazione predefinita, questa etichetta deve essere nascosta, quindi impostare la relativa proprietà `Visible` su `False` nel gestore dell'evento `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="303fc-224">By default, this Label should be hidden, so set its `Visible` property to `False` in the `Page_Load` event handler:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample6.vb)]

<span data-ttu-id="303fc-225">Se l'utente tenta di aggiornare un prodotto senza specificare il `UnitPrice`, è necessario annullare l'aggiornamento e visualizzare l'etichetta di avviso.</span><span class="sxs-lookup"><span data-stu-id="303fc-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="303fc-226">Aumentare il gestore dell'evento `RowUpdating` di GridView come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="303fc-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample7.vb)]

<span data-ttu-id="303fc-227">Se un utente tenta di salvare un prodotto senza specificare un prezzo, l'aggiornamento viene annullato e viene visualizzato un messaggio utile.</span><span class="sxs-lookup"><span data-stu-id="303fc-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="303fc-228">Mentre il database (e la logica di business) consente `NULL` `UnitPrice` s, questa particolare pagina di ASP.NET non lo è.</span><span class="sxs-lookup"><span data-stu-id="303fc-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>

<span data-ttu-id="303fc-229">[![un utente non può lasciare vuoto PrezzoUnitario](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span></span>

<span data-ttu-id="303fc-230">**Figura 13**: un utente non può lasciare vuoto `UnitPrice` ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span></span>

<span data-ttu-id="303fc-231">Finora è stato illustrato come usare l'evento `RowUpdating` di GridView per modificare a livello di codice i valori dei parametri assegnati alla raccolta `UpdateParameters` di ObjectDataSource e come annullare completamente il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="303fc-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="303fc-232">Questi concetti si riportano ai controlli DetailsView e FormView e si applicano anche all'inserimento e all'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="303fc-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="303fc-233">Queste attività possono essere eseguite anche a livello di ObjectDataSource tramite i gestori eventi per gli eventi `Inserting`, `Updating`e `Deleting`.</span><span class="sxs-lookup"><span data-stu-id="303fc-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="303fc-234">Questi eventi vengono attivati prima che venga richiamato il metodo associato dell'oggetto sottostante e si forniscano l'opportunità di modificare la raccolta dei parametri di input o di annullare l'operazione in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="303fc-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="303fc-235">Ai gestori di eventi per questi tre eventi viene passato un oggetto di tipo [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) con due proprietà interessanti:</span><span class="sxs-lookup"><span data-stu-id="303fc-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="303fc-236">[Annulla](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), che, se impostato su `True`, Annulla l'operazione eseguita</span><span class="sxs-lookup"><span data-stu-id="303fc-236">[Cancel](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `True`, cancels the operation being performed</span></span>
- <span data-ttu-id="303fc-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), ovvero la raccolta di `InsertParameters`, `UpdateParameters`o `DeleteParameters`, a seconda che il gestore eventi sia per l'evento `Inserting`, `Updating`o `Deleting`</span><span class="sxs-lookup"><span data-stu-id="303fc-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="303fc-238">Per illustrare l'utilizzo dei valori dei parametri a livello di ObjectDataSource, è necessario includere un oggetto DetailsView nella pagina che consente agli utenti di aggiungere un nuovo prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="303fc-239">Questo DetailsView verrà usato per fornire un'interfaccia per aggiungere rapidamente un nuovo prodotto al database.</span><span class="sxs-lookup"><span data-stu-id="303fc-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="303fc-240">Per garantire un'interfaccia utente coerente quando si aggiunge un nuovo prodotto, consentire all'utente di immettere solo i valori per i campi `ProductName` e `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="303fc-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="303fc-241">Per impostazione predefinita, i valori non specificati nell'interfaccia di inserimento di DetailsView verranno impostati su un valore `NULL` database.</span><span class="sxs-lookup"><span data-stu-id="303fc-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="303fc-242">Tuttavia, è possibile usare l'evento `Inserting` di ObjectDataSource per inserire valori predefiniti diversi, come si vedrà a breve.</span><span class="sxs-lookup"><span data-stu-id="303fc-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="303fc-243">Passaggio 3: fornire un'interfaccia per aggiungere nuovi prodotti</span><span class="sxs-lookup"><span data-stu-id="303fc-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="303fc-244">Trascinare un oggetto DetailsView dalla casella degli strumenti nella finestra di progettazione sopra il GridView, cancellare le proprietà `Height` e `Width` e associarlo a ObjectDataSource già presente nella pagina.</span><span class="sxs-lookup"><span data-stu-id="303fc-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="303fc-245">Verrà aggiunto un BoundField o CheckBoxField per ognuno dei campi del prodotto.</span><span class="sxs-lookup"><span data-stu-id="303fc-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="303fc-246">Poiché si desidera utilizzare questo DetailsView per aggiungere nuovi prodotti, è necessario selezionare l'opzione Abilita inserimento dallo smart tag; Tuttavia, non esiste un'opzione di questo tipo perché il metodo di `Insert()` di ObjectDataSource non è mappato a un metodo nella classe `ProductsBLL` (ricordare che questo mapping è stato impostato su (nessuno) quando si configura l'origine dati, vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="303fc-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="303fc-247">Per configurare ObjectDataSource, selezionare il collegamento Configura origine dati dallo smart tag, avviando la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="303fc-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="303fc-248">Nella prima schermata è possibile modificare l'oggetto sottostante a cui è associato ObjectDataSource; lasciare impostato su `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="303fc-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="303fc-249">La schermata successiva elenca i mapping dai metodi di ObjectDataSource all'oggetto sottostante.</span><span class="sxs-lookup"><span data-stu-id="303fc-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="303fc-250">Anche se è stato indicato in modo esplicito che i metodi `Insert()` e `Delete()` non devono essere mappati a metodi, se si passa alle schede Inserisci ed Elimina si noterà che è presente un mapping.</span><span class="sxs-lookup"><span data-stu-id="303fc-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="303fc-251">Questo perché i metodi `AddProduct` e `DeleteProduct` di `ProductsBLL`usano l'attributo `DataObjectMethodAttribute` per indicare che sono rispettivamente i metodi predefiniti per `Insert()` e `Delete()`.</span><span class="sxs-lookup"><span data-stu-id="303fc-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="303fc-252">Di conseguenza, la procedura guidata di ObjectDataSource seleziona questi valori ogni volta che si esegue la procedura guidata, a meno che non sia stato specificato in modo esplicito un altro valore.</span><span class="sxs-lookup"><span data-stu-id="303fc-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="303fc-253">Lasciare il metodo `Insert()` che punta al metodo `AddProduct`, ma impostare di nuovo l'elenco a discesa della scheda Elimina su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="303fc-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>

<span data-ttu-id="303fc-254">[![impostare l'elenco a discesa della scheda Inserisci sul metodo AddProduct](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span></span>

<span data-ttu-id="303fc-255">**Figura 14**: impostare l'elenco a discesa della scheda Inserisci sul metodo `AddProduct` ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span></span>

<span data-ttu-id="303fc-256">[![impostare l'elenco a discesa della scheda Elimina su (nessuno)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span></span>

<span data-ttu-id="303fc-257">**Figura 15**: impostare l'elenco a discesa della scheda Elimina su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span></span>

<span data-ttu-id="303fc-258">Dopo aver apportato queste modifiche, la sintassi dichiarativa di ObjectDataSource verrà espansa in modo da includere una raccolta `InsertParameters`, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="303fc-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample8.aspx)]

<span data-ttu-id="303fc-259">La riesecuzione della procedura guidata ha aggiunto nuovamente la proprietà `OldValuesParameterFormatString`.</span><span class="sxs-lookup"><span data-stu-id="303fc-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="303fc-260">Dedicare un po' di tempo alla cancellazione di questa proprietà impostando il valore predefinito (`{0}`) o rimuoverlo completamente dalla sintassi dichiarativa.</span><span class="sxs-lookup"><span data-stu-id="303fc-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="303fc-261">Con ObjectDataSource che fornisce funzionalità di inserimento, lo smart tag di DetailsView includerà ora la casella di controllo Abilita inserimento; tornare alla finestra di progettazione e selezionare questa opzione.</span><span class="sxs-lookup"><span data-stu-id="303fc-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="303fc-262">A questo punto, il DetailsView viene ridotto in modo da avere solo due BoundField, `ProductName` e `UnitPrice` e CommandField.</span><span class="sxs-lookup"><span data-stu-id="303fc-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="303fc-263">A questo punto la sintassi dichiarativa di DetailsView dovrebbe essere simile alla seguente:</span><span class="sxs-lookup"><span data-stu-id="303fc-263">At this point the DetailsView's declarative syntax should look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample9.aspx)]

<span data-ttu-id="303fc-264">La figura 16 Mostra questa pagina quando viene visualizzata tramite un browser a questo punto.</span><span class="sxs-lookup"><span data-stu-id="303fc-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="303fc-265">Come si può notare, DetailsView elenca il nome e il prezzo del primo prodotto (Chai).</span><span class="sxs-lookup"><span data-stu-id="303fc-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="303fc-266">Tuttavia, si tratta di un'interfaccia di inserimento che fornisce agli utenti un modo per aggiungere rapidamente un nuovo prodotto al database.</span><span class="sxs-lookup"><span data-stu-id="303fc-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>

<span data-ttu-id="303fc-267">[![il rendering di DetailsView è attualmente in modalità di sola lettura](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span></span>

<span data-ttu-id="303fc-268">**Figura 16**: il rendering di DetailsView è attualmente in modalità di sola lettura ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span></span>

<span data-ttu-id="303fc-269">Per visualizzare il DetailsView nella relativa modalità di inserimento, è necessario impostare la proprietà `DefaultMode` su `Inserting`.</span><span class="sxs-lookup"><span data-stu-id="303fc-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="303fc-270">In questo modo viene eseguito il rendering dell'oggetto DetailsView in modalità di inserimento quando viene visitato per la prima volta e viene mantenuto dopo l'inserimento di un nuovo record.</span><span class="sxs-lookup"><span data-stu-id="303fc-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="303fc-271">Come illustrato nella figura 17, tale DetailsView fornisce un'interfaccia rapida per l'aggiunta di un nuovo record.</span><span class="sxs-lookup"><span data-stu-id="303fc-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>

<span data-ttu-id="303fc-272">[![DetailsView fornisce un'interfaccia per aggiungere rapidamente un nuovo prodotto](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span></span>

<span data-ttu-id="303fc-273">**Figura 17**: DetailsView fornisce un'interfaccia per aggiungere rapidamente un nuovo prodotto ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span></span>

<span data-ttu-id="303fc-274">Quando l'utente immette il nome di un prodotto e il prezzo (ad esempio "Acme Water" e 1,99, come nella figura 17) e fa clic su Insert, viene eseguito un postback e il flusso di lavoro di inserimento inizia, che culmina con l'aggiunta di un nuovo record di prodotto al database.</span><span class="sxs-lookup"><span data-stu-id="303fc-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="303fc-275">DetailsView gestisce l'interfaccia di inserimento e GridView viene automaticamente riassociato alla relativa origine dati per includere il nuovo prodotto, come illustrato nella figura 18.</span><span class="sxs-lookup"><span data-stu-id="303fc-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>

![Il prodotto](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image52.png)

<span data-ttu-id="303fc-277">**Figura 18**: il prodotto "Acme Water" è stato aggiunto al database</span><span class="sxs-lookup"><span data-stu-id="303fc-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>

<span data-ttu-id="303fc-278">Mentre GridView nella figura 18 non lo mostra, i campi del prodotto mancanti nell'interfaccia DetailsView `CategoryID`, `SupplierID`, `QuantityPerUnit`e così via vengono assegnati `NULL` i valori del database.</span><span class="sxs-lookup"><span data-stu-id="303fc-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="303fc-279">È possibile osservare questo problema attenendosi alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="303fc-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="303fc-280">Passare alla Esplora server in Visual Studio</span><span class="sxs-lookup"><span data-stu-id="303fc-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="303fc-281">Espansione del nodo del database `NORTHWND.MDF`</span><span class="sxs-lookup"><span data-stu-id="303fc-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="303fc-282">Fare clic con il pulsante destro del mouse sul nodo della tabella `Products` database</span><span class="sxs-lookup"><span data-stu-id="303fc-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="303fc-283">Selezionare Mostra dati tabella</span><span class="sxs-lookup"><span data-stu-id="303fc-283">Select Show Table Data</span></span>

<span data-ttu-id="303fc-284">In questo elenco vengono elencati tutti i record nella tabella `Products`.</span><span class="sxs-lookup"><span data-stu-id="303fc-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="303fc-285">Come illustrato nella figura 19, tutte le colonne del nuovo prodotto diverse da `ProductID`, `ProductName`e `UnitPrice` hanno valori `NULL`.</span><span class="sxs-lookup"><span data-stu-id="303fc-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>

<span data-ttu-id="303fc-286">[![ai campi prodotto non specificati in DetailsView sono assegnati valori NULL](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span></span>

<span data-ttu-id="303fc-287">**Figura 19**: i campi prodotto non specificati in DetailsView sono assegnati `NULL` valori ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span></span>

<span data-ttu-id="303fc-288">Potrebbe essere necessario fornire un valore predefinito diverso da `NULL` per uno o più di questi valori di colonna, perché `NULL` non è l'opzione predefinita migliore o perché la colonna di database non consente `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="303fc-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="303fc-289">A tale scopo, è possibile impostare a livello di codice i valori dei parametri della raccolta `InputParameters` di DetailsView.</span><span class="sxs-lookup"><span data-stu-id="303fc-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="303fc-290">Questa assegnazione può essere eseguita nel gestore eventi per l'evento `ItemInserting` di DetailsView o per l'evento `Inserting` di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="303fc-291">Poiché è già stata esaminata l'utilizzo degli eventi pre-e post-level a livello di controllo Web, è ora necessario esaminare l'utilizzo degli eventi di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="303fc-292">Passaggio 4: assegnazione di valori ai parametri`CategoryID`e`SupplierID`</span><span class="sxs-lookup"><span data-stu-id="303fc-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="303fc-293">Per questa esercitazione si supponga che per l'applicazione in fase di aggiunta di un nuovo prodotto tramite questa interfaccia sia necessario assegnare una `CategoryID` e `SupplierID` valore pari a 1.</span><span class="sxs-lookup"><span data-stu-id="303fc-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="303fc-294">Come indicato in precedenza, ObjectDataSource ha una coppia di eventi pre-e post-livello che viene attivato durante il processo di modifica dei dati.</span><span class="sxs-lookup"><span data-stu-id="303fc-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="303fc-295">Quando viene richiamato il metodo `Insert()`, ObjectDataSource genera prima di tutto il relativo evento `Inserting`, quindi chiama il metodo a cui è stato eseguito il mapping del relativo metodo di `Insert()` e infine genera l'evento `Inserted`.</span><span class="sxs-lookup"><span data-stu-id="303fc-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="303fc-296">Il gestore dell'evento `Inserting` ci offre un'ultima opportunità per modificare i parametri di input o annullare l'operazione in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="303fc-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="303fc-297">In un'applicazione reale è probabile che si desideri consentire all'utente di specificare la categoria e il fornitore oppure selezionare tale valore in base ad alcuni criteri o alla logica di business, anziché selezionare in modo cieco l'ID 1.</span><span class="sxs-lookup"><span data-stu-id="303fc-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="303fc-298">Indipendentemente dall'esempio, viene illustrato come impostare a livello di codice il valore di un parametro di input dall'evento di pre-livello di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>

<span data-ttu-id="303fc-299">Creare un gestore eventi per l'evento `Inserting` di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="303fc-300">Si noti che il secondo parametro di input del gestore eventi è un oggetto di tipo `ObjectDataSourceMethodEventArgs`, che dispone di una proprietà per accedere alla raccolta Parameters (`InputParameters`) e a una proprietà per annullare l'operazione (`Cancel`).</span><span class="sxs-lookup"><span data-stu-id="303fc-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample10.vb)]

<span data-ttu-id="303fc-301">A questo punto, la proprietà `InputParameters` contiene la raccolta di `InsertParameters` di ObjectDataSource con i valori assegnati da DetailsView.</span><span class="sxs-lookup"><span data-stu-id="303fc-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="303fc-302">Per modificare il valore di uno di questi parametri, usare semplicemente: `e.InputParameters("paramName") = value`.</span><span class="sxs-lookup"><span data-stu-id="303fc-302">To change the value of one of these parameters, simply use: `e.InputParameters("paramName") = value`.</span></span> <span data-ttu-id="303fc-303">Pertanto, per impostare i valori di `CategoryID` e `SupplierID` su 1, modificare il gestore dell'evento `Inserting` in modo che abbia un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="303fc-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample11.vb)]

<span data-ttu-id="303fc-304">Questa volta, quando si aggiunge un nuovo prodotto, ad esempio ACME soda, le colonne `CategoryID` e `SupplierID` del nuovo prodotto sono impostate su 1 (vedere la figura 20).</span><span class="sxs-lookup"><span data-stu-id="303fc-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>

<span data-ttu-id="303fc-305">[![nuovi prodotti hanno ora i valori CategoryID e SupplierID impostati su 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="303fc-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span></span>

<span data-ttu-id="303fc-306">**Figura 20**: i nuovi prodotti hanno ora i valori `CategoryID` e `SupplierID` impostati su 1 ([fare clic per visualizzare l'immagine con dimensioni complete](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="303fc-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span></span>

## <a name="summary"></a><span data-ttu-id="303fc-307">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="303fc-307">Summary</span></span>

<span data-ttu-id="303fc-308">Durante il processo di modifica, inserimento ed eliminazione, sia il controllo Web dati che ObjectDataSource procedono attraverso diversi eventi pre-e post-Level.</span><span class="sxs-lookup"><span data-stu-id="303fc-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="303fc-309">In questa esercitazione sono stati esaminati gli eventi di pre-livello ed è stato illustrato come usarli per personalizzare i parametri di input o annullare l'operazione di modifica dei dati interamente dal controllo Web dati e dagli eventi di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="303fc-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="303fc-310">Nell'esercitazione successiva verranno illustrate la creazione e l'uso dei gestori eventi per gli eventi di post-livello.</span><span class="sxs-lookup"><span data-stu-id="303fc-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="303fc-311">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="303fc-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="303fc-312">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="303fc-312">About the Author</span></span>

<span data-ttu-id="303fc-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette ASP/ASP. NET Books e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="303fc-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="303fc-314">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="303fc-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="303fc-315">Il suo ultimo libro è [*Sams Teach Yourself ASP.NET 2,0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="303fc-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="303fc-316">Può essere raggiunto in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="303fc-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="303fc-317">o tramite il suo Blog, disponibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="303fc-317">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="303fc-318">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="303fc-318">Special Thanks To</span></span>

<span data-ttu-id="303fc-319">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="303fc-319">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="303fc-320">I revisori del lead per questa esercitazione erano Jackie Goor e Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="303fc-320">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="303fc-321">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="303fc-321">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="303fc-322">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="303fc-322">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="303fc-323">[Precedente](an-overview-of-inserting-updating-and-deleting-data-vb.md)
> [Successivo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="303fc-323">[Previous](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span></span>
