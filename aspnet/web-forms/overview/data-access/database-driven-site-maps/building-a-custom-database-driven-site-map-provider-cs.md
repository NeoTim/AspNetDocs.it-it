---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Creazione di un Provider di mappa del sito personalizzato basato su Database (c#) | Microsoft Docs
author: rick-anderson
description: Il provider di mappa del sito predefinito in ASP.NET 2.0 consente di recuperare i dati da un file XML statico. Mentre il provider basato su XML è adatto a molte piccole e medie-finestra...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: 0c87829efcb64f02d4bb9aae5992f7886df013ef
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65130446"
---
# <a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="84c5c-104">Creazione di un provider personalizzato di mappe di siti basate su database (C#)</span><span class="sxs-lookup"><span data-stu-id="84c5c-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>

<span data-ttu-id="84c5c-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="84c5c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="84c5c-106">[Scaricare il codice](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) o [Scarica il PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="84c5c-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="84c5c-107">Il provider di mappa del sito predefinito in ASP.NET 2.0 consente di recuperare i dati da un file XML statico.</span><span class="sxs-lookup"><span data-stu-id="84c5c-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="84c5c-108">Mentre il provider basato su XML è adatto a molti siti Web di piccoli e medie, grandi applicazioni Web richiedono una maggiore dinamicità mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="84c5c-109">In questa esercitazione che creeremo un provider della mappa del sito personalizzato che recupera i dati dal livello della logica di Business, che a sua volta recupera i dati dal database.</span><span class="sxs-lookup"><span data-stu-id="84c5c-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="84c5c-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="84c5c-110">Introduction</span></span>

<span data-ttu-id="84c5c-111">ASP.NET 2.0 consente a funzionalità di mappa del sito s uno sviluppatore di pagina definire una mappa del sito web dell'applicazione s in un supporto permanente, ad esempio in un file XML.</span><span class="sxs-lookup"><span data-stu-id="84c5c-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="84c5c-112">Una volta definito, i dati della mappa del sito sono accessibili a livello di programmazione tramite le [ `SiteMap` classe](https://msdn.microsoft.com/library/system.web.sitemap.aspx) nel [ `System.Web` dello spazio dei nomi](https://msdn.microsoft.com/library/system.web.aspx) o tramite un'ampia gamma di navigazione Web controlli, ad esempio il Controlli SiteMapPath, Menu e TreeView.</span><span class="sxs-lookup"><span data-stu-id="84c5c-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="84c5c-113">Il sistema del sito Usa il [modello di provider](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) in modo che le implementazioni di serializzazione mappa del sito diversi possono essere create e collegate in un'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="84c5c-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="84c5c-114">Il provider di mappa del sito predefinito fornito con ASP.NET 2.0 rende persistenti struttura della mappa del sito in un file XML.</span><span class="sxs-lookup"><span data-stu-id="84c5c-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="84c5c-115">Nel [pagine Master e spostamento nel sito](../introduction/master-pages-and-site-navigation-cs.md) esercitazione è stato creato un file denominato `Web.sitemap` che contiene questa struttura e hanno deciso di aggiornare il codice XML con ogni nuova sezione dell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="84c5c-116">Il provider di mappa del sito basati su XML predefinito funziona bene se struttura s della mappa del sito è abbastanza statica, ad esempio per queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="84c5c-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="84c5c-117">In molti scenari, tuttavia, è necessaria una maggiore dinamicità mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="84c5c-118">Prendere in considerazione la mappa del sito illustrata nella figura 1, dove ogni categoria e prodotto vengono visualizzati come sezioni nella struttura s sito Web.</span><span class="sxs-lookup"><span data-stu-id="84c5c-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="84c5c-119">Con questa mappa del sito, visitare la pagina web corrispondente al nodo radice potrebbe elencare tutte le categorie, considerando che visitano una pagina web particolare categoria s verrà visualizzato l'elenco di prodotti s categoria e la visualizzazione di una pagina web di quel particolare prodotto s mostrerebbe prodotto s-dettagli.</span><span class="sxs-lookup"><span data-stu-id="84c5c-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="84c5c-120">[![Le categorie e composizione prodotti la struttura della mappa s sito](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="84c5c-121">**Figura 1**: Le categorie e i prodotti struttura la mappa del sito s struttura ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>

<span data-ttu-id="84c5c-122">Anche se questa struttura e prodotto dal basato sulle categorie può essere impostate come hardcoded nel `Web.sitemap` file, il file dovrà essere aggiornata ogni volta che una categoria o prodotto è stato aggiunto, rimosso o rinominato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="84c5c-123">Di conseguenza, la manutenzione delle mappe del sito potrebbe essere notevolmente semplificata se la struttura è stata recuperata dal database o, in teoria, dal livello della logica di Business dell'architettura s dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="84c5c-124">In questo modo, man mano che sono stati aggiunti i prodotti e le categorie, rinominato o eliminato, la mappa del sito consente l'aggiornamento automatico per riflettere queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="84c5c-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="84c5c-125">Poiché la serializzazione della mappa del sito di ASP.NET 2.0 s viene compilata sopra il modello di provider, è possibile creare un provider della mappa del sito personalizzato che acquisisce i dati da un archivio dati alternativo, ad esempio il database o l'architettura.</span><span class="sxs-lookup"><span data-stu-id="84c5c-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="84c5c-126">In questa esercitazione si creerà un provider personalizzato che recupera i relativi dati dalla classe BLL.</span><span class="sxs-lookup"><span data-stu-id="84c5c-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="84c5c-127">Introduzione a ti permettono di s.</span><span class="sxs-lookup"><span data-stu-id="84c5c-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="84c5c-128">Il provider della mappa del sito personalizzato creato in questa esercitazione è strettamente accoppiato al modello di architettura e i dati s dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="84c5c-129">Jeff Prosise 1!s [l'archiviazione delle mappe dei siti in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) e [SQL Site Map Provider è già stato di attesa per](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articoli esaminare un approccio generalizzato per l'archiviazione dei dati della mappa del sito in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="84c5c-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="84c5c-130">Passaggio 1: Creazione di pagine Web Provider della mappa del sito personalizzata</span><span class="sxs-lookup"><span data-stu-id="84c5c-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="84c5c-131">Prima di iniziare la creazione di un provider della mappa del sito personalizzato, consentire s prima di tutto aggiungere le pagine ASP.NET, che sarà necessario per questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="84c5c-132">Iniziare aggiungendo una nuova cartella denominata `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="84c5c-133">Successivamente, aggiungere le seguenti pagine ASP.NET per quella cartella, assicurandosi di associare ogni pagina con il `Site.master` pagina master:</span><span class="sxs-lookup"><span data-stu-id="84c5c-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="84c5c-134">Aggiungere anche un `CustomProviders` sottocartella di `App_Code` cartella.</span><span class="sxs-lookup"><span data-stu-id="84c5c-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Aggiungere le pagine ASP.NET per le esercitazioni di correlate al Provider della mappa del sito](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="84c5c-136">**Figura 2**: Aggiungere le pagine ASP.NET per le esercitazioni di correlate al Provider della mappa del sito</span><span class="sxs-lookup"><span data-stu-id="84c5c-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="84c5c-137">Perché è presente un solo esercitazione di questa sezione, non abbiamo bisogno di t `Default.aspx` per elencare le esercitazioni di sezione s.</span><span class="sxs-lookup"><span data-stu-id="84c5c-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="84c5c-138">Al contrario, `Default.aspx` visualizzerà le categorie in un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="84c5c-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="84c5c-139">Che verranno affrontati in questo passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="84c5c-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="84c5c-140">A questo punto, aggiornare `Web.sitemap` per includere un riferimento di `Default.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="84c5c-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="84c5c-141">In particolare, aggiungere il markup seguente dopo la memorizzazione nella cache `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="84c5c-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="84c5c-142">Dopo aver aggiornato `Web.sitemap`, si consiglia di visualizzare il sito Web di esercitazioni tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="84c5c-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="84c5c-143">Il menu a sinistra ora include un elemento per l'esercitazione di provider della mappa sito esclusiva.</span><span class="sxs-lookup"><span data-stu-id="84c5c-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Mappa del sito include ora una voce per l'esercitazione di Provider della mappa del sito](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="84c5c-145">**Figura 3**: Mappa del sito include ora una voce per l'esercitazione di Provider della mappa del sito</span><span class="sxs-lookup"><span data-stu-id="84c5c-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="84c5c-146">Questo aspetto principale dell'esercitazione s è per illustrare la creazione di un provider di mappa del sito personalizzata e configurazione di un'applicazione web per usare tale provider.</span><span class="sxs-lookup"><span data-stu-id="84c5c-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="84c5c-147">In particolare, creeremo un provider che restituisce una mappa del sito che include un nodo radice insieme a un nodo per ogni categoria e il prodotto, come illustrato nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="84c5c-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="84c5c-148">In generale, ogni nodo nella mappa del sito può specificare un URL.</span><span class="sxs-lookup"><span data-stu-id="84c5c-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="84c5c-149">Per la mappa del sito, sarà l'URL radice del nodo s `~/SiteMapProvider/Default.aspx`, che elenca tutte le categorie nel database.</span><span class="sxs-lookup"><span data-stu-id="84c5c-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="84c5c-150">Ogni nodo della categoria nella mappa del sito avrà un URL che punta a `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, che elenca tutti i prodotti nell'oggetto specificato *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="84c5c-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="84c5c-151">Infine, ogni nodo della mappa del sito di prodotto punterà a `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, che consentirà di visualizzare i dettagli del prodotto specifico s.</span><span class="sxs-lookup"><span data-stu-id="84c5c-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="84c5c-152">Per iniziare, dobbiamo creare la `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` pagine.</span><span class="sxs-lookup"><span data-stu-id="84c5c-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="84c5c-153">Queste pagine vengono eseguite nei passaggi 2, 3 e 4, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="84c5c-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="84c5c-154">Poiché tramite questa esercitazione è nel provider di mappa del sito, e poiché esercitazioni precedenti hanno illustrato la creazione di questi tipi di Multi-pagina master-details report, si verrà Affrettati tramite i passaggi 2 e 4.</span><span class="sxs-lookup"><span data-stu-id="84c5c-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="84c5c-155">Se è necessario un aggiornamento sulla creazione di report master o di dettaglio che si estendono su più pagine, vedere la [Master/Dettagli filtro in due pagine](../masterdetail/master-detail-filtering-across-two-pages-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="84c5c-156">Passaggio 2: Visualizzazione di un elenco di categorie</span><span class="sxs-lookup"><span data-stu-id="84c5c-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="84c5c-157">Aprire il `Default.aspx` nella pagina la `SiteMapProvider` cartelle e trascinare un controllo GridView dalla casella degli strumenti nella finestra di progettazione, l'impostazione relativa `ID` a `Categories`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="84c5c-158">GridView s nello smart tag, associarlo a un nuovo oggetto ObjectDataSource denominato `CategoriesDataSource` e configurarlo in modo che recuperi relativi dati tramite il `CategoriesBLL` classe s `GetCategories` (metodo).</span><span class="sxs-lookup"><span data-stu-id="84c5c-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="84c5c-159">Poiché questo controllo GridView solo Visualizza le categorie e non fornisce funzionalità di modifica dei dati, impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="84c5c-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="84c5c-160">[![Configurare ObjectDataSource per restituire le categorie usando il metodo GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="84c5c-161">**Figura 4**: Configurare ObjectDataSource per restituire le categorie usando il `GetCategories` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>

<span data-ttu-id="84c5c-162">[![Impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="84c5c-163">**Figura 5**: Impostare l'elenco a discesa sono elencati nell'aggiornamento, inserimento ed eliminare schede su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>

<span data-ttu-id="84c5c-164">Dopo aver completato la procedura guidata Configura origine dati, Visual Studio aggiungerà un BoundField per `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, e `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="84c5c-165">Modificare il controllo GridView in modo che contenga solo le `CategoryName` e `Description` BoundField e aggiornare le `CategoryName` BoundField s `HeaderText` proprietà per categoria.</span><span class="sxs-lookup"><span data-stu-id="84c5c-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="84c5c-166">Successivamente, aggiungere un HyperLinkField e posizionarlo in modo che venga s il campo più a sinistra.</span><span class="sxs-lookup"><span data-stu-id="84c5c-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="84c5c-167">Impostare il `DataNavigateUrlFields` proprietà `CategoryID` e il `DataNavigateUrlFormatString` proprietà `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="84c5c-168">Impostare il `Text` proprietà per visualizzare i prodotti.</span><span class="sxs-lookup"><span data-stu-id="84c5c-168">Set the `Text` property to View Products .</span></span>

![Aggiungere un HyperLinkField a GridView categorie](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="84c5c-170">**Figura 6**: Aggiungere un HyperLinkField al `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="84c5c-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="84c5c-171">Dopo la creazione di ObjectDataSource e personalizzare i campi s GridView, il markup dichiarativo di due controlli avrà un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="84c5c-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="84c5c-172">Figura 7 mostra `Default.aspx` quando viene visualizzato tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="84c5c-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="84c5c-173">Facendo clic su una categoria s vista prodotti collegamento reindirizza alla `ProductsByCategory.aspx?CategoryID=categoryID`, che verrà creata nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="84c5c-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="84c5c-174">[![Ogni categoria viene elencata insieme con un collegamento di prodotti di visualizzazione](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="84c5c-175">**Figura 7**: Ogni categoria viene elencata insieme con un collegamento di prodotti di visualizzazione ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="84c5c-176">Passaggio 3: Elenco dei prodotti s categoria selezionata</span><span class="sxs-lookup"><span data-stu-id="84c5c-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="84c5c-177">Aprire il `ProductsByCategory.aspx` pagina e aggiungere un controllo GridView, denominarlo `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="84c5c-178">Dal suo smart tag, associare il controllo GridView per un nuovo oggetto ObjectDataSource denominato `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="84c5c-179">Configurare ObjectDataSource per usare la `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` (metodo) e impostare l'elenco a discesa Elenca su (nessuno) nelle schede UPDATE, INSERT e DELETE.</span><span class="sxs-lookup"><span data-stu-id="84c5c-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="84c5c-180">[![Usare il metodo di classe ProductsBLL s GetProductsByCategoryID(categoryID)](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="84c5c-181">**Figura 8**: Usare la `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>

<span data-ttu-id="84c5c-182">Il passaggio finale della procedura guidata Configura origine dati richiede un'origine di parametro per *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="84c5c-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="84c5c-183">Poiché queste informazioni vengono passate tramite il campo querystring `CategoryID`, selezionare QueryString dall'elenco a discesa e immettere CategoryID nella casella di testo QueryStringField, come illustrato nella figura 9.</span><span class="sxs-lookup"><span data-stu-id="84c5c-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="84c5c-184">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="84c5c-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="84c5c-185">[![Usare il campo Querystring CategoryID per il parametro categoryID](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="84c5c-186">**Figura 9**: Usare la `CategoryID` Querystring Field per la *categoryID* parametro ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>

<span data-ttu-id="84c5c-187">Dopo aver completato la procedura guidata, Visual Studio aggiungerà BoundField corrispondente e un CampoCasellaDiControllo a GridView per i campi di dati del prodotto.</span><span class="sxs-lookup"><span data-stu-id="84c5c-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="84c5c-188">Rimuovi tutto tranne le `ProductName`, `UnitPrice`, e `SupplierName` BoundField.</span><span class="sxs-lookup"><span data-stu-id="84c5c-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="84c5c-189">Personalizzare questi tre BoundField `HeaderText` proprietà leggere fornitore, prodotto e prezzo.</span><span class="sxs-lookup"><span data-stu-id="84c5c-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="84c5c-190">Formato di `UnitPrice` BoundField come valuta.</span><span class="sxs-lookup"><span data-stu-id="84c5c-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="84c5c-191">Successivamente, aggiungere un HyperLinkField e spostarlo nella posizione più a sinistra.</span><span class="sxs-lookup"><span data-stu-id="84c5c-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="84c5c-192">Impostare relativi `Text` proprietà per visualizzare i dettagli, relativo `DataNavigateUrlFields` proprietà `ProductID`e la relativa `DataNavigateUrlFormatString` proprietà `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Aggiungere un HyperLinkField i dettagli di visualizzazione che punta a ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="84c5c-194">**Figura 10**: Aggiungere un HyperLinkField i dettagli di visualizzazione che punta a `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="84c5c-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="84c5c-195">Dopo aver apportato queste personalizzazioni, GridView e ObjectDataSource s markup dichiarativo sarà simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="84c5c-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="84c5c-196">Tornare alla visualizzazione `Default.aspx` tramite un browser e fare clic su Visualizza prodotti link per Beverages.</span><span class="sxs-lookup"><span data-stu-id="84c5c-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="84c5c-197">Si passerà a `ProductsByCategory.aspx?CategoryID=1`, visualizzazione di nomi, i prezzi e fornitori dei prodotti nel database Northwind che appartengono alla categoria Beverages (vedere la figura 11).</span><span class="sxs-lookup"><span data-stu-id="84c5c-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="84c5c-198">È possibile migliorare ulteriormente questa pagina per includere un collegamento per restituire gli utenti alla pagina dell'inserzione categoria (`Default.aspx`) e un controllo DetailsView o FormView che visualizza il nome della categoria selezionata s e una descrizione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="84c5c-199">[![Vengono visualizzati i nomi delle bibite, prezzi e fornitori](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="84c5c-200">**Figura 11**: Vengono visualizzati i nomi delle bibite, prezzi e fornitori ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="84c5c-201">Passaggio 4: Che mostra i dettagli di un prodotto s</span><span class="sxs-lookup"><span data-stu-id="84c5c-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="84c5c-202">La pagina finale, `ProductDetails.aspx`, vengono visualizzati i dettagli di prodotti selezionati.</span><span class="sxs-lookup"><span data-stu-id="84c5c-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="84c5c-203">Apri `ProductDetails.aspx` e trascinare un controllo DetailsView dalla casella degli strumenti nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="84c5c-204">Impostare la s DetailsView `ID` proprietà `ProductInfo` e cancellare relativo `Height` e `Width` i valori delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="84c5c-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="84c5c-205">Dal suo smart tag, associare un nuovo oggetto ObjectDataSource denominato DetailsView `ProductDataSource`, la configurazione di ObjectDataSource per estrarre i dati dal `ProductsBLL` classe s `GetProductByProductID(productID)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="84c5c-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="84c5c-206">Come con le pagine web precedente creato nei passaggi 2 e 3, impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="84c5c-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="84c5c-207">[![Configurare ObjectDataSource per usare il metodo GetProductByProductID(productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="84c5c-208">**Figura 12**: Configurare ObjectDataSource per usare la `GetProductByProductID(productID)` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>

<span data-ttu-id="84c5c-209">L'ultimo passaggio della procedura guidata Configura origine dati viene richiesto per l'origine del *productID* parametro.</span><span class="sxs-lookup"><span data-stu-id="84c5c-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="84c5c-210">Poiché questi dati provengono da campo querystring `ProductID`, impostare l'elenco a discesa per la casella di testo QueryStringField per ProductID e stringa di query.</span><span class="sxs-lookup"><span data-stu-id="84c5c-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="84c5c-211">Infine, fare clic sul pulsante Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="84c5c-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="84c5c-212">[![Configurare i parametri per estrarre il valore del campo Querystring ProductID productID](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="84c5c-213">**Figura 13**: Configurare il *productID* parametro per eseguire il Pull il relativo valore dalle `ProductID` Querystring Field ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>

<span data-ttu-id="84c5c-214">Dopo aver completato la procedura guidata Configura origine dati, Visual Studio creerà BoundField corrispondente e un CampoCasellaDiControllo in DetailsView per i campi di dati del prodotto.</span><span class="sxs-lookup"><span data-stu-id="84c5c-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="84c5c-215">Rimuovere il `ProductID`, `SupplierID`, e `CategoryID` BoundField e configurare i campi rimanenti come desiderato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="84c5c-216">Dopo un numero limitato di configurazioni estetici, il markup dichiarativo s DetailsView e ObjectDataSource era simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="84c5c-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="84c5c-217">Per testare questa pagina, tornare a `Default.aspx` e fare clic sulla visualizzazione dei prodotti per la categoria Beverages.</span><span class="sxs-lookup"><span data-stu-id="84c5c-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="84c5c-218">Nell'elenco dei prodotti di bevande, fare clic sul collegamento Visualizza dettagli per Chai tè.</span><span class="sxs-lookup"><span data-stu-id="84c5c-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="84c5c-219">Si passerà a `ProductDetails.aspx?ProductID=1`, che mostra un s Chai tè dettagli (vedere la figura 14).</span><span class="sxs-lookup"><span data-stu-id="84c5c-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="84c5c-220">[![Viene visualizzato il tè Chai s fornitore, categoria, prezzi e altre informazioni](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="84c5c-221">**Figura 14**: Viene visualizzato il tè Chai s fornitore, categoria, prezzi e altre informazioni ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="84c5c-222">Passaggio 5: Comprendere i meccanismi interni di un Provider di mappa del sito</span><span class="sxs-lookup"><span data-stu-id="84c5c-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="84c5c-223">Mappa del sito è rappresentata nella memoria del server s web come una raccolta di `SiteMapNode` istanze che formano una gerarchia.</span><span class="sxs-lookup"><span data-stu-id="84c5c-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="84c5c-224">Deve essere presente esattamente una radice, tutti i nodi non radice devono avere esattamente un nodo padre e tutti i nodi possono avere un numero arbitrario di elementi figlio.</span><span class="sxs-lookup"><span data-stu-id="84c5c-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="84c5c-225">Ogni `SiteMapNode` oggetto rappresenta una sezione nella struttura del sito Web s; queste sezioni hanno in genere una pagina web corrispondente.</span><span class="sxs-lookup"><span data-stu-id="84c5c-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="84c5c-226">Di conseguenza, il [ `SiteMapNode` classe](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) dispone di proprietà quali `Title`, `Url`, e `Description`, che forniscono informazioni per la sezione di `SiteMapNode` rappresenta.</span><span class="sxs-lookup"><span data-stu-id="84c5c-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="84c5c-227">È inoltre disponibile un' `Key` proprietà che identifica in modo univoco ogni `SiteMapNode` nella gerarchia, nonché proprietà usate per definire questa gerarchia `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`e così via.</span><span class="sxs-lookup"><span data-stu-id="84c5c-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="84c5c-228">Figura 15 viene illustrata la struttura di mappa sito generale dalla figura 1, ma con i dettagli di implementazione descritto in dettaglio più preciso.</span><span class="sxs-lookup"><span data-stu-id="84c5c-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="84c5c-229">[![Ogni SiteMapNode dispone di proprietà, ad esempio titolo, Url, chiave e così via](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="84c5c-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="84c5c-230">**Figura 15**: Ciascuna `SiteMapNode` ha le proprietà, ad esempio `Title`, `Url`, `Key`e così via ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="84c5c-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>

<span data-ttu-id="84c5c-231">Mappa del sito è accessibile tramite il [ `SiteMap` classe](https://msdn.microsoft.com/library/system.web.sitemap.aspx) nel [ `System.Web` dello spazio dei nomi](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="84c5c-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="84c5c-232">Questa classe s `RootNode` viene restituita la radice della mappa s sito `SiteMapNode` esempio. `CurrentNode` restituisce il `SiteMapNode` cui `Url` proprietà corrisponda all'URL della pagina attualmente richiesta.</span><span class="sxs-lookup"><span data-stu-id="84c5c-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="84c5c-233">Questa classe viene utilizzata internamente dai controlli Web di ASP.NET 2.0 s navigazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="84c5c-234">Quando il `SiteMap` per accedere a proprietà di classe s, è necessario serializzare la struttura della mappa del sito da un supporto permanente in memoria.</span><span class="sxs-lookup"><span data-stu-id="84c5c-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="84c5c-235">Tuttavia, la logica di serializzazione della mappa del sito non è hardcoded nel `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="84c5c-236">In alternativa, in fase di esecuzione la `SiteMap` classe determina quale mappa del sito *provider* da utilizzare per la serializzazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="84c5c-237">Per impostazione predefinita, il [ `XmlSiteMapProvider` classe](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) viene usato, che legge la struttura della mappa s sito da un file XML formattato correttamente.</span><span class="sxs-lookup"><span data-stu-id="84c5c-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="84c5c-238">Tuttavia, con un po' di lavoro è possibile creare un provider della mappa del sito personalizzato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="84c5c-239">Tutti i provider di mappa del sito deve essere derivato dal [ `SiteMapProvider` classe](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), che include i metodi essenziali e le proprietà necessarie per il sito provider della mappa, ma omette molti dei dettagli di implementazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="84c5c-240">Una seconda classe, [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), estende il `SiteMapProvider` classe e contiene un'implementazione più solida funzionalità necessari.</span><span class="sxs-lookup"><span data-stu-id="84c5c-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="84c5c-241">Internamente, il `StaticSiteMapProvider` archivia il `SiteMapNode` mapping delle istanze del sito un `Hashtable` e fornisce metodi quali `AddNode(child, parent)`, `RemoveNode(siteMapNode),` e `Clear()` che aggiungono e rimuovono `SiteMapNode` s alla classe interna `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="84c5c-242">L'oggetto `XmlSiteMapProvider` è derivato da `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="84c5c-243">Quando la creazione di un provider della mappa del sito personalizzato che estende `StaticSiteMapProvider`, sono disponibili due metodi astratti che devono essere sottoposto a override: [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) e [ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="84c5c-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="84c5c-244">`BuildSiteMap`, come suggerisce il nome, è responsabile per il caricamento di struttura della mappa del sito da un archivio permanente e costruzione, in memoria.</span><span class="sxs-lookup"><span data-stu-id="84c5c-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="84c5c-245">`GetRootNodeCore` Restituisce il nodo radice della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="84c5c-246">Prima di un sito web l'applicazione può usare un provider di mappa del sito che deve essere registrato nella configurazione di s dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="84c5c-247">Per impostazione predefinita, il `XmlSiteMapProvider` classe registrata con il nome `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="84c5c-248">Per registrare i provider della mappa del sito aggiuntivi, aggiungere il markup seguente alla `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="84c5c-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="84c5c-249">Il *name* valore viene assegnato un nome leggibile dall'utente al provider durante *tipo* specifica il nome del tipo completo di provider della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="84c5c-250">Esploreremo valori concreti per la *name* e *tipo* valori nel passaggio 7, dopo abbiamo creato il provider della mappa del sito personalizzato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="84c5c-251">La classe del provider della mappa del sito viene creata un'istanza la prima volta è possibile accedervi dal `SiteMap` classe e rimane in memoria per la durata dell'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="84c5c-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="84c5c-252">Perché è presente solo un'istanza del provider di mappa del sito che possono essere richiamate dalle più, i visitatori del sito web simultanee, è fondamentale che i metodi i provider siano *thread-safe*.</span><span class="sxs-lookup"><span data-stu-id="84c5c-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="84c5c-253">Per motivi di prestazioni e scalabilità, è importante che il sito in memoria nella cache struttura della mappa e restituire questo presenti nella cache struttura anziché averlo ricreato ogni volta che il `BuildSiteMap` metodo viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="84c5c-254">`BuildSiteMap` può essere chiamato più volte per ogni richiesta di pagina per ogni utente, in base i controlli di spostamento sulla pagina e la profondità della struttura della mappa del sito in uso.</span><span class="sxs-lookup"><span data-stu-id="84c5c-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="84c5c-255">In qualsiasi caso, se non si memorizza nella cache della struttura della mappa del sito in `BuildSiteMap` ogni volta che viene richiamato è necessario recuperare di nuovo le informazioni product e category dall'architettura (con la conseguenza di una query al database).</span><span class="sxs-lookup"><span data-stu-id="84c5c-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="84c5c-256">Come descritto nelle esercitazioni precedenti la memorizzazione nella cache, dati memorizzati nella cache possono diventare non aggiornati.</span><span class="sxs-lookup"><span data-stu-id="84c5c-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="84c5c-257">Per evitare questo inconveniente, è possibile usare ora - o oggetti scaduti di basato sulla dipendenza della cache SQL.</span><span class="sxs-lookup"><span data-stu-id="84c5c-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="84c5c-258">Un provider di mappa del sito può facoltativamente eseguire l'override di [ `Initialize` metodo](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="84c5c-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="84c5c-259">`Initialize` viene richiamato quando il provider della mappa del sito viene innanzitutto creata un'istanza e viene passato eventuali attributi personalizzati assegnati al provider nel `Web.config` nella `<add>` elemento, ad esempio: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="84c5c-260">È utile se si desidera consentire a uno sviluppatore di pagina specificare diverse impostazioni correlate al provider della mappa del sito senza dover modificare il codice del provider s.</span><span class="sxs-lookup"><span data-stu-id="84c5c-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="84c5c-261">Ad esempio, se si stanno leggendo i dati di categoria e prodotti direttamente dal database anziché tramite l'architettura, è il d probabilmente necessario consentire allo sviluppatore di specificare la stringa di connessione del database tramite `Web.config` invece di usare un livello di codice valore nel codice del provider s.</span><span class="sxs-lookup"><span data-stu-id="84c5c-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="84c5c-262">Il provider della mappa del sito personalizzato che verrà creata nel passaggio 6 non eseguirne l'override `Initialize` (metodo).</span><span class="sxs-lookup"><span data-stu-id="84c5c-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="84c5c-263">Per un esempio d'uso di `Initialize` metodo, fare riferimento a [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [l'archiviazione delle mappe dei siti in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) articolo.</span><span class="sxs-lookup"><span data-stu-id="84c5c-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="84c5c-264">Passaggio 6: Creazione di Provider della mappa del sito personalizzato</span><span class="sxs-lookup"><span data-stu-id="84c5c-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="84c5c-265">Per creare un provider della mappa del sito personalizzato che si basa la mappa del sito dalle categorie e i prodotti nel database Northwind, è necessario creare una classe che estende `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="84c5c-266">Nel passaggio 1 chiede di aggiungere un `CustomProviders` cartella di `App_Code` cartella - aggiungere una nuova classe in questa cartella denominata `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="84c5c-267">Aggiungere il codice seguente alla classe `NorthwindSiteMapProvider`:</span><span class="sxs-lookup"><span data-stu-id="84c5c-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="84c5c-268">Let s per iniziare l'esplorazione di questa classe s `BuildSiteMap` metodo, che inizia con un [ `lock` istruzione](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="84c5c-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="84c5c-269">Il `lock` istruzione consente solo un thread alla volta per immettere, in tal modo la serializzazione dell'accesso al relativo codice e impediscono l'esecuzione di istruzioni in piedi s tra loro due thread simultanei.</span><span class="sxs-lookup"><span data-stu-id="84c5c-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="84c5c-270">Livello di classe `SiteMapNode` variabile `root` viene usato per memorizzare nella cache della struttura della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="84c5c-271">Quando viene costruita la mappa del sito per la prima volta oppure per la prima volta dopo che i dati sottostanti sono stati modificati, `root` saranno `null` e verrà creata la struttura della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="84c5c-272">Il nodo radice della mappa s sito viene assegnato a `root` durante la costruzione processo in modo che alla successiva esecuzione di questo metodo viene chiamato, `root` non saranno `null`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="84c5c-273">Di conseguenza, purché `root` non è `null` struttura della mappa del sito verrà restituita al chiamante senza dover ricreare l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="84c5c-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="84c5c-274">Se è radice `null`, la struttura della mappa del sito viene creata dalle informazioni product e category.</span><span class="sxs-lookup"><span data-stu-id="84c5c-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="84c5c-275">Mappa del sito viene compilata mediante la creazione di `SiteMapNode` istanze e che quindi costituiscono la gerarchia mediante chiamate al `StaticSiteMapProvider` classe s `AddNode` (metodo).</span><span class="sxs-lookup"><span data-stu-id="84c5c-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="84c5c-276">`AddNode` esegue la gestione interna, l'archiviazione di vengono formattati diversi `SiteMapNode` di istanze in un `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="84c5c-277">Prima di iniziare la costruzione della gerarchia, si inizia chiamando il `Clear` metodo, che cancella gli elementi dall'interno `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="84c5c-278">Successivamente, il `ProductsBLL` classe s `GetProducts` metodo e risultante `ProductsDataTable` vengono archiviati in variabili locali.</span><span class="sxs-lookup"><span data-stu-id="84c5c-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="84c5c-279">La creazione delle mappe s sito inizia con la creazione del nodo radice e assegnarlo alla `root`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="84c5c-280">L'overload dei metodi di [ `SiteMapNode` costruttore s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) usato qui e in tutto il `BuildSiteMap` viene passato le informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="84c5c-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="84c5c-281">Un riferimento al provider di mappa del sito (`this`).</span><span class="sxs-lookup"><span data-stu-id="84c5c-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="84c5c-282">Il `SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="84c5c-283">Questa operazione necessaria deve essere univoco per ogni valore `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="84c5c-284">Il `SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="84c5c-285">`Url` è facoltativo, tuttavia, se fornito, ognuna `SiteMapNode` s `Url` valore deve essere univoco.</span><span class="sxs-lookup"><span data-stu-id="84c5c-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="84c5c-286">Il `SiteMapNode` s `Title`, che è necessario.</span><span class="sxs-lookup"><span data-stu-id="84c5c-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="84c5c-287">Il `AddNode(root)` chiamata metodo aggiunge le `SiteMapNode` `root` alla mappa del sito come radice.</span><span class="sxs-lookup"><span data-stu-id="84c5c-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="84c5c-288">Successivamente, ogni `ProductRow` nella `ProductsDataTable` viene enumerata.</span><span class="sxs-lookup"><span data-stu-id="84c5c-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="84c5c-289">Se esiste già un `SiteMapNode` per la categoria di prodotto s corrente, vi viene fatto riferimento.</span><span class="sxs-lookup"><span data-stu-id="84c5c-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="84c5c-290">In caso contrario, una nuova `SiteMapNode` per la categoria viene creata e aggiunto come figlio di `SiteMapNode``root` tramite il `AddNode(categoryNode, root)` chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="84c5c-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="84c5c-291">Dopo la categoria appropriata `SiteMapNode` nodo è stato trovato o creato, un `SiteMapNode` viene creato per il prodotto corrente e aggiunto come elemento figlio della categoria `SiteMapNode` tramite `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="84c5c-292">Si noti che la categoria `SiteMapNode` s `Url` valore della proprietà `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` mentre il prodotto `SiteMapNode` s `Url` proprietà viene assegnato `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="84c5c-293">I prodotti con un database `NULL` valore per la loro `CategoryID` vengono raggruppate in una categoria `SiteMapNode` cui `Title` è impostata su None e il cui `Url` viene impostata su una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="84c5c-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="84c5c-294">È deciso di adottare `Url` su una stringa vuota dopo il `ProductBLL` classe s `GetProductsByCategory(categoryID)` metodo attualmente non è in grado di restituire solo i prodotti con un `NULL` `CategoryID` valore.</span><span class="sxs-lookup"><span data-stu-id="84c5c-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="84c5c-295">Inoltre, vorrei illustrare come i controlli di spostamento il rendering un' `SiteMapNode` che non è presente un valore per la relativa `Url` proprietà.</span><span class="sxs-lookup"><span data-stu-id="84c5c-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="84c5c-296">Ti invitiamo a estendere questa esercitazione in modo che nessun `SiteMapNode` s `Url` proprietà fa riferimento alla `ProductsByCategory.aspx`, ancora vengono visualizzati solo i prodotti `NULL` `CategoryID` valori.</span><span class="sxs-lookup"><span data-stu-id="84c5c-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="84c5c-297">Al termine della creazione della mappa del sito, un oggetto arbitrario viene aggiunto alla cache dei dati con una dipendenza della cache SQL nel `Categories` e `Products` tabelle tramite un `AggregateCacheDependency` oggetto.</span><span class="sxs-lookup"><span data-stu-id="84c5c-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="84c5c-298">Sono stati presentati tramite le dipendenze della cache SQL nell'esercitazione precedente *usando le dipendenze della Cache di SQL*.</span><span class="sxs-lookup"><span data-stu-id="84c5c-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="84c5c-299">Il provider della mappa del sito personalizzato, tuttavia, Usa un overload della cache dei dati s `Insert` metodo che ve ancora a esplorare.</span><span class="sxs-lookup"><span data-stu-id="84c5c-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="84c5c-300">Questo overload accetta come parametro di input finale un delegato che viene chiamato quando l'oggetto viene rimosso dalla cache.</span><span class="sxs-lookup"><span data-stu-id="84c5c-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="84c5c-301">In particolare, vengono passati in una nuova [ `CacheItemRemovedCallback` delegare](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) che punta al `OnSiteMapChanged` metodo definito più avanti nel `NorthwindSiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="84c5c-302">La rappresentazione in memoria della mappa del sito viene memorizzato nella cache tramite la variabile a livello di classe `root`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="84c5c-303">Perché è presente solo un'istanza della classe del provider di mappa del sito personalizzato e dato che tale istanza viene condiviso tra tutti i thread nell'applicazione web, questa variabile di classe funge da una cache.</span><span class="sxs-lookup"><span data-stu-id="84c5c-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="84c5c-304">Il `BuildSiteMap` metodo Usa anche la cache dei dati, ma solo come mezzo per ricevere una notifica quando sottostante di dati nel database di `Categories` o `Products` le tabelle delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="84c5c-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="84c5c-305">Si noti che il valore inserito nella cache di dati è sufficiente la data e ora correnti.</span><span class="sxs-lookup"><span data-stu-id="84c5c-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="84c5c-306">Dati della mappa del sito effettivo sono *non* inserire nella cache dei dati.</span><span class="sxs-lookup"><span data-stu-id="84c5c-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="84c5c-307">Il `BuildSiteMap` metodo viene completato, restituendo il nodo radice della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="84c5c-308">I metodi rimanenti sono piuttosto semplici.</span><span class="sxs-lookup"><span data-stu-id="84c5c-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="84c5c-309">`GetRootNodeCore` è responsabile della restituzione del nodo radice.</span><span class="sxs-lookup"><span data-stu-id="84c5c-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="84c5c-310">Poiché `BuildSiteMap` restituisce la radice `GetRootNodeCore` restituisce semplicemente `BuildSiteMap` s valore restituito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="84c5c-311">Il `OnSiteMapChanged` metodo imposta `root` al `null` quando viene rimosso l'elemento della cache.</span><span class="sxs-lookup"><span data-stu-id="84c5c-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="84c5c-312">Con radice reimpostato `null`, all'accesso successivo `BuildSiteMap` viene richiamato, la struttura della mappa del sito verrà ricostruita.</span><span class="sxs-lookup"><span data-stu-id="84c5c-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="84c5c-313">Infine, il `CachedDate` proprietà restituisce il valore di data e ora archiviato nella cache dei dati, se esiste un valore di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="84c5c-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="84c5c-314">Questa proprietà può essere utilizzata dagli sviluppatori di pagine per determinare quando è stato ultima cache per i dati della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="84c5c-315">Passaggio 7: La registrazione di`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="84c5c-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="84c5c-316">Affinché l'applicazione web per usare la `NorthwindSiteMapProvider` provider di mappa del sito creato nel passaggio 6, è necessario registrarlo nel `<siteMap>` sezione del `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="84c5c-317">In particolare, aggiungere il markup seguente all'interno di `<system.web>` elemento `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="84c5c-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="84c5c-318">Questo markup fa due cose: in primo luogo, indica che l'elemento predefinito `AspNetXmlSiteMapProvider` il provider della mappa del sito predefinito; in secondo luogo, registra il provider della mappa del sito personalizzato creato nel passaggio 6 con il nome di Converto Northwind.</span><span class="sxs-lookup"><span data-stu-id="84c5c-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="84c5c-319">Per i provider della mappa del sito che si trova in s application `App_Code` cartella, il valore della `type` attributo è semplicemente il nome della classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="84c5c-320">In alternativa, il provider della mappa del sito personalizzato potrebbe essere stato creato in un progetto libreria di classi separato con l'assembly compilato posizionato in s dell'applicazione web `/Bin` directory.</span><span class="sxs-lookup"><span data-stu-id="84c5c-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="84c5c-321">In tal caso, il `type` valore dell'attributo sarebbe *Namespace*. *ClassName*, *nomeassembly* .</span><span class="sxs-lookup"><span data-stu-id="84c5c-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="84c5c-322">Dopo aver aggiornato `Web.config`, si consiglia di visualizzare qualsiasi pagina dalle esercitazioni in un browser.</span><span class="sxs-lookup"><span data-stu-id="84c5c-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="84c5c-323">Si noti che l'interfaccia di spostamento a sinistra viene ancora visualizzato le sezioni e le esercitazioni definito in `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="84c5c-324">Infatti, è stato lasciato `AspNetXmlSiteMapProvider` come provider predefinito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="84c5c-325">Per creare un elemento dell'interfaccia utente di navigazione che utilizza il `NorthwindSiteMapProvider`, sarà necessario specificare esplicitamente che il provider della mappa del sito Northwind deve essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="84c5c-326">Si vedrà come eseguire questa operazione nel passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="84c5c-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="84c5c-327">Passaggio 8: Visualizzazione di informazioni relative alla mappa del sito usando il Provider della mappa del sito personalizzata</span><span class="sxs-lookup"><span data-stu-id="84c5c-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="84c5c-328">Con il sito personalizzato provider della mappa creati e registrati in `Web.config`, sono pronti per aggiungere i controlli di navigazione per il `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` pagine la `SiteMapProvider` cartella.</span><span class="sxs-lookup"><span data-stu-id="84c5c-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="84c5c-329">Iniziare aprendo il `Default.aspx` pagina e trascinare un `SiteMapPath` dalla casella degli strumenti nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="84c5c-330">Il controllo SiteMapPath si trova nella sezione esplorazione della casella degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="84c5c-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="84c5c-331">[![Aggiungere un SiteMapPath a default. aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="84c5c-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="84c5c-332">**Figura 16**: Aggiungere un SiteMapPath alla `Default.aspx` ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="84c5c-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>

<span data-ttu-id="84c5c-333">Il controllo SiteMapPath Visualizza una barra di navigazione, che indica la posizione corrente della pagina s all'interno della mappa del sito.</span><span class="sxs-lookup"><span data-stu-id="84c5c-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="84c5c-334">Abbiamo aggiunto un SiteMapPath alla parte superiore della pagina master nel *pagine Master e spostamento nel sito* esercitazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="84c5c-335">Richiedere qualche istante per visualizzare questa pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="84c5c-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="84c5c-336">Il controllo SiteMapPath aggiunto nella figura 16 Usa il provider di mappa del sito predefinito, estrarre i dati da `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="84c5c-337">Pertanto, il breadcrumb indica casa &gt; personalizzazione mappa del sito, esattamente come il percorso di navigazione nell'angolo superiore destro.</span><span class="sxs-lookup"><span data-stu-id="84c5c-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="84c5c-338">[![Il percorso di navigazione Usa il Provider di mappa del sito predefinito](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="84c5c-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="84c5c-339">**Figura 17**: Il percorso di navigazione Usa il Provider della mappa del sito predefinito ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="84c5c-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>

<span data-ttu-id="84c5c-340">Per consentire il controllo SiteMapPath aggiunto nella figura 16 a usare il provider di mappa del sito personalizzato creato nel passaggio 6, impostare relativi [ `SiteMapProvider` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) a Northwind, il nome viene assegnato al `NorthwindSiteMapProvider` in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="84c5c-341">Sfortunatamente, la finestra di progettazione continua a usare il provider di mappa del sito predefinito, ma se si visita la pagina tramite un browser dopo aver apportato questa modifica di proprietà si noterà che il percorso di navigazione ora Usa il provider della mappa del sito personalizzata.</span><span class="sxs-lookup"><span data-stu-id="84c5c-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="84c5c-342">[![Il percorso di navigazione Usa ora la NorthwindSiteMapProvider Provider della mappa del sito personalizzata](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="84c5c-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="84c5c-343">**Figura 18**: Il Breadcrumb ora Usa il Provider della mappa del sito personalizzato `NorthwindSiteMapProvider` ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="84c5c-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>

<span data-ttu-id="84c5c-344">Il controllo SiteMapPath Visualizza un'interfaccia utente più funzionale nel `ProductsByCategory.aspx` e `ProductDetails.aspx` pagine.</span><span class="sxs-lookup"><span data-stu-id="84c5c-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="84c5c-345">Aggiungere un SiteMapPath per queste pagine, l'impostazione di `SiteMapProvider` proprietà sia a Northwind.</span><span class="sxs-lookup"><span data-stu-id="84c5c-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="84c5c-346">Da `Default.aspx` fare clic sul collegamento Visualizza prodotti relativi alle bevande, quindi sul collegamento Visualizza dettagli per Chai tè.</span><span class="sxs-lookup"><span data-stu-id="84c5c-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="84c5c-347">Come illustrato nella figura 19, la barra di navigazione include la sezione di mappa del sito corrente (Chai tè) e i relativi predecessori: Beverages e tutte le categorie.</span><span class="sxs-lookup"><span data-stu-id="84c5c-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="84c5c-348">[![Il percorso di navigazione Usa ora la NorthwindSiteMapProvider Provider della mappa del sito personalizzata](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="84c5c-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="84c5c-349">**Figura 19**: Il Breadcrumb ora Usa il Provider della mappa del sito personalizzato `NorthwindSiteMapProvider` ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="84c5c-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>

<span data-ttu-id="84c5c-350">Altri elementi dell'interfaccia utente di navigazione sono utilizzabile oltre il controllo SiteMapPath, ad esempio i controlli Menu e TreeView.</span><span class="sxs-lookup"><span data-stu-id="84c5c-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="84c5c-351">Il `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` pagine di download per questa esercitazione, ad esempio, includono i controlli Menu (vedere Figura 20).</span><span class="sxs-lookup"><span data-stu-id="84c5c-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="84c5c-352">Vedere [analisi ASP.NET 2.0 s le funzionalità di spostamento sito](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) e il [usando i controlli di spostamento sito](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) sezione del [guide introduttive di ASP.NET 2.0](https://quickstarts.asp.net/QuickStartv20/aspnet/) per un esame più approfondito il controlli di spostamento e il sistema di mappa del sito in ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="84c5c-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="84c5c-353">[![Il controllo Menu riporta tutte le categorie e i prodotti](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="84c5c-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="84c5c-354">**Figura 20**: Il Menu di controllo Elenca ogni e delle categorie prodotti ([fare clic per visualizzare l'immagine con dimensioni normali](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="84c5c-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>

<span data-ttu-id="84c5c-355">Come accennato in precedenza in questa esercitazione, la struttura della mappa del sito sono accessibili a livello di programmazione tramite le `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="84c5c-356">Il codice seguente restituisce la radice `SiteMapNode` del provider predefinito:</span><span class="sxs-lookup"><span data-stu-id="84c5c-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="84c5c-357">Poiché il `AspNetXmlSiteMapProvider` è il provider predefinito per la nostra applicazione, il codice precedente restituisce il nodo radice definito in `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="84c5c-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="84c5c-358">Per fare riferimento a un provider di mappa del sito diverso da quello predefinito, usare il `SiteMap` classe s [ `Providers` proprietà](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) come segue:</span><span class="sxs-lookup"><span data-stu-id="84c5c-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="84c5c-359">In cui *nome* è il nome del provider della mappa del sito personalizzato (per la nostra applicazione web, Northwind).</span><span class="sxs-lookup"><span data-stu-id="84c5c-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="84c5c-360">Per accedere a un membro specifico per un provider di mappa del sito, usare `SiteMap.Providers["name"]` per recuperare l'istanza del provider e quindi eseguire il cast nel tipo appropriato.</span><span class="sxs-lookup"><span data-stu-id="84c5c-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="84c5c-361">Ad esempio, per visualizzare il `NorthwindSiteMapProvider` s `CachedDate` proprietà in una pagina ASP.NET, usare il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="84c5c-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="84c5c-362">Assicurarsi di testare la funzionalità di dipendenza della cache SQL.</span><span class="sxs-lookup"><span data-stu-id="84c5c-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="84c5c-363">Dopo aver visitare il `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` pagine, passare a una delle esercitazioni di modifica, inserimento ed eliminazione di sezione e modificare il nome di una categoria o un prodotto.</span><span class="sxs-lookup"><span data-stu-id="84c5c-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="84c5c-364">Quindi tornare a una delle pagine di `SiteMapProvider` cartella.</span><span class="sxs-lookup"><span data-stu-id="84c5c-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="84c5c-365">Supponendo che sia trascorso tempo sufficiente per il meccanismo di polling annotare la modifica al database sottostante, la mappa del sito deve essere aggiornata per mostrare il nuovo prodotto o il nome di categoria.</span><span class="sxs-lookup"><span data-stu-id="84c5c-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="84c5c-366">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="84c5c-366">Summary</span></span>

<span data-ttu-id="84c5c-367">ASP.NET 2.0 include le funzionalità di mappa del sito s un `SiteMap` (classe), un numero di navigazione predefinito Web controlla e salvati in modo permanente un provider della mappa del sito predefinito che prevede che le informazioni della mappa del sito in un file XML.</span><span class="sxs-lookup"><span data-stu-id="84c5c-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="84c5c-368">Per usare le informazioni sulla mappa del sito da un'altra origine, ad esempio da un database, l'architettura s dell'applicazione o un servizio Web remoto, che è necessario creare un provider della mappa del sito personalizzata.</span><span class="sxs-lookup"><span data-stu-id="84c5c-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="84c5c-369">Ciò comporta la creazione di una classe derivata, in modo diretto o indiretto, dal `SiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="84c5c-370">In questa esercitazione è stato illustrato come creare un provider di mappa del sito personalizzato che basa la mappa del sito sulle informazioni product e category raccolti dall'architettura dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84c5c-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="84c5c-371">Il provider di servizi estesi il `StaticSiteMapProvider` classe e la conseguente creazione di un `BuildSiteMap` metodo di recuperata dei dati, costruito gerarchia della mappa del sito e memorizzati nella cache la struttura risultante in una variabile a livello di classe.</span><span class="sxs-lookup"><span data-stu-id="84c5c-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="84c5c-372">Abbiamo utilizzato una dipendenza della cache SQL con una funzione di callback per invalidare memorizzato nella cache quando struttura sottostante `Categories` o `Products` vengono modificati i dati.</span><span class="sxs-lookup"><span data-stu-id="84c5c-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="84c5c-373">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="84c5c-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="84c5c-374">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="84c5c-374">Further Reading</span></span>

<span data-ttu-id="84c5c-375">Per altre informazioni sugli argomenti trattati in questa esercitazione, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="84c5c-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="84c5c-376">[L'archiviazione delle mappe dei siti in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) e [SQL Site Map Provider è già stato di attesa per](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="84c5c-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="84c5c-377">Modello Provider s un'occhiata a ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="84c5c-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="84c5c-378">Il Toolkit del Provider</span><span class="sxs-lookup"><span data-stu-id="84c5c-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="84c5c-379">Analisi di ASP.NET 2.0 le funzionalità di spostamento sito s</span><span class="sxs-lookup"><span data-stu-id="84c5c-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="84c5c-380">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="84c5c-380">About the Author</span></span>

<span data-ttu-id="84c5c-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette libri e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha collaborato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="84c5c-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="84c5c-382">Lavora come un consulente, formatore e autore.</span><span class="sxs-lookup"><span data-stu-id="84c5c-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="84c5c-383">Il suo ultimo libro si intitola [ *Sams Teach Yourself ASP.NET 2.0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="84c5c-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="84c5c-384">È possibile contattarlo al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="84c5c-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="84c5c-385">o sul suo blog, che è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="84c5c-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="84c5c-386">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="84c5c-386">Special Thanks To</span></span>

<span data-ttu-id="84c5c-387">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="84c5c-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="84c5c-388">I revisori per questa esercitazione sono state Dave Gardner, Zack Jones, Teresa Murphy e Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="84c5c-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="84c5c-389">Se si è interessati prossimi articoli MSDN dello?</span><span class="sxs-lookup"><span data-stu-id="84c5c-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="84c5c-390">In questo caso, Inviami una riga in corrispondenza [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="84c5c-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="84c5c-391">avanti</span><span class="sxs-lookup"><span data-stu-id="84c5c-391">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
