---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: Protezione delle stringhe di connessione e di altreC#informazioni di configurazione () | Microsoft Docs
author: rick-anderson
description: Un'applicazione ASP.NET in genere archivia le informazioni di configurazione in un file Web. config. Alcune di queste informazioni sono riservate e garantiscono la protezione. Per def...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 15970bee1e990d3a139673efe12486e08f79814c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78524738"
---
# <a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="af8f7-105">Protezione delle stringhe di connessione e di altre informazioni di configurazione (C#)</span><span class="sxs-lookup"><span data-stu-id="af8f7-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>

<span data-ttu-id="af8f7-106">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="af8f7-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="af8f7-107">[Scarica codice](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) o [Scarica PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="af8f7-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="af8f7-108">Un'applicazione ASP.NET in genere archivia le informazioni di configurazione in un file Web. config.</span><span class="sxs-lookup"><span data-stu-id="af8f7-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="af8f7-109">Alcune di queste informazioni sono riservate e garantiscono la protezione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="af8f7-110">Per impostazione predefinita, il file non verrà servito al visitatore di un sito Web, ma un amministratore o un pirata informatico può ottenere l'accesso al file system del server Web e visualizzare il contenuto del file.</span><span class="sxs-lookup"><span data-stu-id="af8f7-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="af8f7-111">In questa esercitazione si apprenderà come ASP.NET 2,0 consenta di proteggere le informazioni riservate mediante la crittografia delle sezioni del file Web. config.</span><span class="sxs-lookup"><span data-stu-id="af8f7-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>

## <a name="introduction"></a><span data-ttu-id="af8f7-112">Introduzione</span><span class="sxs-lookup"><span data-stu-id="af8f7-112">Introduction</span></span>

<span data-ttu-id="af8f7-113">Le informazioni di configurazione per le applicazioni ASP.NET vengono in genere archiviate in un file XML denominato `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="af8f7-114">Nel corso di queste esercitazioni è stato aggiornato il `Web.config` alcune volte.</span><span class="sxs-lookup"><span data-stu-id="af8f7-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="af8f7-115">Quando si crea il `Northwind` DataSet tipizzato nella [prima esercitazione](../introduction/creating-a-data-access-layer-cs.md), ad esempio, le informazioni sulla stringa di connessione sono state aggiunte automaticamente ai `Web.config` nella sezione `<connectionStrings>`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="af8f7-116">Successivamente, nell'esercitazione sulle [pagine master e sulla navigazione nel sito](../introduction/master-pages-and-site-navigation-cs.md) , è stato aggiornato manualmente `Web.config`, aggiungendo un elemento `<pages>` che indica che tutte le pagine ASP.NET del progetto devono usare il tema `DataWebControls`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="af8f7-117">Poiché `Web.config` possono contenere dati sensibili, ad esempio stringhe di connessione, è importante che il contenuto di `Web.config` venga mantenuto protetto e nascosto dai visualizzatori non autorizzati.</span><span class="sxs-lookup"><span data-stu-id="af8f7-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="af8f7-118">Per impostazione predefinita, qualsiasi richiesta HTTP a un file con l'estensione `.config` viene gestita dal motore ASP.NET, che restituisce il messaggio *questo tipo di pagina non viene servito* come indicato nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="af8f7-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="af8f7-119">Ciò significa che i visitatori non possono visualizzare il contenuto del file `Web.config` semplicemente inserendo http://www.YourServer.com/Web.config nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="af8f7-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>

<span data-ttu-id="af8f7-120">[![visitare Web. config tramite un browser restituisce un messaggio di questo tipo non viene servito](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="af8f7-120">[![Visiting Web.config Through a Browser Returns a This type of page is not served Message](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="af8f7-121">**Figura 1**: la visita di `Web.config` tramite un browser restituisce un messaggio di questo tipo di pagina non viene servito ([fare clic per visualizzare l'immagine con dimensioni complete](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="af8f7-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>

<span data-ttu-id="af8f7-122">Ma cosa accade se un utente malintenzionato riesce a trovare un altro exploit che consente di visualizzare il contenuto del file `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="af8f7-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="af8f7-123">Cosa può fare un utente malintenzionato con queste informazioni e quali operazioni è possibile eseguire per proteggere ulteriormente le informazioni riservate all'interno `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="af8f7-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="af8f7-124">Fortunatamente, la maggior parte delle sezioni in `Web.config` non contengono informazioni riservate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="af8f7-125">Qual è il danno che un utente malintenzionato può perpetrare se conosce il nome del tema predefinito usato dalle pagine di ASP.NET?</span><span class="sxs-lookup"><span data-stu-id="af8f7-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="af8f7-126">Alcune `Web.config` sezioni, tuttavia, contengono informazioni riservate che possono includere stringhe di connessione, nomi utente, password, nomi di server, chiavi di crittografia e così via.</span><span class="sxs-lookup"><span data-stu-id="af8f7-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="af8f7-127">Queste informazioni si trovano in genere nelle sezioni `Web.config` seguenti:</span><span class="sxs-lookup"><span data-stu-id="af8f7-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="af8f7-128">In questa esercitazione vengono esaminate le tecniche per la protezione di tali informazioni di configurazione riservate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="af8f7-129">Come si vedrà, il .NET Framework versione 2,0 include un sistema di configurazioni protette che consente di crittografare e decrittografare le sezioni di configurazione selezionate a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="af8f7-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="af8f7-130">Questa esercitazione conclude con i suggerimenti di Microsoft per la connessione a un database da un'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="af8f7-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="af8f7-131">Oltre a crittografare le stringhe di connessione, è possibile contribuire alla protezione avanzata del sistema garantendo la connessione al database in modo sicuro.</span><span class="sxs-lookup"><span data-stu-id="af8f7-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>

## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="af8f7-132">Passaggio 1: esplorazione delle opzioni di configurazione protette di ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="af8f7-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="af8f7-133">ASP.NET 2,0 include un sistema di configurazione protetto per la crittografia e la decrittografia delle informazioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="af8f7-134">Sono inclusi i metodi nel .NET Framework che possono essere usati per crittografare o decrittografare le informazioni di configurazione a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="af8f7-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="af8f7-135">Il sistema di configurazione protetta utilizza il [modello di provider](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), che consente agli sviluppatori di scegliere quale implementazione di crittografia viene utilizzata.</span><span class="sxs-lookup"><span data-stu-id="af8f7-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="af8f7-136">Il .NET Framework viene fornito con due provider di configurazione protetti:</span><span class="sxs-lookup"><span data-stu-id="af8f7-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="af8f7-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) : usa l' [algoritmo RSA](http://en.wikipedia.org/wiki/Rsa) asimmetrico per la crittografia e la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="af8f7-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="af8f7-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) : usa Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) per la crittografia e la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="af8f7-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="af8f7-139">Poiché il sistema di configurazione protetta implementa il modello di progettazione del provider, è possibile creare il proprio provider di configurazione protetta e inserirlo nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="af8f7-140">Per ulteriori informazioni su questo processo, vedere [implementazione di un provider di configurazione protetta](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) .</span><span class="sxs-lookup"><span data-stu-id="af8f7-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="af8f7-141">I provider RSA e DPAPI utilizzano le chiavi per le routine di crittografia e decrittografia e possono essere archiviate a livello di computer o utente.</span><span class="sxs-lookup"><span data-stu-id="af8f7-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="af8f7-142">Le chiavi a livello di computer sono ideali per gli scenari in cui l'applicazione Web viene eseguita in un server dedicato o in presenza di più applicazioni in un server che devono condividere informazioni crittografate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="af8f7-143">Le chiavi a livello di utente sono un'opzione più sicura negli ambienti host condivisi in cui altre applicazioni nello stesso server non devono essere in grado di decrittografare le sezioni di configurazione protetta dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="af8f7-144">In questa esercitazione gli esempi utilizzeranno il provider DPAPI e le chiavi a livello di computer.</span><span class="sxs-lookup"><span data-stu-id="af8f7-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="af8f7-145">In particolare, si esaminerà la crittografia della sezione `<connectionStrings>` in `Web.config`, sebbene il sistema di configurazione protetta possa essere usato per crittografare la maggior parte delle `Web.config` sezione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="af8f7-146">Per informazioni sull'uso delle chiavi a livello di utente o sul provider RSA, vedere le risorse nella sezione ulteriori letture alla fine di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="af8f7-147">I provider di `RSAProtectedConfigurationProvider` e di `DPAPIProtectedConfigurationProvider` vengono registrati nel file `machine.config` con i nomi di provider `RsaProtectedConfigurationProvider` e `DataProtectionConfigurationProvider`, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="af8f7-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="af8f7-148">Quando si esegue la crittografia o la decrittografia delle informazioni di configurazione, è necessario fornire il nome del provider appropriato (`RsaProtectedConfigurationProvider` o `DataProtectionConfigurationProvider`) anziché il nome effettivo del tipo (`RSAProtectedConfigurationProvider` e `DPAPIProtectedConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="af8f7-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="af8f7-149">È possibile trovare il file di `machine.config` nella cartella `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>

## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="af8f7-150">Passaggio 2: crittografare e decrittografare le sezioni di configurazione a livello di codice</span><span class="sxs-lookup"><span data-stu-id="af8f7-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="af8f7-151">Con poche righe di codice è possibile crittografare o decrittografare una particolare sezione di configurazione usando un provider specificato.</span><span class="sxs-lookup"><span data-stu-id="af8f7-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="af8f7-152">Il codice, come si vedrà a breve, è sufficiente fare riferimento a livello di codice alla sezione di configurazione appropriata, chiamare il metodo `ProtectSection` o `UnprotectSection` e quindi chiamare il metodo `Save` per salvare in modo permanente le modifiche.</span><span class="sxs-lookup"><span data-stu-id="af8f7-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="af8f7-153">Il .NET Framework include inoltre un'utilità da riga di comando utile che consente di crittografare e decrittografare le informazioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="af8f7-154">Questa utilità della riga di comando verrà esaminata nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="af8f7-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="af8f7-155">Per illustrare la protezione a livello di codice delle informazioni di configurazione, è possibile creare una pagina ASP.NET che includa i pulsanti per la crittografia e la decrittografia della sezione `<connectionStrings>` in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="af8f7-156">Per iniziare, aprire la pagina `EncryptingConfigSections.aspx` nella cartella `AdvancedDAL`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="af8f7-157">Trascinare un controllo TextBox dalla casella degli strumenti nella finestra di progettazione, impostando la relativa proprietà `ID` su `WebConfigContents`, la relativa proprietà `TextMode` su `MultiLine`e le relative proprietà `Width` e `Rows` rispettivamente su 95% e 15.</span><span class="sxs-lookup"><span data-stu-id="af8f7-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="af8f7-158">Questo controllo TextBox visualizzerà il contenuto di `Web.config` che ci consente di verificare rapidamente se il contenuto è crittografato o meno.</span><span class="sxs-lookup"><span data-stu-id="af8f7-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="af8f7-159">Naturalmente, in un'applicazione reale non si vuole mai visualizzare il contenuto del `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="af8f7-160">Sotto la casella di testo aggiungere due controlli Button denominati `EncryptConnStrings` e `DecryptConnStrings`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="af8f7-161">Impostare le proprietà di testo per crittografare le stringhe di connessione e decrittografare le stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="af8f7-162">A questo punto la schermata dovrebbe essere simile alla figura 2.</span><span class="sxs-lookup"><span data-stu-id="af8f7-162">At this point your screen should look similar to Figure 2.</span></span>

<span data-ttu-id="af8f7-163">[![aggiungere una casella di testo e i controlli Web di due pulsanti alla pagina](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="af8f7-163">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="af8f7-164">**Figura 2**: aggiungere una casella di testo e i controlli Web di due pulsanti alla pagina ([fare clic per visualizzare l'immagine con dimensioni complete](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="af8f7-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>

<span data-ttu-id="af8f7-165">Successivamente, è necessario scrivere il codice che carica e visualizza il contenuto di `Web.config` nella casella di testo `WebConfigContents` quando la pagina viene caricata per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="af8f7-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="af8f7-166">Aggiungere il codice seguente alla classe code-behind della pagina.</span><span class="sxs-lookup"><span data-stu-id="af8f7-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="af8f7-167">Questo codice aggiunge un metodo denominato `DisplayWebConfig` e lo chiama dal gestore eventi `Page_Load` quando `Page.IsPostBack` è `false`:</span><span class="sxs-lookup"><span data-stu-id="af8f7-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>

[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="af8f7-168">Il metodo `DisplayWebConfig` usa la [classe`File`](https://msdn.microsoft.com/library/system.io.file.aspx) per aprire il file `Web.config` dell'applicazione, la [classe`StreamReader`](https://msdn.microsoft.com/library/system.io.streamreader.aspx) per leggerne il contenuto in una stringa e la [classe`Path`](https://msdn.microsoft.com/library/system.io.path.aspx) per generare il percorso fisico del file di `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="af8f7-169">Queste tre classi sono tutte disponibili nello [spazio dei nomi`System.IO`](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="af8f7-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="af8f7-170">Di conseguenza, è necessario aggiungere un `using` `System.IO` istruzione all'inizio della classe code-behind o, in alternativa, anteporre i nomi di questa classe a `System.IO.`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="af8f7-171">Successivamente, è necessario aggiungere gestori di eventi per i controlli di due pulsanti `Click` eventi e aggiungere il codice necessario per crittografare e decrittografare la sezione `<connectionStrings>` utilizzando una chiave a livello di computer con il provider DPAPI.</span><span class="sxs-lookup"><span data-stu-id="af8f7-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="af8f7-172">Nella finestra di progettazione fare doppio clic su ognuno dei pulsanti per aggiungere un gestore dell'evento `Click` nella classe code-behind, quindi aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="af8f7-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>

[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="af8f7-173">Il codice usato nei due gestori di eventi è quasi identico.</span><span class="sxs-lookup"><span data-stu-id="af8f7-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="af8f7-174">Entrambi iniziano ottenendo informazioni sul file di `Web.config` dell'applicazione corrente tramite il [metodo`OpenWebConfiguration`](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx)della [classe`WebConfigurationManager`](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) .</span><span class="sxs-lookup"><span data-stu-id="af8f7-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="af8f7-175">Questo metodo restituisce il file di configurazione Web per il percorso virtuale specificato.</span><span class="sxs-lookup"><span data-stu-id="af8f7-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="af8f7-176">A questo punto, è possibile accedere alla sezione `<connectionStrings>` `Web.config` file tramite il [metodo`GetSection(sectionName)`](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx)della [classe`Configuration`](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) , che restituisce un oggetto [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) .</span><span class="sxs-lookup"><span data-stu-id="af8f7-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="af8f7-177">L'oggetto `ConfigurationSection` include una [proprietà`SectionInformation`](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) che fornisce informazioni e funzionalità aggiuntive relative alla sezione di configurazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="af8f7-178">Come illustrato nel codice precedente, è possibile determinare se la sezione di configurazione è crittografata controllando la proprietà `SectionInformation` proprietà `IsProtected`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="af8f7-179">Inoltre, la sezione può essere crittografata o decrittografata tramite la proprietà `SectionInformation` `ProtectSection(provider)` e i metodi di `UnprotectSection`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="af8f7-180">Il metodo `ProtectSection(provider)` accetta come input una stringa che specifica il nome del provider di configurazione protetta da usare per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="af8f7-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="af8f7-181">Nel gestore eventi del pulsante `EncryptConnString` viene passato DataProtectionConfigurationProvider al metodo `ProtectSection(provider)` in modo che venga utilizzato il provider DPAPI.</span><span class="sxs-lookup"><span data-stu-id="af8f7-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="af8f7-182">Il metodo `UnprotectSection` può determinare il provider utilizzato per crittografare la sezione di configurazione e pertanto non richiede alcun parametro di input.</span><span class="sxs-lookup"><span data-stu-id="af8f7-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="af8f7-183">Dopo aver chiamato il metodo `ProtectSection(provider)` o `UnprotectSection`, è necessario chiamare il metodo dell'oggetto `Configuration` s [`Save`](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) per salvare in modo permanente le modifiche.</span><span class="sxs-lookup"><span data-stu-id="af8f7-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="af8f7-184">Una volta che le informazioni di configurazione sono state crittografate o decrittografate e le modifiche sono state salvate, viene chiamato `DisplayWebConfig` per caricare il contenuto del `Web.config` aggiornato nel controllo TextBox.</span><span class="sxs-lookup"><span data-stu-id="af8f7-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="af8f7-185">Dopo aver immesso il codice precedente, testarlo visitando la pagina `EncryptingConfigSections.aspx` tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="af8f7-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="af8f7-186">Inizialmente, viene visualizzata una pagina che elenca il contenuto di `Web.config` con la sezione `<connectionStrings>` visualizzata in testo normale (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="af8f7-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>

<span data-ttu-id="af8f7-187">[![aggiungere una casella di testo e i controlli Web di due pulsanti alla pagina](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="af8f7-187">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="af8f7-188">**Figura 3**: aggiungere una casella di testo e i controlli Web di due pulsanti alla pagina ([fare clic per visualizzare l'immagine con dimensioni complete](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="af8f7-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>

<span data-ttu-id="af8f7-189">A questo punto fare clic sul pulsante Crittografa stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="af8f7-190">Se la convalida della richiesta è abilitata, il markup inviato dalla casella di testo `WebConfigContents` produrrà un `HttpRequestValidationException`, che Visualizza il messaggio, dal client è stato rilevato un valore di `Request.Form` potenzialmente pericoloso.</span><span class="sxs-lookup"><span data-stu-id="af8f7-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="af8f7-191">La convalida delle richieste, abilitata per impostazione predefinita in ASP.NET 2,0, impedisce i postback che includono codice HTML non codificato ed è progettato per impedire attacchi di script injection.</span><span class="sxs-lookup"><span data-stu-id="af8f7-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="af8f7-192">Questo controllo può essere disabilitato a livello di pagina o di applicazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="af8f7-193">Per disattivarla per questa pagina, impostare l'impostazione `ValidateRequest` su `false` nella direttiva `@Page`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="af8f7-194">La direttiva `@Page` si trova nella parte superiore del markup dichiarativo della pagina.</span><span class="sxs-lookup"><span data-stu-id="af8f7-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>

[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="af8f7-195">Per altre informazioni sulla convalida della richiesta, il suo scopo, su come disabilitarlo a livello di pagina e a livello di applicazione, nonché come codificare il markup HTML, vedere [richieste di convalida-prevenzione degli attacchi di script](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="af8f7-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="af8f7-196">Dopo aver disabilitato la convalida della richiesta per la pagina, provare a fare nuovamente clic sul pulsante Crittografa stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="af8f7-197">Durante il postback, viene eseguito l'accesso al file di configurazione e la relativa sezione `<connectionStrings>` crittografata utilizzando il provider DPAPI.</span><span class="sxs-lookup"><span data-stu-id="af8f7-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="af8f7-198">La casella di testo viene quindi aggiornata per visualizzare il nuovo contenuto del `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="af8f7-199">Come illustrato nella figura 4, le informazioni `<connectionStrings>` sono ora crittografate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>

<span data-ttu-id="af8f7-200">[![facendo clic sul pulsante Crittografa stringhe di connessione viene crittografata la sezione&gt; &lt;connectionString](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="af8f7-200">[![Clicking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="af8f7-201">**Figura 4**: facendo clic sul pulsante Crittografa stringhe di connessione viene crittografata la sezione `<connectionString>` ([fare clic per visualizzare l'immagine con dimensioni complete](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="af8f7-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>

<span data-ttu-id="af8f7-202">Di seguito è riportata la sezione `<connectionStrings>` crittografata generata nel computer, sebbene parte del contenuto nell'elemento `<CipherData>` sia stata rimossa per brevità:</span><span class="sxs-lookup"><span data-stu-id="af8f7-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>

[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="af8f7-203">L'elemento `<connectionStrings>` specifica il provider utilizzato per eseguire la crittografia (`DataProtectionConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="af8f7-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="af8f7-204">Queste informazioni vengono utilizzate dal metodo `UnprotectSection` quando si fa clic sul pulsante Decrypt Connection Strings.</span><span class="sxs-lookup"><span data-stu-id="af8f7-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>

<span data-ttu-id="af8f7-205">Quando si accede alle informazioni della stringa di connessione da `Web.config`, dal codice scritto, da un controllo SqlDataSource o dal codice generato automaticamente dagli oggetti TableAdapter nei set di dati tipizzati, questo viene decrittografato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="af8f7-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="af8f7-206">In breve, non è necessario aggiungere codice o logica aggiuntiva per decrittografare la sezione `<connectionString>` crittografata.</span><span class="sxs-lookup"><span data-stu-id="af8f7-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="af8f7-207">Per illustrare questo problema, vedere una delle esercitazioni precedenti, ad esempio la semplice esercitazione sulla visualizzazione della sezione report di base (`~/BasicReporting/SimpleDisplay.aspx`).</span><span class="sxs-lookup"><span data-stu-id="af8f7-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="af8f7-208">Come illustrato nella figura 5, l'esercitazione funziona esattamente come previsto, a indicare che le informazioni crittografate della stringa di connessione vengono decrittografate automaticamente dalla pagina ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="af8f7-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>

<span data-ttu-id="af8f7-209">[![il livello di accesso ai dati decrittografa automaticamente le informazioni sulla stringa di connessione](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="af8f7-209">[![The Data Access Layer Automatically Decrypts the Connection String Information](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="af8f7-210">**Figura 5**: il livello di accesso ai dati decrittografa automaticamente le informazioni sulla stringa[di connessione (fare clic per visualizzare l'immagine con dimensioni complete](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="af8f7-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>

<span data-ttu-id="af8f7-211">Per ripristinare la sezione del `<connectionStrings>` alla relativa rappresentazione in testo normale, fare clic sul pulsante Decrypt Connection Strings.</span><span class="sxs-lookup"><span data-stu-id="af8f7-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="af8f7-212">Durante il postback dovrebbero essere visualizzate le stringhe di connessione in `Web.config` testo normale.</span><span class="sxs-lookup"><span data-stu-id="af8f7-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="af8f7-213">A questo punto, la schermata dovrebbe apparire come se fosse stata visualizzata per la prima volta in questa pagina (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="af8f7-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnet_regiisexe"></a><span data-ttu-id="af8f7-214">Passaggio 3: crittografia delle sezioni di configurazione con`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="af8f7-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="af8f7-215">Il .NET Framework include un'ampia gamma di strumenti da riga di comando nella cartella `$WINDOWS$\Microsoft.NET\Framework\version\`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="af8f7-216">Nell'esercitazione [utilizzo delle dipendenze della cache SQL](../caching-data/using-sql-cache-dependencies-cs.md) , ad esempio, è stato esaminato l'utilizzo dello strumento da riga di comando `aspnet_regsql.exe` per aggiungere l'infrastruttura necessaria per le dipendenze della cache SQL.</span><span class="sxs-lookup"><span data-stu-id="af8f7-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="af8f7-217">Un altro strumento da riga di comando utile in questa cartella è lo [strumento di registrazione ASP.NET IIS (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="af8f7-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="af8f7-218">Come suggerisce il nome, lo strumento di registrazione IIS ASP.NET viene usato principalmente per registrare un'applicazione ASP.NET 2,0 con server Web di livello professionale Microsoft, IIS.</span><span class="sxs-lookup"><span data-stu-id="af8f7-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="af8f7-219">Oltre alle funzionalità correlate a IIS, lo strumento di registrazione IIS ASP.NET può essere usato anche per crittografare o decrittografare le sezioni di configurazione specificate in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="af8f7-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="af8f7-220">Nell'istruzione seguente viene illustrata la sintassi generale utilizzata per crittografare una sezione di configurazione con lo strumento da riga di comando `aspnet_regiis.exe`:</span><span class="sxs-lookup"><span data-stu-id="af8f7-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="af8f7-221">la *sezione di* configurazione da crittografare (ad esempio connectionStrings), la *directory fisica\_* è il percorso fisico completo della directory radice dell'applicazione Web e il *provider* è il nome del provider di configurazione protetta da usare (ad esempio DataProtectionConfigurationProvider).</span><span class="sxs-lookup"><span data-stu-id="af8f7-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="af8f7-222">In alternativa, se l'applicazione Web è registrata in IIS, è possibile immettere il percorso virtuale anziché il percorso fisico usando la sintassi seguente:</span><span class="sxs-lookup"><span data-stu-id="af8f7-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="af8f7-223">Nell'esempio di `aspnet_regiis.exe` seguente viene crittografata la sezione `<connectionStrings>` utilizzando il provider DPAPI con una chiave a livello di computer:</span><span class="sxs-lookup"><span data-stu-id="af8f7-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="af8f7-224">Analogamente, è possibile usare lo strumento da riga di comando `aspnet_regiis.exe` per decrittografare le sezioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="af8f7-225">Anziché utilizzare l'opzione `-pef`, utilizzare `-pdf` (o invece di `-pe`utilizzare `-pd`).</span><span class="sxs-lookup"><span data-stu-id="af8f7-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="af8f7-226">Si noti inoltre che il nome del provider non è necessario per la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="af8f7-226">Also, note that the provider name is not necessary when decrypting.</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="af8f7-227">Poiché si utilizza il provider DPAPI, che utilizza chiavi specifiche del computer, è necessario eseguire `aspnet_regiis.exe` dallo stesso computer da cui vengono gestite le pagine Web.</span><span class="sxs-lookup"><span data-stu-id="af8f7-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="af8f7-228">Se, ad esempio, si esegue questo programma da riga di comando dal computer di sviluppo locale e quindi si carica il file Web. config crittografato nel server di produzione, il server di produzione non sarà in grado di decrittografare le informazioni della stringa di connessione perché è stato crittografato uso delle chiavi specifiche del computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="af8f7-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="af8f7-229">Il provider RSA non presenta questa limitazione perché è possibile esportare le chiavi RSA in un altro computer.</span><span class="sxs-lookup"><span data-stu-id="af8f7-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>

## <a name="understanding-database-authentication-options"></a><span data-ttu-id="af8f7-230">Informazioni sulle opzioni di autenticazione del database</span><span class="sxs-lookup"><span data-stu-id="af8f7-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="af8f7-231">Prima che un'applicazione possa emettere `SELECT`, `INSERT`, `UPDATE`o `DELETE` query a un database Microsoft SQL Server, il database deve innanzitutto identificare il richiedente.</span><span class="sxs-lookup"><span data-stu-id="af8f7-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="af8f7-232">Questo processo è noto come *autenticazione* e SQL Server fornisce due metodi di autenticazione:</span><span class="sxs-lookup"><span data-stu-id="af8f7-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="af8f7-233">**Autenticazione di Windows** : il processo con cui viene eseguita l'applicazione viene utilizzato per comunicare con il database.</span><span class="sxs-lookup"><span data-stu-id="af8f7-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="af8f7-234">Quando si esegue un'applicazione ASP.NET con Visual Studio 2005 s Server di sviluppo ASP.NET, l'applicazione ASP.NET presuppone l'identità dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="af8f7-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="af8f7-235">Per le applicazioni ASP.NET in Microsoft Internet Information Server (IIS), le applicazioni ASP.NET in genere assumono l'identità di `domainName``\MachineName` o `domainName``\NETWORK SERVICE`, anche se possono essere personalizzate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="af8f7-236">**Autenticazione SQL** : i valori di ID utente e password vengono specificati come credenziali per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="af8f7-237">Con l'autenticazione SQL, l'ID utente e la password vengono specificati nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="af8f7-238">L'autenticazione di Windows è preferibile rispetto all'autenticazione SQL perché è più sicura.</span><span class="sxs-lookup"><span data-stu-id="af8f7-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="af8f7-239">Con l'autenticazione di Windows la stringa di connessione è priva di nome utente e password e, se il server Web e il server di database si trovano in due computer diversi, le credenziali non vengono inviate in rete come testo normale.</span><span class="sxs-lookup"><span data-stu-id="af8f7-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="af8f7-240">Con l'autenticazione SQL, tuttavia, le credenziali di autenticazione sono hardcoded nella stringa di connessione e vengono trasmesse dal server Web al server di database in testo normale.</span><span class="sxs-lookup"><span data-stu-id="af8f7-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="af8f7-241">In queste esercitazioni è stata utilizzata l'autenticazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="af8f7-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="af8f7-242">È possibile stabilire quale modalità di autenticazione viene utilizzata controllando la stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="af8f7-243">La stringa di connessione in `Web.config` per le esercitazioni è stata:</span><span class="sxs-lookup"><span data-stu-id="af8f7-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="af8f7-244">Il valore Integrated Security = true e la mancanza di un nome utente e una password indicano che è in uso l'autenticazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="af8f7-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="af8f7-245">In alcune stringhe di connessione viene utilizzato il termine connessione trusted = Sì o Integrated Security = SSPI anziché Integrated Security = true, ma tutti e tre indicano l'utilizzo dell'autenticazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="af8f7-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="af8f7-246">Nell'esempio seguente viene illustrata una stringa di connessione che utilizza l'autenticazione SQL.</span><span class="sxs-lookup"><span data-stu-id="af8f7-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="af8f7-247">Si notino le credenziali incorporate nella stringa di connessione:</span><span class="sxs-lookup"><span data-stu-id="af8f7-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="af8f7-248">Si supponga che un utente malintenzionato sia in grado di visualizzare il file di `Web.config` dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="af8f7-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="af8f7-249">Se si usa l'autenticazione SQL per connettersi a un database accessibile tramite Internet, l'utente malintenzionato può usare questa stringa di connessione per connettersi al database tramite SQL Management Studio o da pagine ASP.NET nel proprio sito Web.</span><span class="sxs-lookup"><span data-stu-id="af8f7-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="af8f7-250">Per attenuare questa minaccia, crittografare le informazioni della stringa di connessione in `Web.config` usando il sistema di configurazione protetto.</span><span class="sxs-lookup"><span data-stu-id="af8f7-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="af8f7-251">Per altre informazioni sui diversi tipi di autenticazione disponibili in SQL Server, vedere [compilazione di applicazioni ASP.NET sicure: autenticazione, autorizzazione e comunicazione sicura](https://msdn.microsoft.com/library/aa302392.aspx).</span><span class="sxs-lookup"><span data-stu-id="af8f7-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="af8f7-252">Per ulteriori esempi di stringhe di connessione che illustrano le differenze tra la sintassi di autenticazione di Windows e SQL, vedere [connectionStrings.com](http://www.connectionstrings.com/).</span><span class="sxs-lookup"><span data-stu-id="af8f7-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>

## <a name="summary"></a><span data-ttu-id="af8f7-253">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="af8f7-253">Summary</span></span>

<span data-ttu-id="af8f7-254">Per impostazione predefinita, non è possibile accedere ai file con estensione `.config` in un'applicazione ASP.NET tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="af8f7-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="af8f7-255">Questi tipi di file non vengono restituiti perché possono contenere informazioni riservate, ad esempio stringhe di connessione del database, nomi utente e password e così via.</span><span class="sxs-lookup"><span data-stu-id="af8f7-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="af8f7-256">Il sistema di configurazione protetta in .NET 2,0 consente di proteggere ulteriormente le informazioni riservate consentendo la crittografia delle sezioni di configurazione specificate.</span><span class="sxs-lookup"><span data-stu-id="af8f7-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="af8f7-257">Sono disponibili due provider di configurazione protetta predefiniti: uno che usa l'algoritmo RSA e uno che usa la Data Protection API di Windows (DPAPI).</span><span class="sxs-lookup"><span data-stu-id="af8f7-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="af8f7-258">In questa esercitazione è stato esaminato come crittografare e decrittografare le impostazioni di configurazione usando il provider DPAPI.</span><span class="sxs-lookup"><span data-stu-id="af8f7-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="af8f7-259">Questa operazione può essere eseguita sia a livello di codice, come illustrato nel passaggio 2, sia tramite lo strumento da riga di comando `aspnet_regiis.exe`, descritto nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="af8f7-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="af8f7-260">Per altre informazioni sull'uso delle chiavi a livello di utente o sul provider RSA, vedere le risorse nella sezione ulteriori letture.</span><span class="sxs-lookup"><span data-stu-id="af8f7-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="af8f7-261">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="af8f7-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="af8f7-262">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="af8f7-262">Further Reading</span></span>

<span data-ttu-id="af8f7-263">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, fare riferimento alle risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="af8f7-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="af8f7-264">Creazione di applicazioni ASP.NET sicure: autenticazione, autorizzazione e comunicazione sicura</span><span class="sxs-lookup"><span data-stu-id="af8f7-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="af8f7-265">Crittografia delle informazioni di configurazione nelle applicazioni ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="af8f7-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="af8f7-266">Crittografia dei valori di `Web.config` in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="af8f7-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="af8f7-267">Procedura: crittografare le sezioni di configurazione in ASP.NET 2,0 usando DPAPI</span><span class="sxs-lookup"><span data-stu-id="af8f7-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="af8f7-268">Procedura: crittografare le sezioni di configurazione in ASP.NET 2,0 usando RSA</span><span class="sxs-lookup"><span data-stu-id="af8f7-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="af8f7-269">API di configurazione in .NET 2,0</span><span class="sxs-lookup"><span data-stu-id="af8f7-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="af8f7-270">Protezione dei dati di Windows</span><span class="sxs-lookup"><span data-stu-id="af8f7-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="af8f7-271">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="af8f7-271">About the Author</span></span>

<span data-ttu-id="af8f7-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette ASP/ASP. NET Books e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="af8f7-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="af8f7-273">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="af8f7-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="af8f7-274">Il suo ultimo libro è [*Sams Teach Yourself ASP.NET 2,0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="af8f7-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="af8f7-275">Può essere raggiunto in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="af8f7-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="af8f7-276">o tramite il suo Blog, disponibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="af8f7-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="af8f7-277">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="af8f7-277">Special Thanks To</span></span>

<span data-ttu-id="af8f7-278">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="af8f7-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="af8f7-279">I revisori del lead per questa esercitazione erano Teresa Murphy e Randy Schmidt.</span><span class="sxs-lookup"><span data-stu-id="af8f7-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="af8f7-280">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="af8f7-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="af8f7-281">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="af8f7-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="af8f7-282">[Precedente](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [Successivo](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="af8f7-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
