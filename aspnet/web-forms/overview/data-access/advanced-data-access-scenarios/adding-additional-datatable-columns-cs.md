---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
title: Aggiunta di colonne DataTable aggiuntiveC#() | Microsoft Docs
author: rick-anderson
description: Quando si utilizza la procedura guidata TableAdapter per creare un DataSet tipizzato, l'oggetto DataTable corrispondente contiene le colonne restituite dalla query del database principale. Ma...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 615f3361-f21f-4338-8bc1-fce8ae071de9
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
msc.type: authoredcontent
ms.openlocfilehash: a96f254aa54e7077456ac1a9bd6c5e2a17619d96
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/28/2019
ms.locfileid: "74610860"
---
# <a name="adding-additional-datatable-columns-c"></a><span data-ttu-id="a4f5e-104">Aggiunta di colonne DataTable aggiuntive (C#)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-104">Adding Additional DataTable Columns (C#)</span></span>

<span data-ttu-id="a4f5e-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a4f5e-106">[Scarica codice](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) o [Scarica PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) or [Download PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span></span>

> <span data-ttu-id="a4f5e-107">Quando si utilizza la procedura guidata TableAdapter per creare un DataSet tipizzato, l'oggetto DataTable corrispondente contiene le colonne restituite dalla query del database principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="a4f5e-108">In alcuni casi, tuttavia, è necessario che la DataTable includa colonne aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="a4f5e-109">In questa esercitazione viene illustrato il motivo per cui le stored procedure sono consigliate quando sono necessarie colonne DataTable aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>

## <a name="introduction"></a><span data-ttu-id="a4f5e-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="a4f5e-110">Introduction</span></span>

<span data-ttu-id="a4f5e-111">Quando si aggiunge un TableAdapter a un DataSet tipizzato, lo schema di DataTable corrispondente è determinato dalla query principale di TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="a4f5e-112">Se, ad esempio, la query principale restituisce i campi dati *A*, *b*e *c*, la DataTable avrà tre colonne corrispondenti denominate *a*, *b*e *c*. Oltre alla query principale, un TableAdapter può includere query aggiuntive che restituiscono, forse, un subset di dati in base a un parametro.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="a4f5e-113">Ad esempio, oltre alla query principale `ProductsTableAdapter` s, che restituisce informazioni su tutti i prodotti, contiene anche metodi quali `GetProductsByCategoryID(categoryID)` e `GetProductByProductID(productID)`che restituiscono informazioni specifiche sul prodotto basate su un parametro fornito.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="a4f5e-114">Il modello di cui lo schema di DataTable riflette la query principale di TableAdapter è adatto se tutti i metodi di TableAdapter restituiscono lo stesso o un minor numero di campi dati rispetto a quelli specificati nella query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="a4f5e-115">Se un metodo TableAdapter deve restituire campi dati aggiuntivi, è necessario espandere di conseguenza lo schema di DataTable.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="a4f5e-116">In [Master/Detail usando un elenco puntato di record master con un'esercitazione DataList dettagli](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) è stato aggiunto un metodo al `CategoriesTableAdapter` che ha restituito i campi dati `CategoryID`, `CategoryName`e `Description` definiti nella query principale più `NumberOfProducts`, un campo dati aggiuntivo che ha riportato il numero di prodotti associati a ogni categoria.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="a4f5e-117">È stata aggiunta manualmente una nuova colonna al `CategoriesDataTable` per acquisire il valore del campo dati `NumberOfProducts` da questo nuovo metodo.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="a4f5e-118">Come illustrato nell'esercitazione sul [caricamento di file](../working-with-binary-files/uploading-files-cs.md) , è necessario prestare particolare attenzione agli oggetti TableAdapter che usano istruzioni SQL ad hoc e che dispongono di metodi i cui campi dati non corrispondono esattamente alla query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-cs.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="a4f5e-119">Se la configurazione guidata TableAdapter viene eseguita di nuovo, aggiornerà tutti i metodi di TableAdapter in modo che l'elenco dei campi dati corrisponda alla query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="a4f5e-120">Di conseguenza, qualsiasi metodo con elenchi di colonne personalizzati verrà ripristinato nell'elenco delle colonne della query principale e non restituirà i dati previsti.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="a4f5e-121">Questo problema non si verifica quando si utilizzano stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="a4f5e-122">In questa esercitazione verrà esaminato come estendere uno schema di DataTable per includere colonne aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="a4f5e-123">A causa della fragilità del TableAdapter quando si usano istruzioni SQL ad hoc, in questa esercitazione si useranno le stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="a4f5e-124">Per ulteriori informazioni sulla configurazione di un TableAdapter per l'utilizzo di stored procedure, vedere la pagina relativa alla [creazione di nuove stored procedure per i TableAdapter del set di dati tipizzati](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) e all' [utilizzo di stored procedure esistenti per le esercitazioni di TableAdapter tipizzati del DataSet](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) .</span><span class="sxs-lookup"><span data-stu-id="a4f5e-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="a4f5e-125">Passaggio 1: aggiunta di una colonna`PriceQuartile`al`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="a4f5e-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="a4f5e-126">Nell'esercitazione *creazione di nuove stored procedure per set di dati tipizzati s TableAdapters* è stato creato un set di dati tipizzato denominato `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="a4f5e-127">Questo set di dati contiene attualmente due DataTable: `ProductsDataTable` e `EmployeesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="a4f5e-128">Il `ProductsTableAdapter` dispone dei tre metodi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a4f5e-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="a4f5e-129">`GetProducts`: la query principale, che restituisce tutti i record della tabella `Products`</span><span class="sxs-lookup"><span data-stu-id="a4f5e-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="a4f5e-130">`GetProductsByCategoryID(categoryID)`: restituisce tutti i prodotti con il parametro *CategoryID*specificato.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="a4f5e-131">`GetProductByProductID(productID)`: restituisce il prodotto specifico con il *ProductID*specificato.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="a4f5e-132">La query principale e i due metodi aggiuntivi restituiscono tutti lo stesso set di campi dati, vale a dire tutte le colonne della tabella `Products`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="a4f5e-133">Non sono presenti sottoquery correlate o `JOIN` s che effettua il pull dei dati correlati dalle tabelle `Categories` o `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="a4f5e-134">Pertanto, il `ProductsDataTable` dispone di una colonna corrispondente per ogni campo nella tabella `Products`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="a4f5e-135">Per questa esercitazione, è possibile aggiungere un metodo al `ProductsTableAdapter` denominato `GetProductsWithPriceQuartile` che restituisce tutti i prodotti.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="a4f5e-136">Oltre ai campi di dati di prodotto standard, `GetProductsWithPriceQuartile` includerà anche un campo dati `PriceQuartile` che indica in quale quartile il prezzo del prodotto è inferiore.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="a4f5e-137">Ad esempio, i prodotti il cui prezzo è il 25% più costoso avranno un valore di `PriceQuartile` pari a 1, mentre quelli i cui prezzi rientrano nel 25% in basso avranno un valore pari a 4.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="a4f5e-138">Prima di preoccuparsi di creare il stored procedure per restituire queste informazioni, è necessario prima di tutto aggiornare i `ProductsDataTable` per includere una colonna che contenga i risultati del `PriceQuartile` quando viene usato il metodo `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="a4f5e-139">Aprire il set di dati `NorthwindWithSprocs` e fare clic con il pulsante destro del mouse sulla `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="a4f5e-140">Scegliere Aggiungi dal menu di scelta rapida e quindi selezionare colonna.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-140">Choose Add from the context-menu and then pick Column.</span></span>

<span data-ttu-id="a4f5e-141">[![aggiungere una nuova colonna a ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span></span>

<span data-ttu-id="a4f5e-142">**Figura 1**: aggiungere una nuova colonna al `ProductsDataTable` ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image3.png))</span></span>

<span data-ttu-id="a4f5e-143">Verrà aggiunta una nuova colonna alla DataTable denominata Column1 di tipo `System.String`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="a4f5e-144">È necessario aggiornare il nome della colonna in PriceQuartile e il tipo in `System.Int32` perché verrà usato per contenere un numero compreso tra 1 e 4.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="a4f5e-145">Selezionare la colonna appena aggiunta nel `ProductsDataTable` e, dal Finestra Proprietà, impostare la proprietà `Name` su PriceQuartile e la proprietà `DataType` su `System.Int32`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>

<span data-ttu-id="a4f5e-146">[![impostare il nome e le proprietà del tipo di dati della nuova colonna](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span></span>

<span data-ttu-id="a4f5e-147">**Figura 2**: impostare la nuova colonna s `Name` e `DataType` proprietà ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image6.png))</span></span>

<span data-ttu-id="a4f5e-148">Come illustrato nella figura 2, sono disponibili proprietà aggiuntive che possono essere impostate, ad esempio se i valori nella colonna devono essere univoci, se la colonna è una colonna a incremento automatico, indipendentemente dal fatto che i valori `NULL` database siano consentiti e così via.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="a4f5e-149">Lasciare questi valori impostati sulle impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="a4f5e-150">Passaggio 2: creazione del metodo`GetProductsWithPriceQuartile`</span><span class="sxs-lookup"><span data-stu-id="a4f5e-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="a4f5e-151">Ora che il `ProductsDataTable` è stato aggiornato in modo da includere la colonna `PriceQuartile`, è possibile creare il metodo di `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a4f5e-152">Per iniziare, fare clic con il pulsante destro del mouse sul TableAdapter e scegliere Aggiungi query dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="a4f5e-153">Viene visualizzata la configurazione guidata query TableAdapter, che richiede prima di tutto se si desidera utilizzare istruzioni SQL ad hoc o una stored procedure nuova o esistente.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="a4f5e-154">Poiché non è ancora presente un stored procedure che restituisce i dati dei quartili del prezzo, consentire al TableAdapter di creare questo stored procedure per Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="a4f5e-155">Selezionare l'opzione Crea nuovo stored procedure e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-155">Select the Create new stored procedure option and click Next.</span></span>

<span data-ttu-id="a4f5e-156">[![indicare alla procedura guidata TableAdapter di creare la stored procedure per gli Stati Uniti](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span></span>

<span data-ttu-id="a4f5e-157">**Figura 3**: istruzioni per la creazione della stored procedure da parte della procedura guidata TableAdapter ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image9.png))</span></span>

<span data-ttu-id="a4f5e-158">Nella schermata successiva, illustrata nella figura 4, la procedura guidata richiede il tipo di query da aggiungere.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="a4f5e-159">Poiché il metodo `GetProductsWithPriceQuartile` restituirà tutte le colonne e i record della tabella `Products`, selezionare l'opzione SELECT that returns Rows e fare clic su Next.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>

<span data-ttu-id="a4f5e-160">[![la query sarà un'istruzione SELECT che restituisce più righe](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span></span>

<span data-ttu-id="a4f5e-161">**Figura 4**: la query sarà un'istruzione `SELECT` che restituisce più righe ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image12.png))</span></span>

<span data-ttu-id="a4f5e-162">Viene quindi richiesto di `SELECT` query.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="a4f5e-163">Immettere la query seguente nella procedura guidata:</span><span class="sxs-lookup"><span data-stu-id="a4f5e-163">Enter the following query into the wizard:</span></span>

[!code-sql[Main](adding-additional-datatable-columns-cs/samples/sample1.sql)]

<span data-ttu-id="a4f5e-164">La query precedente usa SQL Server 2005 s nuova [funzione`NTILE`](https://msdn.microsoft.com/library/ms175126.aspx) per dividere i risultati in quattro gruppi in cui i gruppi sono determinati dai valori di `UnitPrice` ordinati in ordine decrescente.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="a4f5e-165">Sfortunatamente, l'Generatore di query non sa come analizzare la parola chiave `OVER` e verrà visualizzato un errore durante l'analisi della query precedente.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="a4f5e-166">Quindi, immettere la query precedente direttamente nella casella di testo della procedura guidata senza usare il Generatore di query.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="a4f5e-167">Per ulteriori informazioni su NTILE e SQL Server 2005 s altre funzioni di rango, vedere [restituzione di risultati classificati con Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) e la [sezione funzioni di rango](https://msdn.microsoft.com/library/ms189798.aspx) dalla [documentazione online di SQL Server 2005](https://msdn.microsoft.com/library/ms189798.aspx).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>

<span data-ttu-id="a4f5e-168">Dopo aver immesso la query `SELECT` e aver fatto clic su Avanti, nella procedura guidata viene richiesto di specificare un nome per il stored procedure che verrà creato.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="a4f5e-169">Denominare il nuovo stored procedure `Products_SelectWithPriceQuartile` e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>

<span data-ttu-id="a4f5e-170">[![nome della stored procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span></span>

<span data-ttu-id="a4f5e-171">**Figura 5**: assegnare un nome alla stored procedure `Products_SelectWithPriceQuartile` ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image15.png))</span></span>

<span data-ttu-id="a4f5e-172">Infine, viene richiesto di assegnare un nome ai metodi TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="a4f5e-173">Lasciare selezionate le caselle di controllo Fill a DataTable e return a DataTable e assegnare un nome ai metodi `FillWithPriceQuartile` e `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>

<span data-ttu-id="a4f5e-174">[![assegnare un nome ai metodi TableAdapter e fare clic su fine](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span></span>

<span data-ttu-id="a4f5e-175">**Figura 6**: assegnare un nome ai metodi di TableAdapter e fare clic su Finish ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image18.png))</span></span>

<span data-ttu-id="a4f5e-176">Con la query `SELECT` specificata e i metodi stored procedure e TableAdapter denominati, fare clic su fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="a4f5e-177">A questo punto, è possibile che venga visualizzato un avviso o due dalla procedura guidata che informa che l'`OVER` costrutto o l'istruzione SQL non è supportata.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="a4f5e-178">Questi avvisi possono essere ignorati.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-178">These warnings can be ignored.</span></span>

<span data-ttu-id="a4f5e-179">Al termine della procedura guidata, il TableAdapter deve includere i metodi `FillWithPriceQuartile` e `GetProductsWithPriceQuartile` e il database deve includere un stored procedure denominato `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="a4f5e-180">È necessario verificare che il TableAdapter contenga effettivamente questo nuovo metodo e che il stored procedure sia stato aggiunto correttamente al database.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="a4f5e-181">Quando si esegue il controllo del database, se non viene visualizzato il stored procedure provare a fare clic con il pulsante destro del mouse sulla cartella stored procedure e scegliere Aggiorna.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>

![Verificare che sia stato aggiunto un nuovo metodo al TableAdapter](adding-additional-datatable-columns-cs/_static/image19.png)

<span data-ttu-id="a4f5e-183">**Figura 7**: verificare che sia stato aggiunto un nuovo metodo al TableAdapter</span><span class="sxs-lookup"><span data-stu-id="a4f5e-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>

<span data-ttu-id="a4f5e-184">[![verificare che il database contenga la stored procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span></span>

<span data-ttu-id="a4f5e-185">**Figura 8**: verificare che il database contenga la stored procedure `Products_SelectWithPriceQuartile` ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="a4f5e-186">Uno dei vantaggi dell'utilizzo di stored procedure anziché di istruzioni SQL ad hoc è che la riesecuzione della configurazione guidata TableAdapter non modificherà gli elenchi di colonne delle stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="a4f5e-187">Per verificarlo, fare clic con il pulsante destro del mouse sul TableAdapter, scegliere l'opzione Configura dal menu di scelta rapida per avviare la procedura guidata e quindi fare clic su fine per completare l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="a4f5e-188">Passare quindi al database e visualizzare il `Products_SelectWithPriceQuartile` stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="a4f5e-189">Si noti che il relativo elenco di colonne non è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="a4f5e-190">Se venivano utilizzate istruzioni SQL ad hoc, la nuova esecuzione della configurazione guidata TableAdapter avrebbe ripristinato l'elenco delle colonne della query in modo che corrisponda all'elenco di colonne di query principale, rimuovendo quindi l'istruzione NTILE dalla query utilizzata dal metodo `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>

<span data-ttu-id="a4f5e-191">Quando viene richiamato il metodo di accesso ai dati `GetProductsWithPriceQuartile`, il TableAdapter esegue il stored procedure di `Products_SelectWithPriceQuartile` e aggiunge una riga al `ProductsDataTable` per ogni record restituito.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="a4f5e-192">Viene eseguito il mapping dei campi dati restituiti dal stored procedure alle colonne `ProductsDataTable` s.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="a4f5e-193">Poiché è presente un `PriceQuartile` campo dati restituito dalla stored procedure, il relativo valore viene assegnato alla colonna `PriceQuartile` `ProductsDataTable` s.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="a4f5e-194">Per i metodi TableAdapter le cui query non restituiscono un campo dati `PriceQuartile`, il valore della colonna `PriceQuartile` è il valore specificato dalla relativa proprietà `DefaultValue`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="a4f5e-195">Come illustrato nella figura 2, questo valore è impostato su `DBNull`, il valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="a4f5e-196">Se si preferisce un valore predefinito diverso, è sufficiente impostare di conseguenza la proprietà `DefaultValue`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="a4f5e-197">È sufficiente assicurarsi che il valore `DefaultValue` sia valido in base alle `DataType` della colonna (ad esempio, `System.Int32` per la colonna `PriceQuartile`).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="a4f5e-198">A questo punto sono stati eseguiti i passaggi necessari per aggiungere una colonna aggiuntiva a una DataTable.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="a4f5e-199">Per verificare che la colonna aggiuntiva funzioni come previsto, è necessario creare una pagina ASP.NET che visualizzi il nome, il prezzo e il quartile del prezzo di ogni prodotto.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="a4f5e-200">Prima di procedere, tuttavia, è necessario prima aggiornare il livello della logica di business per includere un metodo che chiama il metodo DAL `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a4f5e-201">Il livello BLL verrà aggiornato successivamente, nel passaggio 3, quindi si creerà la pagina ASP.NET nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="a4f5e-202">Passaggio 3: incremento del livello della logica di business</span><span class="sxs-lookup"><span data-stu-id="a4f5e-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="a4f5e-203">Prima di usare il nuovo metodo `GetProductsWithPriceQuartile` dal livello di presentazione, è necessario innanzitutto aggiungere un metodo corrispondente a BLL.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="a4f5e-204">Aprire il file di classe `ProductsBLLWithSprocs` e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="a4f5e-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>

[!code-csharp[Main](adding-additional-datatable-columns-cs/samples/sample2.cs)]

<span data-ttu-id="a4f5e-205">Analogamente agli altri metodi di recupero dei dati in `ProductsBLLWithSprocs`, il metodo `GetProductsWithPriceQuartile` chiama semplicemente il metodo del `GetProductsWithPriceQuartile` corrispondente e ne restituisce i risultati.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="a4f5e-206">Passaggio 4: visualizzazione delle informazioni sui quartili del prezzo in una pagina Web di ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a4f5e-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="a4f5e-207">Con il completamento dell'aggiunta di BLL, è possibile creare una pagina ASP.NET che mostri il prezzo quartile per ogni prodotto.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="a4f5e-208">Aprire la pagina `AddingColumns.aspx` nella cartella `AdvancedDAL` e trascinare un controllo GridView dalla casella degli strumenti nella finestra di progettazione, impostando la relativa proprietà `ID` su `Products`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="a4f5e-209">Dallo smart tag GridView s, associarlo a un nuovo ObjectDataSource denominato `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="a4f5e-210">Configurare ObjectDataSource per l'uso del metodo `ProductsBLLWithSprocs` Class s `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a4f5e-211">Poiché si tratta di una griglia di sola lettura, impostare gli elenchi a discesa nelle schede UPDATE, INSERT e DELETE su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="a4f5e-212">[![configurare ObjectDataSource per l'utilizzo della classe ProductsBLLWithSprocs](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span></span>

<span data-ttu-id="a4f5e-213">**Figura 9**: configurare ObjectDataSource per l'uso della classe `ProductsBLLWithSprocs` ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image25.png))</span></span>

<span data-ttu-id="a4f5e-214">[![recuperare informazioni sul prodotto dal metodo GetProductsWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span></span>

<span data-ttu-id="a4f5e-215">**Figura 10**: recuperare informazioni sul prodotto dal metodo `GetProductsWithPriceQuartile` ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image28.png))</span></span>

<span data-ttu-id="a4f5e-216">Dopo aver completato la configurazione guidata origine dati, in Visual Studio verrà automaticamente aggiunto un BoundField o CheckBoxField a GridView per ognuno dei campi dati restituiti dal metodo.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="a4f5e-217">Uno di questi campi dati è `PriceQuartile`, ovvero la colonna aggiunta al `ProductsDataTable` nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="a4f5e-218">Modificare i campi di GridView, rimuovendo tutti i BoundField tranne i `ProductName`, `UnitPrice`e `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="a4f5e-219">Configurare il BoundField `UnitPrice` per formattare il valore come valuta e avere rispettivamente i BoundField `UnitPrice` e `PriceQuartile` a destra e allineati al centro.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="a4f5e-220">Aggiornare infine i BoundField rimanenti `HeaderText` proprietà rispettivamente a Product, Price e Price quartil.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="a4f5e-221">Inoltre, selezionare la casella di controllo Abilita ordinamento dallo smart tag di GridView.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="a4f5e-222">Dopo queste modifiche, il markup dichiarativo GridView e ObjectDataSource dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="a4f5e-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-additional-datatable-columns-cs/samples/sample3.aspx)]

<span data-ttu-id="a4f5e-223">La figura 11 Mostra questa pagina quando viene visitata attraverso un browser.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="a4f5e-224">Si noti che, inizialmente, i prodotti sono ordinati in base al prezzo in ordine decrescente, a ogni prodotto viene assegnato un valore `PriceQuartile` appropriato.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="a4f5e-225">Naturalmente questi dati possono essere ordinati in base ad altri criteri con il valore di colonna price quartil che riflette ancora la classificazione dei prodotti rispetto al prezzo (vedere la figura 12).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>

<span data-ttu-id="a4f5e-226">[![i prodotti sono ordinati in base ai prezzi](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span></span>

<span data-ttu-id="a4f5e-227">**Figura 11**: i prodotti sono ordinati in base ai prezzi ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image31.png))</span></span>

<span data-ttu-id="a4f5e-228">[![i prodotti sono ordinati in base ai rispettivi nomi](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span></span>

<span data-ttu-id="a4f5e-229">**Figura 12**: i prodotti sono ordinati in base ai rispettivi nomi ([fare clic per visualizzare l'immagine con dimensioni complete](adding-additional-datatable-columns-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="a4f5e-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image34.png))</span></span>

> [!NOTE]
> <span data-ttu-id="a4f5e-230">Con poche righe di codice è possibile aumentare il controllo GridView in modo che abbia colorato le righe del prodotto in base al valore `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="a4f5e-231">Potremmo colorare questi prodotti nel primo quartile un verde chiaro, quelli nel secondo quartile un giallo chiaro e così via.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="a4f5e-232">Si consiglia di richiedere qualche istante per aggiungere questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="a4f5e-233">Se è necessario un aggiornamento per la formattazione di GridView, vedere l'esercitazione [sulla formattazione personalizzata basata sui dati](../custom-formatting/custom-formatting-based-upon-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="a4f5e-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>

## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="a4f5e-234">Un approccio alternativo-creazione di un altro TableAdapter</span><span class="sxs-lookup"><span data-stu-id="a4f5e-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="a4f5e-235">Come illustrato in questa esercitazione, quando si aggiunge un metodo a un TableAdapter che restituisce campi dati diversi da quelli digitati dalla query principale, è possibile aggiungere colonne corrispondenti alla DataTable.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="a4f5e-236">Questo approccio, tuttavia, funziona correttamente solo se è presente un numero ridotto di metodi nell'oggetto TableAdapter che restituiscono campi dati diversi e se i campi dati alternativi non variano troppo dalla query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="a4f5e-237">Anziché aggiungere colonne alla DataTable, è possibile aggiungere un altro TableAdapter al set di dati che contiene i metodi del primo TableAdapter che restituiscono campi dati diversi.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="a4f5e-238">Per questa esercitazione, anziché aggiungere la colonna `PriceQuartile` al `ProductsDataTable` (dove viene usata solo dal metodo di `GetProductsWithPriceQuartile`), è possibile che sia stato aggiunto un TableAdapter aggiuntivo al set di dati denominato `ProductsWithPriceQuartileTableAdapter` che usava `Products_SelectWithPriceQuartile` stored procedure come query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="a4f5e-239">Le pagine ASP.NET per le quali è necessario ottenere informazioni sui prodotti con il prezzo quartile utilizzeranno il `ProductsWithPriceQuartileTableAdapter`, mentre quelle che non potevano continuare a usare il `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="a4f5e-240">Con l'aggiunta di un nuovo TableAdapter, le DataTable rimangono inalterate e le rispettive colonne riflettono esattamente i campi dati restituiti dai relativi metodi TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="a4f5e-241">Tuttavia, gli oggetti TableAdapter aggiuntivi possono introdurre attività e funzionalità ripetitive.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="a4f5e-242">Se, ad esempio, le pagine di ASP.NET che hanno visualizzato la colonna `PriceQuartile` necessario fornire il supporto per l'inserimento, l'aggiornamento e l'eliminazione, è necessario che le proprietà `InsertCommand`, `UpdateCommand`e `DeleteCommand` del `ProductsWithPriceQuartileTableAdapter` siano configurate correttamente.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="a4f5e-243">Sebbene queste proprietà rispecchino il `ProductsTableAdapter` s, questa configurazione introduce un passaggio aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="a4f5e-244">Sono inoltre disponibili due modi per aggiornare, eliminare o aggiungere un prodotto al database, tramite le classi `ProductsTableAdapter` e `ProductsWithPriceQuartileTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="a4f5e-245">Il download di questa esercitazione include una classe `ProductsWithPriceQuartileTableAdapter` nel set di dati `NorthwindWithSprocs` che illustra questo approccio alternativo.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="a4f5e-246">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="a4f5e-246">Summary</span></span>

<span data-ttu-id="a4f5e-247">Nella maggior parte degli scenari, tutti i metodi in un oggetto TableAdapter restituiranno lo stesso set di campi dati, ma in alcuni casi è possibile che un metodo o due metodi particolari debbano restituire un campo aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="a4f5e-248">Ad esempio, nel [master/dettagli utilizzando un elenco puntato di record master con un'esercitazione DataList dettagli](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) è stato aggiunto un metodo al `CategoriesTableAdapter` che, oltre ai campi dati della query principale, ha restituito un `NumberOfProducts` campo che riporta il numero di prodotti associati a ogni categoria.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="a4f5e-249">In questa esercitazione è stato esaminato l'aggiunta di un metodo nella `ProductsTableAdapter` che ha restituito un campo di `PriceQuartile` oltre ai campi dati della query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="a4f5e-250">Per acquisire campi dati aggiuntivi restituiti dai metodi TableAdapter è necessario aggiungere le colonne corrispondenti alla DataTable.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="a4f5e-251">Se si prevede di aggiungere manualmente colonne alla DataTable, è consigliabile usare le stored procedure per il TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="a4f5e-252">Se il TableAdapter usa istruzioni SQL ad hoc, ogni volta che viene eseguita la configurazione guidata TableAdapter, tutti gli elenchi di campi dei dati dei metodi ripristinano i campi dati restituiti dalla query principale.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="a4f5e-253">Questo problema non si estende alle stored procedure, motivo per cui sono consigliate e sono state usate in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="a4f5e-254">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="a4f5e-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a4f5e-255">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="a4f5e-255">About the Author</span></span>

<span data-ttu-id="a4f5e-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette ASP/ASP. NET Books e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a4f5e-257">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a4f5e-258">Il suo ultimo libro è [*Sams Teach Yourself ASP.NET 2,0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a4f5e-259">Può essere raggiunto in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a4f5e-260">o tramite il suo Blog, disponibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a4f5e-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a4f5e-261">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="a4f5e-261">Special Thanks To</span></span>

<span data-ttu-id="a4f5e-262">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a4f5e-263">I revisori del lead per questa esercitazione erano Randy Schmidt, Jacky Goor, Bernadette Leigh e Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="a4f5e-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="a4f5e-264">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="a4f5e-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a4f5e-265">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a4f5e-266">[Precedente](updating-the-tableadapter-to-use-joins-cs.md)
> [Successivo](working-with-computed-columns-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a4f5e-266">[Previous](updating-the-tableadapter-to-use-joins-cs.md)
[Next](working-with-computed-columns-cs.md)</span></span>
