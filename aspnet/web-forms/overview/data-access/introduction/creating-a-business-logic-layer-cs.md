---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Creazione di un livello di logicaC#di business () | Microsoft Docs
author: rick-anderson
description: In questa esercitazione verrà illustrato come centralizzare le regole business in un livello di logica di business (BLL) che funge da intermediario per lo scambio di dati tra t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: df96f3e7422a0537bf1b003a33fe8d71a671ac33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78605623"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="95cb5-103">Creazione di un livello per la logica di business (C#)</span><span class="sxs-lookup"><span data-stu-id="95cb5-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="95cb5-104">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="95cb5-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="95cb5-105">[Scaricare l'app di esempio](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) o [scaricare il file PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="95cb5-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="95cb5-106">In questa esercitazione verrà illustrato come centralizzare le regole business in un livello di logica di business (BLL) che funge da intermediario per lo scambio di dati tra il livello di presentazione e il DAL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>

## <a name="introduction"></a><span data-ttu-id="95cb5-107">Introduzione</span><span class="sxs-lookup"><span data-stu-id="95cb5-107">Introduction</span></span>

<span data-ttu-id="95cb5-108">Il livello di accesso ai dati creato nella [prima esercitazione](creating-a-data-access-layer-cs.md) separa in modo semplice la logica di accesso ai dati dalla logica di presentazione.</span><span class="sxs-lookup"><span data-stu-id="95cb5-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="95cb5-109">Tuttavia, mentre il DAL separa nettamente i dettagli di accesso ai dati dal livello di presentazione, non impone alcuna regola di business applicabile.</span><span class="sxs-lookup"><span data-stu-id="95cb5-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="95cb5-110">Per l'applicazione, ad esempio, è possibile che si desideri impedire la modifica dei campi `CategoryID` o `SupplierID` della tabella `Products` quando il campo `Discontinued` è impostato su 1, oppure è possibile che si desideri applicare regole di anzianità, in modo da impedire situazioni in cui un dipendente viene gestito da un utente che è stato assunto successivamente.</span><span class="sxs-lookup"><span data-stu-id="95cb5-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="95cb5-111">Un altro scenario comune è l'autorizzazione, probabilmente solo gli utenti in un particolare ruolo possono eliminare i prodotti o modificare il valore `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="95cb5-112">In questa esercitazione verrà illustrato come centralizzare queste regole business in un livello di logica di business (BLL) che funge da intermediario per lo scambio di dati tra il livello di presentazione e il DAL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="95cb5-113">In un'applicazione reale, il BLL deve essere implementato come un progetto di libreria di classi separato. Tuttavia, per queste esercitazioni verrà implementato il BLL come una serie di classi nella cartella `App_Code` al fine di semplificare la struttura del progetto.</span><span class="sxs-lookup"><span data-stu-id="95cb5-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="95cb5-114">Nella figura 1 sono illustrate le relazioni architetturali tra il livello di presentazione, BLL e DAL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>

![Il BLL separa il livello di presentazione dal livello di accesso ai dati e impone le regole business](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="95cb5-116">**Figura 1**: il BLL separa il livello di presentazione dal livello di accesso ai dati e impone le regole business</span><span class="sxs-lookup"><span data-stu-id="95cb5-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="95cb5-117">Passaggio 1: creazione delle classi BLL</span><span class="sxs-lookup"><span data-stu-id="95cb5-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="95cb5-118">Il livello BLL sarà costituito da quattro classi, una per ogni TableAdapter in DAL; ognuna di queste classi BLL avrà metodi per il recupero, l'inserimento, l'aggiornamento e l'eliminazione dal rispettivo TableAdapter nel DAL, applicando le regole business appropriate.</span><span class="sxs-lookup"><span data-stu-id="95cb5-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="95cb5-119">Per separare in modo più semplice le classi correlate a e BLL, è possibile creare due sottocartelle nella cartella `App_Code`, `DAL` e `BLL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="95cb5-120">È sufficiente fare clic con il pulsante destro del mouse sulla cartella `App_Code` nel Esplora soluzioni e scegliere nuova cartella.</span><span class="sxs-lookup"><span data-stu-id="95cb5-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="95cb5-121">Dopo aver creato queste due cartelle, spostare il set di dati tipizzato creato nella prima esercitazione nella sottocartella `DAL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="95cb5-122">Successivamente, creare i quattro file di classe BLL nella sottocartella `BLL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="95cb5-123">A tale scopo, fare clic con il pulsante destro del mouse sulla sottocartella `BLL`, scegliere Aggiungi un nuovo elemento e scegliere il modello di classe.</span><span class="sxs-lookup"><span data-stu-id="95cb5-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="95cb5-124">Denominare le quattro classi `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`e `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>

![Aggiungere quattro nuove classi alla cartella App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="95cb5-126">**Figura 2**: aggiungere quattro nuove classi alla cartella `App_Code`</span><span class="sxs-lookup"><span data-stu-id="95cb5-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>

<span data-ttu-id="95cb5-127">Successivamente, aggiungere i metodi a ognuna delle classi per eseguire semplicemente il wrapping dei metodi definiti per gli oggetti TableAdapter dalla prima esercitazione.</span><span class="sxs-lookup"><span data-stu-id="95cb5-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="95cb5-128">Per il momento, questi metodi chiameranno semplicemente direttamente nel DAL; in seguito verrà restituito per aggiungere la logica di business necessaria.</span><span class="sxs-lookup"><span data-stu-id="95cb5-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="95cb5-129">Se si utilizza Visual Studio Standard Edition o versione successiva (ovvero *non* si utilizza Visual Web Developer), è possibile progettare le classi visivamente utilizzando la [Progettazione classi](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="95cb5-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="95cb5-130">Per ulteriori informazioni su questa nuova funzionalità di Visual Studio, fare riferimento al [Blog Progettazione classi](https://blogs.msdn.com/classdesigner/default.aspx) .</span><span class="sxs-lookup"><span data-stu-id="95cb5-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>

<span data-ttu-id="95cb5-131">Per la classe `ProductsBLL` è necessario aggiungere un totale di sette metodi:</span><span class="sxs-lookup"><span data-stu-id="95cb5-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="95cb5-132">`GetProducts()` restituisce tutti i prodotti</span><span class="sxs-lookup"><span data-stu-id="95cb5-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="95cb5-133">`GetProductByProductID(productID)` restituisce il prodotto con l'ID prodotto specificato</span><span class="sxs-lookup"><span data-stu-id="95cb5-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="95cb5-134">`GetProductsByCategoryID(categoryID)` restituisce tutti i prodotti della categoria specificata</span><span class="sxs-lookup"><span data-stu-id="95cb5-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="95cb5-135">`GetProductsBySupplier(supplierID)` restituisce tutti i prodotti dal fornitore specificato</span><span class="sxs-lookup"><span data-stu-id="95cb5-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="95cb5-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserisce un nuovo prodotto nel database utilizzando i valori passati. Restituisce il valore `ProductID` del record appena inserito</span><span class="sxs-lookup"><span data-stu-id="95cb5-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="95cb5-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` aggiorna un prodotto esistente nel database utilizzando i valori passati; Restituisce `true` se è stata aggiornata esattamente una riga, `false` in caso contrario</span><span class="sxs-lookup"><span data-stu-id="95cb5-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="95cb5-138">`DeleteProduct(productID)` Elimina il prodotto specificato dal database</span><span class="sxs-lookup"><span data-stu-id="95cb5-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="95cb5-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="95cb5-139">ProductsBLL.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="95cb5-140">I metodi che restituiscono semplicemente i dati `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`e `GetProductBySuppliersID` sono piuttosto semplici perché chiamano semplicemente il DAL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="95cb5-141">In alcuni scenari possono essere presenti regole di business che devono essere implementate a questo livello, ad esempio le regole di autorizzazione basate sull'utente attualmente connesso o il ruolo a cui appartiene l'utente, lasciando semplicemente questi metodi così come sono.</span><span class="sxs-lookup"><span data-stu-id="95cb5-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="95cb5-142">Per questi metodi, il servizio BLL funge semplicemente da proxy tramite il quale il livello di presentazione accede ai dati sottostanti dal livello di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="95cb5-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="95cb5-143">I metodi `AddProduct` e `UpdateProduct` accettano entrambi come parametri i valori per i vari campi del prodotto e aggiungono un nuovo prodotto o ne aggiornano uno esistente, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="95cb5-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="95cb5-144">Poiché molte delle colonne della tabella `Product` possono accettare valori di `NULL` (`CategoryID`, `SupplierID`e `UnitPrice`, per citarne alcuni), i parametri di input per `AddProduct` e `UpdateProduct` che vengono mappati a tali colonne utilizzano i [tipi nullable](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="95cb5-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="95cb5-145">I tipi nullable sono una novità di .NET 2,0 e forniscono una tecnica per indicare se un tipo di valore deve essere invece `null`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="95cb5-146">In C# è possibile contrassegnare un tipo di valore come tipo nullable aggiungendo `?` dopo il tipo, ad esempio `int? x;`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="95cb5-147">Per ulteriori informazioni, vedere la sezione [tipi nullable](https://msdn.microsoft.com/library/1t3y8s4s.aspx) nella [ C# Guida alla programmazione](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="95cb5-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="95cb5-148">Tutti e tre i metodi restituiscono un valore booleano che indica se una riga è stata inserita, aggiornata o eliminata perché l'operazione potrebbe non comportare una riga interessata.</span><span class="sxs-lookup"><span data-stu-id="95cb5-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="95cb5-149">Se, ad esempio, lo sviluppatore della pagina chiama `DeleteProduct` passando una `ProductID` per un prodotto inesistente, l'istruzione `DELETE` rilasciata nel database non avrà alcun effetto e pertanto il metodo `DeleteProduct` restituirà `false`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="95cb5-150">Si noti che quando si aggiunge un nuovo prodotto o se ne aggiorna uno esistente, i valori dei campi del prodotto nuovi o modificati vengono considerati come un elenco di scalari, invece di accettare un'istanza di `ProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="95cb5-151">Questo approccio è stato scelto perché la classe `ProductsRow` deriva dalla classe `DataRow` ADO.NET, che non ha un costruttore senza parametri predefinito.</span><span class="sxs-lookup"><span data-stu-id="95cb5-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="95cb5-152">Per creare una nuova istanza di `ProductsRow`, è innanzitutto necessario creare un'istanza di `ProductsDataTable` e quindi richiamare il relativo metodo `NewProductRow()` (operazione eseguita in `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="95cb5-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="95cb5-153">Questa lacuna si verifica quando si attiva l'inserimento e l'aggiornamento dei prodotti tramite ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="95cb5-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="95cb5-154">In breve, ObjectDataSource tenterà di creare un'istanza dei parametri di input.</span><span class="sxs-lookup"><span data-stu-id="95cb5-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="95cb5-155">Se il metodo BLL prevede un'istanza di `ProductsRow`, ObjectDataSource tenterà di crearne uno, ma avrà esito negativo a causa della mancanza di un costruttore senza parametri predefinito.</span><span class="sxs-lookup"><span data-stu-id="95cb5-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="95cb5-156">Per altre informazioni su questo problema, fare riferimento ai due post dei forum ASP.NET seguenti: [aggiornamento di ObjectDataSource con set di dati fortemente tipizzati](https://forums.asp.net/1098630/ShowPost.aspx)e [problema con ObjectDataSource e DataSet fortemente tipizzati](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="95cb5-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="95cb5-157">Successivamente, sia in `AddProduct` che in `UpdateProduct`, il codice crea un'istanza di `ProductsRow` e la popola con i valori appena passati.</span><span class="sxs-lookup"><span data-stu-id="95cb5-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="95cb5-158">Quando si assegnano valori a DataColumns di un DataRow, possono verificarsi diversi controlli di convalida a livello di campo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="95cb5-159">Pertanto, inserendo manualmente i valori passati in un DataRow, è possibile garantire la validità dei dati passati al metodo BLL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="95cb5-160">Sfortunatamente, le classi DataRow fortemente tipizzate generate da Visual Studio non utilizzano i tipi nullable.</span><span class="sxs-lookup"><span data-stu-id="95cb5-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="95cb5-161">Per indicare che una particolare DataColumn in un DataRow deve corrispondere a un valore di database `NULL` è necessario usare il metodo `SetColumnNameNull()`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="95cb5-162">In `UpdateProduct` è stato caricato per la prima volta nel prodotto per l'aggiornamento usando `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="95cb5-163">Sebbene possa sembrare un viaggio non necessario per il database, questo viaggio supplementare risulterà utile nelle esercitazioni future che esplorano la concorrenza ottimistica.</span><span class="sxs-lookup"><span data-stu-id="95cb5-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="95cb5-164">La concorrenza ottimistica è una tecnica per garantire che due utenti che lavorano contemporaneamente sugli stessi dati non sovrascrivano accidentalmente le modifiche di un altro.</span><span class="sxs-lookup"><span data-stu-id="95cb5-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="95cb5-165">L'acquisizione dell'intero record rende più semplice la creazione di metodi di aggiornamento nell'oggetto BLL che modificano solo un subset delle colonne del DataRow.</span><span class="sxs-lookup"><span data-stu-id="95cb5-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="95cb5-166">Quando si Esplora la classe `SuppliersBLL` verrà visualizzato un esempio di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="95cb5-167">Si noti infine che alla classe `ProductsBLL` a cui è applicato l' [attributo DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) (la sintassi del `[System.ComponentModel.DataObject]` immediatamente prima dell'istruzione di classe nella parte superiore del file) e che i metodi hanno [attributi DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="95cb5-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="95cb5-168">L'attributo `DataObject` contrassegna la classe come un oggetto adatto per l'associazione a un [controllo ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), mentre l'`DataObjectMethodAttribute` indica lo scopo del metodo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="95cb5-169">Come si vedrà nelle esercitazioni future, ObjectDataSource di ASP.NET 2.0 semplifica l'accesso dichiarativo ai dati da una classe.</span><span class="sxs-lookup"><span data-stu-id="95cb5-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="95cb5-170">Per filtrare l'elenco delle classi possibili a cui eseguire l'associazione nella procedura guidata di ObjectDataSource, per impostazione predefinita solo le classi contrassegnate come `DataObjects` vengono visualizzate nell'elenco a discesa della procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="95cb5-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="95cb5-171">La classe `ProductsBLL` funzionerà anche senza questi attributi, ma l'aggiunta renderà più semplice l'uso della procedura guidata di ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="95cb5-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="95cb5-172">Aggiunta di altre classi</span><span class="sxs-lookup"><span data-stu-id="95cb5-172">Adding the Other Classes</span></span>

<span data-ttu-id="95cb5-173">Con la classe `ProductsBLL` completa, è ancora necessario aggiungere le classi per l'utilizzo di categorie, fornitori e dipendenti.</span><span class="sxs-lookup"><span data-stu-id="95cb5-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="95cb5-174">Creare le classi e i metodi seguenti usando i concetti dell'esempio precedente:</span><span class="sxs-lookup"><span data-stu-id="95cb5-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="95cb5-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="95cb5-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="95cb5-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="95cb5-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="95cb5-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="95cb5-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="95cb5-178">Il metodo che vale la pena notare è il metodo `UpdateSupplierAddress` della classe `SuppliersBLL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="95cb5-179">Questo metodo fornisce un'interfaccia per aggiornare solo le informazioni sull'indirizzo del fornitore.</span><span class="sxs-lookup"><span data-stu-id="95cb5-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="95cb5-180">Internamente, questo metodo legge nell'oggetto `SupplierDataRow` per il `supplierID` specificato (usando `GetSupplierBySupplierID`), imposta le proprietà relative all'indirizzo, quindi chiama il metodo `Update` del `SupplierDataTable`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="95cb5-181">Il metodo `UpdateSupplierAddress` segue:</span><span class="sxs-lookup"><span data-stu-id="95cb5-181">The `UpdateSupplierAddress` method follows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="95cb5-182">Per un'implementazione completa delle classi BLL, vedere il download di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="95cb5-183">Passaggio 2: accesso ai DataSet tipizzati tramite le classi BLL</span><span class="sxs-lookup"><span data-stu-id="95cb5-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="95cb5-184">Nella prima esercitazione sono stati presentati esempi di utilizzo diretto del set di dati tipizzato a livello di codice, ma con l'aggiunta delle classi BLL, il livello di presentazione dovrebbe funzionare invece con BLL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="95cb5-185">Nell'esempio `AllProducts.aspx` della prima esercitazione, è stato usato il `ProductsTableAdapter` per associare l'elenco di prodotti a un GridView, come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="95cb5-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="95cb5-186">Per utilizzare le nuove classi BLL, è sufficiente sostituire la prima riga di codice con l'oggetto `ProductsTableAdapter` con un oggetto `ProductBLL`:</span><span class="sxs-lookup"><span data-stu-id="95cb5-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="95cb5-187">È inoltre possibile accedere alle classi BLL in modo dichiarativo, come nel set di dati tipizzato, utilizzando ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="95cb5-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="95cb5-188">Il ObjectDataSource verrà discusso più dettagliatamente nelle esercitazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="95cb5-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>

<span data-ttu-id="95cb5-189">[![l'elenco dei prodotti viene visualizzato in un controllo GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="95cb5-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="95cb5-190">**Figura 3**: l'elenco dei prodotti viene visualizzato in un GridView ([fare clic per visualizzare l'immagine con dimensioni complete](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="95cb5-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>

## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="95cb5-191">Passaggio 3: aggiunta della convalida a livello di campo alle classi DataRow</span><span class="sxs-lookup"><span data-stu-id="95cb5-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="95cb5-192">La convalida a livello di campo sono controlli relativi ai valori delle proprietà degli oggetti business durante l'inserimento o l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="95cb5-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="95cb5-193">Alcune regole di convalida a livello di campo per i prodotti includono:</span><span class="sxs-lookup"><span data-stu-id="95cb5-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="95cb5-194">Il campo `ProductName` deve avere una lunghezza compresa tra 40 caratteri</span><span class="sxs-lookup"><span data-stu-id="95cb5-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="95cb5-195">Il campo `QuantityPerUnit` deve avere una lunghezza di 20 caratteri o minore</span><span class="sxs-lookup"><span data-stu-id="95cb5-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="95cb5-196">I campi `ProductID`, `ProductName`e `Discontinued` sono obbligatori, ma tutti gli altri campi sono facoltativi</span><span class="sxs-lookup"><span data-stu-id="95cb5-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="95cb5-197">I campi `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`e `ReorderLevel` devono essere maggiori o uguali a zero</span><span class="sxs-lookup"><span data-stu-id="95cb5-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="95cb5-198">Queste regole possono e devono essere espresse a livello di database.</span><span class="sxs-lookup"><span data-stu-id="95cb5-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="95cb5-199">Il limite di caratteri per i campi `ProductName` e `QuantityPerUnit` vengono acquisiti dai tipi di dati di tali colonne nella tabella `Products` (rispettivamente`nvarchar(40)` e `nvarchar(20)`).</span><span class="sxs-lookup"><span data-stu-id="95cb5-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="95cb5-200">Se i campi sono obbligatori e facoltativi sono espressi da se la colonna della tabella del database consente `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="95cb5-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="95cb5-201">Esistono quattro [vincoli check](https://msdn.microsoft.com/library/ms188258.aspx) che assicurano che solo i valori maggiori o uguali a zero possano essere inseriti nelle colonne `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`o `ReorderLevel`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="95cb5-202">Oltre ad applicare queste regole nel database, è necessario applicarle anche a livello di set di dati.</span><span class="sxs-lookup"><span data-stu-id="95cb5-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="95cb5-203">Infatti, la lunghezza del campo e il fatto che un valore sia obbligatorio o facoltativo siano già acquisiti per ogni set di colonne DataColumn di DataTable.</span><span class="sxs-lookup"><span data-stu-id="95cb5-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="95cb5-204">Per visualizzare automaticamente la convalida a livello di campo esistente, passare a Progettazione DataSet, selezionare un campo da una delle tabelle dati e quindi passare alla Finestra Proprietà.</span><span class="sxs-lookup"><span data-stu-id="95cb5-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="95cb5-205">Come illustrato nella figura 4, il `QuantityPerUnit` DataColumn nella `ProductsDataTable` ha una lunghezza massima di 20 caratteri e consente valori di `NULL`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="95cb5-206">Se si tenta di impostare la proprietà `QuantityPerUnit` di `ProductsDataRow`su un valore stringa più lungo di 20 caratteri, verrà generata un'`ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>

<span data-ttu-id="95cb5-207">[![DataColumn fornisce la convalida di base a livello di campo](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="95cb5-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="95cb5-208">**Figura 4**: l'oggetto DataColumn fornisce la convalida di base a livello di campo ([fare clic per visualizzare l'immagine con dimensioni complete](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="95cb5-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>

<span data-ttu-id="95cb5-209">Sfortunatamente, non è possibile specificare i controlli dei limiti, ad esempio il valore di `UnitPrice` deve essere maggiore o uguale a zero, tramite l'Finestra Proprietà.</span><span class="sxs-lookup"><span data-stu-id="95cb5-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="95cb5-210">Per fornire questo tipo di convalida a livello di campo, è necessario creare un gestore eventi per l'evento [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) di DataTable.</span><span class="sxs-lookup"><span data-stu-id="95cb5-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="95cb5-211">Come indicato nell' [esercitazione precedente](creating-a-data-access-layer-cs.md), è possibile estendere il set di dati, le DataTable e gli oggetti DataRow creati dal DataSet tipizzato tramite l'utilizzo di classi parziali.</span><span class="sxs-lookup"><span data-stu-id="95cb5-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="95cb5-212">Utilizzando questa tecnica è possibile creare un gestore dell'evento `ColumnChanging` per la classe `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="95cb5-213">Iniziare creando una classe nella cartella `App_Code` denominata `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>

<span data-ttu-id="95cb5-214">[![aggiungere una nuova classe alla cartella App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="95cb5-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="95cb5-215">**Figura 5**: aggiungere una nuova classe alla cartella `App_Code` ([fare clic per visualizzare l'immagine con dimensioni complete](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="95cb5-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>

<span data-ttu-id="95cb5-216">Successivamente, creare un gestore eventi per l'evento `ColumnChanging` che garantisce che i valori della colonna `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`e `ReorderLevel` (se non `NULL`) siano maggiori o uguali a zero.</span><span class="sxs-lookup"><span data-stu-id="95cb5-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="95cb5-217">Se una colonna di questo tipo non è compresa nell'intervallo, generare un `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="95cb5-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="95cb5-218">ProductsDataTable.ColumnChanging.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="95cb5-219">Passaggio 4: aggiunta di regole business personalizzate alle classi di BLL</span><span class="sxs-lookup"><span data-stu-id="95cb5-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="95cb5-220">Oltre alla convalida a livello di campo, è possibile che siano presenti regole business personalizzate di alto livello che coinvolgono entità o concetti diversi, non esprimibile a livello di singola colonna, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="95cb5-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="95cb5-221">Se un prodotto non è più disponibile, non è possibile aggiornare la relativa `UnitPrice`</span><span class="sxs-lookup"><span data-stu-id="95cb5-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="95cb5-222">Il paese di residenza di un dipendente deve essere lo stesso del paese di residenza del responsabile</span><span class="sxs-lookup"><span data-stu-id="95cb5-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="95cb5-223">Un prodotto non può essere sospeso se è l'unico prodotto fornito dal fornitore</span><span class="sxs-lookup"><span data-stu-id="95cb5-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="95cb5-224">Le classi BLL devono contenere controlli per garantire la conformità alle regole di business dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="95cb5-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="95cb5-225">Questi controlli possono essere aggiunti direttamente ai metodi a cui si applicano.</span><span class="sxs-lookup"><span data-stu-id="95cb5-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="95cb5-226">Si supponga che le regole business stabiliscano che un prodotto non è stato contrassegnato come non più disponibile se fosse l'unico prodotto di un dato fornitore.</span><span class="sxs-lookup"><span data-stu-id="95cb5-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="95cb5-227">Ovvero, se il prodotto *x* fosse l'unico prodotto acquistato dal fornitore *Y*, non è stato possibile contrassegnare *x* come non più disponibile; Se, tuttavia, Supplier *Y* ci ha fornito tre prodotti, *A*, *B*e *C*, potremmo contrassegnare uno qualsiasi di questi e tutti gli altri come sospesi.</span><span class="sxs-lookup"><span data-stu-id="95cb5-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="95cb5-228">Una regola business dispari, ma le regole di business e il senso comune non sono sempre allineati.</span><span class="sxs-lookup"><span data-stu-id="95cb5-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="95cb5-229">Per applicare questa regola di business nel metodo `UpdateProducts` si inizia controllando se `Discontinued` è stato impostato su `true` e, in tal caso, chiamare `GetProductsBySupplierID` per determinare il numero di prodotti acquistati dal fornitore del prodotto.</span><span class="sxs-lookup"><span data-stu-id="95cb5-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="95cb5-230">Se da questo fornitore viene acquistato un solo prodotto, viene generata un'`ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="95cb5-231">Risposta agli errori di convalida nel livello presentazione</span><span class="sxs-lookup"><span data-stu-id="95cb5-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="95cb5-232">Quando si chiama il BLL dal livello di presentazione, è possibile decidere se provare a gestire le eccezioni che potrebbero essere generate o lasciarle propagate a ASP.NET (che genererà l'evento `Error` del `HttpApplication`).</span><span class="sxs-lookup"><span data-stu-id="95cb5-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="95cb5-233">Per gestire un'eccezione quando si utilizza BLL a livello di codice, è possibile utilizzare un'operazione [try... blocco catch](https://msdn.microsoft.com/library/0yd65esw.aspx) , come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="95cb5-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="95cb5-234">Come si vedrà nelle esercitazioni future, la gestione delle eccezioni che si propagano da BLL quando si usa un controllo Web dati per l'inserimento, l'aggiornamento o l'eliminazione dei dati può essere gestita direttamente in un gestore eventi anziché eseguire il wrapping del codice in blocchi `try...catch`.</span><span class="sxs-lookup"><span data-stu-id="95cb5-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="95cb5-235">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="95cb5-235">Summary</span></span>

<span data-ttu-id="95cb5-236">Un'applicazione ben progettata viene creata in livelli distinti, ognuno dei quali incapsula un particolare ruolo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="95cb5-237">Nella prima esercitazione di questa serie di articoli è stato creato un livello di accesso ai dati con DataSet tipizzati; in questa esercitazione è stato creato un livello di logica di business come una serie di classi nella cartella di `App_Code` dell'applicazione che chiamano DAL.</span><span class="sxs-lookup"><span data-stu-id="95cb5-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="95cb5-238">Il BLL implementa la logica a livello di campo e di business per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="95cb5-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="95cb5-239">Oltre a creare un BLL separato, come è stato fatto in questa esercitazione, un'altra opzione consiste nell'estendere i metodi degli oggetti TableAdapter attraverso l'uso di classi parziali.</span><span class="sxs-lookup"><span data-stu-id="95cb5-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="95cb5-240">Tuttavia, l'uso di questa tecnica non consente di eseguire l'override dei metodi esistenti né di separare il DAL e il nostro BLL come l'approccio adottato in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="95cb5-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="95cb5-241">Con il completamento di DAL e BLL, è possibile iniziare con il livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="95cb5-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="95cb5-242">Nell' [esercitazione successiva](master-pages-and-site-navigation-cs.md) verrà illustrata una breve deviazione dagli argomenti relativi all'accesso ai dati e verrà definito un layout di pagina coerente per l'uso in tutte le esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="95cb5-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="95cb5-243">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="95cb5-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="95cb5-244">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="95cb5-244">About the Author</span></span>

<span data-ttu-id="95cb5-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette ASP/ASP. NET Books e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="95cb5-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="95cb5-246">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="95cb5-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="95cb5-247">Il suo ultimo libro è [*Sams Teach Yourself ASP.NET 2,0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="95cb5-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="95cb5-248">Può essere raggiunto in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="95cb5-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="95cb5-249">o tramite il suo Blog, disponibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="95cb5-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="95cb5-250">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="95cb5-250">Special Thanks To</span></span>

<span data-ttu-id="95cb5-251">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="95cb5-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="95cb5-252">I revisori del lead per questa esercitazione erano Liz Shulok, Dennis Patterson, Carlos Santos e Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="95cb5-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="95cb5-253">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="95cb5-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="95cb5-254">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="95cb5-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="95cb5-255">[Precedente](creating-a-data-access-layer-cs.md)
> [Successivo](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="95cb5-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
