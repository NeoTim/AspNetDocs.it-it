---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: La memorizzazione nella cache i dati nell'architettura (VB) | Microsoft Docs
author: rick-anderson
description: Nell'esercitazione precedente abbiamo appreso come applicare la memorizzazione nella cache a livello di presentazione. In questa esercitazione viene illustrato come sfruttare i vantaggi del nostro architectu a più livelli...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: 9c5ac1aeff427c78030f789fcb67736020ce3367
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59391805"
---
# <a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="1e5b6-104">Memorizzazione di dati nella cache nell'architettura (VB)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-104">Caching Data in the Architecture (VB)</span></span>

<span data-ttu-id="1e5b6-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1e5b6-106">[Scaricare l'App di esempio](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) o [Scarica il PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="1e5b6-107">Nell'esercitazione precedente abbiamo appreso come applicare la memorizzazione nella cache a livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="1e5b6-108">In questa esercitazione è informazioni su come sfruttare i vantaggi della nostra architettura a più livelli per memorizzare i dati a livello di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="1e5b6-109">Facciamo estendendo l'architettura per includere un livello di memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="1e5b6-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="1e5b6-110">Introduction</span></span>

<span data-ttu-id="1e5b6-111">Come illustrato nell'esercitazione precedente, la memorizzazione nella cache i dati di s ObjectDataSource è semplice come l'impostazione di un paio di proprietà.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="1e5b6-112">Sfortunatamente, ObjectDataSource si applica la memorizzazione nella cache a livello di presentazione, che i criteri di memorizzazione nella cache è strettamente collegato con la pagina ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="1e5b6-113">Uno dei motivi per la creazione di un'architettura a più livelli consiste nel consentire tali accorto venga interrotto.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="1e5b6-114">Il livello di logica di Business, ad esempio, consente di disaccoppiare la logica di business dalle pagine di ASP.NET, mentre il livello di accesso ai dati consente di disaccoppiare i dettagli di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="1e5b6-115">Questa separazione dei dettagli di accesso per la logica e i dati di business è preferibile, in parte, perché il sistema diventa più leggibile, più facili da gestire e più flessibile per modificare.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="1e5b6-116">Consente inoltre di conoscenza del settore e divisione del lavoro, gli sviluppatori che lavorano sul livello di presentazione t devono conoscere i dettagli del database s per svolgere il proprio lavoro.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="1e5b6-117">I criteri di memorizzazione nella cache dal livello di presentazione di separazione offre vantaggi simili.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="1e5b6-118">In questa esercitazione forniamo nostra architettura per includere un *memorizzazione nella cache di livello* (o CL breve) che usa i criteri di memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="1e5b6-119">Il livello di memorizzazione nella cache includerà un `ProductsCL` classe che fornisce l'accesso alle informazioni sul prodotto con metodi come `GetProducts()`, `GetProductsByCategoryID(categoryID)`e così via, che, quando richiamata, verranno primo tentativo di recuperare i dati dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="1e5b6-120">Se la cache è vuota, questi metodi richiamerà appropriato `ProductsBLL` nel livello BLL, che a sua volta si ottengono i dati DAL metodo.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="1e5b6-121">Il `ProductsCL` metodi di memorizzare nella cache i dati recuperati da BLL prima di restituirlo.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="1e5b6-122">Come illustrato nella figura 1, il CL si trova tra la presentazione e livelli di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![La memorizzazione nella cache livello (CL) è un altro livello nell'architettura la nostra](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="1e5b6-124">**Figura 1**: La memorizzazione nella cache livello (CL) è un altro livello nell'architettura la nostra</span><span class="sxs-lookup"><span data-stu-id="1e5b6-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="1e5b6-125">Passaggio 1: Creazione di classi del livello di memorizzazione nella cache</span><span class="sxs-lookup"><span data-stu-id="1e5b6-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="1e5b6-126">In questa esercitazione si creerà un CL molto semplice con una singola classe `ProductsCL` che ha solo un numero limitato di metodi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="1e5b6-127">Creazione di un livello di memorizzazione nella cache completa per l'intera applicazione sarebbe necessario creando `CategoriesCL`, `EmployeesCL`, e `SuppliersCL` classi e fornendo un metodo in queste classi di livello la memorizzazione nella cache per ogni metodo di accesso o la modifica dei dati nel livello BLL.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="1e5b6-128">Come con il livello BLL e DAL, idealmente il livello di memorizzazione nella cache deve essere implementato come un progetto libreria di classi separato. Tuttavia, è lo implementeranno come classe nel `App_Code` cartella.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="1e5b6-129">Per altre classi separate correttamente il CL dalle classi di DAL e BLL, ti permettono di s, creare una nuova sottocartella di `App_Code` cartella.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="1e5b6-130">Fare clic sui `App_Code` cartella in Esplora soluzioni, scegliere Nuova cartella e denominare la nuova cartella `CL`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="1e5b6-131">Dopo aver creato questa cartella, aggiungere una nuova classe denominata `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>


![Aggiungere una nuova cartella denominata CL e una classe denominata ProductsCL.vb](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="1e5b6-133">**Figura 2**: Aggiungere una nuova cartella denominata `CL` e una classe denominata `ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="1e5b6-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>


<span data-ttu-id="1e5b6-134">Il `ProductsCL` classe deve includere lo stesso set di metodi di accesso e modifica dati, disponibile nella relativa classe di livello per la logica di Business corrispondente (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="1e5b6-135">Anziché creare tutti questi metodi, s "Let" semplicemente compilazione qui un paio per acquisire familiarità con i modelli usati da CL.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="1e5b6-136">In particolare, si aggiungerà il `GetProducts()` e `GetProductsByCategoryID(categoryID)` metodi nel passaggio 3 e un `UpdateProduct` overload nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="1e5b6-137">È possibile aggiungere il rimanente `ProductsCL` metodi e `CategoriesCL`, `EmployeesCL`, e `SuppliersCL` classi in base alle esigenze specifiche.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="1e5b6-138">Passaggio 2: Lettura e scrittura alla Cache dei dati</span><span class="sxs-lookup"><span data-stu-id="1e5b6-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="1e5b6-139">ObjectDataSource la memorizzazione nella cache funzionalità esplorati internamente nell'esercitazione precedente Usa la cache dei dati ASP.NET per archiviare i dati recuperati da BLL.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="1e5b6-140">La cache dei dati è possibile accedere anche a livello di codice da classi di code-behind di pagine ASP.NET o dalle classi nell'architettura s delle applicazioni web.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="1e5b6-141">Per leggere e scrivere la cache dei dati da una classe code-behind s della pagina ASP.NET, usare il modello seguente:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="1e5b6-142">Il [ `Cache` classe](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` metodo](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) dispone di un numero di overload.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="1e5b6-143">`Cache("key") = value` e `Cache.Insert(key, value)` sono sinonimi e sia aggiungere un elemento alla cache usando la chiave specificata senza una scadenza definita.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="1e5b6-144">In genere, si vuole specificare una scadenza quando si aggiunge un elemento alla cache, come una dipendenza, una scadenza basati sul tempo o entrambi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="1e5b6-145">Usare uno degli altri `Insert` overload del metodo s per fornire informazioni di scadenza delle dipendenze - o basati sul tempo.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="1e5b6-146">Il livello di memorizzazione nella cache s metodi devono prima di tutto verificare se sono presente nella cache i dati richiesti e, in caso affermativo, restituirlo da tale posizione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="1e5b6-147">Se i dati richiesti non sono presente nella cache, il metodo BLL appropriato deve essere richiamato.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="1e5b6-148">Il valore restituito deve essere memorizzato nella cache e sono tornato, come illustrato nel seguente diagramma di sequenza.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![I metodi di s la memorizzazione nella cache di livello restituiscono i dati dalla Cache Se si s disponibile](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="1e5b6-150">**Figura 3**: I metodi di s la memorizzazione nella cache di livello restituiscono i dati dalla Cache Se si s disponibile</span><span class="sxs-lookup"><span data-stu-id="1e5b6-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="1e5b6-151">La sequenza illustrata nella figura 3 viene eseguita nelle classi CL adottando il modello seguente:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="1e5b6-152">In questo caso, *tipo* è il tipo di dati da archiviare nella cache `Northwind.ProductsDataTable`, ad esempio mentre *chiave* è la chiave che identifica in modo univoco l'elemento della cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="1e5b6-153">Se l'elemento con l'oggetto specificato *key* non è nella cache, quindi *istanza* saranno `Nothing` e i dati verranno recuperati dal metodo BLL appropriato e aggiunto alla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="1e5b6-154">Nel momento `Return instance` raggiungimento *istanza* contiene un riferimento ai dati, dalla cache o il pull da BLL.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="1e5b6-155">Assicurarsi di usare il modello precedente, l'accesso ai dati dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="1e5b6-156">Il modello seguente, che, a prima vista, è equivalente, contiene una sottile differenza che introduce una race condition.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="1e5b6-157">Le race condition sono difficili da eseguire il debug perché rivelano la propria presenza sporadicamente e difficili da riprodurre.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="1e5b6-158">La differenza in questo secondo frammento di codice non corretto è che invece di memorizzare un riferimento all'elemento memorizzato nella cache in una variabile locale, la cache dei dati avviene direttamente nell'istruzione condizionale *e* nel `Return`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="1e5b6-159">Si supponga che, quando viene raggiunto questo codice, `Cache("key")` non è `Nothing`, ma prima la `Return` istruzione viene raggiunto, il sistema rimuove *chiave* dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="1e5b6-160">In questi rari casi, verrà restituito il codice `Nothing` anziché un oggetto del tipo previsto.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="1e5b6-161">La cache dei dati è thread-safe, quindi non è necessario sincronizzare l'accesso thread per semplici operazioni di lettura o scrittura.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="1e5b6-162">Tuttavia, se è necessario eseguire più operazioni sui dati nella cache che devono essere atomici, si è responsabili dell'implementazione di un blocco o un altro meccanismo per garantire la thread safety.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="1e5b6-163">Visualizzare [la sincronizzazione di accesso alla Cache ASP.NET](http://www.ddj.com/184406369) per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="1e5b6-164">Un elemento è possibile dedurlo a livello di codice nella cache i dati usando il [ `Remove` metodo](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) come segue:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="1e5b6-165">Passaggio 3: Restituzione di informazioni sui prodotti dal`ProductsCL`classe</span><span class="sxs-lookup"><span data-stu-id="1e5b6-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="1e5b6-166">Per questa esercitazione lasciare s implementare due metodi per la restituzione di informazioni sui prodotti dal `ProductsCL` classe: `GetProducts()` e `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="1e5b6-167">Come con le `ProductsBL` classe nel livello di logica di Business, il `GetProducts()` metodo CL restituisce informazioni su tutti i prodotti come una `Northwind.ProductsDataTable` oggetto, mentre `GetProductsByCategoryID(categoryID)` restituisce tutti i prodotti da una categoria specificata.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="1e5b6-168">Il codice seguente viene illustrata una parte dei metodi di `ProductsCL` classe:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="1e5b6-169">In primo luogo, si noti il `DataObject` e `DataObjectMethodAttribute` attributi applicati ai metodi e classi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="1e5b6-170">Questi attributi forniscono informazioni per la procedura guidata s ObjectDataSource, che indica che le classi e metodi devono apparire nella procedura guidata s.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="1e5b6-171">Poiché i metodi e classi CL saranno accessibili da ObjectDataSource nel livello di presentazione, ho aggiunto questi attributi per migliorare l'esperienza in fase di progettazione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="1e5b6-172">Fare riferimento al [creazione di un livello di logica di Business](../introduction/creating-a-business-logic-layer-vb.md) esercitazione per una descrizione più completa su questi attributi e i relativi effetti.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="1e5b6-173">Nel `GetProducts()` e `GetProductsByCategoryID(categoryID)` metodi, i dati restituiti dai `GetCacheItem(key)` metodo viene assegnato a una variabile locale.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="1e5b6-174">Il `GetCacheItem(key)` metodo, che esamineremo a breve, restituisce un elemento specifico dalla cache basata sull'oggetto specificato *chiave*.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="1e5b6-175">Se tali dati non viene trovati nella cache, viene recuperato dal corrispondente `ProductsBLL` metodo della classe e quindi aggiunto alla cache usando il `AddCacheItem(key, value)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="1e5b6-176">Il `GetCacheItem(key)` e `AddCacheItem(key, value)` metodi di interfaccia con la cache dei dati, la lettura e scrittura dei valori, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="1e5b6-177">Il `GetCacheItem(key)` metodo è più semplice delle due.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="1e5b6-178">Restituisce semplicemente il valore dalla classe Cache usando passato *chiave*:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="1e5b6-179">`GetCacheItem(key)` non usa *chiave* valore specificato, ma le chiamate di `GetCacheKey(key)` metodo, che restituisce il *chiave* preceduto ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="1e5b6-180">Il `MasterCacheKeyArray`, che contiene la stringa ProductsCache, viene usato anche per il `AddCacheItem(key, value)` metodo, come vedremo momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="1e5b6-181">Da una classe code-behind s pagina ASP.NET, la cache dei dati sono accessibili tramite il `Page` classe s [ `Cache` proprietà](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)e consente una sintassi simile a quella `Cache("key") = value`, come illustrato nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="1e5b6-182">Da una classe all'interno dell'architettura, la cache dei dati sono accessibili tramite uno `HttpRuntime.Cache` o `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="1e5b6-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)del post di blog [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) il vantaggio di lieve miglioramento delle prestazioni dell'utilizzo di notes `HttpRuntime` invece di `HttpContext.Current`; di conseguenza, `ProductsCL` Usa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="1e5b6-184">Se l'architettura è implementata utilizzando i progetti libreria di classi, è necessario aggiungere un riferimento per la `System.Web` assembly per poter usare il [ `HttpRuntime` ](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) e [ `HttpContext` ](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="1e5b6-185">Se l'elemento non viene trovato nella cache, il `ProductsCL` metodi di classe s ottenere i dati da BLL e aggiungerlo alla cache usando il `AddCacheItem(key, value)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="1e5b6-186">Per aggiungere *valore* alla cache potremmo utilizziamo il codice seguente, che viene utilizzata una scadenza di 60 secondi ora:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="1e5b6-187">`DateTime.Now.AddSeconds(CacheDuration)` Specifica la durata basati sul tempo di 60 secondi in while futuri [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) non indica ciò che s alcuna scadenza variabile.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="1e5b6-188">Mentre questo `Insert` overload del metodo con parametri di input per entrambi un assoluto e variabile scadenza, è possibile fornire solo una delle due.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="1e5b6-189">Se si tenta di specificare un tempo assoluto e un intervallo di tempo, il `Insert` metodo genererà un' `ArgumentException` eccezione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="1e5b6-190">Questa implementazione del `AddCacheItem(key, value)` metodo attualmente presenta alcuni difetti.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="1e5b6-191">Illustreremo affrontare e risolvere questi problemi nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="1e5b6-192">Passaggio 4: Invalida i dati di Cache quando viene modificato tramite l'architettura</span><span class="sxs-lookup"><span data-stu-id="1e5b6-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="1e5b6-193">Insieme ai metodi di recupero dei dati, il livello di memorizzazione nella cache deve fornire gli stessi metodi come il livello BLL per inserimento, aggiornamento ed eliminazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="1e5b6-194">I metodi di modifica dei dati di s CL non modificano i dati memorizzati nella cache, ma piuttosto chiamare il metodo modifica di dati della versione corrispondente di BLL s e poi invalidare la cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="1e5b6-195">Come illustrato nell'esercitazione precedente, questo è lo stesso comportamento che ObjectDataSource si applica quando sono abilitate le funzionalità di memorizzazione nella cache e il relativo `Insert`, `Update`, o `Delete` vengono richiamati i metodi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="1e5b6-196">Nell'esempio `UpdateProduct` overload viene illustrato come implementare i metodi di modifica dei dati in CL:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="1e5b6-197">La modifica dei dati appropriati metodo Business Logic Layer viene richiamata, ma prima che venga restituita la risposta è necessario invalidare la cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="1e5b6-198">Sfortunatamente, invalidare la cache non è estremamente semplice perché il `ProductsCL` classe s `GetProducts()` e `GetProductsByCategoryID(categoryID)` metodi ognuno consentono di aggiungere elementi alla cache con chiavi diverse e il `GetProductsByCategoryID(categoryID)` metodo aggiunge un elemento della cache diverso per ogni univoco *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="1e5b6-199">Quando l'invalidazione della cache, è necessario rimuovere *tutte* degli elementi che potrebbero essere stati aggiunti dal `ProductsCL` classe.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="1e5b6-200">Questa operazione può essere eseguita associando un *memorizza nella cache delle dipendenze* con ogni elemento aggiunto alla cache nel server di `AddCacheItem(key, value)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="1e5b6-201">In generale, una dipendenza della cache può essere un altro elemento nella cache, un file nel file system, o dati da un database Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="1e5b6-202">Quando la dipendenza viene modificato o viene rimosso dalla cache, gli elementi della cache è associato vengono automaticamente rimossi dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="1e5b6-203">Per questa esercitazione, è necessario creare un elemento aggiuntivo nella cache che funge da una dipendenza della cache per tutti gli elementi aggiunti tramite il `ProductsCL` classe.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="1e5b6-204">In questo modo, tutti questi elementi possono essere rimossi dalla cache rimuovendo semplicemente la dipendenza della cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="1e5b6-205">Aggiornamento di "Let" s il `AddCacheItem(key, value)` metodo in modo che ogni elemento aggiunto alla cache tramite questo metodo è associato a una dipendenza della singola cache:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="1e5b6-206">`MasterCacheKeyArray` è una matrice di stringhe che contiene un singolo valore, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="1e5b6-207">In primo luogo, un elemento della cache viene aggiunto alla cache e assegnato la data e ora correnti.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="1e5b6-208">Se l'elemento della cache esiste già, viene aggiornata.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="1e5b6-209">Successivamente, viene creata una dipendenza della cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="1e5b6-210">Il [ `CacheDependency` classe](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s costruttore ha un numero di overload, ma quello usata qui prevede due `String` gli input di matrice.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="1e5b6-211">La prima specifica il set di file da utilizzare come dipendenze.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="1e5b6-212">Poiché non abbiamo da usare eventuali dipendenze basate su file, un valore di t `Nothing` viene usato per il primo parametro di input.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="1e5b6-213">Il secondo parametro di input specifica il set di chiavi della cache da utilizzare come dipendenze.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="1e5b6-214">In questo caso specifichiamo la dipendenza singola, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="1e5b6-215">Il `CacheDependency` viene quindi passato il `Insert` (metodo).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="1e5b6-216">Grazie a questa modifica a `AddCacheItem(key, value)`, invaliding è semplice quanto rimuovendo la dipendenza della cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="1e5b6-217">Passaggio 5: La chiamata a livello di memorizzazione nella cache dal livello di presentazione</span><span class="sxs-lookup"><span data-stu-id="1e5b6-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="1e5b6-218">Metodi e le classi di memorizzazione nella cache di livello s utilizzabile per lavorare con i dati usando le tecniche si va esaminato in queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="1e5b6-219">Per illustrare l'utilizzo dei dati memorizzati nella cache, salvare le modifiche per il `ProductsCL` classe e quindi aprire la `FromTheArchitecture.aspx` nella pagina il `Caching` cartella e aggiungere un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="1e5b6-220">GridView s nello smart tag, creare un nuovo oggetto ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="1e5b6-221">Nel primo passaggio s guidata dovrebbe essere il `ProductsCL` classe come una delle opzioni nell'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="1e5b6-222">[![La classe ProductsCL è incluso nell'elenco a discesa di oggetti Business](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="1e5b6-223">**Figura 4**: Il `ProductsCL` classe è inclusa nell'elenco a discesa di oggetti Business ([fare clic per visualizzare l'immagine con dimensioni normali](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1e5b6-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>


<span data-ttu-id="1e5b6-224">Dopo aver selezionato `ProductsCL`, fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="1e5b6-225">L'elenco di riepilogo a discesa della scheda selezionare dispone di due elementi - `GetProducts()` e `GetProductsByCategoryID(categoryID)` e la scheda aggiornamento ha unico `UpdateProduct` rapporto di overload.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="1e5b6-226">Scegliere il `GetProducts()` metodo nella scheda Seleziona e `UpdateProducts` metodo la scheda aggiornamento e fare clic su Fine.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="1e5b6-227">[![Nell'elenco a discesa Elenca sono elencati i metodi della classe ProductsCL s](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="1e5b6-228">**Figura 5**: Il `ProductsCL` sono racchiusi l'elenco a discesa sono elencati i metodi della classe s ([fare clic per visualizzare l'immagine con dimensioni normali](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="1e5b6-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>


<span data-ttu-id="1e5b6-229">Dopo aver completato la procedura guidata, Visual Studio imposterà la s ObjectDataSource `OldValuesParameterFormatString` proprietà `original_{0}` e aggiungere i campi appropriati a GridView.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="1e5b6-230">Modifica il `OldValuesParameterFormatString` il valore predefinito, proprietà `{0}`e configurare il controllo GridView per supportare il paging, ordinamento e la modifica.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="1e5b6-231">Poiché il `UploadProducts` overload utilizzato da CL accetta solo il nome di prodotto modificato s e prezzo, limitare il controllo GridView in modo che solo questi campi sono modificabili.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="1e5b6-232">Nell'esercitazione precedente è stato definito un controllo GridView per includere i campi per il `ProductName`, `CategoryName`, e `UnitPrice` campi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="1e5b6-233">È possibile replicare questa formattazione e la struttura, nel qual caso la s GridView e ObjectDataSource dichiarativo markup dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="1e5b6-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="1e5b6-234">A questo punto si dispone di una pagina che usa il livello di memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="1e5b6-235">Per visualizzare la cache in azione, impostare i punti di interruzione `ProductsCL` classe s `GetProducts()` e `UpdateProduct` metodi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="1e5b6-236">Visita la pagina in un browser e di eseguire il codice durante l'ordinamento e paging per visualizzare i dati estratti dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="1e5b6-237">Quindi aggiornare un record e si noti che la cache viene invalidata e, di conseguenza, vengono recuperato da BLL quando i dati sono riassociati per il controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="1e5b6-238">Il livello di memorizzazione nella cache fornito nel download che accompagna questo articolo non è stato completato.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="1e5b6-239">Contiene una sola classe, `ProductsCL`, che propone solo un numero limitato di metodi.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="1e5b6-240">Inoltre, solo una singola pagina ASP.NET viene utilizzato il CL (`~/Caching/FromTheArchitecture.aspx`) tutti gli altri ancora fare riferimento il livello BLL direttamente.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="1e5b6-241">Se si intende usare un CL nell'applicazione, tutte le chiamate dal livello di presentazione devono accedere al CL, condizione che richiede che le classi di s CL e i metodi illustrati tali classi e metodi nel livello BLL attualmente usato dal livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="1e5b6-242">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="1e5b6-242">Summary</span></span>

<span data-ttu-id="1e5b6-243">Anche se la memorizzazione nella cache può essere applicato nel server di livello di presentazione con ASP.NET 2.0 s SqlDataSource e ObjectDataSource controlli, in una situazione ideale la memorizzazione nella cache le responsabilità potrebbe essere delegato a un livello separato nell'architettura.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="1e5b6-244">In questa esercitazione sono stati creati un livello di memorizzazione nella cache che si trova tra il livello di presentazione e il livello di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="1e5b6-245">Il livello di memorizzazione nella cache deve fornire lo stesso set di classi e metodi che esistono nel livello BLL e vengono chiamati dal livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="1e5b6-246">Gli esempi di livello la memorizzazione nella cache sono stati presentati in questa e le esercitazioni precedenti esibiti *caricamento reattivo*.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="1e5b6-247">Con il caricamento reattivo, i dati vengono caricati nella cache solo quando viene effettuata una richiesta per i dati e che i dati sono mancanti dalla cache.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="1e5b6-248">I dati possono anche essere *caricato in modo proattivo* nella cache, una tecnica che carica i dati nella cache prima che sia effettivamente necessario.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="1e5b6-249">Nella prossima esercitazione vedremo un esempio di caricamento attiva quando si esamina come archiviare valori statici nella cache all'avvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="1e5b6-250">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="1e5b6-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1e5b6-251">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="1e5b6-251">About the Author</span></span>

<span data-ttu-id="1e5b6-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette libri e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha collaborato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1e5b6-253">Lavora come un consulente, formatore e autore.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1e5b6-254">Il suo ultimo libro si intitola [ *Sams Teach Yourself ASP.NET 2.0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1e5b6-255">È possibile contattarlo al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="1e5b6-256">o sul suo blog, che è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="1e5b6-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1e5b6-257">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="1e5b6-257">Special Thanks To</span></span>

<span data-ttu-id="1e5b6-258">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1e5b6-259">Il revisore capo di questa esercitazione è stata Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="1e5b6-259">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="1e5b6-260">Se si è interessati prossimi articoli MSDN dello?</span><span class="sxs-lookup"><span data-stu-id="1e5b6-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1e5b6-261">In questo caso, Inviami una riga in corrispondenza [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1e5b6-262">[Precedente](caching-data-with-the-objectdatasource-vb.md)
> [Successivo](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="1e5b6-262">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
