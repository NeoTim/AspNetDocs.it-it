---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
title: Batch di aggiornamento (c#) | Microsoft Docs
author: rick-anderson
description: Informazioni su come aggiornare più record di database in un'unica operazione. Nel Layer dell'interfaccia utente si compila un controllo GridView in cui ogni riga è modificabile. Nei dati...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 4e849bcc-c557-4bc3-937e-f7453ee87265
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
msc.type: authoredcontent
ms.openlocfilehash: 07b85751dee9b9d00710c90a8dc2b7e250422fff
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65108953"
---
# <a name="batch-updating-c"></a><span data-ttu-id="fb4d8-105">Aggiornamento batch (C#)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-105">Batch Updating (C#)</span></span>

<span data-ttu-id="fb4d8-106">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fb4d8-107">[Scaricare il codice](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) o [Scarica il PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) or [Download PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span></span>

> <span data-ttu-id="fb4d8-108">Informazioni su come aggiornare più record di database in un'unica operazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="fb4d8-109">Nel Layer dell'interfaccia utente si compila un controllo GridView in cui ogni riga è modificabile.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="fb4d8-110">Nel livello di accesso ai dati è eseguire il wrapping di più operazioni di aggiornamento all'interno di una transazione per garantire che tutti gli aggiornamenti abbia esito positivo o vengano eseguito il rollback di tutti gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="fb4d8-111">Introduzione</span><span class="sxs-lookup"><span data-stu-id="fb4d8-111">Introduction</span></span>

<span data-ttu-id="fb4d8-112">Nel [esercitazione precedente](wrapping-database-modifications-within-a-transaction-cs.md) è stato illustrato come estendere il livello di accesso ai dati per aggiungere il supporto per le transazioni del database.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="fb4d8-113">Le transazioni del database garantiscono che una serie di istruzioni di modifica dei dati viene considerata come una singola operazione atomica, che assicura che tutte le modifiche avranno esito negativo o tutti avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="fb4d8-114">Con questo livello basso funzionalità dall'area di lavoro, è nuovamente pronto per concentrare l'attenzione alla creazione di interfacce di modifica dei dati batch.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="fb4d8-115">In questa esercitazione creeremo un controllo GridView in cui ogni riga è modificabile (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="fb4d8-116">Poiché ogni riga non viene eseguito il rendering dell'interfaccia di modifica, qui s è necessario per una colonna di modifica, aggiornare e annullare i pulsanti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="fb4d8-117">Al contrario, sono presenti due pulsanti di aggiornare i prodotti nella pagina che, quando si fa clic, enumerare le righe di GridView e aggiornare il database.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="fb4d8-118">[![Ogni riga nel controllo GridView è modificabile](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-118">[![Each Row in the GridView is Editable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span></span>

<span data-ttu-id="fb4d8-119">**Figura 1**: Ogni riga nel controllo GridView è modificabile ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-cs/_static/image2.png))</span></span>

<span data-ttu-id="fb4d8-120">Introduzione a ti permettono di s.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="fb4d8-121">Nel [esecuzione di aggiornamenti Batch](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) esercitazione è stato creato un batch di modifica dell'interfaccia usando il controllo DataList.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="fb4d8-122">Questa esercitazione è diverso dal precedente uno in cui viene utilizzata una GridView e l'aggiornamento batch viene eseguito all'interno dell'ambito di una transazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="fb4d8-123">Dopo aver completato questa esercitazione consiglia di tornare all'esercitazione precedente e aggiornarla per usare la funzionalità di correlate alle transazioni di database aggiunta nell'esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="fb4d8-124">Esaminare i passaggi per rendere modificabile tutte le righe di GridView</span><span class="sxs-lookup"><span data-stu-id="fb4d8-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="fb4d8-125">Come descritto nel [una panoramica di inserimento, aggiornamento ed eliminazione di dati](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) esercitazione, il controllo GridView offre supporto predefinito per la modifica i dati sottostanti per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="fb4d8-126">Internamente, il controllo GridView note quali riga può essere modificata tramite il [ `EditIndex` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="fb4d8-127">Controlla come viene associato il controllo GridView all'origine dati, ogni riga per verificare se l'indice della riga è uguale al valore di `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="fb4d8-128">In questo caso, le interfacce che s i campi vengono visualizzati utilizzando la loro modifica la riga.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="fb4d8-129">Per i BoundField, l'interfaccia di modifica è una casella di testo il cui `Text` proprietà viene assegnato il valore del campo dati specificato dalla s BoundField `DataField` proprietà.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="fb4d8-130">Per TemplateFields, il `EditItemTemplate` viene usato al posto di `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="fb4d8-131">È importante ricordare che il flusso di lavoro modifica inizia quando un utente fa clic sul pulsante Modifica una riga o le righe.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="fb4d8-132">Ciò determina un postback, imposta la s GridView `EditIndex` proprietà per l'indice di riga selezionata s e riassociazioni i dati nella griglia.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="fb4d8-133">Quando viene selezionato un pulsante Annulla riga s, durante il postback il `EditIndex` è impostata su un valore di `-1` prima i dati nella griglia la riassociazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="fb4d8-134">Poiché le righe s GridView avvia l'indicizzazione nella posizione zero, l'impostazione `EditIndex` a `-1` ha l'effetto di visualizzare il controllo GridView in modalità di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="fb4d8-135">Il `EditIndex` proprietà funziona bene per la modifica per riga, ma non è progettato per la modifica in blocco.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="fb4d8-136">Per rendere modificabili i GridView intero, è necessario che ogni riga di eseguire il rendering usando l'interfaccia di modifica.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="fb4d8-137">Il modo più semplice per eseguire questa operazione consiste nel creare in cui ogni campo modificabile viene implementato come un TemplateField con la relativa interfaccia modifica definito nel `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="fb4d8-138">Prossimi diversi passaggi si creerà un GridView completamente modificabile.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="fb4d8-139">Nel passaggio 1 verranno inizia creando l'oggetto GridView con ObjectDataSource e convertire i BoundField e CampoCasellaDiControllo in TemplateFields.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="fb4d8-140">Nei passaggi 2 e 3 si passerà le interfacce di modifica da di TemplateFields `EditItemTemplate` s al loro `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="fb4d8-141">Passaggio 1: Visualizzazione di informazioni sul prodotto</span><span class="sxs-lookup"><span data-stu-id="fb4d8-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="fb4d8-142">Prima ci preoccupiamo la creazione di un controllo GridView in cui vengono le righe è modificabili, consentire s per iniziare, è sufficiente visualizzare le informazioni sul prodotto.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="fb4d8-143">Aprire il `BatchUpdate.aspx` nella pagina di `BatchData` cartelle e trascinare un controllo GridView dalla casella degli strumenti nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="fb4d8-144">Impostare la s GridView `ID` al `ProductsGrid` e scegliere dal suo smart tag da associare a un nuovo oggetto ObjectDataSource denominato `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="fb4d8-145">Configurare ObjectDataSource per recuperare i dati dal `ProductsBLL` classe s `GetProducts` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="fb4d8-146">[![Configurare ObjectDataSource per usare la classe ProductsBLL](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span></span>

<span data-ttu-id="fb4d8-147">**Figura 2**: Configurare ObjectDataSource per usare la `ProductsBLL` classe ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image4.png))</span></span>

<span data-ttu-id="fb4d8-148">[![Recuperare i dati del prodotto utilizzando il metodo GetProducts](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span></span>

<span data-ttu-id="fb4d8-149">**Figura 3**: Recuperare i dati di prodotto usando il `GetProducts` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-cs/_static/image6.png))</span></span>

<span data-ttu-id="fb4d8-150">Come per GridView, le funzionalità di modifica s ObjectDataSource sono progettate per funzionare su una base di ogni riga.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="fb4d8-151">Per aggiornare un set di record, è necessario scrivere un po' di codice nella classe code-behind ASP.NET pagina s che invia in batch i dati e lo passa per il livello BLL.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="fb4d8-152">Pertanto, impostare gli elenchi a discesa in s ObjectDataSource schede UPDATE, INSERT e DELETE su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="fb4d8-153">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="fb4d8-154">[![Impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span></span>

<span data-ttu-id="fb4d8-155">**Figura 4**: Impostare l'elenco a discesa sono elencati nell'aggiornamento, inserimento ed eliminare schede su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image8.png))</span></span>

<span data-ttu-id="fb4d8-156">Dopo aver completato la procedura guidata Configura origine dati, il markup dichiarativo di ObjectDataSource s dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample1.aspx)]

<span data-ttu-id="fb4d8-157">Completamento procedura guidata Configura origine dati provoca anche Visual Studio per creare un CampoCasellaDiControllo per i campi di dati del prodotto e BoundField in GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="fb4d8-158">Per questa esercitazione, lasciare s solo consentire all'utente di visualizzare e modificare il s nome prodotto, categoria, prezzo e lo stato non più utilizzato.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="fb4d8-159">Rimuovi tutto tranne le `ProductName`, `CategoryName`, `UnitPrice`, e `Discontinued` campi e rinominare il `HeaderText` le proprietà delle prime tre campi per prodotto, categoria e prezzo, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="fb4d8-160">Infine, selezionare le caselle di controllo Attiva Paging e abilitare l'ordinamento nello smart tag s GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="fb4d8-161">A questo punto include anche tre BoundField (`ProductName`, `CategoryName`, e `UnitPrice`) e un CampoCasellaDiControllo (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="fb4d8-162">È necessario convertire questi quattro campi in TemplateFields e quindi spostare l'interfaccia di modifica da s TemplateField `EditItemTemplate` al relativo `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4d8-163">È stata esaminata la creazione e personalizzazione di TemplateFields nel [personalizzazione dell'interfaccia di modifica dati](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span> <span data-ttu-id="fb4d8-164">Verranno esaminati i passaggi necessari per convertire i BoundField e CampoCasellaDiControllo in TemplateFields e definire la loro modifica interfacce nella loro `ItemTemplate` s, ma se bloccarsi o necessario un ripasso, don t sono riluttanti a fare riferimento a questa esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="fb4d8-165">GridView s smart tag, fare clic sul collegamento Modifica colonne per aprire la finestra di dialogo campi.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="fb4d8-166">Successivamente, selezionare ogni campo e fare clic su Converti il campo in un collegamento TemplateField.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Convertire i BoundField esistente e CampoCasellaDiControllo in TemplateField](batch-updating-cs/_static/image5.gif)

<span data-ttu-id="fb4d8-168">**Figura 5**: Convertire i BoundField esistente e CampoCasellaDiControllo in TemplateField</span><span class="sxs-lookup"><span data-stu-id="fb4d8-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateField</span></span>

<span data-ttu-id="fb4d8-169">Ora che ogni campo è un TemplateField, sono pronti a spostare la modifica dell'interfaccia dal `EditItemTemplate` s per il `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="fb4d8-170">Passaggio 2: Creazione di`ProductName`,`UnitPrice`, e`Discontinued`interfacce di modifica</span><span class="sxs-lookup"><span data-stu-id="fb4d8-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="fb4d8-171">Creazione di `ProductName`, `UnitPrice`, e `Discontinued` modifica le interfacce sono l'argomento di questo passaggio e sono piuttosto semplici, con ogni interfaccia è già definito in s TemplateField `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="fb4d8-172">Creazione di `CategoryName` modifica interfaccia è un po' più complessa perché è necessario creare un controllo DropDownList le categorie applicabili.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="fb4d8-173">Ciò `CategoryName` modifica interfaccia viene affrontata nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="fb4d8-174">Let s iniziano con la `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="fb4d8-175">Fare clic sul collegamento di modifica modelli dello smart tag s GridView e il drill-down per il `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="fb4d8-176">Selezionare la casella di testo, copiarlo negli Appunti e incollarlo il `ProductName` TemplateField s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="fb4d8-177">Modificare gli oggetti nella casella di testo `ID` proprietà `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="fb4d8-178">Successivamente, aggiungere un RequiredFieldValidator al `ItemTemplate` per assicurarsi che l'utente fornisce un valore per ogni nome di prodotto s.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="fb4d8-179">Impostare il `ControlToValidate` proprietà ProductName, il `ErrorMessage` proprietà per l'utente deve fornire il nome del prodotto.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="fb4d8-180">e il `Text` proprietà \*.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-180">and the `Text` property to \*.</span></span> <span data-ttu-id="fb4d8-181">Dopo aver apportato queste aggiunte per il `ItemTemplate`, la schermata dovrebbe essere simile alla figura 6.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="fb4d8-182">[![ProductName TemplateField ora include una casella di testo e un RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span></span>

<span data-ttu-id="fb4d8-183">**Figura 6**: Il `ProductName` TemplateField ora include una casella di testo e un RequiredFieldValidator ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-cs/_static/image10.png))</span></span>

<span data-ttu-id="fb4d8-184">Per il `UnitPrice` interfaccia di modifica, iniziare copiando la casella di testo dal `EditItemTemplate` per il `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="fb4d8-185">Successivamente, inserire un simbolo $ davanti la casella di testo e il set relativo `ID` proprietà UnitPrice e la relativa `Columns` proprietà a 8.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="fb4d8-186">Aggiungere anche un controllo CompareValidator per i `UnitPrice` s `ItemTemplate` per garantire che il valore immesso dall'utente è un valore di valuta validi maggiore o uguale a $0,00.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="fb4d8-187">Impostare s validator `ControlToValidate` UnitPrice, proprietà relativa `ErrorMessage` proprietà per l'utente deve immettere un valore di valuta validi.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="fb4d8-188">. Omettere qualsiasi valuta i simboli., relativo `Text` proprietà \*, la relativa `Type` proprietà `Currency`, la relativa `Operator` proprietà `GreaterThanEqual`e il relativo `ValueToCompare` proprietà su 0.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="fb4d8-189">[![Aggiungere un controllo CompareValidator per assicurarsi di immettere il prezzo è un valore di valuta Non negativo](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span></span>

<span data-ttu-id="fb4d8-190">**Figura 7**: Aggiungere un controllo CompareValidator per assicurarsi di immettere il prezzo è un valore di valuta Non negativo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-cs/_static/image12.png))</span></span>

<span data-ttu-id="fb4d8-191">Per il `Discontinued` TemplateField è possibile usare la casella di controllo già definito nel `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="fb4d8-192">È sufficiente impostare relativi `ID` a Discontinued e la relativa `Enabled` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-192">Simply set its `ID` to Discontinued and its `Enabled` property to `true`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="fb4d8-193">Passaggio 3: Creazione di`CategoryName`modifica interfaccia</span><span class="sxs-lookup"><span data-stu-id="fb4d8-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="fb4d8-194">L'interfaccia di modifica nel `CategoryName` s TemplateField `EditItemTemplate` contiene una casella di testo che visualizza il valore della `CategoryName` campo dati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="fb4d8-195">È necessario sostituire con un controllo DropDownList che elenca le categorie possibili.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4d8-196">Il [personalizzazione dell'interfaccia di modifica dati](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) esercitazione contiene una discussione più approfondita e completa sulla personalizzazione di un modello per includere un controllo DropDownList invece di una casella di testo.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="fb4d8-197">Anche se questi passaggi sono completi, vengono presentati fornisce risposte superficiali.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="fb4d8-198">Per un'analisi più approfondita a creare e configurare le categorie DropDownList, vedere la [personalizzazione dell'interfaccia di modifica dei dati](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span>

<span data-ttu-id="fb4d8-199">Trascinare un controllo DropDownList dalla casella degli strumenti di `CategoryName` s TemplateField `ItemTemplate`, l'impostazione relativa `ID` a `Categories`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="fb4d8-200">A questo punto sarebbe in genere definiamo l'origine dati di s controlli DropDownList tramite suo smart tag, la creazione di un nuovo oggetto ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="fb4d8-201">Tuttavia, verrà aggiunto ObjectDataSource all'interno di `ItemTemplate`, verrà visualizzato un risultato in un'istanza di ObjectDataSource creata per ogni riga GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="fb4d8-202">Lasciare invece che s creare ObjectDataSource di fuori di GridView s TemplateFields.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="fb4d8-203">Terminare la modifica dei modelli e trascinare un ObjectDataSource dalla casella degli strumenti nella finestra di progettazione sotto le `ProductsDataSource` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="fb4d8-204">Denominare il nuovo oggetto ObjectDataSource `CategoriesDataSource` e configurarlo per usare il `CategoriesBLL` classe s `GetCategories` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="fb4d8-205">[![Configurare ObjectDataSource per usare la classe CategoriesBLL](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span></span>

<span data-ttu-id="fb4d8-206">**Figura 8**: Configurare ObjectDataSource per usare la `CategoriesBLL` classe ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image14.png))</span></span>

<span data-ttu-id="fb4d8-207">[![Recuperare i dati della categoria utilizzando il metodo GetCategories](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span></span>

<span data-ttu-id="fb4d8-208">**Figura 9**: Recuperare i dati di categoria usando il `GetCategories` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-cs/_static/image16.png))</span></span>

<span data-ttu-id="fb4d8-209">Poiché questo ObjectDataSource viene usato semplicemente per recuperare i dati, impostare gli elenchi a discesa nelle schede UPDATE e DELETE su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="fb4d8-210">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="fb4d8-211">[![Set di elenchi a discesa in di aggiornamento e le schede di eliminazione per (nessuno)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span></span>

<span data-ttu-id="fb4d8-212">**Figura 10**: Impostare l'elenco a discesa sono elencati nelle schede di eliminazione e aggiornamento su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image18.png))</span></span>

<span data-ttu-id="fb4d8-213">Dopo aver completato la procedura guidata, il `CategoriesDataSource` markup dichiarativo s dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample2.aspx)]

<span data-ttu-id="fb4d8-214">Con il `CategoriesDataSource` creato e configurato, tornare al `CategoryName` TemplateField s `ItemTemplate` e, DropDownList s nello smart tag, fare clic sul collegamento Scegli origine dati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="fb4d8-215">Nella procedura guidata configurazione dell'origine dati, selezionare la `CategoriesDataSource` l'opzione dal primo elenco a discesa e scegliere di avere `CategoryName` utilizzato per la visualizzazione e `CategoryID` come valore.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="fb4d8-216">[![Associare il CategoriesDataSource DropDownList](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span></span>

<span data-ttu-id="fb4d8-217">**Figura 11**: Associare il controllo DropDownList per il `CategoriesDataSource` ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-cs/_static/image20.png))</span></span>

<span data-ttu-id="fb4d8-218">A questo punto il `Categories` DropDownList Elenca tutte le categorie, ma non verrà ancora automaticamente selezionata la categoria appropriata per il prodotto associato alla riga GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="fb4d8-219">A tale scopo è necessario impostare il `Categories` s DropDownList `SelectedValue` al prodotto s `CategoryID` valore.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="fb4d8-220">Fare clic sul collegamento Modifica DataBindings dallo smart tag DropDownList s e associare le `SelectedValue` proprietà con il `CategoryID` datové pole come illustrato nella figura 12.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Associare il valore di CategoryID prodotto s per la proprietà SelectedValue s DropDownList](batch-updating-cs/_static/image12.gif)

<span data-ttu-id="fb4d8-222">**Figura 12**: Associare il prodotto 1!s `CategoryID` valore per i dispositivi DropDownList `SelectedValue` proprietà</span><span class="sxs-lookup"><span data-stu-id="fb4d8-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="fb4d8-223">Un ultimo rimane di problema: se il prodotto ha un `CategoryID` specificato valore quindi l'istruzione di Data Binding in `SelectedValue` genererà un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="fb4d8-224">Ciò avviene perché il controllo DropDownList contiene solo gli elementi per le categorie e non offre un'opzione per i prodotti con un `NULL` database valore `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="fb4d8-225">Per risolvere questo problema, impostare la s DropDownList `AppendDataBoundItems` proprietà `true` e aggiungere un nuovo elemento a DropDownList, omettendo il `Value` proprietà dalla sintassi dichiarativa per il.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `true` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="fb4d8-226">Vale a dire, assicurarsi che il `Categories` sintassi dichiarativa per il controllo DropDownList s simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample3.aspx)]

<span data-ttu-id="fb4d8-227">Si noti come il `<asp:ListItem Value="">` - selezionare uno, è relativo `Value` attributo impostato in modo esplicito in una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="fb4d8-228">Fare riferimento al [personalizzazione dell'interfaccia di modifica dei dati](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) esercitazione per una discussione più approfondita sui motivi per cui questo elemento DropDownList aggiuntivo necessari per gestire le `NULL` case e il motivo per cui assegnazione del `Value` proprietà da una stringa vuota è essenziale.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4d8-229">C'è una potenziale scalabilità e prestazioni problema qui che vale la pena citare.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="fb4d8-230">Poiché ogni riga dispone di un controllo DropDownList che usa il `CategoriesDataSource` come origine dati, il `CategoriesBLL` classe s `GetCategories` metodo verrà chiamato *n* volte per ogni pagina visitano, dove *n* è il numero di righe in GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="fb4d8-231">Questi *n* le chiamate a `GetCategories` comportare *n* query al database.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="fb4d8-232">Questo impatto sul database potrebbe essere diminuito memorizzando nella cache le categorie restituite in una cache per ogni richiesta o tramite il livello di memorizzazione nella cache usando un linguaggio SQL dipendenza o a una scadenza basata molto sul breve periodo di tempo di memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="fb4d8-233">Per altre informazioni sulla richiesta per la memorizzazione nella cache di opzione, vedere [ `HttpContext.Items` Store una Cache Per richiesta](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="fb4d8-234">Passaggio 4: Completare l'interfaccia di modifica</span><span class="sxs-lookup"><span data-stu-id="fb4d8-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="fb4d8-235">Abbiamo ve apportate alcune modifiche ai modelli s GridView senza la sospensione per visualizzare lo stato di avanzamento.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="fb4d8-236">Si consiglia di visualizzare lo stato di avanzamento tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="fb4d8-237">Come illustrato nella figura 13, ogni riga viene generato usando relativo `ItemTemplate`, che contiene la s cella interfaccia di modifica.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="fb4d8-238">[![Ogni riga GridView è modificabile](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-238">[![Each GridView Row is Editable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span></span>

<span data-ttu-id="fb4d8-239">**Figura 13**: Ogni riga GridView è modificabile ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-cs/_static/image22.png))</span></span>

<span data-ttu-id="fb4d8-240">Esistono alcuni problemi di formattazione secondari che dovremmo occupandoci dell'ora.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="fb4d8-241">In primo luogo, si noti che il `UnitPrice` valore contiene quattro cifre decimali.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="fb4d8-242">Per risolvere questo problema, ripristinare il `UnitPrice` TemplateField s `ItemTemplate` e, nella casella di testo s nello smart tag, fare clic sul collegamento Modifica DataBindings.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="fb4d8-243">Successivamente, specificare che il `Text` proprietà deve essere formattata come un numero.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Formattare la proprietà Text sotto forma di numero](batch-updating-cs/_static/image14.gif)

<span data-ttu-id="fb4d8-245">**Figura 14**: Formato di `Text` proprietà sotto forma di numero</span><span class="sxs-lookup"><span data-stu-id="fb4d8-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="fb4d8-246">In secondo luogo, s consentono di allineare al centro la casella di controllo di `Discontinued` colonna (anziché viene allineato a sinistra).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="fb4d8-247">Fare clic su Modifica colonne dello smart tag s GridView e selezionare il `Discontinued` TemplateField dall'elenco dei campi nell'angolo inferiore sinistro.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="fb4d8-248">Il drill down `ItemStyle` e impostare il `HorizontalAlign` proprietà Center, come illustrato nella figura 15.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Allineare al centro la casella di controllo non più supportata](batch-updating-cs/_static/image15.gif)

<span data-ttu-id="fb4d8-250">**Figura 15**: Centro di `Discontinued` casella di controllo</span><span class="sxs-lookup"><span data-stu-id="fb4d8-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="fb4d8-251">Successivamente, aggiungere un controllo di controllo ValidationSummary alla pagina e impostare relativi `ShowMessageBox` proprietà `true` e il relativo `ShowSummary` proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="fb4d8-252">Aggiungere anche il pulsante di controlli Web, che, quando si fa clic, aggiornerà le modifiche s utente.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="fb4d8-253">In particolare, aggiungere due controlli pulsante Web, uno sopra il controllo GridView e uno di sotto di esso, l'impostazione entrambi i controlli `Text` proprietà da aggiornamenti dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="fb4d8-254">Poiché la s GridView modifica interfaccia è definita nel relativo TemplateFields `ItemTemplate` s, la `EditItemTemplate` s sono superflue e possono essere eliminati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="fb4d8-255">Dopo che effettua quanto sopra accennato modifiche relative alla formattazione, i controlli pulsante di aggiunta e rimozione di inutili `EditItemTemplate` s, la sintassi dichiarativa per pagina s dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample4.aspx)]

<span data-ttu-id="fb4d8-256">Figura 16 Mostra questa pagina quando viene visualizzato tramite un browser dopo che sono stati aggiunti i controlli pulsante Web e le modifiche apportate alla formattazione.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="fb4d8-257">[![Adesso la pagina include due pulsanti di prodotti di aggiornamento](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span></span>

<span data-ttu-id="fb4d8-258">**Figura 16**: La pagina ora include due aggiornamenti prodotti pulsanti ([fare clic per visualizzare l'immagine con dimensioni normali](batch-updating-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="fb4d8-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-cs/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="fb4d8-259">Passaggio 5: L'aggiornamento dei prodotti</span><span class="sxs-lookup"><span data-stu-id="fb4d8-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="fb4d8-260">Quando un utente visita questa pagina verranno apportano le modifiche e quindi fare clic su uno dei due pulsanti aggiornamenti dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="fb4d8-261">A questo punto è necessario in qualche modo salvare i valori immessi dall'utente per ogni riga in una `ProductsDataTable` dell'istanza e si passa quindi un metodo BLL che verrà quindi passarli `ProductsDataTable` istanza per i dispositivi DAL `UpdateWithTransaction` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="fb4d8-262">Il `UpdateWithTransaction` metodo, che è stato creato nel [esercitazione precedente](wrapping-database-modifications-within-a-transaction-cs.md), assicura che il batch delle modifiche verrà aggiornato come operazione atomica.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="fb4d8-263">Creare un metodo denominato `BatchUpdate` in `BatchUpdate.aspx.cs` e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.cs` and add the following code:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample5.cs)]

<span data-ttu-id="fb4d8-264">Questo metodo inizia recuperando tutti i prodotti in una `ProductsDataTable` tramite una chiamata a s BLL `GetProducts` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="fb4d8-265">Vengono quindi enumerati i `ProductGrid` s GridView [ `Rows` raccolta](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="fb4d8-266">Il `Rows` raccolta contiene un [ `GridViewRow` istanza](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) per ogni riga visualizzata nel controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="fb4d8-267">Poiché viene mostrata al massimo dieci righe per pagina, la s GridView `Rows` raccolta avrà gli elementi non più di dieci.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="fb4d8-268">Per ogni riga il `ProductID` acquisizione dal `DataKeys` raccolta e appropriato `ProductsRow` viene selezionato dal `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="fb4d8-269">I quattro controlli di input TemplateField fanno riferimento a livello di codice e i relativi valori assegnati al `ProductsRow` s delle proprietà dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="fb4d8-270">Dopo ogni GridView sono stati utilizzati i valori di riga o le righe per aggiornare il `ProductsDataTable`, è s passato a s BLL `UpdateWithTransaction` metodo che, come illustrato nell'esercitazione precedente, chiama semplicemente verso il basso in oggetti DAL `UpdateWithTransaction` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="fb4d8-271">L'algoritmo di aggiornamento batch utilizzato per questa esercitazione Aggiorna ogni riga nel `ProductsDataTable` che corrisponde a una riga in GridView, indipendentemente dal fatto che le informazioni sul prodotto s è stati modificati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="fb4d8-272">Anche se tali aggiornamenti non vedenti non sono in genere un problema di prestazioni, se si ri il controllo viene modificata alla tabella di database può causare ai record superfluo.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="fb4d8-273">Nel [esecuzione di aggiornamenti Batch](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) esercitazione abbiamo esplorato un batch di aggiornamento dell'interfaccia con DataList e avere aggiunto il codice che aggiorna solo i record che sono stati effettivamente modificati dall'utente.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="fb4d8-274">È possibile usare le tecniche da [esecuzione di aggiornamenti Batch](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) per aggiornare il codice in questa esercitazione, se lo si desidera.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4d8-275">Quando si associa l'origine dati a GridView mediante relativo smart tag, Visual Studio assegna automaticamente i valori di chiave primaria di origine s dei dati a GridView s `DataKeyNames` proprietà.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="fb4d8-276">Se non è stato associato ObjectDataSource di GridView tramite lo smart tag s di GridView come descritto nel passaggio 1, quindi è necessario impostare manualmente la s GridView `DataKeyNames` proprietà ProductID per poter accedere il `ProductID` valore per ogni riga tramite il `DataKeys` raccolta.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="fb4d8-277">Il codice usato nel `BatchUpdate` è simile a quella usata in s BLL `UpdateProduct` metodi, la differenza principale è che nel `UpdateProduct` metodi solo una singola `ProductRow` istanza viene recuperata dall'architettura.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="fb4d8-278">Il codice che assegna la proprietà del `ProductRow` è lo stesso tra il `UpdateProducts` metodi e il codice all'interno di `foreach` ciclo nella `BatchUpdate`, poiché è il modello nel suo complesso.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `foreach` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="fb4d8-279">Per completare questa esercitazione, è necessario disporre di `BatchUpdate` metodo richiamato quando si fa clic su uno dei pulsanti di aggiornamenti dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="fb4d8-280">Creare gestori eventi per il `Click` gli eventi di questi due controlli pulsante e aggiungere il codice seguente nei gestori eventi:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample6.cs)]

<span data-ttu-id="fb4d8-281">Prima di tutto viene effettuata una chiamata a `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="fb4d8-282">Successivamente, il `ClientScript property` consente di inserire codice JavaScript che verrà visualizzata una finestra di messaggio che legge i prodotti sono stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-282">Next, the `ClientScript property` is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="fb4d8-283">Richiedere un minuto per testare questo codice.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-283">Take a minute to test out this code.</span></span> <span data-ttu-id="fb4d8-284">Visitare `BatchUpdate.aspx` tramite un browser, modificare un numero di righe e fare clic su uno dei pulsanti di aggiornamenti dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="fb4d8-285">Supponendo che non siano presenti errori di convalida dell'input, verrà visualizzata una finestra di messaggio che legge che i prodotti sono stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="fb4d8-286">Per verificare l'atomicità dell'aggiornamento, è consigliabile aggiungere uno casuale `CHECK` vincolo, ad esempio una che non consente `UnitPrice` 1234,56 ai valori.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="fb4d8-287">Quindi dal `BatchUpdate.aspx`, modificare un numero di record, assicurandosi di impostare uno del prodotto s `UnitPrice` al valore non consentito (1234,56).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="fb4d8-288">Questo dovrebbe restituire un errore quando facendo clic su aggiornamenti dei prodotti con le altre modifiche durante l'operazione batch eseguito il rollback sui valori originali.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="fb4d8-289">Un'alternativa`BatchUpdate`(metodo)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="fb4d8-290">Il `BatchUpdate` metodo viene semplicemente esaminata recupera *tutte* dei prodotti da s BLL `GetProducts` (metodo) e quindi aggiorna solo i record che vengono visualizzati in GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="fb4d8-291">Questo approccio è ideale se il controllo GridView non usa il paging, ma in tal caso, potrebbero esserci centinaia, migliaia o decine di migliaia di prodotti, ma solo dieci righe in GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="fb4d8-292">In tal caso, ottenere tutti i prodotti dal database solo per modificare 10 dei quali è inferiore a quello ideale.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="fb4d8-293">Per i tipi di situazioni, è consigliabile usare quanto segue `BatchUpdateAlternate` metodo invece:</span><span class="sxs-lookup"><span data-stu-id="fb4d8-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample7.cs)]

<span data-ttu-id="fb4d8-294">`BatchMethodAlternate` inizia creando una nuova classe vuota `ProductsDataTable` denominato `products`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="fb4d8-295">Viene quindi i passaggi a s GridView `Rows` raccolta e per ogni riga Ottiene le informazioni di prodotto specifico usando il livello BLL s `GetProductByProductID(productID)` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="fb4d8-296">Recuperato `ProductsRow` istanza ha le relative proprietà aggiornate nello stesso modo come `BatchUpdate`, ma dopo aver aggiornato la riga viene importato nelle `products``ProductsDataTable` tramite gli oggetti DataTable [ `ImportRow(DataRow)` metodo](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products``ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="fb4d8-297">Dopo il `foreach` ciclo viene completato, `products` contiene uno `ProductsRow` istanza per ogni riga in GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-297">After the `foreach` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="fb4d8-298">Poiché ogni del `ProductsRow` istanze sono state aggiunte ad il `products` (invece di aggiornato), se si passa alla cieca per il `UpdateWithTransaction` (metodo) il `ProductsTableAdapter` tenterà di inserire ogni record nel database.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="fb4d8-299">In alternativa, è necessario specificare che ognuna di queste righe è stata modificata (non aggiunto).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="fb4d8-300">Ciò può essere eseguita aggiungendo un nuovo metodo per il livello BLL denominato `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="fb4d8-301">`UpdateProductsWithTransaction`, set mostrato di seguito, il `RowState` della ognuno del `ProductsRow` istanze nel `ProductsDataTable` a `Modified` e quindi passa il `ProductsDataTable` ai dispositivi DAL `UpdateWithTransaction` (metodo).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample8.cs)]

## <a name="summary"></a><span data-ttu-id="fb4d8-302">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="fb4d8-302">Summary</span></span>

<span data-ttu-id="fb4d8-303">Il controllo GridView offre funzionalità di modifica predefinito per ogni riga, ma manca il supporto per la creazione di interfacce interamente modificabili.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="fb4d8-304">Come abbiamo visto in questa esercitazione, queste interfacce sono possibili, ma richiedono un po' di lavoro.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="fb4d8-305">Per creare un controllo GridView in cui ogni riga è modificabile, è necessario convertire i campi s GridView in TemplateFields e definire l'interfaccia di modifica all'interno di `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="fb4d8-306">Inoltre, aggiornare tutti i - tipo di controlli Web pulsante deve essere aggiunto alla pagina, separata da GridView.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="fb4d8-307">Questi pulsanti `Click` gestori eventi è necessario enumerare i dispositivi di GridView `Rows` insieme, archiviare le modifiche in un `ProductsDataTable`e passare le informazioni aggiornate relative al metodo BLL appropriato.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="fb4d8-308">Nella prossima esercitazione vedremo come creare un'interfaccia per l'eliminazione di batch.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="fb4d8-309">In particolare, ogni riga GridView verrà includono una casella di controllo e invece di aggiornare tutti-tipo di pulsanti, avremo pulsanti Elimina le righe selezionate.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="fb4d8-310">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="fb4d8-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="fb4d8-311">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="fb4d8-311">About the Author</span></span>

<span data-ttu-id="fb4d8-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette libri e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha collaborato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fb4d8-313">Lavora come un consulente, formatore e autore.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fb4d8-314">Il suo ultimo libro si intitola [ *Sams Teach Yourself ASP.NET 2.0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="fb4d8-315">È possibile contattarlo al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="fb4d8-316">o sul suo blog, che è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="fb4d8-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="fb4d8-317">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="fb4d8-317">Special Thanks To</span></span>

<span data-ttu-id="fb4d8-318">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fb4d8-319">I revisori per questa esercitazione sono state Teresa Murphy e David Suru.</span><span class="sxs-lookup"><span data-stu-id="fb4d8-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="fb4d8-320">Se si è interessati prossimi articoli MSDN dello?</span><span class="sxs-lookup"><span data-stu-id="fb4d8-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fb4d8-321">In questo caso, Inviami una riga in corrispondenza [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="fb4d8-322">[Precedente](wrapping-database-modifications-within-a-transaction-cs.md)
> [Successivo](batch-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="fb4d8-322">[Previous](wrapping-database-modifications-within-a-transaction-cs.md)
[Next](batch-deleting-cs.md)</span></span>
