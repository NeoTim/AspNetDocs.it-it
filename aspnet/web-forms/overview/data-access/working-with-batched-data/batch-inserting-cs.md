---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Batch di inserimento (c#) | Microsoft Docs
author: rick-anderson
description: Informazioni su come inserire più record di database in un'unica operazione. Il Layer dell'interfaccia utente estende il controllo GridView per consentire all'utente di immettere più di n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: afcfc92b4e0db8092f83b67c6c227af91bdc0cbb
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/25/2019
ms.locfileid: "58426049"
---
<a name="batch-inserting-c"></a><span data-ttu-id="0cb69-104">Inserimento batch (C#)</span><span class="sxs-lookup"><span data-stu-id="0cb69-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="0cb69-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0cb69-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0cb69-106">[Scaricare il codice](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) o [Scarica il PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0cb69-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="0cb69-107">Informazioni su come inserire più record di database in un'unica operazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="0cb69-108">Il Layer dell'interfaccia utente estende il controllo GridView per consentire all'utente di immettere più nuovi record.</span><span class="sxs-lookup"><span data-stu-id="0cb69-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="0cb69-109">Nel livello di accesso ai dati è eseguire il wrapping di più operazioni di inserimento all'interno di una transazione per garantire che tutti gli inserimenti di esito positivo o vengano eseguito il rollback di tutti gli inserimenti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="0cb69-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="0cb69-110">Introduction</span></span>

<span data-ttu-id="0cb69-111">Nel [l'aggiornamento Batch](batch-updating-cs.md) esercitazione è stata esaminata la personalizzazione del controllo GridView per presentare un'interfaccia in cui è stato modificabile più record.</span><span class="sxs-lookup"><span data-stu-id="0cb69-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="0cb69-112">L'utente visitando la pagina è stato possibile eseguire una serie di modifiche e quindi, con un singolo clic del pulsante, eseguire un aggiornamento batch.</span><span class="sxs-lookup"><span data-stu-id="0cb69-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="0cb69-113">Per situazioni in cui gli utenti in genere aggiornano numero di record in un'unica operazione, tale interfaccia consente di risparmiare moltissime clic e commutazioni di contesto della tastiera-a-del mouse rispetto all'impostazione predefinita le funzionalità di modifica che prima sono state esplorate in ogni riga di [un Panoramica di inserimento, aggiornamento ed eliminazione di dati](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="0cb69-114">Questo concetto può essere applicato anche quando si aggiungono i record.</span><span class="sxs-lookup"><span data-stu-id="0cb69-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="0cb69-115">Si supponga che in questo caso di Northwind Traders è comunemente ricevere le spedizioni di fornitori che contengono un numero di prodotti per una determinata categoria.</span><span class="sxs-lookup"><span data-stu-id="0cb69-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="0cb69-116">Ad esempio, potrebbe essere riceviamo una spedizione di sei tè diverso e i prodotti di caffè Traders Tokyo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="0cb69-117">Se un utente immette le sei prodotti uno alla volta tramite un controllo DetailsView, dovrà scegliere molti degli stessi valori in modo continuativo: sarà necessario scegliere la categoria stessa (bevande), il fornitore stesso (Tokyo Traders), lo stesso non più disponibili (valore False) e le stesse unità sul valore dell'ordine (0).</span><span class="sxs-lookup"><span data-stu-id="0cb69-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="0cb69-118">Questa voce dati ripetitivi non solo può richiedere molto tempo, ma è soggetta a errori.</span><span class="sxs-lookup"><span data-stu-id="0cb69-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="0cb69-119">Con qualche operazione è possibile creare un batch di inserimento dell'interfaccia che consente all'utente di scegliere il fornitore e la categoria una sola volta, immettere una serie di nomi di prodotto e prezzo unitario minore e quindi fare clic su un pulsante per aggiungere i nuovi prodotti per il database (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="0cb69-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="0cb69-120">Poiché viene aggiunto ciascun prodotto, relativi `ProductName` e `UnitPrice` i campi dati vengono assegnati i valori immessi nelle caselle di testo, mentre relativo `CategoryID` e `SupplierID` valori vengono assegnati i valori dai controlli DropDownList nel fo superiore il form.</span><span class="sxs-lookup"><span data-stu-id="0cb69-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="0cb69-121">Il `Discontinued` e `UnitsOnOrder` valori vengono impostati sui valori impostati come hardcoded di `false` e 0, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="0cb69-122">[![L'interfaccia di inserimento Batch](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="0cb69-123">**Figura 1**: L'interfaccia di inserimento Batch ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="0cb69-124">In questa esercitazione si creerà una pagina che implementa il batch di inserimento interfaccia illustrata nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="0cb69-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="0cb69-125">Come con le due esercitazioni precedenti, si eseguirà il wrapping di operazioni di inserimento all'interno dell'ambito di una transazione per garantire l'atomicità.</span><span class="sxs-lookup"><span data-stu-id="0cb69-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="0cb69-126">Introduzione a ti permettono di s.</span><span class="sxs-lookup"><span data-stu-id="0cb69-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="0cb69-127">Passaggio 1: Creazione dell'interfaccia di visualizzazione</span><span class="sxs-lookup"><span data-stu-id="0cb69-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="0cb69-128">Questa esercitazione sarà costituito da una singola pagina che viene suddiviso in due aree: un'area di visualizzazione e un'area di inserimento.</span><span class="sxs-lookup"><span data-stu-id="0cb69-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="0cb69-129">L'interfaccia di visualizzazione, che verrà creato in questo passaggio, vengono indicati i prodotti in un controllo GridView e include un pulsante denominato processo di spedizione del prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="0cb69-130">Quando si seleziona questo pulsante, l'interfaccia di visualizzazione viene sostituito con l'interfaccia di inserimento, come illustrato nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="0cb69-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="0cb69-131">Restituisce l'interfaccia di visualizzazione dopo i prodotti aggiungere dalla spedizione o si fa clic sul pulsanti Annulla.</span><span class="sxs-lookup"><span data-stu-id="0cb69-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="0cb69-132">L'interfaccia di inserimento verrà creato nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0cb69-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="0cb69-133">Durante la creazione di una pagina che ha due interfacce, solo uno dei quali è visibile alla volta, ogni interfaccia viene generalmente inserito all'interno di un [controllo pannello Web](http://www.w3schools.com/aspnet/control_panel.asp), che funge da contenitore per altri controlli.</span><span class="sxs-lookup"><span data-stu-id="0cb69-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="0cb69-134">Pertanto, la pagina avrà due controlli di pannello uno per ogni interfaccia.</span><span class="sxs-lookup"><span data-stu-id="0cb69-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="0cb69-135">Iniziare aprendo il `BatchInsert.aspx` nella pagina di `BatchData` cartelle e trascinare un pannello dalla casella degli strumenti nella finestra di progettazione (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="0cb69-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="0cb69-136">Impostare il pannello s `ID` proprietà `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="0cb69-137">Quando si aggiunge il pannello per la finestra di progettazione, relativi `Height` e `Width` proprietà vengono impostate su 50 px e 125px, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="0cb69-138">Cancellare le valori delle proprietà dalla finestra Proprietà.</span><span class="sxs-lookup"><span data-stu-id="0cb69-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="0cb69-139">[![Trascinare un pannello dalla casella degli strumenti nella finestra di progettazione](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="0cb69-140">**Figura 2**: Trascinare un pannello dalla casella degli strumenti nella finestra di progettazione ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="0cb69-141">Successivamente, trascinare un controllo pulsante e GridView nella casella di gruppo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="0cb69-142">Impostare il pulsante s `ID` proprietà `ProcessShipment` e il relativo `Text` proprietà processo di spedizione del prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="0cb69-143">Impostare la s GridView `ID` proprietà `ProductsGrid` e, dal suo smart tag, associarlo a un nuovo oggetto ObjectDataSource denominato `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="0cb69-144">Configurare ObjectDataSource per estrarre i dati dal `ProductsBLL` classe s `GetProducts` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0cb69-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="0cb69-145">Poiché questo controllo GridView è utilizzato solo per visualizzare i dati, impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="0cb69-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="0cb69-146">Fare clic su Fine per completare la procedura guidata Configura origine dati.</span><span class="sxs-lookup"><span data-stu-id="0cb69-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="0cb69-147">[![Visualizzare i dati restituiti dal metodo GetProducts ProductsBLL classe s](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="0cb69-148">**Figura 3**: Visualizzare i dati restituiti dai `ProductsBLL` classe s `GetProducts` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="0cb69-149">[![Impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare schede su (nessuno)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="0cb69-150">**Figura 4**: Impostare l'elenco a discesa sono elencati nell'aggiornamento, inserimento ed eliminare schede su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="0cb69-151">Dopo aver completato la procedura guidata ObjectDataSource, Visual Studio aggiungerà BoundField e un CampoCasellaDiControllo per i campi di dati del prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="0cb69-152">Rimuovi tutto tranne le `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, e `Discontinued` campi.</span><span class="sxs-lookup"><span data-stu-id="0cb69-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="0cb69-153">È possibile apportare le eventuali personalizzazioni estetiche.</span><span class="sxs-lookup"><span data-stu-id="0cb69-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="0cb69-154">Ho deciso di formattare la `UnitPrice` campo come valore di valuta, riordinare i campi e rinominato vari campi `HeaderText` valori.</span><span class="sxs-lookup"><span data-stu-id="0cb69-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="0cb69-155">Configurare anche il controllo GridView per includere il paging e ordinamento supporto selezionando le caselle di controllo Attiva Paging e abilitare l'ordinamento nello smart tag s GridView.</span><span class="sxs-lookup"><span data-stu-id="0cb69-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="0cb69-156">Dopo aver aggiunto i controlli di pannello, pulsante, GridView e ObjectDataSource e personalizzare i campi s GridView, il markup dichiarativo pagina s dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0cb69-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="0cb69-157">Si noti che il markup per il pulsante e GridView visualizzate all'interno di apertura e chiusura `<asp:Panel>` tag.</span><span class="sxs-lookup"><span data-stu-id="0cb69-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="0cb69-158">Poiché questi controlli si trovano all'interno di `DisplayInterface` pannello, è possibile nasconderle impostando semplicemente il pannello s `Visible` proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="0cb69-159">Passaggio 3 illustra a livello di codice modifica il pannello s `Visible` fare clic su proprietà in risposta a un pulsante per visualizzare un'interfaccia, nascondendo l'altro.</span><span class="sxs-lookup"><span data-stu-id="0cb69-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="0cb69-160">Si consiglia di visualizzare lo stato di avanzamento tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="0cb69-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="0cb69-161">Come illustrato nella figura 5, verrà visualizzato un pulsante di spedizione del prodotto processo sopra un controllo GridView in cui sono elencati i prodotti dieci alla volta.</span><span class="sxs-lookup"><span data-stu-id="0cb69-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="0cb69-162">[![Il controllo GridView sono elencati i prodotti e offre l'ordinamento e Paging funzionalità](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="0cb69-163">**Figura 5**: Il controllo GridView sono elencati i prodotti e offre l'ordinamento e Paging funzionalità ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="0cb69-164">Passaggio 2: Creazione dell'interfaccia di inserimento</span><span class="sxs-lookup"><span data-stu-id="0cb69-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="0cb69-165">Con l'interfaccia di visualizzazione completa, sono pronti per creare l'inserimento di interfaccia.</span><span class="sxs-lookup"><span data-stu-id="0cb69-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="0cb69-166">Per questa esercitazione, lasciare s creare un'interfaccia di inserimento che richiede un singolo valore di fornitore e la categoria e quindi consente all'utente di immettere fino a cinque nomi di prodotto e i valori di unità di prezzo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="0cb69-167">Con questa interfaccia, l'utente può aggiungere uno a cinque nuovi prodotti che condividono la stessa categoria e il fornitore, ma i prezzi e i nomi di prodotto univoche.</span><span class="sxs-lookup"><span data-stu-id="0cb69-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="0cb69-168">Inizio trascinando un riquadro dalla casella degli strumenti nella finestra di progettazione, posizionandolo sotto l'oggetto esistente `DisplayInterface` pannello.</span><span class="sxs-lookup"><span data-stu-id="0cb69-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="0cb69-169">Impostare il `ID` pannello da appena aggiunta di proprietà di questo `InsertingInterface` e impostare relativo `Visible` proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="0cb69-170">Si aggiungerà codice che imposta la `InsertingInterface` pannello s `Visible` proprietà `true` nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0cb69-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="0cb69-171">Anche cancellare il pannello 1!s `Height` e `Width` i valori delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="0cb69-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="0cb69-172">Successivamente, è necessario creare l'interfaccia di inserimento che è stato illustrato nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="0cb69-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="0cb69-173">Questa interfaccia può essere creata tramite una serie di tecniche HTML, ma si userà uno piuttosto semplice: una tabella con sette righe e quattro colonne.</span><span class="sxs-lookup"><span data-stu-id="0cb69-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="0cb69-174">Durante l'immissione di markup HTML `<table>` elementi, è preferibile utilizzare la vista dell'origine.</span><span class="sxs-lookup"><span data-stu-id="0cb69-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="0cb69-175">Anche se Visual Studio dispone di strumenti per l'aggiunta `<table>` elementi tramite la finestra di progettazione, la finestra di progettazione sembra tutto troppo disposto a inserire non richiesto non desiderato per `style` impostazioni nel markup.</span><span class="sxs-lookup"><span data-stu-id="0cb69-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="0cb69-176">Dopo aver creato il `<table>` markup, è in genere possibile tornare alla finestra di progettazione per aggiungere i controlli Web e impostare le relative proprietà.</span><span class="sxs-lookup"><span data-stu-id="0cb69-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="0cb69-177">Durante la creazione di tabelle con righe e colonne predeterminate preferisco utilizzare il codice HTML statico invece [controllo tabella Web](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) perché i controlli Web posizionati all'interno di un controllo tabella Web sono accessibile solo tramite il `FindControl("controlID")` pattern.</span><span class="sxs-lookup"><span data-stu-id="0cb69-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="0cb69-178">, Tuttavia, usare i controlli Web di tabella per le tabelle di dimensioni in modo dinamico (quelli cui righe o colonne basate su alcuni database o i criteri specificati dall'utente), da tabella Web controllo può essere creato a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="0cb69-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="0cb69-179">Immettere il seguente codice all'interno di `<asp:Panel>` tag del `InsertingInterface` pannello:</span><span class="sxs-lookup"><span data-stu-id="0cb69-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="0cb69-180">Ciò `<table>` markup non include tutti i controlli Web ancora, aggiungiamo, quindi quelli momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="0cb69-181">Si noti che ogni `<tr>` elemento contiene una particolare impostazione classe CSS: `BatchInsertHeaderRow` per la riga di intestazione in cui verrà salvato il fornitore e la categoria controlli DropDownList; `BatchInsertFooterRow` per la riga di piè di pagina in cui i prodotti aggiungere da pulsanti Annulla e spedizione passerà; e alterne `BatchInsertRow` e `BatchInsertAlternatingRow` valori per le righe che conterranno il prodotto e unit price controlli casella di testo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="0cb69-182">Ho creato classi CSS corrispondenti nel `Styles.css` file per dare un aspetto simile a GridView e DetailsView di interfaccia di inserimento controlla si va usato in queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="0cb69-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="0cb69-183">Queste classi CSS vengono visualizzate sotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="0cb69-184">Con questo tag inseriti, tornare alla visualizzazione progettazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="0cb69-185">Ciò `<table>` dovrà essere visualizzato in una tabella di quattro colonne, righe e sette nella finestra di progettazione, come illustrato nella figura 6.</span><span class="sxs-lookup"><span data-stu-id="0cb69-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="0cb69-186">[![L'interfaccia di inserimento è costituito da quattro-di una colonna nella tabella sette righe](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="0cb69-187">**Figura 6**: L'interfaccia di inserimento è costituito da quattro-di una colonna nella tabella sette righe ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="0cb69-188">È nuovamente ora pronti per aggiungere i controlli Web per l'interfaccia di inserimento.</span><span class="sxs-lookup"><span data-stu-id="0cb69-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="0cb69-189">Trascinare due controlli DropDownList dalla casella degli strumenti nelle celle della tabella per il fornitore e uno per la categoria appropriate.</span><span class="sxs-lookup"><span data-stu-id="0cb69-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="0cb69-190">Impostare il fornitore s DropDownList `ID` proprietà `Suppliers` e associarlo a un nuovo oggetto ObjectDataSource denominato `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="0cb69-191">Configurare il nuovo oggetto ObjectDataSource per recuperare i dati dal `SuppliersBLL` classe s `GetSuppliers` (metodo) e impostare l'aggiornamento scheda elenco a discesa s su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="0cb69-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="0cb69-192">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0cb69-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="0cb69-193">[![Configurare ObjectDataSource per usare il metodo GetSuppliers SuppliersBLL classe s](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="0cb69-194">**Figura 7**: Configurare ObjectDataSource per usare la `SuppliersBLL` classe s `GetSuppliers` metodo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="0cb69-195">Dispone il `Suppliers` DropDownList visualizzato il `CompanyName` campo dati e utilizzare il `SupplierID` datové pole come relativo `ListItem` valori s.</span><span class="sxs-lookup"><span data-stu-id="0cb69-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="0cb69-196">[![Visualizzare il campo dati CompanyName e utilizzare SupplierID come valore](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="0cb69-197">**Figura 8**: Visualizzazione di `CompanyName` campo dati e utilizzare `SupplierID` come valore ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="0cb69-198">Denominare il secondo controllo DropDownList `Categories` e associarlo a un nuovo oggetto ObjectDataSource denominato `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="0cb69-199">Configurare il `CategoriesDataSource` ObjectDataSource per usare il `CategoriesBLL` classe s `GetCategories` (metodo), impostare l'elenco a discesa Elenca le schede di aggiornamento ed eliminazione su (nessuno) e fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="0cb69-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="0cb69-200">Infine, include la visualizzazione del controllo DropDownList il `CategoryName` campo dati e l'utilizzo di `CategoryID` come valore.</span><span class="sxs-lookup"><span data-stu-id="0cb69-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="0cb69-201">Dopo questi due controlli DropDownList sono stati aggiunti e associato a ObjectDataSource configurato in modo appropriato, la schermata dovrebbe essere simile alla figura 9.</span><span class="sxs-lookup"><span data-stu-id="0cb69-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="0cb69-202">[![La riga di intestazione contiene ora i fornitori e i controlli DropDownList categorie](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="0cb69-203">**Figura 9**: L'intestazione di riga contiene ora il `Suppliers` e `Categories` controlli DropDownList ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="0cb69-204">È ora necessario creare le caselle di testo per raccogliere il nome e il prezzo per ogni nuovo prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="0cb69-205">Trascinare un controllo casella di testo dalla casella degli strumenti nella finestra di progettazione per ognuna delle righe di nome e il prezzo del cinque prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="0cb69-206">Impostare il `ID` delle proprietà delle caselle di testo al `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`e così via.</span><span class="sxs-lookup"><span data-stu-id="0cb69-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="0cb69-207">Aggiungere un controllo CompareValidator dopo ognuno del prezzo unitario delle caselle di testo, impostando il `ControlToValidate` proprietà appropriata `ID`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="0cb69-208">Impostare anche il `Operator` proprietà `GreaterThanEqual`, `ValueToCompare` su 0, e `Type` a `Currency`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="0cb69-209">Queste impostazioni indicano il controllo CompareValidator per garantire che il prezzo, se inserito, è un valore di valuta validi che è maggiore o uguale a zero.</span><span class="sxs-lookup"><span data-stu-id="0cb69-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="0cb69-210">Impostare il `Text` proprietà \*, e `ErrorMessage` al prezzo deve essere maggiore o uguale a zero.</span><span class="sxs-lookup"><span data-stu-id="0cb69-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="0cb69-211">Inoltre, per omettere qualsiasi simbolo di valuta.</span><span class="sxs-lookup"><span data-stu-id="0cb69-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="0cb69-212">L'interfaccia di inserimento non include tutti i controlli RequiredFieldValidator, anche se il `ProductName` campo le `Products` tabella di database non consente `NULL` valori.</span><span class="sxs-lookup"><span data-stu-id="0cb69-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="0cb69-213">Questo avviene perché si vuole consentire all'utente di immettere fino a cinque prodotti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="0cb69-214">Ad esempio, se l'utente per fornire il prodotto nome e il prezzo unitario per le prime tre righe, se si lascia vuoto, le ultime due righe d aggiungiamo tre nuovi prodotti per il sistema.</span><span class="sxs-lookup"><span data-stu-id="0cb69-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="0cb69-215">Poiché `ProductName` è obbligatorio, tuttavia, è necessario controllare a livello di codice per garantire che, se un prezzo unitario viene immesso viene fornito un valore di nome prodotto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="0cb69-216">Che verranno affrontati in questo controllo nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0cb69-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="0cb69-217">Durante la convalida dell'input utente s, il controllo CompareValidator segnala i dati non è validi se il valore contiene un simbolo di valuta.</span><span class="sxs-lookup"><span data-stu-id="0cb69-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="0cb69-218">Aggiungere un simbolo $ davanti a ogni il prezzo unitario delle caselle di testo come un segnale visivo che chiede all'utente di omettere il simbolo di valuta, quando si immette il prezzo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="0cb69-219">Infine, aggiungere un controllo di controllo ValidationSummary all'interno la `InsertingInterface` pannello impostazioni relativo `ShowMessageBox` proprietà `true` e la relativa `ShowSummary` proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="0cb69-220">Con queste impostazioni, se l'utente immette un valore del prezzo unitario non valido, verrà visualizzato un asterisco accanto i controlli TextBox che causa l'errore e di controllo ValidationSummary visualizzerà una finestra di messaggio sul lato client, che mostra il messaggio di errore che è specificati in precedenza.</span><span class="sxs-lookup"><span data-stu-id="0cb69-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="0cb69-221">A questo punto, la schermata dovrebbe essere simile alla figura 10.</span><span class="sxs-lookup"><span data-stu-id="0cb69-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="0cb69-222">[![L'interfaccia inserimento ora include caselle di testo per i prodotti i nomi e i prezzi](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="0cb69-223">**Figura 10**: Inserimento di interfaccia ora include caselle di testo per i nomi di prodotti e i prezzi ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="0cb69-224">È necessario aggiungere i prodotti aggiungere dai pulsanti Annulla e spedizione per la riga di piè di pagina successiva.</span><span class="sxs-lookup"><span data-stu-id="0cb69-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="0cb69-225">Trascinare due controlli pulsante dalla casella degli strumenti nel piè di pagina dell'interfaccia di inserimento, impostare i pulsanti `ID` delle proprietà per `AddProducts` e `CancelButton` e `Text` proprietà aggiungere prodotti dalla spedizione e Annulla, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="0cb69-226">Inoltre, impostare il `CancelButton` controllo s `CausesValidation` proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="0cb69-227">Infine, è necessario aggiungere un controllo etichetta Web che verrà visualizzati messaggi di stato per le due interfacce.</span><span class="sxs-lookup"><span data-stu-id="0cb69-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="0cb69-228">Ad esempio, quando completata, un utente aggiunge una nuova spedizione di prodotti, vogliamo tornare all'interfaccia di visualizzazione e visualizzare un messaggio di conferma.</span><span class="sxs-lookup"><span data-stu-id="0cb69-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="0cb69-229">Se, tuttavia, l'utente fornisce un prezzo per un nuovo prodotto, ma lascia disattivato il nome del prodotto, è necessario visualizzare un messaggio di avviso perché la `ProductName` campo è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="0cb69-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="0cb69-230">Poiché è necessario questo messaggio da visualizzare per entrambe le interfacce, inserirlo nella parte superiore della pagina di fuori i pannelli.</span><span class="sxs-lookup"><span data-stu-id="0cb69-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="0cb69-231">Trascinare un controllo etichetta Web dalla casella degli strumenti nella parte superiore della pagina nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="0cb69-232">Impostare il `ID` proprietà `StatusLabel`, deselezionare le il `Text` proprietà e impostare il `Visible` e `EnableViewState` le proprietà da `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="0cb69-233">Come abbiamo visto nelle esercitazioni precedenti, impostando il `EnableViewState` proprietà `false` consente di modificare i valori delle proprietà etichetta s a livello di codice e chiedere di automaticamente ripristinare i valori predefiniti nei postback successivi.</span><span class="sxs-lookup"><span data-stu-id="0cb69-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="0cb69-234">Ciò semplifica il codice per la visualizzazione di un messaggio di stato in risposta a un'azione utente che scompare nel postback successivi.</span><span class="sxs-lookup"><span data-stu-id="0cb69-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="0cb69-235">Infine, impostare il `StatusLabel` controllo s `CssClass` proprietà di avviso, ovvero il nome di una classe CSS definita in `Styles.css` che visualizza il testo in un tipo di carattere di grandi dimensioni, corsivo, grassetto e rosso.</span><span class="sxs-lookup"><span data-stu-id="0cb69-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="0cb69-236">Figura 11 mostra la progettazione di Visual Studio dopo l'etichetta è stato aggiunto e configurato.</span><span class="sxs-lookup"><span data-stu-id="0cb69-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="0cb69-237">[![Posizionare il controllo StatusLabel sopra i due controlli Panel](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="0cb69-238">**Figura 11**: Sul posto di `StatusLabel` controllo di sopra di due controlli di pannello ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="0cb69-239">Passaggio 3: Il passaggio tra la visualizzazione e l'inserimento di interfacce</span><span class="sxs-lookup"><span data-stu-id="0cb69-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="0cb69-240">A questo punto è stata completata il markup per la visualizzazione e inserire le interfacce, ma si ri rimasto con due attività:</span><span class="sxs-lookup"><span data-stu-id="0cb69-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="0cb69-241">Il passaggio tra la visualizzazione e l'inserimento di interfacce</span><span class="sxs-lookup"><span data-stu-id="0cb69-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="0cb69-242">Aggiunta di prodotti nella spedizione al database</span><span class="sxs-lookup"><span data-stu-id="0cb69-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="0cb69-243">Attualmente, l'interfaccia di visualizzazione è visibile ma l'interfaccia di inserimento è nascosto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="0cb69-244">Infatti il `DisplayInterface` pannello s `Visible` è impostata su `true` (valore predefinito), mentre il `InsertingInterface` pannello s `Visible` è impostata su `false`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="0cb69-245">Per passare tra le due interfacce, è sufficiente s ogni controllo Attiva/disattiva `Visible` valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="0cb69-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="0cb69-246">Si vuole spostare dall'interfaccia di visualizzazione all'interfaccia di inserimento quando si fa clic sul pulsante processo spedizione del prodotto.</span><span class="sxs-lookup"><span data-stu-id="0cb69-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="0cb69-247">Pertanto, creare un gestore eventi per questo pulsante s `Click` evento contenente il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="0cb69-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="0cb69-248">Questo codice consente semplicemente di nascondere il `DisplayInterface` pannello e Mostra il `InsertingInterface` pannello.</span><span class="sxs-lookup"><span data-stu-id="0cb69-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="0cb69-249">Successivamente, creare i gestori eventi per i prodotti aggiungere dai controlli di spedizione e pulsante Annulla nell'interfaccia di inserimento.</span><span class="sxs-lookup"><span data-stu-id="0cb69-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="0cb69-250">Quando viene scelto uno di questi pulsanti, è necessario ripristinare l'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="0cb69-251">Creare `Click` gestori eventi per i controlli pulsante in modo che chiamino `ReturnToDisplayInterface`, un metodo si aggiungeranno momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="0cb69-252">Oltre a nascondere il `InsertingInterface` pannello e che mostra il `DisplayInterface` Pannello di `ReturnToDisplayInterface` metodo deve restituire i controlli Web al rispettivo stato di pre-editing.</span><span class="sxs-lookup"><span data-stu-id="0cb69-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="0cb69-253">Ciò comporta l'impostazione di controlli DropDownList `SelectedIndex` delle proprietà su 0 e cancellare il `Text` proprietà dei controlli casella di testo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="0cb69-254">Si consideri cosa potrebbe accadere se si non ha restituito i controlli al rispettivo stato di pre-modifica prima di tornare all'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="0cb69-255">Un utente può fare clic sul pulsante di spedizione del prodotto processo, immettere i prodotti dalla spedizione e quindi fare clic su Aggiungi prodotti da spedizione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="0cb69-256">Ciò Aggiungi i prodotti e restituire l'utente all'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="0cb69-257">A questo punto l'utente potrebbe voler aggiungere un'altra spedizione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="0cb69-258">Fare clic sul pulsante di spedizione del prodotto processo che restituiscono l'interfaccia di inserimento, ma il controllo DropDownList su valori nella casella di testo e le selezioni verrebbe comunque popolati con i valori precedenti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="0cb69-259">Entrambe `Click` gestori eventi è sufficiente chiamare il `ReturnToDisplayInterface` metodo, anche se è necessario tornare a prodotti aggiungere dalla spedizione `Click` gestore dell'evento nel passaggio 4 e aggiungere il codice per salvare i prodotti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="0cb69-260">`ReturnToDisplayInterface` viene avviata restituendo il `Suppliers` e `Categories` controlli DropDownList per le prime opzioni.</span><span class="sxs-lookup"><span data-stu-id="0cb69-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="0cb69-261">Le due costanti `firstControlID` e `lastControlID` contrassegnare iniziali e finali usati nei nomi di prodotto nome e il prezzo unitario caselle di testo in cui l'inserimento dell'interfaccia e vengono usati entro i limiti di valori di indice di controllo di `for` ciclo che consente di impostare il `Text`eseguire il backup delle proprietà dei controlli casella di testo in una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="0cb69-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="0cb69-262">Infine, i pannelli `Visible` le proprietà vengono reimpostate in modo che l'interfaccia di inserimento è nascosto e l'interfaccia di visualizzazione mostrata.</span><span class="sxs-lookup"><span data-stu-id="0cb69-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="0cb69-263">Si consiglia di testare questa pagina in un browser.</span><span class="sxs-lookup"><span data-stu-id="0cb69-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="0cb69-264">Durante la prima visita la pagina verrà visualizzato l'interfaccia di visualizzazione come illustrato nella figura 5.</span><span class="sxs-lookup"><span data-stu-id="0cb69-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="0cb69-265">Fare clic sul pulsante di spedizione del prodotto processo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="0cb69-266">La pagina verrà postback e si noterà ora l'interfaccia di inserimento come illustrato nella figura 12.</span><span class="sxs-lookup"><span data-stu-id="0cb69-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="0cb69-267">Facendo clic su entrambi i prodotti aggiungere dai pulsanti di spedizione o Annulla viene nuovamente visualizzata la finestra di interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="0cb69-268">Mentre si visualizza l'interfaccia di inserimento, si consiglia di testare il CompareValidators sul prezzo unitario caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="0cb69-269">Verrà visualizzato un avviso quando si fa clic i prodotti aggiungere dal pulsante di spedizione con valori di valuta non è valido o i prezzi con un valore minore di zero oggetto messagebox lato client.</span><span class="sxs-lookup"><span data-stu-id="0cb69-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="0cb69-270">[![L'interfaccia di inserimento viene visualizzato dopo aver fatto clic sul pulsante di spedizione del prodotto processo](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="0cb69-271">**Figura 12**: L'interfaccia di inserimento viene visualizzato dopo aver fatto clic sul pulsante di spedizione del prodotto processo ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="0cb69-272">Passaggio 4: Aggiunta di prodotti</span><span class="sxs-lookup"><span data-stu-id="0cb69-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="0cb69-273">Tutto ciò che rimane per questa esercitazione consiste nel salvare i prodotti per il database nei prodotti aggiungere dal pulsante di spedizione s `Click` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="0cb69-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="0cb69-274">Questa operazione può essere eseguita mediante la creazione di un `ProductsDataTable` e l'aggiunta di un `ProductsRow` istanza per ognuno dei nomi di prodotto specificati.</span><span class="sxs-lookup"><span data-stu-id="0cb69-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="0cb69-275">Una volta queste `ProductsRow` s sono state aggiunte si effettuerà una chiamata per il `ProductsBLL` classe s `UpdateWithTransaction` metodo passando la `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="0cb69-276">Si tenga presente che il `UpdateWithTransaction` metodo, che è stato creato nel [wrapping delle modifiche al Database in una transazione](wrapping-database-modifications-within-a-transaction-cs.md) passaggi dell'esercitazione, il `ProductsDataTable` per il `ProductsTableAdapter` s `UpdateWithTransaction` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0cb69-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="0cb69-277">Da qui, viene avviata una transazione di ADO.NET e i problemi di TableAdapter un' `INSERT` istruzione per il database per ogni aggiunta `ProductsRow` nella DataTable.</span><span class="sxs-lookup"><span data-stu-id="0cb69-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="0cb69-278">Presupponendo che tutti i prodotti vengono aggiunti senza errori, che viene eseguito il commit della transazione, in caso contrario viene eseguito il rollback.</span><span class="sxs-lookup"><span data-stu-id="0cb69-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="0cb69-279">Il codice per i prodotti dal pulsante di spedizione s aggiungere `Click` gestore eventi deve anche eseguire una sorta di controllo degli errori.</span><span class="sxs-lookup"><span data-stu-id="0cb69-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="0cb69-280">Poiché non esistono Nessun RequiredFieldValidators utilizzato nell'interfaccia di inserimento, un utente può immettere un prezzo per un prodotto omettendo il relativo nome.</span><span class="sxs-lookup"><span data-stu-id="0cb69-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="0cb69-281">Poiché il nome di prodotto s è obbligatorio, se tale condizione espande è necessario avvisare l'utente e non procedere con gli inserimenti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="0cb69-282">L'intero `Click` codice del gestore eventi seguente:</span><span class="sxs-lookup"><span data-stu-id="0cb69-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="0cb69-283">Il gestore dell'evento viene avviato, verificare che il `Page.IsValid` proprietà restituisce un valore di `true`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="0cb69-284">Se il valore restituito `false`, quindi che significa che uno o più i CompareValidators segnalano i dati non è validi; in tal caso non si desidera tenta di inserire i prodotti immessi o si otterrà un'eccezione durante il tentativo di assegnare il prezzo unitario immesso dall'utente valore per il `ProductsRow` s `UnitPrice` proprietà.</span><span class="sxs-lookup"><span data-stu-id="0cb69-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="0cb69-285">Successivamente, una nuova `ProductsDataTable` creazione di istanza (`products`).</span><span class="sxs-lookup"><span data-stu-id="0cb69-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="0cb69-286">Oggetto `for` ciclo viene utilizzato per scorrere il nome e l'unità di prezzo del prodotto nelle caselle di testo e il `Text` delle proprietà vengono lette in variabili locali `productName` e `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="0cb69-287">Se l'utente ha immesso un valore per il prezzo unitario ma non per il nome del prodotto corrispondente, il `StatusLabel` consente di visualizzare il messaggio se si specifica un'unità di prezzo è inoltre necessario includere il nome del prodotto e il gestore dell'evento è terminato.</span><span class="sxs-lookup"><span data-stu-id="0cb69-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="0cb69-288">Se è stato fornito un nome di prodotto, una nuova `ProductsRow` istanza viene creata utilizzando la `ProductsDataTable` s `NewProductsRow` (metodo).</span><span class="sxs-lookup"><span data-stu-id="0cb69-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="0cb69-289">Questa nuova `ProductsRow` istanza s `ProductName` viene impostata per il prodotto corrente assegnare un nome nella casella di testo durante le `SupplierID` e `CategoryID` le proprietà vengono assegnate al `SelectedValue` le proprietà dei controlli di DropDownList nell'intestazione dell'interfaccia s inserimento.</span><span class="sxs-lookup"><span data-stu-id="0cb69-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="0cb69-290">Se l'utente ha immesso un valore per il prezzo del prodotto s, viene assegnato per il `ProductsRow` istanza s `UnitPrice` proprietà; in caso contrario, la proprietà è sinistra non assegnato, e di conseguenza un `NULL` value per `UnitPrice` nel database.</span><span class="sxs-lookup"><span data-stu-id="0cb69-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="0cb69-291">Infine, il `Discontinued` e `UnitsOnOrder` delle proprietà vengono assegnate ai valori impostati come hardcoded `false` e 0, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="0cb69-292">Dopo che le proprietà sono state assegnate al `ProductsRow` istanza viene aggiunto al `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="0cb69-293">Dopo aver completato la `for` ciclo, controlliamo se nessuno dei prodotti è stati aggiunti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="0cb69-294">L'utente potrebbe, dopotutto, hanno fatto clic su Aggiungi prodotti dalla spedizione prima di entrare in tutti i nomi dei prodotti o i prezzi.</span><span class="sxs-lookup"><span data-stu-id="0cb69-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="0cb69-295">Se è presente almeno un prodotto nel `ProductsDataTable`, il `ProductsBLL` classe s `UpdateWithTransaction` viene chiamato il metodo.</span><span class="sxs-lookup"><span data-stu-id="0cb69-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="0cb69-296">Successivamente, i dati sono riassociati per il `ProductsGrid` GridView in modo che i prodotti appena aggiunti verranno visualizzato nell'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="0cb69-297">Il `StatusLabel` viene aggiornato per visualizzare un messaggio di conferma e il `ReturnToDisplayInterface` viene richiamato, nascondendo l'inserimento di interfaccia e che mostra l'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="0cb69-298">Se prodotti non sono state immesse, l'interfaccia di inserimento è visualizzato ma il messaggio di che prodotti non sono stati aggiunti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="0cb69-299">Immettere i nomi di prodotto e prezzo unitario minore nelle caselle di testo viene visualizzato.</span><span class="sxs-lookup"><span data-stu-id="0cb69-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="0cb69-300">S figura 13, 14 e 15 mostrano l'inserimento e visualizzare le interfacce in azione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="0cb69-301">Nella figura 13, l'utente ha immesso un valore del prezzo unitario senza un nome di prodotto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="0cb69-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="0cb69-302">Figura 14 viene illustrata l'interfaccia di visualizzazione dopo tre nuovi prodotti sono stati aggiunti correttamente, sebbene nella figura 15 vengono illustrati due dei prodotti appena aggiunti in GridView (il terzo è nella pagina precedente).</span><span class="sxs-lookup"><span data-stu-id="0cb69-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="0cb69-303">[![Un nome di prodotto è obbligatorio quando immettendo un prezzo unitario](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="0cb69-304">**Figura 13**: Un nome di prodotto è obbligatorio quando immettendo un prezzo unitario ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="0cb69-305">[![Sono state aggiunte tre nuove Veggies per il fornitore Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="0cb69-306">**Figura 14**: Tre nuovi Veggies sono state aggiunte per s Mayumi Supplier ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="0cb69-307">[![I nuovi prodotti sono reperibili nell'ultima pagina di GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="0cb69-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="0cb69-308">**Figura 15**: I nuovi prodotti sono disponibili nell'ultima pagina di GridView ([fare clic per visualizzare l'immagine con dimensioni normali](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="0cb69-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="0cb69-309">Il batch di inserimento per la logica usata in questa esercitazione esegue il wrapping dei comandi di inserimento all'interno dell'ambito della transazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="0cb69-310">Per verificarlo, introdurrà intenzionalmente un errore a livello di database.</span><span class="sxs-lookup"><span data-stu-id="0cb69-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="0cb69-311">Ad esempio, invece di assegnare il nuovo `ProductsRow` istanza s `CategoryID` sul valore selezionato nel `Categories` DropDownList, assegnare un valore, ad esempio `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="0cb69-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="0cb69-312">Di seguito `i` è l'indicizzatore di ciclo e dispone di valori compreso tra 1 e 5.</span><span class="sxs-lookup"><span data-stu-id="0cb69-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="0cb69-313">Pertanto, quando l'aggiunta del prodotto prima di inserire due o più prodotti nel batch sarà valido `CategoryID` valore (5), ma i prodotti successivi avranno `CategoryID` i valori che non corrispondono fino a `CategoryID` i valori nel `Categories` tabella.</span><span class="sxs-lookup"><span data-stu-id="0cb69-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="0cb69-314">Il risultato finale è che mentre il primo `INSERT` avrà esito positivo, le successive avranno esito negativo con una violazione di vincolo di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="0cb69-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="0cb69-315">Poiché l'inserimento batch è atomico, il primo `INSERT` verrà rollback, restituendo il database sullo stato precedente processo di inserimento batch è iniziato.</span><span class="sxs-lookup"><span data-stu-id="0cb69-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="0cb69-316">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="0cb69-316">Summary</span></span>

<span data-ttu-id="0cb69-317">Su questa e le due esercitazioni precedenti abbiamo creato le interfacce che consentono l'aggiornamento, eliminazione, e l'inserimento batch di dati, ognuno dei quali usato il supporto delle transazioni viene aggiunto al livello di accesso ai dati nel [di wrapping delle modifiche del Database all'interno di una transazione](wrapping-database-modifications-within-a-transaction-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="0cb69-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="0cb69-318">Per alcuni scenari, tali interfacce utente per l'elaborazione batch migliorano notevolmente l'efficienza degli utenti finali riducendo il numero di clic, durante i postback e scambi di contesto al mouse di tastiera, pur mantenendo l'integrità dei dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="0cb69-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="0cb69-319">Questa esercitazione si completa l'esaminare l'uso con i dati in batch.</span><span class="sxs-lookup"><span data-stu-id="0cb69-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="0cb69-320">Il set successivo di esercitazioni illustra un'ampia gamma di scenari di livello di accesso ai dati avanzati, incluso l'uso di stored procedure i metodi TableAdapter s, configurazione delle impostazioni di connessione e comando livello DAL, la crittografia di stringhe di connessione e altro ancora!</span><span class="sxs-lookup"><span data-stu-id="0cb69-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="0cb69-321">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="0cb69-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0cb69-322">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="0cb69-322">About the Author</span></span>

<span data-ttu-id="0cb69-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette libri e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha collaborato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="0cb69-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0cb69-324">Lavora come un consulente, formatore e autore.</span><span class="sxs-lookup"><span data-stu-id="0cb69-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0cb69-325">Il suo ultimo libro si intitola [ *Sams Teach Yourself ASP.NET 2.0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="0cb69-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0cb69-326">È possibile contattarlo al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0cb69-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="0cb69-327">o sul suo blog, che è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="0cb69-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="0cb69-328">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="0cb69-328">Special Thanks To</span></span>

<span data-ttu-id="0cb69-329">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="0cb69-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0cb69-330">Portare i revisori per questa esercitazione sono state Hilton Giesenow e S ren Jacob Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="0cb69-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="0cb69-331">Se si è interessati prossimi articoli MSDN dello?</span><span class="sxs-lookup"><span data-stu-id="0cb69-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0cb69-332">In questo caso, Inviami una riga in corrispondenza [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0cb69-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0cb69-333">[Precedente](batch-deleting-cs.md)
> [Successivo](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0cb69-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
