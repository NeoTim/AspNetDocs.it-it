---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Inserimento batch (C#) | Microsoft Docs
author: rick-anderson
description: Informazioni su come inserire più record di database in un'unica operazione. Nel livello dell'interfaccia utente viene esteso il controllo GridView per consentire all'utente di immettere più n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 5dc4d0b6ac9bf3aa2baa54fe9f5d4149494e47d2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78618524"
---
# <a name="batch-inserting-c"></a><span data-ttu-id="5fe29-104">Inserimento batch (C#)</span><span class="sxs-lookup"><span data-stu-id="5fe29-104">Batch Inserting (C#)</span></span>

<span data-ttu-id="5fe29-105">di [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5fe29-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5fe29-106">[Scarica codice](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) o [Scarica PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5fe29-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="5fe29-107">Informazioni su come inserire più record di database in un'unica operazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="5fe29-108">Nel livello dell'interfaccia utente viene esteso il controllo GridView per consentire all'utente di immettere più record nuovi.</span><span class="sxs-lookup"><span data-stu-id="5fe29-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="5fe29-109">Nel livello di accesso ai dati si esegue il wrapping di più operazioni di inserimento all'interno di una transazione per garantire la riuscita di tutti gli inserimenti o il rollback di tutti gli inserimenti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="5fe29-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="5fe29-110">Introduction</span></span>

<span data-ttu-id="5fe29-111">Nell'esercitazione sull' [aggiornamento di batch](batch-updating-cs.md) è stata esaminata la personalizzazione del controllo GridView per presentare un'interfaccia in cui sono stati modificati più record.</span><span class="sxs-lookup"><span data-stu-id="5fe29-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="5fe29-112">L'utente che visita la pagina potrebbe apportare una serie di modifiche e quindi, con un solo clic del pulsante, eseguire un aggiornamento in batch.</span><span class="sxs-lookup"><span data-stu-id="5fe29-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="5fe29-113">Per le situazioni in cui gli utenti aggiornano in genere molti record in un'unica operazione, un'interfaccia di questo tipo può salvare innumerevoli clic e commutazioni di contesto da tastiera a mouse rispetto alle funzionalità di modifica per riga predefinite che sono state esaminate per la prima volta in [un'esercitazione panoramica sull'inserimento, l'aggiornamento e l'eliminazione dei dati](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="5fe29-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="5fe29-114">Questo concetto può essere applicato anche durante l'aggiunta di record.</span><span class="sxs-lookup"><span data-stu-id="5fe29-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="5fe29-115">Si supponga che in questo caso i commercianti Northwind ricevano in genere spedizioni da fornitori che contengono un certo numero di prodotti per una categoria specifica.</span><span class="sxs-lookup"><span data-stu-id="5fe29-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="5fe29-116">Ad esempio, si potrebbe ricevere una spedizione di sei diversi prodotti tè e caffè da Tokyo Traders.</span><span class="sxs-lookup"><span data-stu-id="5fe29-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="5fe29-117">Se un utente immette i sei prodotti uno alla volta tramite un controllo DetailsView, dovrà scegliere più volte gli stessi valori: dovranno scegliere la stessa categoria (bevande), lo stesso fornitore (Tokyo Traders), lo stesso valore non più disponibile ( False) e le stesse unità sul valore dell'ordine (0).</span><span class="sxs-lookup"><span data-stu-id="5fe29-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="5fe29-118">Questa immissione di dati ripetitivi non solo richiede molto tempo, ma è soggetta a errori.</span><span class="sxs-lookup"><span data-stu-id="5fe29-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="5fe29-119">Con un po' di lavoro, è possibile creare un'interfaccia di inserimento batch che consenta all'utente di scegliere una sola volta il fornitore e la categoria, immettere una serie di nomi di prodotto e prezzi unitari, quindi fare clic su un pulsante per aggiungere i nuovi prodotti al database (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="5fe29-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="5fe29-120">Man mano che viene aggiunto ogni prodotto, ai campi dati `ProductName` e `UnitPrice` vengono assegnati i valori immessi nelle caselle di testo, mentre ai relativi valori di `CategoryID` e `SupplierID` vengono assegnati i valori dei DropDownList nella parte superiore del form.</span><span class="sxs-lookup"><span data-stu-id="5fe29-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="5fe29-121">I valori `Discontinued` e `UnitsOnOrder` sono impostati sui valori hardcoded rispettivamente di `false` e 0.</span><span class="sxs-lookup"><span data-stu-id="5fe29-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>

<span data-ttu-id="5fe29-122">[![l'interfaccia di inserimento batch](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="5fe29-123">**Figura 1**: interfaccia di inserimento batch ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>

<span data-ttu-id="5fe29-124">In questa esercitazione verrà creata una pagina che implementa l'interfaccia di inserimento batch mostrata nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="5fe29-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="5fe29-125">Come per le due esercitazioni precedenti, gli inserimenti nell'ambito di una transazione vengono incapsulati per garantire l'atomicità.</span><span class="sxs-lookup"><span data-stu-id="5fe29-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="5fe29-126">Inizia subito.</span><span class="sxs-lookup"><span data-stu-id="5fe29-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="5fe29-127">Passaggio 1: creazione dell'interfaccia di visualizzazione</span><span class="sxs-lookup"><span data-stu-id="5fe29-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="5fe29-128">Questa esercitazione sarà costituita da una singola pagina divisa in due aree: un'area di visualizzazione e un'area di inserimento.</span><span class="sxs-lookup"><span data-stu-id="5fe29-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="5fe29-129">L'interfaccia di visualizzazione, che verrà creata in questo passaggio, Mostra i prodotti in un controllo GridView e include un pulsante denominato elabora spedizione prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="5fe29-130">Quando si fa clic su questo pulsante, l'interfaccia di visualizzazione viene sostituita con l'interfaccia di inserimento, mostrata nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="5fe29-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="5fe29-131">L'interfaccia di visualizzazione viene restituita dopo aver fatto clic sui pulsanti Aggiungi prodotti da spedizione o Annulla.</span><span class="sxs-lookup"><span data-stu-id="5fe29-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="5fe29-132">Verrà creata l'interfaccia di inserimento nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5fe29-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="5fe29-133">Quando si crea una pagina con due interfacce, solo una di queste è visibile alla volta, ogni interfaccia viene in genere inserita in un [controllo Web Panel](http://www.w3schools.com/aspnet/control_panel.asp), che funge da contenitore per altri controlli.</span><span class="sxs-lookup"><span data-stu-id="5fe29-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="5fe29-134">La pagina avrà pertanto due controlli Panel uno per ogni interfaccia.</span><span class="sxs-lookup"><span data-stu-id="5fe29-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="5fe29-135">Per iniziare, aprire la pagina `BatchInsert.aspx` nella cartella `BatchData` e trascinare un pannello dalla casella degli strumenti nella finestra di progettazione (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="5fe29-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="5fe29-136">Impostare la proprietà `ID` del pannello su `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="5fe29-137">Quando si aggiunge il pannello alla finestra di progettazione, le proprietà `Height` e `Width` sono impostate rispettivamente su 50px e 125px.</span><span class="sxs-lookup"><span data-stu-id="5fe29-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="5fe29-138">Cancellare questi valori di proprietà dal Finestra Proprietà.</span><span class="sxs-lookup"><span data-stu-id="5fe29-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="5fe29-139">[![trascinare un pannello dalla casella degli strumenti nella finestra di progettazione](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="5fe29-140">**Figura 2**: trascinare un pannello dalla casella degli strumenti nella finestra di progettazione ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>

<span data-ttu-id="5fe29-141">Trascinare quindi un pulsante e il controllo GridView nel pannello.</span><span class="sxs-lookup"><span data-stu-id="5fe29-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="5fe29-142">Impostare la proprietà `ID` Button su `ProcessShipment` e la relativa proprietà `Text` per elaborare la spedizione del prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="5fe29-143">Impostare la proprietà GridView s `ID` su `ProductsGrid` e, dal relativo smart tag, associarla a un nuovo ObjectDataSource denominato `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="5fe29-144">Configurare ObjectDataSource per eseguire il pull dei dati dal metodo `GetProducts` della classe `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="5fe29-145">Poiché questo controllo GridView viene usato solo per visualizzare i dati, impostare gli elenchi a discesa nelle schede UPDATE, INSERT e DELETE su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="5fe29-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="5fe29-146">Fare clic su fine per completare la configurazione guidata origine dati.</span><span class="sxs-lookup"><span data-stu-id="5fe29-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="5fe29-147">[![visualizzare i dati restituiti dal metodo ProductsBLL della classe s GetProducts](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="5fe29-148">**Figura 3**: visualizzare i dati restituiti dal metodo `GetProducts` della classe `ProductsBLL` ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>

<span data-ttu-id="5fe29-149">[![impostare gli elenchi a discesa nelle schede Aggiorna, Inserisci ed Elimina su (nessuno)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="5fe29-150">**Figura 4**: impostare gli elenchi a discesa nelle schede di aggiornamento, inserimento ed eliminazione su (nessuno) ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>

<span data-ttu-id="5fe29-151">Dopo aver completato la procedura guidata ObjectDataSource, Visual Studio aggiungerà BoundField e un oggetto CheckBoxField per i campi dati del prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="5fe29-152">Rimuovere tutti i campi tranne `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`e `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="5fe29-153">È possibile apportare personalizzazioni estetiche.</span><span class="sxs-lookup"><span data-stu-id="5fe29-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="5fe29-154">Ho deciso di formattare il campo `UnitPrice` come valore di valuta, riordinare i campi e rinominare molti dei campi `HeaderText` valori.</span><span class="sxs-lookup"><span data-stu-id="5fe29-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="5fe29-155">Configurare inoltre GridView per includere il supporto per il paging e l'ordinamento selezionando le caselle di controllo Abilita paging e Abilita ordinamento nello smart tag di GridView.</span><span class="sxs-lookup"><span data-stu-id="5fe29-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="5fe29-156">Dopo aver aggiunto i controlli Panel, Button, GridView e ObjectDataSource e aver personalizzato i campi di GridView, il markup dichiarativo della pagina deve essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="5fe29-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="5fe29-157">Si noti che il markup per il pulsante e GridView viene visualizzato all'interno dei tag `<asp:Panel>` di apertura e di chiusura.</span><span class="sxs-lookup"><span data-stu-id="5fe29-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="5fe29-158">Poiché questi controlli si trovano all'interno del pannello di `DisplayInterface`, è possibile nasconderli semplicemente impostando la proprietà del `Visible` del pannello su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="5fe29-159">Il passaggio 3 esamina la modifica a livello di codice della proprietà `Visible` del pannello in risposta a un pulsante facendo clic per visualizzare un'interfaccia mentre si nasconde l'altra.</span><span class="sxs-lookup"><span data-stu-id="5fe29-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="5fe29-160">Per visualizzare lo stato di avanzamento, è possibile usare un browser.</span><span class="sxs-lookup"><span data-stu-id="5fe29-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="5fe29-161">Come illustrato nella figura 5, verrà visualizzato un pulsante Elabora spedizione prodotto sopra un GridView che elenca i prodotti dieci alla volta.</span><span class="sxs-lookup"><span data-stu-id="5fe29-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="5fe29-162">[![GridView elenca i prodotti e offre funzionalità di ordinamento e paging](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="5fe29-163">**Figura 5**: GridView elenca i prodotti e offre funzionalità di ordinamento e paging ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="5fe29-164">Passaggio 2: creazione dell'interfaccia di inserimento</span><span class="sxs-lookup"><span data-stu-id="5fe29-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="5fe29-165">Con l'interfaccia di visualizzazione completata, è possibile creare l'interfaccia di inserimento.</span><span class="sxs-lookup"><span data-stu-id="5fe29-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="5fe29-166">Per questa esercitazione, è possibile creare un'interfaccia di inserimento che richiede un singolo fornitore e un valore di categoria e quindi consente all'utente di immettere fino a cinque nomi di prodotto e valori di prezzo unitario.</span><span class="sxs-lookup"><span data-stu-id="5fe29-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="5fe29-167">Con questa interfaccia, l'utente può aggiungere uno a cinque nuovi prodotti che condividono la stessa categoria e fornitore, ma hanno nomi di prodotto e prezzi univoci.</span><span class="sxs-lookup"><span data-stu-id="5fe29-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="5fe29-168">Per iniziare, trascinare un pannello dalla casella degli strumenti nella finestra di progettazione e posizionarlo sotto il pannello `DisplayInterface` esistente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="5fe29-169">Impostare la proprietà `ID` di questo pannello appena aggiunto su `InsertingInterface` e impostare la relativa proprietà `Visible` su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="5fe29-170">Verrà aggiunto il codice che imposta la proprietà `Visible` del pannello `InsertingInterface` per `true` nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="5fe29-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="5fe29-171">Deselezionare anche le `Height` del pannello e `Width` i valori delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="5fe29-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="5fe29-172">Successivamente, è necessario creare l'interfaccia di inserimento riportata nella figura 1.</span><span class="sxs-lookup"><span data-stu-id="5fe29-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="5fe29-173">Questa interfaccia può essere creata tramite un'ampia gamma di tecniche HTML, ma si utilizzerà una tabella abbastanza semplice: una tabella con quattro colonne e sette righe.</span><span class="sxs-lookup"><span data-stu-id="5fe29-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="5fe29-174">Quando si immette il markup per gli elementi HTML `<table>`, preferisco utilizzare la visualizzazione origine.</span><span class="sxs-lookup"><span data-stu-id="5fe29-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="5fe29-175">Sebbene in Visual Studio siano disponibili strumenti per l'aggiunta di `<table>` elementi tramite la finestra di progettazione, la finestra di progettazione sembra troppo disposta a inserire le impostazioni non richieste `style` nel markup.</span><span class="sxs-lookup"><span data-stu-id="5fe29-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="5fe29-176">Una volta creato il markup `<table>`, in genere torno alla finestra di progettazione per aggiungere i controlli Web e impostare le relative proprietà.</span><span class="sxs-lookup"><span data-stu-id="5fe29-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="5fe29-177">Quando si creano tabelle con colonne e righe predeterminate, è preferibile usare codice HTML statico anziché il [controllo Web della tabella](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) perché tutti i controlli Web inseriti in un controllo Web della tabella sono accessibili solo usando il modello di `FindControl("controlID")`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="5fe29-178">Tuttavia, utilizzo i controlli Web della tabella per le tabelle di dimensioni dinamiche, ovvero quelle le cui righe o colonne sono basate su determinati criteri di database o specificati dall'utente, poiché il controllo Web della tabella può essere costruito a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="5fe29-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="5fe29-179">Immettere il markup seguente nei tag `<asp:Panel>` del pannello `InsertingInterface`:</span><span class="sxs-lookup"><span data-stu-id="5fe29-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="5fe29-180">Questa `<table>` markup non include ancora controlli Web, che verranno aggiunti momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="5fe29-181">Si noti che ogni elemento `<tr>` contiene una particolare impostazione della classe CSS: `BatchInsertHeaderRow` per la riga di intestazione in cui verranno inseriti i controlli DropDownList del fornitore e della categoria; `BatchInsertFooterRow` per la riga del piè di pagina in cui verranno inseriti i pulsanti Aggiungi prodotti da spedizione e Annulla; e alternano i valori `BatchInsertRow` e `BatchInsertAlternatingRow` per le righe che conterranno i controlli casella di testo Product e unit price.</span><span class="sxs-lookup"><span data-stu-id="5fe29-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="5fe29-182">Ho creato le classi CSS corrispondenti nel file di `Styles.css` per dare all'interfaccia di inserimento un aspetto simile ai controlli GridView e DetailsView usati in queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="5fe29-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="5fe29-183">Queste classi CSS sono illustrate di seguito.</span><span class="sxs-lookup"><span data-stu-id="5fe29-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="5fe29-184">Con questo markup immesso, tornare alla visualizzazione progettazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="5fe29-185">Questo `<table>` dovrebbe essere visualizzato come tabella a quattro colonne e a sette righe nella finestra di progettazione, come illustrato nella figura 6.</span><span class="sxs-lookup"><span data-stu-id="5fe29-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="5fe29-186">[![l'interfaccia di inserimento è costituita da una tabella di sette righe di quattro colonne](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="5fe29-187">**Figura 6**: l'interfaccia di inserimento è costituita da una tabella con quattro colonne e sette righe ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>

<span data-ttu-id="5fe29-188">A questo punto è possibile aggiungere i controlli Web all'interfaccia di inserimento.</span><span class="sxs-lookup"><span data-stu-id="5fe29-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="5fe29-189">Trascinare due DropDownList dalla casella degli strumenti nelle celle appropriate della tabella uno per il fornitore e uno per la categoria.</span><span class="sxs-lookup"><span data-stu-id="5fe29-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="5fe29-190">Impostare la proprietà `ID` di DropDownList Supplier su `Suppliers` e associarla a un nuovo ObjectDataSource denominato `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="5fe29-191">Configurare il nuovo ObjectDataSource per recuperare i dati dal metodo `GetSuppliers` della classe `SuppliersBLL` e impostare l'elenco a discesa scheda aggiornamento su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="5fe29-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="5fe29-192">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="5fe29-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="5fe29-193">[![configurare ObjectDataSource per l'utilizzo del metodo SuppliersBLL della classe s getsuppliers](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="5fe29-194">**Figura 7**: configurare ObjectDataSource per l'uso del metodo `SuppliersBLL` Class s `GetSuppliers` ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>

<span data-ttu-id="5fe29-195">Fare in modo che il `Suppliers` DropDownList visualizzi il campo dati `CompanyName` e usare il campo dati `SupplierID` come valori `ListItem` s.</span><span class="sxs-lookup"><span data-stu-id="5fe29-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="5fe29-196">[![visualizzare il campo dati CompanyName e utilizzare SupplierID come valore](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="5fe29-197">**Figura 8**: visualizzare il campo dati `CompanyName` e usare `SupplierID` come valore ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>

<span data-ttu-id="5fe29-198">Denominare il secondo DropDownList `Categories` e associarlo a un nuovo ObjectDataSource denominato `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="5fe29-199">Configurare il `CategoriesDataSource` ObjectDataSource per l'uso del metodo `GetCategories` della classe `CategoriesBLL`. impostare gli elenchi a discesa nelle schede Aggiorna ed Elimina su (nessuno), quindi fare clic su fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="5fe29-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="5fe29-200">Infine, fare in modo che l'oggetto DropDownList visualizzi il campo dati `CategoryName` e usare il `CategoryID` come valore.</span><span class="sxs-lookup"><span data-stu-id="5fe29-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="5fe29-201">Dopo che questi due DropDownList sono stati aggiunti e associati a ObjectDataSources configurati in modo appropriato, la schermata dovrebbe essere simile alla figura 9.</span><span class="sxs-lookup"><span data-stu-id="5fe29-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="5fe29-202">[![la riga di intestazione contiene ora gli DropDownList Suppliers e Categories](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="5fe29-203">**Figura 9**: la riga di intestazione contiene ora i `Suppliers` e i `Categories` DropDownList ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>

<span data-ttu-id="5fe29-204">A questo punto è necessario creare le caselle di testo per raccogliere il nome e il prezzo per ogni nuovo prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="5fe29-205">Trascinare un controllo TextBox dalla casella degli strumenti nella finestra di progettazione per ognuna delle cinque righe nome prodotto e prezzo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="5fe29-206">Impostare le proprietà `ID` delle caselle di testo su `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`e così via.</span><span class="sxs-lookup"><span data-stu-id="5fe29-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="5fe29-207">Aggiungere un oggetto CompareValidator dopo ognuna delle caselle di testo del prezzo unitario, impostando la proprietà `ControlToValidate` sul `ID`appropriato.</span><span class="sxs-lookup"><span data-stu-id="5fe29-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="5fe29-208">Impostare anche la proprietà `Operator` su `GreaterThanEqual`, `ValueToCompare` su 0 e `Type` su `Currency`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="5fe29-209">Queste impostazioni indicano a CompareValidator di garantire che il prezzo, se immesso, sia un valore di valuta valido maggiore o uguale a zero.</span><span class="sxs-lookup"><span data-stu-id="5fe29-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="5fe29-210">Impostare la proprietà `Text` su \*e `ErrorMessage` al prezzo deve essere maggiore o uguale a zero.</span><span class="sxs-lookup"><span data-stu-id="5fe29-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="5fe29-211">Inoltre, omettere tutti i simboli di valuta.</span><span class="sxs-lookup"><span data-stu-id="5fe29-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="5fe29-212">L'interfaccia di inserimento non include alcun controllo RequiredFieldValidator, anche se il `ProductName` campo nella tabella `Products` database non consente valori di `NULL`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="5fe29-213">Questo perché si desidera consentire all'utente di immettere fino a cinque prodotti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="5fe29-214">Se, ad esempio, l'utente deve fornire il nome del prodotto e il prezzo unitario per le prime tre righe, lasciando vuote le ultime due righe, è sufficiente aggiungere tre nuovi prodotti al sistema.</span><span class="sxs-lookup"><span data-stu-id="5fe29-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="5fe29-215">Poiché `ProductName` è necessario, tuttavia, è necessario verificare a livello di codice che se viene immesso un prezzo unitario viene specificato un valore di nome prodotto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="5fe29-216">Questa verifica verrà affrontata nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="5fe29-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="5fe29-217">Quando si convalida l'input dell'utente, il CompareValidator segnala dati non validi se il valore contiene un simbolo di valuta.</span><span class="sxs-lookup"><span data-stu-id="5fe29-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="5fe29-218">Aggiungere una variabile $ davanti a ognuna delle caselle di testo del prezzo unitario per fungere da segnale visivo che indica all'utente di omettere il simbolo di valuta quando si immette il prezzo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="5fe29-219">Infine, aggiungere un controllo ValidationSummary all'interno del pannello `InsertingInterface`, impostarne la proprietà `ShowMessageBox` su `true` e la relativa proprietà `ShowSummary` su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="5fe29-220">Con queste impostazioni, se l'utente immette un valore di prezzo unitario non valido, verrà visualizzato un asterisco accanto ai controlli casella di testo che genera un errore e il ValidationSummary visualizzerà un MessageBox sul lato client che mostra il messaggio di errore specificato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="5fe29-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="5fe29-221">A questo punto, la schermata dovrebbe essere simile alla figura 10.</span><span class="sxs-lookup"><span data-stu-id="5fe29-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="5fe29-222">[![l'interfaccia di inserimento include ora caselle di testo per i nomi dei prodotti e i prezzi](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="5fe29-223">**Figura 10**: l'interfaccia di inserimento include ora caselle di testo per i nomi dei prodotti e i prezzi ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>

<span data-ttu-id="5fe29-224">Successivamente, è necessario aggiungere i pulsanti Aggiungi prodotti da spedizione e Annulla alla riga del piè di pagina.</span><span class="sxs-lookup"><span data-stu-id="5fe29-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="5fe29-225">Trascinare due controlli Button dalla casella degli strumenti nel piè di pagina dell'interfaccia di inserimento, impostando i pulsanti `ID` proprietà su `AddProducts` e `CancelButton` e `Text` proprietà per aggiungere i prodotti dalla spedizione e annullare, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="5fe29-226">Inoltre, impostare la proprietà del controllo `CancelButton` s `CausesValidation` su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="5fe29-227">Infine, è necessario aggiungere un controllo Web Label che visualizzerà i messaggi di stato per le due interfacce.</span><span class="sxs-lookup"><span data-stu-id="5fe29-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="5fe29-228">Ad esempio, quando un utente aggiunge correttamente una nuova spedizione di prodotti, si desidera tornare all'interfaccia di visualizzazione e visualizzare un messaggio di conferma.</span><span class="sxs-lookup"><span data-stu-id="5fe29-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="5fe29-229">Se, tuttavia, l'utente fornisce un prezzo per un nuovo prodotto ma lascia il nome del prodotto, è necessario visualizzare un messaggio di avviso poiché il campo `ProductName` è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="5fe29-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="5fe29-230">Poiché è necessario che questo messaggio venga visualizzato per entrambe le interfacce, posizionarlo nella parte superiore della pagina all'esterno dei pannelli.</span><span class="sxs-lookup"><span data-stu-id="5fe29-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="5fe29-231">Trascinare un controllo Web etichetta dalla casella degli strumenti nella parte superiore della pagina nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="5fe29-232">Impostare la proprietà `ID` su `StatusLabel`, deselezionare la proprietà `Text` e impostare le proprietà `Visible` e `EnableViewState` su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="5fe29-233">Come illustrato nelle esercitazioni precedenti, l'impostazione della proprietà `EnableViewState` su `false` consente di modificare a livello di codice i valori delle proprietà dell'etichetta e di ripristinarne automaticamente le impostazioni predefinite nel postback successivo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="5fe29-234">Questo consente di semplificare il codice per la visualizzazione di un messaggio di stato in risposta a un'azione dell'utente che scompare nel postback successivo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="5fe29-235">Infine, impostare la proprietà `CssClass` del controllo `StatusLabel` su Warning, ovvero il nome di una classe CSS definita in `Styles.css` che Visualizza il testo in un tipo di carattere grande, corsivo, grassetto e rosso.</span><span class="sxs-lookup"><span data-stu-id="5fe29-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="5fe29-236">La figura 11 Mostra la finestra di progettazione di Visual Studio dopo che l'etichetta è stata aggiunta e configurata.</span><span class="sxs-lookup"><span data-stu-id="5fe29-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="5fe29-237">[![posizionare il controllo StatusLabel sopra i due controlli Panel](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="5fe29-238">**Figura 11**: posizionare il controllo `StatusLabel` sopra i due controlli Panel ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="5fe29-239">Passaggio 3: passaggio tra le interfacce di visualizzazione e inserimento</span><span class="sxs-lookup"><span data-stu-id="5fe29-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="5fe29-240">A questo punto è stato completato il markup per le interfacce di visualizzazione e inserimento, ma sono ancora disponibili due attività:</span><span class="sxs-lookup"><span data-stu-id="5fe29-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="5fe29-241">Spostamento tra le interfacce di visualizzazione e inserimento</span><span class="sxs-lookup"><span data-stu-id="5fe29-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="5fe29-242">Aggiunta dei prodotti nella spedizione al database</span><span class="sxs-lookup"><span data-stu-id="5fe29-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="5fe29-243">Attualmente, l'interfaccia di visualizzazione è visibile, ma l'interfaccia di inserimento è nascosta.</span><span class="sxs-lookup"><span data-stu-id="5fe29-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="5fe29-244">Ciò è dovuto al fatto che la proprietà `Visible` `DisplayInterface` Panel è impostata su `true` (valore predefinito), mentre la proprietà `Visible` del pannello `InsertingInterface` è impostata su `false`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="5fe29-245">Per spostarsi tra le due interfacce, è sufficiente attivare o disattivare ogni valore della proprietà `Visible` del controllo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="5fe29-246">Si vuole passare dall'interfaccia di visualizzazione all'interfaccia di inserimento quando si fa clic sul pulsante di spedizione del prodotto del processo.</span><span class="sxs-lookup"><span data-stu-id="5fe29-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="5fe29-247">Quindi, creare un gestore eventi per questo pulsante s `Click` evento che contiene il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="5fe29-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="5fe29-248">Questo codice nasconde semplicemente il pannello `DisplayInterface` e Mostra il pannello `InsertingInterface`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="5fe29-249">Successivamente, creare i gestori eventi per i controlli Aggiungi prodotti da spedizione e pulsante Annulla nell'interfaccia di inserimento.</span><span class="sxs-lookup"><span data-stu-id="5fe29-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="5fe29-250">Quando si fa clic su uno di questi pulsanti, è necessario tornare all'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="5fe29-251">Creare `Click` gestori di eventi per entrambi i controlli Button in modo che chiamino `ReturnToDisplayInterface`, un metodo che viene aggiunto momentaneamente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="5fe29-252">Oltre a nascondere il pannello `InsertingInterface` e visualizzare il pannello `DisplayInterface`, il `ReturnToDisplayInterface` metodo deve restituire i controlli Web allo stato di pre-modifica.</span><span class="sxs-lookup"><span data-stu-id="5fe29-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="5fe29-253">Questa operazione comporta l'impostazione di DropDownList `SelectedIndex` proprietà su 0 e la cancellazione delle proprietà `Text` dei controlli TextBox.</span><span class="sxs-lookup"><span data-stu-id="5fe29-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="5fe29-254">Si consideri cosa può accadere se i controlli non sono stati restituiti allo stato di pre-modifica prima di tornare all'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="5fe29-255">Un utente può fare clic sul pulsante Elabora spedizione prodotto, immettere i prodotti dalla spedizione, quindi fare clic su Aggiungi prodotti dalla spedizione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="5fe29-256">Questa operazione consente di aggiungere i prodotti e di restituire l'utente all'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="5fe29-257">A questo punto è possibile che l'utente desideri aggiungere un'altra spedizione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="5fe29-258">Quando si fa clic sul pulsante elabora la spedizione del prodotto, questi restituiscono l'interfaccia di inserimento, ma le selezioni e i valori della casella di controllo DropDownList verranno comunque popolati con i valori precedenti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="5fe29-259">Entrambi `Click` gestori di eventi chiamano semplicemente il metodo `ReturnToDisplayInterface`, anche se si tornerà al gestore dell'evento Aggiungi prodotti dalla spedizione `Click` nel passaggio 4 e si aggiungerà il codice per salvare i prodotti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="5fe29-260">`ReturnToDisplayInterface` inizia restituendo i `Suppliers` e `Categories` DropDownList alle relative prime opzioni.</span><span class="sxs-lookup"><span data-stu-id="5fe29-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="5fe29-261">Le due costanti `firstControlID` e `lastControlID` contrassegnano i valori di indice di controllo iniziale e finale utilizzati per la denominazione delle caselle di testo nome prodotto e prezzo unitario nell'interfaccia di inserimento e vengono utilizzati nei limiti del ciclo di `for` che imposta le proprietà `Text` dei controlli TextBox su una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="5fe29-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="5fe29-262">Infine, i pannelli `Visible` proprietà vengono reimpostati in modo che l'interfaccia di inserimento sia nascosta e l'interfaccia di visualizzazione visualizzata.</span><span class="sxs-lookup"><span data-stu-id="5fe29-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="5fe29-263">È possibile eseguire il test di questa pagina in un browser.</span><span class="sxs-lookup"><span data-stu-id="5fe29-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="5fe29-264">Quando si visita la pagina, viene visualizzata l'interfaccia di visualizzazione come illustrato nella figura 5.</span><span class="sxs-lookup"><span data-stu-id="5fe29-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="5fe29-265">Fare clic sul pulsante elabora la spedizione del prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="5fe29-266">La pagina verrà postback e dovrebbe essere visualizzata l'interfaccia di inserimento, come illustrato nella figura 12.</span><span class="sxs-lookup"><span data-stu-id="5fe29-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="5fe29-267">Facendo clic sui pulsanti Aggiungi prodotti da spedizione o Annulla viene visualizzata l'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="5fe29-268">Durante la visualizzazione dell'interfaccia di inserimento, provare a eseguire il test di CompareValidators sulle caselle di testo del prezzo unitario.</span><span class="sxs-lookup"><span data-stu-id="5fe29-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="5fe29-269">Verrà visualizzato un avviso MessageBox sul lato client quando si fa clic sul pulsante Aggiungi prodotti dalla spedizione con valori di valuta non validi o con un valore minore di zero.</span><span class="sxs-lookup"><span data-stu-id="5fe29-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="5fe29-270">[![l'interfaccia di inserimento viene visualizzata dopo aver fatto clic sul pulsante Elabora spedizione prodotto](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="5fe29-271">**Figura 12**: l'interfaccia di inserimento viene visualizzata dopo aver fatto clic sul pulsante Elabora spedizione prodotto ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="5fe29-272">Passaggio 4: aggiunta dei prodotti</span><span class="sxs-lookup"><span data-stu-id="5fe29-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="5fe29-273">Per questa esercitazione, è necessario salvare i prodotti nel database nel `Click` gestore dell'evento Aggiungi prodotti dalla spedizione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="5fe29-274">Questa operazione può essere eseguita creando una `ProductsDataTable` e aggiungendo un'istanza `ProductsRow` per ogni nome di prodotto fornito.</span><span class="sxs-lookup"><span data-stu-id="5fe29-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="5fe29-275">Una volta aggiunte queste `ProductsRow`, si effettuerà una chiamata al metodo della classe `ProductsBLL` `UpdateWithTransaction` che passa il `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="5fe29-276">Tenere presente che il metodo di `UpdateWithTransaction`, che è stato creato nuovamente nell'esercitazione relativa all'esecuzione del [wrapping del database all'interno di una transazione](wrapping-database-modifications-within-a-transaction-cs.md) , passa il `ProductsDataTable` al metodo di `UpdateWithTransaction` `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="5fe29-277">Da qui viene avviata una transazione ADO.NET e il TableAdapter rilascia un'istruzione `INSERT` al database per ogni `ProductsRow` aggiunta nella DataTable.</span><span class="sxs-lookup"><span data-stu-id="5fe29-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="5fe29-278">Supponendo che tutti i prodotti vengano aggiunti senza errori, viene eseguito il commit della transazione. in caso contrario, viene eseguito il rollback.</span><span class="sxs-lookup"><span data-stu-id="5fe29-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="5fe29-279">Il codice per il pulsante di aggiunta dei prodotti dalla spedizione `Click` il gestore eventi deve anche eseguire un po' di controllo degli errori.</span><span class="sxs-lookup"><span data-stu-id="5fe29-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="5fe29-280">Poiché non vi sono RequiredFieldValidators usati nell'interfaccia di inserimento, un utente può immettere un prezzo per un prodotto omettendone il nome.</span><span class="sxs-lookup"><span data-stu-id="5fe29-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="5fe29-281">Poiché il nome del prodotto è obbligatorio, se tale condizione si riduce, è necessario avvisare l'utente e non procedere con gli inserimenti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="5fe29-282">Il codice completo del gestore eventi `Click` segue:</span><span class="sxs-lookup"><span data-stu-id="5fe29-282">The complete `Click` event handler code follows:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="5fe29-283">Il gestore eventi inizia assicurandosi che la proprietà `Page.IsValid` restituisca un valore di `true`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="5fe29-284">Se restituisce `false`, significa che uno o più CompareValidators segnalano dati non validi; in tal caso non si vuole provare a inserire i prodotti immessi o si otterrà un'eccezione durante il tentativo di assegnare il valore del prezzo unitario immesso dall'utente alla proprietà di `ProductsRow` s `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="5fe29-285">Viene quindi creata una nuova istanza di `ProductsDataTable` (`products`).</span><span class="sxs-lookup"><span data-stu-id="5fe29-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="5fe29-286">Viene usato un ciclo `for` per scorrere le caselle di testo nome prodotto e prezzo unitario e le proprietà `Text` vengono lette nelle variabili locali `productName` e `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="5fe29-287">Se l'utente ha immesso un valore per il prezzo unitario ma non per il nome del prodotto corrispondente, il `StatusLabel` Visualizza il messaggio se si specifica un prezzo unitario è necessario includere anche il nome del prodotto e il gestore eventi è terminato.</span><span class="sxs-lookup"><span data-stu-id="5fe29-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="5fe29-288">Se è stato specificato un nome di prodotto, viene creata una nuova istanza di `ProductsRow` usando il metodo di `NewProductsRow` `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="5fe29-289">Questa nuova proprietà di `ProductsRow` istanza s `ProductName` è impostata sulla casella di testo Product Name corrente mentre le proprietà `SupplierID` e `CategoryID` vengono assegnate alle proprietà `SelectedValue` degli oggetti DropDownList nell'intestazione di inserimento dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="5fe29-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="5fe29-290">Se l'utente ha immesso un valore per il prezzo del prodotto, viene assegnato alla proprietà `UnitPrice` dell'istanza di `ProductsRow`; in caso contrario, la proprietà viene lasciata non assegnata e verrà generato un `NULL` valore per `UnitPrice` nel database.</span><span class="sxs-lookup"><span data-stu-id="5fe29-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="5fe29-291">Infine, le proprietà `Discontinued` e `UnitsOnOrder` vengono assegnate rispettivamente ai valori hardcoded `false` e 0.</span><span class="sxs-lookup"><span data-stu-id="5fe29-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="5fe29-292">Una volta assegnate le proprietà all'istanza di `ProductsRow`, questa viene aggiunta al `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="5fe29-293">Al termine del ciclo di `for`, viene verificato se sono stati aggiunti prodotti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="5fe29-294">L'utente può, dopo tutto, aver fatto clic su Aggiungi prodotti dalla spedizione prima di immettere i nomi dei prodotti o i prezzi.</span><span class="sxs-lookup"><span data-stu-id="5fe29-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="5fe29-295">Se nel `ProductsDataTable`è presente almeno un prodotto, viene chiamato il metodo `ProductsBLL` Class s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="5fe29-296">Successivamente, i dati vengono riassociati al `ProductsGrid` GridView, in modo che i prodotti appena aggiunti verranno visualizzati nell'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="5fe29-297">Il `StatusLabel` viene aggiornato per visualizzare un messaggio di conferma e viene richiamato il `ReturnToDisplayInterface`, nascondendo l'interfaccia di inserimento e mostrando l'interfaccia di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="5fe29-298">Se non è stato immesso alcun prodotto, l'interfaccia di inserimento rimane visualizzata ma non è stato aggiunto alcun prodotto.</span><span class="sxs-lookup"><span data-stu-id="5fe29-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="5fe29-299">Immettere i nomi dei prodotti e i prezzi delle unità nelle caselle di testo visualizzate.</span><span class="sxs-lookup"><span data-stu-id="5fe29-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="5fe29-300">Figura s 13, 14 e 15 mostrano le interfacce di inserimento e visualizzazione in azione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="5fe29-301">Nella figura 13, l'utente ha immesso un valore di prezzo unitario senza un nome di prodotto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="5fe29-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="5fe29-302">Nella figura 14 viene illustrata l'interfaccia di visualizzazione dopo l'aggiunta di tre nuovi prodotti, mentre la figura 15 Mostra due dei prodotti appena aggiunti in GridView (la terza si trova nella pagina precedente).</span><span class="sxs-lookup"><span data-stu-id="5fe29-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="5fe29-303">[![il nome di un prodotto è obbligatorio quando si immette un prezzo unitario](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="5fe29-304">**Figura 13**: il nome di un prodotto è obbligatorio quando si immette un prezzo unitario ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>

<span data-ttu-id="5fe29-305">[Sono stati aggiunti ![tre nuovi veggie per il Supplier s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="5fe29-306">**Figura 14**: sono stati aggiunti tre nuovi veggie per il fornitore di[catasto s (fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>

<span data-ttu-id="5fe29-307">[![i nuovi prodotti sono disponibili nell'ultima pagina di GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="5fe29-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="5fe29-308">**Figura 15**: i nuovi prodotti sono disponibili nell'ultima pagina del GridView ([fare clic per visualizzare l'immagine con dimensioni complete](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="5fe29-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5fe29-309">La logica di inserimento batch utilizzata in questa esercitazione esegue il wrapping degli inserimenti all'interno dell'ambito della transazione.</span><span class="sxs-lookup"><span data-stu-id="5fe29-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="5fe29-310">Per verificarlo, introdurre intenzionalmente un errore a livello di database.</span><span class="sxs-lookup"><span data-stu-id="5fe29-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="5fe29-311">Ad esempio, invece di assegnare la nuova proprietà di `ProductsRow` istanza s `CategoryID` al valore selezionato nel `Categories` DropDownList, assegnarla a un valore come `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="5fe29-312">Qui `i` è l'indicizzatore del ciclo e ha valori compresi tra 1 e 5.</span><span class="sxs-lookup"><span data-stu-id="5fe29-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="5fe29-313">Pertanto, quando si aggiungono due o più prodotti in batch INSERT, il primo prodotto avrà un valore `CategoryID` valido (5), ma i prodotti successivi avranno `CategoryID` valori che non corrispondono ai valori `CategoryID` nella tabella `Categories`.</span><span class="sxs-lookup"><span data-stu-id="5fe29-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="5fe29-314">L'effetto finale è che, mentre la prima `INSERT` avrà esito positivo, le successive avranno esito negativo con una violazione del vincolo di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="5fe29-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="5fe29-315">Poiché l'inserimento batch è atomico, viene eseguito il rollback del primo `INSERT`, restituendo lo stato del database prima dell'avvio del processo di inserimento batch.</span><span class="sxs-lookup"><span data-stu-id="5fe29-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="5fe29-316">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="5fe29-316">Summary</span></span>

<span data-ttu-id="5fe29-317">In questa e nelle due esercitazioni precedenti sono state create interfacce che consentono l'aggiornamento, l'eliminazione e l'inserimento di batch di dati, che hanno utilizzato il supporto delle transazioni aggiunto al livello di accesso ai dati nell'esercitazione relativa alla [wrapping delle modifiche del database all'interno di una transazione](wrapping-database-modifications-within-a-transaction-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="5fe29-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="5fe29-318">Per determinati scenari, le interfacce utente per l'elaborazione batch migliorano significativamente l'efficienza degli utenti finali riducendo il numero di clic, i postback e i commutatori di contesto da tastiera a mouse, mantenendo al tempo stesso l'integrità dei dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="5fe29-319">Questa esercitazione completa l'utilizzo dei dati in batch.</span><span class="sxs-lookup"><span data-stu-id="5fe29-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="5fe29-320">Il set di esercitazioni successivo Esplora una vasta gamma di scenari avanzati di livello di accesso ai dati, tra cui l'uso di stored procedure nei metodi TableAdapter, la configurazione delle impostazioni a livello di connessione e di comando nel DAL, la crittografia delle stringhe di connessione e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="5fe29-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="5fe29-321">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="5fe29-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5fe29-322">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="5fe29-322">About the Author</span></span>

<span data-ttu-id="5fe29-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autore di sette ASP/ASP. NET Books e fondatore di [4GuysFromRolla.com](http://www.4guysfromrolla.com), collabora con le tecnologie Web Microsoft a partire da 1998.</span><span class="sxs-lookup"><span data-stu-id="5fe29-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5fe29-324">Scott lavora come consulente, trainer e writer indipendenti.</span><span class="sxs-lookup"><span data-stu-id="5fe29-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5fe29-325">Il suo ultimo libro è [*Sams Teach Yourself ASP.NET 2,0 in 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5fe29-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5fe29-326">Può essere raggiunto in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5fe29-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5fe29-327">o tramite il suo Blog, disponibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5fe29-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5fe29-328">Grazie speciale</span><span class="sxs-lookup"><span data-stu-id="5fe29-328">Special Thanks To</span></span>

<span data-ttu-id="5fe29-329">Questa serie di esercitazioni è stata esaminata da molti revisori utili.</span><span class="sxs-lookup"><span data-stu-id="5fe29-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5fe29-330">I revisori del lead per questa esercitazione erano Hilton Giesenow e S Ren Jacob Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="5fe29-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="5fe29-331">Sei interessato a esaminare i miei prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="5fe29-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5fe29-332">In tal caso, rilasciare una riga in [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5fe29-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5fe29-333">[Precedente](batch-deleting-cs.md)
> [Successivo](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5fe29-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
