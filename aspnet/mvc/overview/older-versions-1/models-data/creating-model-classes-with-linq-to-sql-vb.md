---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
title: Creazione di classi di modelli con LINQ to SQL (VB) | Microsoft Docs
author: microsoft
description: L'obiettivo di questa esercitazione è illustrare un metodo per la creazione di classi di modelli per un'applicazione MVC ASP.NET. In questa esercitazione si apprenderà come compilare il modello c...
ms.author: riande
ms.date: 10/07/2008
ms.assetid: a4a25a75-d71f-4509-98b4-df72e748985a
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
msc.type: authoredcontent
ms.openlocfilehash: 88a5f1037d93ef3bdc95bf60b6005ebb254ab440
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78581270"
---
# <a name="creating-model-classes-with-linq-to-sql-vb"></a><span data-ttu-id="00361-104">Creazione di classi di modelli con LINQ to SQL (VB)</span><span class="sxs-lookup"><span data-stu-id="00361-104">Creating Model Classes with LINQ to SQL (VB)</span></span>

<span data-ttu-id="00361-105">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="00361-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="00361-106">Scaricare PDF</span><span class="sxs-lookup"><span data-stu-id="00361-106">Download PDF</span></span>](https://download.microsoft.com/download/1/1/f/11f721aa-d749-4ed7-bb89-a681b68894e6/ASPNET_MVC_Tutorial_10_VB.pdf)

> <span data-ttu-id="00361-107">L'obiettivo di questa esercitazione è illustrare un metodo per la creazione di classi di modelli per un'applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="00361-107">The goal of this tutorial is to explain one method of creating model classes for an ASP.NET MVC application.</span></span> <span data-ttu-id="00361-108">In questa esercitazione si apprenderà come creare classi di modello ed eseguire l'accesso al database sfruttando i vantaggi di Microsoft LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="00361-108">In this tutorial, you learn how to build model classes and perform database access by taking advantage of Microsoft LINQ to SQL.</span></span>

<span data-ttu-id="00361-109">L'obiettivo di questa esercitazione è illustrare un metodo per la creazione di classi di modelli per un'applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="00361-109">The goal of this tutorial is to explain one method of creating model classes for an ASP.NET MVC application.</span></span> <span data-ttu-id="00361-110">In questa esercitazione si apprenderà come creare classi di modello ed eseguire l'accesso al database sfruttando i vantaggi di Microsoft LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="00361-110">In this tutorial, you learn how to build model classes and perform database access by taking advantage of Microsoft LINQ to SQL.</span></span>

<span data-ttu-id="00361-111">In questa esercitazione viene creata un'applicazione di database di filmati di base.</span><span class="sxs-lookup"><span data-stu-id="00361-111">In this tutorial, we build a basic Movie database application.</span></span> <span data-ttu-id="00361-112">Si inizia creando l'applicazione di database di film nel modo più rapido e semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="00361-112">We start by creating the Movie database application in the fastest and easiest way possible.</span></span> <span data-ttu-id="00361-113">Tutti gli accessi ai dati vengono eseguiti direttamente dalle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="00361-113">We perform all of our data access directly from our controller actions.</span></span>

<span data-ttu-id="00361-114">Si apprenderà quindi come usare il modello di repository.</span><span class="sxs-lookup"><span data-stu-id="00361-114">Next, you learn how to use the Repository pattern.</span></span> <span data-ttu-id="00361-115">L'uso del modello di repository richiede un minor numero di operazioni.</span><span class="sxs-lookup"><span data-stu-id="00361-115">Using the Repository pattern requires a little more work.</span></span> <span data-ttu-id="00361-116">Tuttavia, il vantaggio dell'adozione di questo modello è che consente di creare applicazioni che sono adattabili per la modifica e possono essere facilmente testate.</span><span class="sxs-lookup"><span data-stu-id="00361-116">However, the advantage of adopting this pattern is that it enables you to build applications that are adaptable to change and can be easily tested.</span></span>

## <a name="what-is-a-model-class"></a><span data-ttu-id="00361-117">Che cos'è una classe modello?</span><span class="sxs-lookup"><span data-stu-id="00361-117">What is a Model Class?</span></span>

<span data-ttu-id="00361-118">Un modello MVC contiene tutta la logica dell'applicazione che non è contenuta in una visualizzazione MVC o in un controller MVC.</span><span class="sxs-lookup"><span data-stu-id="00361-118">An MVC model contains all of the application logic that is not contained in an MVC view or MVC controller.</span></span> <span data-ttu-id="00361-119">In particolare, un modello MVC contiene tutta la logica di accesso ai dati e alle applicazioni aziendali.</span><span class="sxs-lookup"><span data-stu-id="00361-119">In particular, an MVC model contains all of your application business and data access logic.</span></span>

<span data-ttu-id="00361-120">È possibile utilizzare un'ampia gamma di tecnologie diverse per implementare la logica di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="00361-120">You can use a variety of different technologies to implement your data access logic.</span></span> <span data-ttu-id="00361-121">È ad esempio possibile compilare le classi di accesso ai dati utilizzando le classi Microsoft Entity Framework, NHibernate, Subsonic o ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="00361-121">For example, you can build your data access classes using the Microsoft Entity Framework, NHibernate, Subsonic, or ADO.NET classes.</span></span>

<span data-ttu-id="00361-122">In questa esercitazione, utilizzo LINQ to SQL per eseguire query e aggiornare il database.</span><span class="sxs-lookup"><span data-stu-id="00361-122">In this tutorial, I use LINQ to SQL to query and update the database.</span></span> <span data-ttu-id="00361-123">LINQ to SQL offre un metodo molto semplice per interagire con un database Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="00361-123">LINQ to SQL provides you with a very easy method of interacting with a Microsoft SQL Server database.</span></span> <span data-ttu-id="00361-124">È tuttavia importante comprendere che il Framework di ASP.NET MVC non è associato a LINQ to SQL in alcun modo.</span><span class="sxs-lookup"><span data-stu-id="00361-124">However, it is important to understand that the ASP.NET MVC framework is not tied to LINQ to SQL in any way.</span></span> <span data-ttu-id="00361-125">ASP.NET MVC è compatibile con qualsiasi tecnologia di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="00361-125">ASP.NET MVC is compatible with any data access technology.</span></span>

## <a name="create-a-movie-database"></a><span data-ttu-id="00361-126">Creare un database di film</span><span class="sxs-lookup"><span data-stu-id="00361-126">Create a Movie Database</span></span>

<span data-ttu-id="00361-127">In questa esercitazione, per illustrare come è possibile compilare le classi del modello, viene creata una semplice applicazione di database di film.</span><span class="sxs-lookup"><span data-stu-id="00361-127">In this tutorial -- in order to illustrate how you can build model classes -- we build a simple Movie database application.</span></span> <span data-ttu-id="00361-128">Il primo passaggio consiste nel creare un nuovo database.</span><span class="sxs-lookup"><span data-stu-id="00361-128">The first step is to create a new database.</span></span> <span data-ttu-id="00361-129">Fare clic con il pulsante destro del mouse sulla cartella app\_data nella finestra di Esplora soluzioni e selezionare l'opzione di menu **Aggiungi, nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="00361-129">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span> <span data-ttu-id="00361-130">Selezionare il modello di database SQL Server, assegnargli il nome MoviesDB. mdf e fare clic sul pulsante **Aggiungi** (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="00361-130">Select the SQL Server Database template, give it the name MoviesDB.mdf, and click the **Add** button (see Figure 1).</span></span>

<span data-ttu-id="00361-131">[![l'aggiunta di un nuovo database SQL Server](creating-model-classes-with-linq-to-sql-vb/_static/image2.png)](creating-model-classes-with-linq-to-sql-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="00361-131">[![Adding a new SQL Server Database](creating-model-classes-with-linq-to-sql-vb/_static/image2.png)](creating-model-classes-with-linq-to-sql-vb/_static/image1.png)</span></span>

<span data-ttu-id="00361-132">**Figura 01**: aggiunta di un nuovo Database di SQL Server ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="00361-132">**Figure 01**: Adding a new SQL Server Database ([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image3.png))</span></span>

<span data-ttu-id="00361-133">Dopo aver creato il nuovo database, è possibile aprire il database facendo doppio clic sul file MoviesDB. mdf nella cartella app\_data.</span><span class="sxs-lookup"><span data-stu-id="00361-133">After you create the new database, you can open the database by double-clicking the MoviesDB.mdf file in the App\_Data folder.</span></span> <span data-ttu-id="00361-134">Facendo doppio clic sul file MoviesDB. MDF si apre la finestra di Esplora server (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="00361-134">Double-clicking the MoviesDB.mdf file opens the Server Explorer window (see Figure 2).</span></span>

|   | <span data-ttu-id="00361-135">La finestra di Esplora server viene chiamata finestra di Esplora database quando si utilizza Visual Web Developer.</span><span class="sxs-lookup"><span data-stu-id="00361-135">The Server Explorer window is called the Database Explorer window when using Visual Web Developer.</span></span> |
|---|----------------------------------------------------------------------------------------------------|
|   |                                                                                                    |

<span data-ttu-id="00361-136">[![tramite la finestra Esplora server](creating-model-classes-with-linq-to-sql-vb/_static/image5.png)](creating-model-classes-with-linq-to-sql-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="00361-136">[![Using the Server Explorer window](creating-model-classes-with-linq-to-sql-vb/_static/image5.png)](creating-model-classes-with-linq-to-sql-vb/_static/image4.png)</span></span>

<span data-ttu-id="00361-137">**Figura 02**: uso della finestra Esplora server ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="00361-137">**Figure 02**: Using the Server Explorer window ([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image6.png))</span></span>

<span data-ttu-id="00361-138">È necessario aggiungere una tabella al database che rappresenta i film.</span><span class="sxs-lookup"><span data-stu-id="00361-138">We need to add one table to our database that represents our movies.</span></span> <span data-ttu-id="00361-139">Fare clic con il pulsante destro del mouse sulla cartella tabelle e selezionare l'opzione di menu **Aggiungi nuova tabella**.</span><span class="sxs-lookup"><span data-stu-id="00361-139">Right-click the Tables folder and select the menu option **Add New Table**.</span></span> <span data-ttu-id="00361-140">La selezione di questa opzione di menu consente di aprire il Progettazione tabelle (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="00361-140">Selecting this menu option opens the Table Designer (see Figure 3).</span></span>

<span data-ttu-id="00361-141">[![tramite la finestra Esplora server](creating-model-classes-with-linq-to-sql-vb/_static/image8.png)](creating-model-classes-with-linq-to-sql-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="00361-141">[![Using the Server Explorer window](creating-model-classes-with-linq-to-sql-vb/_static/image8.png)](creating-model-classes-with-linq-to-sql-vb/_static/image7.png)</span></span>

<span data-ttu-id="00361-142">**Figura 03**: Progettazione tabelle ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="00361-142">**Figure 03**: The Table Designer ([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image9.png))</span></span>

<span data-ttu-id="00361-143">È necessario aggiungere le colonne seguenti alla tabella di database:</span><span class="sxs-lookup"><span data-stu-id="00361-143">We need to add the following columns to our database table:</span></span>

| <span data-ttu-id="00361-144">**Nome colonna**</span><span class="sxs-lookup"><span data-stu-id="00361-144">**Column Name**</span></span> | <span data-ttu-id="00361-145">**Tipo di dati**</span><span class="sxs-lookup"><span data-stu-id="00361-145">**Data Type**</span></span> | <span data-ttu-id="00361-146">**Consenti valori NULL**</span><span class="sxs-lookup"><span data-stu-id="00361-146">**Allow Nulls**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="00361-147">Id</span><span class="sxs-lookup"><span data-stu-id="00361-147">Id</span></span> | <span data-ttu-id="00361-148">Int</span><span class="sxs-lookup"><span data-stu-id="00361-148">Int</span></span> | <span data-ttu-id="00361-149">False</span><span class="sxs-lookup"><span data-stu-id="00361-149">False</span></span> |
| <span data-ttu-id="00361-150">Titolo</span><span class="sxs-lookup"><span data-stu-id="00361-150">Title</span></span> | <span data-ttu-id="00361-151">Nvarchar(200)</span><span class="sxs-lookup"><span data-stu-id="00361-151">Nvarchar(200)</span></span> | <span data-ttu-id="00361-152">False</span><span class="sxs-lookup"><span data-stu-id="00361-152">False</span></span> |
| <span data-ttu-id="00361-153">Responsabile</span><span class="sxs-lookup"><span data-stu-id="00361-153">Director</span></span> | <span data-ttu-id="00361-154">Nvarchar(50)</span><span class="sxs-lookup"><span data-stu-id="00361-154">Nvarchar(50)</span></span> | <span data-ttu-id="00361-155">False</span><span class="sxs-lookup"><span data-stu-id="00361-155">False</span></span> |

<span data-ttu-id="00361-156">È necessario eseguire due operazioni speciali nella colonna ID.</span><span class="sxs-lookup"><span data-stu-id="00361-156">You need to do two special things to the Id column.</span></span> <span data-ttu-id="00361-157">Per prima cosa, è necessario contrassegnare la colonna ID come colonna chiave primaria selezionando la colonna nella Progettazione tabelle e facendo clic sull'icona di una chiave.</span><span class="sxs-lookup"><span data-stu-id="00361-157">First, you need to mark the Id column as a primary key column by selecting the column in the Table Designer and clicking the icon of a key.</span></span> <span data-ttu-id="00361-158">Per LINQ to SQL è necessario specificare le colonne chiave primaria durante l'esecuzione di inserimenti o aggiornamenti sul database.</span><span class="sxs-lookup"><span data-stu-id="00361-158">LINQ to SQL requires you to specify your primary key columns when performing inserts or updates against the database.</span></span>

<span data-ttu-id="00361-159">Successivamente, è necessario contrassegnare la colonna ID come colonna Identity assegnando il valore Yes alla proprietà **is Identity** (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="00361-159">Next, you need to mark the Id column as an Identity column by assigning the value Yes to the **Is Identity** property (see Figure 3).</span></span> <span data-ttu-id="00361-160">Una colonna Identity è una colonna a cui viene assegnato automaticamente un nuovo numero quando si aggiunge una nuova riga di dati a una tabella.</span><span class="sxs-lookup"><span data-stu-id="00361-160">An Identity column is a column that is assigned a new number automatically whenever you add a new row of data to a table.</span></span>

<span data-ttu-id="00361-161">Dopo avere apportato queste modifiche, salvare la tabella con il nome tblMovie.</span><span class="sxs-lookup"><span data-stu-id="00361-161">After you make these changes, save the table with the name tblMovie.</span></span> <span data-ttu-id="00361-162">È possibile salvare la tabella facendo clic sul pulsante Salva.</span><span class="sxs-lookup"><span data-stu-id="00361-162">You can save the table by clicking the Save button.</span></span>

## <a name="create-linq-to-sql-classes"></a><span data-ttu-id="00361-163">Creare classi di LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="00361-163">Create LINQ to SQL Classes</span></span>

<span data-ttu-id="00361-164">Il modello MVC conterrà LINQ to SQL classi che rappresentano la tabella di database tblMovie.</span><span class="sxs-lookup"><span data-stu-id="00361-164">Our MVC model will contain LINQ to SQL classes that represent the tblMovie database table.</span></span> <span data-ttu-id="00361-165">Il modo più semplice per creare queste classi di LINQ to SQL è fare clic con il pulsante destro del mouse sulla cartella Models, scegliere **Aggiungi, nuovo elemento**, selezionare il modello LINQ to SQL classi, assegnare alla classe il nome Movie. dbml, quindi fare clic sul pulsante **Aggiungi** (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="00361-165">The easiest way to create these LINQ to SQL classes is to right-click the Models folder, select **Add, New Item**, select the LINQ to SQL Classes template, give the classes the name Movie.dbml, and click the **Add** button (see Figure 4).</span></span>

<span data-ttu-id="00361-166">[![la creazione di classi LINQ to SQL](creating-model-classes-with-linq-to-sql-vb/_static/image11.png)](creating-model-classes-with-linq-to-sql-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="00361-166">[![Creating LINQ to SQL classes](creating-model-classes-with-linq-to-sql-vb/_static/image11.png)](creating-model-classes-with-linq-to-sql-vb/_static/image10.png)</span></span>

<span data-ttu-id="00361-167">**Figura 04**: creazione di classi di LINQ to SQL ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="00361-167">**Figure 04**: Creating LINQ to SQL classes ([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image12.png))</span></span>

<span data-ttu-id="00361-168">Subito dopo aver creato il film LINQ to SQL le classi, viene visualizzato il Object Relational Designer.</span><span class="sxs-lookup"><span data-stu-id="00361-168">Immediately after you create the Movie LINQ to SQL Classes, the Object Relational Designer appears.</span></span> <span data-ttu-id="00361-169">È possibile trascinare le tabelle di database dalla finestra di Esplora server nel Object Relational Designer per creare LINQ to SQL classi che rappresentano le tabelle di database specifiche.</span><span class="sxs-lookup"><span data-stu-id="00361-169">You can drag database tables from the Server Explorer window onto the Object Relational Designer to create LINQ to SQL Classes that represent particular database tables.</span></span> <span data-ttu-id="00361-170">È necessario aggiungere la tabella di database tblMovie nel Object Relational Designer (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="00361-170">We need to add the tblMovie database table onto the Object Relational Designer (see Figure 4).</span></span>

<span data-ttu-id="00361-171">[![utilizzando il Object Relational Designer](creating-model-classes-with-linq-to-sql-vb/_static/image14.png)](creating-model-classes-with-linq-to-sql-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="00361-171">[![Using the Object Relational Designer](creating-model-classes-with-linq-to-sql-vb/_static/image14.png)](creating-model-classes-with-linq-to-sql-vb/_static/image13.png)</span></span>

<span data-ttu-id="00361-172">**Figura 05**: uso del Object Relational Designer ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="00361-172">**Figure 05**: Using the Object Relational Designer ([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image15.png))</span></span>

<span data-ttu-id="00361-173">Per impostazione predefinita, il Object Relational Designer crea una classe con lo stesso nome della tabella di database trascinata nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="00361-173">By default, the Object Relational Designer creates a class with the very same name as the database table that you drag onto the Designer.</span></span> <span data-ttu-id="00361-174">Tuttavia, non è necessario chiamare la classe tblMovie.</span><span class="sxs-lookup"><span data-stu-id="00361-174">However, we don't want to call our class tblMovie.</span></span> <span data-ttu-id="00361-175">Quindi, fare clic sul nome della classe nella finestra di progettazione e modificare il nome della classe in Movie.</span><span class="sxs-lookup"><span data-stu-id="00361-175">Therefore, click the name of the class in the Designer and change the name of the class to Movie.</span></span>

<span data-ttu-id="00361-176">Infine, ricordarsi di fare clic sul pulsante **Salva** (immagine del floppy) per salvare le classi LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="00361-176">Finally, remember to click the **Save** button (the picture of the floppy) to save the LINQ to SQL Classes.</span></span> <span data-ttu-id="00361-177">In caso contrario, le classi LINQ to SQL non verranno generate dall'Object Relational Designer.</span><span class="sxs-lookup"><span data-stu-id="00361-177">Otherwise, the LINQ to SQL Classes won't be generated by the Object Relational Designer.</span></span>

## <a name="using-linq-to-sql-in-a-controller-action"></a><span data-ttu-id="00361-178">Uso di LINQ to SQL in un'azione del controller</span><span class="sxs-lookup"><span data-stu-id="00361-178">Using LINQ to SQL in a Controller Action</span></span>

<span data-ttu-id="00361-179">Ora che sono disponibili le classi di LINQ to SQL, è possibile usare queste classi per recuperare i dati dal database.</span><span class="sxs-lookup"><span data-stu-id="00361-179">Now that we have our LINQ to SQL classes, we can use these classes to retrieve data from the database.</span></span> <span data-ttu-id="00361-180">In questa sezione viene illustrato come utilizzare le classi LINQ to SQL direttamente all'interno di un'azione del controller.</span><span class="sxs-lookup"><span data-stu-id="00361-180">In this section, you learn how to use LINQ to SQL classes directly within a controller action.</span></span> <span data-ttu-id="00361-181">Verrà visualizzato l'elenco dei film della tabella di database tblMovies in una visualizzazione MVC.</span><span class="sxs-lookup"><span data-stu-id="00361-181">We'll display the list of movies from the tblMovies database table in an MVC view.</span></span>

<span data-ttu-id="00361-182">Prima di tutto, è necessario modificare la classe HomeController.</span><span class="sxs-lookup"><span data-stu-id="00361-182">First, we need to modify the HomeController class.</span></span> <span data-ttu-id="00361-183">Questa classe si trova nella cartella controller dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="00361-183">This class can be found in the Controllers folder of your application.</span></span> <span data-ttu-id="00361-184">Modificare la classe in modo che appaia come la classe nel listato 1.</span><span class="sxs-lookup"><span data-stu-id="00361-184">Modify the class so it looks like the class in Listing 1.</span></span>

<span data-ttu-id="00361-185">**Listato 1-`Controllers\HomeController.vb`**</span><span class="sxs-lookup"><span data-stu-id="00361-185">**Listing 1 – `Controllers\HomeController.vb`**</span></span>

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample1.vb)]

<span data-ttu-id="00361-186">L'azione index () nel listato 1 utilizza una classe LINQ to SQL DataContext (MovieDataContext) per rappresentare il database MoviesDB.</span><span class="sxs-lookup"><span data-stu-id="00361-186">The Index() action in Listing 1 uses a LINQ to SQL DataContext class (the MovieDataContext) to represent the MoviesDB database.</span></span> <span data-ttu-id="00361-187">La classe MoveDataContext è stata generata da Visual Studio Object Relational Designer.</span><span class="sxs-lookup"><span data-stu-id="00361-187">The MoveDataContext class was generated by the Visual Studio Object Relational Designer.</span></span>

<span data-ttu-id="00361-188">Viene eseguita una query LINQ su DataContext per recuperare tutti i filmati dalla tabella di database tblMovies.</span><span class="sxs-lookup"><span data-stu-id="00361-188">A LINQ query is performed against the DataContext to retrieve all of the movies from the tblMovies database table.</span></span> <span data-ttu-id="00361-189">L'elenco dei film viene assegnato a una variabile locale denominata Movies.</span><span class="sxs-lookup"><span data-stu-id="00361-189">The list of movies is assigned to a local variable named movies.</span></span> <span data-ttu-id="00361-190">Infine, l'elenco dei film viene passato alla visualizzazione tramite i dati della visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="00361-190">Finally, the list of movies is passed to the view through view data.</span></span>

<span data-ttu-id="00361-191">Per mostrare i film, è necessario modificare la visualizzazione dell'indice.</span><span class="sxs-lookup"><span data-stu-id="00361-191">In order to show the movies, we next need to modify the Index view.</span></span> <span data-ttu-id="00361-192">È possibile trovare la visualizzazione index nella cartella Views\Home\.</span><span class="sxs-lookup"><span data-stu-id="00361-192">You can find the Index view in the Views\Home\ folder.</span></span> <span data-ttu-id="00361-193">Aggiornare la visualizzazione dell'indice in modo che appaia come la visualizzazione nel listato 2.</span><span class="sxs-lookup"><span data-stu-id="00361-193">Update the Index view so that it looks like the view in Listing 2.</span></span>

<span data-ttu-id="00361-194">**Listato 2: `Views\Home\Index.aspx`**</span><span class="sxs-lookup"><span data-stu-id="00361-194">**Listing 2 – `Views\Home\Index.aspx`**</span></span>

[!code-aspx[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample2.aspx)]

<span data-ttu-id="00361-195">Si noti che la vista Indice modificata include una direttiva &lt;% @ Import Namespace%&gt; nella parte superiore della vista.</span><span class="sxs-lookup"><span data-stu-id="00361-195">Notice that the modified Index view includes an &lt;%@ import namespace %&gt; directive at the top of the view.</span></span> <span data-ttu-id="00361-196">Questa direttiva importa lo spazio dei nomi MvcApplication1.</span><span class="sxs-lookup"><span data-stu-id="00361-196">This directive imports the MvcApplication1 namespace.</span></span> <span data-ttu-id="00361-197">Questo spazio dei nomi è necessario per lavorare con le classi del modello, in particolare la classe Movie, nella visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="00361-197">We need this namespace in order to work with the model classes – in particular, the Movie class -- in the view.</span></span>

<span data-ttu-id="00361-198">La vista nel listato 2 contiene un ciclo for each che scorre tutti gli elementi rappresentati dalla proprietà ViewData. Model.</span><span class="sxs-lookup"><span data-stu-id="00361-198">The view in Listing 2 contains a For Each loop that iterates through all of the items represented by the ViewData.Model property.</span></span> <span data-ttu-id="00361-199">Il valore della proprietà title viene visualizzato per ogni film.</span><span class="sxs-lookup"><span data-stu-id="00361-199">The value of the Title property is displayed for each movie.</span></span>

<span data-ttu-id="00361-200">Si noti che viene eseguito il cast del valore della proprietà ViewData. Model a un oggetto IEnumerable.</span><span class="sxs-lookup"><span data-stu-id="00361-200">Notice that the value of the ViewData.Model property is cast to an IEnumerable.</span></span> <span data-ttu-id="00361-201">Questa operazione è necessaria per scorrere in ciclo il contenuto di ViewData. Model.</span><span class="sxs-lookup"><span data-stu-id="00361-201">This is necessary in order to loop through the contents of ViewData.Model.</span></span> <span data-ttu-id="00361-202">Un'altra opzione consiste nel creare una visualizzazione fortemente tipizzata.</span><span class="sxs-lookup"><span data-stu-id="00361-202">Another option here is to create a strongly-typed view.</span></span> <span data-ttu-id="00361-203">Quando si crea una visualizzazione fortemente tipizzata, la proprietà ViewData. Model viene sottoposta a cast in un particolare tipo della classe code-behind di una vista.</span><span class="sxs-lookup"><span data-stu-id="00361-203">When you create a strongly-typed view, you cast the ViewData.Model property to a particular type in a view's code-behind class.</span></span>

<span data-ttu-id="00361-204">Se si esegue l'applicazione dopo aver modificato la classe HomeController e la vista index, si otterrà una pagina vuota.</span><span class="sxs-lookup"><span data-stu-id="00361-204">If you run the application after modifying the HomeController class and the Index view then you will get a blank page.</span></span> <span data-ttu-id="00361-205">Si otterrà una pagina vuota perché non sono presenti record di film nella tabella di database tblMovies.</span><span class="sxs-lookup"><span data-stu-id="00361-205">You'll get a blank page because there are no movie records in the tblMovies database table.</span></span>

<span data-ttu-id="00361-206">Per aggiungere record alla tabella di database tblMovies, fare clic con il pulsante destro del mouse sulla tabella di database tblMovies nella finestra Esplora server (Esplora database finestra in Visual Web Developer) e selezionare l'opzione di menu **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="00361-206">In order to add records to the tblMovies database table, right-click the tblMovies database table in the Server Explorer window (Database Explorer window in Visual Web Developer) and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="00361-207">È possibile inserire record di film usando la griglia visualizzata (vedere la figura 5).</span><span class="sxs-lookup"><span data-stu-id="00361-207">You can insert movie records by using the grid that appears (see Figure 5).</span></span>

<span data-ttu-id="00361-208">[![inserimento di filmati](creating-model-classes-with-linq-to-sql-vb/_static/image17.png)](creating-model-classes-with-linq-to-sql-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="00361-208">[![Inserting movies](creating-model-classes-with-linq-to-sql-vb/_static/image17.png)](creating-model-classes-with-linq-to-sql-vb/_static/image16.png)</span></span>

<span data-ttu-id="00361-209">**Figura 06**: inserimento di filmati ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="00361-209">**Figure 06**: Inserting movies([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image18.png))</span></span>

<span data-ttu-id="00361-210">Dopo aver aggiunto alcuni record del database alla tabella tblMovies e aver eseguito l'applicazione, nella figura 7 verrà visualizzata la pagina.</span><span class="sxs-lookup"><span data-stu-id="00361-210">After you add some database records to the tblMovies table, and you run the application, you'll see the page in Figure 7.</span></span> <span data-ttu-id="00361-211">Tutti i record del database di film vengono visualizzati in un elenco puntato.</span><span class="sxs-lookup"><span data-stu-id="00361-211">All of the movie database records are displayed in a bulleted list.</span></span>

<span data-ttu-id="00361-212">[![la visualizzazione di filmati con la visualizzazione index](creating-model-classes-with-linq-to-sql-vb/_static/image20.png)](creating-model-classes-with-linq-to-sql-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="00361-212">[![Displaying movies with the Index view](creating-model-classes-with-linq-to-sql-vb/_static/image20.png)](creating-model-classes-with-linq-to-sql-vb/_static/image19.png)</span></span>

<span data-ttu-id="00361-213">**Figura 07**: visualizzazione di filmati con la visualizzazione Index ([fare clic per visualizzare l'immagine con dimensioni complete](creating-model-classes-with-linq-to-sql-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="00361-213">**Figure 07**: Displaying movies with the Index view([Click to view full-size image](creating-model-classes-with-linq-to-sql-vb/_static/image21.png))</span></span>

## <a name="using-the-repository-pattern"></a><span data-ttu-id="00361-214">Uso del modello di repository</span><span class="sxs-lookup"><span data-stu-id="00361-214">Using the Repository Pattern</span></span>

<span data-ttu-id="00361-215">Nella sezione precedente sono state usate LINQ to SQL classi direttamente all'interno di un'azione del controller.</span><span class="sxs-lookup"><span data-stu-id="00361-215">In the previous section, we used LINQ to SQL classes directly within a controller action.</span></span> <span data-ttu-id="00361-216">È stata usata la classe MovieDataContext direttamente dall'azione del controller index ().</span><span class="sxs-lookup"><span data-stu-id="00361-216">We used the MovieDataContext class directly from the Index() controller action.</span></span> <span data-ttu-id="00361-217">Non c'è niente di sbagliato in questa operazione nel caso di una semplice applicazione.</span><span class="sxs-lookup"><span data-stu-id="00361-217">There is nothing wrong with doing this in the case of a simple application.</span></span> <span data-ttu-id="00361-218">Tuttavia, lavorare direttamente con LINQ to SQL in una classe controller crea problemi quando è necessario creare un'applicazione più complessa.</span><span class="sxs-lookup"><span data-stu-id="00361-218">However, working directly with LINQ to SQL in a controller class creates problems when you need to build a more complex application.</span></span>

<span data-ttu-id="00361-219">L'utilizzo di LINQ to SQL all'interno di una classe controller rende difficile il passaggio alle tecnologie di accesso ai dati in futuro.</span><span class="sxs-lookup"><span data-stu-id="00361-219">Using LINQ to SQL within a controller class makes it difficult to switch data access technologies in the future.</span></span> <span data-ttu-id="00361-220">È ad esempio possibile decidere di passare dall'utilizzo di Microsoft LINQ to SQL all'utilizzo di Microsoft Entity Framework come tecnologia di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="00361-220">For example, you might decide to switch from using Microsoft LINQ to SQL to using the Microsoft Entity Framework as your data access technology.</span></span> <span data-ttu-id="00361-221">In tal caso, è necessario riscrivere ogni controller che accede al database all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="00361-221">In that case, you would need to rewrite every controller that accesses the database within your application.</span></span>

<span data-ttu-id="00361-222">L'uso di LINQ to SQL all'interno di una classe controller rende anche difficile la creazione di unit test per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="00361-222">Using LINQ to SQL within a controller class also makes it difficult to build unit tests for your application.</span></span> <span data-ttu-id="00361-223">In genere, non si vuole interagire con un database durante l'esecuzione di unit test.</span><span class="sxs-lookup"><span data-stu-id="00361-223">Normally, you do not want to interact with a database when performing unit tests.</span></span> <span data-ttu-id="00361-224">Si vuole usare gli unit test per testare la logica dell'applicazione e non il server di database.</span><span class="sxs-lookup"><span data-stu-id="00361-224">You want to use your unit tests to test your application logic and not your database server.</span></span>

<span data-ttu-id="00361-225">Per creare un'applicazione MVC più adattabile a modifiche future e che può essere testata più facilmente, è consigliabile usare il modello di repository.</span><span class="sxs-lookup"><span data-stu-id="00361-225">In order to build an MVC application that is more adaptable to future change and that can be more easily tested, you should consider using the Repository pattern.</span></span> <span data-ttu-id="00361-226">Quando si usa il modello di repository, si crea una classe di repository separata che contiene tutta la logica di accesso al database.</span><span class="sxs-lookup"><span data-stu-id="00361-226">When you use the Repository pattern, you create a separate repository class that contains all of your database access logic.</span></span>

<span data-ttu-id="00361-227">Quando si crea la classe del repository, si crea un'interfaccia che rappresenta tutti i metodi usati dalla classe del repository.</span><span class="sxs-lookup"><span data-stu-id="00361-227">When you create the repository class, you create an interface that represents all of the methods used by the repository class.</span></span> <span data-ttu-id="00361-228">All'interno dei controller si scrive il codice in base all'interfaccia anziché al repository.</span><span class="sxs-lookup"><span data-stu-id="00361-228">Within your controllers, you write your code against the interface instead of the repository.</span></span> <span data-ttu-id="00361-229">In questo modo, è possibile implementare il repository utilizzando tecnologie di accesso ai dati diverse in futuro.</span><span class="sxs-lookup"><span data-stu-id="00361-229">That way, you can implement the repository using different data access technologies in the future.</span></span>

<span data-ttu-id="00361-230">L'interfaccia nel listato 3 è denominata IMovieRepository e rappresenta un singolo metodo denominato ListAll ().</span><span class="sxs-lookup"><span data-stu-id="00361-230">The interface in Listing 3 is named IMovieRepository and it represents a single method named ListAll().</span></span>

<span data-ttu-id="00361-231">**Listato 3-`Models\IMovieRepository.vb`**</span><span class="sxs-lookup"><span data-stu-id="00361-231">**Listing 3 – `Models\IMovieRepository.vb`**</span></span>

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample3.vb)]

<span data-ttu-id="00361-232">La classe del repository nel listato 4 implementa l'interfaccia IMovieRepository.</span><span class="sxs-lookup"><span data-stu-id="00361-232">The repository class in Listing 4 implements the IMovieRepository interface.</span></span> <span data-ttu-id="00361-233">Si noti che contiene un metodo denominato ListAll () che corrisponde al metodo richiesto dall'interfaccia IMovieRepository.</span><span class="sxs-lookup"><span data-stu-id="00361-233">Notice that it contains a method named ListAll() that corresponds to the method required by the IMovieRepository interface.</span></span>

<span data-ttu-id="00361-234">**Listato 4-`Models\MovieRepository.vb`**</span><span class="sxs-lookup"><span data-stu-id="00361-234">**Listing 4 – `Models\MovieRepository.vb`**</span></span>

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample4.vb)]

<span data-ttu-id="00361-235">Infine, la classe MoviesController nel listato 5 usa il modello di repository.</span><span class="sxs-lookup"><span data-stu-id="00361-235">Finally, the MoviesController class in Listing 5 uses the Repository pattern.</span></span> <span data-ttu-id="00361-236">Non usa più direttamente le classi LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="00361-236">It no longer uses LINQ to SQL classes directly.</span></span>

<span data-ttu-id="00361-237">**Elenco 5-`Controllers\MoviesController.vb`**</span><span class="sxs-lookup"><span data-stu-id="00361-237">**Listing 5 – `Controllers\MoviesController.vb`**</span></span>

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample5.vb)]

<span data-ttu-id="00361-238">Si noti che la classe MoviesController nel listato 5 ha due costruttori.</span><span class="sxs-lookup"><span data-stu-id="00361-238">Notice that the MoviesController class in Listing 5 has two constructors.</span></span> <span data-ttu-id="00361-239">Il primo costruttore, il costruttore senza parametri, viene chiamato quando l'applicazione è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="00361-239">The first constructor, the parameterless constructor, is called when your application is running.</span></span> <span data-ttu-id="00361-240">Questo costruttore crea un'istanza della classe MovieRepository e la passa al secondo costruttore.</span><span class="sxs-lookup"><span data-stu-id="00361-240">This constructor creates an instance of the MovieRepository class and passes it to the second constructor.</span></span>

<span data-ttu-id="00361-241">Il secondo costruttore ha un solo parametro: un parametro IMovieRepository.</span><span class="sxs-lookup"><span data-stu-id="00361-241">The second constructor has a single parameter: an IMovieRepository parameter.</span></span> <span data-ttu-id="00361-242">Questo costruttore assegna semplicemente il valore del parametro a un campo a livello di classe denominato \_repository.</span><span class="sxs-lookup"><span data-stu-id="00361-242">This constructor simply assigns the value of the parameter to a class-level field named \_repository.</span></span>

<span data-ttu-id="00361-243">La classe MoviesController sta sfruttando un modello di progettazione software denominato modello di inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="00361-243">The MoviesController class is taking advantage of a software design pattern called the Dependency Injection pattern.</span></span> <span data-ttu-id="00361-244">In particolare, viene usato un elemento denominato inserimento delle dipendenze del costruttore.</span><span class="sxs-lookup"><span data-stu-id="00361-244">In particular, it is using something called Constructor Dependency Injection.</span></span> <span data-ttu-id="00361-245">Per altre informazioni su questo modello, vedere l'articolo seguente di Martin Fowler:</span><span class="sxs-lookup"><span data-stu-id="00361-245">You can read more about this pattern by reading the following article by Martin Fowler:</span></span>

[http://martinfowler.com/articles/injection.html](http://martinfowler.com/articles/injection.html)

<span data-ttu-id="00361-246">Si noti che tutto il codice nella classe MoviesController (ad eccezione del primo costruttore) interagisce con l'interfaccia IMovieRepository anziché con la classe MovieRepository effettiva.</span><span class="sxs-lookup"><span data-stu-id="00361-246">Notice that all of the code in the MoviesController class (with the exception of the first constructor) interacts with the IMovieRepository interface instead of the actual MovieRepository class.</span></span> <span data-ttu-id="00361-247">Il codice interagisce con un'interfaccia astratta anziché un'implementazione concreta dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="00361-247">The code interacts with an abstract interface instead of a concrete implementation of the interface.</span></span>

<span data-ttu-id="00361-248">Se si vuole modificare la tecnologia di accesso ai dati usata dall'applicazione, è possibile implementare semplicemente l'interfaccia IMovieRepository con una classe che usa la tecnologia di accesso al database alternativa.</span><span class="sxs-lookup"><span data-stu-id="00361-248">If you want to modify the data access technology used by the application then you can simply implement the IMovieRepository interface with a class that uses the alternative database access technology.</span></span> <span data-ttu-id="00361-249">Ad esempio, è possibile creare una classe EntityFrameworkMovieRepository o una classe SubSonicMovieRepository.</span><span class="sxs-lookup"><span data-stu-id="00361-249">For example, you could create an EntityFrameworkMovieRepository class or a SubSonicMovieRepository class.</span></span> <span data-ttu-id="00361-250">Poiché la classe controller viene programmata in base all'interfaccia, è possibile passare una nuova implementazione di IMovieRepository alla classe controller e la classe continuerà a funzionare.</span><span class="sxs-lookup"><span data-stu-id="00361-250">Because the controller class is programmed against the interface, you can pass a new implementation of IMovieRepository to the controller class and the class would continue to work.</span></span>

<span data-ttu-id="00361-251">Inoltre, se si desidera testare la classe MoviesController, è possibile passare una classe di repository di film Fake al MoviesController.</span><span class="sxs-lookup"><span data-stu-id="00361-251">Furthermore, if you want to test the MoviesController class, then you can pass a fake movie repository class to the MoviesController.</span></span> <span data-ttu-id="00361-252">È possibile implementare la classe IMovieRepository con una classe che non accede effettivamente al database, ma contiene tutti i metodi richiesti dell'interfaccia IMovieRepository.</span><span class="sxs-lookup"><span data-stu-id="00361-252">You can implement the IMovieRepository class with a class that does not actually access the database but contains all of the required methods of the IMovieRepository interface.</span></span> <span data-ttu-id="00361-253">In questo modo, è possibile unit test la classe MoviesController senza accedere effettivamente a un database reale.</span><span class="sxs-lookup"><span data-stu-id="00361-253">That way, you can unit test the MoviesController class without actually accessing a real database.</span></span>

## <a name="summary"></a><span data-ttu-id="00361-254">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="00361-254">Summary</span></span>

<span data-ttu-id="00361-255">L'obiettivo di questa esercitazione è illustrare come creare classi di modelli MVC sfruttando i vantaggi di Microsoft LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="00361-255">The goal of this tutorial was to demonstrate how you can create MVC model classes by taking advantage of Microsoft LINQ to SQL.</span></span> <span data-ttu-id="00361-256">Sono state esaminate due strategie per visualizzare i dati del database in un'applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="00361-256">We examined two strategies for displaying database data in an ASP.NET MVC application.</span></span> <span data-ttu-id="00361-257">In primo luogo, sono state create LINQ to SQL classi e sono state usate direttamente le classi all'interno di un'azione del controller.</span><span class="sxs-lookup"><span data-stu-id="00361-257">First, we created LINQ to SQL classes and used the classes directly within a controller action.</span></span> <span data-ttu-id="00361-258">L'uso di LINQ to SQL classi all'interno di un controller consente di visualizzare in modo rapido e semplice i dati del database in un'applicazione MVC.</span><span class="sxs-lookup"><span data-stu-id="00361-258">Using LINQ to SQL classes within a controller enables you to quickly and easily display database data in an MVC application.</span></span>

<span data-ttu-id="00361-259">Successivamente, è stato esplorato un percorso leggermente più complesso, ma decisamente più virtuoso, per la visualizzazione dei dati del database.</span><span class="sxs-lookup"><span data-stu-id="00361-259">Next, we explored a slightly more difficult, but definitely more virtuous, path for displaying database data.</span></span> <span data-ttu-id="00361-260">Abbiamo sfruttato il modello di repository e abbiamo inserito tutta la logica di accesso al database in una classe di repository separata.</span><span class="sxs-lookup"><span data-stu-id="00361-260">We took advantage of the Repository pattern and placed all of our database access logic in a separate repository class.</span></span> <span data-ttu-id="00361-261">Nel nostro controller abbiamo scritto tutto il codice in base a un'interfaccia anziché a una classe concreta.</span><span class="sxs-lookup"><span data-stu-id="00361-261">In our controller, we wrote all of our code against an interface instead of a concrete class.</span></span> <span data-ttu-id="00361-262">Il vantaggio del modello di repository è che consente di modificare facilmente le tecnologie di accesso ai database in futuro e consente di testare facilmente le classi del controller.</span><span class="sxs-lookup"><span data-stu-id="00361-262">The advantage of the Repository pattern is that it enables us to easily change database access technologies in the future and it enables us to easily test our controller classes.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="00361-263">[Precedente](creating-model-classes-with-the-entity-framework-vb.md)
> [Successivo](displaying-a-table-of-database-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="00361-263">[Previous](creating-model-classes-with-the-entity-framework-vb.md)
[Next](displaying-a-table-of-database-data-vb.md)</span></span>
