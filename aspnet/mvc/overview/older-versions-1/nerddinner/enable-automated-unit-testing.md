---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Abilitazione di unit test automatizzati Documenti Microsoft
author: rick-anderson
description: Passaggio 12 viene illustrato come sviluppare una suite di unit test automatizzati che verificano la funzionalità di NerdDinner e che ci darà la sicurezza di apportare modifiche...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 7fe84efd9e4cc359c19d5ab9e22c579b80207e9c
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541468"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="efefd-103">Abilitare unit test automatici</span><span class="sxs-lookup"><span data-stu-id="efefd-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="efefd-104">da parte [di Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="efefd-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="efefd-105">Scarica il PDF</span><span class="sxs-lookup"><span data-stu-id="efefd-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="efefd-106">Questo è il passaggio 12 di [un'esercitazione gratuita sull'applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che illustra come compilare un'applicazione Web piccola ma completa utilizzando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="efefd-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="efefd-107">Passaggio 12 viene illustrato come sviluppare una suite di unit test automatizzati che verificano la funzionalità di NerdDinner e che ci darà la sicurezza di apportare modifiche e miglioramenti all'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="efefd-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="efefd-108">Se si utilizza ASP.NET MVC 3, è consigliabile seguire le esercitazioni [Introduzione a MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [ALL'archivio musicale MVC.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="efefd-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="efefd-109">Passaggio 12 di NerdDinner: Unit Test</span><span class="sxs-lookup"><span data-stu-id="efefd-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="efefd-110">Sviluppiamo una suite di unit test automatizzati che verificano la nostra funzionalità NerdDinner e che ci daranno la sicurezza di apportare modifiche e miglioramenti all'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="efefd-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="efefd-111">Perché Unit Test?</span><span class="sxs-lookup"><span data-stu-id="efefd-111">Why Unit Test?</span></span>

<span data-ttu-id="efefd-112">Una mattina, durante l'ingresso nel processo, una mattina avrai un improvviso lampo di ispirazione su un'applicazione su cui stai lavorando.</span><span class="sxs-lookup"><span data-stu-id="efefd-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="efefd-113">Ti rendi conto che c'è una modifica che puoi implementare che renderà l'applicazione notevolmente migliore.</span><span class="sxs-lookup"><span data-stu-id="efefd-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="efefd-114">Potrebbe essere un refactoring che pulisce il codice, aggiunge una nuova funzionalità o corregge un bug.</span><span class="sxs-lookup"><span data-stu-id="efefd-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="efefd-115">La domanda che ti si pone quando si arriva al computer è – "quanto è sicuro per fare questo miglioramento?"</span><span class="sxs-lookup"><span data-stu-id="efefd-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="efefd-116">Cosa succede se fare il cambiamento ha effetti collaterali o rompe qualcosa?</span><span class="sxs-lookup"><span data-stu-id="efefd-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="efefd-117">La modifica potrebbe essere semplice e richiedere solo pochi minuti per l'implementazione, ma cosa succede se sono necessarie ore per testare manualmente tutti gli scenari dell'applicazione?</span><span class="sxs-lookup"><span data-stu-id="efefd-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="efefd-118">Cosa succede se si dimentica di coprire uno scenario e un'applicazione interrotta entra in produzione?</span><span class="sxs-lookup"><span data-stu-id="efefd-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="efefd-119">Fare questo miglioramento vale davvero tutto lo sforzo?</span><span class="sxs-lookup"><span data-stu-id="efefd-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="efefd-120">Gli unit test automatizzati possono fornire una rete di sicurezza che consente di migliorare continuamente le applicazioni ed evitare di avere paura del codice su cui si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="efefd-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="efefd-121">Avere test automatizzati che verificano rapidamente la funzionalità consente di codificare con sicurezza e consentono di apportare miglioramenti che altrimenti non si sarebbe sentito a proprio agio.</span><span class="sxs-lookup"><span data-stu-id="efefd-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="efefd-122">Contribuiscono inoltre a creare soluzioni più gestibili e che hanno una durata maggiore, il che porta a un ritorno sull'investimento molto più elevato.</span><span class="sxs-lookup"><span data-stu-id="efefd-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="efefd-123">Il framework di MVC ASP.NET semplifica e naturale la funzionalità dell'applicazione di unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="efefd-124">Abilita inoltre un flusso di lavoro TDD (Test Driven Development) che consente lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="efefd-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="efefd-125">Progetto NerdDinner.Tests</span><span class="sxs-lookup"><span data-stu-id="efefd-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="efefd-126">Quando abbiamo creato l'applicazione NerdDinner all'inizio di questa esercitazione, ci è stata richiesta una finestra di dialogo che chiede se si desidera creare un progetto di unit test per andare avanti con il progetto di applicazione:When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go with the application project:</span><span class="sxs-lookup"><span data-stu-id="efefd-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="efefd-127">Abbiamo mantenuto selezionato il pulsante di opzione "Sì, crea un progetto di unit test", che ha comportato l'aggiunta di un progetto "NerdDinner.Tests" alla soluzione:</span><span class="sxs-lookup"><span data-stu-id="efefd-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="efefd-128">Il progetto NerdDinner.Tests fa riferimento all'assembly del progetto dell'applicazione NerdDinner e consente di aggiungervi facilmente test automatizzati che verificano la funzionalità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="efefd-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="efefd-129">Creazione di unit test per la classe di modello DinnerCreating Unit Tests for our Dinner Model Class</span><span class="sxs-lookup"><span data-stu-id="efefd-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="efefd-130">Aggiungiamo alcuni test al nostro progetto NerdDinner.Tests che verificano la classe Dinner che abbiamo creato quando abbiamo creato il nostro livello di modello.</span><span class="sxs-lookup"><span data-stu-id="efefd-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="efefd-131">Inizieremo creando una nuova cartella all'interno del nostro progetto di test chiamata "Modelli" in cui inseriremo i nostri test relativi al modello.</span><span class="sxs-lookup"><span data-stu-id="efefd-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="efefd-132">Faremo quindi clic con il pulsante destro del mouse sulla cartella e sceglieremo il comando di menu **Aggiungi-&gt;Nuovo test.**</span><span class="sxs-lookup"><span data-stu-id="efefd-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="efefd-133">Verrà eseguito la finestra di dialogo "Aggiungi nuovo test".</span><span class="sxs-lookup"><span data-stu-id="efefd-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="efefd-134">Sceglieremo di creare uno "Unit Test" e denominarlo "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="efefd-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="efefd-135">Quando si fa clic sul pulsante "ok" Visual Studio aggiungerà (e aprire) un file di DinnerTest.cs al progetto:</span><span class="sxs-lookup"><span data-stu-id="efefd-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="efefd-136">Il modello di unit test predefinito di Visual Studio ha un gruppo di codice boiler-plate all'interno di esso che trovo un po 'disordinato.</span><span class="sxs-lookup"><span data-stu-id="efefd-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="efefd-137">Puliamolo per contenere solo il codice qui sotto:</span><span class="sxs-lookup"><span data-stu-id="efefd-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="efefd-138">L'attributo [TestClass] nella classe DinnerTest precedente lo identifica come una classe che conterrà i test, nonché il codice facoltativo di inizializzazione e teardown dei test.</span><span class="sxs-lookup"><span data-stu-id="efefd-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="efefd-139">È possibile definire i test al suo interno aggiungendo metodi pubblici che dispongono di un [TestMethod] attributo su di essi.</span><span class="sxs-lookup"><span data-stu-id="efefd-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="efefd-140">Di seguito sono riportati i primi di due test che aggiungeremo che esercitano la nostra lezione Dinner.</span><span class="sxs-lookup"><span data-stu-id="efefd-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="efefd-141">Il primo test verifica che la cena non sia valida se viene creata una nuova cena senza che tutte le proprietà siano impostate correttamente.</span><span class="sxs-lookup"><span data-stu-id="efefd-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="efefd-142">Il secondo test verifica che la cena sia valida quando una cena ha tutte le proprietà impostate con valori validi:The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span><span class="sxs-lookup"><span data-stu-id="efefd-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="efefd-143">Noterete sopra che i nostri nomi di test sono molto espliciti (e un po 'dettagliato).</span><span class="sxs-lookup"><span data-stu-id="efefd-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="efefd-144">Stiamo facendo questo perché potremmo finire per creare centinaia o migliaia di piccoli test, e vogliamo rendere più facile determinare rapidamente l'intento e il comportamento di ciascuno di essi (soprattutto quando stiamo guardando attraverso un elenco di errori in un test runner).</span><span class="sxs-lookup"><span data-stu-id="efefd-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="efefd-145">I nomi dei test devono essere denominati in base alla funzionalità che stanno testando.</span><span class="sxs-lookup"><span data-stu-id="efefd-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="efefd-146">Sopra stiamo usando un\_modello\_di denominazione "Noun Should Verb".</span><span class="sxs-lookup"><span data-stu-id="efefd-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="efefd-147">Stiamo strutturando i test utilizzando il modello di test "AAA" – che sta per "Arrange, Act, Assert":</span><span class="sxs-lookup"><span data-stu-id="efefd-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="efefd-148">Organizzare: impostare l'unità sottoposta a test</span><span class="sxs-lookup"><span data-stu-id="efefd-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="efefd-149">Atto: Esercitare l'unità sotto test e catturare i risultati</span><span class="sxs-lookup"><span data-stu-id="efefd-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="efefd-150">Asserzione: verificare il comportamentoAssert: Verify the behavior</span><span class="sxs-lookup"><span data-stu-id="efefd-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="efefd-151">Quando scriviamo test vogliamo evitare che i singoli test facciano troppo.</span><span class="sxs-lookup"><span data-stu-id="efefd-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="efefd-152">Ogni test deve invece verificare un solo concetto (che renderà molto più semplice individuare la causa degli errori).</span><span class="sxs-lookup"><span data-stu-id="efefd-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="efefd-153">Una buona linea guida consiste nel provare e avere una sola istruzione assert per ogni test.</span><span class="sxs-lookup"><span data-stu-id="efefd-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="efefd-154">Se si dispone di più di un'istruzione assert in un metodo di test, assicurarsi che vengano tutti utilizzati per testare lo stesso concetto.</span><span class="sxs-lookup"><span data-stu-id="efefd-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="efefd-155">In caso di dubbio, fare un altro test.</span><span class="sxs-lookup"><span data-stu-id="efefd-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="efefd-156">Esecuzione test</span><span class="sxs-lookup"><span data-stu-id="efefd-156">Running Tests</span></span>

<span data-ttu-id="efefd-157">Visual Studio 2008 Professional (e versioni successive) include un test runner incorporato che può essere utilizzato per eseguire progetti di unit test di Visual Studio all'interno dell'IDE.</span><span class="sxs-lookup"><span data-stu-id="efefd-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="efefd-158">È possibile selezionare il comando di menu **Test-&gt;Esegui-&gt;Tutti i test nella soluzione** (o digitare Ctrl R, A) per eseguire tutti gli unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="efefd-159">Oppure, in alternativa, è possibile posizionare il cursore all'interno di una classe di test o di un metodo di test specifico e utilizzare il comando di menu **Test-Esecuzione-Test&gt;&gt;nel contesto corrente** (o digitare Ctrl R, T) per eseguire un sottoinsieme degli unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="efefd-160">Posizionare il cursore all'interno della classe DinnerTest e digitare "Ctrl R, T" per eseguire i due test appena definiti.</span><span class="sxs-lookup"><span data-stu-id="efefd-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="efefd-161">Quando si esegue questa operazione verrà visualizzata una finestra "Risultati test" all'interno di Visual Studio e verranno visualizzati i risultati dell'esecuzione dei test elencati al suo interno:When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span><span class="sxs-lookup"><span data-stu-id="efefd-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="efefd-162">*Nota: La finestra dei risultati del test VS non mostra la colonna Nome classe per impostazione predefinita. È possibile aggiungerlo facendo clic con il pulsante destro del mouse all'interno della finestra Risultati test e utilizzando il comando di menu Aggiungi/Rimuovi colonne.*</span><span class="sxs-lookup"><span data-stu-id="efefd-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="efefd-163">I nostri due test hanno richiesto solo una frazione di secondo per essere eseguiti – e come potete vedere entrambi sono passati.</span><span class="sxs-lookup"><span data-stu-id="efefd-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="efefd-164">Ora possiamo continuare e aumentarli creando test aggiuntivi che verificano le convalide delle regole specifiche, oltre a coprire i due metodi helper, IsUserHost() e IsUserRegistered(), che abbiamo aggiunto alla classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="efefd-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="efefd-165">Avere tutti questi test in atto per la classe Dinner renderà molto più facile e sicuro aggiungere nuove regole di business e convalide in futuro.</span><span class="sxs-lookup"><span data-stu-id="efefd-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="efefd-166">È possibile aggiungere la nuova logica della regola a Dinner e quindi in pochi secondi verificare che non abbia interrotto alcuna delle funzionalità logiche precedenti.</span><span class="sxs-lookup"><span data-stu-id="efefd-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="efefd-167">Si noti come l'utilizzo di un nome di test descrittivo semplifica la comprensione rapida di ciò che ogni test sta verificando.</span><span class="sxs-lookup"><span data-stu-id="efefd-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="efefd-168">È consigliabile utilizzare il comando di menu&gt; **Strumenti-Opzioni,&gt;** aprire la schermata di configurazione Strumenti di test- Esecuzione test e selezionare la casella di controllo "Fare doppio clic su un risultato dello unit test non riuscito o non conclusivo visualizza il punto di errore nel test".</span><span class="sxs-lookup"><span data-stu-id="efefd-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="efefd-169">In questo modo sarà possibile fare doppio clic su un errore nella finestra dei risultati del test e passare immediatamente all'errore di asserzione.</span><span class="sxs-lookup"><span data-stu-id="efefd-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="efefd-170">Creazione di unit test DinnersControllerCreating DinnersController Unit Tests</span><span class="sxs-lookup"><span data-stu-id="efefd-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="efefd-171">Creiamo ora alcuni unit test che verificano la funzionalità DinnersController.Let's now create some unit tests that verify our DinnersController functionality.</span><span class="sxs-lookup"><span data-stu-id="efefd-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="efefd-172">Inizieremo facendo clic con il pulsante destro del mouse sulla cartella "Controllers" all'interno del nostro progetto di test e quindi scegliere il **Aggiungi-&gt;Nuovo test** comando di menu.</span><span class="sxs-lookup"><span data-stu-id="efefd-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="efefd-173">Creeremo uno "Unit Test" e lo chiameremo "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="efefd-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="efefd-174">Creeremo due metodi di test che verificano il metodo di azione Details() su DinnersController.</span><span class="sxs-lookup"><span data-stu-id="efefd-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="efefd-175">Il primo verificherà che venga restituito un oggetto View quando viene richiesta una cena esistente.</span><span class="sxs-lookup"><span data-stu-id="efefd-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="efefd-176">Il secondo verificherà che venga restituita una visualizzazione "NotFound" quando viene richiesta una cena inesistente:</span><span class="sxs-lookup"><span data-stu-id="efefd-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="efefd-177">Il codice precedente viene compilato pulito.</span><span class="sxs-lookup"><span data-stu-id="efefd-177">The above code compiles clean.</span></span> <span data-ttu-id="efefd-178">Quando eseguiamo i test, tuttavia, entrambi hanno esito negativo:When we run the tests, though, both fail:</span><span class="sxs-lookup"><span data-stu-id="efefd-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="efefd-179">Se osserviamo i messaggi di errore, vedremo che il motivo per cui i test non sono riusciti è perché la nostra classe DinnersRepository non è stata in grado di connettersi a un database.</span><span class="sxs-lookup"><span data-stu-id="efefd-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="efefd-180">L'applicazione NerdDinner utilizza una stringa di connessione a un file\_SQL Server Express locale che si trova nella directory dati app del progetto di applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="efefd-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="efefd-181">Poiché il progetto NerdDinner.Tests viene compilato ed eseguito in una directory diversa rispetto al progetto dell'applicazione, il percorso relativo della stringa di connessione non è corretto.</span><span class="sxs-lookup"><span data-stu-id="efefd-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="efefd-182">È *possibile* risolvere questo problema copiando il file di database SQL Express nel progetto di test e quindi aggiungervi una stringa di connessione di test appropriata nel file App.config del progetto di test.</span><span class="sxs-lookup"><span data-stu-id="efefd-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="efefd-183">Questo otterrebbe i test di cui sopra sbloccato e in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="efefd-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="efefd-184">Il codice di unit test che utilizza un database reale, tuttavia, comporta una serie di sfide.</span><span class="sxs-lookup"><span data-stu-id="efefd-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="efefd-185">In particolare:</span><span class="sxs-lookup"><span data-stu-id="efefd-185">Specifically:</span></span>

- <span data-ttu-id="efefd-186">Rallenta in modo significativo il tempo di esecuzione degli unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="efefd-187">Maggiore è il tempo necessario per eseguire i test, minore è la probabilità di eseguirli frequentemente.</span><span class="sxs-lookup"><span data-stu-id="efefd-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="efefd-188">Idealmente si desidera che gli unit test siano in grado di essere eseguiti in pochi secondi e che sia qualcosa che si fa naturalmente come la compilazione del progetto.</span><span class="sxs-lookup"><span data-stu-id="efefd-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="efefd-189">Complica la logica di impostazione e pulizia all'interno dei test.</span><span class="sxs-lookup"><span data-stu-id="efefd-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="efefd-190">Si desidera che ogni unit test sia isolato e indipendente dagli altri (senza effetti collaterali o dipendenze).</span><span class="sxs-lookup"><span data-stu-id="efefd-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="efefd-191">Quando si lavora su un database reale è necessario essere consapevoli dello stato e reimpostarlo tra i test.</span><span class="sxs-lookup"><span data-stu-id="efefd-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="efefd-192">Diamo un'occhiata a un modello di progettazione chiamato "iniezione di dipendenza" che può aiutarci a risolvere questi problemi ed evitare la necessità di utilizzare un database reale con i nostri test.</span><span class="sxs-lookup"><span data-stu-id="efefd-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="efefd-193">Inserimento di dipendenze</span><span class="sxs-lookup"><span data-stu-id="efefd-193">Dependency Injection</span></span>

<span data-ttu-id="efefd-194">In questo momento DinnersController è strettamente "accoppiato" per la classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="efefd-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="efefd-195">"Accoppiamento" si riferisce a una situazione in cui una classe si basa in modo esplicito su un'altra classe per funzionare:</span><span class="sxs-lookup"><span data-stu-id="efefd-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="efefd-196">Poiché la classe DinnerRepository richiede l'accesso a un database, la dipendenza strettamente accoppiata della classe DinnersController sul DinnerRepository finisce per richiedere di avere un database per i metodi di azione DinnersController da testare.</span><span class="sxs-lookup"><span data-stu-id="efefd-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="efefd-197">È possibile aggirare questo problema utilizzando un modello di progettazione denominato "iniezione di dipendenza", ovvero un approccio in cui le dipendenze (ad esempio le classi di repository che forniscono l'accesso ai dati) non vengono più create in modo implicito all'interno di classi che le utilizzano.</span><span class="sxs-lookup"><span data-stu-id="efefd-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="efefd-198">Al contrario, le dipendenze possono essere passate in modo esplicito alla classe che le utilizza utilizzando gli argomenti del costruttore.</span><span class="sxs-lookup"><span data-stu-id="efefd-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="efefd-199">Se le dipendenze vengono definite tramite interfacce, abbiamo la flessibilità di passare implementazioni di dipendenza "falsi" per gli scenari di unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="efefd-200">In questo modo è possibile creare implementazioni di dipendenze specifiche del test che non richiedono effettivamente l'accesso a un database.</span><span class="sxs-lookup"><span data-stu-id="efefd-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="efefd-201">Per vedere questo in azione, è possibile implementare inserimento delle dipendenze con il nostro DinnersController.To see this in action, let's implement dependency injection with our DinnersController.</span><span class="sxs-lookup"><span data-stu-id="efefd-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="efefd-202">Estrazione di un'interfaccia IDinnerRepositoryExtracting an IDinnerRepository interface</span><span class="sxs-lookup"><span data-stu-id="efefd-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="efefd-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span><span class="sxs-lookup"><span data-stu-id="efefd-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="efefd-204">È possibile definire manualmente questo contratto di interfaccia facendo clic con il pulsante destro del mouse sulla cartella Modelli, quindi scegliendo il comando di menu **Aggiungi-&gt;Nuovo elemento** e creando una nuova interfaccia denominata IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="efefd-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="efefd-205">In alternativa è possibile utilizzare gli strumenti di refactoring incorporati in Visual Studio Professional (e versioni successive) per estrarre e creare automaticamente un'interfaccia dalla classe DinnerRepository esistente.</span><span class="sxs-lookup"><span data-stu-id="efefd-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="efefd-206">Per estrarre questa interfaccia tramite VS, è sufficiente posizionare il cursore nell'editor di testo sulla classe DinnerRepository, quindi fare clic con il pulsante destro del mouse e scegliere il comando di menu **Refactor-&gt;Extract Interface:**</span><span class="sxs-lookup"><span data-stu-id="efefd-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="efefd-207">Verrà visualizzata la finestra di dialogo "Estrai interfaccia" e verrà richiesto il nome dell'interfaccia da creare.</span><span class="sxs-lookup"><span data-stu-id="efefd-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="efefd-208">Per impostazione predefinita verrà impostato su IDinnerRepository e verrà selezionato automaticamente tutti i metodi pubblici nella classe DinnerRepository esistente da aggiungere all'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="efefd-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="efefd-209">Quando si fa clic sul pulsante "ok", Visual Studio aggiungerà una nuova interfaccia IDinnerRepository all'applicazione:When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span><span class="sxs-lookup"><span data-stu-id="efefd-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="efefd-210">E la nostra classe DinnerRepository esistente verrà aggiornata in modo da implementa l'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="efefd-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="efefd-211">Aggiornamento di DinnersController per supportare l'inserimento del costruttoreUpdating DinnersController to support constructor injection</span><span class="sxs-lookup"><span data-stu-id="efefd-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="efefd-212">Verrà ora aggiornata la classe DinnersController per usare la nuova interfaccia.</span><span class="sxs-lookup"><span data-stu-id="efefd-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="efefd-213">Attualmente DinnersController è hardcoded in modo che il suo campo "dinnerRepository" è sempre una classe DinnerRepository:Currently DinnersController is hardcoded such that its "dinnerRepository" field is always a DinnerRepository class:</span><span class="sxs-lookup"><span data-stu-id="efefd-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="efefd-214">Lo modificheremo in modo che il campo "dinnerRepository" sia di tipo IDinnerRepository invece di DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="efefd-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="efefd-215">Aggiungeremo quindi due costruttori DinnersController pubblici.</span><span class="sxs-lookup"><span data-stu-id="efefd-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="efefd-216">Uno dei costruttori consente un IDinnerRepository da passare come argomento.</span><span class="sxs-lookup"><span data-stu-id="efefd-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="efefd-217">L'altro è un costruttore predefinito che usa l'implementazione DinnerRepository esistente:The other is a default constructor that uses our existing DinnerRepository implementation:</span><span class="sxs-lookup"><span data-stu-id="efefd-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="efefd-218">Poiché ASP.NET MVC per impostazione predefinita crea classi controller utilizzando i costruttori predefiniti, il nostro DinnersController in fase di esecuzione continuerà a utilizzare il DinnerRepository classe per eseguire l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="efefd-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="efefd-219">È ora possibile aggiornare gli unit test, tuttavia, per passare un'implementazione del repository cena "falso" utilizzando il costruttore di parametro.</span><span class="sxs-lookup"><span data-stu-id="efefd-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="efefd-220">Questo "falso" repository cena non richiederà l'accesso a un database reale, e invece utilizzerà dati di esempio in memoria.</span><span class="sxs-lookup"><span data-stu-id="efefd-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="efefd-221">Creazione della classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="efefd-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="efefd-222">Creiamo una classe FakeDinnerRepository.Let's create a FakeDinnerRepository class.</span><span class="sxs-lookup"><span data-stu-id="efefd-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="efefd-223">Inizieremo creando una directory "Fakes" all'interno del nostro progetto NerdDinner.Tests e quindi aggiungere una nuova classe FakeDinnerRepository (fare clic con il pulsante destro del mouse sulla cartella e scegliere **Aggiungi-&gt;Nuova classe**):</span><span class="sxs-lookup"><span data-stu-id="efefd-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="efefd-224">Aggiorneremo il codice in modo che la classe FakeDinnerRepository implementi l'interfaccia IDinnerRepository.We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span><span class="sxs-lookup"><span data-stu-id="efefd-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="efefd-225">Possiamo quindi fare clic destro su di esso e scegliere il comando del menu di scelta rapida "Implementa interfaccia IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="efefd-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="efefd-226">In questo modo Visual Studio aggiungerà automaticamente tutti i membri dell'interfaccia IDinnerRepository alla classe FakeDinnerRepository con implementazioni "stub out" predefinite:</span><span class="sxs-lookup"><span data-stu-id="efefd-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="efefd-227">È quindi possibile aggiornare l'implementazione di FakeDinnerRepository per lavorare fuori di una raccolta List Dinner in memoria passata come argomento del costruttore:We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed ed it as a constructor argument:</span><span class="sxs-lookup"><span data-stu-id="efefd-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="efefd-228">Ora abbiamo un'implementazione fittizia di IDinnerRepository che non richiede un database e può invece lavorare fuori un elenco in memoria di Dinner oggetti.</span><span class="sxs-lookup"><span data-stu-id="efefd-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="efefd-229">Utilizzo di FakeDinnerRepository con unit testUsing the FakeDinnerRepository with Unit Tests</span><span class="sxs-lookup"><span data-stu-id="efefd-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="efefd-230">Torniamo agli unit test DinnersController non riusciti in precedenza perché il database non era disponibile.</span><span class="sxs-lookup"><span data-stu-id="efefd-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="efefd-231">È possibile aggiornare i metodi di test per utilizzare un FakeDinnerRepository popolato con dati Dinner in memoria di esempio per il DinnersController utilizzando il codice seguente:We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span><span class="sxs-lookup"><span data-stu-id="efefd-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="efefd-232">E ora quando eseguiamo questi test passano entrambi:</span><span class="sxs-lookup"><span data-stu-id="efefd-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="efefd-233">Meglio di tutti, prendono solo una frazione di secondo per l'esecuzione, e non richiedono alcuna logica di installazione / pulizia complicata.</span><span class="sxs-lookup"><span data-stu-id="efefd-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="efefd-234">È ora possibile unit test di tutto il codice del metodo di azione DinnersController (inclusi elenco, paging, dettagli, creazione, aggiornamento ed eliminazione) senza mai dover connettersi a un database reale.</span><span class="sxs-lookup"><span data-stu-id="efefd-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="efefd-235">**Argomento collaterale: Framework di inserimento delle dipendenze**</span><span class="sxs-lookup"><span data-stu-id="efefd-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="efefd-236">L'esecuzione dell'inserimento manuale delle dipendenze (come sopra) funziona correttamente, ma diventa più difficile da gestire con l'aumentare del numero di dipendenze e componenti in un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="efefd-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="efefd-237">Esistono diversi framework di inserimento delle dipendenze per .NET che consentono di fornire una flessibilità ancora maggiore per la gestione delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="efefd-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="efefd-238">Questi framework, anche a volte chiamati contenitori "Inversione del controllo" (IoC), forniscono meccanismi che consentono un ulteriore livello di supporto della configurazione per specificare e passare le dipendenze agli oggetti in fase di esecuzione (il più delle volte utilizzando l'inserimento del costruttore).</span><span class="sxs-lookup"><span data-stu-id="efefd-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="efefd-239">Alcuni dei più popolari Framework OSS Dependency Injection / IOC in .NET includono: AutoFac, Ninject, Spring.NET, StructureMap, e Windsor.</span><span class="sxs-lookup"><span data-stu-id="efefd-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="efefd-240">ASP.NET MVC espone le API di estendibilità che consentono agli sviluppatori di partecipare alla risoluzione e creazione di istanze dei controller e che consente l'inserimento di dipendenze / Framework IoC per essere integrati in modo pulito all'interno di questo processo.</span><span class="sxs-lookup"><span data-stu-id="efefd-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="efefd-241">Utilizzando un framework DI/IOC ci consentirebbe anche di rimuovere il costruttore predefinito dal nostro DinnersController – che rimuoverebbe completamente l'accoppiamento tra esso e il DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="efefd-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="efefd-242">Non verrà utilizzato un'iniezione di dipendenza / framework IOC con l'applicazione NerdDinner.We won't be using a dependency injection / IOC framework with our NerdDinner application.</span><span class="sxs-lookup"><span data-stu-id="efefd-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="efefd-243">Ma è qualcosa che potremmo considerare per il futuro se il NerdDinner code-base e le capacità è cresciuto.</span><span class="sxs-lookup"><span data-stu-id="efefd-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="efefd-244">Creazione di nuovi unit test di azione</span><span class="sxs-lookup"><span data-stu-id="efefd-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="efefd-245">Creiamo ora alcuni unit test che verificano la funzionalità di modifica di DinnersController.</span><span class="sxs-lookup"><span data-stu-id="efefd-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="efefd-246">Inizieremo testando la versione HTTP-GET dell'azione Modifica:</span><span class="sxs-lookup"><span data-stu-id="efefd-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="efefd-247">Verrà creato un test che verifica che un oggetto View supportato da un DinnerFormViewModel oggetto viene eseguito il rendering quando viene richiesta una cena valida:We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span><span class="sxs-lookup"><span data-stu-id="efefd-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="efefd-248">Quando si esegue il test, tuttavia, si noterà che ha esito negativo perché un'eccezione di riferimento null viene generata quando il Edit metodo accede alla proprietà User.Identity.Name per eseguire il controllo Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="efefd-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="efefd-249">L'oggetto utente nella classe di base Controller incapsula i dettagli sull'utente connesso e viene popolato da ASP.NET MVC quando crea il controller in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="efefd-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="efefd-250">Poiché stiamo testando il DinnersController all'esterno di un ambiente web-server, il User oggetto non è impostato (da qui l'eccezione di riferimento null).</span><span class="sxs-lookup"><span data-stu-id="efefd-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="efefd-251">Mocking la proprietà User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="efefd-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="efefd-252">Framework di simulazione semplificano i test consentendoci di creare dinamicamente versioni false di oggetti dipendenti che supportano i test.</span><span class="sxs-lookup"><span data-stu-id="efefd-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="efefd-253">Ad esempio, è possibile usare un framework di simulazione nel test dell'azione Edit per creare dinamicamente un oggetto User che il nostro DinnersController può usare per cercare un nome utente simulato.</span><span class="sxs-lookup"><span data-stu-id="efefd-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="efefd-254">In questo modo si eviterà la creazione di un riferimento null quando si esegue il test.</span><span class="sxs-lookup"><span data-stu-id="efefd-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="efefd-255">Esistono molti framework di simulazione di .NET che possono essere utilizzati con [http://www.mockframeworks.com/](http://www.mockframeworks.com/)ASP.NET MVC (è possibile visualizzare un elenco di essi qui: ).</span><span class="sxs-lookup"><span data-stu-id="efefd-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="efefd-256">Per testare la nostra applicazione NerdDinner useremo un framework di simulazione open source [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq)chiamato "Moq", che può essere scaricato gratuitamente da .</span><span class="sxs-lookup"><span data-stu-id="efefd-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="efefd-257">Una volta scaricato, aggiungeremo un riferimento nel nostro progetto NerdDinner.Tests all'assembly Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="efefd-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="efefd-258">Verrà quindi aggiunto un metodo helper "CreateDinnersControllerAs(username)" alla classe di test che accetta un nome utente come parametro e che quindi "mocks" la proprietà User.Identity.Name nell'istanza DinnersController:We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and then "mocks" the User.Identity.Name property on the DinnersController instance:</span><span class="sxs-lookup"><span data-stu-id="efefd-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="efefd-259">Sopra stiamo usando Moq per creare un oggetto Mock che finge un oggetto ControllerContext (che è ciò che ASP.NET MVC passa alle classi Controller per esporre oggetti di runtime come User, Request, Response e Session).</span><span class="sxs-lookup"><span data-stu-id="efefd-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="efefd-260">Viene chiamato il metodo "SetupGet" su Mock per indicare che la proprietà HttpContext.User.Identity.Name in ControllerContext deve restituire la stringa del nome utente passata al metodo helper.</span><span class="sxs-lookup"><span data-stu-id="efefd-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="efefd-261">È possibile simulare qualsiasi numero di controllerDi proprietà e metodi.</span><span class="sxs-lookup"><span data-stu-id="efefd-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="efefd-262">Per illustrare questo ho anche aggiunto una chiamata SetupGet() per la proprietà Request.IsAuthenticated (che non è effettivamente necessaria per i test riportati di seguito, ma che consente di illustrare come è possibile simulare le proprietà Request).</span><span class="sxs-lookup"><span data-stu-id="efefd-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="efefd-263">Quando abbiamo finito assegniamo un'istanza di ControllerContext finto per il DinnersController il nostro metodo helper restituisce.</span><span class="sxs-lookup"><span data-stu-id="efefd-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="efefd-264">È ora possibile scrivere unit test che utilizzano questo metodo helper per testare gli scenari di modifica che coinvolgono utenti diversi:We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span><span class="sxs-lookup"><span data-stu-id="efefd-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="efefd-265">E ora quando eseguiamo i test che superano:</span><span class="sxs-lookup"><span data-stu-id="efefd-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="efefd-266">Test degli scenari UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="efefd-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="efefd-267">Sono stati creati test relativi alla versione HTTP-GET dell'azione Modifica.</span><span class="sxs-lookup"><span data-stu-id="efefd-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="efefd-268">Creiamo ora alcuni test che verificano la versione HTTP-POST dell'azione Modifica:</span><span class="sxs-lookup"><span data-stu-id="efefd-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="efefd-269">Il nuovo interessante scenario di test che ci permette di supportare con questo metodo di azione è l'utilizzo del metodo helper UpdateModel() nella classe di base Controller.</span><span class="sxs-lookup"><span data-stu-id="efefd-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="efefd-270">Questo metodo helper viene usato per associare i valori post del form all'istanza dell'oggetto Dinner.We are using this helper method to bind form-post values to our Dinner object instance.</span><span class="sxs-lookup"><span data-stu-id="efefd-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="efefd-271">Di seguito sono riportati due test che illustrano come è possibile fornire i valori inviati dal modulo per il metodo helper UpdateModel() da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="efefd-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="efefd-272">A tale scopo, creare e popolare un oggetto FormCollection e quindi assegnarlo alla proprietà "ValueProvider" nel Controller.</span><span class="sxs-lookup"><span data-stu-id="efefd-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="efefd-273">Il primo test verifica che al salvataggio riuscito il browser venga reindirizzato all'azione dei dettagli.</span><span class="sxs-lookup"><span data-stu-id="efefd-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="efefd-274">Il secondo test verifica che quando viene inviato un input non valido l'azione visualizza nuovamente la visualizzazione di modifica con un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="efefd-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="efefd-275">Test del wrapping</span><span class="sxs-lookup"><span data-stu-id="efefd-275">Testing Wrap-Up</span></span>

<span data-ttu-id="efefd-276">Sono stati illustrati i concetti di base coinvolti nelle classi di controller di unit test.</span><span class="sxs-lookup"><span data-stu-id="efefd-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="efefd-277">Possiamo usare queste tecniche per creare facilmente centinaia di semplici test che verificano il comportamento della nostra applicazione.</span><span class="sxs-lookup"><span data-stu-id="efefd-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="efefd-278">Poiché i test del controller e del modello non richiedono un database reale, sono estremamente veloci e facili da eseguire.</span><span class="sxs-lookup"><span data-stu-id="efefd-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="efefd-279">Saremo in grado di eseguire centinaia di test automatizzati in pochi secondi e ricevere immediatamente un feedback sul fatto che una modifica che abbiamo apportato abbia rotto qualcosa.</span><span class="sxs-lookup"><span data-stu-id="efefd-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="efefd-280">Questo ci aiuterà a fornire la fiducia necessaria per migliorare continuamente, refactoring e perfezionare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="efefd-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="efefd-281">Abbiamo trattato il test come ultimo argomento di questo capitolo, ma non perché il test è qualcosa che dovresti fare alla fine di un processo di sviluppo!</span><span class="sxs-lookup"><span data-stu-id="efefd-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="efefd-282">Al contrario, è consigliabile scrivere test automatizzati il prima possibile nel processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="efefd-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="efefd-283">In questo modo è possibile ottenere un feedback immediato durante lo sviluppo, è possibile pensare in modo ponderato agli scenari dei casi d'uso dell'applicazione e guida l'utente nella progettazione dell'applicazione tenendo presente la creazione di livelli e l'accoppiamento puliti.</span><span class="sxs-lookup"><span data-stu-id="efefd-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="efefd-284">Un capitolo successivo del libro verrà illustrato Test Driven Development (TDD) e come utilizzarlo con ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="efefd-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="efefd-285">TDD è una procedura di codifica iterativa in cui si scrivono prima i test che il codice risultante soddisferà.</span><span class="sxs-lookup"><span data-stu-id="efefd-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="efefd-286">Con TDD si inizia ogni funzionalità creando un test che verifica la funzionalità che si sta per implementare.</span><span class="sxs-lookup"><span data-stu-id="efefd-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="efefd-287">Scrivere prima lo unit test aiuta a capire chiaramente la funzionalità e il suo funzionamento.</span><span class="sxs-lookup"><span data-stu-id="efefd-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="efefd-288">Solo dopo la scrittura del test (e aver verificato che non riesce) si implementano le funzionalità effettive verificate dal test.</span><span class="sxs-lookup"><span data-stu-id="efefd-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="efefd-289">Poiché hai già dedicato del tempo a pensare al caso d'uso di come dovrebbe funzionare la funzionalità, avrai una migliore comprensione dei requisiti e del modo migliore per implementarli.</span><span class="sxs-lookup"><span data-stu-id="efefd-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="efefd-290">Al termine dell'implementazione è possibile rieseguire il test e ottenere un feedback immediato sul corretto funzionamento della funzionalità.</span><span class="sxs-lookup"><span data-stu-id="efefd-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="efefd-291">Parleremo di più TDD nel capitolo 10.</span><span class="sxs-lookup"><span data-stu-id="efefd-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="efefd-292">passaggio successivo</span><span class="sxs-lookup"><span data-stu-id="efefd-292">Next Step</span></span>

<span data-ttu-id="efefd-293">Alcuni commenti finale wrap up.</span><span class="sxs-lookup"><span data-stu-id="efefd-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="efefd-294">[Successivo](use-ajax-to-implement-mapping-scenarios.md)
> [precedente](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="efefd-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
