---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Abilitare Unit test automatici | Microsoft Docs
author: microsoft
description: Passaggio 12 mostra come sviluppare una suite di unit test automatizzati che consentono di verificare la funzionalità di NerdDinner e che fornirà la fiducia necessaria per apportare modifiche...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 74abf391bb4aab3ff0d5079e0a24ba20287e18fb
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049458"
---
<a name="enable-automated-unit-testing"></a><span data-ttu-id="4c081-103">Abilitare unit test automatici</span><span class="sxs-lookup"><span data-stu-id="4c081-103">Enable Automated Unit Testing</span></span>
====================
<span data-ttu-id="4c081-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="4c081-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4c081-105">Scaricare PDF</span><span class="sxs-lookup"><span data-stu-id="4c081-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="4c081-106">Si tratta di passaggio 12 di una liberazione [esercitazione sull'applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che si interromperanno-dettaglio come compilare una piccola, ma completa, applicazione web con ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="4c081-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="4c081-107">Passaggio 12 illustra come sviluppare una suite di unit test automatizzati che consentono di verificare la funzionalità di NerdDinner e che fornirà la fiducia necessaria per apportare modifiche e miglioramenti per l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="4c081-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="4c081-108">Se si usa ASP.NET MVC 3, è consigliabile seguire le [Guida introduttiva con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oppure [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="4c081-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="4c081-109">NerdDinner Step 12: Testing unità</span><span class="sxs-lookup"><span data-stu-id="4c081-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="4c081-110">È possibile sviluppare una suite di unit test automatizzati che consentono di verificare la funzionalità di NerdDinner e che fornirà la fiducia necessaria per apportare modifiche e miglioramenti per l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="4c081-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="4c081-111">Il motivo per cui Unit Test?</span><span class="sxs-lookup"><span data-stu-id="4c081-111">Why Unit Test?</span></span>

<span data-ttu-id="4c081-112">Nell'unità di lavoro una mattina è necessario un attimo improvviso di ispirazione relative a un'applicazione che si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="4c081-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="4c081-113">Si può notare, viene apportata una modifica che è possibile implementare in modo significativo migliorare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="4c081-114">Potrebbe essere un'operazione di refactoring che pulisce il codice, aggiunge una nuova funzionalità o corregge un bug.</span><span class="sxs-lookup"><span data-stu-id="4c081-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="4c081-115">La domanda che confronts è quando si arriva a computer in uso è: "la modalità sicura per verificare questo miglioramento?"</span><span class="sxs-lookup"><span data-stu-id="4c081-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="4c081-116">Cosa accade se apportare la modifica ha effetti collaterali o interruzioni qualcosa?</span><span class="sxs-lookup"><span data-stu-id="4c081-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="4c081-117">La modifica potrebbe essere semplice e richiedere solo alcuni minuti per implementare, ma cosa accade se sono necessarie ore per testare manualmente tutti gli scenari dell'applicazione?</span><span class="sxs-lookup"><span data-stu-id="4c081-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="4c081-118">Cosa accade se si dimentica di coprire uno scenario e un'applicazione passa in produzione?</span><span class="sxs-lookup"><span data-stu-id="4c081-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="4c081-119">Effettua questo miglioramento davvero la pena di tutti gli sforzi?</span><span class="sxs-lookup"><span data-stu-id="4c081-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="4c081-120">Unit test automatizzati possono fornire una rete di protezione che consente di migliorare continuamente le applicazioni e possibile evitare di incorrere paura del codice di cui che si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="4c081-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="4c081-121">Operazioni con i test automatizzati che consentono di verificare rapidamente la funzionalità consente di codice in tutta sicurezza – e ottimizzare le prestazioni di apportare miglioramenti è possibile che in caso contrario non ritenevano familiarità.</span><span class="sxs-lookup"><span data-stu-id="4c081-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="4c081-122">Consentono inoltre di creare soluzioni che sono più facili da gestire e hanno una durata più lunga - che comporta un maggiore ritorno sull'investimento.</span><span class="sxs-lookup"><span data-stu-id="4c081-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="4c081-123">Il Framework di MVC ASP.NET rende più semplice e naturale alle funzionalità di unit test dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="4c081-124">Inoltre, consente un flusso di lavoro di Test Driven Development (TDD) che consente lo sviluppo basato su test preventivi.</span><span class="sxs-lookup"><span data-stu-id="4c081-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="4c081-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="4c081-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="4c081-126">Quando abbiamo creato l'applicazione di NerdDinner all'inizio di questa esercitazione, alla richiesta con una finestra di dialogo che chiede se si desidera creare un progetto di unit test per passare insieme al progetto di applicazione:</span><span class="sxs-lookup"><span data-stu-id="4c081-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="4c081-127">Abbiamo mantenuto "Sì, crea un progetto unit test" pulsante di opzione selezionato, questo ha comportato un progetto "NerdDinner.Tests" aggiunto alla soluzione:</span><span class="sxs-lookup"><span data-stu-id="4c081-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="4c081-128">Il progetto NerdDinner.Tests fa riferimento all'assembly del progetto di applicazione NerdDinner e ci permette di aggiungere facilmente i test automatizzati che verifica la funzionalità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="4c081-129">Creazione di Unit test per la nostra classe di modello Dinner</span><span class="sxs-lookup"><span data-stu-id="4c081-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="4c081-130">Aggiungiamo alcuni test per il progetto NerdDinner.Tests che verificano la classe Dinner creato quando è stato creato il livello del modello.</span><span class="sxs-lookup"><span data-stu-id="4c081-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="4c081-131">Si inizierà creando una nuova cartella nel nostro progetto di test denominata "Models" dove posizioneremo test correlata al modello.</span><span class="sxs-lookup"><span data-stu-id="4c081-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="4c081-132">Abbiamo quindi fare doppio clic sulla cartella e scegliere il **Add -&gt;nuovo Test** comando di menu.</span><span class="sxs-lookup"><span data-stu-id="4c081-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="4c081-133">Verrà visualizzata la finestra di dialogo "Aggiungi nuovo Test".</span><span class="sxs-lookup"><span data-stu-id="4c081-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="4c081-134">Verrà scelto creare un "Unit Test" e denominarlo "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="4c081-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="4c081-135">Quando si fa clic sul pulsante "ok" Visual Studio verrà aggiunto (e aperto) un file DinnerTest.cs al progetto:</span><span class="sxs-lookup"><span data-stu-id="4c081-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="4c081-136">Il modello di Visual Studio unit test predefinito contiene una serie di codice boilerplate interno che è possibile individuare un po' complessa.</span><span class="sxs-lookup"><span data-stu-id="4c081-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="4c081-137">È possibile pulire, contenga solo il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4c081-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="4c081-138">L'attributo [TestClass] sulla classe DinnerTest lo identifica come una classe che conterrà i test, nonché l'inizializzazione del test facoltativo e il codice di teardown.</span><span class="sxs-lookup"><span data-stu-id="4c081-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="4c081-139">È possibile definire i test all'interno di esso mediante l'aggiunta di metodi pubblici che hanno un attributo [TestMethod] su di essi.</span><span class="sxs-lookup"><span data-stu-id="4c081-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="4c081-140">Di seguito sono il primo dei due test verrà aggiunto che verificano il comportamento nostra classe cena.</span><span class="sxs-lookup"><span data-stu-id="4c081-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="4c081-141">Il primo test verifica che la cena non è valida se viene creata una nuova cena senza tutte le proprietà impostate correttamente.</span><span class="sxs-lookup"><span data-stu-id="4c081-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="4c081-142">Il secondo test verifica che la cena è valida quando un Dinner ha tutte le proprietà impostate con i valori validi:</span><span class="sxs-lookup"><span data-stu-id="4c081-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="4c081-143">Si noterà che in precedenza che ai nomi di test sono molto esplicite (e un po' verbose).</span><span class="sxs-lookup"><span data-stu-id="4c081-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="4c081-144">Ciò viene ottenuto perché Microsoft congestione creazione centinaia o migliaia di test di piccole dimensioni e si vuole semplificare determinare rapidamente la finalità e il comportamento della ognuno di essi (in particolare quando ci stiamo impegnando tramite un elenco di errori in un test runner).</span><span class="sxs-lookup"><span data-stu-id="4c081-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="4c081-145">I nomi di test devono essere denominati dopo la funzionalità di che test.</span><span class="sxs-lookup"><span data-stu-id="4c081-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="4c081-146">Sopra si sta usando un "sostantivo\_dovrebbero\_verbo" modello di denominazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="4c081-147">Si sta strutturare i test tramite il test con modello che è l'acronimo di "Arrange, Act, Assert" "AAA":</span><span class="sxs-lookup"><span data-stu-id="4c081-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="4c081-148">Disponi: Configurare l'unità sottoposto a test</span><span class="sxs-lookup"><span data-stu-id="4c081-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="4c081-149">ACT: Verificare l'unità sottoposta a test e acquisire i risultati</span><span class="sxs-lookup"><span data-stu-id="4c081-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="4c081-150">L'asserzione: Verificare il comportamento</span><span class="sxs-lookup"><span data-stu-id="4c081-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="4c081-151">Quando si scrivono test che si vuole evitare che i singoli test eseguire troppe operazioni.</span><span class="sxs-lookup"><span data-stu-id="4c081-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="4c081-152">Ogni test dovrebbe verificare, invece, solo un singolo concetto (che renderà molto più facile individuare la causa di errori).</span><span class="sxs-lookup"><span data-stu-id="4c081-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="4c081-153">Una buona indicazione consiste nel provare e avere solo una singola istruzione per ogni test di asserzione.</span><span class="sxs-lookup"><span data-stu-id="4c081-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="4c081-154">Se si dispone di più di una istruzione in un metodo di test di asserzione, assicurarsi che sono tutti in uso per testare lo stesso concetto.</span><span class="sxs-lookup"><span data-stu-id="4c081-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="4c081-155">In caso di dubbi, effettuare un altro test.</span><span class="sxs-lookup"><span data-stu-id="4c081-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="4c081-156">Esecuzione test</span><span class="sxs-lookup"><span data-stu-id="4c081-156">Running Tests</span></span>

<span data-ttu-id="4c081-157">Visual Studio 2008 Professional (e versioni successive) includono un test runner predefinito che può essere utilizzato per eseguire i progetti di Visual Studio Unit Test all'interno dell'IDE.</span><span class="sxs-lookup"><span data-stu-id="4c081-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="4c081-158">È possibile selezionare i **Test -&gt;Run -&gt;tutti i test nella soluzione** menu comando (o tipo Ctrl R, A) per eseguire tutti i test di unità.</span><span class="sxs-lookup"><span data-stu-id="4c081-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="4c081-159">Oppure in alternativa è possibile posizionare il cursore all'interno di un metodo di test o classe di test specifici e usare la **Test -&gt;Run -&gt;test nel contesto corrente** comando di menu (oppure digitare Ctrl R, T) per eseguire un subset degli unit test.</span><span class="sxs-lookup"><span data-stu-id="4c081-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="4c081-160">È possibile posizionare il cursore all'interno della classe DinnerTest e digitare "Ctrl R, T" per eseguire i due test che è stato appena definito.</span><span class="sxs-lookup"><span data-stu-id="4c081-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="4c081-161">Quando si esegue questa operazione una "finestra Risultati Test" verrà visualizzato all'interno di Visual Studio e vedremo i risultati del test eseguito elencati all'interno di esso:</span><span class="sxs-lookup"><span data-stu-id="4c081-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="4c081-162">*Nota: Nella finestra Risultati test di Visual Studio non visualizza la colonna del nome di classe per impostazione predefinita. È possibile aggiungere questo facendo clic all'interno della finestra risultati del Test e usando il comando di menu Aggiungi/Rimuovi colonne.*</span><span class="sxs-lookup"><span data-stu-id="4c081-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="4c081-163">I due test richiedevano solo una frazione di secondo per eseguire – e come si può vedere entrambi passati.</span><span class="sxs-lookup"><span data-stu-id="4c081-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="4c081-164">Ora possiamo passare e aumentare li creando altri test che verifica le convalide di regole specifici, nonché coprire i due metodi helper - IsUserHost() e IsUserRegisterd() – che abbiamo aggiunto alla classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="4c081-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegisterd() – that we added to the Dinner class.</span></span> <span data-ttu-id="4c081-165">Con le verifiche in atto per la classe Dinner renderà molto più semplice e sicura per aggiungervi nuove regole business e le convalide in futuro.</span><span class="sxs-lookup"><span data-stu-id="4c081-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="4c081-166">È possibile aggiungere la nuova logica della regola a cena e quindi verificare che non è stato interrotto qualsiasi della funzionalità per la logica precedente entro pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="4c081-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="4c081-167">Si noti come usando un nome descrittivo test rende facile da comprendere rapidamente ciò che si verifica ogni test.</span><span class="sxs-lookup"><span data-stu-id="4c081-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="4c081-168">È consigliabile utilizzare il **strumenti -&gt;opzioni** comando di menu, aprire Strumenti di Test -&gt;schermata di configurazione di esecuzione di Test e verifica la "facendo doppio clic su un risultato del test non riusciti o senza risultati unit Visualizza casella di controllo al punto di errore nel test".</span><span class="sxs-lookup"><span data-stu-id="4c081-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="4c081-169">In questo modo sarà possibile fare doppio clic su un errore nella finestra dei risultati dei test e passare immediatamente all'errore di asserzione.</span><span class="sxs-lookup"><span data-stu-id="4c081-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="4c081-170">Creazione di DinnersController Unit test</span><span class="sxs-lookup"><span data-stu-id="4c081-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="4c081-171">Creare ora alcuni unit test per verificare la funzionalità DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4c081-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="4c081-172">Verrà avviare facendo clic sulla cartella "Controller" entro il progetto di Test e quindi scegliere il **Add -&gt;nuovo Test** comando di menu.</span><span class="sxs-lookup"><span data-stu-id="4c081-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="4c081-173">Si verrà creato uno "Unit Test" e denominarlo "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="4c081-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="4c081-174">Si creerà due metodi di test che verificano il metodo di azione Details() sul DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4c081-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="4c081-175">La prima verifica che una visualizzazione viene restituita quando viene richiesto un Dinner esistente.</span><span class="sxs-lookup"><span data-stu-id="4c081-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="4c081-176">La seconda verifica che una visualizzazione "NotFound" viene restituita quando viene richiesto un Dinner inesistente:</span><span class="sxs-lookup"><span data-stu-id="4c081-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="4c081-177">Il codice sopra riportato consente di compilare pulita.</span><span class="sxs-lookup"><span data-stu-id="4c081-177">The above code compiles clean.</span></span> <span data-ttu-id="4c081-178">Quando si esegue il test, tuttavia, hanno entrambi esito negativo:</span><span class="sxs-lookup"><span data-stu-id="4c081-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="4c081-179">Se si esamina i messaggi di errore, si vedrà che il test abbia avuto esito negativo era la classe DinnersRepository non è riuscita a connettersi a un database.</span><span class="sxs-lookup"><span data-stu-id="4c081-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="4c081-180">La nostra applicazione NerdDinner Usa una stringa di connessione in un file locale di SQL Server Express che si trova sotto il \App\_directory dei dati del progetto dell'applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4c081-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="4c081-181">Poiché il progetto NerdDinner.Tests viene compilato ed eseguito in una directory diversa quindi il progetto di applicazione, il percorso relativo del nostro della stringa di connessione non è corretto.</span><span class="sxs-lookup"><span data-stu-id="4c081-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="4c081-182">Abbiamo *è stato possibile* risolvere il problema, copiare il file di database SQL Express per il progetto di test e quindi aggiungere una stringa di connessione appropriato di test ad esso nell'app. config del progetto test.</span><span class="sxs-lookup"><span data-stu-id="4c081-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="4c081-183">Si otterrebbero i test precedenti ha sbloccato e in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4c081-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="4c081-184">Testing unità di codice usando un database effettivo, tuttavia, è accompagnata da una serie di difficoltà.</span><span class="sxs-lookup"><span data-stu-id="4c081-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="4c081-185">In particolare:</span><span class="sxs-lookup"><span data-stu-id="4c081-185">Specifically:</span></span>

- <span data-ttu-id="4c081-186">Rallenta notevolmente il tempo di esecuzione di unit test.</span><span class="sxs-lookup"><span data-stu-id="4c081-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="4c081-187">Il tempo necessario per eseguire i test, sono meno probabilità di eseguirli frequentemente.</span><span class="sxs-lookup"><span data-stu-id="4c081-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="4c081-188">È opportuno che gli unit test per poter essere eseguito in pochi secondi – e potervi operazione come modo naturale come la compilazione del progetto.</span><span class="sxs-lookup"><span data-stu-id="4c081-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="4c081-189">Complica la logica di programma di installazione e pulizia in ambito di test.</span><span class="sxs-lookup"><span data-stu-id="4c081-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="4c081-190">Si vuole che ogni unit test sia isolato e indipendente dalle altre (con senza effetti collaterali o dipendenze).</span><span class="sxs-lookup"><span data-stu-id="4c081-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="4c081-191">Quando si usa un database reale che è necessario tenere conto dello stato e ripristinare le impostazioni tra i test.</span><span class="sxs-lookup"><span data-stu-id="4c081-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="4c081-192">Verrà ora esaminato uno schema progettuale chiamato "inserimento di dipendenze" che può contribuire a risolvere questi problemi ed evitare la necessità di usare un database reale con i test.</span><span class="sxs-lookup"><span data-stu-id="4c081-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="4c081-193">Inserimento di dipendenze</span><span class="sxs-lookup"><span data-stu-id="4c081-193">Dependency Injection</span></span>

<span data-ttu-id="4c081-194">Ora DinnersController è strettamente "a" per la classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c081-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="4c081-195">"Accoppiamento" si riferisce a una situazione in cui una classe in modo esplicito si basa su un'altra classe per poter funzionare:</span><span class="sxs-lookup"><span data-stu-id="4c081-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="4c081-196">Poiché la classe DinnerRepository richiede l'accesso a un database, la dipendenza fortemente accoppiata la classe DinnersController presenta alle estremità DinnerRepository backup che richiedono siamo riusciti ad avere un database in ordine per i metodi di azione DinnersController da sottoporre a test.</span><span class="sxs-lookup"><span data-stu-id="4c081-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="4c081-197">È possibile aggirare il problema tramite l'uso di uno schema progettuale chiamato "inserimento di dipendenze:" che è un approccio in cui le dipendenze (ad esempio le classi di repository che forniscono l'accesso ai dati) non è più in modo implicito vengono create all'interno delle classi che li utilizzano.</span><span class="sxs-lookup"><span data-stu-id="4c081-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="4c081-198">Al contrario, possono essere passate in modo esplicito le dipendenze per la classe che li Usa usando gli argomenti del costruttore.</span><span class="sxs-lookup"><span data-stu-id="4c081-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="4c081-199">Se le dipendenze vengono definite utilizzando le interfacce, abbiamo la flessibilità di passare le implementazioni di dipendenza "fittizio" per gli scenari di unit test.</span><span class="sxs-lookup"><span data-stu-id="4c081-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="4c081-200">In questo modo sarà possibile creare le implementazioni di dipendenza specifica del test che non necessitano effettivamente dell'accesso a un database.</span><span class="sxs-lookup"><span data-stu-id="4c081-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="4c081-201">Per visualizzare questa azione, ora si implementerà l'inserimento di dipendenze con nostri DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4c081-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="4c081-202">Estrazione di un'interfaccia IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="4c081-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="4c081-203">Il primo passaggio sarà possibile creare una nuova interfaccia IDinnerRepository che incapsula il contratto di repository che richiedono ai controller per recuperare e aggiornare Dinners.</span><span class="sxs-lookup"><span data-stu-id="4c081-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="4c081-204">È possibile definire questo contratto di interfaccia manualmente facendo clic sulla cartella \Models, e quindi scegliendo il **Add -&gt;nuovo elemento** comando di menu e la creazione di una nuova interfaccia denominata IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="4c081-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="4c081-205">In alternativa sia possibile usare l'estratto il refactoring di strumenti integrata in Visual Studio Professional (e versioni successive) per automaticamente e creare un'interfaccia per noi dalla nostra classe DinnerRepository esistente.</span><span class="sxs-lookup"><span data-stu-id="4c081-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="4c081-206">Per estrarre l'interfaccia usando Visual Studio, è sufficiente posizionare il cursore nell'editor di testo sulla classe DinnerRepository e quindi fare clic e scegliere il **refactoring -&gt;Estrai interfaccia** comando di menu:</span><span class="sxs-lookup"><span data-stu-id="4c081-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="4c081-207">Verrà aperta la finestra di dialogo "Estrai interfaccia" e ci richiesto per il nome dell'interfaccia da creare.</span><span class="sxs-lookup"><span data-stu-id="4c081-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="4c081-208">Verrà IDinnerRepository per impostazione predefinita e seleziona automaticamente tutti i metodi pubblici della classe DinnerRepository esistente da aggiungere all'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="4c081-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="4c081-209">Quando si fa clic sul pulsante "ok", Visual Studio aggiungerà una nuova interfaccia IDinnerRepository all'applicazione:</span><span class="sxs-lookup"><span data-stu-id="4c081-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="4c081-210">E la classe DinnerRepository esistente verrà aggiornata in modo che implementi l'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="4c081-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="4c081-211">L'aggiornamento DinnersController per supportare l'inserimento del costruttore</span><span class="sxs-lookup"><span data-stu-id="4c081-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="4c081-212">La classe DinnersController per usare la nuova interfaccia verrà ora aggiornata.</span><span class="sxs-lookup"><span data-stu-id="4c081-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="4c081-213">Attualmente DinnersController è hardcoded in modo che il campo "dinnerRepository" è sempre una classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="4c081-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="4c081-214">Verranno modificate, in modo che il campo "dinnerRepository" è di tipo IDinnerRepository anziché DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c081-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="4c081-215">Quindi, aggiungiamo due costruttori DinnersController pubblici.</span><span class="sxs-lookup"><span data-stu-id="4c081-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="4c081-216">Uno dei costruttori consente un IDinnerRepository deve essere passato come argomento.</span><span class="sxs-lookup"><span data-stu-id="4c081-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="4c081-217">L'altro è un costruttore predefinito che usa la nostra implementazione DinnerRepository esistente:</span><span class="sxs-lookup"><span data-stu-id="4c081-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="4c081-218">Poiché ASP.NET MVC per impostazione predefinita crea classi controller usando i costruttori predefiniti, nostro DinnersController in fase di esecuzione continuerà a usare la classe DinnerRepository per eseguire l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="4c081-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="4c081-219">È ora possibile aggiornare i test di unità, tuttavia, per il passaggio in un'implementazione di repository "fittizio" cena usando il costruttore di parametro.</span><span class="sxs-lookup"><span data-stu-id="4c081-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="4c081-220">Questo repository "fittizio" dinner non richiedono l'accesso al database reale e invece userà i dati di esempio in memoria.</span><span class="sxs-lookup"><span data-stu-id="4c081-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="4c081-221">Creazione della classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="4c081-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="4c081-222">È possibile creare una classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c081-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="4c081-223">Si verrà iniziare creando una directory "Fakes" all'interno del progetto NerdDinner.Tests e quindi aggiungere una nuova classe FakeDinnerRepository (pulsante destro del mouse sulla cartella e scegliere **Add -&gt;nuova classe**):</span><span class="sxs-lookup"><span data-stu-id="4c081-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="4c081-224">Il codice verrà aggiornato in modo che la classe FakeDinnerRepository implementa l'interfaccia IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c081-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="4c081-225">È quindi possibile fare doppio clic su di esso e scegliere il comando di menu di scelta rapida "Implementa interfaccia IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="4c081-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="4c081-226">In questo modo Visual Studio aggiungere automaticamente tutti i membri di interfaccia IDinnerRepository alla nostra classe FakeDinnerRepository con implementazioni predefinite "stub out":</span><span class="sxs-lookup"><span data-stu-id="4c081-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="4c081-227">È quindi possibile aggiornare l'implementazione FakeDinnerRepository per lavorare di fuori di un elenco in memoria&lt;Dinner&gt; raccolta passata come argomento del costruttore:</span><span class="sxs-lookup"><span data-stu-id="4c081-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="4c081-228">È ora disponibile un'implementazione IDinnerRepository fittizio che non richiede un database e può invece usare un elenco in memoria degli oggetti Dinner.</span><span class="sxs-lookup"><span data-stu-id="4c081-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="4c081-229">Uso di FakeDinnerRepository con gli Unit test</span><span class="sxs-lookup"><span data-stu-id="4c081-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="4c081-230">Si esamini il DinnersController unit test che non è riuscita in precedenza perché il database non era disponibile.</span><span class="sxs-lookup"><span data-stu-id="4c081-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="4c081-231">È possibile aggiornare i metodi di test per usare un FakeDinnerRepository popolate con dati la cena in memoria per il DinnersController usando il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4c081-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="4c081-232">Passiamo ora quando si eseguono questi test sono entrambi:</span><span class="sxs-lookup"><span data-stu-id="4c081-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="4c081-233">Soprattutto, richiedere solo una frazione di secondo per l'esecuzione e non richiedono alcuna logica complessa installazione/pulizia.</span><span class="sxs-lookup"><span data-stu-id="4c081-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="4c081-234">È possibile ora unit test tutto il codice metodo azione DinnersController (tra cui listato, paging, dettagli, creare, aggiornare ed eliminare) senza dover fare per connettersi a un database effettivo.</span><span class="sxs-lookup"><span data-stu-id="4c081-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="4c081-235">**Sul lato dell'argomento: Framework di inserimento delle dipendenze**</span><span class="sxs-lookup"><span data-stu-id="4c081-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="4c081-236">Esecuzione di inserimento delle dipendenze manuale (ad esempio, Microsoft è di sopra) funziona correttamente, ma diventa difficile da gestire come il numero di dipendenze e i componenti in un'applicazione aumenta.</span><span class="sxs-lookup"><span data-stu-id="4c081-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="4c081-237">Sono disponibili diversi framework di inserimento delle dipendenze per .NET che consentono di offrire un'enorme flessibilità di gestione delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="4c081-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="4c081-238">Questi Framework, detti anche contenitori "Inversion of Control" (IoC), forniscono meccanismi che consentono a un livello aggiuntivo di supporto della configurazione per specificare e passare le dipendenze per gli oggetti in fase di esecuzione (in genere tramite inserimento del costruttore ).</span><span class="sxs-lookup"><span data-stu-id="4c081-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="4c081-239">Alcune dell'inserimento di dipendenze OSS più diffusi / infrastrutture IOC in .NET includono: AutoFac Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="4c081-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="4c081-240">ASP.NET MVC espone API che consentono agli sviluppatori di partecipare alla risoluzione e alla creazione di un'istanza dei controller e che consente l'inserimento di dipendenze di estendibilità / infrastrutture IoC correttamente l'applicazione da integrare all'interno di questo processo.</span><span class="sxs-lookup"><span data-stu-id="4c081-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="4c081-241">Usando un framework di inserimento delle dipendenze/IOC sarebbe consentono inoltre di rimuovere il costruttore predefinito dal nostro DinnersController – cui verrebbe rimuovere completamente l'accoppiamento tra i dati e il DinnerRepositorys.</span><span class="sxs-lookup"><span data-stu-id="4c081-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepositorys.</span></span> <span data-ttu-id="4c081-242">Non verrà usato un inserimento di dipendenze / infrastruttura IOC con la nostra applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4c081-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="4c081-243">Ma è un elemento che è stato possibile prendere in considerazione per il futuro se la codebase NerdDinner e funzionalità di aumento delle dimensioni.</span><span class="sxs-lookup"><span data-stu-id="4c081-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="4c081-244">Creazione di Unit test di modifica azione</span><span class="sxs-lookup"><span data-stu-id="4c081-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="4c081-245">Creare ora alcuni unit test per verificare la funzionalità di modifica del DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4c081-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="4c081-246">Si inizierà da testare la versione HTTP-GET del nostro Modifica azione:</span><span class="sxs-lookup"><span data-stu-id="4c081-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="4c081-247">Verrà creato un test che verifica che una visualizzazione supportata da un oggetto DinnerFormViewModel viene eseguito il rendering quando viene richiesto un dinner valido:</span><span class="sxs-lookup"><span data-stu-id="4c081-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="4c081-248">Quando si esegue il test, tuttavia, si noterà che abbia esito negativo perché viene generata un'eccezione con riferimento null quando il metodo di modifica accede alla proprietà User.Identity.Name per eseguire il controllo Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="4c081-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="4c081-249">L'oggetto utente nella classe base Controller incapsula i dettagli relativi all'utente connesso e viene popolato da ASP.NET MVC durante la creazione del controller in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4c081-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="4c081-250">Poiché i test in corso la DinnersController all'esterno di un ambiente server web, l'oggetto utente non è impostato (di conseguenza il riferimento null eccezione).</span><span class="sxs-lookup"><span data-stu-id="4c081-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="4c081-251">Il comportamento fittizio la proprietà User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="4c081-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="4c081-252">Framework di simulazione per facilitare il testing da ci permette di creare dinamicamente fittizie versioni degli oggetti dipendenti che supportano i test.</span><span class="sxs-lookup"><span data-stu-id="4c081-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="4c081-253">Ad esempio, è possibile usare un framework di simulazione nel test Modifica azione per creare dinamicamente un oggetto utente che nostro DinnersController può usare per cercare un nome utente simulato.</span><span class="sxs-lookup"><span data-stu-id="4c081-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="4c081-254">Questo modo si evita un riferimento null che venga generata quando si esegue il test.</span><span class="sxs-lookup"><span data-stu-id="4c081-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="4c081-255">Esistono molti .NET Framework che può essere usato con ASP.NET MVC di simulazione (è possibile visualizzare un elenco di essi di seguito: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="4c081-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="4c081-256">L'applicazione di NerdDinner useremo un open source il comportamento fittizio denominato "Moq" framework di test, che può essere scaricato gratuitamente dalla [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="4c081-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="4c081-257">Al termine del download, viene aggiunto un riferimento nel progetto NerdDinner.Tests all'assembly Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="4c081-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="4c081-258">Si aggiungerà quindi un metodo di supporto "CreateDinnersControllerAs(username)" per la classe di test che accetta un nome utente come parametro e che quindi la proprietà User.Identity.Name nell'istanza DinnersController "mocks":</span><span class="sxs-lookup"><span data-stu-id="4c081-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="4c081-259">Moq utilizziamo sopra per creare un oggetto di simulazione che fakes oggetto ControllerContext (ossia quali ASP.NET MVC passa alle classi Controller per esporre gli oggetti di runtime come utente, la richiesta, risposta e sessione).</span><span class="sxs-lookup"><span data-stu-id="4c081-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="4c081-260">Si sta chiamando il metodo "SetupGet" per la simulazione per indicare che la proprietà HttpContext.User.Identity.Name ControllerContext deve restituire la stringa di nome utente che è passato al metodo helper.</span><span class="sxs-lookup"><span data-stu-id="4c081-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="4c081-261">È possibile simulare un numero qualsiasi di ControllerContext proprietà e metodi.</span><span class="sxs-lookup"><span data-stu-id="4c081-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="4c081-262">Per illustrare questo concetto è stata aggiunta anche una chiamata SetupGet() per la proprietà Request.IsAuthenticated (che non è effettivamente necessaria per i test seguenti: ma in modo da illustrare come è possibile simulare le proprietà delle richieste).</span><span class="sxs-lookup"><span data-stu-id="4c081-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="4c081-263">Quando è stata completata un'istanza di simulazione il ControllerContext viene assegnato al DinnersController restituisce il metodo helper.</span><span class="sxs-lookup"><span data-stu-id="4c081-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="4c081-264">È possibile scrivere unit test che usano questo metodo helper per testare gli scenari di modifica che interessa diversi utenti:</span><span class="sxs-lookup"><span data-stu-id="4c081-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="4c081-265">E ora quando eseguiamo i test vengono superati:</span><span class="sxs-lookup"><span data-stu-id="4c081-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="4c081-266">UpdateModel() scenari di test</span><span class="sxs-lookup"><span data-stu-id="4c081-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="4c081-267">Sono stati creati i test che coprono la versione HTTP-GET dell'azione di modifica.</span><span class="sxs-lookup"><span data-stu-id="4c081-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="4c081-268">Creare ora alcuni test che verificano la versione HTTP-POST dell'azione di modifica:</span><span class="sxs-lookup"><span data-stu-id="4c081-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="4c081-269">Lo scenario di test nuove interessano per supportare con questo metodo di azione è l'utilizzo del metodo UpdateModel() helper nella classe base Controller.</span><span class="sxs-lookup"><span data-stu-id="4c081-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="4c081-270">Questo metodo di supporto viene usato per associare i valori dei post dei form per l'istanza dell'oggetto cena.</span><span class="sxs-lookup"><span data-stu-id="4c081-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="4c081-271">Di seguito sono due test che dimostra come sia possibile fornire modulo inviato i valori per il metodo helper UpdateModel() da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="4c081-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="4c081-272">Si sarà eseguire questa operazione creando e popolando un oggetto FormCollection e quindi assegnarla alla proprietà "ValueProvider" nel Controller.</span><span class="sxs-lookup"><span data-stu-id="4c081-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="4c081-273">Il primo test verifica che in un'operazione di salvataggio è reindirizzato il browser per l'azione di dettagli.</span><span class="sxs-lookup"><span data-stu-id="4c081-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="4c081-274">Il secondo test verifica che quando viene pubblicato un input non valido l'azione viene visualizzata nuovamente la visualizzazione di modifica nuovamente con un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="4c081-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="4c081-275">Test conclusioni</span><span class="sxs-lookup"><span data-stu-id="4c081-275">Testing Wrap-Up</span></span>

<span data-ttu-id="4c081-276">Appena trattati i concetti di base coinvolti nelle classi di unit test controller.</span><span class="sxs-lookup"><span data-stu-id="4c081-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="4c081-277">È possibile usare queste tecniche per creare facilmente centinaia di semplici test che verificano il comportamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="4c081-278">Poiché i controller e i test del modello non richiedono un database effettivo, sono estremamente veloce e facile da eseguire.</span><span class="sxs-lookup"><span data-stu-id="4c081-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="4c081-279">Sarà possibile eseguire centinaia di test automatizzati in secondi e ottenere immediatamente feedback se una modifica apportate si Interrompeva qualcosa.</span><span class="sxs-lookup"><span data-stu-id="4c081-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="4c081-280">Ciò consentirà di fornire il livello di confidenza per continuamente migliorare, refactoring e rifinire la nostra applicazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="4c081-281">Abbiamo affrontato test come ultimo argomento in questo capitolo, ma non perché il test è un elemento è necessario eseguire la fine di un processo di sviluppo!</span><span class="sxs-lookup"><span data-stu-id="4c081-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="4c081-282">Al contrario, è consigliabile scrivere i test automatizzati non appena possibile nel processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="4c081-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="4c081-283">Ciò consente quindi ottenere un feedback immediato, quando si sviluppa, consente di pensare attentamente a casi d'uso dell'applicazione e viene spiegato come progettare l'applicazione con pulita su livelli e accoppiamento presente.</span><span class="sxs-lookup"><span data-stu-id="4c081-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="4c081-284">Un capitolo del libro successivo verrà illustrati Test Driven Development (TDD) e come usarlo con ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="4c081-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="4c081-285">TDD è una procedura di codifica iterativa in cui devi innanzitutto scrivere i test che può soddisfare il codice risulta.</span><span class="sxs-lookup"><span data-stu-id="4c081-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="4c081-286">Con TDD iniziare mediante la creazione di un test che verifica la funzionalità che sta tentando di implementare ogni funzionalità.</span><span class="sxs-lookup"><span data-stu-id="4c081-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="4c081-287">La scrittura di unit test prima di tutto aiuta a garantire comprendere chiaramente la funzionalità e come deve per operare.</span><span class="sxs-lookup"><span data-stu-id="4c081-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="4c081-288">Solo dopo che il test è scritto (e aver verificato che abbia esito negativo) non è, implementare la funzionalità di che test di verifica.</span><span class="sxs-lookup"><span data-stu-id="4c081-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="4c081-289">Poiché si è già trascorso del tempo a pensare il caso d'uso del modo in cui la funzionalità deve per operare, si avrà una migliore comprensione dei requisiti e il modo migliore per la relativa implementazione.</span><span class="sxs-lookup"><span data-stu-id="4c081-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="4c081-290">Al termine con l'implementazione è possibile eseguire nuovamente il test e ottenere un feedback immediato agli come se la funzionalità funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="4c081-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="4c081-291">Si affronterà TDD più nel capitolo 10.</span><span class="sxs-lookup"><span data-stu-id="4c081-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="4c081-292">Passo successivo</span><span class="sxs-lookup"><span data-stu-id="4c081-292">Next Step</span></span>

<span data-ttu-id="4c081-293">Alcuni finale a capo dei commenti.</span><span class="sxs-lookup"><span data-stu-id="4c081-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4c081-294">[Precedente](use-ajax-to-implement-mapping-scenarios.md)
> [Successivo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="4c081-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
