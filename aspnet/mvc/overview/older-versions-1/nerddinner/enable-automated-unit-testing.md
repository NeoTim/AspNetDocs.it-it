---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Abilitare il testing unità automatizzato | Microsoft Docs
author: microsoft
description: Il passaggio 12 Mostra come sviluppare una suite di unit test automatizzati che verificano la funzionalità NerdDinner e che ci consentirà di apportare modifiche...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 09a7aa186605a6cce48ee94028425ded957c00d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78541678"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="4ec42-103">Abilitare unit test automatici</span><span class="sxs-lookup"><span data-stu-id="4ec42-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="4ec42-104">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="4ec42-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4ec42-105">Scaricare PDF</span><span class="sxs-lookup"><span data-stu-id="4ec42-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="4ec42-106">Questo è il passaggio 12 di un' [esercitazione gratuita sull'applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che illustra come creare un'applicazione Web di piccole dimensioni ma completa usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="4ec42-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="4ec42-107">Il passaggio 12 Mostra come sviluppare una suite di unit test automatizzati che verificano la funzionalità NerdDinner e che ci consentirà di apportare modifiche e miglioramenti all'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="4ec42-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="4ec42-108">Se si usa ASP.NET MVC 3, è consigliabile seguire le esercitazioni [Introduzione con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="4ec42-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="4ec42-109">NerdDinner passaggio 12: unit test</span><span class="sxs-lookup"><span data-stu-id="4ec42-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="4ec42-110">Viene ora sviluppato un gruppo di unit test automatizzati che verificano la funzionalità NerdDinner e che ci consentirà di apportare modifiche e miglioramenti all'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="4ec42-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="4ec42-111">Perché unit test?</span><span class="sxs-lookup"><span data-stu-id="4ec42-111">Why Unit Test?</span></span>

<span data-ttu-id="4ec42-112">Nell'unità di lavoro una mattina si ha un improvviso lampo di ispirazione su un'applicazione su cui si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="4ec42-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="4ec42-113">Ci si rende conto che è possibile implementare una modifica che renderà l'applicazione decisamente migliore.</span><span class="sxs-lookup"><span data-stu-id="4ec42-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="4ec42-114">Potrebbe trattarsi di un refactoring che pulisce il codice, aggiunge una nuova funzionalità o corregge un bug.</span><span class="sxs-lookup"><span data-stu-id="4ec42-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="4ec42-115">La domanda che si verifica quando si arriva al computer è la seguente: "Qual è la sicurezza di questo miglioramento?"</span><span class="sxs-lookup"><span data-stu-id="4ec42-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="4ec42-116">Cosa accade se la modifica ha effetti collaterali o si interrompe qualcosa?</span><span class="sxs-lookup"><span data-stu-id="4ec42-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="4ec42-117">La modifica potrebbe essere semplice e richiedere pochi minuti per l'implementazione, ma cosa accade se sono necessarie ore per testare manualmente tutti gli scenari di applicazione?</span><span class="sxs-lookup"><span data-stu-id="4ec42-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="4ec42-118">Cosa accade se si dimentica di coprire uno scenario e un'applicazione interruppe entra in produzione?</span><span class="sxs-lookup"><span data-stu-id="4ec42-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="4ec42-119">Questo miglioramento è effettivamente degno di tutto il lavoro richiesto?</span><span class="sxs-lookup"><span data-stu-id="4ec42-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="4ec42-120">Gli unit test automatici possono fornire una rete di sicurezza che consente di migliorare continuamente le applicazioni ed evitare di temere il codice su cui si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="4ec42-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="4ec42-121">La presenza di test automatizzati che verificano rapidamente la funzionalità consente di eseguire il codice in tutta sicurezza e di apportare miglioramenti che altrimenti potrebbero non essere più confortevoli.</span><span class="sxs-lookup"><span data-stu-id="4ec42-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="4ec42-122">Consentono inoltre di creare soluzioni più gestibili e di una durata più lunga, il che comporta un ritorno molto più elevato sugli investimenti.</span><span class="sxs-lookup"><span data-stu-id="4ec42-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="4ec42-123">Il framework MVC ASP.NET rende semplice e naturale unit test la funzionalità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="4ec42-124">Consente inoltre un flusso di lavoro di sviluppo basato su test (TDD) che consente lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="4ec42-125">Progetto NerdDinner. tests</span><span class="sxs-lookup"><span data-stu-id="4ec42-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="4ec42-126">Quando è stata creata l'applicazione NerdDinner all'inizio di questa esercitazione, viene visualizzata una finestra di dialogo in cui viene chiesto se si desidera creare un progetto unit test da usare con il progetto di applicazione:</span><span class="sxs-lookup"><span data-stu-id="4ec42-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="4ec42-127">È stato selezionato il pulsante di opzione "Sì, crea un progetto unit test", che ha determinato l'aggiunta di un progetto "NerdDinner. tests" alla soluzione:</span><span class="sxs-lookup"><span data-stu-id="4ec42-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="4ec42-128">Il progetto NerdDinner. tests fa riferimento all'assembly del progetto di applicazione NerdDinner e consente di aggiungere facilmente test automatizzati per verificare la funzionalità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="4ec42-129">Creazione di unit test per la classe del modello Dinner</span><span class="sxs-lookup"><span data-stu-id="4ec42-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="4ec42-130">È ora possibile aggiungere alcuni test al progetto NerdDinner. tests che verificano la classe Dinner creata durante la compilazione del livello del modello.</span><span class="sxs-lookup"><span data-stu-id="4ec42-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="4ec42-131">Si inizierà creando una nuova cartella all'interno del progetto di test denominato "Models", in cui verranno posizionati i test correlati al modello.</span><span class="sxs-lookup"><span data-stu-id="4ec42-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="4ec42-132">Fare clic con il pulsante destro del mouse sulla cartella e scegliere il comando di menu **aggiungi&gt;nuovo test** .</span><span class="sxs-lookup"><span data-stu-id="4ec42-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="4ec42-133">Verrà visualizzata la finestra di dialogo "Aggiungi nuovo test".</span><span class="sxs-lookup"><span data-stu-id="4ec42-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="4ec42-134">Si sceglie di creare uno "unit test" e denominarlo "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="4ec42-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="4ec42-135">Quando si fa clic sul pulsante "OK", Visual Studio aggiungerà (e aprirà) un file DinnerTest.cs al progetto:</span><span class="sxs-lookup"><span data-stu-id="4ec42-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="4ec42-136">Il modello di unit test di Visual Studio predefinito include una serie di codice della piastra calda che trovo un po' confuso.</span><span class="sxs-lookup"><span data-stu-id="4ec42-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="4ec42-137">È sufficiente pulirlo per contenere solo il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4ec42-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="4ec42-138">L'attributo [TestClass] della classe DinnerTest precedente lo identifica come una classe che conterrà i test, nonché l'inizializzazione di test facoltativa e il codice teardown.</span><span class="sxs-lookup"><span data-stu-id="4ec42-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="4ec42-139">È possibile definire i test al suo interno aggiungendo metodi pubblici con un attributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="4ec42-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="4ec42-140">Di seguito sono riportati i primi due test che verranno aggiunti a questo esercizio della nostra classe dinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="4ec42-141">Il primo test verifica che la cena non sia valida se viene creata una nuova cena senza che tutte le proprietà siano impostate correttamente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="4ec42-142">Il secondo test verifica che la cena sia valida quando una cena dispone di tutte le proprietà impostate con valori validi:</span><span class="sxs-lookup"><span data-stu-id="4ec42-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="4ec42-143">Si noterà che i nomi dei test sono molto espliciti (e poco dettagliati).</span><span class="sxs-lookup"><span data-stu-id="4ec42-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="4ec42-144">Questa operazione viene stabilita perché si potrebbe creare centinaia o migliaia di test di piccole dimensioni e si vuole semplificare la determinazione rapida dello scopo e del comportamento di ognuno di essi (specialmente quando si esamina un elenco di errori in un test runner).</span><span class="sxs-lookup"><span data-stu-id="4ec42-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="4ec42-145">I nomi dei test devono essere denominati dopo la funzionalità sottoposta a test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="4ec42-146">Sopra si usa un modello di denominazione "noun\_deve\_verbo".</span><span class="sxs-lookup"><span data-stu-id="4ec42-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="4ec42-147">Stiamo strutturando i test usando il modello di test "AAA", che sta per "Arrange, Act, Assert":</span><span class="sxs-lookup"><span data-stu-id="4ec42-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="4ec42-148">Disponi: configura l'unità sottoposta a test</span><span class="sxs-lookup"><span data-stu-id="4ec42-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="4ec42-149">Act: esercizio dell'unità sottoposta a test e acquisizione dei risultati</span><span class="sxs-lookup"><span data-stu-id="4ec42-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="4ec42-150">Assert: verifica il comportamento</span><span class="sxs-lookup"><span data-stu-id="4ec42-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="4ec42-151">Quando si scrivono i test, si vuole evitare che i singoli test eseguano troppe operazioni.</span><span class="sxs-lookup"><span data-stu-id="4ec42-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="4ec42-152">Ogni test deve invece verificare solo un singolo concetto (che renderà molto più semplice individuare la cause degli errori).</span><span class="sxs-lookup"><span data-stu-id="4ec42-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="4ec42-153">Una guida efficace consiste nel provare a usare una sola istruzione Assert per ogni test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="4ec42-154">Se si dispone di più di un'istruzione Assert in un metodo di test, assicurarsi che siano tutti usati per testare lo stesso concetto.</span><span class="sxs-lookup"><span data-stu-id="4ec42-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="4ec42-155">In caso di dubbi, effettuare un altro test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="4ec42-156">Esecuzione test</span><span class="sxs-lookup"><span data-stu-id="4ec42-156">Running Tests</span></span>

<span data-ttu-id="4ec42-157">Visual Studio 2008 Professional (e versioni successive) include un Test Runner incorporato che può essere usato per eseguire i progetti di unit test di Visual Studio all'interno dell'IDE.</span><span class="sxs-lookup"><span data-stu-id="4ec42-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="4ec42-158">Per eseguire tutti gli unit test, è possibile selezionare il comando di menu **Esegui test-&gt;&gt;tutti i test nel** menu della soluzione (o digitare CTRL R, a).</span><span class="sxs-lookup"><span data-stu-id="4ec42-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="4ec42-159">In alternativa, è possibile posizionare il cursore all'interno di una classe di test o di un metodo di test specifico e usare il test **-&gt;esecuzione di test&gt;** il comando del menu di scelta rapida corrente (oppure premere CTRL R, t) per eseguire un subset degli unit test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="4ec42-160">Posizionare il cursore all'interno della classe DinnerTest e digitare "CTRL R, T" per eseguire i due test appena definiti.</span><span class="sxs-lookup"><span data-stu-id="4ec42-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="4ec42-161">Quando si esegue questa operazione, verrà visualizzata una finestra "Risultati test" in Visual Studio per visualizzare i risultati dell'esecuzione dei test elencati al suo interno:</span><span class="sxs-lookup"><span data-stu-id="4ec42-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="4ec42-162">*Nota: per impostazione predefinita, nella finestra Risultati test di Visual Studio non viene visualizzata la colonna nome classe. È possibile aggiungere questa opzione facendo clic con il pulsante destro del mouse all'interno della finestra Risultati test e utilizzando il comando di menu Aggiungi/Rimuovi colonne.*</span><span class="sxs-lookup"><span data-stu-id="4ec42-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="4ec42-163">I due test hanno impiegato solo una frazione di un secondo per l'esecuzione, come si può notare che entrambi sono stati superati.</span><span class="sxs-lookup"><span data-stu-id="4ec42-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="4ec42-164">È ora possibile aumentare le prestazioni creando test aggiuntivi che verificano convalide specifiche delle regole, oltre a coprire i due metodi helper, ovvero IsUserHost () e IsUserRegistered (), aggiunti alla classe dinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="4ec42-165">La creazione di tutti questi test per la classe Dinner renderà molto più semplice e sicura l'aggiunta di nuove regole business e convalide in futuro.</span><span class="sxs-lookup"><span data-stu-id="4ec42-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="4ec42-166">Possiamo aggiungere la nuova logica di regola a dinner, quindi, entro pochi secondi, verificare che non sia stata interruppe alcuna funzionalità della logica precedente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="4ec42-167">Si noti che l'uso di un nome di test descrittivo rende più semplice comprendere rapidamente il risultato verificato da ogni test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="4ec42-168">Si consiglia di utilizzare il comando di menu **strumenti-&gt;opzioni** , aprire la schermata strumenti di test-&gt;configurazione esecuzione test e selezionare la casella di controllo "fare doppio clic su un risultato non riuscito o senza risultati unit test Visualizza il punto di errore nella casella di controllo test".</span><span class="sxs-lookup"><span data-stu-id="4ec42-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="4ec42-169">In questo modo sarà possibile fare doppio clic su un errore nella finestra Risultati test e passare immediatamente all'errore di asserzione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="4ec42-170">Creazione di unit test DinnersController</span><span class="sxs-lookup"><span data-stu-id="4ec42-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="4ec42-171">A questo punto, è possibile creare alcuni unit test per verificare la funzionalità DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ec42-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="4ec42-172">Per iniziare, fare clic con il pulsante destro del mouse sulla cartella "Controllers" nel progetto di test, quindi scegliere il comando di menu **aggiungi&gt;nuovo test** .</span><span class="sxs-lookup"><span data-stu-id="4ec42-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="4ec42-173">Creeremo uno "unit test" e denominarlo "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="4ec42-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="4ec42-174">Verranno creati due metodi di test che verificano il metodo di azione Details () su DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ec42-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="4ec42-175">Il primo verificherà che venga restituita una vista quando viene richiesta una cena esistente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="4ec42-176">Il secondo verificherà che venga restituita una visualizzazione "NotFound" quando viene richiesta una cena non esistente:</span><span class="sxs-lookup"><span data-stu-id="4ec42-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="4ec42-177">Il codice precedente compila clean.</span><span class="sxs-lookup"><span data-stu-id="4ec42-177">The above code compiles clean.</span></span> <span data-ttu-id="4ec42-178">Quando si eseguono i test, tuttavia, entrambi hanno esito negativo:</span><span class="sxs-lookup"><span data-stu-id="4ec42-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="4ec42-179">Se si esaminano i messaggi di errore, si noterà che il motivo per cui i test hanno avuto esito negativo è dovuto al fatto che la classe DinnersRepository non è stata in grado di connettersi a un database.</span><span class="sxs-lookup"><span data-stu-id="4ec42-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="4ec42-180">L'applicazione NerdDinner usa una stringa di connessione a un file di SQL Server Express locale che risiede nella directory \app\_data del progetto di applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="4ec42-181">Poiché il progetto NerdDinner. tests viene compilato ed eseguito in una directory diversa, il progetto dell'applicazione, il percorso relativo della stringa di connessione non è corretto.</span><span class="sxs-lookup"><span data-stu-id="4ec42-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="4ec42-182">È *possibile* risolvere il problema copiando il file di database di SQL Express nel progetto di test e quindi aggiungere una stringa di connessione di test appropriata al progetto di test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="4ec42-183">Questa operazione otterrebbe i test sopra sbloccati e in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="4ec42-184">Il testing unità di codice con un database reale, tuttavia, comporta una serie di problemi.</span><span class="sxs-lookup"><span data-stu-id="4ec42-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="4ec42-185">In particolare:</span><span class="sxs-lookup"><span data-stu-id="4ec42-185">Specifically:</span></span>

- <span data-ttu-id="4ec42-186">Rallenta significativamente il tempo di esecuzione degli unit test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="4ec42-187">Maggiore è il tempo necessario per eseguire i test, minore è la probabilità di eseguirli di frequente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="4ec42-188">Idealmente si vuole che gli unit test siano in grado di essere eseguiti in pochi secondi e che sia un elemento che viene eseguito in modo naturale come la compilazione del progetto.</span><span class="sxs-lookup"><span data-stu-id="4ec42-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="4ec42-189">Complica la logica di installazione e pulizia all'interno dei test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="4ec42-190">Si vuole che ogni unit test sia isolato e indipendente da altri, senza effetti collaterali o dipendenze.</span><span class="sxs-lookup"><span data-stu-id="4ec42-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="4ec42-191">Quando si utilizza un database reale, è necessario essere consapevoli dello stato e reimpostarlo tra i test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="4ec42-192">Esaminiamo uno schema progettuale denominato "inserimento delle dipendenze" che può aiutare a risolvere questi problemi ed evitare la necessità di usare un database reale con i nostri test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="4ec42-193">Inserimento di dipendenze</span><span class="sxs-lookup"><span data-stu-id="4ec42-193">Dependency Injection</span></span>

<span data-ttu-id="4ec42-194">Attualmente DinnersController è strettamente "accoppiato" alla classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4ec42-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="4ec42-195">"Accoppiamento" si riferisce a una situazione in cui una classe si basa in modo esplicito su un'altra classe per funzionare:</span><span class="sxs-lookup"><span data-stu-id="4ec42-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="4ec42-196">Poiché la classe DinnerRepository richiede l'accesso a un database, la dipendenza strettamente associata della classe DinnersController sul DinnerRepository richiede di disporre di un database affinché i metodi di azione DinnersController siano testati.</span><span class="sxs-lookup"><span data-stu-id="4ec42-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="4ec42-197">Per aggirare questo problema, è possibile usare un modello di progettazione denominato "inserimento delle dipendenze", ovvero un approccio in cui le dipendenze (ad esempio le classi di repository che forniscono l'accesso ai dati) non vengono più create in modo implicito all'interno di classi che le usano.</span><span class="sxs-lookup"><span data-stu-id="4ec42-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="4ec42-198">Al contrario, le dipendenze possono essere passate in modo esplicito alla classe che le utilizza usando gli argomenti del costruttore.</span><span class="sxs-lookup"><span data-stu-id="4ec42-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="4ec42-199">Se le dipendenze vengono definite usando le interfacce, si ha la flessibilità di passare le implementazioni di dipendenza "Fake" per gli scenari unit test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="4ec42-200">In questo modo è possibile creare implementazioni di dipendenza specifiche del test che non richiedono effettivamente l'accesso a un database.</span><span class="sxs-lookup"><span data-stu-id="4ec42-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="4ec42-201">Per verificarlo, è necessario implementare l'inserimento delle dipendenze con la DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ec42-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="4ec42-202">Estrazione di un'interfaccia IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="4ec42-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="4ec42-203">Il primo passaggio consiste nel creare una nuova interfaccia IDinnerRepository che incapsula il contratto di repository che i controller richiedono per recuperare e aggiornare le cene.</span><span class="sxs-lookup"><span data-stu-id="4ec42-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="4ec42-204">È possibile definire questo contratto di interfaccia manualmente facendo clic con il pulsante destro del mouse sulla cartella \Models e scegliendo il comando di menu **aggiungi&gt;nuovo elemento** e creando una nuova interfaccia denominata IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="4ec42-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="4ec42-205">In alternativa, è possibile usare gli strumenti di refactoring predefiniti Visual Studio Professional (e versioni successive) per estrarre e creare automaticamente un'interfaccia dalla classe DinnerRepository esistente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="4ec42-206">Per estrarre questa interfaccia con Visual Studio, posizionare semplicemente il cursore nell'editor di testo nella classe DinnerRepository, quindi fare clic con il pulsante destro del mouse e scegliere il comando di menu **refactoring-&gt;Estrai interfaccia** :</span><span class="sxs-lookup"><span data-stu-id="4ec42-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="4ec42-207">Verrà avviata la finestra di dialogo "Estrai interfaccia" e verrà richiesto il nome dell'interfaccia da creare.</span><span class="sxs-lookup"><span data-stu-id="4ec42-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="4ec42-208">L'impostazione predefinita è IDinnerRepository e seleziona automaticamente tutti i metodi pubblici sulla classe DinnerRepository esistente da aggiungere all'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="4ec42-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="4ec42-209">Quando si fa clic sul pulsante "OK", in Visual Studio viene aggiunta una nuova interfaccia IDinnerRepository all'applicazione:</span><span class="sxs-lookup"><span data-stu-id="4ec42-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="4ec42-210">E la classe DinnerRepository esistente verrà aggiornata in modo che implementi l'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="4ec42-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="4ec42-211">Aggiornamento di DinnersController per supportare l'inserimento del costruttore</span><span class="sxs-lookup"><span data-stu-id="4ec42-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="4ec42-212">Verrà ora aggiornata la classe DinnersController per usare la nuova interfaccia.</span><span class="sxs-lookup"><span data-stu-id="4ec42-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="4ec42-213">Attualmente DinnersController è hardcoded in modo tale che il campo "dinnerRepository" sia sempre una classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="4ec42-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="4ec42-214">Verrà modificato in modo che il campo "dinnerRepository" sia di tipo IDinnerRepository anziché DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4ec42-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="4ec42-215">Verranno quindi aggiunti due costruttori DinnersController pubblici.</span><span class="sxs-lookup"><span data-stu-id="4ec42-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="4ec42-216">Uno dei costruttori consente il passaggio di un IDinnerRepository come argomento.</span><span class="sxs-lookup"><span data-stu-id="4ec42-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="4ec42-217">L'altro è un costruttore predefinito che usa l'implementazione di DinnerRepository esistente:</span><span class="sxs-lookup"><span data-stu-id="4ec42-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="4ec42-218">Poiché per impostazione predefinita MVC ASP.NET crea classi controller usando costruttori predefiniti, il DinnersController in fase di esecuzione continuerà a usare la classe DinnerRepository per eseguire l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="4ec42-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="4ec42-219">È ora possibile aggiornare gli unit test per passare un'implementazione "Fake" del repository Dinner usando il costruttore di parametri.</span><span class="sxs-lookup"><span data-stu-id="4ec42-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="4ec42-220">Questo repository di cene "Fake" non richiede l'accesso a un database reale e usa invece i dati di esempio in memoria.</span><span class="sxs-lookup"><span data-stu-id="4ec42-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="4ec42-221">Creazione della classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="4ec42-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="4ec42-222">Viene ora creata una classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4ec42-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="4ec42-223">Si inizierà con la creazione di una directory "Fakes" all'interno del progetto NerdDinner. tests, quindi si aggiungerà una nuova classe FakeDinnerRepository (fare clic con il pulsante destro del mouse sulla cartella e scegliere **Add-&gt;nuova classe**):</span><span class="sxs-lookup"><span data-stu-id="4ec42-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="4ec42-224">Il codice verrà aggiornato in modo che la classe FakeDinnerRepository implementi l'interfaccia IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4ec42-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="4ec42-225">È possibile fare clic con il pulsante destro del mouse su di esso e scegliere il comando del menu di scelta rapida "implementa interfaccia IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="4ec42-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="4ec42-226">In questo modo Visual Studio aggiungerà automaticamente tutti i membri dell'interfaccia IDinnerRepository alla classe FakeDinnerRepository con implementazioni predefinite di "Stub out":</span><span class="sxs-lookup"><span data-stu-id="4ec42-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="4ec42-227">È quindi possibile aggiornare l'implementazione di FakeDinnerRepository in modo che funzioni da un elenco in memoria&lt;Dinner&gt; Collection passato come argomento del costruttore:</span><span class="sxs-lookup"><span data-stu-id="4ec42-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="4ec42-228">È ora disponibile un'implementazione di IDinnerRepository fittizia che non richiede un database e può invece usare un elenco in memoria di oggetti dinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="4ec42-229">Uso di FakeDinnerRepository con unit test</span><span class="sxs-lookup"><span data-stu-id="4ec42-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="4ec42-230">Torniamo agli unit test DinnersController che hanno avuto esito negativo in precedenza, perché il database non era disponibile.</span><span class="sxs-lookup"><span data-stu-id="4ec42-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="4ec42-231">È possibile aggiornare i metodi di test per usare un FakeDinnerRepository popolato con i dati di cena in memoria di esempio in DinnersController usando il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4ec42-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="4ec42-232">A questo punto, quando si eseguono questi test, entrambi passano:</span><span class="sxs-lookup"><span data-stu-id="4ec42-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="4ec42-233">Meglio, richiedono solo una frazione di un secondo per l'esecuzione e non richiedono alcuna logica di installazione/pulizia complessa.</span><span class="sxs-lookup"><span data-stu-id="4ec42-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="4ec42-234">È ora possibile unit test tutto il codice del metodo di azione DinnersController (inclusi elenchi, paging, dettagli, creazione, aggiornamento ed eliminazione) senza mai dover connettersi a un database reale.</span><span class="sxs-lookup"><span data-stu-id="4ec42-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="4ec42-235">**Argomento laterale: Framework di inserimento delle dipendenze**</span><span class="sxs-lookup"><span data-stu-id="4ec42-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="4ec42-236">L'inserimento manuale delle dipendenze (come sopra) funziona correttamente, ma diventa più difficile da gestire quando aumenta il numero di dipendenze e componenti in un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="4ec42-237">Sono disponibili diversi framework di inserimento delle dipendenze per .NET che consentono di garantire una maggiore flessibilità di gestione delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="4ec42-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="4ec42-238">Questi Framework, anche a volte detti contenitori IoC (Inversion of Control), forniscono meccanismi che consentono un ulteriore livello di supporto della configurazione per specificare e passare le dipendenze agli oggetti in fase di esecuzione (più spesso usando l'inserimento del costruttore ).</span><span class="sxs-lookup"><span data-stu-id="4ec42-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="4ec42-239">Di seguito sono riportati alcuni dei più diffusi framework di inserimento/IOC delle dipendenze OSS in .NET: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="4ec42-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="4ec42-240">ASP.NET MVC espone le API di estendibilità che consentono agli sviluppatori di partecipare alla risoluzione e alla creazione di istanze dei controller e che consente di integrare in questo processo i Framework di inserimento delle dipendenze/IoC.</span><span class="sxs-lookup"><span data-stu-id="4ec42-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="4ec42-241">L'uso di un framework DI i/o IOC ci consente anche di rimuovere il costruttore predefinito dal DinnersController, che rimuove completamente l'accoppiamento tra l'oggetto e il DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4ec42-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="4ec42-242">Non verrà usato un Framework di inserimento delle dipendenze/IOC con l'applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="4ec42-243">Tuttavia, è possibile prendere in considerazione il futuro se la base di codice e le funzionalità di NerdDinner sono aumentate.</span><span class="sxs-lookup"><span data-stu-id="4ec42-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="4ec42-244">Creazione di unit test azione di modifica</span><span class="sxs-lookup"><span data-stu-id="4ec42-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="4ec42-245">Verranno ora creati alcuni unit test che verificano la funzionalità di modifica di DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ec42-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="4ec42-246">Si inizierà testando la versione HTTP-GET dell'azione di modifica:</span><span class="sxs-lookup"><span data-stu-id="4ec42-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="4ec42-247">Verrà creato un test che verifica che venga eseguito il rendering di una visualizzazione supportata da un oggetto DinnerFormViewModel quando viene richiesta una cena valida:</span><span class="sxs-lookup"><span data-stu-id="4ec42-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="4ec42-248">Quando si esegue il test, tuttavia, si noterà che l'operazione ha esito negativo perché viene generata un'eccezione di riferimento null quando il metodo Edit accede alla proprietà User.Identity.Name per eseguire il controllo dinner. IsHostedBy ().</span><span class="sxs-lookup"><span data-stu-id="4ec42-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="4ec42-249">L'oggetto utente nella classe di base controller incapsula i dettagli sull'utente connesso e viene popolato da ASP.NET MVC quando crea il controller in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="4ec42-250">Poiché si sta testando il DinnersController all'esterno di un ambiente server Web, l'oggetto utente non è impostato, di conseguenza l'eccezione di riferimento null.</span><span class="sxs-lookup"><span data-stu-id="4ec42-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="4ec42-251">Simulazione della proprietà User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="4ec42-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="4ec42-252">I Framework di simulazione semplificano i test consentendo di creare in modo dinamico versioni Fake di oggetti dipendenti che supportano i test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="4ec42-253">Ad esempio, è possibile usare un Framework fittizio nel test azione di modifica per creare dinamicamente un oggetto utente che il DinnersController può usare per cercare un nome utente simulato.</span><span class="sxs-lookup"><span data-stu-id="4ec42-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="4ec42-254">In questo modo si eviterà che un riferimento null venga generato quando si esegue il test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="4ec42-255">Sono disponibili molti Framework di simulazione .NET che possono essere usati con ASP.NET MVC (è possibile visualizzarne un elenco qui: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="4ec42-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="4ec42-256">Per il test dell'applicazione NerdDinner verrà usato un Framework di simulazione open source denominato "MOQ", che può essere scaricato gratuitamente da [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="4ec42-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="4ec42-257">Al termine del download, verrà aggiunto un riferimento nel progetto NerdDinner. tests all'assembly MOQ. dll:</span><span class="sxs-lookup"><span data-stu-id="4ec42-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="4ec42-258">Si aggiungerà quindi un metodo helper "CreateDinnersControllerAs (username)" alla classe di test che accetta un nome utente come parametro e che quindi "simula" la proprietà User.Identity.Name nell'istanza di DinnersController:</span><span class="sxs-lookup"><span data-stu-id="4ec42-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="4ec42-259">Sopra si usa MOQ per creare un oggetto fittizio che simula un oggetto ControllerContext (che ASP.NET MVC passa alle classi controller per esporre oggetti di runtime quali utente, richiesta, risposta e sessione).</span><span class="sxs-lookup"><span data-stu-id="4ec42-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="4ec42-260">Viene chiamato il metodo "SetupGet" sulla simulazione per indicare che la proprietà HttpContext.User.Identity.Name in ControllerContext deve restituire la stringa username passata al metodo helper.</span><span class="sxs-lookup"><span data-stu-id="4ec42-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="4ec42-261">È possibile simulare un numero qualsiasi di proprietà e metodi di ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="4ec42-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="4ec42-262">Per illustrare questo problema, ho aggiunto anche una chiamata a SetupGet () per la proprietà Request. IsAuthenticated (che non è effettivamente necessaria per i test seguenti, ma che consente di illustrare come è possibile simulare le proprietà della richiesta).</span><span class="sxs-lookup"><span data-stu-id="4ec42-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="4ec42-263">Al termine, viene assegnata un'istanza della simulazione ControllerContext al DinnersController il metodo di supporto viene restituito.</span><span class="sxs-lookup"><span data-stu-id="4ec42-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="4ec42-264">È ora possibile scrivere unit test che usano questo metodo helper per testare gli scenari di modifica che coinvolgono utenti diversi:</span><span class="sxs-lookup"><span data-stu-id="4ec42-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="4ec42-265">A questo punto, quando si eseguono i test superati:</span><span class="sxs-lookup"><span data-stu-id="4ec42-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="4ec42-266">Test di scenari UpdateModel ()</span><span class="sxs-lookup"><span data-stu-id="4ec42-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="4ec42-267">Sono stati creati test che coprono la versione HTTP-GET dell'azione di modifica.</span><span class="sxs-lookup"><span data-stu-id="4ec42-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="4ec42-268">Verranno ora creati alcuni test che verificano la versione HTTP-POST dell'azione di modifica:</span><span class="sxs-lookup"><span data-stu-id="4ec42-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="4ec42-269">Il nuovo scenario di test interessante da supportare con questo metodo di azione è l'utilizzo del metodo helper UpdateModel () nella classe di base del controller.</span><span class="sxs-lookup"><span data-stu-id="4ec42-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="4ec42-270">Questo metodo helper viene usato per associare i valori dei post di form all'istanza dell'oggetto dinner.</span><span class="sxs-lookup"><span data-stu-id="4ec42-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="4ec42-271">Di seguito sono riportati due test che illustrano come è possibile fornire i valori inviati del modulo per il metodo helper UpdateModel () da usare.</span><span class="sxs-lookup"><span data-stu-id="4ec42-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="4ec42-272">Per eseguire questa operazione, è necessario creare e popolare un oggetto FormCollection, quindi assegnarlo alla proprietà "ValueProvider" nel controller.</span><span class="sxs-lookup"><span data-stu-id="4ec42-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="4ec42-273">Il primo test verifica che in un salvataggio riuscito il browser venga reindirizzato all'azione dettagli.</span><span class="sxs-lookup"><span data-stu-id="4ec42-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="4ec42-274">Il secondo test verifica che, quando viene pubblicato un input non valido, l'azione rivisualizzi nuovamente la visualizzazione di modifica con un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="4ec42-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="4ec42-275">Test a capo</span><span class="sxs-lookup"><span data-stu-id="4ec42-275">Testing Wrap-Up</span></span>

<span data-ttu-id="4ec42-276">Sono stati analizzati i concetti di base relativi alle classi controller unit test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="4ec42-277">È possibile usare queste tecniche per creare con facilità centinaia di semplici test che verificano il comportamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="4ec42-278">Poiché i test del controller e del modello non richiedono un database reale, sono estremamente veloci e facili da eseguire.</span><span class="sxs-lookup"><span data-stu-id="4ec42-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="4ec42-279">Potrai eseguire centinaia di test automatizzati in pochi secondi e ricevere immediatamente commenti e suggerimenti sull'eventuale modifica apportata a un problema.</span><span class="sxs-lookup"><span data-stu-id="4ec42-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="4ec42-280">In questo modo, ci consentirà di migliorare continuamente, effettuare il refactoring e affinare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ec42-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="4ec42-281">Il test è stato trattato come ultimo argomento di questo capitolo, ma non perché i test sono elementi da eseguire al termine di un processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="4ec42-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="4ec42-282">Al contrario, è consigliabile scrivere test automatizzati il prima possibile nel processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="4ec42-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="4ec42-283">In questo modo è possibile ottenere un feedback immediato durante lo sviluppo, che consente di riflettere attentamente sugli scenari dei casi d'uso dell'applicazione e consente di progettare l'applicazione con livelli e accoppiamento puliti.</span><span class="sxs-lookup"><span data-stu-id="4ec42-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="4ec42-284">Un capitolo successivo del libro illustrerà lo sviluppo basato su test (TDD) e il modo in cui usarlo con ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="4ec42-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="4ec42-285">TDD è una procedura di codifica iterativa in cui è necessario prima scrivere i test che il codice risultante soddisferà.</span><span class="sxs-lookup"><span data-stu-id="4ec42-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="4ec42-286">Con TDD si inizia ogni funzionalità creando un test per verificare la funzionalità che si sta per implementare.</span><span class="sxs-lookup"><span data-stu-id="4ec42-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="4ec42-287">Scrivere il unit test per prima cosa consente di comprendere chiaramente la funzionalità e come dovrebbe funzionare.</span><span class="sxs-lookup"><span data-stu-id="4ec42-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="4ec42-288">Quando il test è stato scritto e si è verificato un errore, è necessario implementare la funzionalità effettiva verificata dal test.</span><span class="sxs-lookup"><span data-stu-id="4ec42-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="4ec42-289">Poiché si è già trascorso tempo pensando al caso d'uso di come la funzionalità dovrebbe funzionare, si avrà una migliore comprensione dei requisiti e del modo migliore per implementarli.</span><span class="sxs-lookup"><span data-stu-id="4ec42-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="4ec42-290">Al termine dell'implementazione, è possibile eseguire nuovamente il test e ottenere un feedback immediato per verificare se la funzionalità funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="4ec42-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="4ec42-291">Nel capitolo 10 verrà trattata una maggiore quantità di informazioni su TDD.</span><span class="sxs-lookup"><span data-stu-id="4ec42-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="4ec42-292">Passo successivo</span><span class="sxs-lookup"><span data-stu-id="4ec42-292">Next Step</span></span>

<span data-ttu-id="4ec42-293">Alcuni commenti finali di riepilogo.</span><span class="sxs-lookup"><span data-stu-id="4ec42-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4ec42-294">[Precedente](use-ajax-to-implement-mapping-scenarios.md)
> [Successivo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="4ec42-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
