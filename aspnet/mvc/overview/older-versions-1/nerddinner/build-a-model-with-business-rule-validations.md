---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Creazione di un modello con le convalide delle regole di business Documenti Microsoft
author: rick-anderson
description: Passaggio 3 viene illustrato come creare un modello che è possibile utilizzare per eseguire query e aggiornare il database per l'applicazione NerdDinner.Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 1a316e9051cf56cd4f1546336b334ace991c05b3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541637"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="4f93b-103">Creare un modello con convalide delle regole business</span><span class="sxs-lookup"><span data-stu-id="4f93b-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="4f93b-104">da parte [di Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="4f93b-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4f93b-105">Scarica il PDF</span><span class="sxs-lookup"><span data-stu-id="4f93b-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="4f93b-106">Questo è il passaggio 3 di un'esercitazione gratuita [sull'applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che illustra come compilare un'applicazione Web piccola ma completa usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="4f93b-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="4f93b-107">Passaggio 3 viene illustrato come creare un modello che è possibile utilizzare per eseguire query e aggiornare il database per l'applicazione NerdDinner.Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span><span class="sxs-lookup"><span data-stu-id="4f93b-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="4f93b-108">Se si utilizza ASP.NET MVC 3, è consigliabile seguire le esercitazioni [Introduzione a MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [ALL'archivio musicale MVC.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="4f93b-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="4f93b-109">Passaggio 3 di NerdDinner: Creazione del modelloNerdDinner Step 3: Building the Model</span><span class="sxs-lookup"><span data-stu-id="4f93b-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="4f93b-110">In un framework model-view-controller il termine "modello" si riferisce agli oggetti che rappresentano i dati dell'applicazione, nonché alla logica di dominio corrispondente che integra la convalida e le regole di business con esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="4f93b-111">Il modello è per molti aspetti il "cuore" di un'applicazione basata su MVC e, come vedremo più avanti, guida fondamentalmente il comportamento di esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="4f93b-112">Il framework di MVC ASP.NET supporta l'utilizzo di qualsiasi tecnologia di accesso ai dati e gli sviluppatori possono scegliere tra un'ampia gamma di opzioni di dati .NET avanzate per implementare i modelli, tra cui: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM o semplicemente non elaborati ADO.NET DataReader o DataSet.</span><span class="sxs-lookup"><span data-stu-id="4f93b-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="4f93b-113">Per la nostra applicazione NerdDinner useremo LINQ to SQLLINQ to SQL per creare un modello semplice che corrisponde abbastanza strettamente alla progettazione del database e aggiunge alcune regole di convalida e business personalizzate.</span><span class="sxs-lookup"><span data-stu-id="4f93b-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="4f93b-114">Implementeremo quindi una classe di repository che consente di astrarre l'implementazione di persistenza dei dati dal resto dell'applicazione e ci consente di eseguire facilmente unit test.</span><span class="sxs-lookup"><span data-stu-id="4f93b-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="4f93b-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="4f93b-115">LINQ to SQL</span></span>

<span data-ttu-id="4f93b-116">LINQ to SQLLINQ to SQL è un ORM (object relational mapper) fornito come parte di .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="4f93b-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="4f93b-117">LINQ to SQLLINQ to SQL fornisce un modo semplice per eseguire il mapping di tabelle di database a classi .NET in cui è possibile eseguire il codice.</span><span class="sxs-lookup"><span data-stu-id="4f93b-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="4f93b-118">Per la nostra applicazione NerdDinner useremo per mappare le tabelle Dinners e RSVP all'interno del nostro database alle classi Dinner e RSVP.</span><span class="sxs-lookup"><span data-stu-id="4f93b-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="4f93b-119">Le colonne delle tabelle Dinners e RSVP corrisponderanno alle proprietà delle classi Dinner e RSVP.</span><span class="sxs-lookup"><span data-stu-id="4f93b-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="4f93b-120">Ogni oggetto Dinner e RSVP rappresenterà una riga separata all'interno delle tabelle Dinners o RSVP nel database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="4f93b-121">LINQ to SQLLINQ to SQL consente di evitare di dover costruire manualmente istruzioni SQL per recuperare e aggiornare gli oggetti Dinner e RSVP con i dati del database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="4f93b-122">Al contrario, definiremo le classi Dinner e RSVP, la modalità di mapping al/dal database e le relazioni tra di esse.</span><span class="sxs-lookup"><span data-stu-id="4f93b-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="4f93b-123">LINQ to SQLLINQ to SQL si occuperà quindi di generare la logica di esecuzione SQL appropriata da usare in fase di esecuzione quando le interagiamo e le utilizzeremo.</span><span class="sxs-lookup"><span data-stu-id="4f93b-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="4f93b-124">È possibile usare il supporto del linguaggio LINQ all'interno di VB e C , per scrivere query espressive che recuperano gli oggetti Dinner e RSVP dal database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="4f93b-125">Questo riduce al minimo la quantità di codice di dati che è necessario scrivere e ci permette di creare applicazioni veramente pulite.</span><span class="sxs-lookup"><span data-stu-id="4f93b-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="4f93b-126">Aggiunta di classi LINQ to SQL al progettoAdding LINQ to SQL Classes to our project</span><span class="sxs-lookup"><span data-stu-id="4f93b-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="4f93b-127">Inizieremo facendo clic con il pulsante destro del mouse sulla cartella "Modelli" all'interno del nostro progetto e selezioniamo il comando di menu **Aggiungi-&gt;Nuovo elemento:**</span><span class="sxs-lookup"><span data-stu-id="4f93b-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="4f93b-128">Verrà eseguito la finestra di dialogo "Aggiungi nuovo elemento".</span><span class="sxs-lookup"><span data-stu-id="4f93b-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="4f93b-129">Il filtro verrà eseguito in base alla categoria "Dati" e si selezionerà il modello "Classi LINQ to SQL" al suo interno:</span><span class="sxs-lookup"><span data-stu-id="4f93b-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="4f93b-130">Chiameremo la voce "NerdDinner" e fare clic sul pulsante "Aggiungi".</span><span class="sxs-lookup"><span data-stu-id="4f93b-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="4f93b-131">Visual Studio aggiungerà un file NerdDinner.dbml nella directory di modelli e quindi aprirà la finestra di progettazione relazionale oggetti LINQ to SQL:</span><span class="sxs-lookup"><span data-stu-id="4f93b-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="4f93b-132">Creazione di classi del modello di dati con LINQ to SQLCreating Data Model Classes with LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="4f93b-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="4f93b-133">LINQ to SQLLINQ to SQL consente di creare rapidamente classi del modello di dati dallo schema di database esistente.</span><span class="sxs-lookup"><span data-stu-id="4f93b-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="4f93b-134">A tale scopo, apriremo il database NerdDinner in Esplora server e selezioneremo le tabelle che si desidera modellare in esso:</span><span class="sxs-lookup"><span data-stu-id="4f93b-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="4f93b-135">È quindi possibile trascinare le tabelle nell'area di progettazione LINQ to SQLLINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="4f93b-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="4f93b-136">Quando si esegue questa operazione LINQ to SQLLINQ to SQL verranno create automaticamente le classi Dinner e RSVP utilizzando lo schema delle tabelle (con le proprietà della classe che eseguono il mapping alle colonne della tabella di database):</span><span class="sxs-lookup"><span data-stu-id="4f93b-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="4f93b-137">Per impostazione predefinita, la finestra di progettazione LINQ to SQLLINQ to SQL "pluralizza" automaticamente i nomi di tabelle e colonne quando crea classi in base a uno schema di database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="4f93b-138">Ad esempio: la tabella "Dinners" nel nostro esempio precedente ha generato una classe "Dinner".</span><span class="sxs-lookup"><span data-stu-id="4f93b-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="4f93b-139">Questa denominazione di classe consente di rendere i modelli coerenti con le convenzioni di denominazione .NET e in genere trovo che la progettazione risolvere questo problema conveniente (soprattutto quando si aggiungono molte tabelle).</span><span class="sxs-lookup"><span data-stu-id="4f93b-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="4f93b-140">Se non si è piaciuti il nome di una classe o di una proprietà generata dalla finestra di progettazione, tuttavia, è sempre possibile eseguirne l'override e modificarlo con qualsiasi nome desiderato.</span><span class="sxs-lookup"><span data-stu-id="4f93b-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="4f93b-141">È possibile eseguire questa operazione modificando il nome dell'entità/proprietà in linea all'interno della finestra di progettazione o modificandolo tramite la griglia delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="4f93b-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="4f93b-142">Per impostazione predefinita, la finestra di progettazione LINQ to SQLLINQ to SQL controlla anche le relazioni chiave primaria/chiave esterna delle tabelle e in base a esse crea automaticamente "associazioni di relazioni" predefinite tra le diverse classi del modello che crea.</span><span class="sxs-lookup"><span data-stu-id="4f93b-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="4f93b-143">Ad esempio, quando abbiamo trascinato le tabelle Dinners e RSVP nella finestra di progettazione LINQ to SQL è stata dedotta un'associazione di relazione uno-a-molti tra i due in base al fatto che la tabella RSVP aveva una chiave esterna per la tabella Dinners (questo è indicato dalla freccia nella finestra di progettazione):</span><span class="sxs-lookup"><span data-stu-id="4f93b-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="4f93b-144">L'associazione precedente farà in modo che LINQ to SQLLINQ to SQL aggiure una proprietà "Dinner" fortemente tipizzata alla classe RSVP che gli sviluppatori possono utilizzare per accedere alla dinner associata a un determinato RSVP.</span><span class="sxs-lookup"><span data-stu-id="4f93b-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="4f93b-145">Verrà inoltre la classe Dinner di una proprietà di raccolta "RSVP" che consente agli sviluppatori di recuperare e aggiornare gli oggetti RSVP associati a un particolare Dinner.</span><span class="sxs-lookup"><span data-stu-id="4f93b-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="4f93b-146">Di seguito è riportato un esempio di intellisense all'interno di Visual Studio quando si crea un nuovo oggetto RSVP e lo si aggiunge a una raccolta RSVP di Dinner.</span><span class="sxs-lookup"><span data-stu-id="4f93b-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="4f93b-147">Si noti come LINQ to SQLLINQ to SQL ha aggiunto automaticamente una raccolta "RSSP" nell'oggetto Dinner:</span><span class="sxs-lookup"><span data-stu-id="4f93b-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="4f93b-148">Aggiungendo l'oggetto RSVP alla raccolta RSVP della dinner, viene detto a LINQ to SQL LINQ to SQL di associare una relazione di chiave esterna tra la riga Dinner e RSVP del database:</span><span class="sxs-lookup"><span data-stu-id="4f93b-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="4f93b-149">Se non si è come la finestra di progettazione ha modellato o denominato un'associazione di tabella, è possibile eseguirne l'override.</span><span class="sxs-lookup"><span data-stu-id="4f93b-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="4f93b-150">È sufficiente fare clic sulla freccia di associazione all'interno della finestra di progettazione e accedere alle relative proprietà tramite la griglia delle proprietà per rinominarla, eliminarla o modificarla.</span><span class="sxs-lookup"><span data-stu-id="4f93b-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="4f93b-151">Per l'applicazione NerdDinner, tuttavia, le regole di associazione predefinite funzionano bene per le classi del modello di dati che stiamo compilando e possiamo solo usare il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="4f93b-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="4f93b-152">Classe NerdDinnerDataContext</span><span class="sxs-lookup"><span data-stu-id="4f93b-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="4f93b-153">Visual Studio creerà automaticamente classi .NET che rappresentano i modelli e le relazioni di database definiti utilizzando la finestra di progettazione LINQ to SQLLINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="4f93b-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="4f93b-154">Una classe LINQ to SQLLINQ to SQL DataContext viene generata anche per ogni file della finestra di progettazione LINQ to SQLLINQ to SQL aggiunto alla soluzione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="4f93b-155">Poiché è stato denominato l'elemento di classe LINQ to SQLLINQ to SQL "NerdDinner", la classe DataContext creata verrà denominata "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="4f93b-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="4f93b-156">Questa classe NerdDinnerDataContext è il modo principale in cui interageremo con il database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="4f93b-157">La nostra classe NerdDinnerDataContext espone due proprietà, "Dinners" e "RSVP" , che rappresentano le due tabelle modellate all'interno del database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="4f93b-158">È possibile usare C , per scrivere query LINQ su tali proprietà per eseguire query e recuperare gli oggetti Dinner e RSVP dal database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="4f93b-159">Il codice seguente illustra come creare un'istanza di un oggetto NerdDinnerDataContext ed eseguire una query LINQ su di esso per ottenere una sequenza di Dinners che si verificano in futuro.</span><span class="sxs-lookup"><span data-stu-id="4f93b-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="4f93b-160">Visual Studio fornisce intellisense completo durante la scrittura della query LINQ e gli oggetti da essa restituiti sono fortemente tipizzati e supportano anche intellisense:Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span><span class="sxs-lookup"><span data-stu-id="4f93b-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="4f93b-161">Oltre a consentirci di eseguire una query per gli oggetti Dinner e RSVP, un Oggetto NerdDinnerDataContext tiene traccia automaticamente anche di tutte le modifiche apportate successivamente agli oggetti Dinner e RSVP che recuperiamo attraverso di esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="4f93b-162">È possibile utilizzare questa funzionalità per salvare facilmente le modifiche nel database, senza dover scrivere codice di aggiornamento SQL esplicito.</span><span class="sxs-lookup"><span data-stu-id="4f93b-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="4f93b-163">Ad esempio, il codice seguente illustra come utilizzare una query LINQ per recuperare un singolo oggetto Dinner dal database, aggiornare due delle proprietà Dinner e quindi salvare nuovamente le modifiche nel database:</span><span class="sxs-lookup"><span data-stu-id="4f93b-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="4f93b-164">L'oggetto NerdDinnerDataContext nel codice precedente ha automaticamente registrato le modifiche alle proprietà apportate all'oggetto Dinner recuperato da esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="4f93b-165">Quando abbiamo chiamato il metodo "SubmitChanges()", eseguirà un'istruzione SQL "UPDATE" appropriata al database per rendere persistenti i valori aggiornati.</span><span class="sxs-lookup"><span data-stu-id="4f93b-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="4f93b-166">Creazione di una classe DinnerRepositoryCreating a DinnerRepository Class</span><span class="sxs-lookup"><span data-stu-id="4f93b-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="4f93b-167">Per le applicazioni di piccole dimensioni, a volte è bene fare in modo che I controller lavorino direttamente su una classe LINQ to SQL Linq to SQL DataContext e incorporare query LINQ all'interno dei controller.</span><span class="sxs-lookup"><span data-stu-id="4f93b-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="4f93b-168">Man mano che le applicazioni diventano più grandi, tuttavia, questo approccio diventa ingombrante da gestire e testare.</span><span class="sxs-lookup"><span data-stu-id="4f93b-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="4f93b-169">Può anche portare a noi la duplicazione delle stesse query LINQ in più posizioni.</span><span class="sxs-lookup"><span data-stu-id="4f93b-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="4f93b-170">Un approccio che può semplificare la manutenzione e il test delle applicazioni consiste nell'utilizzare un modello di "repository".</span><span class="sxs-lookup"><span data-stu-id="4f93b-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="4f93b-171">Una classe di repository consente di incapsulare la logica di query e persistenza dei dati e astrae i dettagli di implementazione della persistenza dei dati dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="4f93b-172">Oltre a rendere più pulito il codice dell'applicazione, l'uso di un modello di repository può semplificare la modifica delle implementazioni di archiviazione dei dati in futuro e può facilitare l'unit test di un'applicazione senza richiedere un database reale.</span><span class="sxs-lookup"><span data-stu-id="4f93b-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="4f93b-173">Per l'applicazione NerdDinner definiremo una classe DinnerRepository con la firma seguente:For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span><span class="sxs-lookup"><span data-stu-id="4f93b-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="4f93b-174">*Nota: Più avanti in questo capitolo estrarremo un'interfaccia IDinnerRepository da questa classe e abiliteremo l'inserimento delle dipendenze con esso nei controller. Per cominciare, però, inizieremo semplice e solo lavorare direttamente con la classe DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="4f93b-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="4f93b-175">Per implementare questa classe fare clic con il pulsante destro del mouse sulla cartella "Modelli" e scegliere il comando di menu **Aggiungi-&gt;Nuovo elemento.**</span><span class="sxs-lookup"><span data-stu-id="4f93b-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="4f93b-176">All'interno della finestra di dialogo "Aggiungi nuovo elemento" selezioneremo il modello "Classe" e denominare il file "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="4f93b-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="4f93b-177">È quindi possibile implementare la classe DinnerRepository usando il codice seguente:We can then implement our DinnerRepository class using the code below:</span><span class="sxs-lookup"><span data-stu-id="4f93b-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="4f93b-178">Recupero, aggiornamento, inserimento ed eliminazione tramite la classe DinnerRepositoryRetrieving, Updating, Inserting and Deleting using the DinnerRepository class</span><span class="sxs-lookup"><span data-stu-id="4f93b-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="4f93b-179">Ora che abbiamo creato la nostra classe DinnerRepository, diamo un'occhiata ad alcuni esempi di codice che illustrano le attività comuni che possiamo fare con esso:</span><span class="sxs-lookup"><span data-stu-id="4f93b-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="4f93b-180">Esempi di queryQuerying Examples</span><span class="sxs-lookup"><span data-stu-id="4f93b-180">Querying Examples</span></span>

<span data-ttu-id="4f93b-181">Il codice seguente recupera una singola Dinner usando il valore DinnerID:The code below retrieves a single Dinner using the DinnerID value:</span><span class="sxs-lookup"><span data-stu-id="4f93b-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="4f93b-182">Il codice seguente recupera tutte le cene e i loop imminenti su di essi:</span><span class="sxs-lookup"><span data-stu-id="4f93b-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="4f93b-183">Esempi di inserimento e aggiornamento</span><span class="sxs-lookup"><span data-stu-id="4f93b-183">Insert and Update Examples</span></span>

<span data-ttu-id="4f93b-184">Il codice seguente illustra l'aggiunta di due nuove cene.</span><span class="sxs-lookup"><span data-stu-id="4f93b-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="4f93b-185">Le aggiunte/modifiche al repository non vengono salvate nel database finché non viene chiamato il metodo "Save()".</span><span class="sxs-lookup"><span data-stu-id="4f93b-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="4f93b-186">LINQ to SQLLINQ to SQL esegue automaticamente il wrapping di tutte le modifiche in una transazione di database, pertanto vengono apportate tutte le modifiche o quando il repository viene salvato:LINQ to SQL SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span><span class="sxs-lookup"><span data-stu-id="4f93b-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="4f93b-187">Il codice seguente recupera un oggetto Dinner esistente e modifica due proprietà su di esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="4f93b-188">Il commit delle modifiche viene eseguito nel database quando il metodo "Save()" viene chiamato sul nostro repository:</span><span class="sxs-lookup"><span data-stu-id="4f93b-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="4f93b-189">Il codice seguente recupera una cena e quindi vi aggiunge un RSVP.</span><span class="sxs-lookup"><span data-stu-id="4f93b-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="4f93b-190">Questa operazione viene eseguito utilizzando la raccolta RSVP sull'oggetto Dinner creato automaticamente da LINQ to SQL (perché esiste una relazione chiave primaria/chiave esterna tra i due nel database).</span><span class="sxs-lookup"><span data-stu-id="4f93b-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="4f93b-191">Questa modifica viene mantenuta nel database come nuova riga della tabella RSVP quando il metodo "Save()" viene chiamato nel repository:</span><span class="sxs-lookup"><span data-stu-id="4f93b-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="4f93b-192">Elimina esempio</span><span class="sxs-lookup"><span data-stu-id="4f93b-192">Delete Example</span></span>

<span data-ttu-id="4f93b-193">Il codice seguente recupera un oggetto Dinner esistente e quindi lo contrassegna per l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="4f93b-194">Quando il metodo "Save()" viene chiamato sul repository, verrà eseguito il commit dell'eliminazione nel database:</span><span class="sxs-lookup"><span data-stu-id="4f93b-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="4f93b-195">Integrazione della convalida e della logica delle regole di business con le classi modelloIntegrating Validation and Business Rule Logic with Model Classes</span><span class="sxs-lookup"><span data-stu-id="4f93b-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="4f93b-196">L'integrazione della convalida e della logica delle regole business è una parte fondamentale di qualsiasi applicazione che funziona con i dati.</span><span class="sxs-lookup"><span data-stu-id="4f93b-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="4f93b-197">Convalida dello schema</span><span class="sxs-lookup"><span data-stu-id="4f93b-197">Schema Validation</span></span>

<span data-ttu-id="4f93b-198">Quando le classi del modello vengono definite tramite la finestra di progettazione LINQ to SQLLINQ to SQL, i tipi di dati delle proprietà nelle classi del modello di dati corrispondono ai tipi di dati della tabella di database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="4f93b-199">Ad esempio: se la colonna "EventDate" nella tabella Dinners è un "datetime", la classe del modello di dati creata da LINQ to SQL sarà di tipo "DateTime" (che è un tipo di dati .NET incorporato).</span><span class="sxs-lookup"><span data-stu-id="4f93b-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="4f93b-200">Ciò significa che si otterranno errori di compilazione se si tenta di assegnare un numero intero o booleano dal codice e verrà generato automaticamente un errore se si tenta di convertire in modo implicito un tipo stringa non valido in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="4f93b-201">LINQ to SQLLINQ to SQL gestiscerà automaticamente l'escaping dei valori SQL per l'utilizzo di stringhe, che consente di proteggere l'utente da attacchi SQL injection quando viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="4f93b-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="4f93b-202">Convalida e logica delle regole di business</span><span class="sxs-lookup"><span data-stu-id="4f93b-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="4f93b-203">La convalida dello schema è utile come primo passaggio, ma raramente è sufficiente.</span><span class="sxs-lookup"><span data-stu-id="4f93b-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="4f93b-204">La maggior parte degli scenari reali richiedono la possibilità di specificare una logica di convalida più completa che può estendersi su più proprietà, eseguire codice e spesso avere consapevolezza dello stato di un modello (ad esempio: viene creato /aggiornato/eliminato o all'interno di uno stato specifico di dominio come "archiviato").</span><span class="sxs-lookup"><span data-stu-id="4f93b-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="4f93b-205">Esistono una varietà di modelli e framework diversi che possono essere utilizzati per definire e applicare le regole di convalida alle classi del modello e ci sono diversi framework basati su .NET là fuori che possono essere utilizzati per aiutare con questo.</span><span class="sxs-lookup"><span data-stu-id="4f93b-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="4f93b-206">È possibile utilizzare praticamente qualsiasi di essi all'interno di ASP.NET applicazioni MVC.</span><span class="sxs-lookup"><span data-stu-id="4f93b-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="4f93b-207">Ai fini della nostra applicazione NerdDinner, useremo un modello relativamente semplice e diretto in cui esponiamo una proprietà IsValid e un metodo GetRuleViolations() sul nostro oggetto modello Dinner.</span><span class="sxs-lookup"><span data-stu-id="4f93b-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="4f93b-208">Il IsValid proprietà restituirà true o false a seconda se le regole di convalida e business sono tutte valide.</span><span class="sxs-lookup"><span data-stu-id="4f93b-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="4f93b-209">Il metodo GetRuleViolations() restituirà un elenco di eventuali errori della regola.</span><span class="sxs-lookup"><span data-stu-id="4f93b-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="4f93b-210">Implementeremo IsValid e GetRuleViolations() per il modello Dinner aggiungendo una "classe parziale" al nostro progetto.</span><span class="sxs-lookup"><span data-stu-id="4f93b-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="4f93b-211">Le classi parziali possono essere utilizzate per aggiungere metodi/proprietà/eventi alle classi gestite da una finestra di progettazione VS (ad esempio la classe Dinner generata dalla finestra di progettazione LINQ to SQLLINQ to SQL) e impedire allo strumento di interferire con il codice.</span><span class="sxs-lookup"><span data-stu-id="4f93b-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="4f93b-212">È possibile aggiungere una nuova classe parziale al progetto facendo clic con il pulsante destro del mouse sulla cartella Modelli e quindi selezionare il comando di menu "Aggiungi nuovo elemento".</span><span class="sxs-lookup"><span data-stu-id="4f93b-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="4f93b-213">Possiamo quindi scegliere il modello "Classe" all'interno della finestra di dialogo "Aggiungi nuovo elemento" e denominarlo Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="4f93b-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="4f93b-214">Facendo clic sul pulsante "Aggiungi" aggiungerà un file di Dinner.cs al progetto e aprirlo all'interno dell'IDE.</span><span class="sxs-lookup"><span data-stu-id="4f93b-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="4f93b-215">È quindi possibile implementare un framework di applicazione delle regole/convalida di base usando il codice seguente:We can then implement a basic rule/validation enforcement framework using the below code:</span><span class="sxs-lookup"><span data-stu-id="4f93b-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="4f93b-216">Alcune note sul codice di cui sopra:</span><span class="sxs-lookup"><span data-stu-id="4f93b-216">A few notes about the above code:</span></span>

- <span data-ttu-id="4f93b-217">La classe Dinner è preceduta da una parola chiave "partial", il che significa che il codice in essa contenuto verrà combinato con la classe generata/gestita dalla finestra di progettazione LINQ to SQLE compilata in un'unica classe.</span><span class="sxs-lookup"><span data-stu-id="4f93b-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="4f93b-218">La classe RuleViolation è una classe helper che aggiungeremo al progetto che consente di fornire ulteriori dettagli su una violazione della regola.</span><span class="sxs-lookup"><span data-stu-id="4f93b-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="4f93b-219">Il metodo Dinner.GetRuleViolations() determina la valutazione delle regole di convalida e di business (le implementeremo a breve).</span><span class="sxs-lookup"><span data-stu-id="4f93b-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="4f93b-220">Restituisce quindi una sequenza di oggetti RuleViolation che forniscono ulteriori dettagli sugli eventuali errori delle regole.</span><span class="sxs-lookup"><span data-stu-id="4f93b-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="4f93b-221">La proprietà Dinner.IsValid fornisce una comoda proprietà helper che indica se l'oggetto Dinner dispone di RuleViolations attivi.</span><span class="sxs-lookup"><span data-stu-id="4f93b-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="4f93b-222">Può essere controllato in modo proattivo da uno sviluppatore utilizzando il Dinner oggetto in qualsiasi momento (e non genera un'eccezione).</span><span class="sxs-lookup"><span data-stu-id="4f93b-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="4f93b-223">Il metodo parziale Dinner.OnValidate() è un hook fornito da LINQ to SQLLINQ to SQL che consente di ricevere una notifica ogni volta che l'oggetto Dinner sta per essere reso persistente all'interno del database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="4f93b-224">L'implementazione OnValidate() precedente garantisce che la Dinner non abbia RuleViolations prima che venga salvata.</span><span class="sxs-lookup"><span data-stu-id="4f93b-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="4f93b-225">Se si trova in uno stato non valido, genera un'eccezione, che causerà LINQ to SQLLINQ to SQL interrompere la transazione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="4f93b-226">Questo approccio fornisce un framework semplice in cui è possibile integrare la convalida e le regole di business.</span><span class="sxs-lookup"><span data-stu-id="4f93b-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="4f93b-227">Per ora aggiungiamo le seguenti regole al nostro metodo GetRuleViolations():</span><span class="sxs-lookup"><span data-stu-id="4f93b-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="4f93b-228">Stiamo usando la funzionalità di "rendimento di rendimento" di C , per restituire una sequenza di tutte le RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="4f93b-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="4f93b-229">I primi sei controlli della regola precedente semplicemente applicare che le proprietà di stringa nel nostro Dinner non può essere null o vuoto.</span><span class="sxs-lookup"><span data-stu-id="4f93b-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="4f93b-230">L'ultima regola è un po' più interessante e chiama un metodo helper PhoneValidator.IsValidNumber() che è possibile aggiungere al progetto per verificare che il formato del numero ContactPhone corrisponda al paese della cena.</span><span class="sxs-lookup"><span data-stu-id="4f93b-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="4f93b-231">Possiamo usare . Supporto delle espressioni regolari di NET per implementare il supporto della convalida del telefono.</span><span class="sxs-lookup"><span data-stu-id="4f93b-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="4f93b-232">Di seguito è riportata una semplice implementazione PhoneValidator che è possibile aggiungere al progetto che consente di aggiungere controlli di modello Regex specifici per paese:Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span><span class="sxs-lookup"><span data-stu-id="4f93b-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="4f93b-233">Gestione della convalida e delle violazioni della logica di businessHandling Validation and Business Logic Violations</span><span class="sxs-lookup"><span data-stu-id="4f93b-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="4f93b-234">Ora che abbiamo aggiunto la convalida sopra e il codice della regola business, ogni volta che tentiamo di creare o aggiornare una cena, le nostre regole della logica di convalida verranno valutate e applicate.</span><span class="sxs-lookup"><span data-stu-id="4f93b-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="4f93b-235">Gli sviluppatori possono scrivere codice come di seguito per determinare in modo proattivo se un Dinner oggetto è valido e recuperare un elenco di tutte le violazioni in esso senza generare eccezioni:Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span><span class="sxs-lookup"><span data-stu-id="4f93b-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="4f93b-236">Se tentiamo di salvare una Dinner in uno stato non valido, verrà generata un'eccezione quando chiamiamo il metodo Save() su DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="4f93b-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="4f93b-237">Ciò si verifica perché LINQ to SQLLINQ to SQL chiama automaticamente il metodo parziale Dinner.OnValidate() prima di salvare le modifiche della Dinner ed è stato aggiunto codice a Dinner.OnValidate() per generare un'eccezione se esistono violazioni delle regole in Dinner.</span><span class="sxs-lookup"><span data-stu-id="4f93b-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="4f93b-238">Possiamo intercettare questa eccezione e recuperare reattivamente un elenco delle violazioni da correggere:</span><span class="sxs-lookup"><span data-stu-id="4f93b-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="4f93b-239">Poiché le nostre regole di convalida e business vengono implementate all'interno del livello del modello e non all'interno del livello dell'interfaccia utente, verranno applicate e utilizzate in tutti gli scenari all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4f93b-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="4f93b-240">In seguito è possibile modificare o aggiungere regole di business e fare in modo che tutto il codice che funziona con gli oggetti Dinner li onoriamo.</span><span class="sxs-lookup"><span data-stu-id="4f93b-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="4f93b-241">Avere la flessibilità di modificare le regole di business in un'unica posizione, senza che queste modifiche si increspano in tutta l'applicazione e la logica dell'interfaccia utente, è un segno di un'applicazione ben scritta e un vantaggio che un framework MVC consente di incoraggiare.</span><span class="sxs-lookup"><span data-stu-id="4f93b-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="4f93b-242">passaggio successivo</span><span class="sxs-lookup"><span data-stu-id="4f93b-242">Next Step</span></span>

<span data-ttu-id="4f93b-243">Ora abbiamo un modello che possiamo usare sia per eseguire query e aggiornare il nostro database.</span><span class="sxs-lookup"><span data-stu-id="4f93b-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="4f93b-244">Aggiungiamo ora alcuni controller e visualizzazioni al progetto che possiamo usare per creare un'esperienza dell'interfaccia utente HTML intorno ad esso.</span><span class="sxs-lookup"><span data-stu-id="4f93b-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4f93b-245">[Successivo](create-a-database.md)
> [precedente](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="4f93b-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
