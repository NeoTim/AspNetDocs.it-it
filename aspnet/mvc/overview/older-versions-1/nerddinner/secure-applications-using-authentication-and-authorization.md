---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Proteggere le applicazioni usando l'autenticazione e autorizzazione | Microsoft Docs
author: microsoft
description: Passaggio 9 viene illustrato come aggiungere l'autenticazione e autorizzazione per proteggere l'applicazione di NerdDinner, in modo che gli utenti devono registrarsi e accedere al sito da creare...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 102e4c2f1fe122669021a159b60f0943fe92fbf2
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/09/2019
ms.locfileid: "59396447"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="4ed0f-103">Proteggere le applicazioni tramite l'autenticazione e l'autorizzazione</span><span class="sxs-lookup"><span data-stu-id="4ed0f-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="4ed0f-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="4ed0f-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4ed0f-105">Scarica il PDF</span><span class="sxs-lookup"><span data-stu-id="4ed0f-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="4ed0f-106">Si tratta di passaggio 9 di una liberazione [esercitazione sull'applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che si interromperanno-dettaglio come compilare una piccola, ma completa, applicazione web con ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="4ed0f-107">Passaggio 9 viene illustrato come aggiungere l'autenticazione e autorizzazione per proteggere l'applicazione di NerdDinner, in modo che gli utenti devono registrarsi e accedere al sito di creare nuovo dinners e solo l'utente che ospita un dinner possibile modificarlo in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="4ed0f-108">Se si usa ASP.NET MVC 3, è consigliabile seguire le [Guida introduttiva con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oppure [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="4ed0f-109">NerdDinner Step 9: Autenticazione e autorizzazione</span><span class="sxs-lookup"><span data-stu-id="4ed0f-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="4ed0f-110">Ora nostro NerdDinner applicazione concede tutti gli utenti visita il sito la possibilità di creare e modificare i dettagli di qualsiasi cena.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="4ed0f-111">Verrà modificato in modo che gli utenti devono registrare ed eseguire l'accesso al sito per creare nuovi dinners e aggiungere una restrizione in modo che solo l'utente che ospita un dinner possibile modificarlo in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="4ed0f-112">A tale scopo si userà l'autenticazione e autorizzazione per proteggere l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="4ed0f-113">Informazioni sull'autenticazione e autorizzazione</span><span class="sxs-lookup"><span data-stu-id="4ed0f-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="4ed0f-114">*Autenticazione* è il processo di identificazione e la convalida dell'identità di un client che accede a un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="4ed0f-115">In parole più semplici, è sull'identificazione "che l'utente finale è che visitano un sito Web".</span><span class="sxs-lookup"><span data-stu-id="4ed0f-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="4ed0f-116">ASP.NET supporta più modalità per autenticare gli utenti del browser.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="4ed0f-117">Per le applicazioni web Internet, l'approccio più comune di autenticazione utilizzato è denominato "Autenticazione basata su form".</span><span class="sxs-lookup"><span data-stu-id="4ed0f-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="4ed0f-118">Autenticazione basata su form consente agli sviluppatori di creare un form di accesso HTML nelle loro applicazioni e quindi convalidare il nome utente/password che un utente finale invia su un database o un altro archivio delle credenziali password.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="4ed0f-119">Se la combinazione di nome utente/password è corretta, lo sviluppatore può chiedere ASP.NET per rilasciare un cookie HTTP crittografato per identificare l'utente in tutte le richieste future.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="4ed0f-120">Ti invieremo un tramite autenticazione basata su form con la nostra applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="4ed0f-121">*Autorizzazione* è il processo volto a determinare se un utente autenticato dispone dell'autorizzazione per accedere a un particolare URL/risorsa o per eseguire un'azione.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="4ed0f-122">Ad esempio, all'interno dell'applicazione di NerdDinner è opportuno autorizzare che possono accedere solo gli utenti che hanno effettuati l'accesso nel *Dinners/crea* URL e creare nuovi Dinners.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="4ed0f-123">È anche opportuno aggiungere la logica di autorizzazione in modo che solo l'utente che ospita un dinner può modificarla, perché e negare l'accesso in modifica a tutti gli altri utenti.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="4ed0f-124">Autenticazione basata su form e il AccountController</span><span class="sxs-lookup"><span data-stu-id="4ed0f-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="4ed0f-125">Il modello di progetto di Visual Studio predefinito per ASP.NET MVC abilita automaticamente l'autenticazione basata su form quando vengono create nuove applicazioni ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="4ed0f-126">Aggiunge automaticamente anche un'implementazione di pagina di accesso di account predefiniti per il progetto, che rende molto semplice integrare la protezione all'interno di un sito.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="4ed0f-127">La pagina master Site. master predefinito viene visualizzato un collegamento "Accedi" in alto a destra del sito quando l'utente accede a tale colonna non è autenticata:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="4ed0f-128">Facendo clic sul collegamento "Accedi" consente a un utente di */Account/LogOn* URL:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="4ed0f-129">Visitatori che non hanno eseguito la registrazione possono farlo facendo clic sul collegamento "Register", che li indirizzerà al */Account/Register* URL e consentire loro di immettere i dettagli dell'account:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="4ed0f-130">Facendo clic sul pulsante "Register" Crea un nuovo utente all'interno del sistema di appartenenze ASP.NET e autenticare l'utente al sito con autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="4ed0f-131">Quando un utente ha eseguito l'accesso, il Site. master cambia alto a destra della pagina per restituire un "benvenuto [username]"</span><span class="sxs-lookup"><span data-stu-id="4ed0f-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="4ed0f-132">messaggio ed esegue il rendering di un "Disconnetti" collegamento anziché un "Accedi" uno.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="4ed0f-133">Facendo clic sul collegamento "Disconnetti" disconnette l'utente:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="4ed0f-134">La funzionalità di accesso, disconnessione e la registrazione precedente viene implementata all'interno della classe AccountController che è stato aggiunto al progetto da Visual Studio durante la creazione del progetto.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="4ed0f-135">L'interfaccia utente per il AccountController viene implementata usando i modelli di visualizzazione all'interno della directory \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="4ed0f-136">La classe AccountController Usa il sistema di autenticazione basata su form ASP.NET per rilasciare i cookie di autenticazione crittografato e l'API di appartenenza ASP.NET per archiviare e convalidare nomi utente e password.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="4ed0f-137">L'API di appartenenza ASP.NET è estendibile e consente a qualsiasi archivio di credenziali di password da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="4ed0f-138">ASP.NET viene fornito con implementazioni del provider di appartenenza incorporata che archiviano nome utente e password all'interno di un database SQL o all'interno di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="4ed0f-139">È possibile configurare il provider di appartenenze utilizzino la nostra applicazione NerdDinner aprendo il file "config" nella radice del progetto e cercando il &lt;appartenenza&gt; sezione all'interno di esso.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="4ed0f-140">Registra il provider di appartenenze SQL aggiunto quando è stato creato il progetto Web. config predefinito e lo configura per usare una stringa di connessione denominata "ApplicationServices" per specificare il percorso del database.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="4ed0f-141">La stringa di connessione predefinita "ApplicationServices" (che viene specificato all'interno di &lt;connectionStrings&gt; sezione del file Web. config) è configurato per usare SQL Express.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="4ed0f-142">Punta a un database di SQL Express denominato "ASPNETDB. File. MDF"sotto l'applicazione" App\_dati "directory.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="4ed0f-143">Se questo database non esiste la prima volta che l'API di appartenenza viene usata all'interno dell'applicazione, ASP.NET verrà automaticamente creato il database e il provisioning dello schema di database di appartenenza appropriata all'interno di esso:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="4ed0f-144">Se invece di usare SQL Express Desideravamo utilizzare un'istanza completa di SQL Server (o connettersi a un database remoto), tutto quello che sarebbe necessario attività da eseguire consiste nell'aggiornare la stringa di connessione "ApplicationServices" all'interno del file Web. config e verificare che lo schema di appartenenza appropriata è stato aggiunto al database di che cui punta.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="4ed0f-145">È possibile eseguire il "aspnet\_regsql.exe" utilità all'interno della directory \Windows\Microsoft.NET\Framework\v2.0.50727\ per aggiungere lo schema appropriato per l'appartenenza e di altri servizi delle applicazioni ASP.NET a un database.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="4ed0f-146">Autorizzazione URL Dinners/Create usando il filtro [Authorize]</span><span class="sxs-lookup"><span data-stu-id="4ed0f-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="4ed0f-147">Non dobbiamo scrivere codice per abilitare un'autenticazione sicura e l'implementazione di gestione di account per l'applicazione di NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="4ed0f-148">Gli utenti possono registrare i nuovi account con l'applicazione e account di accesso/disconnessione del sito.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="4ed0f-149">Ora è possibile aggiungere logica di autorizzazione all'applicazione e usare lo stato di autenticazione e nome utente di visitatori per controllare cosa possono e non è possibile all'interno del sito.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="4ed0f-150">Iniziamo aggiungendo la logica di autorizzazione ai metodi di azione "Crea" della nostra classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="4ed0f-151">In particolare, verrà richiesto che gli utenti che accedono i */Dinners/crea* URL necessario eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="4ed0f-152">Se non si accede si sarà reindirizzarli alla pagina di accesso in modo che essi possono Accedi.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="4ed0f-153">Implementazione di questa logica è piuttosto semplice.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="4ed0f-154">È sufficiente cose da fare è aggiungere un attributo di filtro [Authorize] per i metodi di azione Create in questo modo:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="4ed0f-155">ASP.NET MVC supporta la possibilità di creare "filtri di azione" che possono essere utilizzati per implementare la logica riutilizzabile che può essere applicata in modo dichiarativo ai metodi di azione.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="4ed0f-156">Il filtro [Authorize] è uno dei filtri azione predefiniti forniti da ASP.NET MVC, e consente agli sviluppatori di applicare in modo dichiarativo le regole di autorizzazione per i metodi di azione e le classi controller.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="4ed0f-157">Quando applicato senza parametri (come sopra) consente di applicare il filtro [Authorize] che l'utente che effettua la richiesta del metodo di azione deve essere effettuato l'accesso, e si verrà reindirizzati automaticamente il browser all'URL di accesso se non sono.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="4ed0f-158">Quando si esegue il reindirizzamento URL richiesto originariamente viene passato come argomento di stringa di query (ad esempio: / Account/LogOn? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="4ed0f-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="4ed0f-159">Il AccountController quindi reindirizzerà l'utente all'URL richiesto originariamente dopo l'accesso.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="4ed0f-160">Il filtro [Authorize] supporta facoltativamente la possibilità di specificare una proprietà "Users" o "Roles" che può essere usata per richiedere che l'utente sia nel registro e all'interno di un elenco di utenti consentiti o un membro del ruolo di sicurezza consentiti.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="4ed0f-161">Ad esempio, il codice riportato di seguito consente solo due utenti specifici, "scottgu" e "billg" accedere all'URL Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="4ed0f-162">Nomi utente specifici all'interno del codice di incorporamento tende a essere tuttavia abbastanza non facile da gestire.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="4ed0f-163">Un approccio migliore consiste nel definire "ruoli" di livello superiore che il codice di verifica e quindi eseguire il mapping di utenti al ruolo usando un database o un sistema di active directory (abilitando l'elenco di mapping degli utenti effettivi da archiviare esternamente dal codice).</span><span class="sxs-lookup"><span data-stu-id="4ed0f-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="4ed0f-164">ASP.NET include un'API di gestione di ruolo predefinite, nonché un set predefinito di provider di ruoli (comprese quelle relative a SQL e Active Directory) che consentono di eseguire il mapping di utente o il ruolo.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="4ed0f-165">È quindi possibile aggiornare il codice per consentire agli utenti all'interno di un ruolo specifico "admin" accedere all'URL Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="4ed0f-166">Usando la proprietà User.Identity.Name durante la creazione di Dinners</span><span class="sxs-lookup"><span data-stu-id="4ed0f-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="4ed0f-167">È possibile recuperare il nome utente dell'utente attualmente connesso in una richiesta usando la proprietà User.Identity.Name esposta nella classe base Controller.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="4ed0f-168">Versioni precedenti quando viene implementata la versione HTTP-POST nostro create () del metodo di azione avevamo impostati come hardcoded la proprietà "HostedBy" della cena in una stringa statica.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="4ed0f-169">È possibile ora aggiornare il codice per usare invece la proprietà User.Identity.Name, nonché aggiungere automaticamente una RSVP per l'host crea la cena:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="4ed0f-170">Poiché è stato aggiunto un attributo [Authorize] al metodo Create (), ASP.NET MVC garantisce che il metodo di azione viene eseguita solo se è connesso l'utente potrebbe visitare l'URL Dinners/Create nel sito.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="4ed0f-171">Di conseguenza, il valore della proprietà User.Identity.Name contiene sempre un nome utente valido.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="4ed0f-172">Usando la proprietà User.Identity.Name quando si modificano Dinners</span><span class="sxs-lookup"><span data-stu-id="4ed0f-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="4ed0f-173">Questo punto, aggiungere una logica di autorizzazione che limita gli utenti in modo che possano modificare solo le proprietà di dinners che vengono anch'essi ospitano.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="4ed0f-174">A tale scopo, si aggiungerà innanzitutto un metodo di supporto "IsHostedBy(username)" per l'oggetto Dinner (all'interno della classe parziale di Dinner.cs che abbiamo creato in precedenza).</span><span class="sxs-lookup"><span data-stu-id="4ed0f-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="4ed0f-175">Questo metodo helper restituisce true o false a seconda del fatto che un nome utente fornito corrisponde alla proprietà HostedBy Dinner e incapsula la logica necessaria per eseguire un confronto tra stringhe tra maiuscole e minuscole di essi:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="4ed0f-176">Si aggiungerà quindi un attributo [Authorize] ai metodi di azione Edit () all'interno della classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="4ed0f-177">Ciò garantisce che gli utenti devono essere connesso richiesta un */Dinners/modifica / [id]* URL.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="4ed0f-178">È quindi possibile aggiungere codice per i metodi di modifica che usa il metodo helper Dinner.IsHostedBy(username) per verificare che l'utente connesso corrisponda all'host la cena.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="4ed0f-179">Se l'utente non è l'host, verranno mostrare una visualizzazione "InvalidOwner" e terminare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="4ed0f-180">Il codice per eseguire questa operazione è la seguente:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="4ed0f-181">È quindi possibile fare doppio clic sulla directory \Views\Dinners e scegliere Aggiungi -&gt;consente di visualizzare il comando di menu per creare una nuova visualizzazione "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="4ed0f-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="4ed0f-182">È possibile popolarla con il messaggio di errore seguente:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="4ed0f-183">E ora quando un utente tenta di modificare un dinner che non posseduto, si otterrà un messaggio di errore:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="4ed0f-184">È possibile ripetere gli stessi passaggi per i metodi di azione Delete () all'interno di controller per bloccare l'autorizzazione per eliminare anche Dinners e assicurarsi che il moderatore di un Dinner possibile eliminarlo.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="4ed0f-185">Modifica di mostrare/nascondere e collegamenti di eliminazione</span><span class="sxs-lookup"><span data-stu-id="4ed0f-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="4ed0f-186">Si sta il collegamento per il metodo di azione di modifica e l'eliminazione della nostra classe DinnersController dal nostro URL dettagli:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="4ed0f-187">Attualmente vengono mostrati i collegamenti all'azione modifica ed eliminazione indipendentemente dal fatto il visitatore per l'URL di informazioni sia l'host della cena.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="4ed0f-188">Verrà modificato in modo che i collegamenti vengono visualizzati solo se l'utente visita è il proprietario della cena.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="4ed0f-189">Il metodo di azione Details() nel nostro DinnersController recupera un oggetto Dinner e quindi lo passa come l'oggetto modello per il modello di visualizzazione:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="4ed0f-190">È possibile aggiornare il modello di visualizzazione per in modo condizionale mostrare/nascondere i collegamenti di modifica ed eliminazione usando il Dinner.IsHostedBy() come il metodo helper seguente:</span><span class="sxs-lookup"><span data-stu-id="4ed0f-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="4ed0f-191">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="4ed0f-191">Next Steps</span></span>

<span data-ttu-id="4ed0f-192">Ora esaminiamo come è possibile abilitare gli utenti autenticati per conferma la tua partecipazione dinners tramite AJAX.</span><span class="sxs-lookup"><span data-stu-id="4ed0f-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4ed0f-193">[Precedente](implement-efficient-data-paging.md)
> [Successivo](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="4ed0f-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
