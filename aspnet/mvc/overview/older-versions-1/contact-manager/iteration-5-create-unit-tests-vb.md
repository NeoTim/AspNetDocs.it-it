---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: '#5 iterazione – creare unit test (VB) | Microsoft Docs'
author: microsoft
description: Nella quinta iterazione, l'applicazione viene semplificata per la manutenzione e la modifica mediante l'aggiunta di unit test. Si simulano le classi del modello di dati e si compilano unit test per o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: 4ce1c6224a7e9203ff62f136f4f3a43e4561a904
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78544296"
---
# <a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="694c2-104">#5 iterazione – creare unit test (VB)</span><span class="sxs-lookup"><span data-stu-id="694c2-104">Iteration #5 – Create unit tests (VB)</span></span>

<span data-ttu-id="694c2-105">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="694c2-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="694c2-106">Scarica codice</span><span class="sxs-lookup"><span data-stu-id="694c2-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="694c2-107">Nella quinta iterazione, l'applicazione viene semplificata per la manutenzione e la modifica mediante l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="694c2-108">Si simulano le classi del modello di dati e si compilano unit test per i controller e la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="694c2-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="694c2-109">Compilazione di un'applicazione MVC di gestione dei contatti ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="694c2-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="694c2-110">In questa serie di esercitazioni viene creata un'intera applicazione di gestione dei contatti dall'inizio alla fine.</span><span class="sxs-lookup"><span data-stu-id="694c2-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="694c2-111">L'applicazione Contact Manager consente di archiviare i nomi delle informazioni di contatto, i numeri di telefono e gli indirizzi di posta elettronica per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="694c2-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="694c2-112">L'applicazione viene compilata su più iterazioni.</span><span class="sxs-lookup"><span data-stu-id="694c2-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="694c2-113">Ogni iterazione migliora gradualmente l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="694c2-114">L'obiettivo di questo approccio di iterazione multipla è quello di consentire di comprendere il motivo di ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="694c2-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="694c2-115">#1 iterazione: creare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="694c2-116">Nella prima iterazione, il gestore contatti viene creato nel modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="694c2-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="694c2-117">Viene aggiunto il supporto per le operazioni di base sul database: creazione, lettura, aggiornamento ed eliminazione (CRUD).</span><span class="sxs-lookup"><span data-stu-id="694c2-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="694c2-118">Iterazione #2: rendere l'applicazione un aspetto gradevole.</span><span class="sxs-lookup"><span data-stu-id="694c2-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="694c2-119">In questa iterazione, si migliora l'aspetto dell'applicazione modificando la pagina master e il foglio di stile CSS predefiniti della visualizzazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="694c2-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="694c2-120">#3 iterazione: aggiungere la convalida del modulo.</span><span class="sxs-lookup"><span data-stu-id="694c2-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="694c2-121">Nella terza iterazione viene aggiunta la convalida dei form di base.</span><span class="sxs-lookup"><span data-stu-id="694c2-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="694c2-122">Si impedisce agli utenti di inviare un modulo senza completare i campi dei moduli richiesti.</span><span class="sxs-lookup"><span data-stu-id="694c2-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="694c2-123">Vengono convalidati anche gli indirizzi di posta elettronica e i numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="694c2-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="694c2-124">Iterazione #4: rendere l'applicazione a regime di controllo libero.</span><span class="sxs-lookup"><span data-stu-id="694c2-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="694c2-125">In questa quarta iterazione sono disponibili diversi modelli di progettazione software che semplificano la gestione e la modifica dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="694c2-126">Ad esempio, si effettua il refactoring dell'applicazione per usare il modello di repository e il modello di inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="694c2-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="694c2-127">Iterazione #5-creare unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="694c2-128">Nella quinta iterazione, l'applicazione viene semplificata per la manutenzione e la modifica mediante l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="694c2-129">Si simulano le classi del modello di dati e si compilano unit test per i controller e la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="694c2-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="694c2-130">#6 iterazione: usare lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="694c2-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="694c2-131">In questa sesta iterazione vengono aggiunte nuove funzionalità all'applicazione scrivendo unit test prima e scrivendo il codice in base agli unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="694c2-132">In questa iterazione vengono aggiunti gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="694c2-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="694c2-133">#7 iterazione: aggiungere la funzionalità AJAX.</span><span class="sxs-lookup"><span data-stu-id="694c2-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="694c2-134">Nella settima iterazione, si migliora la velocità di risposta e le prestazioni dell'applicazione mediante l'aggiunta del supporto per AJAX.</span><span class="sxs-lookup"><span data-stu-id="694c2-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="694c2-135">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="694c2-135">This Iteration</span></span>

<span data-ttu-id="694c2-136">Nell'iterazione precedente dell'applicazione Contact Manager è stato eseguito il refactoring dell'applicazione in modo da essere più a regime di controllo libero.</span><span class="sxs-lookup"><span data-stu-id="694c2-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="694c2-137">L'applicazione è stata separata in livelli di controller, servizio e repository distinti.</span><span class="sxs-lookup"><span data-stu-id="694c2-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="694c2-138">Ogni livello interagisce con il livello sottostante attraverso le interfacce.</span><span class="sxs-lookup"><span data-stu-id="694c2-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="694c2-139">L'applicazione è stata sottoposta a refactoring per semplificare la manutenzione e la modifica dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="694c2-140">Se, ad esempio, è necessario usare una nuova tecnologia di accesso ai dati, è possibile modificare semplicemente il livello del repository senza toccare il controller o il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="694c2-141">Rendendo il gestore dei contatti a regime di controllo libero, l'applicazione è più resiliente per la modifica.</span><span class="sxs-lookup"><span data-stu-id="694c2-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="694c2-142">Ma cosa accade quando è necessario aggiungere una nuova funzionalità all'applicazione Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="694c2-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="694c2-143">Oppure, cosa accade quando si corregge un bug?</span><span class="sxs-lookup"><span data-stu-id="694c2-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="694c2-144">Una triste, ma ben collaudata, la verità della scrittura di codice è che ogni volta che si tocca il codice si crea il rischio di introdurre nuovi bug.</span><span class="sxs-lookup"><span data-stu-id="694c2-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="694c2-145">Ad esempio, un giorno fine, il responsabile potrebbe chiedere di aggiungere una nuova funzionalità al gestore contatti.</span><span class="sxs-lookup"><span data-stu-id="694c2-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="694c2-146">Desidera aggiungere il supporto per i gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="694c2-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="694c2-147">Desidera consentire agli utenti di organizzare i contatti in gruppi, ad esempio amici, aziende e così via.</span><span class="sxs-lookup"><span data-stu-id="694c2-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="694c2-148">Per implementare questa nuova funzionalità, è necessario modificare tutti e tre i livelli dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="694c2-149">È necessario aggiungere nuove funzionalità ai controller, al livello di servizio e al repository.</span><span class="sxs-lookup"><span data-stu-id="694c2-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="694c2-150">Non appena si inizia a modificare il codice, si rischia di suddividere le funzionalità che hanno funzionato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="694c2-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="694c2-151">Il refactoring dell'applicazione in livelli distinti, come nell'iterazione precedente, era un aspetto positivo.</span><span class="sxs-lookup"><span data-stu-id="694c2-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="694c2-152">Si tratta di un aspetto positivo perché consente di apportare modifiche a tutti i livelli senza toccare il resto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="694c2-153">Tuttavia, se si desidera rendere il codice all'interno di un livello più semplice da gestire e modificare, è necessario creare unit test per il codice.</span><span class="sxs-lookup"><span data-stu-id="694c2-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="694c2-154">Usare un unit test per testare una singola unità di codice.</span><span class="sxs-lookup"><span data-stu-id="694c2-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="694c2-155">Queste unità di codice sono inferiori a tutti i livelli dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="694c2-156">In genere si usa un unit test per verificare se un particolare metodo nel codice si comporta nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="694c2-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="694c2-157">È ad esempio possibile creare un unit test per il metodo CreateContact () esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="694c2-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="694c2-158">Gli unit test per un'applicazione funzionano esattamente come una rete di protezione.</span><span class="sxs-lookup"><span data-stu-id="694c2-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="694c2-159">Ogni volta che si modifica il codice in un'applicazione, è possibile eseguire un set di unit test per verificare se la modifica interrompe la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="694c2-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="694c2-160">Gli unit test rendono il codice sicuro per la modifica.</span><span class="sxs-lookup"><span data-stu-id="694c2-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="694c2-161">Gli unit test rendono tutto il codice nell'applicazione più resiliente per la modifica.</span><span class="sxs-lookup"><span data-stu-id="694c2-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="694c2-162">In questa iterazione gli unit test vengono aggiunti all'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="694c2-163">In questo modo, nell'iterazione successiva, è possibile aggiungere gruppi di contatti all'applicazione senza doversi preoccupare delle interruzioni della funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="694c2-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="694c2-164">Sono disponibili diversi framework per unit test, tra cui NUnit, xUnit.net e MbUnit.</span><span class="sxs-lookup"><span data-stu-id="694c2-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="694c2-165">In questa esercitazione viene usato il Framework di unit test incluso in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="694c2-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="694c2-166">Tuttavia, è possibile usare uno di questi framework alternativi in modo semplice.</span><span class="sxs-lookup"><span data-stu-id="694c2-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="694c2-167">Cosa viene testato</span><span class="sxs-lookup"><span data-stu-id="694c2-167">What Gets Tested</span></span>

<span data-ttu-id="694c2-168">Nel mondo perfetto tutto il codice verrebbe analizzato dagli unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="694c2-169">Nel mondo perfetto, si otterrebbe la rete di sicurezza perfetta.</span><span class="sxs-lookup"><span data-stu-id="694c2-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="694c2-170">Sarà possibile modificare qualsiasi riga di codice nell'applicazione e sapere immediatamente, eseguendo gli unit test, se la modifica ha interrotto la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="694c2-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="694c2-171">Tuttavia, non viviamo in un mondo perfetto.</span><span class="sxs-lookup"><span data-stu-id="694c2-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="694c2-172">In pratica, quando si scrivono unit test, è possibile concentrarsi sulla scrittura di test per la logica di business (ad esempio, la logica di convalida).</span><span class="sxs-lookup"><span data-stu-id="694c2-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="694c2-173">In particolare, *non* si scrivono unit test per la logica di accesso ai dati o la logica di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="694c2-174">Per essere utile, gli unit test devono essere eseguiti molto rapidamente.</span><span class="sxs-lookup"><span data-stu-id="694c2-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="694c2-175">È possibile accumulare facilmente centinaia o addirittura migliaia di unit test per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="694c2-176">Se l'esecuzione degli unit test richiede molto tempo, si eviterà di eseguirli.</span><span class="sxs-lookup"><span data-stu-id="694c2-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="694c2-177">In altre parole, gli unit test a esecuzione prolungata sono inutili per scopi di codifica giornalieri.</span><span class="sxs-lookup"><span data-stu-id="694c2-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="694c2-178">Per questo motivo, in genere non si scrivono unit test per il codice che interagisce con un database.</span><span class="sxs-lookup"><span data-stu-id="694c2-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="694c2-179">L'esecuzione di centinaia di unit test in un database attivo è troppo lenta.</span><span class="sxs-lookup"><span data-stu-id="694c2-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="694c2-180">Al contrario, si simula il database e si scrive il codice che interagisce con il database fittizio (si tratta di una simulazione di un database riportato di seguito).</span><span class="sxs-lookup"><span data-stu-id="694c2-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="694c2-181">Per un motivo analogo, in genere non si scrivono unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="694c2-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="694c2-182">Per testare una visualizzazione, è necessario creare un server Web.</span><span class="sxs-lookup"><span data-stu-id="694c2-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="694c2-183">Poiché la rotazione di un server Web è un processo relativamente lento, non è consigliabile creare unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="694c2-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="694c2-184">Se la vista contiene una logica complessa, è necessario prendere in considerazione lo stato di trasferimento della logica nei metodi helper.</span><span class="sxs-lookup"><span data-stu-id="694c2-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="694c2-185">È possibile scrivere unit test per metodi helper che vengono eseguiti senza avviare un server Web.</span><span class="sxs-lookup"><span data-stu-id="694c2-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="694c2-186">Sebbene la scrittura di test per la logica di accesso ai dati o la logica di visualizzazione non sia una valida idea quando si scrivono unit test, questi test possono essere molto utili quando si creano test funzionali o di integrazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="694c2-187">ASP.NET MVC è il motore di visualizzazione Web Form.</span><span class="sxs-lookup"><span data-stu-id="694c2-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="694c2-188">Sebbene il motore di visualizzazione Web Form dipenda da un server Web, altri motori di visualizzazione potrebbero non essere.</span><span class="sxs-lookup"><span data-stu-id="694c2-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="694c2-189">Uso di un Framework di oggetti fittizio</span><span class="sxs-lookup"><span data-stu-id="694c2-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="694c2-190">Quando si compilano unit test, è quasi sempre necessario sfruttare un Framework di oggetti fittizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="694c2-191">Un Framework di oggetti fittizio consente di creare simulazioni e stub per le classi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="694c2-192">Ad esempio, è possibile usare un Framework di oggetti fittizio per generare una versione fittizia della classe del repository.</span><span class="sxs-lookup"><span data-stu-id="694c2-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="694c2-193">In questo modo, è possibile usare la classe del repository fittizio invece della classe del repository reale negli unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="694c2-194">L'utilizzo del repository fittizio consente di evitare l'esecuzione di codice del database durante l'esecuzione di un unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="694c2-195">Visual Studio non include un Framework di oggetti fittizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="694c2-196">Per .NET Framework sono tuttavia disponibili diversi framework di oggetti fittizi commerciali e Open Source:</span><span class="sxs-lookup"><span data-stu-id="694c2-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="694c2-197">MOQ: questo Framework è disponibile con la licenza open source BSD.</span><span class="sxs-lookup"><span data-stu-id="694c2-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="694c2-198">È possibile scaricare MOQ da [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="694c2-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="694c2-199">Rhino Mocks: questo Framework è disponibile con la licenza open source BSD.</span><span class="sxs-lookup"><span data-stu-id="694c2-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="694c2-200">È possibile scaricare Rhino Mocks da [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="694c2-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="694c2-201">Isolatore Typemock-si tratta di un Framework commerciale.</span><span class="sxs-lookup"><span data-stu-id="694c2-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="694c2-202">È possibile scaricare una versione di valutazione da [http://www.typemock.com/](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="694c2-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="694c2-203">In questa esercitazione ho deciso di usare MOQ.</span><span class="sxs-lookup"><span data-stu-id="694c2-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="694c2-204">Tuttavia, è possibile usare facilmente Rhino Mocks o Typemock Isolator per creare gli oggetti fittizi per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="694c2-205">Prima di poter usare MOQ, è necessario completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="694c2-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="694c2-206">.</span><span class="sxs-lookup"><span data-stu-id="694c2-206">.</span></span>
2. <span data-ttu-id="694c2-207">Prima di decomprimere il download, assicurarsi di fare clic con il pulsante destro del mouse sul file e fare clic sul pulsante **Sblocca** (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="694c2-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="694c2-208">Decomprimere il download.</span><span class="sxs-lookup"><span data-stu-id="694c2-208">Unzip the download.</span></span>
4. <span data-ttu-id="694c2-209">Aggiungere un riferimento all'assembly MOQ al progetto di test selezionando l'opzione di menu **progetto, Aggiungi riferimento** per aprire la finestra di dialogo **Aggiungi riferimento** .</span><span class="sxs-lookup"><span data-stu-id="694c2-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="694c2-210">Nella scheda Sfoglia passare alla cartella in cui è stato decompresso MOQ e selezionare l'assembly MOQ. dll.</span><span class="sxs-lookup"><span data-stu-id="694c2-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="694c2-211">Fare clic sul pulsante **OK** (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="694c2-211">Click the **OK** button (see Figure 2).</span></span>

<span data-ttu-id="694c2-212">[![di sblocco MOQ](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="694c2-212">[![Unblocking Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span></span>

<span data-ttu-id="694c2-213">**Figura 01**. sblocco di MOQ ([fare clic per visualizzare un'immagine a dimensione intera](iteration-5-create-unit-tests-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="694c2-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>

<span data-ttu-id="694c2-214">[![riferimenti dopo l'aggiunta di MOQ](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="694c2-214">[![References after adding Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span></span>

<span data-ttu-id="694c2-215">**Figura 02**: riferimenti dopo l'aggiunta di MOQ ([fare clic per visualizzare l'immagine con dimensioni complete](iteration-5-create-unit-tests-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="694c2-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="694c2-216">Creazione di unit test per il livello di servizio</span><span class="sxs-lookup"><span data-stu-id="694c2-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="694c2-217">Inizia creando un set di unit test per il livello di servizio dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="694c2-218">Questi test verranno usati per verificare la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="694c2-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="694c2-219">Creare una nuova cartella denominata Models nel progetto ContactManager. tests.</span><span class="sxs-lookup"><span data-stu-id="694c2-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="694c2-220">Fare quindi clic con il pulsante destro del mouse sulla cartella Models e scegliere **Aggiungi, nuovo test**.</span><span class="sxs-lookup"><span data-stu-id="694c2-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="694c2-221">Viene visualizzata la finestra di dialogo **Aggiungi nuovo test** visualizzata nella figura 3.</span><span class="sxs-lookup"><span data-stu-id="694c2-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="694c2-222">Selezionare il modello di **unit test** e denominare il nuovo test ContactManagerServiceTest. vb.</span><span class="sxs-lookup"><span data-stu-id="694c2-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="694c2-223">Fare clic sul pulsante **OK** per aggiungere il nuovo test al progetto di test.</span><span class="sxs-lookup"><span data-stu-id="694c2-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="694c2-224">In generale, si vuole che la struttura di cartelle del progetto di test corrisponda alla struttura di cartelle del progetto MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="694c2-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="694c2-225">Ad esempio, si inseriscono i test del controller in una cartella dei controller, si modellano i test in una cartella Models e così via.</span><span class="sxs-lookup"><span data-stu-id="694c2-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="694c2-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="694c2-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span></span>

<span data-ttu-id="694c2-227">**Figura 03**: Models\ContactManagerServiceTest.cs ([fare clic per visualizzare l'immagine con dimensioni complete](iteration-5-create-unit-tests-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="694c2-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>

<span data-ttu-id="694c2-228">Inizialmente si vuole testare il metodo CreateContact () esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="694c2-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="694c2-229">Verranno creati i cinque test seguenti:</span><span class="sxs-lookup"><span data-stu-id="694c2-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="694c2-230">CreateContact (): verifica che CreateContact () restituisca il valore true quando un contatto valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="694c2-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="694c2-231">CreateContactRequiredFirstName (): verifica che un messaggio di errore venga aggiunto allo stato del modello quando un contatto con un nome mancante viene passato al metodo CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="694c2-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="694c2-232">CreateContactRequiredLastName (): verifica che un messaggio di errore venga aggiunto allo stato del modello quando viene passato un contatto con un cognome mancante al metodo CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="694c2-232">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="694c2-233">CreateContactInvalidPhone (): verifica che un messaggio di errore venga aggiunto allo stato del modello quando un contatto con un numero di telefono non valido viene passato al metodo CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="694c2-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="694c2-234">CreateContactInvalidEmail (): verifica che un messaggio di errore venga aggiunto allo stato del modello quando viene passato un contatto con un indirizzo di posta elettronica non valido al metodo CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="694c2-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="694c2-235">Il primo test verifica che un contatto valido non generi un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="694c2-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="694c2-236">I test rimanenti controllano ogni regola di convalida.</span><span class="sxs-lookup"><span data-stu-id="694c2-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="694c2-237">Il codice per questi test è contenuto nel listato 1.</span><span class="sxs-lookup"><span data-stu-id="694c2-237">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="694c2-238">**Listato 1-Models\ContactManagerServiceTest.vb**</span><span class="sxs-lookup"><span data-stu-id="694c2-238">**Listing 1 - Models\ContactManagerServiceTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]

<span data-ttu-id="694c2-239">Poiché si usa la classe Contact nel listato 1, è necessario aggiungere un riferimento a Microsoft Entity Framework al progetto di test.</span><span class="sxs-lookup"><span data-stu-id="694c2-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="694c2-240">Aggiungere un riferimento all'assembly System. Data. Entity.</span><span class="sxs-lookup"><span data-stu-id="694c2-240">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="694c2-241">Il listato 1 contiene un metodo denominato Initialize () decorato con l'attributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="694c2-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="694c2-242">Questo metodo viene chiamato automaticamente prima dell'esecuzione di ciascuno degli unit test (viene chiamato 5 volte prima di ciascuno degli unit test).</span><span class="sxs-lookup"><span data-stu-id="694c2-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="694c2-243">Il metodo Initialize () crea un repository fittizio con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="694c2-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="694c2-244">Questa riga di codice usa il Framework MOQ per generare un repository fittizio dall'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="694c2-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="694c2-245">Il repository fittizio viene usato al posto del EntityContactManagerRepository effettivo per evitare l'accesso al database quando ogni unit test viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="694c2-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="694c2-246">Il repository fittizio implementa i metodi dell'interfaccia IContactManagerRepository, ma i metodi non eseguono alcuna operazione.</span><span class="sxs-lookup"><span data-stu-id="694c2-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="694c2-247">Quando si usa il Framework MOQ, esiste una distinzione tra \_mockRepository e \_mockRepository. Object.</span><span class="sxs-lookup"><span data-stu-id="694c2-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="694c2-248">Il primo si riferisce alla classe Mock (of IContactManagerRepository) che contiene i metodi per specificare come si comporterà il repository fittizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="694c2-249">Quest'ultimo si riferisce al repository fittizio effettivo che implementa l'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="694c2-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="694c2-250">Il repository fittizio viene usato nel metodo Initialize () quando si crea un'istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="694c2-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="694c2-251">Tutti i singoli unit test utilizzano questa istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="694c2-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="694c2-252">L'elenco 1 contiene cinque metodi che corrispondono a ognuno degli unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="694c2-253">Ognuno di questi metodi è decorato con l'attributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="694c2-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="694c2-254">Quando si eseguono gli unit test, viene chiamato qualsiasi metodo con questo attributo.</span><span class="sxs-lookup"><span data-stu-id="694c2-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="694c2-255">In altre parole, qualsiasi metodo decorato con l'attributo [TestMethod] è un unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="694c2-256">Il primo unit test, denominato CreateContact (), verifica che la chiamata di CreateContact () restituisca il valore true quando un'istanza valida della classe Contact viene passata al metodo.</span><span class="sxs-lookup"><span data-stu-id="694c2-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="694c2-257">Il test crea un'istanza della classe Contact, chiama il metodo CreateContact () e verifica che CreateContact () restituisca il valore true.</span><span class="sxs-lookup"><span data-stu-id="694c2-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="694c2-258">I test rimanenti verificano che quando viene chiamato il metodo CreateContact () con un contatto non valido, il metodo restituisce false e il messaggio di errore di convalida previsto viene aggiunto allo stato del modello.</span><span class="sxs-lookup"><span data-stu-id="694c2-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="694c2-259">Ad esempio, il test CreateContactRequiredFirstName () crea un'istanza della classe Contact con una stringa vuota per la relativa proprietà FirstName.</span><span class="sxs-lookup"><span data-stu-id="694c2-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="694c2-260">Successivamente, il metodo CreateContact () viene chiamato con il contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="694c2-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="694c2-261">Infine, il test verifica che CreateContact () restituisca false e che lo stato del modello contenga il messaggio di errore di convalida previsto "il nome è obbligatorio".</span><span class="sxs-lookup"><span data-stu-id="694c2-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="694c2-262">È possibile eseguire gli unit test nel listato 1 selezionando l'opzione di menu **test, Esegui, tutti i test nella soluzione (CTRL + R, a)** .</span><span class="sxs-lookup"><span data-stu-id="694c2-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="694c2-263">I risultati dei test vengono visualizzati nella finestra di Risultati test (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="694c2-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="694c2-264">[![Risultati test](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="694c2-264">[![Test Results](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span></span>

<span data-ttu-id="694c2-265">**Figura 04**: risultati test ([fare clic per visualizzare l'immagine con dimensioni complete](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="694c2-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="694c2-266">Creazione di unit test per i controller</span><span class="sxs-lookup"><span data-stu-id="694c2-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="694c2-267">L'applicazione MVC ASP.NET controlla il flusso dell'interazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="694c2-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="694c2-268">Quando si esegue il test di un controller, si desidera verificare se il controller restituisce il risultato dell'azione corretta e visualizzare i dati.</span><span class="sxs-lookup"><span data-stu-id="694c2-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="694c2-269">Potrebbe inoltre essere necessario verificare se un controller interagisce con le classi del modello nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="694c2-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="694c2-270">Ad esempio, l'elenco 2 contiene due unit test per il metodo Contact controller Create ().</span><span class="sxs-lookup"><span data-stu-id="694c2-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="694c2-271">Il primo unit test verifica che, quando un contatto valido viene passato al metodo Create (), il metodo Create () reindirizza all'azione index.</span><span class="sxs-lookup"><span data-stu-id="694c2-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="694c2-272">In altre parole, quando viene passato un contatto valido, il metodo Create () deve restituire un RedirectToRouteResult che rappresenta l'azione index.</span><span class="sxs-lookup"><span data-stu-id="694c2-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="694c2-273">Non si vuole testare il livello del servizio ContactManager quando si sta testando il livello del controller.</span><span class="sxs-lookup"><span data-stu-id="694c2-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="694c2-274">Si simula quindi il livello di servizio con il codice seguente nel metodo Initialize:</span><span class="sxs-lookup"><span data-stu-id="694c2-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="694c2-275">In CreateValidContact () unit test si simula il comportamento della chiamata al metodo CreateContact () del livello di servizio con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="694c2-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="694c2-276">Questa riga di codice causa la restituzione del valore true da parte del servizio ContactManager fittizio quando viene chiamato il metodo CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="694c2-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="694c2-277">Simulando il livello di servizio, è possibile testare il comportamento del controller senza dover eseguire codice nel livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="694c2-278">Il secondo unit test verifica che l'azione Create () restituisca la vista create quando al metodo viene passato un contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="694c2-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="694c2-279">Si fa in modo che il metodo CreateContact () del livello di servizio restituisca il valore false con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="694c2-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="694c2-280">Se il metodo Create () si comporta come previsto, deve restituire la vista create quando il livello di servizio restituisce il valore false.</span><span class="sxs-lookup"><span data-stu-id="694c2-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="694c2-281">In questo modo, il controller può visualizzare i messaggi di errore di convalida nella visualizzazione create e l'utente ha la possibilità di correggere le proprietà del contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="694c2-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="694c2-282">Se si prevede di creare unit test per i controller, è necessario restituire nomi di visualizzazione espliciti dalle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="694c2-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="694c2-283">Ad esempio, non restituire una visualizzazione simile alla seguente:</span><span class="sxs-lookup"><span data-stu-id="694c2-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="694c2-284">Visualizzazione restituita ()</span><span class="sxs-lookup"><span data-stu-id="694c2-284">Return View()</span></span>

<span data-ttu-id="694c2-285">Al contrario, restituire la visualizzazione come segue:</span><span class="sxs-lookup"><span data-stu-id="694c2-285">Instead, return the view like this:</span></span>

<span data-ttu-id="694c2-286">Visualizzazione restituita ("Crea")</span><span class="sxs-lookup"><span data-stu-id="694c2-286">Return View("Create")</span></span>

<span data-ttu-id="694c2-287">Se non si è espliciti quando si restituisce una visualizzazione, la proprietà ViewResult. ViewName restituisce una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="694c2-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="694c2-288">**Listato 2-Controllers\ContactControllerTest.vb**</span><span class="sxs-lookup"><span data-stu-id="694c2-288">**Listing 2 - Controllers\ContactControllerTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="694c2-289">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="694c2-289">Summary</span></span>

<span data-ttu-id="694c2-290">In questa iterazione sono stati creati unit test per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="694c2-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="694c2-291">Possiamo eseguire questi unit test in qualsiasi momento per verificare che l'applicazione continui a funzionare nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="694c2-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="694c2-292">Gli unit test fungono da rete di sicurezza per l'applicazione che ci permette di modificare in modo sicuro l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="694c2-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="694c2-293">Sono stati creati due set di unit test.</span><span class="sxs-lookup"><span data-stu-id="694c2-293">We created two sets of unit tests.</span></span> <span data-ttu-id="694c2-294">Per prima cosa, è stata testata la logica di convalida creando unit test per il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="694c2-295">Successivamente, è stata testata la logica di controllo di flusso creando unit test per il livello controller.</span><span class="sxs-lookup"><span data-stu-id="694c2-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="694c2-296">Quando si esegue il test del livello di servizio, i test per il livello di servizio sono stati isolati dal livello di repository, simulando il livello del repository.</span><span class="sxs-lookup"><span data-stu-id="694c2-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="694c2-297">Quando si esegue il test del livello controller, i test per il livello controller sono stati isolati simulando il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="694c2-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="694c2-298">Nell'iterazione successiva verrà modificata l'applicazione Contact Manager in modo che supporti i gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="694c2-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="694c2-299">Questa nuova funzionalità verrà aggiunta all'applicazione tramite un processo di progettazione software denominato sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="694c2-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="694c2-300">[Precedente](iteration-4-make-the-application-loosely-coupled-vb.md)
> [Successivo](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="694c2-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
