---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: 'Iterazione #5-creare gli unit test (VB) | Microsoft Docs'
author: microsoft
description: Nell'iterazione del quinto, si semplifica l'applicazione di manutenzione e la modifica mediante l'aggiunta di unit test. È simulare le classi di modello di dati e generare unit test per o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: 476e5529e4fd53c6166c53766409268939a83c72
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/09/2019
ms.locfileid: "59380665"
---
# <a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="54cee-104">Iterazione #5-creare gli unit test (VB)</span><span class="sxs-lookup"><span data-stu-id="54cee-104">Iteration #5 – Create unit tests (VB)</span></span>

<span data-ttu-id="54cee-105">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="54cee-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="54cee-106">Scaricare il codice</span><span class="sxs-lookup"><span data-stu-id="54cee-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="54cee-107">Nell'iterazione del quinto, si semplifica l'applicazione di manutenzione e la modifica mediante l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="54cee-108">È simulare le classi di modello di dati e generare unit test per i controller e logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="54cee-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="54cee-109">Creazione di un'applicazione di gestione dei contatti ASP.NET MVC (VB)</span><span class="sxs-lookup"><span data-stu-id="54cee-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="54cee-110">In questa serie di esercitazioni, creiamo un'intera applicazione di gestione dei contatti dall'inizio alla fine.</span><span class="sxs-lookup"><span data-stu-id="54cee-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="54cee-111">L'applicazione Contact Manager consente di archiviare le informazioni di contatto - nomi, i numeri di telefono e indirizzi di posta elettronica - per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="54cee-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="54cee-112">Si compilerà l'applicazione a varie iterazioni.</span><span class="sxs-lookup"><span data-stu-id="54cee-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="54cee-113">A ogni iterazione, abbiamo migliorare gradualmente l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="54cee-114">L'obiettivo di questo approccio iterazione più è che consentono di comprendere il motivo per ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="54cee-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="54cee-115">Iterazione #1 - creare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="54cee-116">Nella prima iterazione, verranno create Contact Manager nel modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="54cee-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="54cee-117">Viene aggiunto il supporto per le operazioni di base dei database: Creare, leggere, aggiornare ed eliminare (CRUD).</span><span class="sxs-lookup"><span data-stu-id="54cee-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="54cee-118">Iterazione #2 - migliorare l'applicazione aspetto interessante.</span><span class="sxs-lookup"><span data-stu-id="54cee-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="54cee-119">In questa iterazione è migliorare l'aspetto dell'applicazione modificando il valore predefinito di pagina master visualizzazione MVC ASP.NET e foglio di stile CSS.</span><span class="sxs-lookup"><span data-stu-id="54cee-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="54cee-120">Iterazione #3 - aggiungere la convalida dei form.</span><span class="sxs-lookup"><span data-stu-id="54cee-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="54cee-121">Nella terza iterazione, aggiungiamo la convalida dei form di base.</span><span class="sxs-lookup"><span data-stu-id="54cee-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="54cee-122">Persone è impedire l'invio di un modulo senza completare i campi del modulo richiesto.</span><span class="sxs-lookup"><span data-stu-id="54cee-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="54cee-123">È anche convalidare gli indirizzi di posta elettronica e numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="54cee-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="54cee-124">Iterazione #4 - rendere l'applicazione a regime.</span><span class="sxs-lookup"><span data-stu-id="54cee-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="54cee-125">In questo quarta iterazione, possiamo usufruire dei diversi modelli di progettazione di software per renderne più semplice da gestire e modificare l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="54cee-126">Ad esempio, è eseguire il refactoring l'applicazione per usare il modello di Repository e il modello di inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="54cee-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="54cee-127">Iterazione #5 - creare unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="54cee-128">Nell'iterazione del quinto, si semplifica l'applicazione di manutenzione e la modifica mediante l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="54cee-129">È simulare le classi di modello di dati e generare unit test per i controller e logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="54cee-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="54cee-130">Iterazione #6 - usare lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="54cee-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="54cee-131">In questa iterazione sesta, viene aggiunto nuove funzionalità all'applicazione scrivendo unit test prima e scrivere codice sull'unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="54cee-132">In questa iterazione, viene aggiunto gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="54cee-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="54cee-133">Iterazione #7 - aggiungere funzionalità Ajax.</span><span class="sxs-lookup"><span data-stu-id="54cee-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="54cee-134">Nell'iterazione del settimo, aggiungendo il supporto per Ajax è migliorare la velocità di risposta e le prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="54cee-135">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="54cee-135">This Iteration</span></span>

<span data-ttu-id="54cee-136">Nell'iterazione precedente dell'applicazione Contact Manager, viene effettuato il refactoring all'applicazione di essere più regime di controllo.</span><span class="sxs-lookup"><span data-stu-id="54cee-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="54cee-137">Abbiamo separato l'applicazione in livelli di repository, servizio e controller distinti.</span><span class="sxs-lookup"><span data-stu-id="54cee-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="54cee-138">Ogni livello interagisce con il livello sottostante tramite le interfacce.</span><span class="sxs-lookup"><span data-stu-id="54cee-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="54cee-139">Abbiamo effettuato il refactoring l'applicazione per rendere più semplice da gestire e modificare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="54cee-140">Ad esempio, se è necessario usare una nuova tecnologia di accesso ai dati, è possibile modificare semplicemente il livello di repository senza modificare il controller o il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="54cee-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="54cee-141">Rendendo il Contact Manager regime di controllo è ve reso più resiliente per modificare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="54cee-142">Ma, cosa accade quando è necessario aggiungere una nuova funzionalità per l'applicazione Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="54cee-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="54cee-143">Oppure, cosa accade quando si corregge un bug?</span><span class="sxs-lookup"><span data-stu-id="54cee-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="54cee-144">Una verità triste ma ben collaudato, della scrittura del codice è che ogni volta che si tocca codice si crea il rischio di introdurre nuovi bug.</span><span class="sxs-lookup"><span data-stu-id="54cee-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="54cee-145">Ad esempio, un giorno di fine, i manager potrebbe essere richiesta per aggiungere una nuova funzione a Gestione contatti.</span><span class="sxs-lookup"><span data-stu-id="54cee-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="54cee-146">Anna vuole è possibile aggiungere il supporto per i gruppi di contatto.</span><span class="sxs-lookup"><span data-stu-id="54cee-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="54cee-147">Anna vuole consentire agli utenti di organizzare i propri contatti in gruppi come elementi Friend, Business e così via.</span><span class="sxs-lookup"><span data-stu-id="54cee-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="54cee-148">Per implementare questa nuova funzionalità, è necessario modificare tutti i tre livelli dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="54cee-149">È necessario aggiungere nuove funzionalità per i controller, il livello di servizio e il repository.</span><span class="sxs-lookup"><span data-stu-id="54cee-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="54cee-150">Non appena si avvia la modifica del codice, si rischia di compromettere funzionalità che ha lavorato prima.</span><span class="sxs-lookup"><span data-stu-id="54cee-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="54cee-151">Refactoring l'applicazione in livelli distinti, come è stato fatto nell'iterazione precedente, è stato positivo.</span><span class="sxs-lookup"><span data-stu-id="54cee-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="54cee-152">Era un aspetto positivo perché ci permette di apportare modifiche ai livelli interi senza toccare il resto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="54cee-153">Tuttavia, se si desidera rendere più semplice da gestire e modificare il codice all'interno di un livello, è necessario creare unit test per il codice.</span><span class="sxs-lookup"><span data-stu-id="54cee-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="54cee-154">È usare una unit test per testare una singola unità di codice.</span><span class="sxs-lookup"><span data-stu-id="54cee-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="54cee-155">Queste unità di codice sono inferiori a livelli dell'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="54cee-156">In genere, utilizzare uno unit test per verificare se un particolare metodo nel codice si comporta nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="54cee-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="54cee-157">Ad esempio, si creerà uno unit test per il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="54cee-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="54cee-158">Gli unit test per un solo il lavoro dell'applicazione, ad esempio una rete di protezione.</span><span class="sxs-lookup"><span data-stu-id="54cee-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="54cee-159">Ogni volta che si modifica il codice in un'applicazione, è possibile eseguire un set di unit test per verificare se la modifica interrompe la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="54cee-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="54cee-160">Gli unit test rendono sicuro modificare il codice.</span><span class="sxs-lookup"><span data-stu-id="54cee-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="54cee-161">Gli unit test rendere tutto il codice nell'applicazione più resiliente a cambiare.</span><span class="sxs-lookup"><span data-stu-id="54cee-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="54cee-162">In questa iterazione, unit test viene aggiunto all'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="54cee-163">In questo modo, nell'iterazione successiva, è possibile aggiungere gruppi di contatto per l'applicazione senza preoccuparsi di infrangere le funzionalità esistenti.</span><span class="sxs-lookup"><span data-stu-id="54cee-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="54cee-164">Sono disponibili un'ampia gamma di unit test Framework, tra cui MbUnit NUnit e xUnit.net.</span><span class="sxs-lookup"><span data-stu-id="54cee-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="54cee-165">In questa esercitazione, si usa il framework di unit test inclusi in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="54cee-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="54cee-166">Tuttavia, è possibile semplicemente utilizzare uno di questi Framework alternativi.</span><span class="sxs-lookup"><span data-stu-id="54cee-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="54cee-167">Che cosa verrà sottoposta a test</span><span class="sxs-lookup"><span data-stu-id="54cee-167">What Gets Tested</span></span>

<span data-ttu-id="54cee-168">Nel mondo perfetto, tutto il codice potrebbe essere coperto da unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="54cee-169">In teoria, sarebbe necessario la rete di protezione perfetta.</span><span class="sxs-lookup"><span data-stu-id="54cee-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="54cee-170">È possibile modificare qualsiasi riga di codice nell'applicazione e sapere immediatamente, eseguendo gli unit test, se la modifica si è interrotta funzionalità esistenti.</span><span class="sxs-lookup"><span data-stu-id="54cee-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="54cee-171">Tuttavia, non abbiamo t in tempo reale in un mondo perfetto.</span><span class="sxs-lookup"><span data-stu-id="54cee-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="54cee-172">In pratica, durante la scrittura di unit test, di concentrarsi sulla scrittura di test per la logica di business (ad esempio, la logica di convalida).</span><span class="sxs-lookup"><span data-stu-id="54cee-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="54cee-173">In particolare, si *non li* scrivere unit test per i dati di accesso per la logica o la logica di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="54cee-174">Per essere utile, è necessario eseguire gli unit test molto rapidamente.</span><span class="sxs-lookup"><span data-stu-id="54cee-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="54cee-175">È facilmente possibile accumulare centinaia o anche migliaia di unit test per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="54cee-176">Se gli unit test richiedere molto tempo da eseguire, si eviteranno eseguirli.</span><span class="sxs-lookup"><span data-stu-id="54cee-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="54cee-177">In altre parole, tempo esecuzione di unit test sono inutili per la codifica a scopo di giorno in giorno.</span><span class="sxs-lookup"><span data-stu-id="54cee-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="54cee-178">Per questo motivo, in genere non scrivere unit test per codice che interagisce con un database.</span><span class="sxs-lookup"><span data-stu-id="54cee-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="54cee-179">Esecuzione di centinaia di unit test in un database in tempo reale sarebbe troppo lenta.</span><span class="sxs-lookup"><span data-stu-id="54cee-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="54cee-180">In alternativa, simulare il database e scrivere codice che interagisce con il database fittizio (verrà descritto il comportamento fittizio di un database sottostante).</span><span class="sxs-lookup"><span data-stu-id="54cee-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="54cee-181">Per un motivo simile, in genere non scrivere unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="54cee-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="54cee-182">Per testare una vista, è necessario attivare un server web.</span><span class="sxs-lookup"><span data-stu-id="54cee-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="54cee-183">Poiché la rotazione di un server web è un processo relativamente lento, non è consigliabile creare gli unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="54cee-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="54cee-184">Se la vista contiene logica complessa quindi è consigliabile spostare la logica in metodi di supporto.</span><span class="sxs-lookup"><span data-stu-id="54cee-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="54cee-185">È possibile scrivere unit test per metodi Helper per l'esecuzione senza avviare un server web.</span><span class="sxs-lookup"><span data-stu-id="54cee-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="54cee-186">Durante la scrittura di test per la logica di accesso ai dati o la logica di visualizzazione non è una buona idea durante la scrittura di unit test, questi test possono risultare estremamente utili edificio funzionale o integrazione dei test.</span><span class="sxs-lookup"><span data-stu-id="54cee-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="54cee-187">ASP.NET MVC è il motore di visualizzazione Web Form.</span><span class="sxs-lookup"><span data-stu-id="54cee-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="54cee-188">Mentre il motore di visualizzazione Web Form è dipendente da un server web, potrebbero non essere altri motori di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="54cee-189">Grazie a una struttura oggetto fittizio</span><span class="sxs-lookup"><span data-stu-id="54cee-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="54cee-190">Durante la creazione di unit test, è necessario quasi sempre possibile sfruttare un framework di oggetti fittizi.</span><span class="sxs-lookup"><span data-stu-id="54cee-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="54cee-191">Un framework di oggetti fittizi consente di creare gli oggetti fittizi e stub per le classi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="54cee-192">Ad esempio, è possibile utilizzare un framework di oggetti fittizi per generare una versione fittizia della propria classe di repository.</span><span class="sxs-lookup"><span data-stu-id="54cee-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="54cee-193">In questo modo, è possibile usare la classe di repository fittizio anziché la classe di repository reali negli unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="54cee-194">Usando il repository fittizio consente di evitare l'esecuzione di codice del database durante l'esecuzione di uno unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="54cee-195">Visual Studio non include un framework di oggetti fittizi.</span><span class="sxs-lookup"><span data-stu-id="54cee-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="54cee-196">Tuttavia, sono disponibili diversi framework di oggetti fittizi commerciali e open source per .NET framework:</span><span class="sxs-lookup"><span data-stu-id="54cee-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="54cee-197">Moq - questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="54cee-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="54cee-198">È possibile scaricare da Moq [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="54cee-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="54cee-199">Rhino Mocks, questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="54cee-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="54cee-200">È possibile scaricare Rhino Mocks dal [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="54cee-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="54cee-201">Typemock Isolator - questo è un framework commercio.</span><span class="sxs-lookup"><span data-stu-id="54cee-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="54cee-202">È possibile scaricare una versione di valutazione [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="54cee-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="54cee-203">In questa esercitazione, ho deciso di utilizzare Moq.</span><span class="sxs-lookup"><span data-stu-id="54cee-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="54cee-204">Tuttavia, è possibile utilizzare altrettanto facilmente Rhino Mocks o Typemock Isolator per creare la simulazione degli oggetti per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="54cee-205">Prima di poter usare Moq, è necessario completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="54cee-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="54cee-206">.</span><span class="sxs-lookup"><span data-stu-id="54cee-206">.</span></span>
2. <span data-ttu-id="54cee-207">Prima di aver decompresso il download, assicurarsi di fare doppio clic su file e fare clic sul pulsante con etichetta **Unblock** (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="54cee-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="54cee-208">Decomprimere il download.</span><span class="sxs-lookup"><span data-stu-id="54cee-208">Unzip the download.</span></span>
4. <span data-ttu-id="54cee-209">Aggiungere un riferimento all'assembly Moq al progetto di Test selezionando l'opzione di menu **progetto, Aggiungi riferimento** per aprire il **Aggiungi riferimento** finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="54cee-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="54cee-210">Nella scheda esplorazione, passare alla cartella in cui è stato decompresso Moq e selezionare l'assembly Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="54cee-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="54cee-211">Scegliere il **OK** pulsante (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="54cee-211">Click the **OK** button (see Figure 2).</span></span>


[![U<span data-ttu-id="54cee-212">nblocking Moq]</span><span class="sxs-lookup"><span data-stu-id="54cee-212">nblocking Moq]</span></span>(iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)

<span data-ttu-id="54cee-213">**Figura 01**: Moq sblocco ([fare clic per visualizzare l'immagine con dimensioni normali](iteration-5-create-unit-tests-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="54cee-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>


[![R<span data-ttu-id="54cee-214">riferimenti dopo l'aggiunta di Moq]</span><span class="sxs-lookup"><span data-stu-id="54cee-214">eferences after adding Moq]</span></span>(iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)

<span data-ttu-id="54cee-215">**Figura 02**: Dopo aver aggiunto Moq i riferimenti ([fare clic per visualizzare l'immagine con dimensioni normali](iteration-5-create-unit-tests-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="54cee-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="54cee-216">Creazione di Unit test per il livello di servizio</span><span class="sxs-lookup"><span data-stu-id="54cee-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="54cee-217">Let s iniziare creando un set di unit test per il livello di servizio s applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="54cee-218">Si userà questi test per verificare la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="54cee-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="54cee-219">Creare una nuova cartella denominata Models nel progetto ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="54cee-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="54cee-220">Successivamente, la cartella Models e scegliere **Aggiungi, nuovo Test**.</span><span class="sxs-lookup"><span data-stu-id="54cee-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="54cee-221">Il **Aggiungi nuovo Test** finestra di dialogo illustrata nella figura 3 viene visualizzato.</span><span class="sxs-lookup"><span data-stu-id="54cee-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="54cee-222">Selezionare il **Unit Test** modello e denominare il nuovo test ContactManagerServiceTest.vb.</span><span class="sxs-lookup"><span data-stu-id="54cee-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="54cee-223">Scegliere il **OK** pulsante per aggiungere il nuovo test al progetto di Test.</span><span class="sxs-lookup"><span data-stu-id="54cee-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="54cee-224">In generale, si desidera che la struttura di cartelle del progetto di Test per corrispondere alla struttura di cartelle del progetto ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="54cee-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="54cee-225">Ad esempio, inserire i test controller in una cartella Controllers, i test del modello in una cartella modelli e così via.</span><span class="sxs-lookup"><span data-stu-id="54cee-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


[![M<span data-ttu-id="54cee-226">odels\ContactManagerServiceTest.cs]</span><span class="sxs-lookup"><span data-stu-id="54cee-226">odels\ContactManagerServiceTest.cs]</span></span>(iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)

<span data-ttu-id="54cee-227">**Figura 03**: Models\ContactManagerServiceTest.cs ([fare clic per visualizzare l'immagine con dimensioni normali](iteration-5-create-unit-tests-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="54cee-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>


<span data-ttu-id="54cee-228">Inizialmente, si vuole testare il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="54cee-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="54cee-229">Si creeranno i cinque test seguenti:</span><span class="sxs-lookup"><span data-stu-id="54cee-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="54cee-230">I test che CreateContact() CreateContact() - restituisce il valore true quando un contatto valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="54cee-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="54cee-231">CreateContactRequiredFirstName() - test che un messaggio di errore viene aggiunto a quando un contatto con un nome mancano lo stato del modello viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="54cee-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="54cee-232">CreateContactRequiredLastName() - test che un messaggio di errore viene aggiunto a quando un contatto con un cognome mancano lo stato del modello viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="54cee-232">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="54cee-233">CreateContactInvalidPhone() - test che viene aggiunto un messaggio di errore per lo stato del modello quando un contatto con un numero di telefono non valido viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="54cee-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="54cee-234">CreateContactInvalidEmail() - test che viene aggiunto un messaggio di errore per lo stato del modello quando un contatto con un indirizzo di posta elettronica non valido viene passato al metodo CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="54cee-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="54cee-235">Il primo test verifica che un contatto valido non genera un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="54cee-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="54cee-236">I restanti test verificare ognuna delle regole di convalida.</span><span class="sxs-lookup"><span data-stu-id="54cee-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="54cee-237">Il codice per questi test è contenuto nel listato 1.</span><span class="sxs-lookup"><span data-stu-id="54cee-237">The code for these tests is contained in Listing 1.</span></span>

**<span data-ttu-id="54cee-238">Listing 1 - Models\ContactManagerServiceTest.vb</span><span class="sxs-lookup"><span data-stu-id="54cee-238">Listing 1 - Models\ContactManagerServiceTest.vb</span></span>**

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]


<span data-ttu-id="54cee-239">Poiché si usa la classe di contatto nel listato 1, è necessario aggiungere un riferimento a Microsoft Entity Framework per il progetto di Test.</span><span class="sxs-lookup"><span data-stu-id="54cee-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="54cee-240">Aggiungere un riferimento all'assembly Data. Entity.</span><span class="sxs-lookup"><span data-stu-id="54cee-240">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="54cee-241">L'elenco 1 contiene un metodo denominato Initialize () che è decorata con l'attributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="54cee-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="54cee-242">Questo metodo viene chiamato automaticamente prima esecuzione della ognuno degli unit test (viene chiamato 5 volte subito prima della ognuno degli unit test).</span><span class="sxs-lookup"><span data-stu-id="54cee-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="54cee-243">Il metodo Initialize () consente di creare un repository fittizio con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="54cee-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="54cee-244">Questa riga di codice Usa il framework Moq per generare un repository fittizio dall'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="54cee-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="54cee-245">Il repository fittizio viene utilizzato anziché il EntityContactManagerRepository effettivo per evitare l'accesso al database quando viene eseguito ogni unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="54cee-246">Il repository fittizio implementa i metodi dell'interfaccia IContactManagerRepository, ma in realtà non t don metodi.</span><span class="sxs-lookup"><span data-stu-id="54cee-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="54cee-247">Quando si usa il framework Moq, vi è una differenza tra \_mockRepository e \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="54cee-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="54cee-248">Il primo si riferisce alla classe di simulazione (di IContactManagerRepository) che contiene i metodi che consentono di specificare come si comporterà il repository fittizio.</span><span class="sxs-lookup"><span data-stu-id="54cee-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="54cee-249">Quest'ultimo si riferisce al repository fittizio effettivo che implementa l'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="54cee-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="54cee-250">Il repository fittizio viene usato nel metodo Initialize () quando si crea un'istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="54cee-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="54cee-251">Tutti i singoli unit test utilizzare questa istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="54cee-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="54cee-252">L'elenco 1 contiene cinque metodi che corrispondono a ognuno degli unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="54cee-253">Ognuno di questi metodi è decorata con l'attributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="54cee-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="54cee-254">Quando si eseguono gli unit test, viene chiamato qualsiasi metodo con questo attributo.</span><span class="sxs-lookup"><span data-stu-id="54cee-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="54cee-255">In altre parole, qualsiasi metodo che è decorata con l'attributo [TestMethod] è uno unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="54cee-256">Il primo unit test, denominato CreateContact(), verifica che la chiamata a CreateContact() restituisce il valore true quando un'istanza valida alla classe Contact viene passata al metodo.</span><span class="sxs-lookup"><span data-stu-id="54cee-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="54cee-257">Il test viene creata un'istanza della classe di contatto, chiama il metodo CreateContact() e verifica che CreateContact() restituisce il valore true.</span><span class="sxs-lookup"><span data-stu-id="54cee-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="54cee-258">I restanti test verificare che quando viene chiamato il metodo CreateContact() con un contatto valido quindi il metodo restituisce false e il messaggio di errore di convalida previsto viene aggiunto per lo stato del modello.</span><span class="sxs-lookup"><span data-stu-id="54cee-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="54cee-259">Ad esempio, il test CreateContactRequiredFirstName() crea un'istanza della classe contatto con una stringa vuota per la relativa proprietà FirstName.</span><span class="sxs-lookup"><span data-stu-id="54cee-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="54cee-260">Successivamente, il metodo CreateContact() viene chiamato con il contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="54cee-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="54cee-261">Infine, il test verifica che CreateContact() restituisce false e che lo stato del modello contiene il messaggio di errore di convalida previsto "First name è obbligatoria".</span><span class="sxs-lookup"><span data-stu-id="54cee-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="54cee-262">È possibile eseguire gli unit test nel listato 1, selezionando l'opzione di menu **esecuzione dei Test, tutti i test nella soluzione (CTRL + R, A)**.</span><span class="sxs-lookup"><span data-stu-id="54cee-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="54cee-263">I risultati dei test vengono visualizzati nella finestra Risultati Test (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="54cee-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


[![T<span data-ttu-id="54cee-264">Risultati est]</span><span class="sxs-lookup"><span data-stu-id="54cee-264">est Results]</span></span>(iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)

<span data-ttu-id="54cee-265">**Figura 04**: I risultati dei test ([fare clic per visualizzare l'immagine con dimensioni normali](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="54cee-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="54cee-266">Creazione di Unit test per i controller</span><span class="sxs-lookup"><span data-stu-id="54cee-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="54cee-267">Applicazione ASP.NET MVC controllare il flusso di interazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="54cee-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="54cee-268">Quando un controller di test, si desidera verificare se il controller restituisce i risultato e visualizzare i dati di azione a destra.</span><span class="sxs-lookup"><span data-stu-id="54cee-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="54cee-269">È anche possibile verificare se un controller interagisce con le classi di modello nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="54cee-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="54cee-270">Listato 2, ad esempio, contiene due unit test per il controller di contatto metodo Create ().</span><span class="sxs-lookup"><span data-stu-id="54cee-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="54cee-271">Il primo unit test verifica quindi che un contatto valido viene passato al metodo Create (), quindi il metodo Create () reindirizza l'operazione sull'indice.</span><span class="sxs-lookup"><span data-stu-id="54cee-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="54cee-272">In altre parole, quando viene passato un contatto valido, il metodo Create () deve restituire un RedirectToRouteResult che rappresenta l'operazione sull'indice.</span><span class="sxs-lookup"><span data-stu-id="54cee-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="54cee-273">Temiamo t vuole testare il livello di servizio ContactManager quando sono sottoposti a test il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="54cee-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="54cee-274">Pertanto, è simulare il livello di servizio con il codice seguente nel metodo di inizializzazione:</span><span class="sxs-lookup"><span data-stu-id="54cee-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="54cee-275">Nello unit test, CreateValidContact() è simulare il comportamento della chiamata a livello di servizio CreateContact() metodo con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="54cee-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="54cee-276">Questa riga di codice, il servizio ContactManager fittizio restituire il valore true quando viene chiamato il metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="54cee-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="54cee-277">Per il livello di servizio di simulazione, è possibile testare il comportamento del controller senza la necessità di eseguire il codice nel livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="54cee-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="54cee-278">Il secondo di unit test verifica che l'azione create () restituisce la visualizzazione Create quando un contatto non valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="54cee-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="54cee-279">Abbiamo causano il livello di servizio CreateContact() metodo per restituire il valore false con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="54cee-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="54cee-280">Se il metodo Create () si comporta come prevedevamo quindi deve restituire la visualizzazione Create quando il livello di servizio restituisce il valore false.</span><span class="sxs-lookup"><span data-stu-id="54cee-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="54cee-281">In questo modo, il controller può visualizzare i messaggi di errore di convalida nella visualizzazione di creazione e l'utente ha la possibilità di correggere tale proprietà di contatto non valide.</span><span class="sxs-lookup"><span data-stu-id="54cee-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="54cee-282">Se si prevede di unit test per i controller di compilazione è necessario restituire i nomi di visualizzazione esplicita da azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="54cee-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="54cee-283">Ad esempio, non restituiscono una visualizzazione simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="54cee-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="54cee-284">Restituire View()</span><span class="sxs-lookup"><span data-stu-id="54cee-284">Return View()</span></span>

<span data-ttu-id="54cee-285">Al contrario, restituire la visualizzazione simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="54cee-285">Instead, return the view like this:</span></span>

<span data-ttu-id="54cee-286">Restituire View("Create")</span><span class="sxs-lookup"><span data-stu-id="54cee-286">Return View("Create")</span></span>

<span data-ttu-id="54cee-287">Se non si è esplicita la restituzione di una visualizzazione della proprietà ViewResult.ViewName restituisce una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="54cee-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


**<span data-ttu-id="54cee-288">Listing 2 - Controllers\ContactControllerTest.vb</span><span class="sxs-lookup"><span data-stu-id="54cee-288">Listing 2 - Controllers\ContactControllerTest.vb</span></span>**

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="54cee-289">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="54cee-289">Summary</span></span>

<span data-ttu-id="54cee-290">In questa iterazione, abbiamo creato gli unit test per la nostra applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="54cee-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="54cee-291">È possibile eseguire questi unit test in qualsiasi momento per verificare che l'applicazione continuerà a funzionare nel modo che presumibilmente.</span><span class="sxs-lookup"><span data-stu-id="54cee-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="54cee-292">Gli unit test fungono da una rete di protezione per la nostra applicazione permette di modificare in modo sicuro l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="54cee-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="54cee-293">Abbiamo creato due insiemi di unit test.</span><span class="sxs-lookup"><span data-stu-id="54cee-293">We created two sets of unit tests.</span></span> <span data-ttu-id="54cee-294">In primo luogo, è stato testato la logica di convalida tramite la creazione di unit test per il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="54cee-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="54cee-295">Successivamente, abbiamo testato la logica del flusso di controllo tramite la creazione di unit test per il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="54cee-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="54cee-296">Quando si testa il livello di servizio, è isolato i test per il livello di servizio dal nostro livello di repository per il livello del repository di simulazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="54cee-297">Quando il livello di controller di test, abbiamo isolato i test per il livello di controller in base al livello di servizio di simulazione.</span><span class="sxs-lookup"><span data-stu-id="54cee-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="54cee-298">Nell'iterazione successiva, si modifica l'applicazione Contact Manager, in modo che supporti i gruppi di contatto.</span><span class="sxs-lookup"><span data-stu-id="54cee-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="54cee-299">Si aggiungerà questa nuova funzionalità all'applicazione tramite un processo di progettazione software denominato test-driven development.</span><span class="sxs-lookup"><span data-stu-id="54cee-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="54cee-300">[Precedente](iteration-4-make-the-application-loosely-coupled-vb.md)
> [Successivo](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="54cee-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
