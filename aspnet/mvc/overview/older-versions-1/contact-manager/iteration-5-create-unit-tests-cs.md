---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: '#5 di iterazione : creare unit test (C Documenti Microsoft'
author: rick-anderson
description: Nella quinta iterazione, seminiamo la nostra applicazione più facile da gestire e modificare aggiungendo unit test. Abbiamo preso in giro le nostre classi del modello di dati e compilare unit test per o ...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: c005a8ffc3b09c126d796f2feb74d402cb784aa2
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542352"
---
# <a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="1d6eb-104">Iterazione 5 - Creare gli unit test (C#)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-104">Iteration #5 – Create unit tests (C#)</span></span>

<span data-ttu-id="1d6eb-105">da parte [di Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="1d6eb-106">Scarica il codice</span><span class="sxs-lookup"><span data-stu-id="1d6eb-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="1d6eb-107">Nella quinta iterazione, seminiamo la nostra applicazione più facile da gestire e modificare aggiungendo unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="1d6eb-108">Ci prendiamo gioco delle classi del modello di dati e creiamo unit test per i controller e la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="1d6eb-109">Compilazione di una gestione dei contatti ASP.NET'applicazione MVC (c ')</span><span class="sxs-lookup"><span data-stu-id="1d6eb-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="1d6eb-110">In questa serie di esercitazioni viene compilata un'intera applicazione di gestione dei contatti dall'inizio alla fine.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="1d6eb-111">L'applicazione Contact Manager consente di memorizzare le informazioni di contatto - nomi, numeri di telefono e indirizzi e-mail - per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="1d6eb-112">Costruiamo l'applicazione su più iterazioni.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="1d6eb-113">Ad ogni iterazione, miglioriamo gradualmente l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="1d6eb-114">L'obiettivo di questo approccio a più iterazioni è consentire di comprendere il motivo di ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="1d6eb-115">Iterazione #1- Crea l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="1d6eb-116">Nella prima iterazione, creiamo il Contact Manager nel modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="1d6eb-117">Aggiungiamo il supporto per le operazioni di base del database: crea, leggi, aggiorna ed elimina (CRUD).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="1d6eb-118">Iterazione #2 - Rendere l'applicazione un aspetto gradel.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="1d6eb-119">In questa iterazione viene migliorato l'aspetto dell'applicazione modificando la pagina master della visualizzazione MVC ASP.NET predefinita e il foglio di stile CSS.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="1d6eb-120">#3 iterazione - Aggiungere la convalida del form.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="1d6eb-121">Nella terza iterazione, aggiungiamo la convalida di base del form.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="1d6eb-122">Impediamo alle persone di inviare un modulo senza compilare i campi modulo obbligatori.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="1d6eb-123">Convalidiamo anche gli indirizzi e-mail e i numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="1d6eb-124">Iterazione #4 - Rendere l'applicazione liberamente accoppiato.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="1d6eb-125">In questa quarta iterazione, sfruttiamo diversi modelli di progettazione software per semplificare la manutenzione e la modifica dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="1d6eb-126">Ad esempio, viene eseguito il refactoring dell'applicazione per usare il modello Repository e il modello di inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="1d6eb-127">#5 di iterazione - Creare unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="1d6eb-128">Nella quinta iterazione, seminiamo la nostra applicazione più facile da gestire e modificare aggiungendo unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="1d6eb-129">Ci prendiamo gioco delle classi del modello di dati e creiamo unit test per i controller e la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="1d6eb-130">#6 di iterazione - Utilizzare lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="1d6eb-131">In questa sesta iterazione, aggiungiamo nuove funzionalità all'applicazione scrivendo prima gli unit test e scrivendo il codice sugli unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="1d6eb-132">In questa iterazione vengono aggiunti gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="1d6eb-133">Iterazione #7- Aggiungere funzionalità Ajax.Iteration #7 - Add Ajax functionality.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="1d6eb-134">Nella settima iterazione, miglioriamo la velocità di risposta e le prestazioni dell'applicazione aggiungendo il supporto per Ajax.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="1d6eb-135">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="1d6eb-135">This Iteration</span></span>

<span data-ttu-id="1d6eb-136">Nell'iterazione precedente dell'applicazione Contact Manager, è stato eseguito il refactoring dell'applicazione in modo che sia accoppiata in modo più uniforme.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="1d6eb-137">L'applicazione è stata separata in livelli distinti di controller, servizio e repository.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="1d6eb-138">Ogni livello interagisce con il livello sottostante tramite interfacce.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="1d6eb-139">È stato eseguito il refactoring dell'applicazione per semplificare la gestione e la modifica dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="1d6eb-140">Ad esempio, se è necessario utilizzare una nuova tecnologia di accesso ai dati, è possibile modificare semplicemente il livello del repository senza toccare il controller o il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="1d6eb-141">Rendendo il Contact Manager liberamente accoppiato, abbiamo reso l'applicazione più resiliente al cambiamento.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="1d6eb-142">Ma cosa succede quando è necessario aggiungere una nuova funzionalità all'applicazione Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="1d6eb-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="1d6eb-143">Oppure, cosa succede quando rileviamo un bug?</span><span class="sxs-lookup"><span data-stu-id="1d6eb-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="1d6eb-144">Una triste, ma ben provata, verità di scrittura di codice è che ogni volta che si tocca il codice si crea il rischio di introdurre nuovi bug.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="1d6eb-145">Ad esempio, un bel giorno, il manager potrebbe chiederti di aggiungere una nuova funzionalità a Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="1d6eb-146">Vuole che aggiungi il supporto per i gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="1d6eb-147">Desidera consentire agli utenti di organizzare i contatti in gruppi quali Amici, Aziende e così via.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="1d6eb-148">Per implementare questa nuova funzionalità, è necessario modificare tutti e tre i livelli dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="1d6eb-149">Sarà necessario aggiungere nuove funzionalità ai controller, al livello di servizio e al repository.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="1d6eb-150">Non appena si inizia a modificare il codice, si rischia di interrompere la funzionalità che ha funzionato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="1d6eb-151">Il refactoring dell'applicazione in livelli separati, come abbiamo fatto nell'iterazione precedente, è stata una buona cosa.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="1d6eb-152">E 'stata una buona cosa perché ci permette di apportare modifiche a interi livelli senza toccare il resto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="1d6eb-153">Tuttavia, se si desidera semplificare la gestione e la modifica del codice all'interno di un livello, è necessario creare unit test per il codice.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="1d6eb-154">Utilizzare uno unit test per testare una singola unità di codice.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="1d6eb-155">Queste unità di codice sono più piccole di interi livelli dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="1d6eb-156">In genere, si utilizza uno unit test per verificare se un particolare metodo nel codice si comporta nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="1d6eb-157">Ad esempio, è necessario creare uno unit test per il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="1d6eb-158">Gli unit test per un'applicazione funzionano come una rete di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="1d6eb-159">Ogni volta che si modifica il codice in un'applicazione, è possibile eseguire un set di unit test per verificare se la modifica interrompe la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="1d6eb-160">Gli unit test rendono il codice sicuro da modificare.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="1d6eb-161">Gli unit test rendono tutto il codice nell'applicazione più resiliente alle modifiche.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="1d6eb-162">In questa iterazione vengono aggiunti unit test all'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="1d6eb-163">In questo modo, nell'iterazione successiva, è possibile aggiungere gruppi di contatti all'applicazione senza preoccuparsi di interrompere le funzionalità esistenti.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1d6eb-164">Esistono diversi framework di unit test, tra cui NUnit, xUnit.net e MbUnit.There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="1d6eb-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="1d6eb-166">Tuttavia, si potrebbe altrettanto facilmente utilizzare uno di questi quadri alternativi.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="1d6eb-167">Elementi testati</span><span class="sxs-lookup"><span data-stu-id="1d6eb-167">What Gets Tested</span></span>

<span data-ttu-id="1d6eb-168">Nel mondo perfetto, tutto il codice sarebbe coperto da unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="1d6eb-169">Nel mondo perfetto, si avrebbe la rete di sicurezza perfetta.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="1d6eb-170">Si sarebbe in grado di modificare qualsiasi riga di codice nell'applicazione e sapere immediatamente, eseguendo gli unit test, se la modifica ha interrotto la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="1d6eb-171">Tuttavia, non viviamo in un mondo perfetto.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="1d6eb-172">In pratica, quando si scrivono unit test, ci si concentra sulla scrittura di test per la logica di business (ad esempio, la logica di convalida).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="1d6eb-173">In particolare, *non* si scrivono unit test per la logica di accesso ai dati o la logica di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="1d6eb-174">Per essere utile, gli unit test devono essere eseguiti molto rapidamente.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="1d6eb-175">È possibile accumulare facilmente centinaia (o addirittura migliaia) di unit test per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="1d6eb-176">Se l'esecuzione degli unit test richiede molto tempo, si eviterà di eseguirli.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="1d6eb-177">In altre parole, gli unit test a esecuzione prolungata sono inutili per scopi di codifica giorno per giorno.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="1d6eb-178">Per questo motivo, in genere non si scrivono unit test per il codice che interagisce con un database.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="1d6eb-179">L'esecuzione di centinaia di unit test su un database attivo sarebbe troppo lenta.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="1d6eb-180">Al contrario, si prende in giro il database e scrivere il codice che interagisce con il database fittizio (si discute di simulazione di un database di seguito).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="1d6eb-181">Per un motivo simile, in genere non si scrivono unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="1d6eb-182">Per testare una vista, è necessario creare un server Web.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="1d6eb-183">Poiché la rotazione di un server Web è un processo relativamente lento, la creazione di unit test per le visualizzazioni non è consigliata.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="1d6eb-184">Se la visualizzazione contiene logica complessa, è consigliabile spostare la logica in metodi Helper.If your view contains complicated logic then you should consider moving the logic into Helper methods.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="1d6eb-185">È possibile scrivere unit test per i metodi Helper che vengono eseguiti senza eseguire il ripinning di un server Web.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1d6eb-186">Mentre la scrittura di test per la logica di accesso ai dati o la logica di visualizzazione non è una buona idea quando si scrivono unit test, questi test possono essere molto utili quando si creano test funzionali o di integrazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1d6eb-187">ASP.NET MVC è il motore di visualizzazione Web Form.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="1d6eb-188">Mentre il motore di visualizzazione Web Form dipende da un server Web, altri motori di visualizzazione potrebbero non esserlo.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="1d6eb-189">Utilizzo di un Framework oggetti MockUsing a Mock Object Framework</span><span class="sxs-lookup"><span data-stu-id="1d6eb-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="1d6eb-190">Quando si compilano unit test, è quasi sempre necessario sfruttare un framework di Mock Object.When building unit tests, you almost always need to take advantage of a Mock Object framework.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="1d6eb-191">Un framework di oggetto fittizio consente di creare simulazioni e stub per le classi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="1d6eb-192">Ad esempio, è possibile utilizzare un framework di Mock Object per generare una versione fittizia della classe di repository.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="1d6eb-193">In questo modo, è possibile utilizzare la classe di repository fittizia anziché la classe di repository reale negli unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="1d6eb-194">L'uso del repository fittizio consente di evitare l'esecuzione di codice del database durante l'esecuzione di uno unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="1d6eb-195">Visual Studio non include un framework di oggetto Mock.Visual Studio does not include a Mock Object framework.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="1d6eb-196">Tuttavia, sono disponibili diversi framework di oggetti Mock commerciali e open source per il framework .NET:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="1d6eb-197">Moq - Questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="1d6eb-198">È possibile scaricare [https://code.google.com/p/moq/](https://code.google.com/p/moq/)Moq da .</span><span class="sxs-lookup"><span data-stu-id="1d6eb-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="1d6eb-199">Rhino Mocks - Questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="1d6eb-200">È possibile scaricare Rhino [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)Mocks da .</span><span class="sxs-lookup"><span data-stu-id="1d6eb-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="1d6eb-201">Typemock Isolator - Questo è un quadro commerciale.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="1d6eb-202">È possibile scaricare una [http://www.typemock.com/](http://www.typemock.com/)versione di prova da .</span><span class="sxs-lookup"><span data-stu-id="1d6eb-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="1d6eb-203">In questo tutorial, ho deciso di utilizzare Moq.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="1d6eb-204">Tuttavia, si potrebbe altrettanto facilmente utilizzare Rhino Mocks o Typemock Isolator per creare gli oggetti Mock per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="1d6eb-205">Prima di poter utilizzare Moq, è necessario completare i seguenti passaggi:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="1d6eb-206">.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-206">.</span></span>
2. <span data-ttu-id="1d6eb-207">Prima di decomprimere il download, assicurarsi di fare clic con il pulsante destro del mouse sul file e fare clic sul pulsante con etichetta **Sblocca** (vedere Figura 1).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="1d6eb-208">Decomprimere il download.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-208">Unzip the download.</span></span>
4. <span data-ttu-id="1d6eb-209">Aggiungere un riferimento all'assembly Moq facendo clic con il pulsante destro del mouse sulla cartella Riferimenti nel progetto ContactManager.Tests e scegliendo **Aggiungi riferimento**.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="1d6eb-210">Nella scheda Sfoglia, individuare la cartella in cui è stato decompresso Moq e selezionare l'assembly Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="1d6eb-211">Fare clic sul pulsante **OK**.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="1d6eb-212">Dopo aver completato questi passaggi, la cartella riferimenti dovrebbe essere simile Figura 2.After you complete these steps, your References folder should look like Figure 2.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-212">After you complete these steps, your References folder should look like Figure 2.</span></span>

<span data-ttu-id="1d6eb-213">[![Sblocco Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="1d6eb-214">**Figura 01**: Sblocco Moq(Fare[clic per visualizzare l'immagine a dimensioni intere)](iteration-5-create-unit-tests-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>

<span data-ttu-id="1d6eb-215">[![Riferimenti dopo l'aggiunta di Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="1d6eb-216">**Figura 02**: Riferimenti dopo l'aggiunta di Moq([Fare clic per visualizzare l'immagine a dimensioni intere](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="1d6eb-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="1d6eb-217">Creazione di unit test per il livello di servizioCreating Unit Tests for the Service Layer</span><span class="sxs-lookup"><span data-stu-id="1d6eb-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="1d6eb-218">Iniziamo creando un set di unit test per il livello di servizio dell'applicazione Contact Manager s.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="1d6eb-219">Utilizzeremo questi test per verificare la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="1d6eb-220">Creare una nuova cartella denominata Models nel progetto ContactManager.Tests.Create a new folder named Models in the ContactManager.Tests project.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="1d6eb-221">Successivamente, fare clic con il pulsante destro del mouse sulla cartella Modelli e selezionare **Aggiungi, Nuovo test**.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="1d6eb-222">Viene visualizzata la finestra di dialogo **Aggiungi nuovo test** illustrata nella Figura 3.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="1d6eb-223">Selezionare il modello **Unit Test** e assegnare un nome al nuovo test ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="1d6eb-224">Fare clic sul pulsante **OK** per aggiungere il nuovo test al progetto di test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1d6eb-225">In generale, si desidera che la struttura di cartelle del progetto di test corrisponda alla struttura di cartelle del progetto MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="1d6eb-226">Ad esempio, si inserisceno i test del controller in una cartella Controllers, si modellano i test in una cartella Models e così via.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="1d6eb-227">[![Modelli: ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="1d6eb-228">**Figura 03**: Modelli: ContactManagerServiceTest.cs([Fare clic per visualizzare l'immagine](iteration-5-create-unit-tests-cs/_static/image6.png)a dimensioni intere )</span><span class="sxs-lookup"><span data-stu-id="1d6eb-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>

<span data-ttu-id="1d6eb-229">Inizialmente, si desidera testare il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="1d6eb-230">Verranno creati i cinque test seguenti:We'll create the following five tests:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="1d6eb-231">CreateContact() - Verifica che CreateContact() restituisca il valore true quando un contatto valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="1d6eb-232">CreateContactRequiredFirstName()- Verifica che un messaggio di errore venga aggiunto allo stato del modello quando un contatto con un nome mancante viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1d6eb-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1d6eb-233">CreateContactRequiredLastName() - Verifica che venga aggiunto un messaggio di errore allo stato del modello quando un contatto con un cognome mancante viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1d6eb-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1d6eb-234">CreateContactInvalidPhone() - Verifica che un messaggio di errore venga aggiunto allo stato del modello quando un contatto con un numero di telefono non valido viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1d6eb-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1d6eb-235">CreateContactInvalidEmail() - Verifica che un messaggio di errore venga aggiunto allo stato del modello quando un contatto con un indirizzo e-mail non valido viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1d6eb-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="1d6eb-236">Il primo test verifica che un contatto valido non generi un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="1d6eb-237">I test rimanenti controllano ciascuna delle regole di convalida.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="1d6eb-238">Il codice per questi test è contenuto nel listato 1.The code for these tests is contained in Listing 1.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="1d6eb-239">**Listato 1 - Modelli, ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="1d6eb-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]

<span data-ttu-id="1d6eb-240">Poiché si usa la classe Contact nel listato 1, è necessario aggiungere un riferimento a Microsoft Entity Framework al progetto di test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="1d6eb-241">Aggiungere un riferimento all'assembly System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-241">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="1d6eb-242">Il listato 1 contiene un metodo denominato Initialize() decorato con l'attributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="1d6eb-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="1d6eb-243">Questo metodo viene chiamato automaticamente prima dell'esecuzione di ciascuno degli unit test (viene chiamato 5 volte a destra prima di ciascuno degli unit test).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="1d6eb-244">Il metodo Initialize() crea un repository fittizio con la seguente riga di codice:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="1d6eb-245">Questa riga di codice utilizza il framework Moq per generare un repository fittizio dall'interfaccia IContactManagerRepository.This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="1d6eb-246">Il repository fittizio viene utilizzato al posto dell'effettivo EntityContactManagerRepository per evitare di accedere al database quando viene eseguito ogni unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="1d6eb-247">Il repository fittizio implementa i metodi dell'interfaccia IContactManagerRepository, ma i metodi non eseguono effettivamente alcuna operazione.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1d6eb-248">Quando si usa il framework Moq, esiste una distinzione tra \_mockRepository e \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="1d6eb-249">Il primo fa&lt;riferimento alla&gt; classe Mock IContactManagerRepository che contiene metodi per specificare il modo in cui si comporterà il repository fittizio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="1d6eb-250">Quest'ultimo si riferisce al repository fittizio effettivo che implementa l'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="1d6eb-251">Il repository fittizio viene utilizzato nel metodo Initialize() durante la creazione di un'istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="1d6eb-252">Tutti i singoli unit test utilizzano questa istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="1d6eb-253">Il listato 1 contiene cinque metodi che corrispondono a ciascuno degli unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="1d6eb-254">Ognuno di questi metodi è decorato con l'attributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="1d6eb-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="1d6eb-255">Quando si eseguono gli unit test, viene chiamato qualsiasi metodo con questo attributo.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="1d6eb-256">In altre parole, qualsiasi metodo decorato con l'attributo [TestMethod] è uno unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="1d6eb-257">Il primo unit test, denominato CreateContact(), verifica che la chiamata a CreateContact() restituisca il valore true quando al metodo viene passata un'istanza valida della classe Contact.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="1d6eb-258">Il test crea un'istanza della classe Contact, chiama il metodo CreateContact() e verifica che CreateContact() restituisca il valore true.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="1d6eb-259">I test rimanenti verificano che quando il metodo CreateContact() viene chiamato con un Contact non valido, il metodo restituisce false e il messaggio di errore di convalida previsto viene aggiunto allo stato del modello.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="1d6eb-260">Ad esempio, il test CreateContactRequiredFirstName() crea un'istanza della classe Contact con una stringa vuota per la relativa proprietà FirstName.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="1d6eb-261">Successivamente, il metodo CreateContact() viene chiamato con l'oggetto Contact non valido.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="1d6eb-262">Infine, il test verifica che CreateContact() restituisca false e che lo stato del modello contenga il messaggio di errore di convalida previsto "Nome obbligatorio".</span><span class="sxs-lookup"><span data-stu-id="1d6eb-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="1d6eb-263">È possibile eseguire gli unit test nel listato 1 selezionando l'opzione di menu **Test, Esegui, Tutti i test nella soluzione (CTRL.R, A)**.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="1d6eb-264">I risultati dei test vengono visualizzati nella finestra Risultati test (vedere la Figura 4).</span><span class="sxs-lookup"><span data-stu-id="1d6eb-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="1d6eb-265">[![Risultati del test](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="1d6eb-266">**Figura 04**: Risultati del test ([fare clic per visualizzare l'immagine a dimensioni intere](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="1d6eb-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="1d6eb-267">Creazione di unit test per i controllerCreating Unit Tests for Controllers</span><span class="sxs-lookup"><span data-stu-id="1d6eb-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="1d6eb-268">L'applicazione ASP.NETMVC controlla il flusso dell'interazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="1d6eb-269">Durante il test di un controller, si desidera verificare se il controller restituisce il risultato dell'azione corretta e visualizzare i dati.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="1d6eb-270">È anche possibile verificare se un controller interagisce con le classi del modello nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="1d6eb-271">Ad esempio, il listato 2 contiene due unit test per il metodo Create() del controller di contatto.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="1d6eb-272">Il primo unit test verifica che quando un contatto valido viene passato al metodo Create(), il metodo Create() reindirizza all'azione Indice.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="1d6eb-273">In altre parole, quando viene passato un contatto valido, il metodo Create() deve restituire un valore RedirectToRouteResult che rappresenta l'azione Index.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="1d6eb-274">Non vogliamo testare il livello di servizio ContactManager quando si testa il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="1d6eb-275">Pertanto, il livello di servizio viene simulato con il codice seguente nel metodo Initialize:Therefore, we mock the service layer with the following code in the Initialize method:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="1d6eb-276">Nello unit test CreateValidContact(), viene simulato il comportamento della chiamata al metodo CreateContact() del livello di servizio con la seguente riga di codice:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="1d6eb-277">Questa riga di codice fa in modo che il servizio ContactManager fittizio restituisca il valore true quando viene chiamato il relativo metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1d6eb-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="1d6eb-278">Prendendo in giro il livello di servizio, è possibile testare il comportamento del controller senza dover eseguire codice nel livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="1d6eb-279">Il secondo unit test verifica che l'azione Create() restituisca la visualizzazione Create quando un contatto non valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="1d6eb-280">Facciamo in modo che il metodo CreateContact() del livello di servizio restituisca il valore false con la seguente riga di codice:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="1d6eb-281">Se il metodo Create() si comporta come previsto, deve restituire la vista Create quando il livello di servizio restituisce il valore false.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="1d6eb-282">In questo modo, il controller può visualizzare i messaggi di errore di convalida nella visualizzazione Crea e l'utente ha la possibilità di correggere le proprietà Contact non valide.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="1d6eb-283">Se si prevede di compilare unit test per i controller, è necessario restituire nomi di visualizzazione espliciti dalle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="1d6eb-284">Ad esempio, non restituire una visualizzazione simile alla seguente:For example, do not return a view like this:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="1d6eb-285">riportare View();</span><span class="sxs-lookup"><span data-stu-id="1d6eb-285">return View();</span></span>

<span data-ttu-id="1d6eb-286">Al contrario, restituire la visualizzazione in questo modo:Instead, return the view like this:</span><span class="sxs-lookup"><span data-stu-id="1d6eb-286">Instead, return the view like this:</span></span>

<span data-ttu-id="1d6eb-287">riportare Vista("Crea");</span><span class="sxs-lookup"><span data-stu-id="1d6eb-287">return View("Create");</span></span>

<span data-ttu-id="1d6eb-288">Se non si è espliciti quando si restituisce una visualizzazione, il ViewResult.ViewName proprietà restituisce una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="1d6eb-289">**Listato 2 - Controller-ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="1d6eb-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="1d6eb-290">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="1d6eb-290">Summary</span></span>

<span data-ttu-id="1d6eb-291">In questa iterazione sono stati creati unit test per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="1d6eb-292">È possibile eseguire questi unit test in qualsiasi momento per verificare che l'applicazione si comporti ancora nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="1d6eb-293">Gli unit test fungono da rete di sicurezza per la nostra applicazione che ci consente di modificare in modo sicuro la nostra applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="1d6eb-294">Sono stati creati due set di unit test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-294">We created two sets of unit tests.</span></span> <span data-ttu-id="1d6eb-295">In primo luogo, abbiamo testato la nostra logica di convalida creando unit test per il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="1d6eb-296">Successivamente, abbiamo testato la logica di controllo del flusso creando unit test per il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="1d6eb-297">Durante il test del livello di servizio, abbiamo isolato i test per il livello di servizio dal livello del repository prendendo in giro il livello del repository.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="1d6eb-298">Durante il test del livello di controller, abbiamo isolato i test per il livello di controller simulando il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="1d6eb-299">Nell'iterazione successiva, viene modificato l'applicazione Contact Manager in modo che supporti i gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="1d6eb-300">Aggiungeremo questa nuova funzionalità alla nostra applicazione utilizzando un processo di progettazione software chiamato sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="1d6eb-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1d6eb-301">[Successivo](iteration-4-make-the-application-loosely-coupled-cs.md)
> [precedente](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1d6eb-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
