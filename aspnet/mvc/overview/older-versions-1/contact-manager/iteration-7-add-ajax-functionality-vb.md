---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
title: '#7 di iterazione - Aggiunta di funzionalità Ajax (VB) Documenti Microsoft'
author: rick-anderson
description: Nella settima iterazione, miglioriamo la velocità di risposta e le prestazioni dell'applicazione aggiungendo il supporto per Ajax.
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f640e063-150e-453d-8cfc-7e54a6ce0f1e
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
msc.type: authoredcontent
ms.openlocfilehash: 04eaaa129a56b765c090e64118ed528c65987b50
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542300"
---
# <a name="iteration-7--add-ajax-functionality-vb"></a><span data-ttu-id="e1e3f-103">Iterazione 7 - Aggiungere funzionalità Ajax (VB)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-103">Iteration #7 – Add Ajax functionality (VB)</span></span>

<span data-ttu-id="e1e3f-104">da parte [di Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="e1e3f-105">Scarica il codice</span><span class="sxs-lookup"><span data-stu-id="e1e3f-105">Download Code</span></span>](iteration-7-add-ajax-functionality-vb/_static/contactmanager_7_vb1.zip)

> <span data-ttu-id="e1e3f-106">Nella settima iterazione, miglioriamo la velocità di risposta e le prestazioni dell'applicazione aggiungendo il supporto per Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="e1e3f-107">Creazione di una gestione dei contatti ASP.NET applicazione MVC (VB)Building a Contact Management ASP.NET MVC Application (VB)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-107">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="e1e3f-108">In questa serie di esercitazioni viene compilata un'intera applicazione di gestione dei contatti dall'inizio alla fine.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="e1e3f-109">L'applicazione Contact Manager consente di memorizzare le informazioni di contatto - nomi, numeri di telefono e indirizzi e-mail - per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="e1e3f-110">Costruiamo l'applicazione su più iterazioni.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="e1e3f-111">Ad ogni iterazione, miglioriamo gradualmente l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="e1e3f-112">L'obiettivo di questo approccio a più iterazioni è consentire di comprendere il motivo di ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="e1e3f-113">Iterazione #1- Crea l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="e1e3f-114">Nella prima iterazione, creiamo il Contact Manager nel modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="e1e3f-115">Aggiungiamo il supporto per le operazioni di base del database: crea, leggi, aggiorna ed elimina (CRUD).</span><span class="sxs-lookup"><span data-stu-id="e1e3f-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="e1e3f-116">Iterazione #2 - Rendere l'applicazione un aspetto gradel.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="e1e3f-117">In questa iterazione viene migliorato l'aspetto dell'applicazione modificando la pagina master della visualizzazione MVC ASP.NET predefinita e il foglio di stile CSS.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="e1e3f-118">#3 iterazione - Aggiungere la convalida del form.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="e1e3f-119">Nella terza iterazione, aggiungiamo la convalida di base del form.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="e1e3f-120">Impediamo alle persone di inviare un modulo senza compilare i campi modulo obbligatori.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="e1e3f-121">Convalidiamo anche gli indirizzi e-mail e i numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="e1e3f-122">Iterazione #4 - Rendere l'applicazione liberamente accoppiato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="e1e3f-123">In questa quarta iterazione, sfruttiamo diversi modelli di progettazione software per semplificare la manutenzione e la modifica dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="e1e3f-124">Ad esempio, viene eseguito il refactoring dell'applicazione per usare il modello Repository e il modello di inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="e1e3f-125">#5 di iterazione - Creare unit test.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="e1e3f-126">Nella quinta iterazione, seminiamo la nostra applicazione più facile da gestire e modificare aggiungendo unit test.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="e1e3f-127">Ci prendiamo gioco delle classi del modello di dati e creiamo unit test per i controller e la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="e1e3f-128">#6 di iterazione - Utilizzare lo sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="e1e3f-129">In questa sesta iterazione, aggiungiamo nuove funzionalità all'applicazione scrivendo prima gli unit test e scrivendo il codice sugli unit test.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="e1e3f-130">In questa iterazione vengono aggiunti gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="e1e3f-131">Iterazione #7- Aggiungere funzionalità Ajax.Iteration #7 - Add Ajax functionality.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="e1e3f-132">Nella settima iterazione, miglioriamo la velocità di risposta e le prestazioni dell'applicazione aggiungendo il supporto per Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="e1e3f-133">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="e1e3f-133">This Iteration</span></span>

<span data-ttu-id="e1e3f-134">In questa iterazione dell'applicazione Contact Manager, viene eseguito il refactoring dell'applicazione per utilizzare Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="e1e3f-135">Sfruttando Ajax, rendiamo la nostra applicazione più reattiva.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="e1e3f-136">Possiamo evitare di eseguire il rendering di un'intera pagina quando è necessario aggiornare solo una determinata area in una pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="e1e3f-137">Verrà eseguito il refactoring della visualizzazione Indice in modo che non sia necessario visualizzare nuovamente l'intera pagina ogni volta che un utente seleziona un nuovo gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="e1e3f-138">Invece, quando qualcuno fa clic su un gruppo di contatti, aggiorneremo l'elenco dei contatti e lasceremo il resto della pagina da solo.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="e1e3f-139">Cambieremo anche il modo in cui funziona il nostro link di eliminazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="e1e3f-140">Invece di visualizzare una pagina di conferma separata, verrà visualizzata una finestra di dialogo di conferma JavaScript.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="e1e3f-141">Se si conferma l'eliminazione di un contatto, viene eseguita un'operazione HTTP DELETE sul server per eliminare il record del contatto dal database.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="e1e3f-142">Inoltre, si approfitterà di jQuery per aggiungere effetti di animazione alla nostra vista indice.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="e1e3f-143">Verrà visualizzata un'animazione quando il nuovo elenco di contatti viene recuperato dal server.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="e1e3f-144">Infine, sfruteremo del ASP.NET il supporto del framework AJAX per la gestione della cronologia del browser.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="e1e3f-145">Creeremo punti della cronologia ogni volta che eseguiamo una chiamata Ajax per aggiornare l'elenco dei contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="e1e3f-146">In questo modo, i pulsanti avanti e indietro del browser funzioneranno.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="e1e3f-147">Perché usare Ajax?</span><span class="sxs-lookup"><span data-stu-id="e1e3f-147">Why use Ajax?</span></span>

<span data-ttu-id="e1e3f-148">L'utilizzo di Ajax ha molti vantaggi.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="e1e3f-149">In primo luogo, l'aggiunta di funzionalità Ajax a un'applicazione comporta una migliore esperienza utente.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="e1e3f-150">In una normale applicazione Web, l'intera pagina deve essere inviata al server ogni volta che un utente esegue un'azione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="e1e3f-151">Ogni volta che si esegue un'azione, il browser si blocca e l'utente deve attendere che l'intera pagina venga recuperata e visualizzata nuovamente.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="e1e3f-152">Si tratterebbe di un'esperienza inaccettabile nel caso di un'applicazione desktop.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="e1e3f-153">Ma, tradizionalmente, abbiamo vissuto con questa cattiva esperienza utente nel caso di un'applicazione web perché non sapevamo che avremmo potuto fare di meglio.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="e1e3f-154">Pensavamo fosse una limitazione delle applicazioni web quando, in realtà, era solo una limitazione della nostra immaginazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="e1e3f-155">In un'applicazione Ajax, non è necessario arrestare l'esperienza utente solo per aggiornare una pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="e1e3f-156">È invece possibile eseguire una richiesta asincrona in background per aggiornare la pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="e1e3f-157">L'utente non consente all'utente di attendere durante l'aggiornamento di parte della pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="e1e3f-158">Sfruttando Ajax, è anche possibile migliorare le prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="e1e3f-159">Considerare il funzionamento dell'applicazione Contact Manager in questo momento senza funzionalità Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="e1e3f-160">Quando si fa clic su un gruppo di contatti, è necessario visualizzare nuovamente l'intera visualizzazione Dell'indice.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="e1e3f-161">L'elenco dei contatti e l'elenco dei gruppi di contatti devono essere recuperati dal server di database.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="e1e3f-162">Tutti questi dati devono essere trasmessi attraverso la rete dal server web al browser web.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="e1e3f-163">Dopo aver aggiunto la funzionalità Ajax all'applicazione, tuttavia, è possibile evitare di visualizzare nuovamente l'intera pagina quando un utente fa clic su un gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="e1e3f-164">Non è più necessario acquisire i gruppi di contatti dal database.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="e1e3f-165">Inoltre, non è necessario eseguire il push dell'intera vista Indice attraverso il filo.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="e1e3f-166">Sfruttando Ajax, riduciamo la quantità di lavoro che il nostro server di database deve eseguire e riduciamo la quantità di traffico di rete richiesto dalla nostra applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="e1e3f-167">Non aver paura di Ajax</span><span class="sxs-lookup"><span data-stu-id="e1e3f-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="e1e3f-168">Alcuni sviluppatori evitano di utilizzare Ajax perché si preoccupano dei browser di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="e1e3f-169">Vogliono assicurarsi che le loro applicazioni web continueranno a funzionare quando si accede da un browser che non supporta JavaScript.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="e1e3f-170">Poiché Ajax dipende da JavaScript, alcuni sviluppatori evitano di utilizzare Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="e1e3f-171">Tuttavia, se si è attenti a come si implementa Ajax, è possibile creare applicazioni che funzionano con i browser di livello superiore e di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="e1e3f-172">La nostra applicazione Contact Manager funzionerà con i browser che supportano JavaScript e i browser che non lo supportano.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="e1e3f-173">Se si utilizza l'applicazione Contact Manager con un browser che supporta JavaScript, si avrà una migliore esperienza utente.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="e1e3f-174">Ad esempio, quando si fa clic su un gruppo di contatti, verrà aggiornata solo l'area della pagina che visualizza i contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="e1e3f-175">Se, d'altra parte, si utilizza l'applicazione Contact Manager con un browser che non supporta JavaScript (o che ha JavaScript disabilitato) allora si avrà un'esperienza utente leggermente meno desiderabile.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="e1e3f-176">Ad esempio, quando si fa clic su un gruppo di contatti, l'intera visualizzazione Indice deve essere inviata al browser per visualizzare l'elenco di contatti corrispondente.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="e1e3f-177">Aggiunta dei file JavaScript necessari</span><span class="sxs-lookup"><span data-stu-id="e1e3f-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="e1e3f-178">Dovremo usare tre file JavaScript per aggiungere funzionalità Ajax alla nostra applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="e1e3f-179">Tutti e tre questi file sono inclusi nella cartella Scripts di una nuova applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="e1e3f-180">Se si prevede di utilizzare Ajax in più pagine nell'applicazione, è opportuno includere i file JavaScript necessari nella pagina master di visualizzazione s dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="e1e3f-181">In questo modo, i file JavaScript verranno inclusi automaticamente in tutte le pagine dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="e1e3f-182">Aggiungere il seguente JavaScript &lt;&gt; include all'interno del tag head della pagina master di visualizzazione:</span><span class="sxs-lookup"><span data-stu-id="e1e3f-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-vb/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="e1e3f-183">Refactoring the Index View to use Ajax</span><span class="sxs-lookup"><span data-stu-id="e1e3f-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="e1e3f-184">Iniziamo modificando la nostra vista Indice in modo che facendo clic su un gruppo di contatti aggiorni solo l'area della vista che visualizza i contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="e1e3f-185">La casella rossa in Figura 1 contiene l'area che si desidera aggiornare.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="e1e3f-186">[![Aggiornamento solo dei contatti](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-186">[![Updating only contacts](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span></span>

<span data-ttu-id="e1e3f-187">**Figura 01**: Aggiornamento solo[contatti(Fare clic per visualizzare l'immagine a dimensioni intere)](iteration-7-add-ajax-functionality-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image2.png))</span></span>

<span data-ttu-id="e1e3f-188">Il primo passaggio consiste nel separare la parte della visualizzazione che si desidera aggiornare in modo asincrono in un parziale separato (controllo utente di visualizzazione).</span><span class="sxs-lookup"><span data-stu-id="e1e3f-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="e1e3f-189">La sezione della vista Indice che visualizza la tabella dei contatti è stata spostata nel parziale nel listato 1.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="e1e3f-190">**Listato 1 - Visualizzazioni, contatto, ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample2.aspx)]

<span data-ttu-id="e1e3f-191">Si noti che il partial nel listato 1 ha un modello diverso rispetto alla vista Indice.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="e1e3f-192">L'attributo *Inherits* &lt;nella&gt; direttiva % % della pagina specifica&lt;che&gt; il partial eredita dalla classe ViewUserControl Group.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="e1e3f-193">La vista aggiornata dell'indice è contenuta nel listato 2.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="e1e3f-194">**Listato 2 - Visualizzazioni, Contatto, Indice.aspx**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample3.aspx)]

<span data-ttu-id="e1e3f-195">Ci sono due cose che dovresti notare sulla vista aggiornata nel listato 2.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="e1e3f-196">In primo luogo, si noti che tutto il contenuto spostato nel partial viene sostituito con una chiamata a Html.RenderPartial().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="e1e3f-197">Il metodo Html.RenderPartial() viene chiamato quando la vista Index viene richiesta per la prima volta per visualizzare il set iniziale di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="e1e3f-198">In secondo luogo, si noti che html.ActionLink() utilizzato per visualizzare i gruppi di contatti è stato sostituito con un Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="e1e3f-199">Ajax.ActionLink() viene chiamato con i seguenti parametri:</span><span class="sxs-lookup"><span data-stu-id="e1e3f-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample4.aspx)]

<span data-ttu-id="e1e3f-200">Il primo parametro rappresenta il testo da visualizzare per il collegamento, il secondo parametro rappresenta i valori della route e il terzo parametro rappresenta le opzioni Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="e1e3f-201">In questo caso, utilizziamo l'opzione UpdateTargetId &lt;Ajax&gt; per puntare al tag HTML div che vogliamo aggiornare dopo il completamento della richiesta Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="e1e3f-202">Vogliamo aggiornare &lt;il&gt; tag div con il nuovo elenco di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="e1e3f-203">Il metodo Index() aggiornato del controller di contatto è contenuto nel listato 3.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="e1e3f-204">**Listato 3 - Controllers-ContactController.vb (metodo di indice)**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-204">**Listing 3 - Controllers\ContactController.vb (Index method)**</span></span>

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample5.vb)]

<span data-ttu-id="e1e3f-205">L'azione Index() aggiornata restituisce in modo condizionale una delle due cose.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="e1e3f-206">Se l'azione Index() viene richiamata da una richiesta Ajax, il controller restituisce un partial.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="e1e3f-207">In caso contrario, l'azione Index() restituisce un'intera visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="e1e3f-208">Si noti che l'azione Index() non deve restituire la maggior quantità di dati quando viene richiamata da una richiesta Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="e1e3f-209">Nel contesto di una richiesta normale, l'azione Indice restituisce un elenco di tutti i gruppi di contatti e del gruppo di contatti selezionato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="e1e3f-210">Nel contesto di una richiesta Ajax, l'azione Index() restituisce solo il gruppo selezionato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="e1e3f-211">Ajax significa meno lavoro sul server di database.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="e1e3f-212">La nostra vista Indice modificata funziona sia nel caso di browser di livello superiore che di browser di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="e1e3f-213">Se si fa clic su un gruppo di contatti e il browser supporta JavaScript, viene aggiornata solo l'area della visualizzazione che contiene l'elenco dei contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="e1e3f-214">Se, d'altra parte, il browser non supporta JavaScript, viene aggiornata l'intera visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="e1e3f-215">La visualizzazione aggiornata dell'indice presenta un problema.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="e1e3f-216">Quando si fa clic su un gruppo di contatti, il gruppo selezionato non viene evidenziato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="e1e3f-217">Poiché l'elenco dei gruppi viene visualizzato all'esterno dell'area aggiornata durante una richiesta Ajax, il gruppo corretto non viene evidenziato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="e1e3f-218">Questo problema verrà risolto nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="e1e3f-219">Aggiunta di effetti di animazione jQuery</span><span class="sxs-lookup"><span data-stu-id="e1e3f-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="e1e3f-220">Normalmente, quando si fa clic su un collegamento in una pagina web, è possibile utilizzare la barra di avanzamento del browser per rilevare se il browser sta recuperando attivamente il contenuto aggiornato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="e1e3f-221">Quando si esegue una richiesta Ajax, d'altra parte, la barra di avanzamento del browser non mostra alcun avanzamento.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="e1e3f-222">Questo può rendere gli utenti nervosi.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-222">This can make users nervous.</span></span> <span data-ttu-id="e1e3f-223">Come fai a sapere se il browser si è bloccato?</span><span class="sxs-lookup"><span data-stu-id="e1e3f-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="e1e3f-224">Esistono diversi modi che è possibile indicare a un utente che il lavoro viene eseguito durante l'esecuzione di una richiesta Ajax.There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="e1e3f-225">Un approccio consiste nel visualizzare una semplice animazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="e1e3f-226">Ad esempio, è possibile dissolvenza in uscita di un'area quando una richiesta Ajax inizia e dissolvenza nell'area quando la richiesta viene completata.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="e1e3f-227">Utilizzeremo la libreria jQuery inclusa nel framework Microsoft ASP.NET MVC, per creare gli effetti di animazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="e1e3f-228">La vista aggiornata dell'indice è contenuta nel listato 4.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="e1e3f-229">**Listato 4 - Visualizzazioni, Contatto, Indice.aspx**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample6.aspx)]

<span data-ttu-id="e1e3f-230">Si noti che la vista Indice aggiornata contiene tre nuove funzioni JavaScript.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="e1e3f-231">Le prime due funzioni utilizzano jQuery per dissolvenza in uscita e dissolvenza nell'elenco dei contatti quando si fa clic su un nuovo gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="e1e3f-232">La terza funzione visualizza un messaggio di errore quando una richiesta Ajax genera un errore (ad esempio, timeout di rete).</span><span class="sxs-lookup"><span data-stu-id="e1e3f-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="e1e3f-233">La prima funzione si occupa anche di evidenziare il gruppo selezionato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="e1e3f-234">All'elemento padre (l'elemento LI) dell'elemento su cui è stato fatto clic viene aggiunto un attributo di classe selezionato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="e1e3f-235">Anche in questo caso, jQuery semplifica la selezione dell'elemento corretto e l'aggiunta della classe CSS.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="e1e3f-236">Questi script sono associati ai collegamenti di gruppo con l'aiuto del parametro Ajax.ActionLink() AjaxOptions.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="e1e3f-237">La chiamata al metodo Ajax.ActionLink() aggiornata è simile alla seguente:</span><span class="sxs-lookup"><span data-stu-id="e1e3f-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="e1e3f-238">Aggiunta del supporto della cronologia del browser</span><span class="sxs-lookup"><span data-stu-id="e1e3f-238">Adding Browser History Support</span></span>

<span data-ttu-id="e1e3f-239">Normalmente, quando si fa clic su un collegamento per aggiornare una pagina, la cronologia del browser viene aggiornata.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="e1e3f-240">In questo modo, è possibile fare clic sul pulsante Indietro del browser per tornare indietro nel tempo allo stato precedente della pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="e1e3f-241">Ad esempio, se si fa clic sul gruppo di contatti Amici e quindi sul gruppo di contatti Business, è possibile fare clic sul pulsante Indietro del browser per tornare allo stato della pagina quando è stato selezionato il gruppo di contatti Amici.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="e1e3f-242">Sfortunatamente, l'esecuzione di una richiesta Ajax non aggiorna automaticamente la cronologia del browser.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="e1e3f-243">Se si fa clic su un gruppo di contatti e l'elenco dei contatti corrispondenti viene recuperato con una richiesta Ajax, la cronologia del browser non viene aggiornata.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="e1e3f-244">Non è possibile utilizzare il pulsante Indietro del browser per tornare a un gruppo di contatti dopo aver selezionato un nuovo gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="e1e3f-245">Se si desidera che gli utenti siano in grado di utilizzare il pulsante Indietro del browser dopo aver eseguito le richieste Ajax, è necessario eseguire un po' più di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="e1e3f-246">È necessario sfruttare la funzionalità di gestione della cronologia del browser incorporata nella ASP.NET di AJAX Framework.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="e1e3f-247">ASP.NET cronologia del browser AJAX, è necessario eseguire tre operazioni:a :</span><span class="sxs-lookup"><span data-stu-id="e1e3f-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="e1e3f-248">Abilitare cronologia del browser impostando la proprietà enableBrowserHistory su true.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="e1e3f-249">Salvare i punti della cronologia quando lo stato di una visualizzazione cambia chiamando il metodo addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="e1e3f-250">Ricostruire lo stato della visualizzazione quando viene generato l'evento navigate.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="e1e3f-251">La vista aggiornata dell'indice è contenuta nel listato 5.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="e1e3f-252">**Listato 5 - Visualizzazioni, Contatto, Indice.aspx**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample8.aspx)]

<span data-ttu-id="e1e3f-253">Nel listato 5, Cronologia browser è abilitata nella funzione pageInit().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="e1e3f-254">La funzione pageInit() viene utilizzata anche per impostare il gestore eventi per l'evento navigate.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="e1e3f-255">L'evento navigate viene generato ogni volta che il pulsante Avanti o Indietro del browser determina la modifica dello stato della pagina.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="e1e3f-256">Il metodo beginContactList() viene chiamato quando si fa clic su un gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="e1e3f-257">Questo metodo crea un nuovo punto della cronologia chiamando il metodo addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="e1e3f-258">L'ID del gruppo di contatti selezionato viene aggiunto alla cronologia.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="e1e3f-259">L'ID gruppo viene recuperato da un attributo expando sul collegamento del gruppo di contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="e1e3f-260">Il rendering del collegamento viene eseguito con la chiamata seguente a Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample9.aspx)]

<span data-ttu-id="e1e3f-261">L'ultimo parametro passato a Ajax.ActionLink() aggiunge un attributo expando denominato groupid al collegamento (minuscolo per compatibilità XHTML).</span><span class="sxs-lookup"><span data-stu-id="e1e3f-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="e1e3f-262">Quando un utente preme il pulsante Indietro o Avanti del browser, viene generato l'evento navigate e viene chiamato il metodo navigate().</span><span class="sxs-lookup"><span data-stu-id="e1e3f-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="e1e3f-263">Questo metodo aggiorna i contatti visualizzati nella pagina in modo che corrispondano allo stato della pagina che corrisponde al punto della cronologia del browser passato al metodo navigate.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="e1e3f-264">Esecuzione di eliminazioni AjaxPerforming Ajax Deletes</span><span class="sxs-lookup"><span data-stu-id="e1e3f-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="e1e3f-265">Attualmente, al fine di eliminare un contatto, è necessario fare clic sul collegamento Elimina e quindi fare clic sul pulsante Elimina visualizzato nella pagina di conferma di eliminazione (vedere Figura 2).</span><span class="sxs-lookup"><span data-stu-id="e1e3f-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="e1e3f-266">Questo sembra un sacco di richieste di pagina per fare qualcosa di semplice come l'eliminazione di un record di database.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="e1e3f-267">[![La pagina di conferma dell'eliminazione](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span></span>

<span data-ttu-id="e1e3f-268">**Figura 02**: La pagina di conferma dell'eliminazione[(Fare clic per visualizzare l'immagine a dimensioni intere)](iteration-7-add-ajax-functionality-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e1e3f-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image4.png))</span></span>

<span data-ttu-id="e1e3f-269">Si è tentati di ignorare la pagina di conferma dell'eliminazione ed eliminare un contatto direttamente dalla visualizzazione Indice.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="e1e3f-270">Si dovrebbe evitare questa tentazione perché prendendo questo approccio apre l'applicazione a falle di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="e1e3f-271">In generale, non si desidera eseguire un'operazione HTTP GET quando si richiama un'azione che modifica lo stato dell'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="e1e3f-272">Quando si esegue un'eliminazione, si desidera eseguire un HTTP POST, o meglio ancora, un'operazione HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="e1e3f-273">Il collegamento Elimina è contenuto nel ContactList parziale.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="e1e3f-274">Una versione aggiornata del ContactList parziale è contenuta nel listato 6.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="e1e3f-275">**Listato 6 - Visualizzazioni, contatti, ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample10.aspx)]

<span data-ttu-id="e1e3f-276">Viene eseguito il rendering del collegamento Delete con la seguente chiamata al metodo Ajax.ImageActionLink():</span><span class="sxs-lookup"><span data-stu-id="e1e3f-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="e1e3f-277">Ajax.ImageActionLink() non è una parte standard del framework MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="e1e3f-278">Ajax.ImageActionLink() è un metodo helper personalizzato incluso nel progetto Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="e1e3f-279">Il parametro AjaxOptions ha due proprietà.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="e1e3f-280">In primo luogo, il Confirm proprietà viene utilizzata per visualizzare una finestra di dialogo di conferma JavaScript popup.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="e1e3f-281">In secondo luogo, il HttpMethod proprietà viene utilizzata per eseguire un'operazione HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="e1e3f-282">Il listato 7 contiene una nuova azione AjaxDelete() che è stata aggiunta al controller di contatto.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="e1e3f-283">**Listato 7 - Controllers-ContactController.vb (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="e1e3f-283">**Listing 7 - Controllers\ContactController.vb (AjaxDelete)**</span></span>   

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample12.vb)]

<span data-ttu-id="e1e3f-284">L'azione AjaxDelete() è decorata con un attributo AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="e1e3f-285">Questo attributo impedisce che l'azione venga richiamata tranne che da qualsiasi operazione HTTP diversa da un'operazione HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="e1e3f-286">In particolare, non è possibile richiamare questa azione con un HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="e1e3f-287">Dopo aver eliminato il record di database, è necessario visualizzare l'elenco aggiornato dei contatti che non contiene il record eliminato.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="e1e3f-288">Il metodo AjaxDelete() restituisce il ContactList parziale e l'elenco aggiornato dei contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="e1e3f-289">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="e1e3f-289">Summary</span></span>

<span data-ttu-id="e1e3f-290">In questa iterazione è stata aggiunta la funzionalità Ajax all'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="e1e3f-291">Abbiamo usato Ajax per migliorare la reattività e le prestazioni della nostra applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="e1e3f-292">In primo luogo, è stato eseguito il refactoring della visualizzazione indice in modo che facendo clic su un gruppo di contatti non aggiornare l'intera visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="e1e3f-293">Al contrario, facendo clic su un gruppo di contatti viene aggiornato solo l'elenco dei contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="e1e3f-294">Successivamente, abbiamo usato gli effetti di animazione jQuery per dissolvenza in uscita e dissolvenza nell'elenco dei contatti.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="e1e3f-295">L'aggiunta di animazione a un'applicazione Ajax può essere utilizzata per fornire agli utenti dell'applicazione l'equivalente di un indicatore di stato del browser.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="e1e3f-296">Abbiamo anche aggiunto il supporto della cronologia del browser alla nostra applicazione Ajax.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="e1e3f-297">Abbiamo abilitato gli utenti a fare clic sui pulsanti Indietro e Avanti del browser per modificare lo stato della vista Indice.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="e1e3f-298">Infine, è stato creato un collegamento di eliminazione che supporta le operazioni HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="e1e3f-299">Eseguendo le eliminazioni Ajax, si consente agli utenti di eliminare i record del database senza richiedere all'utente di richiedere una pagina di conferma dell'eliminazione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="e1e3f-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e1e3f-300">Indietro</span><span class="sxs-lookup"><span data-stu-id="e1e3f-300">Previous</span></span>](iteration-6-use-test-driven-development-vb.md)
