---
uid: mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
title: Creare un'app Web ASP.NET MVC 5 sicura con accesso, conferma tramite posta elettronica e reimpostazioneC#della password () | Microsoft Docs
author: Rick-Anderson
description: Questa esercitazione illustra come creare un'app Web ASP.NET MVC 5 con la conferma della posta elettronica e la reimpostazione della password usando il sistema di appartenenze ASP.NET Identity. CA...
ms.author: riande
ms.date: 03/26/2015
ms.assetid: d4911cb3-1afb-4805-b860-10818c4b1280
msc.legacyurl: /mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 07f5b290b73f75000e6f29fe09e4dc25e144452f
ms.sourcegitcommit: 969e7db924ebad3cc0f0cb0d65d148e8b9221b9a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/06/2019
ms.locfileid: "74899702"
---
# <a name="create-a-secure-aspnet-mvc-5-web-app-with-log-in-email-confirmation-and-password-reset-c"></a><span data-ttu-id="b1597-104">Creare un'app Web ASP.NET MVC 5 sicura con accesso, messaggi di posta elettronica di conferma e reimpostazione della password (C#)</span><span class="sxs-lookup"><span data-stu-id="b1597-104">Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="b1597-105">di [Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="b1597-105">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

<span data-ttu-id="b1597-106">Questa esercitazione illustra come creare un'app Web ASP.NET MVC 5 con la conferma della posta elettronica e la reimpostazione della password usando il sistema di appartenenze ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="b1597-106">This tutorial shows you how to build an ASP.NET MVC 5 web app with email confirmation and password reset using the ASP.NET Identity membership system.</span></span>

<span data-ttu-id="b1597-107">Per una versione aggiornata di questa esercitazione che usa .NET Core, vedere la pagina relativa alla conferma dell'account e al ripristino della password in ASP.NET Core [/ASPNET/Core/Security/Authentication/accconfirm).</span><span class="sxs-lookup"><span data-stu-id="b1597-107">For an updated version of this tutorial that uses .NET Core, see [Account confirmation and password recovery in ASP.NET Core[/aspnet/core/security/authentication/accconfirm).</span></span>

<a id="createMvc"></a>
## <a name="create-an-aspnet-mvc-app"></a><span data-ttu-id="b1597-108">Creare un'app MVC ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b1597-108">Create an ASP.NET MVC app</span></span>

<span data-ttu-id="b1597-109">Per iniziare, installare ed eseguire [Visual Studio Express 2013 per il Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="b1597-109">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="b1597-110">Installare [Visual Studio 2013 aggiornamento 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="b1597-110">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="b1597-111">Avviso: per completare questa esercitazione, è necessario installare [Visual Studio 2013 aggiornamento 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="b1597-111">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="b1597-112">Creare un nuovo progetto Web ASP.NET e selezionare il modello MVC.</span><span class="sxs-lookup"><span data-stu-id="b1597-112">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="b1597-113">Web Forms supporta anche ASP.NET Identity, quindi è possibile seguire una procedura simile in un'app Web Form.</span><span class="sxs-lookup"><span data-stu-id="b1597-113">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image1.png)
2. <span data-ttu-id="b1597-114">Lasciare l'autenticazione predefinita come **account utente singoli**.</span><span class="sxs-lookup"><span data-stu-id="b1597-114">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="b1597-115">Se si vuole ospitare l'app in Azure, lasciare selezionata la casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="b1597-115">If you'd like to host the app in Azure, leave the check box checked.</span></span> <span data-ttu-id="b1597-116">Più avanti nell'esercitazione si distribuirà in Azure.</span><span class="sxs-lookup"><span data-stu-id="b1597-116">Later in the tutorial we will deploy to Azure.</span></span> <span data-ttu-id="b1597-117">È possibile [aprire un account Azure](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F)gratuitamente.</span><span class="sxs-lookup"><span data-stu-id="b1597-117">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).</span></span>
3. <span data-ttu-id="b1597-118">Impostare il [progetto per l'utilizzo di SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="b1597-118">Set the [project to use SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="b1597-119">Eseguire l'app, fare clic sul collegamento **Register** e registrare un utente.</span><span class="sxs-lookup"><span data-stu-id="b1597-119">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="b1597-120">A questo punto, l'unica convalida sul messaggio di posta elettronica è l'attributo [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="b1597-120">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
5. <span data-ttu-id="b1597-121">In Esplora server passare a **Data Connections\DefaultConnection\Tables\AspNetUsers**, fare clic con il pulsante destro del mouse e selezionare **Apri definizione tabella**.</span><span class="sxs-lookup"><span data-stu-id="b1597-121">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="b1597-122">Nella figura seguente viene illustrato lo schema `AspNetUsers`:</span><span class="sxs-lookup"><span data-stu-id="b1597-122">The following image shows the `AspNetUsers` schema:</span></span>

    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="b1597-123">Fare clic con il pulsante destro del mouse sulla tabella **AspNetUsers** e scegliere **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="b1597-123">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="b1597-124">A questo punto, il messaggio di posta elettronica non è stato confermato.</span><span class="sxs-lookup"><span data-stu-id="b1597-124">At this point the email has not been confirmed.</span></span>
7. <span data-ttu-id="b1597-125">Fare clic sulla riga e selezionare Elimina.</span><span class="sxs-lookup"><span data-stu-id="b1597-125">Click on the row and select delete.</span></span> <span data-ttu-id="b1597-126">Questo messaggio di posta elettronica verrà aggiunto di nuovo nel passaggio successivo e verrà inviato un messaggio di posta elettronica di conferma.</span><span class="sxs-lookup"><span data-stu-id="b1597-126">You'll add this email again in the next step, and send a confirmation email.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="b1597-127">Conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="b1597-127">Email confirmation</span></span>

<span data-ttu-id="b1597-128">Una procedura consigliata consiste nel confermare l'indirizzo di posta elettronica di una nuova registrazione utente per verificare che non stiano rappresentando un altro utente, ovvero che non sono stati registrati con la posta elettronica di un altro utente.</span><span class="sxs-lookup"><span data-stu-id="b1597-128">It's a best practice to confirm the email of a new user registration to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="b1597-129">Si supponga di avere un forum di discussione che si vuole impedire che `"bob@example.com"` venga registrato come `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="b1597-129">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="b1597-130">Senza la conferma della posta elettronica, `"joe@contoso.com"` possibile ricevere messaggi di posta elettronica indesiderati dall'app.</span><span class="sxs-lookup"><span data-stu-id="b1597-130">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="b1597-131">Supponiamo che Bob sia stato accidentalmente registrato come `"bib@example.com"` e non sia stato notato, non sarebbe in grado di usare il ripristino della password perché l'app non ha la posta elettronica corretta.</span><span class="sxs-lookup"><span data-stu-id="b1597-131">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="b1597-132">La conferma tramite posta elettronica offre solo una protezione limitata dai bot e non fornisce protezione da spammer determinati, ma ha molti alias di posta elettronica di lavoro che possono usare per la registrazione.</span><span class="sxs-lookup"><span data-stu-id="b1597-132">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.</span></span>

<span data-ttu-id="b1597-133">In genere si desidera impedire ai nuovi utenti di inviare dati al sito Web prima che siano stati confermati tramite posta elettronica, un SMS o un altro meccanismo.</span><span class="sxs-lookup"><span data-stu-id="b1597-133">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a><span data-ttu-id="b1597-134">Nelle sezioni riportate di seguito verrà abilitata la conferma tramite posta elettronica e verrà modificato il codice per impedire l'accesso degli utenti appena registrati fino alla conferma della posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="b1597-134">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="b1597-135">Associare SendGrid</span><span class="sxs-lookup"><span data-stu-id="b1597-135">Hook up SendGrid</span></span>

<span data-ttu-id="b1597-136">Le istruzioni riportate in questa sezione non sono aggiornate.</span><span class="sxs-lookup"><span data-stu-id="b1597-136">The instructions in this section are not current.</span></span> <span data-ttu-id="b1597-137">Per istruzioni aggiornate, vedere [configurare il provider di posta elettronica SendGrid](/aspnet/core/security/authentication/accconfirm#configure-email-provider) .</span><span class="sxs-lookup"><span data-stu-id="b1597-137">See [Configure SendGrid email provider](/aspnet/core/security/authentication/accconfirm#configure-email-provider) for updated instructions.</span></span>

<span data-ttu-id="b1597-138">Sebbene questa esercitazione mostri solo come aggiungere notifiche tramite posta elettronica tramite [SendGrid](http://sendgrid.com/), è possibile inviare messaggi di posta elettronica usando SMTP e altri meccanismi (vedere [risorse aggiuntive](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="b1597-138">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="b1597-139">Nella Console di Gestione pacchetti immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="b1597-139">In the Package Manager Console, enter the following command:</span></span> 

    [!code-console[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample1.cmd)]
2. <span data-ttu-id="b1597-140">Passare alla [pagina di iscrizione di Azure SendGrid](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) e registrarsi per ottenere un account SendGrid gratuito.</span><span class="sxs-lookup"><span data-stu-id="b1597-140">Go to the [Azure SendGrid sign up page](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) and register for a free SendGrid account.</span></span> <span data-ttu-id="b1597-141">Configurare SendGrid aggiungendo codice simile al seguente in *app_start/identityconfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="b1597-141">Configure SendGrid by adding code similar to the following in *App_Start/IdentityConfig.cs*:</span></span>

    [!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample2.cs?highlight=3,5)]

<span data-ttu-id="b1597-142">È necessario aggiungere quanto segue:</span><span class="sxs-lookup"><span data-stu-id="b1597-142">You'll need to add the following includes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample3.cs)]

<span data-ttu-id="b1597-143">Per semplificare questo esempio, verranno archiviate le impostazioni dell'app nel file *Web. config* :</span><span class="sxs-lookup"><span data-stu-id="b1597-143">To keep this sample simple, we'll store the app settings in the *web.config* file:</span></span>

[!code-xml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample4.xml)]

> [!WARNING]
> <span data-ttu-id="b1597-144">Sicurezza: non archiviare mai dati sensibili nel codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="b1597-144">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="b1597-145">L'account e le credenziali vengono archiviati in appSetting.</span><span class="sxs-lookup"><span data-stu-id="b1597-145">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="b1597-146">In Azure è possibile archiviare in modo sicuro questi valori nella scheda **[Configura](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** della portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="b1597-146">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="b1597-147">Vedere [le procedure consigliate per la distribuzione di password e altri dati sensibili in ASP.NET e Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="b1597-147">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>

### <a name="enable-email-confirmation-in-the-account-controller"></a><span data-ttu-id="b1597-148">Abilitare la conferma della posta elettronica nel controller account</span><span class="sxs-lookup"><span data-stu-id="b1597-148">Enable email confirmation in the Account controller</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample5.cs?highlight=16-21)]

<span data-ttu-id="b1597-149">Verificare che il file *Views\Account\ConfirmEmail.cshtml* abbia la sintassi Razor corretta.</span><span class="sxs-lookup"><span data-stu-id="b1597-149">Verify the *Views\Account\ConfirmEmail.cshtml* file has correct razor syntax.</span></span> <span data-ttu-id="b1597-150">Il carattere @ nella prima riga potrebbe essere mancante.</span><span class="sxs-lookup"><span data-stu-id="b1597-150">( The @ character in the first line might be missing.</span></span> <span data-ttu-id="b1597-151">)</span><span class="sxs-lookup"><span data-stu-id="b1597-151">)</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample6.cshtml?highlight=1)]

<span data-ttu-id="b1597-152">Eseguire l'app e fare clic sul collegamento Register (registra).</span><span class="sxs-lookup"><span data-stu-id="b1597-152">Run the app and click the Register link.</span></span> <span data-ttu-id="b1597-153">Una volta inviato il modulo di registrazione, si è connessi.</span><span class="sxs-lookup"><span data-stu-id="b1597-153">Once you submit the registration form, you are logged in.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image4.png)

<span data-ttu-id="b1597-154">Controllare l'account di posta elettronica e fare clic sul collegamento per confermare la posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="b1597-154">Check your email account and click on the link to confirm your email.</span></span>

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="b1597-155">Richiedi conferma posta elettronica prima dell'accesso</span><span class="sxs-lookup"><span data-stu-id="b1597-155">Require email confirmation before log in</span></span>

<span data-ttu-id="b1597-156">Al momento del completamento del modulo di registrazione, l'utente ha eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="b1597-156">Currently once a user completes the registration form, they are logged in.</span></span> <span data-ttu-id="b1597-157">In genere si vuole confermare la posta elettronica prima di registrarli in.</span><span class="sxs-lookup"><span data-stu-id="b1597-157">You generally want to confirm their email before logging them in.</span></span> <span data-ttu-id="b1597-158">Nella sezione seguente il codice verrà modificato in modo da richiedere che i nuovi utenti dispongano di un messaggio di posta elettronica confermato prima dell'accesso (autenticato).</span><span class="sxs-lookup"><span data-stu-id="b1597-158">In the section below, we will modify the code to require new users to have a confirmed email before they are logged in (authenticated).</span></span> <span data-ttu-id="b1597-159">Aggiornare il metodo `HttpPost Register` con le modifiche evidenziate di seguito:</span><span class="sxs-lookup"><span data-stu-id="b1597-159">Update the `HttpPost Register` method with the following highlighted changes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample7.cs?highlight=14-15,23-30)]

<span data-ttu-id="b1597-160">Impostando come commento il metodo `SignInAsync`, l'utente non verrà connesso mediante la registrazione.</span><span class="sxs-lookup"><span data-stu-id="b1597-160">By commenting out the `SignInAsync` method, the user will not be signed in by the registration.</span></span> <span data-ttu-id="b1597-161">La riga di `TempData["ViewBagLink"] = callbackUrl;` può essere usata per [eseguire il debug dell'app](#dbg) e verificare la registrazione senza inviare messaggi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="b1597-161">The `TempData["ViewBagLink"] = callbackUrl;` line can be used to [debug the app](#dbg) and test registration without sending email.</span></span> <span data-ttu-id="b1597-162">`ViewBag.Message` viene utilizzato per visualizzare le istruzioni di conferma.</span><span class="sxs-lookup"><span data-stu-id="b1597-162">`ViewBag.Message` is used to display the confirm instructions.</span></span> <span data-ttu-id="b1597-163">L' [esempio di download](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contiene codice per testare la conferma della posta elettronica senza configurare la posta elettronica e può essere usato anche per eseguire il debug dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b1597-163">The [download sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contains code to test email confirmation without setting up email, and can also be used to debug the application.</span></span>

<span data-ttu-id="b1597-164">Creare un file di `Views\Shared\Info.cshtml` e aggiungere il markup Razor seguente:</span><span class="sxs-lookup"><span data-stu-id="b1597-164">Create a `Views\Shared\Info.cshtml` file and add the following razor markup:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample8.cshtml)]

<span data-ttu-id="b1597-165">Aggiungere l' [attributo autorizzi](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) al metodo di azione `Contact` del controller Home.</span><span class="sxs-lookup"><span data-stu-id="b1597-165">Add the [Authorize attribute](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) to the `Contact` action method of the Home controller.</span></span> <span data-ttu-id="b1597-166">È possibile fare clic sul collegamento **contatto** per verificare che gli utenti anonimi non dispongano dell'accesso e che gli utenti autenticati dispongano dell'accesso.</span><span class="sxs-lookup"><span data-stu-id="b1597-166">You can click on the **Contact** link to verify anonymous users don't have access and authenticated users do have access.</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample9.cs?highlight=1)]

<span data-ttu-id="b1597-167">È necessario aggiornare anche il metodo di azione `HttpPost Login`:</span><span class="sxs-lookup"><span data-stu-id="b1597-167">You must also update the `HttpPost Login` action method:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample10.cs?highlight=13-22)]

<span data-ttu-id="b1597-168">Aggiornare la visualizzazione *Views\Shared\Error.cshtml* per visualizzare il messaggio di errore:</span><span class="sxs-lookup"><span data-stu-id="b1597-168">Update the *Views\Shared\Error.cshtml* view to display the error message:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample11.cshtml?highlight=8-17)]

<span data-ttu-id="b1597-169">Eliminare tutti gli account nella tabella **AspNetUsers** che contengono l'alias di posta elettronica con cui si vuole eseguire il test.</span><span class="sxs-lookup"><span data-stu-id="b1597-169">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test with.</span></span> <span data-ttu-id="b1597-170">Eseguire l'app e verificare che non sia possibile accedere fino a quando non è stato confermato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="b1597-170">Run the app and verify you can't log in until you have confirmed your email address.</span></span> <span data-ttu-id="b1597-171">Dopo aver verificato l'indirizzo di posta elettronica, fare clic sul collegamento **contatto** .</span><span class="sxs-lookup"><span data-stu-id="b1597-171">Once you confirm your email address, click the **Contact** link.</span></span>

<a id="reset"></a>
## <a name="password-recoveryreset"></a><span data-ttu-id="b1597-172">Ripristino/reimpostazione della password</span><span class="sxs-lookup"><span data-stu-id="b1597-172">Password recovery/reset</span></span>

<span data-ttu-id="b1597-173">Rimuovere i caratteri di commento dal metodo di azione `HttpPost ForgotPassword` nel controller dell'account:</span><span class="sxs-lookup"><span data-stu-id="b1597-173">Remove the comment characters from the `HttpPost ForgotPassword` action method in the account controller:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample12.cs?highlight=17-20)]

<span data-ttu-id="b1597-174">Rimuovere i caratteri di commento dal `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) nel file di visualizzazione Razor *Views\Account\Login.cshtml* :</span><span class="sxs-lookup"><span data-stu-id="b1597-174">Remove the comment characters from the `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) in the *Views\Account\Login.cshtml* razor view file:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample13.cshtml?highlight=47-50)]

<span data-ttu-id="b1597-175">Nella pagina di accesso verrà ora visualizzato un collegamento per reimpostare la password.</span><span class="sxs-lookup"><span data-stu-id="b1597-175">The Log in page will now show a link to reset the password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="b1597-176">Invia nuovamente il collegamento di conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="b1597-176">Resend email confirmation link</span></span>

<span data-ttu-id="b1597-177">Quando un utente crea un nuovo account locale, riceve un messaggio di posta elettronica con un collegamento di conferma che è necessario usare per poter accedere.</span><span class="sxs-lookup"><span data-stu-id="b1597-177">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="b1597-178">Se l'utente elimina accidentalmente il messaggio di posta elettronica di conferma o il messaggio di posta elettronica non arriva mai, sarà necessario inviare nuovamente il collegamento di conferma.</span><span class="sxs-lookup"><span data-stu-id="b1597-178">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="b1597-179">Le modifiche al codice seguenti illustrano come abilitare questa operazione.</span><span class="sxs-lookup"><span data-stu-id="b1597-179">The following code changes show how to enable this.</span></span>

<span data-ttu-id="b1597-180">Aggiungere il seguente metodo helper alla fine del file *Controllers\AccountController.cs* :</span><span class="sxs-lookup"><span data-stu-id="b1597-180">Add the following helper method to the bottom of the *Controllers\AccountController.cs* file:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample14.cs)]

<span data-ttu-id="b1597-181">Aggiornare il metodo Register per l'uso del nuovo Helper:</span><span class="sxs-lookup"><span data-stu-id="b1597-181">Update the Register method to use the new helper:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample15.cs?highlight=17)]

<span data-ttu-id="b1597-182">Aggiornare il metodo login per inviare di nuovo la password se l'account utente non è stato confermato:</span><span class="sxs-lookup"><span data-stu-id="b1597-182">Update the Login method to resend the password if the user account has not been confirmed:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample16.cs?highlight=20)]

<a id="combine"></a>
## <a name="combine-social-and-local-login-accounts"></a><span data-ttu-id="b1597-183">Combinare account di accesso di social networking e locali</span><span class="sxs-lookup"><span data-stu-id="b1597-183">Combine social and local login accounts</span></span>

<span data-ttu-id="b1597-184">È possibile combinare account locali e di social networking facendo clic sul collegamento di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="b1597-184">You can combine local and social accounts by clicking on your email link.</span></span> <span data-ttu-id="b1597-185">Nella sequenza seguente **RickAndMSFT@gmail.com** viene creato inizialmente come account di accesso locale, ma è possibile creare prima l'account come log di social networking, quindi aggiungere un account di accesso locale.</span><span class="sxs-lookup"><span data-stu-id="b1597-185">In the following sequence **RickAndMSFT@gmail.com** is first created as a local login, but you can create the account as a social log in first, then add a local login.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image5.png)

<span data-ttu-id="b1597-186">Fare clic sul collegamento **Gestisci** .</span><span class="sxs-lookup"><span data-stu-id="b1597-186">Click on the **Manage** link.</span></span> <span data-ttu-id="b1597-187">Si notino gli **account di accesso esterni: 0** associati a questo account.</span><span class="sxs-lookup"><span data-stu-id="b1597-187">Note the **External Logins: 0** associated with this account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image6.png)

<span data-ttu-id="b1597-188">Fai clic sul collegamento a un altro servizio di accesso e accetta le richieste dell'app.</span><span class="sxs-lookup"><span data-stu-id="b1597-188">Click the link to another log in service and accept the app requests.</span></span> <span data-ttu-id="b1597-189">I due account sono stati combinati e sarà possibile accedere con entrambi gli account.</span><span class="sxs-lookup"><span data-stu-id="b1597-189">The two accounts have been combined, you will be able to log on with either account.</span></span> <span data-ttu-id="b1597-190">Potrebbe essere necessario che gli utenti aggiungano gli account locali nel caso in cui il servizio di autenticazione dei log sociali sia inattivo o più probabilmente abbiano perso l'accesso al proprio account di social networking.</span><span class="sxs-lookup"><span data-stu-id="b1597-190">You might want your users to add local accounts in case their social log in authentication service is down, or more likely they have lost access to their social account.</span></span>

<span data-ttu-id="b1597-191">Nella figura seguente Tom è un log di social networking, che è possibile visualizzare dagli account di **accesso esterni: 1** visualizzati nella pagina.</span><span class="sxs-lookup"><span data-stu-id="b1597-191">In the following image, Tom is a social log in (which you can see from the **External Logins: 1** shown on the page).</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image7.png)

<span data-ttu-id="b1597-192">Quando si fa clic su **Seleziona una password** è possibile aggiungere un log locale associato allo stesso account.</span><span class="sxs-lookup"><span data-stu-id="b1597-192">Clicking on **Pick a password** allows you to add a local log on associated with the same account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image8.png)

## <a name="email-confirmation-in-more-depth"></a><span data-ttu-id="b1597-193">Conferma tramite posta elettronica più dettagliata</span><span class="sxs-lookup"><span data-stu-id="b1597-193">Email confirmation in more depth</span></span>

<span data-ttu-id="b1597-194">La conferma dell'account dell'esercitazione [e il ripristino della password con ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) passano a questo argomento con ulteriori dettagli.</span><span class="sxs-lookup"><span data-stu-id="b1597-194">My tutorial [Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) goes into this topic with more details.</span></span>

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="b1597-195">Debug dell'app</span><span class="sxs-lookup"><span data-stu-id="b1597-195">Debugging the app</span></span>

<span data-ttu-id="b1597-196">Se non si riceve un messaggio di posta elettronica contenente il collegamento:</span><span class="sxs-lookup"><span data-stu-id="b1597-196">If you don't get an email containing the link:</span></span>

- <span data-ttu-id="b1597-197">Controllare la cartella della posta indesiderata.</span><span class="sxs-lookup"><span data-stu-id="b1597-197">Check your junk or spam folder.</span></span>
- <span data-ttu-id="b1597-198">Accedere all'account SendGrid e fare clic sul [collegamento attività posta elettronica](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="b1597-198">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>

<span data-ttu-id="b1597-199">Per testare il collegamento di verifica senza posta elettronica, scaricare l' [esempio completato](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span><span class="sxs-lookup"><span data-stu-id="b1597-199">To test the verification link without email, download the [completed sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span></span> <span data-ttu-id="b1597-200">Nella pagina verrà visualizzato il collegamento di conferma e i codici di conferma.</span><span class="sxs-lookup"><span data-stu-id="b1597-200">The confirmation link and confirmation codes will be displayed on the page.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="b1597-201">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="b1597-201">Additional Resources</span></span>

- [<span data-ttu-id="b1597-202">Collegamenti a ASP.NET Identity risorse consigliate</span><span class="sxs-lookup"><span data-stu-id="b1597-202">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- <span data-ttu-id="b1597-203">[Conferma dell'account e recupero della password con ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) Esamina più dettagliatamente il recupero delle password e la conferma dell'account.</span><span class="sxs-lookup"><span data-stu-id="b1597-203">[Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) Goes into more detail on password recovery and account confirmation.</span></span>
- <span data-ttu-id="b1597-204">[App MVC 5 con accesso a Facebook, Twitter, LinkedIn e Google OAuth2](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Questa esercitazione illustra come scrivere un'app ASP.NET MVC 5 con l'autorizzazione Facebook e Google OAuth 2.</span><span class="sxs-lookup"><span data-stu-id="b1597-204">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) This tutorial shows you how to write an ASP.NET MVC 5 app with Facebook and Google OAuth 2 authorization.</span></span> <span data-ttu-id="b1597-205">Viene inoltre illustrato come aggiungere altri dati al database di identità.</span><span class="sxs-lookup"><span data-stu-id="b1597-205">It also shows how to add additional data to the Identity database.</span></span>
- <span data-ttu-id="b1597-206">[Distribuire un'app ASP.NET MVC sicura con appartenenza, OAuth e database SQL in Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="b1597-206">[Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="b1597-207">Questa esercitazione aggiunge la distribuzione di Azure, come proteggere l'app con i ruoli, come usare l'API di appartenenza per aggiungere utenti e ruoli e funzionalità di sicurezza aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="b1597-207">This tutorial adds Azure deployment, how to secure your app with roles, how to use the membership API to add users and roles, and additional security features.</span></span>
- [<span data-ttu-id="b1597-208">Creazione di un'app Google per OAuth 2 e connessione dell'app al progetto</span><span class="sxs-lookup"><span data-stu-id="b1597-208">Creating a Google app for OAuth 2 and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#goog)
- [<span data-ttu-id="b1597-209">Creazione dell'app in Facebook e connessione dell'app al progetto</span><span class="sxs-lookup"><span data-stu-id="b1597-209">Creating the app in Facebook and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#fb)
- [<span data-ttu-id="b1597-210">Configurazione di SSL nel progetto</span><span class="sxs-lookup"><span data-stu-id="b1597-210">Setting up SSL in the Project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#ssl)
