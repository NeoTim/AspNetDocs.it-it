---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: "Esercitazione: Usare migrazioni di EF in un'app ASP.NET MVC e distribuirle in Azure"
author: tdykstra
description: In questa esercitazione si abilitano le migrazioni Code First e si distribuisce l'applicazione nel cloud in Azure.
ms.author: riande
ms.date: 01/16/2019
ms.topic: tutorial
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 989dd0f0e18b338be057b9c5657586eff996d8ea
ms.sourcegitcommit: b95316530fa51087d6c400ff91814fe37e73f7e8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/23/2019
ms.locfileid: "70000760"
---
# <a name="tutorial-use-ef-migrations-in-an-aspnet-mvc-app-and-deploy-to-azure"></a><span data-ttu-id="2d525-103">Esercitazione: Usare migrazioni di EF in un'app ASP.NET MVC e distribuirle in Azure</span><span class="sxs-lookup"><span data-stu-id="2d525-103">Tutorial: Use EF Migrations in an ASP.NET MVC app and deploy to Azure</span></span>

<span data-ttu-id="2d525-104">Fino a questo punto, l'applicazione Web di esempio Contoso University è stata eseguita localmente in IIS Express nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2d525-104">So far the Contoso University sample web application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="2d525-105">Per rendere disponibile un'applicazione reale che altri utenti usino su Internet, è necessario distribuirla a un provider di hosting Web.</span><span class="sxs-lookup"><span data-stu-id="2d525-105">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="2d525-106">In questa esercitazione si abilitano le migrazioni Code First e si distribuisce l'applicazione nel cloud in Azure:</span><span class="sxs-lookup"><span data-stu-id="2d525-106">In this tutorial, you enable Code First migrations and deploy the application to the cloud in Azure:</span></span>

- <span data-ttu-id="2d525-107">Abilitare Migrazioni Code First.</span><span class="sxs-lookup"><span data-stu-id="2d525-107">Enable Code First Migrations.</span></span> <span data-ttu-id="2d525-108">La funzionalità migrazioni consente di modificare il modello di dati e di distribuire le modifiche nell'ambiente di produzione aggiornando lo schema del database senza dover eliminare e ricreare il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-108">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="2d525-109">Eseguire la distribuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="2d525-109">Deploy to Azure.</span></span> <span data-ttu-id="2d525-110">Questo passaggio è facoltativo. è possibile continuare con le esercitazioni rimanenti senza aver distribuito il progetto.</span><span class="sxs-lookup"><span data-stu-id="2d525-110">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="2d525-111">Si consiglia di utilizzare un processo di integrazione continua con il controllo del codice sorgente per la distribuzione, ma in questa esercitazione non vengono trattati tali argomenti.</span><span class="sxs-lookup"><span data-stu-id="2d525-111">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="2d525-112">Per altre informazioni, vedere i capitoli [controllo del codice sorgente](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) e [integrazione continua](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) della [creazione di app Cloud reali con Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span><span class="sxs-lookup"><span data-stu-id="2d525-112">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span></span>

<span data-ttu-id="2d525-113">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d525-113">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="2d525-114">Abilita migrazioni di Code First</span><span class="sxs-lookup"><span data-stu-id="2d525-114">Enable Code First migrations</span></span>
> * <span data-ttu-id="2d525-115">Distribuire l'app in Azure (facoltativo)</span><span class="sxs-lookup"><span data-stu-id="2d525-115">Deploy the app in Azure (optional)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2d525-116">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="2d525-116">Prerequisites</span></span>

- [<span data-ttu-id="2d525-117">Resilienza della connessione e intercettazione dei comandi</span><span class="sxs-lookup"><span data-stu-id="2d525-117">Connection Resiliency and Command Interception</span></span>](connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="enable-code-first-migrations"></a><span data-ttu-id="2d525-118">Abilita migrazioni di Code First</span><span class="sxs-lookup"><span data-stu-id="2d525-118">Enable Code First migrations</span></span>

<span data-ttu-id="2d525-119">Quando si sviluppa una nuova applicazione, il modello di dati cambia di frequente e, a ogni cambiamento, non è più sincronizzato con il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="2d525-120">Il Entity Framework è stato configurato per eliminare e ricreare automaticamente il database ogni volta che si modifica il modello di dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="2d525-121">Quando si aggiungono, rimuovono o si modificano le classi `DbContext` di entità o si modifica la classe, alla successiva esecuzione dell'applicazione viene eliminato automaticamente il database esistente, ne viene creato uno nuovo che corrisponde al modello e ne viene eseguito il seeding con dati di test.</span><span class="sxs-lookup"><span data-stu-id="2d525-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="2d525-122">Questo metodo che consiste nel mantenere il database sincronizzato con il modello di dati funziona bene fino a quando non si distribuisce l'applicazione nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="2d525-123">Quando l'applicazione è in esecuzione nell'ambiente di produzione, in genere archivia i dati che si desidera mantenere e non si desidera perdere tutto ogni volta che viene apportata una modifica, ad esempio l'aggiunta di una nuova colonna.</span><span class="sxs-lookup"><span data-stu-id="2d525-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="2d525-124">La funzionalità [migrazioni Code First](https://msdn.microsoft.com/data/jj591621) risolve questo problema abilitando Code First per aggiornare lo schema del database anziché eliminare e ricreare il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="2d525-125">In questa esercitazione l'applicazione verrà distribuita e verrà preparata per consentire le migrazioni.</span><span class="sxs-lookup"><span data-stu-id="2d525-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="2d525-126">Disabilitare l'inizializzatore configurato in precedenza impostando come commento o eliminando l' `contexts` elemento aggiunto al file Web. config dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="2d525-127">Inoltre, nel file *Web. config* dell'applicazione, modificare il nome del database nella stringa di connessione in ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="2d525-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="2d525-128">Questa modifica consente di configurare il progetto in modo che la prima migrazione crei un nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2d525-128">This change sets up the project so that the first migration creates a new database.</span></span> <span data-ttu-id="2d525-129">Questa operazione non è necessaria, ma in seguito verrà illustrato il motivo per cui è consigliabile.</span><span class="sxs-lookup"><span data-stu-id="2d525-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="2d525-130">Dal menu **Strumenti** selezionare **Gestione pacchetti NuGet** > **Console di Gestione pacchetti**.</span><span class="sxs-lookup"><span data-stu-id="2d525-130">From the **Tools** menu, select **NuGet Package Manager** > **Package Manager Console**.</span></span>

1. <span data-ttu-id="2d525-131">`PM>` Al prompt immettere i comandi seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d525-131">At the `PM>` prompt enter the following commands:</span></span>

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    <span data-ttu-id="2d525-132">Il `enable-migrations` comando crea una cartella Migrations nel progetto ContosoUniversity e inserisce in tale cartella un file *Configuration.cs* che è possibile modificare per configurare le migrazioni.</span><span class="sxs-lookup"><span data-stu-id="2d525-132">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="2d525-133">Se il passaggio precedente non è stato superato e viene indicato di modificare il nome del database, le migrazioni troveranno il database esistente ed eseguiranno automaticamente `add-migration` il comando.</span><span class="sxs-lookup"><span data-stu-id="2d525-133">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="2d525-134">Questo significa semplicemente che non verrà eseguito un test del codice delle migrazioni prima di distribuire il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-134">That's okay, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="2d525-135">In un secondo momento, `update-database` quando si esegue il comando, non si verificherà nulla perché il database esiste già.</span><span class="sxs-lookup"><span data-stu-id="2d525-135">Later when you run the `update-database` command nothing will happen because the database already exists.)</span></span>

    <span data-ttu-id="2d525-136">Aprire il file *ContosoUniversity\Migrations\Configuration.cs* .</span><span class="sxs-lookup"><span data-stu-id="2d525-136">Open the *ContosoUniversity\Migrations\Configuration.cs* file.</span></span> <span data-ttu-id="2d525-137">Analogamente alla classe dell'inizializzatore illustrata in `Configuration` precedenza, la `Seed` classe include un metodo.</span><span class="sxs-lookup"><span data-stu-id="2d525-137">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="2d525-138">Lo scopo del metodo [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) è quello di consentire l'inserimento o l'aggiornamento dei dati di test dopo che Code First crea o aggiorna il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-138">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="2d525-139">Il metodo viene chiamato quando viene creato il database e ogni volta che lo schema del database viene aggiornato dopo la modifica di un modello di dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-139">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="2d525-140">Configurare il metodo Seed</span><span class="sxs-lookup"><span data-stu-id="2d525-140">Set up the Seed method</span></span>

<span data-ttu-id="2d525-141">Quando si elimina e si ricrea il database per ogni modifica del modello di dati, si utilizza il `Seed` metodo della classe inizializzatore per inserire i dati di test, poiché dopo la modifica di ogni modello il database viene eliminato e tutti i dati di test vengono persi.</span><span class="sxs-lookup"><span data-stu-id="2d525-141">When you drop and re-create the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="2d525-142">Con Migrazioni Code First, i dati di test vengono conservati dopo le modifiche apportate al database, quindi l'inclusione dei dati di test nel metodo [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) non è in genere necessaria.</span><span class="sxs-lookup"><span data-stu-id="2d525-142">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="2d525-143">Infatti, non si vuole che il `Seed` metodo inserisca dati di test se si usano le migrazioni per distribuire il database in produzione, perché il `Seed` metodo verrà eseguito in produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-143">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="2d525-144">In tal caso, si desidera che `Seed` il metodo inserisca nel database solo i dati necessari nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-144">In that case, you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="2d525-145">È ad esempio possibile che il database includa i nomi di reparto effettivi `Department` nella tabella quando l'applicazione diventa disponibile nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-145">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="2d525-146">Per questa esercitazione si useranno le migrazioni per la distribuzione, ma il `Seed` metodo inserirà i dati di test in modo da semplificare la verifica del funzionamento della funzionalità dell'applicazione senza dover inserire manualmente una grande quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-146">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="2d525-147">Sostituire il contenuto del file *Configuration.cs* con il codice seguente, che carica i dati di test nel nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2d525-147">Replace the contents of the *Configuration.cs* file with the following code, which loads test data into the new database.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="2d525-148">Il metodo [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) accetta l'oggetto contesto di database come parametro di input e il codice nel metodo utilizza tale oggetto per aggiungere nuove entità al database.</span><span class="sxs-lookup"><span data-stu-id="2d525-148">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="2d525-149">Per ogni tipo di entità, il codice crea una raccolta di nuove entità, le aggiunge alla proprietà [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) appropriata e quindi Salva le modifiche nel database.</span><span class="sxs-lookup"><span data-stu-id="2d525-149">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="2d525-150">Non è necessario chiamare il metodo [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) dopo ogni gruppo di entità, come avviene qui, ma ciò consente di individuare l'origine di un problema se si verifica un'eccezione durante la scrittura del codice nel database.</span><span class="sxs-lookup"><span data-stu-id="2d525-150">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="2d525-151">Alcune delle istruzioni che inseriscono dati utilizzano il metodo [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) per eseguire un'operazione "upsert".</span><span class="sxs-lookup"><span data-stu-id="2d525-151">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="2d525-152">Poiché il `Seed` metodo viene eseguito ogni volta che si `update-database` esegue il comando, in genere dopo ogni migrazione, non è possibile inserire semplicemente i dati, perché le righe che si sta tentando di aggiungere saranno già presenti dopo la prima migrazione che crea il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-152">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="2d525-153">L'operazione "upsert" impedisce gli errori che si verificano se si tenta di inserire una riga già esistente, ma viene ***eseguito l'override*** di eventuali modifiche apportate ai dati durante il test dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-153">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="2d525-154">Con i dati di test in alcune tabelle potrebbe non essere necessario eseguire questa operazione: in alcuni casi, quando si modificano i dati durante il test si desidera che le modifiche rimangano dopo gli aggiornamenti del database.</span><span class="sxs-lookup"><span data-stu-id="2d525-154">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="2d525-155">In tal caso si desidera eseguire un'operazione di inserimento condizionale: inserire una riga solo se non esiste già.</span><span class="sxs-lookup"><span data-stu-id="2d525-155">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="2d525-156">Il metodo Seed usa entrambi gli approcci.</span><span class="sxs-lookup"><span data-stu-id="2d525-156">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="2d525-157">Il primo parametro passato al metodo [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) specifica la proprietà da utilizzare per verificare se una riga esiste già.</span><span class="sxs-lookup"><span data-stu-id="2d525-157">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="2d525-158">Per i dati degli studenti di test da fornire, è `LastName` possibile usare la proprietà per questo scopo, perché ogni cognome nell'elenco è univoco:</span><span class="sxs-lookup"><span data-stu-id="2d525-158">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="2d525-159">Questo codice presuppone che i cognomi siano univoci.</span><span class="sxs-lookup"><span data-stu-id="2d525-159">This code assumes that last names are unique.</span></span> <span data-ttu-id="2d525-160">Se si aggiunge manualmente uno studente con un cognome duplicato, alla successiva esecuzione di una migrazione si otterrà l'eccezione seguente:</span><span class="sxs-lookup"><span data-stu-id="2d525-160">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration:</span></span>

    <span data-ttu-id="2d525-161">**La sequenza contiene più di un elemento**</span><span class="sxs-lookup"><span data-stu-id="2d525-161">**Sequence contains more than one element**</span></span>

    <span data-ttu-id="2d525-162">Per informazioni su come gestire dati ridondanti, ad esempio due studenti denominati "Alexander Carson", vedere il post di Blog relativo al [seeding e al debug Entity Framework (EF)](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) nel Blog di Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="2d525-162">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="2d525-163">Per ulteriori informazioni sul metodo `AddOrUpdate` , vedere la pagina relativa alla [cura del metodo EF 4,3 AddOrUpdate](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) nel Blog di Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="2d525-163">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="2d525-164">Il codice che crea `Enrollment` le entità presuppone che il `ID` valore sia presente `students` nelle entità della raccolta, anche se tale proprietà non è stata impostata nel codice che crea la raccolta.</span><span class="sxs-lookup"><span data-stu-id="2d525-164">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="2d525-165">È possibile usare la `ID` proprietà qui perché il `ID` valore è impostato quando si chiama `SaveChanges` per la `students` raccolta.</span><span class="sxs-lookup"><span data-stu-id="2d525-165">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="2d525-166">EF ottiene automaticamente il valore della chiave primaria quando inserisce un'entità nel database e aggiorna la `ID` proprietà dell'entità in memoria.</span><span class="sxs-lookup"><span data-stu-id="2d525-166">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="2d525-167">Il codice che aggiunge ogni `Enrollment` entità `Enrollments` al set di entità non usa il `AddOrUpdate` metodo.</span><span class="sxs-lookup"><span data-stu-id="2d525-167">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="2d525-168">Verifica se un'entità esiste già e inserisce l'entità se non esiste.</span><span class="sxs-lookup"><span data-stu-id="2d525-168">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="2d525-169">Questo approccio consente di mantenere le modifiche apportate a un livello di registrazione usando l'interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-169">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="2d525-170">Il codice esegue il ciclo di ogni membro `Enrollment`dell' [elenco](https://msdn.microsoft.com/library/6sh2ey19.aspx) e se la registrazione non viene trovata nel database, aggiunge la registrazione al database.</span><span class="sxs-lookup"><span data-stu-id="2d525-170">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="2d525-171">La prima volta che si aggiorna il database, il database sarà vuoto, quindi verrà aggiunta ogni registrazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-171">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. <span data-ttu-id="2d525-172">Compilare il progetto.</span><span class="sxs-lookup"><span data-stu-id="2d525-172">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="2d525-173">Eseguire la prima migrazione</span><span class="sxs-lookup"><span data-stu-id="2d525-173">Execute the first migration</span></span>

<span data-ttu-id="2d525-174">Quando si esegue il `add-migration` comando, le migrazioni generano il codice che crea il database da zero.</span><span class="sxs-lookup"><span data-stu-id="2d525-174">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="2d525-175">Questo codice si trova anche nella cartella *migrazioni* , nel file denominato  *&lt;timestamp&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="2d525-175">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="2d525-176">Il `Up` metodo `Down` della classe crea le tabelle di database che corrispondono ai set di entità del modello di dati e il metodo li elimina. `InitialCreate`</span><span class="sxs-lookup"><span data-stu-id="2d525-176">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="2d525-177">Le migrazioni chiamano il metodo `Up` per implementare le modifiche al modello di dati per una migrazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-177">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="2d525-178">Quando si immette un comando per annullare l'aggiornamento, le migrazioni chiamano il metodo `Down`.</span><span class="sxs-lookup"><span data-stu-id="2d525-178">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="2d525-179">Si tratta della migrazione iniziale creata al momento dell'immissione del `add-migration InitialCreate` comando.</span><span class="sxs-lookup"><span data-stu-id="2d525-179">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="2d525-180">Il parametro (`InitialCreate` nell'esempio) viene usato per il nome del file e può essere quello desiderato. in genere si sceglie una parola o una frase che riepiloga le operazioni eseguite nella migrazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-180">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="2d525-181">Ad esempio, è possibile denominare un &quot;AddDepartmentTable&quot;di migrazione successivo.</span><span class="sxs-lookup"><span data-stu-id="2d525-181">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="2d525-182">Se la migrazione iniziale è stata creata quando il database esisteva già, il codice di creazione del database viene generato ma non è necessario eseguirlo perché il database corrisponde già al modello di dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-182">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="2d525-183">Quando si distribuisce l'app in un altro ambiente in cui il database non esiste ancora, questo codice verrà eseguito per creare il database, è consigliabile quindi testarlo prima.</span><span class="sxs-lookup"><span data-stu-id="2d525-183">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="2d525-184">Per questo motivo è stato modificato il nome del database nella stringa di connessione in&mdash;precedenza, in modo che le migrazioni possano crearne una nuova da zero.</span><span class="sxs-lookup"><span data-stu-id="2d525-184">That's why you changed the name of the database in the connection string earlier&mdash;so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="2d525-185">Nella finestra **console di gestione pacchetti** immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="2d525-185">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    <span data-ttu-id="2d525-186">Il `update-database` comando esegue il `Up` metodo per creare il database, quindi esegue il `Seed` metodo per popolare il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-186">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="2d525-187">Lo stesso processo verrà eseguito automaticamente in produzione dopo la distribuzione dell'applicazione, come si vedrà nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="2d525-187">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="2d525-188">Utilizzare **Esplora server** per esaminare il database come è stato fatto nella prima esercitazione ed eseguire l'applicazione per verificare che tutto funzioni ancora come prima.</span><span class="sxs-lookup"><span data-stu-id="2d525-188">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="2d525-189">Distribuire in Azure</span><span class="sxs-lookup"><span data-stu-id="2d525-189">Deploy to Azure</span></span>

<span data-ttu-id="2d525-190">Fino a questo punto l'applicazione è stata eseguita localmente in IIS Express nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2d525-190">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="2d525-191">Per renderlo disponibile per l'uso da parte di altri utenti su Internet, è necessario distribuirlo a un provider di hosting Web.</span><span class="sxs-lookup"><span data-stu-id="2d525-191">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="2d525-192">In questa sezione dell'esercitazione verrà distribuita in Azure.</span><span class="sxs-lookup"><span data-stu-id="2d525-192">In this section of the tutorial, you'll deploy it to Azure.</span></span> <span data-ttu-id="2d525-193">Questa sezione è facoltativa. è possibile ignorare questo passaggio e continuare con l'esercitazione seguente oppure è possibile adattare le istruzioni riportate in questa sezione per un provider di hosting diverso a scelta.</span><span class="sxs-lookup"><span data-stu-id="2d525-193">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="use-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="2d525-194">Usare migrazioni di Code First per distribuire il database</span><span class="sxs-lookup"><span data-stu-id="2d525-194">Use Code First migrations to deploy the database</span></span>

<span data-ttu-id="2d525-195">Per distribuire il database, si utilizzerà Migrazioni Code First.</span><span class="sxs-lookup"><span data-stu-id="2d525-195">To deploy the database, you'll use Code First Migrations.</span></span> <span data-ttu-id="2d525-196">Quando si crea il profilo di pubblicazione usato per configurare le impostazioni per la distribuzione da Visual Studio, selezionare una casella di controllo con l'etichetta **Aggiorna database**.</span><span class="sxs-lookup"><span data-stu-id="2d525-196">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="2d525-197">Questa impostazione fa in modo che il processo di distribuzione configuri automaticamente il file *Web. config* dell'applicazione nel server di `MigrateDatabaseToLatestVersion` destinazione in modo che Code First usi la classe inizializzatore.</span><span class="sxs-lookup"><span data-stu-id="2d525-197">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="2d525-198">Visual Studio non esegue alcuna operazione con il database durante il processo di distribuzione durante la copia del progetto nel server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-198">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="2d525-199">Quando si esegue l'applicazione distribuita e si accede al database per la prima volta dopo la distribuzione, Code First controlla se il database corrisponde al modello di dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-199">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="2d525-200">In caso di mancata corrispondenza, Code First crea automaticamente il database (se non esiste già) o aggiorna lo schema del database alla versione più recente (se esiste un database ma non corrisponde al modello).</span><span class="sxs-lookup"><span data-stu-id="2d525-200">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="2d525-201">Se l'applicazione implementa un `Seed` metodo Migrations, il metodo viene eseguito dopo la creazione del database o l'aggiornamento dello schema.</span><span class="sxs-lookup"><span data-stu-id="2d525-201">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="2d525-202">Il `Seed` metodo Migrations inserisce i dati di test.</span><span class="sxs-lookup"><span data-stu-id="2d525-202">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="2d525-203">Se si esegue la distribuzione in un ambiente di produzione, è necessario modificare il `Seed` metodo in modo che inserisca solo i dati che si desidera inserire nel database di produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-203">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="2d525-204">Nel modello di dati corrente, ad esempio, potrebbe essere necessario disporre di corsi reali ma studenti fittizi nel database di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2d525-204">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="2d525-205">È possibile scrivere un `Seed` metodo per il caricamento in fase di sviluppo e quindi impostare come commento gli studenti fittizi prima della distribuzione nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-205">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="2d525-206">In alternativa, è possibile `Seed` scrivere un metodo per caricare solo i corsi e immettere manualmente gli studenti fittizi nel database di test usando l'interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-206">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="2d525-207">Ottenere un account Azure</span><span class="sxs-lookup"><span data-stu-id="2d525-207">Get an Azure account</span></span>

<span data-ttu-id="2d525-208">È necessario un account Azure.</span><span class="sxs-lookup"><span data-stu-id="2d525-208">You'll need an Azure account.</span></span> <span data-ttu-id="2d525-209">Se non si dispone già di una sottoscrizione di Visual Studio, è possibile [attivare i vantaggi](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
)della sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="2d525-209">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span></span> <span data-ttu-id="2d525-210">In caso contrario, è possibile creare un account di valutazione gratuito in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="2d525-210">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="2d525-211">Per informazioni dettagliate, vedere [versione di valutazione gratuita di Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="2d525-211">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="2d525-212">Creare un sito Web e un database SQL in Azure</span><span class="sxs-lookup"><span data-stu-id="2d525-212">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="2d525-213">L'app Web in Azure verrà eseguita in un ambiente di hosting condiviso, il che significa che viene eseguito in macchine virtuali (VM) condivise con altri client di Azure.</span><span class="sxs-lookup"><span data-stu-id="2d525-213">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="2d525-214">Un ambiente di hosting condiviso è un modo economico per iniziare a usare il cloud.</span><span class="sxs-lookup"><span data-stu-id="2d525-214">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="2d525-215">In un secondo momento, se aumenta il traffico Web, l'applicazione può essere ridimensionata per soddisfare le esigenze dell'utente eseguendo in macchine virtuali dedicate.</span><span class="sxs-lookup"><span data-stu-id="2d525-215">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="2d525-216">Per altre informazioni sulle opzioni di prezzo per il servizio app Azure, vedere [prezzi del servizio app](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="2d525-216">To learn more about Pricing Options for Azure App Service, read [App Service pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<span data-ttu-id="2d525-217">Il database verrà distribuito nel database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="2d525-217">You'll deploy the database to Azure SQL database.</span></span> <span data-ttu-id="2d525-218">Il database SQL è un servizio di database relazionale basato sul cloud che si basa su tecnologie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d525-218">SQL database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="2d525-219">Gli strumenti e le applicazioni che funzionano con SQL Server funzionano anche con il database SQL.</span><span class="sxs-lookup"><span data-stu-id="2d525-219">Tools and applications that work with SQL Server also work with SQL database.</span></span>

1. <span data-ttu-id="2d525-220">Nel [portale di gestione di Azure](https://portal.azure.com)scegliere **Crea una risorsa** nella scheda a sinistra, quindi fare clic su **Visualizza tutto** nel **nuovo** riquadro (opannello) per visualizzare tutte le risorse disponibili.</span><span class="sxs-lookup"><span data-stu-id="2d525-220">In the [Azure Management Portal](https://portal.azure.com), choose **Create a resource** in the left tab and then choose **See all** on the **New** pane (or *blade*) to see all available resources.</span></span> <span data-ttu-id="2d525-221">Scegliere **app Web e SQL** nella sezione **Web** del pannello **tutto** .</span><span class="sxs-lookup"><span data-stu-id="2d525-221">Choose **Web App + SQL** in the **Web** section of the **Everything** blade.</span></span> <span data-ttu-id="2d525-222">Infine, scegliere **Crea**.</span><span class="sxs-lookup"><span data-stu-id="2d525-222">Finally, choose **Create**.</span></span>

    ![Creare una risorsa nel portale di Azure](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   <span data-ttu-id="2d525-224">Viene aperto il modulo per creare una nuova **app Web** e una nuova risorsa SQL.</span><span class="sxs-lookup"><span data-stu-id="2d525-224">The form to create a new **New Web App + SQL** resource opens.</span></span>

2. <span data-ttu-id="2d525-225">Immettere una stringa nella casella **nome app** da usare come URL univoco per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-225">Enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="2d525-226">L'URL completo sarà costituito da quanto immesso qui e dal dominio predefinito di app Azure Services (azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="2d525-226">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="2d525-227">Se il **nome dell'app** è già stato fatto, la procedura guidata invia una notifica con un messaggio di colore rosso. *il nome dell'app non è disponibile* .</span><span class="sxs-lookup"><span data-stu-id="2d525-227">If the **App name** is already taken, the Wizard notifies you with a red *The app name is not available* message.</span></span> <span data-ttu-id="2d525-228">Se il **nome dell'app** è disponibile, viene visualizzato un segno di spunta verde.</span><span class="sxs-lookup"><span data-stu-id="2d525-228">If the **App name** is available, you see a green checkmark.</span></span>

3. <span data-ttu-id="2d525-229">Nella casella **sottoscrizione** scegliere la sottoscrizione di Azure in cui si vuole inserire il **servizio app** .</span><span class="sxs-lookup"><span data-stu-id="2d525-229">In the **Subscription** box, choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="2d525-230">Nella casella di testo **gruppo di risorse** scegliere un gruppo di risorse o crearne uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="2d525-230">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="2d525-231">Questa impostazione specifica quali data center verrà eseguito il sito Web.</span><span class="sxs-lookup"><span data-stu-id="2d525-231">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="2d525-232">Per altre informazioni sui gruppi di risorse, vedere [gruppi di risorse](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="2d525-232">For more information about Resource Groups, see [Resource groups](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>

5. <span data-ttu-id="2d525-233">Creare un nuovo **piano di servizio app** facendo clic *sulla sezione servizio app*, **Crea nuovo**e compila **piano di servizio app** (può essere lo stesso nome del servizio app), **posizione**e piano **tariffario** (è disponibile un'opzione gratuita).</span><span class="sxs-lookup"><span data-stu-id="2d525-233">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

6. <span data-ttu-id="2d525-234">Fare clic su **database SQL**, quindi scegliere **Crea un nuovo database** o seleziona un database esistente.</span><span class="sxs-lookup"><span data-stu-id="2d525-234">Click **SQL Database**, and then choose **Create a new database** or select an existing database.</span></span>

7. <span data-ttu-id="2d525-235">Nella casella **nome** immettere un nome per il database.</span><span class="sxs-lookup"><span data-stu-id="2d525-235">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="2d525-236">Fare clic sulla casella **server di destinazione** , quindi selezionare **Crea un nuovo server**.</span><span class="sxs-lookup"><span data-stu-id="2d525-236">Click the **Target Server** box, and then select **Create a new server**.</span></span> <span data-ttu-id="2d525-237">In alternativa, se in precedenza è stato creato un server, è possibile selezionare il server dall'elenco dei server disponibili.</span><span class="sxs-lookup"><span data-stu-id="2d525-237">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="2d525-238">Scegliere la sezione piano tariffario, scegliere *gratuito*.</span><span class="sxs-lookup"><span data-stu-id="2d525-238">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="2d525-239">Se sono necessarie risorse aggiuntive, il database può essere ridimensionato in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="2d525-239">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="2d525-240">Per altre informazioni sui prezzi di Azure SQL, vedere [prezzi del database SQL di Azure](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="2d525-240">To learn more on Azure SQL Pricing, see [Azure SQL Database pricing](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
10. <span data-ttu-id="2d525-241">Modificare le [regole di confronto](/sql/relational-databases/collations/collation-and-unicode-support) in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="2d525-241">Modify [collation](/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="2d525-242">Immettere un **nome utente amministratore SQL** amministratore e una **password amministratore SQL**.</span><span class="sxs-lookup"><span data-stu-id="2d525-242">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span>

    - <span data-ttu-id="2d525-243">Se è stato selezionato **nuovo server di database SQL**, definire un nuovo nome e una nuova password da utilizzare in un secondo momento quando si accede al database.</span><span class="sxs-lookup"><span data-stu-id="2d525-243">If you selected **New SQL Database server**, define a new name and password that you'll use later when you access the database.</span></span>
    - <span data-ttu-id="2d525-244">Se è stato selezionato un server creato in precedenza, immettere le credenziali per tale server.</span><span class="sxs-lookup"><span data-stu-id="2d525-244">If you selected a server that you created previously, enter credentials for that server.</span></span>

12. <span data-ttu-id="2d525-245">La raccolta di dati di telemetria può essere abilitata per il servizio app usando Application Insights.</span><span class="sxs-lookup"><span data-stu-id="2d525-245">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="2d525-246">Con una configurazione minima, Application Insights raccoglie informazioni importanti su eventi, eccezioni, dipendenze, richieste e tracce.</span><span class="sxs-lookup"><span data-stu-id="2d525-246">With little configuration, Application Insights collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="2d525-247">Per altre informazioni su Application Insights, vedere [monitoraggio di Azure](https://azure.microsoft.com/services/monitor/).</span><span class="sxs-lookup"><span data-stu-id="2d525-247">To learn more about Application Insights, see [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span></span>
13. <span data-ttu-id="2d525-248">Fare clic su **Crea** nella parte inferiore per indicare che l'operazione è terminata.</span><span class="sxs-lookup"><span data-stu-id="2d525-248">Click **Create** at the bottom to indicate that you're finished.</span></span>

    <span data-ttu-id="2d525-249">Il portale di gestione torna alla pagina dashboard e l'area **notifiche** nella parte superiore della pagina indica che è in corso la creazione del sito.</span><span class="sxs-lookup"><span data-stu-id="2d525-249">The Management Portal returns to the Dashboard page, and the **Notifications** area at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="2d525-250">Dopo un periodo di tempo (in genere meno di un minuto), esiste una notifica che la distribuzione è riuscita.</span><span class="sxs-lookup"><span data-stu-id="2d525-250">After a while (typically less than a minute), there's a notification that the Deployment succeeded.</span></span> <span data-ttu-id="2d525-251">Nella barra di spostamento a sinistra, il nuovo servizio app viene visualizzato nella sezione **Servizi app** e il nuovo database SQL viene visualizzato nella sezione **database SQL** .</span><span class="sxs-lookup"><span data-stu-id="2d525-251">In the navigation bar at the left, the new App Service appears in the **App Services** section and the new SQL database appears in the **SQL databases** section.</span></span>

### <a name="deploy-the-app-to-azure"></a><span data-ttu-id="2d525-252">Distribuire l'app in Azure</span><span class="sxs-lookup"><span data-stu-id="2d525-252">Deploy the app to Azure</span></span>

1. <span data-ttu-id="2d525-253">In Visual Studio fare clic con il pulsante destro del mouse sul progetto in **Esplora soluzioni** e scegliere **pubblica** dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="2d525-253">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

2. <span data-ttu-id="2d525-254">Nella pagina selezionare **una destinazione di pubblicazione** scegliere **servizio app** , quindi **selezionare esistente**e quindi scegliere **pubblica**.</span><span class="sxs-lookup"><span data-stu-id="2d525-254">On the **Pick a publish target** page, choose **App Service** and then **Select Existing**, and then choose **Publish**.</span></span>

    ![Selezionare una pagina di destinazione della pubblicazione](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. <span data-ttu-id="2d525-256">Se in precedenza non è stata aggiunta la sottoscrizione di Azure in Visual Studio, eseguire i passaggi sullo schermo.</span><span class="sxs-lookup"><span data-stu-id="2d525-256">If you haven't previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="2d525-257">Questa procedura consente a Visual Studio di connettersi alla sottoscrizione di Azure in modo che l'elenco di **Servizi app** includa il sito Web.</span><span class="sxs-lookup"><span data-stu-id="2d525-257">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>

4. <span data-ttu-id="2d525-258">Nella pagina **servizio app** selezionare la **sottoscrizione** a cui è stato aggiunto il servizio app.</span><span class="sxs-lookup"><span data-stu-id="2d525-258">On the **App Service** page, select the **Subscription** you added the App Service to.</span></span> <span data-ttu-id="2d525-259">In **Visualizza**selezionare **gruppo di risorse**.</span><span class="sxs-lookup"><span data-stu-id="2d525-259">Under **View**, select **Resource Group**.</span></span> <span data-ttu-id="2d525-260">Espandere il gruppo di risorse a cui è stato aggiunto il servizio app e quindi selezionare il servizio app.</span><span class="sxs-lookup"><span data-stu-id="2d525-260">Expand the resource group you added the App Service to, and then select the App Service.</span></span> <span data-ttu-id="2d525-261">Scegliere **OK** per pubblicare l'app.</span><span class="sxs-lookup"><span data-stu-id="2d525-261">Choose **OK** to publish the app.</span></span>

5. <span data-ttu-id="2d525-262">Nella finestra **output** vengono visualizzate le azioni di distribuzione eseguite e viene segnalato il corretto completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="2d525-262">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>

6. <span data-ttu-id="2d525-263">Al completamento della distribuzione, il browser predefinito si apre automaticamente all'URL del sito Web distribuito.</span><span class="sxs-lookup"><span data-stu-id="2d525-263">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    <span data-ttu-id="2d525-265">L'app è ora in esecuzione nel cloud.</span><span class="sxs-lookup"><span data-stu-id="2d525-265">Your app is now running in the cloud.</span></span>

<span data-ttu-id="2d525-266">A questo punto, il database *schoolContext* è stato creato nel database SQL di Azure perché è stata selezionata l'opzione **Esegui migrazioni Code First (esecuzione all'avvio dell'app)** .</span><span class="sxs-lookup"><span data-stu-id="2d525-266">At this point, the *SchoolContext* database has been created in the Azure SQL database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="2d525-267">Il file *Web. config* nel sito Web distribuito è stato modificato in modo che l'inizializzatore [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) venga eseguito la prima volta che il codice legge o scrive i dati nel database, che si è verificato quando è stata selezionata la scheda Students ( **studenti** ). ):</span><span class="sxs-lookup"><span data-stu-id="2d525-267">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![Estratto del file Web. config](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="2d525-269">Il processo di distribuzione ha creato anche una nuova stringa di connessione *\_(schoolContext DatabasePublish*) per migrazioni Code First da usare per l'aggiornamento dello schema del database e il seeding del database.</span><span class="sxs-lookup"><span data-stu-id="2d525-269">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Stringa di connessione nel file Web. config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="2d525-271">È possibile trovare la versione distribuita del file Web. config nel computer in uso in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. È possibile accedere al file *Web. config* distribuito utilizzando FTP.</span><span class="sxs-lookup"><span data-stu-id="2d525-271">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="2d525-272">Per istruzioni, vedere [distribuzione Web ASP.NET con Visual Studio: Distribuzione di un aggiornamento](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update)del codice.</span><span class="sxs-lookup"><span data-stu-id="2d525-272">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="2d525-273">Seguire le istruzioni che iniziano con "per usare uno strumento FTP, sono necessari tre elementi: l'URL FTP, il nome utente e la password".</span><span class="sxs-lookup"><span data-stu-id="2d525-273">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="2d525-274">L'app Web non implementa la sicurezza, pertanto chiunque trovi l'URL può modificare i dati.</span><span class="sxs-lookup"><span data-stu-id="2d525-274">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="2d525-275">Per istruzioni su come proteggere il sito Web, vedere [distribuire un'app ASP.NET MVC sicura con appartenenza, OAuth e database SQL in Azure](/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="2d525-275">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL database to Azure](/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="2d525-276">È possibile impedire ad altri utenti di usare il sito arrestando il servizio usando il portale di gestione o **Esplora server** di Azure in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2d525-276">You can prevent other people from using the site by stopping the service using the Azure Management Portal or **Server Explorer** in Visual Studio.</span></span>

![Voce di menu Arresta servizio app](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="2d525-278">Scenari di migrazioni avanzate</span><span class="sxs-lookup"><span data-stu-id="2d525-278">Advanced migrations scenarios</span></span>

<span data-ttu-id="2d525-279">Se si distribuisce un database eseguendo automaticamente le migrazioni come illustrato in questa esercitazione e si distribuisce in un sito Web in esecuzione su più server, è possibile ottenere più server che tentano di eseguire le migrazioni nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="2d525-279">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="2d525-280">Poiché le migrazioni sono atomiche, se due server tentano di eseguire la stessa migrazione, ne verrà eseguita una e l'altra avrà esito negativo (presupponendo che le operazioni non possano essere eseguite due volte).</span><span class="sxs-lookup"><span data-stu-id="2d525-280">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="2d525-281">In questo scenario, se si desidera evitare questi problemi, è possibile chiamare le migrazioni manualmente e configurare il proprio codice in modo che venga eseguito una sola volta.</span><span class="sxs-lookup"><span data-stu-id="2d525-281">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="2d525-282">Per ulteriori informazioni, vedere [esecuzione e creazione di script delle migrazioni dal codice](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) nel Blog di Rowan Miller ed eseguire la migrazione di [. exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (per l'esecuzione di migrazioni dalla riga di comando).</span><span class="sxs-lookup"><span data-stu-id="2d525-282">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (for executing migrations from the command line).</span></span>

<span data-ttu-id="2d525-283">Per informazioni su altri scenari di migrazione, vedere la [serie di screencast sulle migrazioni](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span><span class="sxs-lookup"><span data-stu-id="2d525-283">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="update-specific-migration"></a><span data-ttu-id="2d525-284">Aggiorna migrazione specifica</span><span class="sxs-lookup"><span data-stu-id="2d525-284">Update specific migration</span></span>

`update-database -target MigrationName`

<span data-ttu-id="2d525-285">Il `update-database -target MigrationName` comando esegue la migrazione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="2d525-285">The `update-database -target MigrationName` command runs the targeted migration.</span></span>

## <a name="ignore-migration-changes-to-database"></a><span data-ttu-id="2d525-286">Ignora le modifiche alla migrazione del database</span><span class="sxs-lookup"><span data-stu-id="2d525-286">Ignore migration changes to database</span></span>

`Add-migration MigrationName -ignoreChanges`

<span data-ttu-id="2d525-287">`ignoreChanges`Crea una migrazione vuota con il modello corrente come snapshot.</span><span class="sxs-lookup"><span data-stu-id="2d525-287">`ignoreChanges` creates an empty migration with the current model as a snapshot.</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="2d525-288">Inizializzatori di Code First</span><span class="sxs-lookup"><span data-stu-id="2d525-288">Code First initializers</span></span>

<span data-ttu-id="2d525-289">Nella sezione relativa alla distribuzione è stato visualizzato l'inizializzatore [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) usato.</span><span class="sxs-lookup"><span data-stu-id="2d525-289">In the deployment section, you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="2d525-290">Code First fornisce anche altri inizializzatori, tra cui [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (impostazione predefinita), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (usato in precedenza) e [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="2d525-290">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="2d525-291">L' `DropCreateAlways` inizializzatore può essere utile per configurare le condizioni per gli unit test.</span><span class="sxs-lookup"><span data-stu-id="2d525-291">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="2d525-292">È anche possibile scrivere inizializzatori personalizzati ed è possibile chiamare un inizializzatore in modo esplicito se non si vuole attendere che l'applicazione legga o scriva nel database.</span><span class="sxs-lookup"><span data-stu-id="2d525-292">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span>

<span data-ttu-id="2d525-293">Per ulteriori informazioni sugli inizializzatori, vedere [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) e il capitolo 6 del [libro Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) da Julie Lerman e Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="2d525-293">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="get-the-code"></a><span data-ttu-id="2d525-294">Ottenere il codice</span><span class="sxs-lookup"><span data-stu-id="2d525-294">Get the code</span></span>

[<span data-ttu-id="2d525-295">Scaricare il progetto completato</span><span class="sxs-lookup"><span data-stu-id="2d525-295">Download the Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="2d525-296">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="2d525-296">Additional resources</span></span>

<span data-ttu-id="2d525-297">Collegamenti ad altre risorse Entity Framework sono disponibili in [ASP.NET Data Access-risorse consigliate](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="2d525-297">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

## <a name="next-steps"></a><span data-ttu-id="2d525-298">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2d525-298">Next steps</span></span>

<span data-ttu-id="2d525-299">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d525-299">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="2d525-300">Migrazioni Code First abilitate</span><span class="sxs-lookup"><span data-stu-id="2d525-300">Enabled Code First migrations</span></span>
> * <span data-ttu-id="2d525-301">L'app è stata distribuita in Azure (facoltativo)</span><span class="sxs-lookup"><span data-stu-id="2d525-301">Deployed the app in Azure (optional)</span></span>

<span data-ttu-id="2d525-302">Passare all'articolo successivo per informazioni su come creare un modello di dati più complesso per un'applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2d525-302">Advance to the next article to learn how to create a more complex data model for an ASP.NET MVC Application.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="2d525-303">Creazione di un modello di dati più complesso</span><span class="sxs-lookup"><span data-stu-id="2d525-303">Create a more complex data model</span></span>](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)
