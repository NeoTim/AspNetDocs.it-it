---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: "Esercitazione: Usare migrazioni di Entity Framework in un'app ASP.NET MVC e distribuire in Azure"
author: tdykstra
description: In questa esercitazione abilitare migrazioni Code First e distribuire l'applicazione al cloud in Azure.
ms.author: riande
ms.date: 01/16/2019
ms.topic: tutorial
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: dd6bf5d8eb8a05dad1d230ef40c9b863e2af7094
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/01/2019
ms.locfileid: "57036988"
---
# <a name="tutorial-use-ef-migrations-in-an-aspnet-mvc-app-and-deploy-to-azure"></a><span data-ttu-id="44312-103">Esercitazione: Usare migrazioni di Entity Framework in un'app ASP.NET MVC e distribuire in Azure</span><span class="sxs-lookup"><span data-stu-id="44312-103">Tutorial: Use EF Migrations in an ASP.NET MVC app and deploy to Azure</span></span>

<span data-ttu-id="44312-104">Finora l'applicazione web di esempio Contoso University è stato in esecuzione in locale in IIS Express nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="44312-104">So far the Contoso University sample web application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="44312-105">Per rendere disponibile ad altri utenti per usare la rete Internet un'applicazione reale, è necessario distribuirla in un provider di hosting web.</span><span class="sxs-lookup"><span data-stu-id="44312-105">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="44312-106">In questa esercitazione abilitare migrazioni Code First e distribuire l'applicazione al cloud in Azure:</span><span class="sxs-lookup"><span data-stu-id="44312-106">In this tutorial, you enable Code First migrations and deploy the application to the cloud in Azure:</span></span>

- <span data-ttu-id="44312-107">Abilitare migrazioni Code First.</span><span class="sxs-lookup"><span data-stu-id="44312-107">Enable Code First Migrations.</span></span> <span data-ttu-id="44312-108">La funzionalità delle migrazioni consente di modificare il modello di dati e distribuire le modifiche nell'ambiente di produzione aggiornando lo schema del database senza dover eliminare e ricreare il database.</span><span class="sxs-lookup"><span data-stu-id="44312-108">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="44312-109">Distribuire in Azure.</span><span class="sxs-lookup"><span data-stu-id="44312-109">Deploy to Azure.</span></span> <span data-ttu-id="44312-110">Questo passaggio è facoltativo. è possibile continuare con le esercitazioni rimanenti senza avere distribuito il progetto.</span><span class="sxs-lookup"><span data-stu-id="44312-110">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="44312-111">È consigliabile che si utilizza un processo di continuous integration con controllo del codice sorgente per la distribuzione, ma questa esercitazione non illustra tali argomenti.</span><span class="sxs-lookup"><span data-stu-id="44312-111">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="44312-112">Per altre informazioni, vedere la [controllo del codice sorgente](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) e [ricchissimo](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) capitoli di [creazione di App Cloud reali con Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span><span class="sxs-lookup"><span data-stu-id="44312-112">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span></span>

<span data-ttu-id="44312-113">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="44312-113">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="44312-114">Abilitare migrazioni Code First</span><span class="sxs-lookup"><span data-stu-id="44312-114">Enable Code First migrations</span></span>
> * <span data-ttu-id="44312-115">Distribuire l'app in Azure (facoltativo)</span><span class="sxs-lookup"><span data-stu-id="44312-115">Deploy the app in Azure (optional)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="44312-116">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="44312-116">Prerequisites</span></span>

- [<span data-ttu-id="44312-117">Resilienza della connessione e intercettazione dei comandi</span><span class="sxs-lookup"><span data-stu-id="44312-117">Connection Resiliency and Command Interception</span></span>](connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="enable-code-first-migrations"></a><span data-ttu-id="44312-118">Abilitare migrazioni Code First</span><span class="sxs-lookup"><span data-stu-id="44312-118">Enable Code First migrations</span></span>

<span data-ttu-id="44312-119">Quando si sviluppa una nuova applicazione, il modello di dati cambia di frequente e, a ogni cambiamento, non è più sincronizzato con il database.</span><span class="sxs-lookup"><span data-stu-id="44312-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="44312-120">Durante la configurazione di Entity Framework per automaticamente eliminare e ricreare il database ogni volta che si modifica il modello di dati.</span><span class="sxs-lookup"><span data-stu-id="44312-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="44312-121">Quando aggiungere, rimuovere, o modificare le classi di entità o modificare i `DbContext` classe, alla successiva esecuzione dell'applicazione automaticamente consente di eliminare il database esistente, viene creata una nuova istanza che corrisponde al modello ed esegue il seeding con dati di test.</span><span class="sxs-lookup"><span data-stu-id="44312-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="44312-122">Questo metodo che consiste nel mantenere il database sincronizzato con il modello di dati funziona bene fino a quando non si distribuisce l'applicazione nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="44312-123">Quando l'applicazione è in esecuzione nell'ambiente di produzione, in genere archivia i dati che si desidera mantenere e non si vuole perdere tutto ad ogni volta che si apporta una modifica ad esempio l'aggiunta di una nuova colonna.</span><span class="sxs-lookup"><span data-stu-id="44312-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="44312-124">Il [migrazioni Code First](https://msdn.microsoft.com/data/jj591621) funzionalità risolve questo problema abilitando Code First aggiornare lo schema del database anziché dover eliminare e ricreare il database.</span><span class="sxs-lookup"><span data-stu-id="44312-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="44312-125">In questa esercitazione si distribuirà l'applicazione e per preparare che è possibile abilitare migrazioni.</span><span class="sxs-lookup"><span data-stu-id="44312-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="44312-126">Disabilitare l'inizializzatore che è impostato in precedenza da impostare come commento o eliminare il `contexts` elemento che è stato aggiunto al file Web. config dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="44312-127">Anche nell'applicazione *Web. config* file, modificare il nome del database nella stringa di connessione in ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="44312-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="44312-128">Questa modifica configura il progetto in modo che la prima migrazione crei un nuovo database.</span><span class="sxs-lookup"><span data-stu-id="44312-128">This change sets up the project so that the first migration creates a new database.</span></span> <span data-ttu-id="44312-129">Non è obbligatorio, ma capirà più avanti perché è una buona idea.</span><span class="sxs-lookup"><span data-stu-id="44312-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="44312-130">Dal menu **Strumenti** selezionare **Gestione pacchetti NuGet** > **Console di Gestione pacchetti**.</span><span class="sxs-lookup"><span data-stu-id="44312-130">From the **Tools** menu, select **NuGet Package Manager** > **Package Manager Console**.</span></span>

1. <span data-ttu-id="44312-131">Nel `PM>` prompt dei comandi immettere i comandi seguenti:</span><span class="sxs-lookup"><span data-stu-id="44312-131">At the `PM>` prompt enter the following commands:</span></span>

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    <span data-ttu-id="44312-132">Il `enable-migrations` comando crea un *migrazioni* cartella nel progetto ContosoUniversity e lo inserisce in tale cartella un *Configuration.cs* file che è possibile modificare per configurare le migrazioni.</span><span class="sxs-lookup"><span data-stu-id="44312-132">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="44312-133">(Se hai perso il passaggio precedente che indirizza l'utente per modificare il nome del database, migrazioni troveranno il database esistente ed eseguire automaticamente il `add-migration` comando.</span><span class="sxs-lookup"><span data-stu-id="44312-133">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="44312-134">Questa impostazione è corretta, che significa semplicemente che è non verrà eseguito un test del codice di migrazioni prima di distribuire il database.</span><span class="sxs-lookup"><span data-stu-id="44312-134">That's okay, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="44312-135">In seguito quando si esegue il `update-database` comando non accade nulla perché il database esiste già.)</span><span class="sxs-lookup"><span data-stu-id="44312-135">Later when you run the `update-database` command nothing will happen because the database already exists.)</span></span>

    <span data-ttu-id="44312-136">Aprire il *ContosoUniversity\Migrations\Configuration.cs* file.</span><span class="sxs-lookup"><span data-stu-id="44312-136">Open the *ContosoUniversity\Migrations\Configuration.cs* file.</span></span> <span data-ttu-id="44312-137">Analogamente alla classe inizializzatore che hai visto in precedenza, il `Configuration` classe include una `Seed` (metodo).</span><span class="sxs-lookup"><span data-stu-id="44312-137">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="44312-138">Lo scopo del [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) metodo consiste nel consentire di inserire o aggiornare i dati di test dopo Code First crea o aggiorna il database.</span><span class="sxs-lookup"><span data-stu-id="44312-138">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="44312-139">Il metodo viene chiamato quando viene creato il database e ogni volta che viene aggiornato lo schema del database dopo la modifica di un modello di dati.</span><span class="sxs-lookup"><span data-stu-id="44312-139">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="44312-140">Configurare il metodo di inizializzazione</span><span class="sxs-lookup"><span data-stu-id="44312-140">Set up the Seed method</span></span>

<span data-ttu-id="44312-141">Quando si elimina e ricrea il database per ogni modifica del modello di dati, si usa la classe di inizializzatore `Seed` metodo per inserire i dati di test, perché dopo ogni modifica del modello di database viene eliminato e tutti i dati di test viene perso.</span><span class="sxs-lookup"><span data-stu-id="44312-141">When you drop and re-create the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="44312-142">Con migrazioni Code First, test, i dati vengono conservati dopo le modifiche di database, pertanto, inclusi i dati di test nel [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) (metodo) non è in genere necessario.</span><span class="sxs-lookup"><span data-stu-id="44312-142">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="44312-143">Infatti, non si desidera che il `Seed` metodo per inserire i dati di test se si useranno le migrazioni per distribuire il database nell'ambiente di produzione, perché il `Seed` metodo verrà eseguito nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-143">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="44312-144">In tal caso, si desidera che il `Seed` per inserire nel database solo i dati necessari nella produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-144">In that case, you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="44312-145">Ad esempio, è possibile il database da includere i nomi dei reparti effettivo nel `Department` tabella quando l'applicazione diventa disponibile nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-145">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="44312-146">Per questa esercitazione, si useranno le migrazioni per la distribuzione, ma il `Seed` metodo inserirà comunque i dati di test per renderlo più semplice verificare il funzionamento delle funzionalità dell'applicazione senza dover inserire manualmente una grande quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="44312-146">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="44312-147">Sostituire il contenuto di *Configuration.cs* file con il codice seguente, che carica i dati di test nel nuovo database.</span><span class="sxs-lookup"><span data-stu-id="44312-147">Replace the contents of the *Configuration.cs* file with the following code, which loads test data into the new database.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="44312-148">Il [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) accetta l'oggetto di contesto di database come parametro di input e il codice nel metodo Usa l'oggetto per aggiungere nuove entità nel database.</span><span class="sxs-lookup"><span data-stu-id="44312-148">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="44312-149">Per ogni tipo di entità, il codice crea una raccolta di nuove entità, li aggiunge a appropriato [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) proprietà e quindi Salva le modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="44312-149">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="44312-150">Non è necessario chiamare il [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) metodo dopo ogni gruppo di entità, come avviene in questo caso, ma questa operazione consente di individuare l'origine di un problema se si verifica un'eccezione mentre il codice è la scrittura nel database.</span><span class="sxs-lookup"><span data-stu-id="44312-150">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="44312-151">Alcune istruzioni che inseriscono dati usare la [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) metodo per eseguire un'operazione "upsert".</span><span class="sxs-lookup"><span data-stu-id="44312-151">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="44312-152">Poiché il `Seed` metodo viene eseguito ogni volta che si esegue il `update-database` comando, in genere dopo ogni migrazione, non è sufficiente inserire i dati, perché si sta provando ad aggiungere righe saranno già presenti dopo la migrazione prima che crea il database.</span><span class="sxs-lookup"><span data-stu-id="44312-152">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="44312-153">L'operazione "upsert" impedisce gli errori che accadrebbe se si prova a inserire una riga già esistente, ma ***esegue l'override*** eventuali modifiche ai dati apportate durante il test dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-153">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="44312-154">I dati di test in alcune tabelle è possibile evitare di raggiungere tale obiettivo: in alcuni casi quando si modificano i dati durante il test per le proprie modifiche permangono dopo gli aggiornamenti del database.</span><span class="sxs-lookup"><span data-stu-id="44312-154">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="44312-155">In questo caso si vuole eseguire un'operazione di inserimento condizionale: inserire una riga solo se non esiste già.</span><span class="sxs-lookup"><span data-stu-id="44312-155">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="44312-156">Il metodo di inizializzazione Usa entrambi gli approcci.</span><span class="sxs-lookup"><span data-stu-id="44312-156">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="44312-157">Il primo parametro passato per il [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) metodo consente di specificare la proprietà da utilizzare per verificare se esiste già una riga.</span><span class="sxs-lookup"><span data-stu-id="44312-157">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="44312-158">Per i dati degli studenti di test che si desidera fornire, il `LastName` proprietà può essere utilizzata per questo scopo poiché ogni cognome nell'elenco è univoco:</span><span class="sxs-lookup"><span data-stu-id="44312-158">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="44312-159">Questo codice si presuppone che i cognomi univoci.</span><span class="sxs-lookup"><span data-stu-id="44312-159">This code assumes that last names are unique.</span></span> <span data-ttu-id="44312-160">Se si aggiungono manualmente gli studenti il cui cognome duplicato, si otterrà la seguente eccezione la volta successiva che si esegue una migrazione:</span><span class="sxs-lookup"><span data-stu-id="44312-160">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration:</span></span>

    <span data-ttu-id="44312-161">**La sequenza contiene più di un elemento**</span><span class="sxs-lookup"><span data-stu-id="44312-161">**Sequence contains more than one element**</span></span>

    <span data-ttu-id="44312-162">Per informazioni su come gestire i dati ridondanti, ad esempio due studenti denominati "Alexander Carson", vedere [Seeding e al database di debug di Entity Framework (EF)](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) sul blog di Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="44312-162">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="44312-163">Per altre informazioni sul `AddOrUpdate` metodo, vedere [prestare attenzione con metodo AddOrUpdate 4.3 EF](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) sul blog di Julie.</span><span class="sxs-lookup"><span data-stu-id="44312-163">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="44312-164">Il codice che crea `Enrollment` entità si presuppone il `ID` valore nelle entità nel `students` raccolta, anche se si non imposta tale proprietà nel codice che crea la raccolta.</span><span class="sxs-lookup"><span data-stu-id="44312-164">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="44312-165">È possibile usare il `ID` proprietà qui perché il `ID` è impostato quando si chiama `SaveChanges` per il `students` raccolta.</span><span class="sxs-lookup"><span data-stu-id="44312-165">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="44312-166">Entity Framework ottiene automaticamente il valore della chiave primaria quando inserisce un'entità nel database e aggiorna il `ID` proprietà dell'entità in memoria.</span><span class="sxs-lookup"><span data-stu-id="44312-166">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="44312-167">Il codice che aggiunge ognuno `Enrollment` entità per il `Enrollments` set di entità non usa il `AddOrUpdate` (metodo).</span><span class="sxs-lookup"><span data-stu-id="44312-167">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="44312-168">Controlla se esiste già un'entità e inserisce l'entità se non esiste.</span><span class="sxs-lookup"><span data-stu-id="44312-168">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="44312-169">Questo approccio consente di mantenere le modifiche apportate a un livello di registrazione usando l'interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-169">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="44312-170">Il codice scorre in ciclo ogni membro del `Enrollment` [elenco](https://msdn.microsoft.com/library/6sh2ey19.aspx) e se la registrazione non viene trovata nel database, aggiunge la registrazione al database.</span><span class="sxs-lookup"><span data-stu-id="44312-170">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="44312-171">La prima volta che si aggiorna il database, il database sarà vuoto, in modo che verranno aggiunti ogni registrazione.</span><span class="sxs-lookup"><span data-stu-id="44312-171">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. <span data-ttu-id="44312-172">Compilare il progetto.</span><span class="sxs-lookup"><span data-stu-id="44312-172">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="44312-173">Eseguire la migrazione prima</span><span class="sxs-lookup"><span data-stu-id="44312-173">Execute the first migration</span></span>

<span data-ttu-id="44312-174">Quando è stato eseguito il `add-migration` comando, le migrazioni ha generato il codice che comportano la creazione del database da zero.</span><span class="sxs-lookup"><span data-stu-id="44312-174">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="44312-175">Questo codice è disponibile anche nella *migrazioni* cartella, nel file denominato  *&lt;timestamp&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="44312-175">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="44312-176">Il `Up` metodo per il `InitialCreate` classe crea le tabelle di database che corrispondono ai set di entità del modello di dati, e il `Down` li elimina metodo.</span><span class="sxs-lookup"><span data-stu-id="44312-176">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="44312-177">Le migrazioni chiamano il metodo `Up` per implementare le modifiche al modello di dati per una migrazione.</span><span class="sxs-lookup"><span data-stu-id="44312-177">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="44312-178">Quando si immette un comando per annullare l'aggiornamento, le migrazioni chiamano il metodo `Down`.</span><span class="sxs-lookup"><span data-stu-id="44312-178">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="44312-179">Questa è la migrazione iniziale creata al momento dell'immissione di `add-migration InitialCreate` comando.</span><span class="sxs-lookup"><span data-stu-id="44312-179">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="44312-180">Il parametro (`InitialCreate` nell'esempio) viene usato per il file di un nome e può essere qualsiasi elemento; in genere si sceglie una parola o frase che riepiloghi cosa viene fatto nella migrazione.</span><span class="sxs-lookup"><span data-stu-id="44312-180">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="44312-181">Ad esempio, è possibile denominare una migrazione successiva &quot;AddDepartmentTable&quot;.</span><span class="sxs-lookup"><span data-stu-id="44312-181">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="44312-182">Se la migrazione iniziale è stata creata quando il database esisteva già, il codice di creazione del database viene generato ma non è necessario eseguirlo perché il database corrisponde già al modello di dati.</span><span class="sxs-lookup"><span data-stu-id="44312-182">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="44312-183">Quando si distribuisce l'app in un altro ambiente in cui il database non esiste ancora, questo codice verrà eseguito per creare il database, è consigliabile quindi testarlo prima.</span><span class="sxs-lookup"><span data-stu-id="44312-183">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="44312-184">Per tale motivo è stato modificato il nome del database nella stringa di connessione precedentemente&mdash;in modo che le migrazioni possono crearne uno nuovo da zero.</span><span class="sxs-lookup"><span data-stu-id="44312-184">That's why you changed the name of the database in the connection string earlier&mdash;so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="44312-185">Nel **Console di gestione pacchetti** finestra, immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="44312-185">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    <span data-ttu-id="44312-186">Il `update-database` comando esegue il `Up` metodo per creare il database e quindi viene eseguito il `Seed` metodo per popolare il database.</span><span class="sxs-lookup"><span data-stu-id="44312-186">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="44312-187">Lo stesso processo verrà eseguito automaticamente nell'ambiente di produzione dopo aver distribuito l'applicazione, come si vedrà nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="44312-187">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="44312-188">Uso **Esplora Server** per controllare il database come è stato fatto nella prima esercitazione ed eseguire l'applicazione per verificare che tutto funzioni uguale come in precedenza.</span><span class="sxs-lookup"><span data-stu-id="44312-188">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="44312-189">Distribuire in Azure</span><span class="sxs-lookup"><span data-stu-id="44312-189">Deploy to Azure</span></span>

<span data-ttu-id="44312-190">Finora l'applicazione è stata in esecuzione in locale in IIS Express nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="44312-190">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="44312-191">Per renderlo disponibile ad altri utenti per l'utilizzo su Internet, è necessario distribuirla in un provider di hosting web.</span><span class="sxs-lookup"><span data-stu-id="44312-191">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="44312-192">In questa sezione dell'esercitazione, è necessario distribuirlo in Azure.</span><span class="sxs-lookup"><span data-stu-id="44312-192">In this section of the tutorial, you'll deploy it to Azure.</span></span> <span data-ttu-id="44312-193">In questa sezione è facoltativa. è possibile ignorare questo passaggio e continuare con l'esercitazione seguente, oppure è possibile adattare le istruzioni in questa sezione per un provider di hosting diverso di propria scelta.</span><span class="sxs-lookup"><span data-stu-id="44312-193">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="use-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="44312-194">Utilizzare le migrazioni codice prima di distribuire il database</span><span class="sxs-lookup"><span data-stu-id="44312-194">Use Code First migrations to deploy the database</span></span>

<span data-ttu-id="44312-195">Per distribuire il database, si utilizzeranno le migrazioni primo codice.</span><span class="sxs-lookup"><span data-stu-id="44312-195">To deploy the database, you'll use Code First Migrations.</span></span> <span data-ttu-id="44312-196">Quando si crea il profilo di pubblicazione che consente di configurare le impostazioni per la distribuzione da Visual Studio, si selezionano una casella di controllo etichettata **aggiornare il Database**.</span><span class="sxs-lookup"><span data-stu-id="44312-196">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="44312-197">Questa impostazione fa in modo che il processo di distribuzione configurare automaticamente l'applicazione *Web. config* del file nel server di destinazione in modo che usa Code First di `MigrateDatabaseToLatestVersion` classe inizializzatore.</span><span class="sxs-lookup"><span data-stu-id="44312-197">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="44312-198">Visual Studio non esegue alcuna operazione con il database durante il processo di distribuzione mentre si sta copiando il progetto nel server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="44312-198">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="44312-199">Quando si esegue l'applicazione distribuita e accede al database per la prima volta dopo la distribuzione, Code First controlla se il database corrisponde al modello di dati.</span><span class="sxs-lookup"><span data-stu-id="44312-199">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="44312-200">Se è presente una mancata corrispondenza, Code First crea automaticamente il database (se non esiste ancora) o ne aggiorna lo schema del database alla versione più recente (se un database esiste ma non corrisponda al modello).</span><span class="sxs-lookup"><span data-stu-id="44312-200">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="44312-201">Se l'applicazione implementa un migrazioni `Seed` metodo, l'esecuzione del metodo dopo la creazione del database o lo schema viene aggiornato.</span><span class="sxs-lookup"><span data-stu-id="44312-201">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="44312-202">Le migrazioni `Seed` metodo inserisce i dati di test.</span><span class="sxs-lookup"><span data-stu-id="44312-202">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="44312-203">Se si distribuisse un ambiente di produzione, è necessario modificare il `Seed` metodo in modo che non solo inserisce i dati che si desidera essere inseriti nel database di produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-203">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="44312-204">Ad esempio, il modello di dati corrente è consigliabile avere corsi reali ma fittizi studenti nel database di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="44312-204">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="44312-205">È possibile scrivere un `Seed` metodo caricare entrambi in fase di sviluppo e quindi impostare come commento fittizi studenti prima di distribuire nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="44312-205">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="44312-206">In alternativa è possibile scrivere un `Seed` metodo per caricare solo i corsi e immettere gli studenti fittizi nel database di test manualmente tramite interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-206">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="44312-207">Creare un account Azure</span><span class="sxs-lookup"><span data-stu-id="44312-207">Get an Azure account</span></span>

<span data-ttu-id="44312-208">È necessario un account Azure.</span><span class="sxs-lookup"><span data-stu-id="44312-208">You'll need an Azure account.</span></span> <span data-ttu-id="44312-209">Se si ha già uno, ma si dispone di una sottoscrizione di Visual Studio, puoi [attivare i benefici della sottoscrizione](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span><span class="sxs-lookup"><span data-stu-id="44312-209">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span></span> <span data-ttu-id="44312-210">In caso contrario, è possibile creare un account di valutazione gratuito in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="44312-210">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="44312-211">Per informazioni dettagliate, vedere [versione di valutazione gratuita di Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="44312-211">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="44312-212">Creare un sito web e un database SQL in Azure</span><span class="sxs-lookup"><span data-stu-id="44312-212">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="44312-213">L'app web in Azure verrà eseguito in un ambiente di hosting condiviso, ovvero che viene eseguito in macchine virtuali (VM) che vengono condivisi con altri client di Azure.</span><span class="sxs-lookup"><span data-stu-id="44312-213">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="44312-214">Un ambiente di hosting condiviso è un modo economico per iniziare a usare nel cloud.</span><span class="sxs-lookup"><span data-stu-id="44312-214">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="44312-215">In un secondo momento, se l'incremento del traffico web, la scalabilità per soddisfare le esigenze tramite l'esecuzione in macchine virtuali dedicate.</span><span class="sxs-lookup"><span data-stu-id="44312-215">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="44312-216">Per ulteriori informazioni sulle opzioni di prezzi per il servizio di applicazione Azure, Leggi [servizio App prezzi](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="44312-216">To learn more about Pricing Options for Azure App Service, read [App Service pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<span data-ttu-id="44312-217">Distribuire il database al database SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="44312-217">You'll deploy the database to Azure SQL database.</span></span> <span data-ttu-id="44312-218">Database SQL è un servizio di database relazionali basati su cloud che si basa su tecnologie di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="44312-218">SQL database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="44312-219">Strumenti e applicazioni che utilizzano SQL Server funzionano anche con database SQL.</span><span class="sxs-lookup"><span data-stu-id="44312-219">Tools and applications that work with SQL Server also work with SQL database.</span></span>

1. <span data-ttu-id="44312-220">Nella [portale di gestione Azure](https://portal.azure.com), scegliere **creare una risorsa** sinistra scheda e quindi scegliere **tutti** sulla **nuovo** riquadro (o *blade*) per visualizzare tutte le risorse disponibili.</span><span class="sxs-lookup"><span data-stu-id="44312-220">In the [Azure Management Portal](https://portal.azure.com), choose **Create a resource** in the left tab and then choose **See all** on the **New** pane (or *blade*) to see all available resources.</span></span> <span data-ttu-id="44312-221">Scegliere **Web App + SQL** nel **Web** sezione di **tutto** blade.</span><span class="sxs-lookup"><span data-stu-id="44312-221">Choose **Web App + SQL** in the **Web** section of the **Everything** blade.</span></span> <span data-ttu-id="44312-222">Infine, scegliere **crea**.</span><span class="sxs-lookup"><span data-stu-id="44312-222">Finally, choose **Create**.</span></span>

    ![Creare una risorsa nel portale di Azure](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   <span data-ttu-id="44312-224">Il modulo per creare un nuovo **nuova Web App + SQL** verrà visualizzata la risorsa.</span><span class="sxs-lookup"><span data-stu-id="44312-224">The form to create a new **New Web App + SQL** resource opens.</span></span>

2. <span data-ttu-id="44312-225">Immettere una stringa di **nome App** casella per utilizzare come URL univoco per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-225">Enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="44312-226">L'URL completo sarà costituito da quanto immesso in questo caso oltre il dominio predefinito dei servizi App di Azure (. azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="44312-226">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="44312-227">Se il **nome App** è già utilizzato, la procedura guidata segnala con un colore rosso *il nome dell'applicazione non è disponibile* messaggio.</span><span class="sxs-lookup"><span data-stu-id="44312-227">If the **App name** is already taken, the Wizard notifies you with a red *The app name is not available* message.</span></span> <span data-ttu-id="44312-228">Se il **nome applicazione** è disponibile, viene visualizzato un segno di spunta verde.</span><span class="sxs-lookup"><span data-stu-id="44312-228">If the **App name** is available, you see a green checkmark.</span></span>

3. <span data-ttu-id="44312-229">Nella **sottoscrizione** la sottoscrizione di Azure in cui si desidera scegliere di **servizio App** collocare.</span><span class="sxs-lookup"><span data-stu-id="44312-229">In the **Subscription** box, choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="44312-230">Nel **gruppo di risorse** casella di testo, scegliere un gruppo di risorse o crearne uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="44312-230">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="44312-231">Questa impostazione specifica il sito web verrà eseguito in quale data center.</span><span class="sxs-lookup"><span data-stu-id="44312-231">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="44312-232">Per ulteriori informazioni sui gruppi di risorse, vedere [gruppi di risorse](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="44312-232">For more information about Resource Groups, see [Resource groups](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>

5. <span data-ttu-id="44312-233">Creare un nuovo **piano di servizio App** facendo clic il *sezione del servizio App*, **Crea nuovo**, quindi compilare **piano di servizio App** (può essere stesso nome Servizio App), **ubicazione**, e **tariffario** (è disponibile un'opzione gratuita).</span><span class="sxs-lookup"><span data-stu-id="44312-233">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

6. <span data-ttu-id="44312-234">Fare clic su **Database SQL**, quindi scegliere **creare un nuovo database** o selezionare un database esistente.</span><span class="sxs-lookup"><span data-stu-id="44312-234">Click **SQL Database**, and then choose **Create a new database** or select an existing database.</span></span>

7. <span data-ttu-id="44312-235">Nel **nome** immettere un nome per il database.</span><span class="sxs-lookup"><span data-stu-id="44312-235">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="44312-236">Scegliere la **Server di destinazione** e quindi selezionare **creare un nuovo server**.</span><span class="sxs-lookup"><span data-stu-id="44312-236">Click the **Target Server** box, and then select **Create a new server**.</span></span> <span data-ttu-id="44312-237">In alternativa, se è stato creato un server, è possibile selezionare quel server dall'elenco dei server disponibili.</span><span class="sxs-lookup"><span data-stu-id="44312-237">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="44312-238">Scegli **piano tariffario** keychains *gratuito*.</span><span class="sxs-lookup"><span data-stu-id="44312-238">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="44312-239">Se sono necessarie risorse aggiuntive, il database può essere aumentato in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="44312-239">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="44312-240">Per ulteriori informazioni sui prezzi di SQL Azure, vedere [Database SQL Azure prezzi](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="44312-240">To learn more on Azure SQL Pricing, see [Azure SQL Database pricing](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
10. <span data-ttu-id="44312-241">Modificare [regole di confronto](/sql/relational-databases/collations/collation-and-unicode-support) in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="44312-241">Modify [collation](/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="44312-242">Immettere un amministratore **nome utente amministratore SQL** e **Password amministratore SQL**.</span><span class="sxs-lookup"><span data-stu-id="44312-242">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span>

   - <span data-ttu-id="44312-243">Se si seleziona **Nuovo Database di SQL server**, definire un nuovo nome e una password che verranno utilizzati in un secondo momento quando si accede al database.</span><span class="sxs-lookup"><span data-stu-id="44312-243">If you selected **New SQL Database server**, define a new name and password that you'll use later when you access the database.</span></span>
   - <span data-ttu-id="44312-244">Se si seleziona un server che è stato creato in precedenza, immettere le credenziali per il server.</span><span class="sxs-lookup"><span data-stu-id="44312-244">If you selected a server that you created previously, enter credentials for that server.</span></span>

12. <span data-ttu-id="44312-245">Raccolta di dati di telemetria può essere abilitata per il servizio App con Application Insights.</span><span class="sxs-lookup"><span data-stu-id="44312-245">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="44312-246">Con alcune operazioni di configurazione applicazione approfondimenti raccoglie eventi importanti, eccezioni, dipendenza, richiesta e le informazioni di traccia.</span><span class="sxs-lookup"><span data-stu-id="44312-246">With little configuration, Application Insights collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="44312-247">Per ulteriori informazioni dagli esperti dell'applicazione, vedere [Monitor Azure](https://azure.microsoft.com/services/monitor/).</span><span class="sxs-lookup"><span data-stu-id="44312-247">To learn more about Application Insights, see [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span></span>
13. <span data-ttu-id="44312-248">Fare clic su **crea** nella parte inferiore per indicare che è terminato.</span><span class="sxs-lookup"><span data-stu-id="44312-248">Click **Create** at the bottom to indicate that you're finished.</span></span>

    <span data-ttu-id="44312-249">Portale di gestione restituisce alla pagina del Dashboard e la **notifiche** area nella parte superiore della pagina indica che il sito viene creato.</span><span class="sxs-lookup"><span data-stu-id="44312-249">The Management Portal returns to the Dashboard page, and the **Notifications** area at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="44312-250">Dopo un certo tempo (in genere inferiore a un minuto), vi è una notifica che la distribuzione completata.</span><span class="sxs-lookup"><span data-stu-id="44312-250">After a while (typically less than a minute), there's a notification that the Deployment succeeded.</span></span> <span data-ttu-id="44312-251">Nella barra di navigazione a sinistra, viene visualizzato il nuovo servizio App nel **servizi di applicazione** sezione e il nuovo database SQL viene visualizzata nella **database SQL** sezione.</span><span class="sxs-lookup"><span data-stu-id="44312-251">In the navigation bar at the left, the new App Service appears in the **App Services** section and the new SQL database appears in the **SQL databases** section.</span></span>

### <a name="deploy-the-app-to-azure"></a><span data-ttu-id="44312-252">Distribuire l'app in Azure</span><span class="sxs-lookup"><span data-stu-id="44312-252">Deploy the app to Azure</span></span>

1. <span data-ttu-id="44312-253">In Visual Studio, fare clic sul progetto in **Esplora soluzioni** e selezionare **Publish** dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="44312-253">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

2. <span data-ttu-id="44312-254">Nella **scegliete una destinazione di pubblicazione** , selezionare **servizio App** e quindi **selezionare esistente**e quindi scegliere **pubblica**.</span><span class="sxs-lookup"><span data-stu-id="44312-254">On the **Pick a publish target** page, choose **App Service** and then **Select Existing**, and then choose **Publish**.</span></span>

    ![Scegliete una pagina di destinazione di pubblicazione](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. <span data-ttu-id="44312-256">Se in precedenza, non sono stati aggiunti l'abbonamento Azure in Visual Studio, eseguire la procedura sullo schermo.</span><span class="sxs-lookup"><span data-stu-id="44312-256">If you haven't previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="44312-257">Questi passaggi abilitano Visual Studio per connettersi alla sottoscrizione di Azure in modo che l'elenco delle **servizi App** includerà il sito web.</span><span class="sxs-lookup"><span data-stu-id="44312-257">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>

4. <span data-ttu-id="44312-258">Nella **servizio App** pagina, selezionare il **sottoscrizione** aggiunto il servizio di applicazione per.</span><span class="sxs-lookup"><span data-stu-id="44312-258">On the **App Service** page, select the **Subscription** you added the App Service to.</span></span> <span data-ttu-id="44312-259">In **vista**, selezionare **gruppo di risorse**.</span><span class="sxs-lookup"><span data-stu-id="44312-259">Under **View**, select **Resource Group**.</span></span> <span data-ttu-id="44312-260">Espandere il gruppo di risorse per che è stato aggiunto il servizio di applicazione e quindi selezionare il servizio di applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-260">Expand the resource group you added the App Service to, and then select the App Service.</span></span> <span data-ttu-id="44312-261">Scegliere **OK** per pubblicare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="44312-261">Choose **OK** to publish the app.</span></span>

5. <span data-ttu-id="44312-262">Il **Output** finestra Mostra le azioni di distribuzione sono state eseguite e segnalato il corretto completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="44312-262">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>

6. <span data-ttu-id="44312-263">Al termine della distribuzione, il browser predefinito viene aperto automaticamente per l'URL del sito web distribuito.</span><span class="sxs-lookup"><span data-stu-id="44312-263">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    <span data-ttu-id="44312-265">L'applicazione è in esecuzione nel cloud.</span><span class="sxs-lookup"><span data-stu-id="44312-265">Your app is now running in the cloud.</span></span>

<span data-ttu-id="44312-266">A questo punto, il *SchoolContext* database è stato creato nel database SQL Azure è stato selezionato **eseguire codice prima le migrazioni (viene eseguito all'avvio di app)**.</span><span class="sxs-lookup"><span data-stu-id="44312-266">At this point, the *SchoolContext* database has been created in the Azure SQL database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="44312-267">Il *Web. config* file nel sito web distribuito è stato modificato in modo che le [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) inizializzatore viene eseguita la prima volta il codice legge o scrive dati nel database (che si sono verificati Se è selezionata la **studenti** scheda):</span><span class="sxs-lookup"><span data-stu-id="44312-267">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![Frammento di file Web. config](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="44312-269">Il processo di distribuzione creata anche una nuova stringa di connessione *(SchoolContext\_DatabasePublish*) per le migrazioni Code First da utilizzare per l'aggiornamento dello schema del database e il seeding del database.</span><span class="sxs-lookup"><span data-stu-id="44312-269">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Stringa di connessione nel file Web. config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="44312-271">È possibile trovare la versione distribuita del file Web. config nel computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. È possibile accedere a distribuito *Web. config* file tramite FTP.</span><span class="sxs-lookup"><span data-stu-id="44312-271">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="44312-272">Per istruzioni, vedere [distribuzione Web ASP.NET tramite Visual Studio: Distribuzione di un aggiornamento del codice](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span><span class="sxs-lookup"><span data-stu-id="44312-272">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="44312-273">Seguire le istruzioni che iniziano con "per usare uno strumento FTP, sono necessarie tre cose: l'URL di FTP, il nome utente e la password."</span><span class="sxs-lookup"><span data-stu-id="44312-273">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="44312-274">L'app web non implementa la sicurezza, in modo che chiunque individui l'URL può modificare i dati.</span><span class="sxs-lookup"><span data-stu-id="44312-274">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="44312-275">Per istruzioni su come proteggere il sito web, vedere [distribuire un'applicazione MVC ASP.NET protetta con i database di appartenenza, OAuth e SQL Azure](/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="44312-275">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL database to Azure](/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="44312-276">È possibile impedire che altri utenti tramite il sito interrompendo il servizio tramite il portale di gestione di Azure o **Esplora Server** in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="44312-276">You can prevent other people from using the site by stopping the service using the Azure Management Portal or **Server Explorer** in Visual Studio.</span></span>

![Interrompere una voce di menu dell'applicazione del servizio](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="44312-278">Scenari avanzati di migrazioni</span><span class="sxs-lookup"><span data-stu-id="44312-278">Advanced migrations scenarios</span></span>

<span data-ttu-id="44312-279">Se si distribuisce un database, eseguire le migrazioni automaticamente come illustrato in questa esercitazione e si distribuisce in un sito web che viene eseguito su più server, è possibile ottenere più server si prova a eseguire le migrazioni nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="44312-279">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="44312-280">Le migrazioni sono atomiche, in modo che se due server prova a eseguire la migrazione, uno avrà esito positivo e l'altra avrà esito negativo (presupponendo che le operazioni non è possibile eseguire due volte).</span><span class="sxs-lookup"><span data-stu-id="44312-280">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="44312-281">In questo scenario se si desidera evitare questi problemi, è possibile chiamare manualmente le migrazioni e configurare il proprio codice in modo che il problema interessa solo una volta.</span><span class="sxs-lookup"><span data-stu-id="44312-281">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="44312-282">Per ulteriori informazioni, vedere [in esecuzione e le migrazioni di Scripting da codice](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) sul blog del Miller Rowan e [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (per l'esecuzione di migrazioni dalla riga di comando).</span><span class="sxs-lookup"><span data-stu-id="44312-282">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (for executing migrations from the command line).</span></span>

<span data-ttu-id="44312-283">Per informazioni su altri scenari di migrazione, vedere [migrazioni Screencast serie](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span><span class="sxs-lookup"><span data-stu-id="44312-283">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="44312-284">Inizializzatori di primo codice</span><span class="sxs-lookup"><span data-stu-id="44312-284">Code First initializers</span></span>

<span data-ttu-id="44312-285">Nella sezione distribuzione, si è visto la [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) inizializzatore in uso.</span><span class="sxs-lookup"><span data-stu-id="44312-285">In the deployment section, you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="44312-286">Codice prima di tutto fornisce anche altri inizializzatori, tra cui [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (impostazione predefinita), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (che è utilizzata in precedenza) e [ DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="44312-286">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="44312-287">Il `DropCreateAlways` inizializzatore può essere utile per impostare le condizioni per gli unit test.</span><span class="sxs-lookup"><span data-stu-id="44312-287">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="44312-288">È anche possibile scrivere i propri inizializzatori ed è possibile chiamare un inizializzatore in modo esplicito, se non si vuole attendere fino a quando l'applicazione legge o scrive nel database.</span><span class="sxs-lookup"><span data-stu-id="44312-288">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span>

<span data-ttu-id="44312-289">Per altre informazioni sugli inizializzatori, vedere [Understanding inizializzatori di Database in Code First di Entity Framework](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) e il capitolo 6 del libro [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) da Julie Lerman e Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="44312-289">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="get-the-code"></a><span data-ttu-id="44312-290">Ottenere il codice</span><span class="sxs-lookup"><span data-stu-id="44312-290">Get the code</span></span>

[<span data-ttu-id="44312-291">Scaricare il progetto completato</span><span class="sxs-lookup"><span data-stu-id="44312-291">Download the Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="44312-292">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="44312-292">Additional resources</span></span>

<span data-ttu-id="44312-293">Collegamenti ad altre risorse di Entity Framework sono disponibili nel [l'accesso ai dati ASP.NET - risorse consigliate](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="44312-293">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

## <a name="next-steps"></a><span data-ttu-id="44312-294">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="44312-294">Next steps</span></span>

<span data-ttu-id="44312-295">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="44312-295">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="44312-296">Abilitato migrazioni Code First</span><span class="sxs-lookup"><span data-stu-id="44312-296">Enabled Code First migrations</span></span>
> * <span data-ttu-id="44312-297">Distribuzione dell'app in Azure (facoltativo)</span><span class="sxs-lookup"><span data-stu-id="44312-297">Deployed the app in Azure (optional)</span></span>

<span data-ttu-id="44312-298">Passare all'articolo successivo per informazioni su come creare un modello di dati più complesso per un'applicazione ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="44312-298">Advance to the next article to learn how to create a more complex data model for an ASP.NET MVC Application.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="44312-299">Creare un modello di dati più complesso</span><span class="sxs-lookup"><span data-stu-id="44312-299">Create a more complex data model</span></span>](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)
