---
uid: mvc/overview/getting-started/database-first-development/enhancing-data-validation
title: "Esercitazione: migliorare la convalida dei dati per Database First EF con l'app MVC ASP.NET"
description: Questa esercitazione è incentrata sull'aggiunta di annotazioni di dati al modello di dati per specificare i requisiti di convalida e la formattazione della visualizzazione.
author: Rick-Anderson
ms.author: riande
ms.date: 01/28/2019
ms.topic: tutorial
ms.assetid: 0ed5e67a-34c0-4b57-84a6-802b0fb3cd00
msc.legacyurl: /mvc/overview/getting-started/database-first-development/enhancing-data-validation
msc.type: authoredcontent
ms.openlocfilehash: 897cd7c6a40445e2a4abede50d81e101372d3233
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78616277"
---
# <a name="tutorial-enhance-data-validation-for-ef-database-first-with-aspnet-mvc-app"></a><span data-ttu-id="74a3a-103">Esercitazione: migliorare la convalida dei dati per Database First EF con l'app MVC ASP.NET</span><span class="sxs-lookup"><span data-stu-id="74a3a-103">Tutorial: Enhance data validation for EF Database First with ASP.NET MVC app</span></span>

<span data-ttu-id="74a3a-104">Usando l'impalcatura MVC, Entity Framework e ASP.NET, è possibile creare un'applicazione Web che fornisce un'interfaccia a un database esistente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-104">Using MVC, Entity Framework, and ASP.NET Scaffolding, you can create a web application that provides an interface to an existing database.</span></span> <span data-ttu-id="74a3a-105">Questa serie di esercitazioni illustra come generare automaticamente il codice che consente agli utenti di visualizzare, modificare, creare ed eliminare dati che si trovano in una tabella di database.</span><span class="sxs-lookup"><span data-stu-id="74a3a-105">This tutorial series shows you how to automatically generate code that enables users to display, edit, create, and delete data that resides in a database table.</span></span> <span data-ttu-id="74a3a-106">Il codice generato corrisponde alle colonne nella tabella di database.</span><span class="sxs-lookup"><span data-stu-id="74a3a-106">The generated code corresponds to the columns in the database table.</span></span>

<span data-ttu-id="74a3a-107">Questa esercitazione è incentrata sull'aggiunta di annotazioni di dati al modello di dati per specificare i requisiti di convalida e la formattazione della visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="74a3a-107">This tutorial focuses on adding data annotations to the data model to specify validation requirements and display formatting.</span></span> <span data-ttu-id="74a3a-108">È stato migliorato in base ai commenti e suggerimenti degli utenti nella sezione dei commenti.</span><span class="sxs-lookup"><span data-stu-id="74a3a-108">It was improved based on feedback from users in the comments section.</span></span>

<span data-ttu-id="74a3a-109">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="74a3a-109">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="74a3a-110">Aggiungi annotazioni dati</span><span class="sxs-lookup"><span data-stu-id="74a3a-110">Add data annotations</span></span>
> * <span data-ttu-id="74a3a-111">Aggiungi classi di metadati</span><span class="sxs-lookup"><span data-stu-id="74a3a-111">Add metadata classes</span></span>

## <a name="prerequisites"></a><span data-ttu-id="74a3a-112">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="74a3a-112">Prerequisites</span></span>

* [<span data-ttu-id="74a3a-113">Personalizzare una vista</span><span class="sxs-lookup"><span data-stu-id="74a3a-113">Customize a view</span></span>](customizing-a-view.md)

## <a name="add-data-annotations"></a><span data-ttu-id="74a3a-114">Aggiungi annotazioni dati</span><span class="sxs-lookup"><span data-stu-id="74a3a-114">Add data annotations</span></span>

<span data-ttu-id="74a3a-115">Come si è visto in un argomento precedente, alcune regole di convalida dei dati vengono applicate automaticamente all'input dell'utente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-115">As you saw in an earlier topic, some data validation rules are automatically applied to the user input.</span></span> <span data-ttu-id="74a3a-116">Ad esempio, è possibile specificare solo un numero per la proprietà Grade.</span><span class="sxs-lookup"><span data-stu-id="74a3a-116">For example, you can only provide a number for the Grade property.</span></span> <span data-ttu-id="74a3a-117">Per specificare più regole di convalida dei dati, è possibile aggiungere annotazioni di dati alla classe del modello.</span><span class="sxs-lookup"><span data-stu-id="74a3a-117">To specify more data validation rules, you can add data annotations to your model class.</span></span> <span data-ttu-id="74a3a-118">Queste annotazioni vengono applicate nell'applicazione Web per la proprietà specificata.</span><span class="sxs-lookup"><span data-stu-id="74a3a-118">These annotations are applied throughout your web application for the specified property.</span></span> <span data-ttu-id="74a3a-119">È anche possibile applicare attributi di formattazione che modificano la modalità di visualizzazione delle proprietà. ad esempio, modificando il valore utilizzato per le etichette di testo.</span><span class="sxs-lookup"><span data-stu-id="74a3a-119">You can also apply formatting attributes that change how the properties are displayed; such as, changing the value used for text labels.</span></span>

<span data-ttu-id="74a3a-120">In questa esercitazione vengono aggiunte le annotazioni dei dati per limitare la lunghezza dei valori specificati per le proprietà FirstName, LastName e MiddleName.</span><span class="sxs-lookup"><span data-stu-id="74a3a-120">In this tutorial, you will add data annotations to restrict the length of the values provided for the FirstName, LastName, and MiddleName properties.</span></span> <span data-ttu-id="74a3a-121">Nel database, questi valori sono limitati a 50 caratteri; nell'applicazione Web, tuttavia, non è attualmente applicato il limite di caratteri.</span><span class="sxs-lookup"><span data-stu-id="74a3a-121">In the database, these values are limited to 50 characters; however, in your web application that character limit is currently not enforced.</span></span> <span data-ttu-id="74a3a-122">Se un utente fornisce più di 50 caratteri per uno di questi valori, la pagina si arresterà in modo anomalo durante il tentativo di salvataggio del valore nel database.</span><span class="sxs-lookup"><span data-stu-id="74a3a-122">If a user provides more than 50 characters for one of those values, the page will crash when attempting to save the value to the database.</span></span> <span data-ttu-id="74a3a-123">Si limiterà anche la classificazione dei valori compresi tra 0 e 4.</span><span class="sxs-lookup"><span data-stu-id="74a3a-123">You will also restrict Grade to values between 0 and 4.</span></span>

<span data-ttu-id="74a3a-124">Selezionare **modelli** > **ContosoModel. edmx** > **ContosoModel.tt** e aprire il file *Student.cs* .</span><span class="sxs-lookup"><span data-stu-id="74a3a-124">Select **Models** > **ContosoModel.edmx** > **ContosoModel.tt** and open the *Student.cs* file.</span></span> <span data-ttu-id="74a3a-125">Aggiungere il codice evidenziato seguente alla classe.</span><span class="sxs-lookup"><span data-stu-id="74a3a-125">Add the following highlighted code to the class.</span></span>

[!code-csharp[Main](enhancing-data-validation/samples/sample1.cs?highlight=5,15,17,20)]

<span data-ttu-id="74a3a-126">Aprire *Enrollment.cs* e aggiungere il codice evidenziato seguente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-126">Open *Enrollment.cs* and add the following highlighted code.</span></span>

[!code-csharp[Main](enhancing-data-validation/samples/sample2.cs?highlight=5,10)]

<span data-ttu-id="74a3a-127">Compilare la soluzione.</span><span class="sxs-lookup"><span data-stu-id="74a3a-127">Build the solution.</span></span>

<span data-ttu-id="74a3a-128">Fare clic su **elenco di studenti** e selezionare **modifica**.</span><span class="sxs-lookup"><span data-stu-id="74a3a-128">Click **List of students** and select **Edit**.</span></span> <span data-ttu-id="74a3a-129">Se si tenta di immettere più di 50 caratteri, viene visualizzato un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="74a3a-129">If you attempt to enter more than 50 characters, an error message is displayed.</span></span>

![Mostra messaggio di errore](enhancing-data-validation/_static/image1.png)

<span data-ttu-id="74a3a-131">Tornare alla home page.</span><span class="sxs-lookup"><span data-stu-id="74a3a-131">Go back to the home page.</span></span> <span data-ttu-id="74a3a-132">Fare clic su **elenco di registrazioni** e selezionare **modifica**.</span><span class="sxs-lookup"><span data-stu-id="74a3a-132">Click **List of enrollments** and select **Edit**.</span></span> <span data-ttu-id="74a3a-133">Tentativo di fornire un livello superiore a 4.</span><span class="sxs-lookup"><span data-stu-id="74a3a-133">Attempt to provide a grade above 4.</span></span> <span data-ttu-id="74a3a-134">Verrà visualizzato questo errore: *il livello di campo deve essere compreso tra 0 e 4.*</span><span class="sxs-lookup"><span data-stu-id="74a3a-134">You will receive this error: *The field Grade must be between 0 and 4.*</span></span>

## <a name="add-metadata-classes"></a><span data-ttu-id="74a3a-135">Aggiungi classi di metadati</span><span class="sxs-lookup"><span data-stu-id="74a3a-135">Add metadata classes</span></span>

<span data-ttu-id="74a3a-136">L'aggiunta di attributi di convalida direttamente alla classe del modello funziona quando non si prevede che il database venga modificato. Tuttavia, se il database viene modificato ed è necessario rigenerare la classe del modello, si perderanno tutti gli attributi applicati alla classe del modello.</span><span class="sxs-lookup"><span data-stu-id="74a3a-136">Adding the validation attributes directly to the model class works when you do not expect the database to change; however, if your database changes and you need to regenerate the model class, you will lose all of the attributes you had applied to the model class.</span></span> <span data-ttu-id="74a3a-137">Questo approccio può essere estremamente inefficiente e soggetto alla perdita di importanti regole di convalida.</span><span class="sxs-lookup"><span data-stu-id="74a3a-137">This approach can be very inefficient and prone to losing important validation rules.</span></span>

<span data-ttu-id="74a3a-138">Per evitare questo problema, è possibile aggiungere una classe di metadati che contiene gli attributi.</span><span class="sxs-lookup"><span data-stu-id="74a3a-138">To avoid this problem, you can add a metadata class that contains the attributes.</span></span> <span data-ttu-id="74a3a-139">Quando si associa la classe del modello alla classe di metadati, gli attributi vengono applicati al modello.</span><span class="sxs-lookup"><span data-stu-id="74a3a-139">When you associate the model class to the metadata class, those attributes are applied to the model.</span></span> <span data-ttu-id="74a3a-140">In questo approccio, la classe del modello può essere rigenerata senza perdere tutti gli attributi applicati alla classe di metadati.</span><span class="sxs-lookup"><span data-stu-id="74a3a-140">In this approach, the model class can be regenerated without losing all of the attributes that have been applied to the metadata class.</span></span>

<span data-ttu-id="74a3a-141">Nella cartella **Models** aggiungere una classe denominata *Metadata.cs*.</span><span class="sxs-lookup"><span data-stu-id="74a3a-141">In the **Models** folder, add a class named *Metadata.cs*.</span></span>

<span data-ttu-id="74a3a-142">Sostituire il codice in *Metadata.cs* con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-142">Replace the code in *Metadata.cs* with the following code.</span></span>

[!code-csharp[Main](enhancing-data-validation/samples/sample3.cs)]

<span data-ttu-id="74a3a-143">Queste classi di metadati contengono tutti gli attributi di convalida applicati in precedenza alle classi del modello.</span><span class="sxs-lookup"><span data-stu-id="74a3a-143">These metadata classes contain all of the validation attributes that you had previously applied to the model classes.</span></span> <span data-ttu-id="74a3a-144">L'attributo **display** viene usato per modificare il valore usato per le etichette di testo.</span><span class="sxs-lookup"><span data-stu-id="74a3a-144">The **Display** attribute is used to change the value used for text labels.</span></span>

<span data-ttu-id="74a3a-145">A questo punto, è necessario associare le classi del modello alle classi di metadati.</span><span class="sxs-lookup"><span data-stu-id="74a3a-145">Now, you must associate the model classes with the metadata classes.</span></span>

<span data-ttu-id="74a3a-146">Nella cartella **Models** aggiungere una classe denominata *PartialClasses.cs*.</span><span class="sxs-lookup"><span data-stu-id="74a3a-146">In the **Models** folder, add a class named *PartialClasses.cs*.</span></span>

<span data-ttu-id="74a3a-147">Sostituire il contenuto del file con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-147">Replace the contents of the file with the following code.</span></span>

[!code-csharp[Main](enhancing-data-validation/samples/sample4.cs)]

<span data-ttu-id="74a3a-148">Si noti che ogni classe è contrassegnata come classe `partial` e ogni classe corrisponde al nome e allo spazio dei nomi della classe generata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-148">Notice that each class is marked as a `partial` class, and each matches the name and namespace as the class that is automatically generated.</span></span> <span data-ttu-id="74a3a-149">Applicando l'attributo Metadata alla classe parziale, è necessario assicurarsi che gli attributi di convalida dei dati vengano applicati alla classe generata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="74a3a-149">By applying the metadata attribute to the partial class, you ensure that the data validation attributes will be applied to the automatically-generated class.</span></span> <span data-ttu-id="74a3a-150">Questi attributi non andranno perduti quando si rigenerano le classi del modello perché l'attributo dei metadati viene applicato nelle classi parziali che non vengono rigenerate.</span><span class="sxs-lookup"><span data-stu-id="74a3a-150">These attributes will not be lost when you regenerate the model classes because the metadata attribute is applied in partial classes that are not regenerated.</span></span>

<span data-ttu-id="74a3a-151">Per rigenerare le classi generate automaticamente, aprire il file *ContosoModel. edmx* .</span><span class="sxs-lookup"><span data-stu-id="74a3a-151">To regenerate the automatically-generated classes, open the *ContosoModel.edmx* file.</span></span> <span data-ttu-id="74a3a-152">Ancora una volta, fare clic con il pulsante destro del mouse sull'area di progettazione e scegliere **Aggiorna modello da database**.</span><span class="sxs-lookup"><span data-stu-id="74a3a-152">Once again, right-click on the design surface and select **Update Model from Database**.</span></span> <span data-ttu-id="74a3a-153">Anche se il database non è stato modificato, questo processo rigenererà le classi.</span><span class="sxs-lookup"><span data-stu-id="74a3a-153">Even though you have not changed the database, this process will regenerate the classes.</span></span> <span data-ttu-id="74a3a-154">Nella scheda **Aggiorna** selezionare **tabelle** e **fine**.</span><span class="sxs-lookup"><span data-stu-id="74a3a-154">In the **Refresh** tab, select **Tables** and **Finish**.</span></span>

<span data-ttu-id="74a3a-155">Salvare il file *ContosoModel. edmx* per applicare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="74a3a-155">Save the *ContosoModel.edmx* file to apply the changes.</span></span>

<span data-ttu-id="74a3a-156">Aprire il file *Student.cs* o *Enrollment.cs* e notare che gli attributi di convalida dei dati applicati in precedenza non sono più nel file.</span><span class="sxs-lookup"><span data-stu-id="74a3a-156">Open the *Student.cs* file or the *Enrollment.cs* file, and notice that the data validation attributes you applied earlier are no longer in the file.</span></span> <span data-ttu-id="74a3a-157">Tuttavia, eseguire l'applicazione e notare che le regole di convalida vengono comunque applicate quando si immettono dati.</span><span class="sxs-lookup"><span data-stu-id="74a3a-157">However, run the application, and notice that the validation rules are still applied when you enter data.</span></span>

## <a name="conclusion"></a><span data-ttu-id="74a3a-158">Conclusione</span><span class="sxs-lookup"><span data-stu-id="74a3a-158">Conclusion</span></span>

<span data-ttu-id="74a3a-159">Questa serie ha fornito un semplice esempio di come generare codice da un database esistente che consente agli utenti di modificare, aggiornare, creare ed eliminare dati.</span><span class="sxs-lookup"><span data-stu-id="74a3a-159">This series provided a simple example of how to generate code from an existing database that enables users to edit, update, create and delete data.</span></span> <span data-ttu-id="74a3a-160">Per creare il progetto, è stato usato ASP.NET MVC 5, Entity Framework e l'impalcatura di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="74a3a-160">It used ASP.NET MVC 5, Entity Framework and ASP.NET Scaffolding to create the project.</span></span> 

<span data-ttu-id="74a3a-161">Per un esempio introduttivo di sviluppo Code First, vedere [Introduzione con ASP.NET MVC 5](../introduction/getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="74a3a-161">For an introductory example of Code First development, see [Getting Started with ASP.NET MVC 5](../introduction/getting-started.md).</span></span> 

<span data-ttu-id="74a3a-162">Per un esempio più avanzato, vedere la pagina relativa alla [creazione di un modello di dati Entity Framework per un'App ASP.NET MVC 4](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="74a3a-162">For a more advanced example, see [Creating an Entity Framework Data Model for an ASP.NET MVC 4 App](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="74a3a-163">Si noti che l'API DbContext usata per lavorare con i dati in Database First è identica a quella usata per l'utilizzo dei dati in Code First.</span><span class="sxs-lookup"><span data-stu-id="74a3a-163">Note that the DbContext API that you use for working with data in Database First is the same as the API you use for working with data in Code First.</span></span> <span data-ttu-id="74a3a-164">Anche se si intende usare Database First, è possibile imparare a gestire scenari più complessi, ad esempio la lettura e l'aggiornamento dei dati correlati, la gestione dei conflitti di concorrenza e così via da un'esercitazione Code First.</span><span class="sxs-lookup"><span data-stu-id="74a3a-164">Even if you intend to use Database First, you can learn how to handle more complex scenarios such as reading and updating related data, handling concurrency conflicts, and so forth from a Code First tutorial.</span></span> <span data-ttu-id="74a3a-165">L'unica differenza risiede nel modo in cui vengono create le classi database, context e Entity.</span><span class="sxs-lookup"><span data-stu-id="74a3a-165">The only difference is in how the database, context class, and entity classes are created.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="74a3a-166">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="74a3a-166">Additional resources</span></span>

<span data-ttu-id="74a3a-167">Per un elenco completo delle annotazioni di convalida dei dati che è possibile applicare alle proprietà e alle classi, vedere [System. ComponentModel. DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx).</span><span class="sxs-lookup"><span data-stu-id="74a3a-167">For a full list of data validation annotations you can apply to properties and classes, see [System.ComponentModel.DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="74a3a-168">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="74a3a-168">Next steps</span></span>

<span data-ttu-id="74a3a-169">Le attività di questa esercitazione sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="74a3a-169">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="74a3a-170">Annotazioni dei dati aggiunte</span><span class="sxs-lookup"><span data-stu-id="74a3a-170">Added data annotations</span></span>
> * <span data-ttu-id="74a3a-171">Classi di metadati aggiunte</span><span class="sxs-lookup"><span data-stu-id="74a3a-171">Added metadata classes</span></span>

<span data-ttu-id="74a3a-172">Per informazioni su come distribuire un'app Web e un database SQL in app Azure servizio, vedere questa esercitazione:</span><span class="sxs-lookup"><span data-stu-id="74a3a-172">To learn how to deploy a web app and SQL database to Azure App Service, see this tutorial:</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="74a3a-173">Distribuire un'app .NET nel servizio app Azure</span><span class="sxs-lookup"><span data-stu-id="74a3a-173">Deploy a .NET app to Azure App Service</span></span>](/azure/app-service/app-service-web-tutorial-dotnet-sqldatabase/)
