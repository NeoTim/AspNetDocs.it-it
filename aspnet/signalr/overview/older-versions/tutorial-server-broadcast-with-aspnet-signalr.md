---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Esercitazione: Trasmissione server con ASP.NET SignalR 1.x | Microsoft Docs'
author: bradygaster
description: Questa esercitazione illustra come creare un'applicazione web che usa ASP.NET SignalR per fornire funzionalità di trasmissione di server. Trasmissione server significa che communic...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65116060"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="46dd0-104">Esercitazione: Trasmissione server con ASP.NET SignalR 1.x</span><span class="sxs-lookup"><span data-stu-id="46dd0-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="46dd0-105">dal [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="46dd0-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="46dd0-106">Questa esercitazione illustra come creare un'applicazione web che usa ASP.NET SignalR per fornire funzionalità di trasmissione di server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="46dd0-107">Trasmissione del server significa che le comunicazioni inviate ai client avviate tramite il server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="46dd0-108">Questo scenario richiede un approccio di programmazione diverso rispetto agli scenari peer-to-peer, ad esempio applicazioni chat, in cui vengono avviate le comunicazioni inviate ai client da una o più dei client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="46dd0-109">L'applicazione che verrà creata in questa esercitazione simula le quotazioni di borsa, uno scenario tipico per la funzionalità di trasmissione di server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="46dd0-110">Sono Benvenuti i commenti l'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="46dd0-111">Se hai domande che non sono direttamente correlate con l'esercitazione, è possibile pubblicarli per i [forum ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) oppure [StackOverflow.com](http://stackoverflow.com).</span><span class="sxs-lookup"><span data-stu-id="46dd0-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="46dd0-112">Panoramica</span><span class="sxs-lookup"><span data-stu-id="46dd0-112">Overview</span></span>

<span data-ttu-id="46dd0-113">Il [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pacchetto NuGet consente di installare un'applicazione di teleborsa esempio simulato in un progetto di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="46dd0-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="46dd0-114">Nella prima parte di questa esercitazione, si creerà una versione semplificata dell'applicazione da zero.</span><span class="sxs-lookup"><span data-stu-id="46dd0-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="46dd0-115">Nella parte restante dell'esercitazione, si verrà installare il pacchetto NuGet, rivedere le funzionalità aggiuntive e codice che crea.</span><span class="sxs-lookup"><span data-stu-id="46dd0-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="46dd0-116">L'applicazione di teleborsa è un rappresentante di un tipo di applicazione in tempo reale in cui vuoi periodicamente "push", o la trasmissione, le notifiche dal server per tutti i client connessi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="46dd0-117">L'applicazione che verrà compilata nella prima parte di questa esercitazione consente di visualizzare una griglia con dati azionari.</span><span class="sxs-lookup"><span data-stu-id="46dd0-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Versione iniziale StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="46dd0-119">Periodicamente in modo casuale il server Aggiorna quotazioni di titoli e inserisce gli aggiornamenti a tutti i client connessi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="46dd0-120">Nel browser i numeri e simboli nel **cambiare** e **%** colonne modificate in modo dinamico in risposta a notifiche dal server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="46dd0-121">Se si apre browser aggiuntivi allo stesso URL, sono visualizzate le stesse modifiche ai dati e gli stessi dati contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="46dd0-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="46dd0-122">Questa esercitazione include le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="46dd0-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="46dd0-123">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="46dd0-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="46dd0-124">Creare il progetto</span><span class="sxs-lookup"><span data-stu-id="46dd0-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="46dd0-125">Aggiungere i pacchetti NuGet di SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="46dd0-126">Impostare il codice server</span><span class="sxs-lookup"><span data-stu-id="46dd0-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="46dd0-127">Impostare il codice client</span><span class="sxs-lookup"><span data-stu-id="46dd0-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="46dd0-128">Testare l'applicazione</span><span class="sxs-lookup"><span data-stu-id="46dd0-128">Test the application</span></span>](#test)
- [<span data-ttu-id="46dd0-129">Abilitare la registrazione</span><span class="sxs-lookup"><span data-stu-id="46dd0-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="46dd0-130">Installare ed esaminare l'esempio StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="46dd0-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="46dd0-131">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="46dd0-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="46dd0-132">Se non si desidera eseguire i passaggi di compilazione dell'applicazione, è possibile installare il pacchetto SignalR.Sample in una nuova **applicazione Web ASP.NET vuota** dei progetti e leggere con attenzione questi passaggi per ottenere una spiegazione del codice.</span><span class="sxs-lookup"><span data-stu-id="46dd0-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="46dd0-133">La prima parte dell'esercitazione vengono illustrati un subset del codice SignalR.Sample e la seconda parte illustra le funzionalità principali di funzionalità aggiuntive nel pacchetto SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="46dd0-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="46dd0-134">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="46dd0-134">Prerequisites</span></span>

<span data-ttu-id="46dd0-135">Prima di iniziare, assicurarsi che si dispone di Visual Studio 2012 o 2010 SP1 installato nel computer.</span><span class="sxs-lookup"><span data-stu-id="46dd0-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="46dd0-136">Se non hai Visual Studio, vedere [download ASP.NET](https://www.asp.net/downloads) per ottenere il gratuito Visual Studio Express 2012 per Web.</span><span class="sxs-lookup"><span data-stu-id="46dd0-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="46dd0-137">Se si dispone di Visual Studio 2010, verificare che [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) è installato.</span><span class="sxs-lookup"><span data-stu-id="46dd0-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="46dd0-138">Creare il progetto</span><span class="sxs-lookup"><span data-stu-id="46dd0-138">Create the project</span></span>

1. <span data-ttu-id="46dd0-139">Dal **File** dal menu **nuovo progetto**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="46dd0-140">Nel **nuovo progetto** finestra di dialogo espandere **c#** sotto **modelli** e selezionare **Web**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="46dd0-141">Selezionare il **applicazione Web ASP.NET vuota** al progetto il nome modello *SignalR.StockTicker*, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Finestra di dialogo Nuovo progetto](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="46dd0-143">Aggiungere i pacchetti NuGet di SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="46dd0-144">Aggiungere i pacchetti NuGet di JQuery e SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="46dd0-145">È possibile aggiungere funzionalità SignalR a un progetto tramite l'installazione di un pacchetto NuGet.</span><span class="sxs-lookup"><span data-stu-id="46dd0-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="46dd0-146">Fare clic su **strumenti | Gestione pacchetti NuGet | Console di Gestione pacchetti**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="46dd0-147">Immettere il comando seguente in Gestione pacchetti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="46dd0-148">Il pacchetto di SignalR installa svariati altri pacchetti NuGet come dipendenze.</span><span class="sxs-lookup"><span data-stu-id="46dd0-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="46dd0-149">Al termine dell'installazione sono tutti i componenti server e client necessari per usare SignalR in un'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="46dd0-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="46dd0-150">Impostare il codice server</span><span class="sxs-lookup"><span data-stu-id="46dd0-150">Set up the server code</span></span>

<span data-ttu-id="46dd0-151">In questa sezione è impostare il codice eseguito nel server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="46dd0-152">Creare la classe Stock</span><span class="sxs-lookup"><span data-stu-id="46dd0-152">Create the Stock class</span></span>

<span data-ttu-id="46dd0-153">Iniziare creando la classe modello azionario che si userà per archiviare e trasmettere informazioni su un titolo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="46dd0-154">Creare un nuovo file di classe nella cartella del progetto, denominarlo *Stock.cs*, quindi sostituire il codice del modello con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46dd0-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="46dd0-155">Le due proprietà che si imposteranno quando si crea stock sono il simbolo (ad esempio, MSFT per Microsoft) e il prezzo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="46dd0-156">Le altre proprietà variano a seconda di come e quando si imposta prezzo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="46dd0-157">La prima volta che è impostare prezzo, il valore ottiene propagato a DayOpen.</span><span class="sxs-lookup"><span data-stu-id="46dd0-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="46dd0-158">Tutte le volte successive quando si imposta prezzo, la modifica e i valori delle proprietà valori vengono calcolati in base alla differenza tra prezzo e DayOpen.</span><span class="sxs-lookup"><span data-stu-id="46dd0-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="46dd0-159">Creare le classi StockTicker e StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="46dd0-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="46dd0-160">Si userà l'API di Hub di SignalR per gestire l'interazione di server a client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="46dd0-161">Una classe StockTickerHub che deriva dalla classe SignalR Hub gestirà la ricezione di chiamate al metodo e le connessioni dai client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="46dd0-162">È anche necessario mantenere i dati azionari e l'esecuzione di un oggetto Timer per attivare periodicamente gli aggiornamenti di prezzo, indipendentemente dalle connessioni client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="46dd0-163">È possibile inserire queste funzioni in una classe di Hub, perché le istanze di Hub sono temporanee.</span><span class="sxs-lookup"><span data-stu-id="46dd0-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="46dd0-164">Un'istanza della classe Hub viene creata per ogni operazione nell'hub, ad esempio connessioni e chiamate dal client al server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="46dd0-165">In modo che il meccanismo che mantiene i dati azionari, aggiorna i prezzi e trasmette gli aggiornamenti di prezzo deve essere eseguito in una classe separata, che è possibile assegnare un nome StockTicker.</span><span class="sxs-lookup"><span data-stu-id="46dd0-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![La trasmissione da StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="46dd0-167">Si vuole solo un'istanza della classe StockTicker in esecuzione nel server, pertanto è necessario configurare un riferimento da ogni istanza StockTickerHub all'istanza singleton di StockTicker.</span><span class="sxs-lookup"><span data-stu-id="46dd0-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="46dd0-168">La classe StockTicker deve essere in grado di trasmettere ai client in quanto dispone i dati azionari e attiva gli aggiornamenti, ma StockTicker non è una classe di Hub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="46dd0-169">Pertanto, la classe StockTicker deve ottenere un riferimento all'oggetto di contesto di connessione del SignalR Hub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="46dd0-170">Quindi possibile usare l'oggetto di contesto di connessione SignalR per trasmettere ai client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="46dd0-171">Nelle **Esplora soluzioni**, fare clic sul progetto e fare clic su **Aggiungi nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="46dd0-172">Se si dispone di Visual Studio 2012 con il [ASP.NET e Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), fare clic su **Web** sotto **Visual c#** e selezionare il **classe Hub SignalR** modello di elemento.</span><span class="sxs-lookup"><span data-stu-id="46dd0-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="46dd0-173">In caso contrario, selezionare la **classe** modello.</span><span class="sxs-lookup"><span data-stu-id="46dd0-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="46dd0-174">Denominare la nuova classe *StockTickerHub.cs*, quindi fare clic su **Add**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![Aggiungere StockTickerHub.cs](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="46dd0-176">Sostituire il codice del modello con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46dd0-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="46dd0-177">Il [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) classe viene utilizzata per definire metodi che i client possono chiamare sul server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="46dd0-178">Si sta definendo un metodo: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="46dd0-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="46dd0-179">Quando un client si connette inizialmente al server, chiama questo metodo per ottenere un elenco di tutti i titoli di borsa con i relativi prezzi correnti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="46dd0-180">Il metodo può eseguire in modo sincrono e restituire `IEnumerable<Stock>` perché restituisce i dati dalla memoria.</span><span class="sxs-lookup"><span data-stu-id="46dd0-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="46dd0-181">Se il metodo deve ottenere i dati in questo modo qualcosa che richiederebbe l'intervento di attesa, ad esempio una ricerca nel database o una chiamata al servizio web, si specificherà `Task<IEnumerable<Stock>>` come valore restituito per abilitare l'elaborazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="46dd0-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="46dd0-182">Per altre informazioni, vedere [Guida all'API di hub di ASP.NET SignalR - Server - quando è necessario eseguire in modo asincrono](index.md).</span><span class="sxs-lookup"><span data-stu-id="46dd0-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="46dd0-183">L'attributo HubName specifica come verrà fatto riferimento nell'Hub nel codice JavaScript nel client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="46dd0-184">Il nome predefinito sul client se non si usa questo attributo è una versione con notazione camel del nome della classe, che in questo caso sarebbe stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="46dd0-185">Come si vedrà in seguito quando si crea la classe StockTicker, viene creata un'istanza singleton della classe nella relativa proprietà istanza statica.</span><span class="sxs-lookup"><span data-stu-id="46dd0-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="46dd0-186">Che istanza singleton di StockTicker rimane in memoria, indipendentemente dal numero di client connessione o disconnessione e quell'istanza viene usato il metodo GetAllStocks per restituire informazioni sulle azioni corrente.</span><span class="sxs-lookup"><span data-stu-id="46dd0-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="46dd0-187">Creare un nuovo file di classe nella cartella del progetto, denominarlo *StockTicker.cs*, quindi sostituire il codice del modello con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46dd0-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="46dd0-188">Poiché più thread verrà eseguita la stessa istanza del codice StockTicker, la classe StockTicker deve essere affidabile.</span><span class="sxs-lookup"><span data-stu-id="46dd0-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="46dd0-189">Archiviare l'istanza singleton in un campo statico</span><span class="sxs-lookup"><span data-stu-id="46dd0-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="46dd0-190">Il codice inizializza il metodo statico \_campo di istanza sottostante alla proprietà di istanza con un'istanza della classe e questo è l'unica istanza della classe che può essere creata, perché il costruttore è contrassegnato come privato.</span><span class="sxs-lookup"><span data-stu-id="46dd0-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="46dd0-191">[L'inizializzazione differita](https://msdn.microsoft.com/library/dd997286.aspx) viene usato per il \_campo di istanza, non per motivi di prestazioni ma per assicurarsi che la creazione dell'istanza è affidabile.</span><span class="sxs-lookup"><span data-stu-id="46dd0-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="46dd0-192">Ogni volta che un client si connette al server, una nuova istanza della classe StockTickerHub in esecuzione in un thread separato Ottiene l'istanza singleton StockTicker dalla proprietà statica StockTicker.Instance, come illustrato in precedenza nella classe StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="46dd0-193">Archiviazione dei dati predefinite in un oggetto ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="46dd0-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="46dd0-194">Il costruttore inizializza il \_raccolta titoli di borsa con alcuni dati di esempio borsa e GetAllStocks restituisce i titoli di borsa.</span><span class="sxs-lookup"><span data-stu-id="46dd0-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="46dd0-195">Come illustrato in precedenza, questa raccolta di titoli azionari, a sua volta viene restituita da StockTickerHub.GetAllStocks che è un metodo server nella classe Hub che i client possono chiamare.</span><span class="sxs-lookup"><span data-stu-id="46dd0-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="46dd0-196">La raccolta di titoli azionari è definita come un [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) tipo per la sicurezza dei thread.</span><span class="sxs-lookup"><span data-stu-id="46dd0-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="46dd0-197">In alternativa, è possibile usare una [dizionario](https://msdn.microsoft.com/library/xfhwa508.aspx) dell'oggetto e il dizionario di blocco in modo esplicito quando si apportano modifiche a esso.</span><span class="sxs-lookup"><span data-stu-id="46dd0-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="46dd0-198">Per questa applicazione di esempio, è bene per archiviare i dati dell'applicazione in memoria e i dati andranno persi quando l'istanza StockTicker venga eliminata.</span><span class="sxs-lookup"><span data-stu-id="46dd0-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="46dd0-199">In un'applicazione reale si ridimensiona un archivio dati back-end, ad esempio un database.</span><span class="sxs-lookup"><span data-stu-id="46dd0-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="46dd0-200">Aggiornamento periodico dei prezzi delle azioni</span><span class="sxs-lookup"><span data-stu-id="46dd0-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="46dd0-201">Il costruttore viene avviato un oggetto Timer che chiama periodicamente i metodi che aggiornano quotazioni di titoli in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="46dd0-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="46dd0-202">UpdateStockPrices viene chiamato dal Timer, che passa valore null nel parametro state.</span><span class="sxs-lookup"><span data-stu-id="46dd0-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="46dd0-203">Prima di aggiornare i prezzi indicati, viene applicato un blocco \_updateStockPricesLock oggetto.</span><span class="sxs-lookup"><span data-stu-id="46dd0-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="46dd0-204">Il codice controlla se un altro thread sta già aggiornando i prezzi e quindi chiama TryUpdateStockPrice su ciascun titolo nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="46dd0-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="46dd0-205">Il metodo TryUpdateStockPrice decide se si desidera modificare il prezzo azionario e a modificarlo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="46dd0-206">Se viene modificato il prezzo azionario, BroadcastStockPrice viene chiamato per la modifica del prezzo azionario di trasmettere a tutti i client connessi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="46dd0-207">Il \_updatingStockPrices flag è contrassegnato come [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) per assicurarsi che l'accesso a esso sia affidabile.</span><span class="sxs-lookup"><span data-stu-id="46dd0-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="46dd0-208">In un'applicazione reale, chiamare il metodo TryUpdateStockPrice un servizio web per cercare il prezzo; In questo codice Usa un generatore di numeri casuali per apportare modifiche in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="46dd0-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="46dd0-209">Recupero del contesto di SignalR in modo che la classe StockTicker può trasmettere ai client</span><span class="sxs-lookup"><span data-stu-id="46dd0-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="46dd0-210">Perché le variazioni di prezzo derivano qui nell'oggetto StockTicker, questo è l'oggetto che deve chiamare un metodo updateStockPrice su tutti i client connessi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="46dd0-211">In una classe Hub è disponibile un'API per la chiamata di metodi del client, ma StockTicker non deriva dalla classe dell'Hub e non è un riferimento a qualsiasi oggetto di Hub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="46dd0-212">Pertanto, per poter trasmettere ai client connessi, la classe StockTicker dispone ottenere l'istanza del contesto SignalR per la classe StockTickerHub e usarlo per chiamare metodi sul client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="46dd0-213">Il codice ottiene un riferimento al contesto di SignalR quando crea l'istanza della classe singleton, che fanno riferimento a passate al costruttore, e il costruttore inserisce nella proprietà client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="46dd0-214">Esistono due motivi per cui si desidera ottenere il contesto di una sola volta: recupero del contesto è un'operazione dispendiosa e messa in funzione una sola volta consente di mantenere l'ordine previsto dei messaggi inviati ai client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="46dd0-215">Recupera la proprietà client del contesto e il relativo inserimento nella proprietà StockTickerClient consente di scrivere codice per chiamare i metodi di client che ha lo stesso aspetto come verrebbe mostrata in una classe dell'Hub.</span><span class="sxs-lookup"><span data-stu-id="46dd0-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="46dd0-216">Per trasmettere a tutti i client, ad esempio, è possibile scrivere Clients.All.updateStockPrice(stock).</span><span class="sxs-lookup"><span data-stu-id="46dd0-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="46dd0-217">Il metodo updateStockPrice che si sta chiamando in BroadcastStockPrice non esiste già; tale servizio verrà aggiunto in un secondo momento quando si scrive codice che viene eseguito sul client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="46dd0-218">È possibile fare riferimento a updateStockPrice qui perché Clients.All è dinamico, ovvero che l'espressione verrà valutata in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="46dd0-219">Quando viene eseguita questa chiamata al metodo, SignalR invierà il nome del metodo e il valore del parametro per il client e se il client dispone di un metodo denominato updateStockPrice, tale metodo verrà chiamato e il valore di parametro verrà passato ad esso.</span><span class="sxs-lookup"><span data-stu-id="46dd0-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="46dd0-220">Clients.All si intende inviare a tutti i client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="46dd0-221">SignalR offre altre opzioni per specificare quale client o i gruppi di client da inviare.</span><span class="sxs-lookup"><span data-stu-id="46dd0-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="46dd0-222">Per altre informazioni, vedere [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="46dd0-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="46dd0-223">Registrare la route di SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-223">Register the SignalR route</span></span>

<span data-ttu-id="46dd0-224">Il server deve conoscere l'URL da intercettare e indirizzare a SignalR.</span><span class="sxs-lookup"><span data-stu-id="46dd0-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="46dd0-225">Per eseguire operazioni che si aggiungerà codice per il *Global. asax* file.</span><span class="sxs-lookup"><span data-stu-id="46dd0-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="46dd0-226">Nelle **Esplora soluzioni**, fare clic sul progetto e quindi fare clic su **Aggiungi nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="46dd0-227">Selezionare il **classe di applicazione globale** modello di elemento e quindi fare clic su **Add**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    ![Aggiungere Global. asax](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="46dd0-229">Aggiungere il codice di registrazione delle route SignalR all'applicazione\_Start (metodo):</span><span class="sxs-lookup"><span data-stu-id="46dd0-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="46dd0-230">Per impostazione predefinita, l'URL di base per tutto il traffico di SignalR è "/ signalr", e "hub signalr /" viene usato per recuperare un file JavaScript generato dinamicamente che definisce i proxy per tutti gli hub hai nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="46dd0-231">Il metodo MapHubs include gli overload che consentono di specificare un URL di base diversi e alcune opzioni di SignalR in un'istanza di [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) classe.</span><span class="sxs-lookup"><span data-stu-id="46dd0-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="46dd0-232">Aggiungere un tramite informativa nella parte superiore del file:</span><span class="sxs-lookup"><span data-stu-id="46dd0-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="46dd0-233">Salvare e chiudere il *Global. asax* file e compilare il progetto.</span><span class="sxs-lookup"><span data-stu-id="46dd0-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="46dd0-234">Il codice del server di configurazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="46dd0-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="46dd0-235">Nella sezione successiva è possibile configurare il client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="46dd0-236">Impostare il codice client</span><span class="sxs-lookup"><span data-stu-id="46dd0-236">Set up the client code</span></span>

1. <span data-ttu-id="46dd0-237">Creare un nuovo file HTML nella cartella del progetto e denominarlo *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="46dd0-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="46dd0-238">Sostituire il codice del modello con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46dd0-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="46dd0-239">Il codice HTML crea una tabella con 5 colonne, una riga di intestazione e una riga di dati con una singola cella che si estende su tutte le 5 colonne.</span><span class="sxs-lookup"><span data-stu-id="46dd0-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="46dd0-240">La riga di dati viene visualizzato "caricamento in corso" e verrà visualizzata solo momentaneamente all'avvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="46dd0-241">Il codice JavaScript verrà rimuovere tale riga e aggiungere nelle righe Dell sul posto con dati azionari recuperati dal server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="46dd0-242">I tag di script specificano il file di script jQuery, il file di script di SignalR core, il file di script proxy SignalR e un file di script StockTicker che verrà creata in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="46dd0-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="46dd0-243">Il file di script proxy SignalR, che specifica l'URL "hub signalr /", viene generato dinamicamente e definisce i metodi di proxy per i metodi sulla classe Hub, in questo caso per StockTickerHub.GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="46dd0-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="46dd0-244">Se si preferisce, è possibile generare manualmente questo file JavaScript usando [SignalR utilità](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) e disabilitare la creazione di file dinamici nella chiamata al metodo MapHubs.</span><span class="sxs-lookup"><span data-stu-id="46dd0-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="46dd0-245">Assicurarsi che il file JavaScript fa riferimento *StockTicker.html* siano corretti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="46dd0-246">Vale a dire, assicurarsi che la versione di jQuery nel tag dello script (1.8.2 nell'esempio) sia la stessa versione di jQuery del progetto *script* cartella e assicurarsi che la versione di SignalR nel tag dello script sia identico SignalR versione del progetto *script* cartella.</span><span class="sxs-lookup"><span data-stu-id="46dd0-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="46dd0-247">Se necessario, modificare i nomi dei file nei tag dello script.</span><span class="sxs-lookup"><span data-stu-id="46dd0-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="46dd0-248">Nelle **Esplora soluzioni**, fare doppio clic su *StockTicker.html*, quindi fare clic su **imposta come pagina iniziale**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="46dd0-249">Creare un nuovo file JavaScript nella cartella del progetto e denominarla *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="46dd0-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="46dd0-250">Sostituire il codice del modello con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46dd0-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="46dd0-251">$.connection fa riferimento al proxy di SignalR.</span><span class="sxs-lookup"><span data-stu-id="46dd0-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="46dd0-252">Il codice ottiene un riferimento al proxy per la classe StockTickerHub e lo inserisce nella variabile di ticker.</span><span class="sxs-lookup"><span data-stu-id="46dd0-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="46dd0-253">Il nome del proxy è il nome che è stato impostato dall'attributo [HubName]:</span><span class="sxs-lookup"><span data-stu-id="46dd0-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="46dd0-254">Dopo aver definite tutte le funzioni e variabili, l'ultima riga di codice nel file Inizializza la connessione SignalR, chiamando la funzione di avvio di SignalR.</span><span class="sxs-lookup"><span data-stu-id="46dd0-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="46dd0-255">Funzione di avvio viene eseguita in modo asincrono e restituisce un [jQuery Deferred oggetto](http://api.jquery.com/category/deferred-object/), ovvero è possibile chiamare la funzione eseguita per specificare la funzione da chiamare quando l'operazione asincrona viene completata...</span><span class="sxs-lookup"><span data-stu-id="46dd0-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="46dd0-256">La funzione init chiama la funzione getAllStocks sul server e utilizza le informazioni che il server restituisce per aggiornare la tabella predefinita.</span><span class="sxs-lookup"><span data-stu-id="46dd0-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="46dd0-257">Si noti che per impostazione predefinita, è necessario usare le iniziali maiuscole e minuscole sul client anche se il nome del metodo è la convenzione pascal maiuscole/minuscole nel server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="46dd0-258">La regola di maiuscole/minuscole camel si applica solo ai metodi, non oggetti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="46dd0-259">Ad esempio, è fare riferimento alle scorte. Simbolo e magazzino. Prezzo, non stock.symbol o stock.price.</span><span class="sxs-lookup"><span data-stu-id="46dd0-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="46dd0-260">Se necessaria per l'utilizzo di maiuscole e minuscole pascal sul client o se si vuole usare un nome di metodo completamente diverso, è possibile decorare il metodo Hub con l'attributo HubMethodName allo stesso modo si decorata la classe Hub con l'attributo HubName.</span><span class="sxs-lookup"><span data-stu-id="46dd0-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="46dd0-261">Nel metodo init, codice HTML per una riga della tabella viene creata per ogni oggetto dei titoli ricevuto dal server dal chiamante formatStock alle proprietà del formato dell'oggetto predefinita e quindi chiamando rimpiazzare (definito in cima *StockTicker.js*) per sostituire i segnaposto nella variabile rowTemplate con i valori delle proprietà oggetto dei titoli.</span><span class="sxs-lookup"><span data-stu-id="46dd0-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="46dd0-262">Il codice HTML risultante viene quindi aggiunto alla tabella dei titolo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="46dd0-263">La chiamata di init passandolo come una funzione di callback che viene eseguita dopo la funzione di avvio asincrono viene completata.</span><span class="sxs-lookup"><span data-stu-id="46dd0-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="46dd0-264">Se è stato chiamato init come istruzione JavaScript separata dopo la chiamata iniziale, la funzione avrà esito negativo perché viene eseguita immediatamente senza attendere che la funzione di avvio alla fine di stabilire una connessione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="46dd0-265">In tal caso, la funzione init tentava di chiamare la funzione getAllStocks prima che venga stabilita la connessione al server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="46dd0-266">Quando il server viene modificato il prezzo del titolo, chiama il updateStockPrice sui client connessi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="46dd0-267">La funzione viene aggiunto alla proprietà client del proxy stockTicker per renderla disponibile alle chiamate dal server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="46dd0-268">La funzione updateStockPrice formatta un oggetto predefinito ricevuto dal server in una riga della tabella come avviene per la funzione init.</span><span class="sxs-lookup"><span data-stu-id="46dd0-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="46dd0-269">Tuttavia, anziché aggiungere la riga nella tabella, trova riga corrente del titolo della tabella e sostituisce tale riga con quello nuovo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="46dd0-270">Testare l'applicazione</span><span class="sxs-lookup"><span data-stu-id="46dd0-270">Test the application</span></span>

1. <span data-ttu-id="46dd0-271">Premere F5 per eseguire l'applicazione in modalità di debug.</span><span class="sxs-lookup"><span data-stu-id="46dd0-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="46dd0-272">Vengono inizialmente visualizzate nella tabella azionario di "caricamento in corso" riga, quindi dopo un breve ritardo che verranno visualizzati i dati azionari iniziali e quindi di avviare le quotazioni di titoli da modificare.</span><span class="sxs-lookup"><span data-stu-id="46dd0-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Caricamento](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Tabella predefinita iniziale](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Tabella predefinita che riceve le modifiche dal server](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="46dd0-276">Copiare l'URL dalla barra degli indirizzi del browser e incollarlo in una o più finestre del browser nuovo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="46dd0-277">La visualizzazione predefinita iniziale è quello utilizzato per il primo browser e le modifiche vengono eseguite contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="46dd0-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="46dd0-278">Chiudere tutti i browser e aprire un nuovo browser, quindi passare allo stesso URL.</span><span class="sxs-lookup"><span data-stu-id="46dd0-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="46dd0-279">L'oggetto singleton StockTicker ha continuato a eseguire nel server, per consentirne la visualizzazione di tabella predefinite mostra che i titoli di borsa hanno continuato a cambiare.</span><span class="sxs-lookup"><span data-stu-id="46dd0-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="46dd0-280">(Non viene visualizzata la tabella con zero inizio modificare cifre.)</span><span class="sxs-lookup"><span data-stu-id="46dd0-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="46dd0-281">Chiudere il browser.</span><span class="sxs-lookup"><span data-stu-id="46dd0-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="46dd0-282">Abilitare la registrazione</span><span class="sxs-lookup"><span data-stu-id="46dd0-282">Enable logging</span></span>

<span data-ttu-id="46dd0-283">SignalR è una funzione di registrazione predefiniti che è possibile abilitare nel client per semplificare la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="46dd0-284">In questa sezione abilitare la registrazione e vedere gli esempi che illustrano come log indicano quale dei seguenti metodi di trasporto utilizza SignalR:</span><span class="sxs-lookup"><span data-stu-id="46dd0-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="46dd0-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supportata da IIS 8 e i browser correnti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="46dd0-286">[Gli eventi inviati al server](http://en.wikipedia.org/wiki/Server-sent_events), supportato dai browser diversi da Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="46dd0-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="46dd0-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supportata da Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="46dd0-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="46dd0-288">[AJAX polling prolungato](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supportata da tutti i browser.</span><span class="sxs-lookup"><span data-stu-id="46dd0-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="46dd0-289">Per una connessione specifica, SignalR sceglie il metodo migliore di trasporto che supportano il client sia nel server.</span><span class="sxs-lookup"><span data-stu-id="46dd0-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="46dd0-290">Aprire *StockTicker.js* e aggiungere una riga di codice per abilitare la registrazione immediatamente prima del codice che inizializza la connessione alla fine del file:</span><span class="sxs-lookup"><span data-stu-id="46dd0-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="46dd0-291">Premere F5 per eseguire il progetto.</span><span class="sxs-lookup"><span data-stu-id="46dd0-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="46dd0-292">Finestra Strumenti di sviluppo del browser di aprire e selezionare la Console per visualizzare i log.</span><span class="sxs-lookup"><span data-stu-id="46dd0-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="46dd0-293">Si potrebbe essere necessario aggiornare la pagina per visualizzare i log di negoziare il metodo di trasporto per una nuova connessione Signalr.</span><span class="sxs-lookup"><span data-stu-id="46dd0-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="46dd0-294">Se si esegue Internet Explorer 10 in Windows 8 (IIS 8), il metodo di trasporto è WebSocket.</span><span class="sxs-lookup"><span data-stu-id="46dd0-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Console di Internet Explorer 10 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="46dd0-296">Se si esegue Internet Explorer 10 in Windows 7 (IIS 7.5), il metodo di trasporto è iframe.</span><span class="sxs-lookup"><span data-stu-id="46dd0-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 Console, IIS 7.5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="46dd0-298">In Firefox, installare il componente aggiuntivo Firebug per ottenere una finestra della Console.</span><span class="sxs-lookup"><span data-stu-id="46dd0-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="46dd0-299">Se si esegue il 19 di Firefox in Windows 8 (IIS 8), il metodo di trasporto è WebSocket.</span><span class="sxs-lookup"><span data-stu-id="46dd0-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="46dd0-301">Se si esegue il 19 di Firefox in Windows 7 (IIS 7.5), il metodo di trasporto è il server ha inviato gli eventi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 Console IIS 7.5](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="46dd0-303">Installare ed esaminare l'esempio StockTicker completo</span><span class="sxs-lookup"><span data-stu-id="46dd0-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="46dd0-304">L'applicazione StockTicker installata mediante il [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pacchetto NuGet include più funzionalità rispetto alla versione semplificata appena creata da zero.</span><span class="sxs-lookup"><span data-stu-id="46dd0-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="46dd0-305">In questa sezione dell'esercitazione, si installa il pacchetto NuGet e rivedere le nuove funzionalità e il codice che li implementa.</span><span class="sxs-lookup"><span data-stu-id="46dd0-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="46dd0-306">Installare il pacchetto SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="46dd0-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="46dd0-307">Nelle **Esplora soluzioni**, fare clic sul progetto e fare clic su **Gestisci pacchetti NuGet**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="46dd0-308">Nel **Gestisci pacchetti NuGet** finestra di dialogo, fare clic su **Online**, immettere *SignalR.Sample* nel **Cerca Online** casella e quindi fare clic su  **Installare** nella **SignalR.Sample** pacchetto.</span><span class="sxs-lookup"><span data-stu-id="46dd0-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Installare il pacchetto SignalR.Sample](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="46dd0-310">Nel *Global. asax* del file, commentare la RouteTable.Routes.MapHubs(); della riga di aggiunto in precedenza nell'applicazione\_Start (metodo).</span><span class="sxs-lookup"><span data-stu-id="46dd0-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="46dd0-311">Il codice nel *Global. asax* non è più necessario perché il pacchetto SignalR.Sample registra la route di SignalR nel *App\_Start/RegisterHubs.cs* file:</span><span class="sxs-lookup"><span data-stu-id="46dd0-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="46dd0-312">La classe WebActivator che fa riferimento l'attributo dell'assembly è incluso nel pacchetto WebActivatorEx NuGet, che viene installato come una dipendenza del pacchetto SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="46dd0-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="46dd0-313">Nelle **Esplora soluzioni**, espandere il *SignalR.Sample* cartella in cui è stata creata mediante l'installazione del pacchetto SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="46dd0-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="46dd0-314">Nel *SignalR.Sample* cartella, fare doppio clic su *StockTicker.html*, quindi fare clic su **imposta come pagina iniziale**.</span><span class="sxs-lookup"><span data-stu-id="46dd0-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="46dd0-315">Installazione di SignalR.Sample NuGet il pacchetto potrebbe cambiare la versione di jQuery presenti nelle *script* cartella.</span><span class="sxs-lookup"><span data-stu-id="46dd0-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="46dd0-316">Il nuovo *StockTicker.html* che consente di installare il pacchetto nel file la *SignalR.Sample* cartella sarà sincronizzata con la versione di jQuery che installa il pacchetto, ma se si vuole eseguire originale *StockTicker.html* file anche in questo caso, potrebbe essere necessario aggiornare innanzitutto il riferimento di jQuery nel tag di script.</span><span class="sxs-lookup"><span data-stu-id="46dd0-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="46dd0-317">Esecuzione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="46dd0-317">Run the application</span></span>

1. <span data-ttu-id="46dd0-318">Premere F5 per eseguire l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="46dd0-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="46dd0-319">Oltre alla griglia in cui è illustrato in precedenza, l'applicazione di teleborsa completo viene visualizzata una finestra di scorrimento orizzontale che consente di visualizzare gli stessi dati azionari.</span><span class="sxs-lookup"><span data-stu-id="46dd0-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="46dd0-320">Quando si esegue l'applicazione per la prima volta, il "mercato" è "chiuso" e visualizzata una griglia statica e una finestra del ticker che non viene effettuato uno scorrimento.</span><span class="sxs-lookup"><span data-stu-id="46dd0-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Avvio dello schermo StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="46dd0-322">Quando fa clic su **Open Market**, il **Live Stock Ticker** finestra Avvia scorra in orizzontale e il server inizia a trasmettere periodicamente le modifiche di prezzo delle azioni in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="46dd0-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="46dd0-323">Ogni volta che un prezzo azionario cambia, entrambi i **Live tabella Stock** griglia e il **Live Stock Ticker** casella vengono aggiornati.</span><span class="sxs-lookup"><span data-stu-id="46dd0-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="46dd0-324">Quando la variazione di prezzo del titolo è positiva, le scorte viene visualizzata con uno sfondo verde, e quando la modifica è negativa, le scorte viene visualizzata con uno sfondo rosso.</span><span class="sxs-lookup"><span data-stu-id="46dd0-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Aprire sul mercato app StockTicker,](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="46dd0-326">Il **Chiudi mercato** pulsante interrompe le modifiche e lo scorrimento di ticker e il **reimpostare** pulsante Reimposta tutti i dati azionari allo stato iniziale prima dell'avvio di variazioni di prezzo.</span><span class="sxs-lookup"><span data-stu-id="46dd0-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="46dd0-327">Se si aprono più finestre del browser e passare allo stesso URL, si vedranno gli stessi dati aggiornati in modo dinamico al momento stesso in ogni browser.</span><span class="sxs-lookup"><span data-stu-id="46dd0-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="46dd0-328">Quando si fa clic su uno dei pulsanti, tutti i browser rispondono esattamente nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="46dd0-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="46dd0-329">Visualizzazione Stock Ticker in tempo reale</span><span class="sxs-lookup"><span data-stu-id="46dd0-329">Live Stock Ticker display</span></span>

<span data-ttu-id="46dd0-330">Il **Live Stock Ticker** visualizzato è un elenco non ordinato in un elemento div che viene formattato in una singola riga dagli stili CSS.</span><span class="sxs-lookup"><span data-stu-id="46dd0-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="46dd0-331">Il ticket viene inizializzata e aggiornata esattamente come la tabella: sostituendo i segnaposto in una &lt;li&gt; stringa di modello e in modo dinamico aggiungendo il &lt;li&gt; elementi per il &lt;ul&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="46dd0-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="46dd0-332">Lo scorrimento viene eseguito usando la funzione di animare jQuery per variare il margine a sinistra dell'elenco non ordinato entro l'elemento DIV.</span><span class="sxs-lookup"><span data-stu-id="46dd0-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="46dd0-333">Le quotazioni di borsa HTML:</span><span class="sxs-lookup"><span data-stu-id="46dd0-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="46dd0-334">Le quotazioni di borsa CSS:</span><span class="sxs-lookup"><span data-stu-id="46dd0-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="46dd0-335">Scorrere verso il codice jQuery che consente di:</span><span class="sxs-lookup"><span data-stu-id="46dd0-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="46dd0-336">Metodi aggiuntivi nel server in cui il client può chiamare</span><span class="sxs-lookup"><span data-stu-id="46dd0-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="46dd0-337">La classe StockTickerHub definisce quattro metodi aggiuntivi che il client può chiamare:</span><span class="sxs-lookup"><span data-stu-id="46dd0-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="46dd0-338">OpenMarket CloseMarket e reimposta vengono chiamati in risposta ai pulsanti nella parte superiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="46dd0-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="46dd0-339">Illustrano il motivo di un client attiva un cambiamento di stato che immediatamente viene propagato a tutti i client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="46dd0-340">Ognuno di questi metodi chiama un metodo nella classe StockTicker che interessa lo stato di immissione sul mercato, modificare e quindi trasmette il nuovo stato.</span><span class="sxs-lookup"><span data-stu-id="46dd0-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="46dd0-341">Nella classe StockTicker, lo stato del mercato è gestito da una proprietà MarketState che restituisce un valore di enumerazione MarketState:</span><span class="sxs-lookup"><span data-stu-id="46dd0-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="46dd0-342">Ciascuno dei metodi che modificano lo stato di immissione sul mercato eseguire questa operazione all'interno di un blocco di blocco perché la classe StockTicker deve essere affidabile:</span><span class="sxs-lookup"><span data-stu-id="46dd0-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="46dd0-343">Per garantire che questo codice è affidabile, il \_marketState campo sottostante alla proprietà MarketState è contrassegnato come volatile,</span><span class="sxs-lookup"><span data-stu-id="46dd0-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="46dd0-344">I metodi BroadcastMarketStateChange e BroadcastMarketReset sono simili al metodo BroadcastStockPrice che hai già visto, ad eccezione del fatto che chiamano metodi diversi definiti nel client:</span><span class="sxs-lookup"><span data-stu-id="46dd0-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="46dd0-345">Funzioni aggiuntive sul client che il server può chiamare</span><span class="sxs-lookup"><span data-stu-id="46dd0-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="46dd0-346">La funzione updateStockPrice ora gestisce sia la griglia e la visualizzazione di ticker, e Usa jQuery.Color per un attimo i colori rossi e verdi.</span><span class="sxs-lookup"><span data-stu-id="46dd0-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="46dd0-347">Nuove funzioni nel *SignalR.StockTicker.js* abilitare e disabilitare i pulsanti di base sul mercato lo stato e arrestare o avviare il ticker finestra lo scorrimento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="46dd0-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="46dd0-348">Poiché vengono aggiunti più funzioni ticker.client, il [jQuery estendere funzione](http://api.jquery.com/jQuery.extend/) consente di aggiungerli.</span><span class="sxs-lookup"><span data-stu-id="46dd0-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="46dd0-349">Programma di installazione client aggiuntivi dopo aver stabilito la connessione</span><span class="sxs-lookup"><span data-stu-id="46dd0-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="46dd0-350">Dopo che il client stabilisce la connessione, dispone di alcune operazioni aggiuntive da eseguire: verificare se il mercato è aperto o chiuso per chiamare il marketOpened appropriata o la funzione marketClosed e collegare le chiamate al metodo server per i pulsanti.</span><span class="sxs-lookup"><span data-stu-id="46dd0-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="46dd0-351">I metodi server non sono collegati i pulsanti fino a dopo aver stabilita la connessione, in modo che il codice non è possibile provare a chiamare i metodi del server prima che siano disponibili.</span><span class="sxs-lookup"><span data-stu-id="46dd0-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="46dd0-352">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="46dd0-352">Next steps</span></span>

<span data-ttu-id="46dd0-353">In questa esercitazione si è appreso come programmare un'applicazione di SignalR che trasmette i messaggi dal server a tutti i client connessi, su base periodica e in risposta a notifiche da qualsiasi client.</span><span class="sxs-lookup"><span data-stu-id="46dd0-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="46dd0-354">Il modello di utilizzo di un'istanza singleton multithread per mantenere lo stato del server anche utilizzabile anche in scenari di giochi online multiplayer.</span><span class="sxs-lookup"><span data-stu-id="46dd0-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="46dd0-355">Per un esempio, vedere [gioco ShootR basato su SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="46dd0-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="46dd0-356">Per esercitazioni che illustrano scenari di comunicazione peer-to-peer, vedere [Introduzione a SignalR](index.md) e [l'aggiornamento in tempo reale con SignalR](index.md).</span><span class="sxs-lookup"><span data-stu-id="46dd0-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="46dd0-357">Per informazioni sui concetti di sviluppo più avanzati SignalR, visitare i siti seguenti per il codice sorgente SignalR e risorse:</span><span class="sxs-lookup"><span data-stu-id="46dd0-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="46dd0-358">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="46dd0-359">Progetto di SignalR</span><span class="sxs-lookup"><span data-stu-id="46dd0-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="46dd0-360">SignalR Github ed esempi</span><span class="sxs-lookup"><span data-stu-id="46dd0-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="46dd0-361">SignalR Wiki</span><span class="sxs-lookup"><span data-stu-id="46dd0-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
