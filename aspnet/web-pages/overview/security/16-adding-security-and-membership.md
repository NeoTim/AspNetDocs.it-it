---
uid: web-pages/overview/security/16-adding-security-and-membership
title: Aggiunta di sicurezza e appartenenza a un sito di Pagine Web ASP.NET (Razor) | Microsoft Docs
author: Rick-Anderson
description: In questo capitolo viene illustrato come proteggere il sito Web in modo che alcune pagine siano disponibili solo per gli utenti che accedono. Si vedrà anche come creare pagine...
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78628387"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="c94e6-104">Aggiunta di sicurezza e appartenenza a un sito di Pagine Web ASP.NET (Razor)</span><span class="sxs-lookup"><span data-stu-id="c94e6-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="c94e6-105">di [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="c94e6-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="c94e6-106">Questo articolo illustra come proteggere un sito Web di Pagine Web ASP.NET (Razor) in modo che alcune pagine siano disponibili solo per gli utenti che accedono.</span><span class="sxs-lookup"><span data-stu-id="c94e6-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="c94e6-107">Si vedrà anche come creare pagine a cui chiunque può accedere.</span><span class="sxs-lookup"><span data-stu-id="c94e6-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="c94e6-108">**Cosa si apprenderà:**</span><span class="sxs-lookup"><span data-stu-id="c94e6-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="c94e6-109">Come creare un sito Web con una pagina di registrazione e una pagina di accesso in modo che per alcune pagine è possibile limitare l'accesso solo ai membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="c94e6-110">Come creare pagine pubbliche e solo per i membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="c94e6-111">Come definire i ruoli, ovvero i gruppi che dispongono di autorizzazioni di sicurezza diverse per il sito e come assegnare utenti a un ruolo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="c94e6-112">Come utilizzare CAPTCHA per impedire la creazione di account membri da parte di programmi automatizzati (bot).</span><span class="sxs-lookup"><span data-stu-id="c94e6-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="c94e6-113">Queste sono le funzionalità di ASP.NET introdotte nell'articolo:</span><span class="sxs-lookup"><span data-stu-id="c94e6-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="c94e6-114">Modello di **sito Starter** di WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="c94e6-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="c94e6-115">`WebSecurity` helper e la classe `Roles`.</span><span class="sxs-lookup"><span data-stu-id="c94e6-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="c94e6-116">Helper `ReCaptcha`.</span><span class="sxs-lookup"><span data-stu-id="c94e6-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="c94e6-117">Versioni del software usate nell'esercitazione</span><span class="sxs-lookup"><span data-stu-id="c94e6-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="c94e6-118">Pagine Web ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="c94e6-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="c94e6-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="c94e6-119">WebMatrix 3</span></span>
> - <span data-ttu-id="c94e6-120">Libreria helper Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c94e6-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="c94e6-121">È possibile configurare il sito Web in modo che gli utenti possano accedervi, in &#8212; modo che il sito supporti l' *appartenenza*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="c94e6-122">Questa operazione può essere utile per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="c94e6-122">This can be useful for many reasons.</span></span> <span data-ttu-id="c94e6-123">Ad esempio, il sito potrebbe avere pagine che devono essere disponibili solo per i membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="c94e6-124">In alcuni casi, potrebbe essere necessario che gli utenti accedano per inviare commenti e suggerimenti o lasciare un commento.</span><span class="sxs-lookup"><span data-stu-id="c94e6-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="c94e6-125">Anche se il sito Web supporta l'appartenenza, gli utenti non devono necessariamente accedere prima di usare alcune pagine del sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="c94e6-126">Gli utenti che non hanno eseguito l'accesso sono noti come *utenti anonimi*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="c94e6-127">Un utente può registrarsi sul sito Web e quindi accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="c94e6-128">Il sito Web richiede un nome utente (indirizzo di posta elettronica) e una password per verificare che gli utenti siano quelli che attestano di essere.</span><span class="sxs-lookup"><span data-stu-id="c94e6-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="c94e6-129">Questo processo di accesso e conferma dell'identità di un utente è noto come *autenticazione*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="c94e6-130">È possibile configurare la sicurezza e l'appartenenza in modi diversi:</span><span class="sxs-lookup"><span data-stu-id="c94e6-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="c94e6-131">Se si usa WebMatrix, un modo semplice consiste nel creare un nuovo sito basato sul modello di **sito Starter** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="c94e6-132">Questo modello è già configurato per la sicurezza e l'appartenenza ed è già presente una pagina di registrazione, una pagina di accesso e così via.</span><span class="sxs-lookup"><span data-stu-id="c94e6-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="c94e6-133">Il sito creato dal modello ha anche la possibilità di consentire agli utenti di accedere usando un sito esterno come Facebook, Google o Twitter.</span><span class="sxs-lookup"><span data-stu-id="c94e6-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="c94e6-134">Se si desidera aggiungere sicurezza a un sito esistente o se non si desidera utilizzare il modello di **sito iniziale** , è possibile creare una pagina di registrazione personalizzata, una pagina di accesso e così via.</span><span class="sxs-lookup"><span data-stu-id="c94e6-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="c94e6-135">Questo articolo è incentrato sulla prima opzione &mdash; come aggiungere sicurezza tramite il modello di **sito Starter** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="c94e6-136">Sono inoltre disponibili alcune informazioni di base su come implementare la propria sicurezza e vengono forniti collegamenti a ulteriori informazioni su come eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="c94e6-137">Sono inoltre disponibili informazioni su come abilitare gli account di accesso esterni, descritti in dettaglio in un articolo separato.</span><span class="sxs-lookup"><span data-stu-id="c94e6-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="c94e6-138">Creazione della sicurezza del sito Web tramite il modello di sito Starter</span><span class="sxs-lookup"><span data-stu-id="c94e6-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="c94e6-139">In WebMatrix è possibile usare il modello di **sito Starter** per creare un sito Web che contiene quanto segue:</span><span class="sxs-lookup"><span data-stu-id="c94e6-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="c94e6-140">Database utilizzato per archiviare i nomi utente e le password per i membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="c94e6-141">Pagina di registrazione in cui è possibile registrare gli utenti anonimi (nuovi).</span><span class="sxs-lookup"><span data-stu-id="c94e6-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="c94e6-142">Una pagina di accesso e di disconnessione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-142">A login and logout page.</span></span>
- <span data-ttu-id="c94e6-143">Pagina di ripristino e ripristino della password.</span><span class="sxs-lookup"><span data-stu-id="c94e6-143">A password recovery and reset page.</span></span>

<span data-ttu-id="c94e6-144">Nella procedura seguente viene descritto come creare il sito e configurarlo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="c94e6-145">Avviare WebMatrix e nella pagina **avvio rapido** selezionare **sito da modello**.</span><span class="sxs-lookup"><span data-stu-id="c94e6-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="c94e6-146">Selezionare il modello di **sito Starter** , quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="c94e6-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="c94e6-147">WebMatrix crea un nuovo sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="c94e6-148">Nel riquadro sinistro fare clic sul selettore dell'area di lavoro **file** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="c94e6-149">Nella cartella radice del sito Web aprire il file *\_AppStart. cshtml* , che è un file speciale usato per contenere le impostazioni globali.</span><span class="sxs-lookup"><span data-stu-id="c94e6-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="c94e6-150">Contiene alcune istruzioni che sono impostate come commento usando i caratteri `//`:</span><span class="sxs-lookup"><span data-stu-id="c94e6-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="c94e6-151">Queste istruzioni configurano l'helper `WebMail`, che può essere usato per inviare messaggi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c94e6-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="c94e6-152">Il sistema di appartenenze può usare la posta elettronica per inviare messaggi di conferma quando gli utenti si registrano o quando vogliono modificare le password.</span><span class="sxs-lookup"><span data-stu-id="c94e6-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="c94e6-153">Ad esempio, dopo la registrazione degli utenti, riceveranno un messaggio di posta elettronica che include un collegamento che può fare clic per completare il processo di registrazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="c94e6-154">L'invio di posta elettronica richiede l'accesso a un server SMTP, come descritto in [aggiunta di un messaggio di posta elettronica a un sito pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="c94e6-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="c94e6-155">Le impostazioni di posta elettronica verranno archiviate in questo file centrale *\_AppStart. cshtml,* in modo che non sia necessario codificarle ripetutamente in ogni pagina in cui è possibile inviare messaggi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c94e6-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="c94e6-156">Non è necessario configurare le impostazioni SMTP per configurare un database di registrazione. sono necessarie solo le impostazioni SMTP se si desidera convalidare gli utenti dal proprio alias di posta elettronica e consentire agli utenti di reimpostare una password dimenticata.</span><span class="sxs-lookup"><span data-stu-id="c94e6-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="c94e6-157">Rimuovere il commento dalle istruzioni rimuovendo `//` da davanti a ciascuna di esse.</span><span class="sxs-lookup"><span data-stu-id="c94e6-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="c94e6-158">Se non si vuole configurare la conferma tramite posta elettronica, è possibile ignorare questo passaggio e il passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="c94e6-159">Se i valori SMTP non sono impostati, il nuovo account sarà immediatamente disponibile senza un messaggio di posta elettronica di conferma.</span><span class="sxs-lookup"><span data-stu-id="c94e6-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="c94e6-160">Modificare le seguenti impostazioni relative alla posta elettronica nel codice:</span><span class="sxs-lookup"><span data-stu-id="c94e6-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="c94e6-161">Impostare `WebMail.SmtpServer` sul nome del server SMTP a cui si ha accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="c94e6-162">Lasciare `WebMail.EnableSsl` impostato su `true`.</span><span class="sxs-lookup"><span data-stu-id="c94e6-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="c94e6-163">Questa impostazione consente di proteggere le credenziali inviate al server SMTP mediante la relativa crittografia.</span><span class="sxs-lookup"><span data-stu-id="c94e6-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="c94e6-164">Impostare `WebMail.UserName` sul nome utente per l'account del server SMTP.</span><span class="sxs-lookup"><span data-stu-id="c94e6-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="c94e6-165">Impostare `WebMail.Password` sulla password per l'account del server SMTP.</span><span class="sxs-lookup"><span data-stu-id="c94e6-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="c94e6-166">Impostare `WebMail.From` per il proprio indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c94e6-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="c94e6-167">Si tratta dell'indirizzo di posta elettronica da cui viene inviato il messaggio.</span><span class="sxs-lookup"><span data-stu-id="c94e6-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="c94e6-168">**Suggerimento** Per ulteriori informazioni sui valori per queste proprietà, vedere [configurazione delle impostazioni di posta elettronica](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [personalizzazione del comportamento a livello di sito per pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="c94e6-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="c94e6-169">Salvare e chiudere *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="c94e6-170">Eseguire la pagina *default. cshtml* in un browser.</span><span class="sxs-lookup"><span data-stu-id="c94e6-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![sicurezza-appartenenza-2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="c94e6-172">Se viene visualizzato un errore che indica che una proprietà deve essere un'istanza di `ExtendedMembershipProvider`, è possibile che il sito non sia configurato per utilizzare il sistema di appartenenze Pagine Web ASP.NET (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="c94e6-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="c94e6-173">Questa situazione può talvolta verificarsi se il server di un provider di hosting è configurato in modo diverso rispetto al server locale.</span><span class="sxs-lookup"><span data-stu-id="c94e6-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="c94e6-174">Per risolvere questo problema, aggiungere l'elemento seguente al file *Web. config* del sito:</span><span class="sxs-lookup"><span data-stu-id="c94e6-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="c94e6-175">Aggiungere questo elemento come figlio dell'elemento `<configuration>` e come peer dell'elemento `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="c94e6-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="c94e6-176">Nell'angolo in alto a destra della pagina fare clic sul collegamento **Register (registra** ).</span><span class="sxs-lookup"><span data-stu-id="c94e6-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="c94e6-177">Viene visualizzata la pagina *Register. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="c94e6-178">Immettere un nome utente e una password, quindi fare clic su **registra**.</span><span class="sxs-lookup"><span data-stu-id="c94e6-178">Enter a user name and password and then click **Register**.</span></span>

    ![sicurezza-appartenenza-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="c94e6-180">Quando il sito Web è stato creato dal modello di **sito Starter** , viene creato un database denominato *StarterSite. sdf* nella cartella *app\_data* del sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="c94e6-181">Durante la registrazione, le informazioni utente vengono aggiunte al database.</span><span class="sxs-lookup"><span data-stu-id="c94e6-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="c94e6-182">Se si impostano i valori SMTP, viene inviato un messaggio all'indirizzo di posta elettronica usato per poter completare la registrazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![sicurezza-appartenenza-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="c94e6-184">Passare al programma di posta elettronica e trovare il messaggio, che conterrà il codice di conferma e un collegamento ipertestuale al sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="c94e6-185">Fare clic sul collegamento ipertestuale per attivare l'account.</span><span class="sxs-lookup"><span data-stu-id="c94e6-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="c94e6-186">Il collegamento ipertestuale di conferma apre una pagina di conferma della registrazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![sicurezza-appartenenza-5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="c94e6-188">Fare clic sul collegamento di **accesso** e quindi accedere con l'account registrato.</span><span class="sxs-lookup"><span data-stu-id="c94e6-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="c94e6-189">Dopo aver eseguito l'accesso, i collegamenti di **accesso** e **registrazione** vengono sostituiti da un collegamento di **disconnessione** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="c94e6-190">Il nome dell'account di accesso viene visualizzato come collegamento.</span><span class="sxs-lookup"><span data-stu-id="c94e6-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="c94e6-191">Il collegamento consente di passare a una pagina in cui è possibile modificare la password.</span><span class="sxs-lookup"><span data-stu-id="c94e6-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![sicurezza-appartenenza-6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="c94e6-193">Per impostazione predefinita, le pagine Web ASP.NET inviano le credenziali al server in testo non crittografato, come testo leggibile.</span><span class="sxs-lookup"><span data-stu-id="c94e6-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="c94e6-194">Un sito di produzione deve usare il protocollo HTTP protetto (https://, noto anche come *Secure Sockets Layer* o SSL) per crittografare le informazioni riservate scambiate con il server.</span><span class="sxs-lookup"><span data-stu-id="c94e6-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="c94e6-195">È possibile richiedere l'invio di messaggi di posta elettronica tramite SSL impostando `WebMail.EnableSsl=true` come nell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="c94e6-196">Per ulteriori informazioni su SSL, vedere la pagina relativa alla [protezione delle comunicazioni Web: certificati, SSL e https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="c94e6-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="c94e6-197">Funzionalità di appartenenza aggiuntiva nel sito</span><span class="sxs-lookup"><span data-stu-id="c94e6-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="c94e6-198">Il sito contiene altre funzionalità che consentono agli utenti di gestire i propri account.</span><span class="sxs-lookup"><span data-stu-id="c94e6-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="c94e6-199">Gli utenti possono eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="c94e6-199">Users can do the following:</span></span>

- <span data-ttu-id="c94e6-200">Modificare le password.</span><span class="sxs-lookup"><span data-stu-id="c94e6-200">Change their passwords.</span></span> <span data-ttu-id="c94e6-201">Dopo aver eseguito l'accesso, è possibile fare clic sul nome utente (che è un collegamento).</span><span class="sxs-lookup"><span data-stu-id="c94e6-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="c94e6-202">In questo modo si accede a una pagina in cui è possibile creare una nuova password (*account/ChangePassword. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="c94e6-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="c94e6-203">Recuperare una password dimenticata.</span><span class="sxs-lookup"><span data-stu-id="c94e6-203">Recover a forgotten password.</span></span> <span data-ttu-id="c94e6-204">Nella pagina di accesso è presente un collegamento (**si dimentica la password?** ) che consente agli utenti di accedere a una pagina (*account/forgotpassword. cshtml*) in cui è possibile immettere un indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c94e6-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="c94e6-205">Il sito invia un messaggio di posta elettronica con un collegamento su cui è possibile fare clic per impostare una nuova password (*account/PasswordReset. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="c94e6-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="c94e6-206">È anche possibile consentire agli utenti di accedere usando un sito esterno, come illustrato in seguito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="c94e6-207">Creazione di una pagina di solo membri</span><span class="sxs-lookup"><span data-stu-id="c94e6-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="c94e6-208">Per il momento, chiunque può accedere a qualsiasi pagina nel sito Web.</span><span class="sxs-lookup"><span data-stu-id="c94e6-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="c94e6-209">Potrebbe tuttavia essere necessario disporre di pagine che siano disponibili solo per gli utenti che hanno eseguito l'accesso, ovvero ai membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="c94e6-210">ASP.NET consente di creare pagine a cui è possibile accedere solo tramite membri connessi.</span><span class="sxs-lookup"><span data-stu-id="c94e6-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="c94e6-211">In genere, se gli utenti anonimi tentano di accedere a una pagina di solo membri, vengono reindirizzati alla pagina di accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="c94e6-212">In questa procedura verrà creata una cartella che conterrà le pagine disponibili solo per gli utenti connessi.</span><span class="sxs-lookup"><span data-stu-id="c94e6-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="c94e6-213">Alla radice del sito creare una nuova cartella.</span><span class="sxs-lookup"><span data-stu-id="c94e6-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="c94e6-214">Sulla barra multifunzione fare clic sulla freccia sotto **nuova** , quindi scegliere **nuova cartella**.</span><span class="sxs-lookup"><span data-stu-id="c94e6-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="c94e6-215">Assegnare un nome ai nuovi *membri*della cartella.</span><span class="sxs-lookup"><span data-stu-id="c94e6-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="c94e6-216">Nella cartella *membri* creare una nuova pagina e denominarla *MembersInformation. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="c94e6-217">Sostituire il contenuto esistente con il codice e il markup seguenti:</span><span class="sxs-lookup"><span data-stu-id="c94e6-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="c94e6-218">Questo codice testa la proprietà `IsAuthenticated` dell'oggetto `WebSecurity`, che restituisce `true` se l'utente ha eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="c94e6-219">Se l'utente non è connesso, il codice chiama `Response.Redirect` per inviare l'utente alla pagina *login. cshtml* nella cartella *account* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="c94e6-220">L'URL del reindirizzamento include un `returnUrl` valore della stringa di query che utilizza `Request.Url.LocalPath` per impostare il percorso della pagina corrente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="c94e6-221">Se si imposta il valore `returnUrl` nella stringa di query come questa (e se l'URL restituito è un percorso locale), la pagina di accesso restituirà gli utenti a questa pagina dopo l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="c94e6-222">Il codice imposta anche *\_pagina SiteLayout. cshtml* come pagina di layout.</span><span class="sxs-lookup"><span data-stu-id="c94e6-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="c94e6-223">Per ulteriori informazioni sulle pagine di layout, vedere la pagina relativa [alla creazione di un layout coerente nei siti pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202891).</span><span class="sxs-lookup"><span data-stu-id="c94e6-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="c94e6-224">Eseguire il sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-224">Run the site.</span></span> <span data-ttu-id="c94e6-225">Se si è ancora connessi, fare clic sul pulsante **Disconnetti** nella parte superiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="c94e6-226">Nel browser, richiedere la pagina */Members/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="c94e6-227">Ad esempio, l'URL potrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="c94e6-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="c94e6-228">Il numero di porta (38366) sarà probabilmente diverso nell'URL.</span><span class="sxs-lookup"><span data-stu-id="c94e6-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="c94e6-229">Si viene reindirizzati alla pagina *login. cshtml* , perché non è stato effettuato l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="c94e6-230">Accedere con l'account creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c94e6-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="c94e6-231">Si viene reindirizzati di nuovo alla pagina *MembersInformation* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="c94e6-232">Poiché è stato eseguito l'accesso, questa volta viene visualizzato il contenuto della pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="c94e6-233">Per proteggere l'accesso a più pagine, è possibile eseguire questa operazione:</span><span class="sxs-lookup"><span data-stu-id="c94e6-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="c94e6-234">Aggiungere il controllo di sicurezza a ogni pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-234">Add the security check to each page.</span></span>
- <span data-ttu-id="c94e6-235">Creare una pagina *\_PageStart. cshtml* nella cartella in cui si conservano le pagine protette e aggiungere il controllo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="c94e6-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="c94e6-236">La pagina *\_PageStart. cshtml* funge da pagina globale per tutte le pagine della cartella.</span><span class="sxs-lookup"><span data-stu-id="c94e6-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="c94e6-237">Questa tecnica è illustrata in modo più dettagliato nella [personalizzazione del comportamento a livello di sito per pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="c94e6-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="c94e6-238">Creazione della sicurezza per gruppi di utenti (ruoli)</span><span class="sxs-lookup"><span data-stu-id="c94e6-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="c94e6-239">Se il sito ha un numero elevato di membri, non è efficiente controllare l'autorizzazione per ogni singolo utente prima di visualizzare una pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="c94e6-240">È invece possibile creare gruppi o *ruoli*a cui appartengono i singoli membri.</span><span class="sxs-lookup"><span data-stu-id="c94e6-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="c94e6-241">È quindi possibile controllare le autorizzazioni in base al ruolo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-241">You can then check permissions based on role.</span></span> <span data-ttu-id="c94e6-242">In questa sezione verrà creato un ruolo amministratore &quot;&quot; e quindi verrà creata una pagina accessibile agli utenti che fanno parte di tale ruolo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="c94e6-243">Il sistema di appartenenze ASP.NET è configurato per supportare i ruoli.</span><span class="sxs-lookup"><span data-stu-id="c94e6-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="c94e6-244">Tuttavia, a differenza della registrazione e dell'accesso all'appartenenza, il modello di **sito Starter** non contiene pagine che consentono di gestire i ruoli.</span><span class="sxs-lookup"><span data-stu-id="c94e6-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="c94e6-245">(La gestione dei ruoli è un'attività amministrativa anziché un'attività utente). È tuttavia possibile aggiungere gruppi direttamente nel database delle appartenenze in WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="c94e6-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="c94e6-246">In WebMatrix fare clic sul selettore dell'area di lavoro **database** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="c94e6-247">Nel riquadro sinistro aprire il nodo *StarterSite. sdf* , aprire il nodo **tabelle** , quindi fare doppio clic sulla tabella *pagine Web\_ruoli* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![sicurezza-appartenenza-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="c94e6-249">Aggiungere un ruolo denominato &quot;&quot;amministratore.</span><span class="sxs-lookup"><span data-stu-id="c94e6-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="c94e6-250">Il campo *RoleId* viene compilato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="c94e6-251">(Si tratta della chiave primaria ed è stato impostato come campo di identificazione, come illustrato in [Introduzione all'uso di un database nei siti pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202893)).</span><span class="sxs-lookup"><span data-stu-id="c94e6-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="c94e6-252">Prendere nota del valore del campo *RoleId* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="c94e6-253">Se si tratta del primo ruolo che si sta definendo, sarà 1.</span><span class="sxs-lookup"><span data-stu-id="c94e6-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![sicurezza-appartenenza-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="c94e6-255">Chiudere le *pagine web\_tabella Roles* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="c94e6-256">Aprire la tabella *USERPROFILE* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="c94e6-257">Prendere nota del valore *userid* di uno o più utenti nella tabella e quindi chiudere la tabella.</span><span class="sxs-lookup"><span data-stu-id="c94e6-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="c94e6-258">Aprire le *pagine web\_tabella UserInRoles* e immettere un *ID utente* e un valore *roleId* nella tabella.</span><span class="sxs-lookup"><span data-stu-id="c94e6-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="c94e6-259">Ad esempio, per inserire l'utente 2 nel ruolo &quot;amministratore&quot;, immettere i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="c94e6-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![sicurezza-appartenenza-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="c94e6-261">Chiudere le *pagine web\_tabella UsersInRoles* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="c94e6-262">Ora che è stato definito un ruolo, è possibile configurare una pagina accessibile agli utenti che si trovano in tale ruolo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="c94e6-263">Nella cartella radice del sito Web creare una nuova pagina denominata *AdminError. cshtml* e sostituire il contenuto esistente con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="c94e6-264">Si tratta della pagina a cui gli utenti vengono reindirizzati se non sono autorizzati ad accedere a una pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="c94e6-265">Nella cartella radice del sito Web creare una nuova pagina denominata *AdminOnly. cshtml* e sostituire il codice esistente con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="c94e6-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="c94e6-266">Il metodo `Roles.IsUserInRole` restituisce `true` se l'utente corrente è un membro del ruolo specificato (in questo caso, il ruolo "admin").</span><span class="sxs-lookup"><span data-stu-id="c94e6-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="c94e6-267">Eseguire *default. cshtml* in un browser, ma non eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="c94e6-268">(Se si è già connessi, disconnettersi).</span><span class="sxs-lookup"><span data-stu-id="c94e6-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="c94e6-269">Nella barra degli indirizzi del browser aggiungere *AdminOnly* nell'URL.</span><span class="sxs-lookup"><span data-stu-id="c94e6-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="c94e6-270">(In altre parole, richiedere il file *AdminOnly. cshtml* ). Si viene reindirizzati alla pagina *AdminError. cshtml* , perché non si è attualmente connessi come utente nel ruolo di amministratore di &quot;&quot;.</span><span class="sxs-lookup"><span data-stu-id="c94e6-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="c94e6-271">Tornare a *default. cshtml* e accedere con l'utente aggiunto al ruolo di amministratore di &quot;&quot;.</span><span class="sxs-lookup"><span data-stu-id="c94e6-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="c94e6-272">Passare alla pagina *AdminOnly. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="c94e6-273">Questa volta viene visualizzata la pagina.</span><span class="sxs-lookup"><span data-stu-id="c94e6-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="c94e6-274">Impedire ai programmi automatizzati di aggiungersi al sito Web</span><span class="sxs-lookup"><span data-stu-id="c94e6-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="c94e6-275">La pagina di accesso non arresterà i programmi automatizzati (talvolta detti *robot Web* o *bot*) dalla registrazione con il sito Web.</span><span class="sxs-lookup"><span data-stu-id="c94e6-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="c94e6-276">Questa procedura descrive come abilitare un test di reCAPTCHA per la pagina di registrazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="c94e6-278">Registrare il sito Web all'indirizzo ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="c94e6-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="c94e6-279">Al termine della registrazione, si otterranno una chiave pubblica e una chiave privata.</span><span class="sxs-lookup"><span data-stu-id="c94e6-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="c94e6-280">Aggiungere la libreria ASP.NET Web Helper al sito Web come descritto in [installazione di helper in un sito di pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), se non è già stato fatto.</span><span class="sxs-lookup"><span data-stu-id="c94e6-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="c94e6-281">Nella cartella *account* aprire il file denominato *Register. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c94e6-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="c94e6-282">Nel codice nella parte superiore della pagina trovare le righe seguenti e rimuovere il commento rimuovendo i caratteri di commento `//`:</span><span class="sxs-lookup"><span data-stu-id="c94e6-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="c94e6-283">Sostituire `PRIVATE_KEY` con la propria chiave privata reCaptcha.</span><span class="sxs-lookup"><span data-stu-id="c94e6-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="c94e6-284">Nel markup della pagina rimuovere il `@*` e `*@` i caratteri di commento da circa le righe seguenti nel markup della pagina:</span><span class="sxs-lookup"><span data-stu-id="c94e6-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="c94e6-285">Sostituire `PUBLIC_KEY` con la chiave.</span><span class="sxs-lookup"><span data-stu-id="c94e6-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="c94e6-286">Se non è già stato rimosso, rimuovere l'elemento `<div>` che contiene il testo che inizia con "per abilitare la verifica CAPTCHA...".</span><span class="sxs-lookup"><span data-stu-id="c94e6-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="c94e6-287">Rimuovere l'intero elemento `<div>` e il relativo contenuto.</span><span class="sxs-lookup"><span data-stu-id="c94e6-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="c94e6-288">Eseguire *default. cshtml* in un browser.</span><span class="sxs-lookup"><span data-stu-id="c94e6-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="c94e6-289">Se si è connessi al sito, fare clic sul collegamento di **disconnessione** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="c94e6-290">Fare clic sul collegamento **Register** e testare la registrazione usando il test CAPTCHA.</span><span class="sxs-lookup"><span data-stu-id="c94e6-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![sicurezza-appartenenza-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="c94e6-292">Per ulteriori informazioni sull'helper `ReCaptcha`, vedere l'argomento relativo all' [uso di un CATPCHA per impedire che i programmi automatici (bot) utilizzino il sito Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="c94e6-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="c94e6-293">Consentire agli utenti di accedere con un sito esterno</span><span class="sxs-lookup"><span data-stu-id="c94e6-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="c94e6-294">Il modello di **sito Starter** include codice e markup che consente agli utenti di accedere con Facebook, Windows Live, Twitter, Google o Yahoo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="c94e6-295">Per impostazione predefinita, questa funzionalità non è abilitata.</span><span class="sxs-lookup"><span data-stu-id="c94e6-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="c94e6-296">La procedura generale per l'uso di consentire agli utenti di accedere usando questi provider esterni è la seguente:</span><span class="sxs-lookup"><span data-stu-id="c94e6-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="c94e6-297">Decidere quali siti esterni si desidera supportare.</span><span class="sxs-lookup"><span data-stu-id="c94e6-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="c94e6-298">Se necessario, passare a tale sito e configurare un'app di accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="c94e6-299">Ad esempio, è necessario eseguire questa operazione per consentire gli account di accesso di Facebook.</span><span class="sxs-lookup"><span data-stu-id="c94e6-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="c94e6-300">Configurare il provider nel sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-300">In your site, configure the provider.</span></span> <span data-ttu-id="c94e6-301">Nella maggior parte dei casi, è sufficiente rimuovere il commento dal codice nel file *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c94e6-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="c94e6-302">Aggiungere markup alla pagina di registrazione che consente agli utenti di collegarsi al sito esterno per l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="c94e6-303">In genere è possibile copiare il markup necessario e modificare leggermente il testo.</span><span class="sxs-lookup"><span data-stu-id="c94e6-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="c94e6-304">È possibile trovare istruzioni dettagliate nell'argomento [Abilitazione dell'accesso da siti esterni in un sito di pagine Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="c94e6-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="c94e6-305">Dopo che un utente ha eseguito l'accesso da un altro sito, l'utente torna al sito e lo *associa* al sito.</span><span class="sxs-lookup"><span data-stu-id="c94e6-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="c94e6-306">In effetti, viene creata una voce di appartenenza nel sito per l'accesso esterno dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="c94e6-307">In questo modo è possibile usare le normali funzionalità di appartenenza, ad esempio i ruoli, con l'account di accesso esterno.</span><span class="sxs-lookup"><span data-stu-id="c94e6-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="c94e6-308">Aggiunta della sicurezza a un sito Web esistente</span><span class="sxs-lookup"><span data-stu-id="c94e6-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="c94e6-309">La procedura descritta in precedenza in questo articolo si basa sull'uso del modello di **sito Starter** come base per la sicurezza del sito Web.</span><span class="sxs-lookup"><span data-stu-id="c94e6-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="c94e6-310">Se non si è pratici per iniziare dal modello di **sito Starter** o copiare le pagine pertinenti da un sito basato su tale modello, è possibile implementare lo stesso tipo di sicurezza nel proprio sito codificando manualmente.</span><span class="sxs-lookup"><span data-stu-id="c94e6-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="c94e6-311">Si creano gli stessi tipi di pagine, ovvero registrazione, accesso e così via, e quindi si utilizzano helper e classi per configurare l'appartenenza.</span><span class="sxs-lookup"><span data-stu-id="c94e6-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="c94e6-312">Il processo di base è descritto nel post del Blog [il modo più semplice per implementare la sicurezza di ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="c94e6-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="c94e6-313">La maggior parte del lavoro viene eseguita utilizzando i metodi e le proprietà seguenti dell'helper `WebSecurity`:</span><span class="sxs-lookup"><span data-stu-id="c94e6-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="c94e6-314">[WebSecurty. UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity. CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="c94e6-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="c94e6-315">Questi metodi consentono di determinare se un utente è già registrato e di registrarli.</span><span class="sxs-lookup"><span data-stu-id="c94e6-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="c94e6-316">[WebSecurty. IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="c94e6-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="c94e6-317">Questa proprietà consente di determinare se l'utente corrente ha eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="c94e6-318">Questa operazione è utile per reindirizzare gli utenti a una pagina di accesso, se non hanno già effettuato l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c94e6-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="c94e6-319">[WebSecurity. login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity. logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="c94e6-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="c94e6-320">Questi metodi registrano un utente all'interno o all'esterno.</span><span class="sxs-lookup"><span data-stu-id="c94e6-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="c94e6-321">[WebSecurity. CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="c94e6-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="c94e6-322">Questa proprietà è utile per visualizzare il nome di accesso dell'utente corrente (se l'utente è connesso).</span><span class="sxs-lookup"><span data-stu-id="c94e6-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="c94e6-323">[WebSecurity. ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="c94e6-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="c94e6-324">Questo metodo è utile se si configura la conferma della posta elettronica per la registrazione.</span><span class="sxs-lookup"><span data-stu-id="c94e6-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="c94e6-325">I dettagli sono descritti nel post di Blog [relativo all'uso della funzionalità di conferma per pagine Web ASP.NET sicurezza](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="c94e6-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="c94e6-326">Per gestire i ruoli, è possibile usare le classi [roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) e [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) , come descritto nel post di Blog.</span><span class="sxs-lookup"><span data-stu-id="c94e6-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c94e6-327">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="c94e6-327">Additional Resources</span></span>

- [<span data-ttu-id="c94e6-328">Personalizzazione del comportamento a livello di sito</span><span class="sxs-lookup"><span data-stu-id="c94e6-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="c94e6-329">Protezione delle comunicazioni Web: certificati, SSL e https://</span><span class="sxs-lookup"><span data-stu-id="c94e6-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="c94e6-330">[Il modo più semplice per implementare la sicurezza Razor di ASP.NET](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) e [usare la funzionalità di conferma per pagine Web ASP.NET sicurezza](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="c94e6-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="c94e6-331">Questi sono post di Blog che descrivono come implementare le funzionalità di appartenenza a ASP.NET senza usare il modello di **sito Starter** .</span><span class="sxs-lookup"><span data-stu-id="c94e6-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="c94e6-332">Abilitazione dell'accesso da siti esterni in un sito con pagine Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c94e6-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="c94e6-333">Informazioni di [riferimento sulle API della classe WebSecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="c94e6-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="c94e6-334">Informazioni di [riferimento sulle API della classe SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="c94e6-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="c94e6-335">Informazioni di [riferimento sulle API della classe SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="c94e6-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
