---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Introduzione a pagine Web ASP.NET - aggiornamento di dati del Database | Microsoft Docs
author: Rick-Anderson
description: Questa esercitazione illustra come aggiornare la voce (modifica) un database esistente quando si usa ASP.NET Web Pages (Razor). Si presuppone di aver completato la serie th...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 4542ad3ac3e321629bb4de3cd4df12c22ff6cb20
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59414621"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="13439-104">Introduzione a pagine Web ASP.NET - aggiornamento di dati del Database</span><span class="sxs-lookup"><span data-stu-id="13439-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="13439-105">da [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="13439-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="13439-106">Questa esercitazione illustra come aggiornare la voce (modifica) un database esistente quando si usa ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="13439-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="13439-107">Si presuppone di aver completato la serie attraverso [immissione di dati da usando form con ASP.NET Web Pages](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="13439-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="13439-108">Che cosa si apprenderà come:</span><span class="sxs-lookup"><span data-stu-id="13439-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="13439-109">Come selezionare un singolo record nel `WebGrid` helper.</span><span class="sxs-lookup"><span data-stu-id="13439-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="13439-110">Come leggere un singolo record da un database.</span><span class="sxs-lookup"><span data-stu-id="13439-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="13439-111">Come caricare un modulo con i valori del record del database in background.</span><span class="sxs-lookup"><span data-stu-id="13439-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="13439-112">Come aggiornare un record esistente in un database.</span><span class="sxs-lookup"><span data-stu-id="13439-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="13439-113">Come archiviare le informazioni nella pagina senza visualizzarla.</span><span class="sxs-lookup"><span data-stu-id="13439-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="13439-114">Come usare un campo nascosto per archiviare le informazioni.</span><span class="sxs-lookup"><span data-stu-id="13439-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="13439-115">Le funzionalità/tecnologie illustrate:</span><span class="sxs-lookup"><span data-stu-id="13439-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="13439-116">Il `WebGrid` helper.</span><span class="sxs-lookup"><span data-stu-id="13439-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="13439-117">Il codice SQL `Update` comando.</span><span class="sxs-lookup"><span data-stu-id="13439-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="13439-118">Metodo `Database.Execute` .</span><span class="sxs-lookup"><span data-stu-id="13439-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="13439-119">Campi nascosti (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="13439-119">Hidden fields (`<input type="hidden">`).</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="13439-120">Scopo dell'esercitazione</span><span class="sxs-lookup"><span data-stu-id="13439-120">What You'll Build</span></span>

<span data-ttu-id="13439-121">Nell'esercitazione precedente, è stato descritto come aggiungere un record a un database.</span><span class="sxs-lookup"><span data-stu-id="13439-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="13439-122">In questo caso, si apprenderà come visualizzare un record per la modifica.</span><span class="sxs-lookup"><span data-stu-id="13439-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="13439-123">Nel *film* pagina, si aggiornerà il `WebGrid` helper, in modo che venga visualizzato un **modifica** collegamento accanto a ogni film:</span><span class="sxs-lookup"><span data-stu-id="13439-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![WebGrid visualizzare con un collegamento "Modifica" per ogni film](updating-data/_static/image1.png)

<span data-ttu-id="13439-125">Quando si sceglie la **modifica** collegamento, consente a un'altra pagina, in cui le informazioni relative al filmato è già in un form:</span><span class="sxs-lookup"><span data-stu-id="13439-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Modifica pagina film che mostra di film da modificare](updating-data/_static/image2.png)

<span data-ttu-id="13439-127">È possibile modificare i valori.</span><span class="sxs-lookup"><span data-stu-id="13439-127">You can change any of the values.</span></span> <span data-ttu-id="13439-128">Quando si inviano le modifiche, il codice nella pagina Aggiorna il database e consente di tornare all'elenco di film.</span><span class="sxs-lookup"><span data-stu-id="13439-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="13439-129">Questa parte del processo funziona quasi esattamente come le *AddMovie.cshtml* pagina creata nell'esercitazione precedente, in modo che la maggior parte di questa esercitazione sarà familiare.</span><span class="sxs-lookup"><span data-stu-id="13439-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="13439-130">Esistono diversi modi, è possibile implementare un metodo per modificare un film singoli.</span><span class="sxs-lookup"><span data-stu-id="13439-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="13439-131">L'approccio illustrato è stato scelto perché è facile da implementare e facile da comprendere.</span><span class="sxs-lookup"><span data-stu-id="13439-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="13439-132">Aggiunta di un collegamento di modifica per l'elenco di film</span><span class="sxs-lookup"><span data-stu-id="13439-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="13439-133">Per iniziare, si aggiornerà il *film* pagina in modo che ogni film anche l'elenco contenga un' **modificare** collegamento.</span><span class="sxs-lookup"><span data-stu-id="13439-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="13439-134">Aprire il *Movies.cshtml* file.</span><span class="sxs-lookup"><span data-stu-id="13439-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="13439-135">Nel corpo della pagina, modificare il `WebGrid` markup mediante l'aggiunta di una colonna.</span><span class="sxs-lookup"><span data-stu-id="13439-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="13439-136">Ecco il markup modificato:</span><span class="sxs-lookup"><span data-stu-id="13439-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="13439-137">La nuova colonna è questa:</span><span class="sxs-lookup"><span data-stu-id="13439-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="13439-138">Il punto di questo articolo è mostrare un collegamento (`<a>` elemento) con il testo "Modifica".</span><span class="sxs-lookup"><span data-stu-id="13439-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="13439-139">Siamo dopo consiste nel creare un collegamento che è simile al seguente quando viene eseguita la pagina, con la `id` valore diverso per ogni film:</span><span class="sxs-lookup"><span data-stu-id="13439-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="13439-140">Questo collegamento verrà richiamato una pagina denominata *EditMovie*, e lo passerà la stringa di query `?id=7` a tale pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="13439-141">La sintassi per la nuova colonna potrebbe sembrare un po' complessa, ma solo perché scoperte diversi elementi.</span><span class="sxs-lookup"><span data-stu-id="13439-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="13439-142">Ogni singolo elemento è semplice.</span><span class="sxs-lookup"><span data-stu-id="13439-142">Each individual element is straightforward.</span></span> <span data-ttu-id="13439-143">Se concentrerà sul solo il `<a>` elemento, noterete che questo markup:</span><span class="sxs-lookup"><span data-stu-id="13439-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="13439-144">Alcune informazioni di base sul funzionamento della griglia: nella griglia vengono visualizzate righe, una per ogni record di database, e visualizza le colonne per ogni campo nel record del database.</span><span class="sxs-lookup"><span data-stu-id="13439-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="13439-145">Mentre viene creato ogni riga della griglia, il `item` oggetto contiene i record del database (elemento) per quella riga.</span><span class="sxs-lookup"><span data-stu-id="13439-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="13439-146">Questa disposizione consente di ottenere i dati per la riga di codice.</span><span class="sxs-lookup"><span data-stu-id="13439-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="13439-147">Questo è ciò che vedete qui: l'espressione `item.ID` riceve il valore ID della voce di database corrente.</span><span class="sxs-lookup"><span data-stu-id="13439-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="13439-148">È possibile ottenere i valori del database (title, genre o year) allo stesso modo usando `item.Title`, `item.Genre`, o `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="13439-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="13439-149">L'espressione `"~/EditMovie?id=@item.ID` combina la parte dell'URL di destinazione a livello di codice (`~/EditMovie?id=`) riferendo questo ID in modo dinamico derivato.</span><span class="sxs-lookup"><span data-stu-id="13439-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="13439-150">(Si è visto il `~` operatore nell'esercitazione precedente; è un operatore di ASP.NET che rappresenta la radice del sito Web corrente.)</span><span class="sxs-lookup"><span data-stu-id="13439-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="13439-151">Il risultato è che questa parte del markup nella colonna semplicemente produce un risultato analogo il markup seguente in fase di esecuzione:</span><span class="sxs-lookup"><span data-stu-id="13439-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="13439-152">Naturalmente, il valore effettivo del `id` sarà diverso per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="13439-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="13439-153">Creazione di una visualizzazione personalizzata per una colonna della griglia</span><span class="sxs-lookup"><span data-stu-id="13439-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="13439-154">A questo punto eseguire il backup per la colonna della griglia.</span><span class="sxs-lookup"><span data-stu-id="13439-154">Now back to the grid column.</span></span> <span data-ttu-id="13439-155">Le tre colonne in origine era la griglia visualizzata solo i valori dei dati (titolo, il genere e anno).</span><span class="sxs-lookup"><span data-stu-id="13439-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="13439-156">Questa visualizzazione è specificato passando il nome della colonna del database &mdash; ad esempio, `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="13439-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="13439-157">Questa nuova **modifica** colonna di collegamento è diverso.</span><span class="sxs-lookup"><span data-stu-id="13439-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="13439-158">Anziché specificare un nome di colonna, si sta passando un `format` parametro.</span><span class="sxs-lookup"><span data-stu-id="13439-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="13439-159">Questo parametro consente di definire markup che il `WebGrid` helper verrà eseguito il rendering con il `item` valore per visualizzare i dati della colonna in grassetto o colore verde o in qualsiasi formato che si desidera.</span><span class="sxs-lookup"><span data-stu-id="13439-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="13439-160">Ad esempio, se si vuole ottenere il titolo da visualizzare in grassetto, è possibile creare una colonna come in questo esempio:</span><span class="sxs-lookup"><span data-stu-id="13439-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="13439-161">(I vari `@` caratteri presenti il `format` proprietà contrassegnare la transizione tra i tag e un valore del codice.)</span><span class="sxs-lookup"><span data-stu-id="13439-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="13439-162">Dopo aver appreso informazioni sul `format` proprietà, è più facile da comprendere come le nuove **modifica** colonna di collegamento viene raccolto:</span><span class="sxs-lookup"><span data-stu-id="13439-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="13439-163">La colonna è costituita da *solo* del markup che esegue il rendering di collegamento, inoltre alcune informazioni (ID) che viene estratto il record del database per la riga.</span><span class="sxs-lookup"><span data-stu-id="13439-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="13439-164">**I parametri denominati e i parametri posizionali per un metodo**</span><span class="sxs-lookup"><span data-stu-id="13439-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="13439-165">Numero di volte dopo aver chiamato un metodo e passati parametri a esso, è sufficiente elencati i valori dei parametri separati da virgole.</span><span class="sxs-lookup"><span data-stu-id="13439-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="13439-166">Di seguito sono riportati alcuni esempi:</span><span class="sxs-lookup"><span data-stu-id="13439-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="13439-167">È non è importante tenere presente il problema quando si è visto prima di tutto questo codice, ma in ogni caso, si sta passando i parametri ai metodi in un ordine specifico &mdash; vale a dire, l'ordine in cui i parametri sono definiti in tale metodo.</span><span class="sxs-lookup"><span data-stu-id="13439-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="13439-168">Per la `db.Execute` e `Validation.RequireFields`, se combinare l'ordine dei valori passati, si otterrebbe un messaggio di errore quando la pagina viene eseguito, o almeno alcuni risultati imprevisti.</span><span class="sxs-lookup"><span data-stu-id="13439-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="13439-169">Ovviamente, è necessario conoscere l'ordine per passare i parametri in.</span><span class="sxs-lookup"><span data-stu-id="13439-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="13439-170">(In WebMatrix, IntelliSense aiutano individuare il nome, tipo e ordine dei parametri.)</span><span class="sxs-lookup"><span data-stu-id="13439-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="13439-171">Come alternativa al passaggio di valori in ordine, è possibile usare *parametri denominati*.</span><span class="sxs-lookup"><span data-stu-id="13439-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="13439-172">(Il passaggio di parametri nell'ordine è nota come utilizzo *parametri posizionali*.) Per i parametri denominati, si include in modo esplicito il nome del parametro quando si passa il relativo valore.</span><span class="sxs-lookup"><span data-stu-id="13439-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="13439-173">Si usa parametri denominati già un numero di volte in queste esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="13439-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="13439-174">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="13439-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="13439-175">e</span><span class="sxs-lookup"><span data-stu-id="13439-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="13439-176">I parametri denominati sono utili per un paio di casi, specialmente quando un metodo accetta numerosi parametri.</span><span class="sxs-lookup"><span data-stu-id="13439-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="13439-177">Uno è quando si desidera passare solo uno o due parametri, ma i valori che si desidera passare non sono tra le posizioni di primo nell'elenco dei parametri.</span><span class="sxs-lookup"><span data-stu-id="13439-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="13439-178">Un'altra situazione è quando si vuole rendere il codice più leggibile, passando i parametri nell'ordine in cui la scelta più sensata all'utente.</span><span class="sxs-lookup"><span data-stu-id="13439-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="13439-179">Ovviamente, per usare i parametri denominati, è necessario conoscere i nomi dei parametri.</span><span class="sxs-lookup"><span data-stu-id="13439-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="13439-180">WebMatrix IntelliSense possono *mostrare* si i nomi, ma non è attualmente completarle automaticamente.</span><span class="sxs-lookup"><span data-stu-id="13439-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>


## <a name="creating-the-edit-page"></a><span data-ttu-id="13439-181">Creazione della pagina Edit</span><span class="sxs-lookup"><span data-stu-id="13439-181">Creating the Edit Page</span></span>

<span data-ttu-id="13439-182">Ora è possibile creare il *EditMovie* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="13439-183">Quando gli utenti fanno clic la **modifica** collegamento, si otterrà in questa pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="13439-184">Creare una pagina denominata *EditMovie.cshtml* e sostituire quello presente nel file con il markup seguente:</span><span class="sxs-lookup"><span data-stu-id="13439-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="13439-185">Questo markup e codice è simile a quello che hai *AddMovie* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="13439-186">È una piccola differenza nel testo per il pulsante di invio.</span><span class="sxs-lookup"><span data-stu-id="13439-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="13439-187">Come con la *AddMovie* pagina, è presente un `Html.ValidationSummary` chiamata che verrà visualizzati gli errori di convalida se presenti.</span><span class="sxs-lookup"><span data-stu-id="13439-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="13439-188">Questa volta abbiamo stiamo escludendo le chiamate a `Validation.Message`, dal momento che gli errori vengono visualizzati nel riepilogo di convalida.</span><span class="sxs-lookup"><span data-stu-id="13439-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="13439-189">Come indicato nell'esercitazione precedente, è possibile usare il riepilogo di convalida e i singoli messaggi di errore in varie combinazioni.</span><span class="sxs-lookup"><span data-stu-id="13439-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="13439-190">Si noti anche in questo caso che la `method` attributo del `<form>` elemento è impostato su `post`.</span><span class="sxs-lookup"><span data-stu-id="13439-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="13439-191">Come con le *AddMovie.cshtml* pagina, questa pagina apporta le modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="13439-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="13439-192">Pertanto, questo modulo è necessario eseguire un `POST` operazione.</span><span class="sxs-lookup"><span data-stu-id="13439-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="13439-193">(Per altre informazioni sulla differenza tra `GET` e `POST` operazioni, vedere la [GET, POST e HTTP verbo Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) intestazione laterale nell'esercitazione nei form HTML.)</span><span class="sxs-lookup"><span data-stu-id="13439-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="13439-194">Come si è visto in un'esercitazione precedente, il `value` vengono impostati gli attributi delle caselle di testo con il codice Razor per precaricare li.</span><span class="sxs-lookup"><span data-stu-id="13439-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="13439-195">Stavolta, però, si usa variabili come `title` e `genre` per tale attività anziché `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="13439-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="13439-196">Come prima, questo markup verrà precaricare i valori della casella di testo con i valori di film.</span><span class="sxs-lookup"><span data-stu-id="13439-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="13439-197">Verrà visualizzato a breve perché è utile usare le variabili, questa volta invece di usare il `Request` oggetto.</span><span class="sxs-lookup"><span data-stu-id="13439-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="13439-198">È inoltre disponibile un `<input type="hidden">` elemento in questa pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="13439-199">Questo elemento archivia l'ID del film senza renderlo visibile nella pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="13439-200">L'ID viene passato inizialmente per la pagina in base usando un valore di stringa di query (`?id=7` o simili nell'URL).</span><span class="sxs-lookup"><span data-stu-id="13439-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="13439-201">Inserendo il valore ID in un campo nascosto, è possibile assicurarsi che sia disponibile quando il form viene inviato, anche se non è più necessario l'accesso all'URL originale della pagina è stata richiamata con.</span><span class="sxs-lookup"><span data-stu-id="13439-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="13439-202">A differenza di *AddMovie* pagina, il codice per il *EditMovie* pagina contiene due funzioni distinte.</span><span class="sxs-lookup"><span data-stu-id="13439-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="13439-203">La prima funzione è che, quando la pagina viene visualizzata per la prima volta (e *solo* quindi), il codice ottiene l'ID del film dalla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="13439-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="13439-204">Il codice quindi utilizza l'ID per leggere il film corrispondente all'esterno del database e visualizzare (Precarica), nelle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="13439-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="13439-205">La seconda funzione è che quando l'utente sceglie il **Invia modifiche** pulsante, il codice deve leggere i valori di caselle di testo e la successiva convalida.</span><span class="sxs-lookup"><span data-stu-id="13439-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="13439-206">Il codice ha anche aggiornare l'elemento di database con i nuovi valori.</span><span class="sxs-lookup"><span data-stu-id="13439-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="13439-207">Questa tecnica è analoga all'aggiunta di un record, come illustrato nelle *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="13439-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="13439-208">Aggiunta di codice per leggere un singolo filmato</span><span class="sxs-lookup"><span data-stu-id="13439-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="13439-209">Per eseguire la prima funzione, aggiungere questo codice nella parte superiore della pagina:</span><span class="sxs-lookup"><span data-stu-id="13439-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="13439-210">La maggior parte di questo codice si trova all'interno di un blocco che inizia `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="13439-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="13439-211">Il `!` operatore significa "not", in modo che l'espressione significa *se la richiesta non ha un invio post*, che costituisce un metodo indiretto viene espresso indicando *se la richiesta è la prima volta che questa pagina è stata eseguita*.</span><span class="sxs-lookup"><span data-stu-id="13439-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="13439-212">Come indicato in precedenza, questo codice deve essere eseguito *solo* alla prima esecuzione della pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="13439-213">Se si non racchiudere il codice in `if(!IsPost)`, viene eseguito ogni volta che la pagina viene richiamata, se la prima volta oppure in risposta a un pulsante fare clic su.</span><span class="sxs-lookup"><span data-stu-id="13439-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="13439-214">Si noti che il codice include un `else` bloccare questo momento.</span><span class="sxs-lookup"><span data-stu-id="13439-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="13439-215">Come detto in precedenza quando è stato introdotto `if` blocchi, talvolta si desidera eseguire codice alternativo se non viene soddisfatta la condizione che si sta testando.</span><span class="sxs-lookup"><span data-stu-id="13439-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="13439-216">Ovvero in questo caso.</span><span class="sxs-lookup"><span data-stu-id="13439-216">That's the case here.</span></span> <span data-ttu-id="13439-217">Se la condizione ha esito positivo (ovvero, se l'ID passato alla pagina è ok), leggere una riga dal database.</span><span class="sxs-lookup"><span data-stu-id="13439-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="13439-218">Tuttavia, se la condizione non viene superato, il `else` blocco viene eseguito e il codice imposta un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="13439-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="13439-219">La convalida di un valore passato alla pagina</span><span class="sxs-lookup"><span data-stu-id="13439-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="13439-220">Il codice Usa `Request.QueryString["id"]` per ottenere l'ID che viene passato alla pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="13439-221">Il codice consente di verificare che in realtà è stato passato un valore per l'ID.</span><span class="sxs-lookup"><span data-stu-id="13439-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="13439-222">Se è stato passato alcun valore, il codice imposta un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="13439-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="13439-223">Questo codice illustra un modo diverso per convalidare le informazioni.</span><span class="sxs-lookup"><span data-stu-id="13439-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="13439-224">Nell'esercitazione precedente, si è lavorato con i `Validation` helper.</span><span class="sxs-lookup"><span data-stu-id="13439-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="13439-225">I campi per la convalida è stata registrata, ASP.NET automaticamente e ha la convalida visualizzati gli errori usando `Html.ValidationMessage` e `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="13439-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="13439-226">In questo caso, tuttavia, si effettua non realmente la convalida dell'input dell'utente.</span><span class="sxs-lookup"><span data-stu-id="13439-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="13439-227">Al contrario, si effettua la convalida di un valore che è stato passato alla pagina da un' posizione.</span><span class="sxs-lookup"><span data-stu-id="13439-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="13439-228">Il `Validation` helper che non esegue automaticamente.</span><span class="sxs-lookup"><span data-stu-id="13439-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="13439-229">Pertanto, è controllare il valore manualmente, eseguendo il test con `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="13439-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="13439-230">Se si è verificato un problema, è possibile visualizzare l'errore utilizzando `Html.ValidationSummary`, come accadeva con le `Validation` helper.</span><span class="sxs-lookup"><span data-stu-id="13439-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="13439-231">A tale scopo, si chiama `Validation.AddFormError` e passarlo a un messaggio da visualizzare.</span><span class="sxs-lookup"><span data-stu-id="13439-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="13439-232">`Validation.AddFormError` è un metodo incorporato che consente di definire messaggi personalizzati da unire con il sistema di convalida che ha già familiarità.</span><span class="sxs-lookup"><span data-stu-id="13439-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="13439-233">(Più avanti in questa esercitazione parleremo come rendere questo processo di convalida più solido.)</span><span class="sxs-lookup"><span data-stu-id="13439-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="13439-234">Dopo aver verificato che vi sia un ID per il film, il codice legge il database, cercando solo un elemento singolo database.</span><span class="sxs-lookup"><span data-stu-id="13439-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="13439-235">(Probabilmente si noterà il modello generale per le operazioni di database: aprire il database, definire un'istruzione SQL ed eseguire l'istruzione.) Questa volta, il codice SQL `Select` istruzione include `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="13439-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="13439-236">Poiché l'ID è univoco, può essere restituito un solo record.</span><span class="sxs-lookup"><span data-stu-id="13439-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="13439-237">La query viene eseguita usando `db.QuerySingle` (non `db.Query`, come è stato utilizzato per l'elenco dei filmati), e il codice inserisce il risultato nel `row` variabile.</span><span class="sxs-lookup"><span data-stu-id="13439-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="13439-238">Il nome `row` è arbitrario; puoi le variabili di qualsiasi nome desiderato.</span><span class="sxs-lookup"><span data-stu-id="13439-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="13439-239">Le variabili inizializzate in alto vengono compilate con i dettagli di film in modo che questi valori possono essere visualizzati nelle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="13439-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="13439-240">Test della pagina Edit (fino a questo momento)</span><span class="sxs-lookup"><span data-stu-id="13439-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="13439-241">Se si desidera testare la pagina, eseguire la *film* ora e fare clic su un **modificare** collegamento accanto a eventuali film.</span><span class="sxs-lookup"><span data-stu-id="13439-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="13439-242">Verrà visualizzato il *EditMovie* compilato pagina con i dettagli per il film selezionato:</span><span class="sxs-lookup"><span data-stu-id="13439-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Modifica pagina film che mostra di film da modificare](updating-data/_static/image3.png)

<span data-ttu-id="13439-244">Si noti che l'URL della pagina include un elemento, ad esempio `?id=10` (o un altro numero).</span><span class="sxs-lookup"><span data-stu-id="13439-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="13439-245">Finora hai testato che **Edit** collega nel *film* pagina lavoro, che la pagina viene letta l'ID dalla stringa di query, e che il database di eseguire una query per ottenere un record singolo filmato sia funzionante.</span><span class="sxs-lookup"><span data-stu-id="13439-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="13439-246">È possibile modificare le informazioni relative al filmato, ma non accade nulla quando si fa clic su **Invia modifiche**.</span><span class="sxs-lookup"><span data-stu-id="13439-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="13439-247">Aggiunta di codice per aggiornare il film con le modifiche dell'utente</span><span class="sxs-lookup"><span data-stu-id="13439-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="13439-248">Nel *EditMovie.cshtml* , per implementare la seconda funzione (salvataggio delle modifiche), aggiungere il codice seguente all'interno di parentesi graffa di chiusura di `@` blocco.</span><span class="sxs-lookup"><span data-stu-id="13439-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="13439-249">(Se non si conosce esattamente dove inserire il codice, è possibile esaminare i [elenco di codice per la pagina Modifica film](#Complete_Page_Listing_for_EditMovie) che compare alla fine di questa esercitazione.)</span><span class="sxs-lookup"><span data-stu-id="13439-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="13439-250">Anche in questo caso è simile al codice in questo markup e codice *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="13439-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="13439-251">Il codice è in un `if(IsPost)` bloccare, poiché questo codice viene eseguito solo quando l'utente fa clic il **Invia modifiche** pulsante &mdash; , ovvero quando (e solo quando) ha inviato il form.</span><span class="sxs-lookup"><span data-stu-id="13439-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="13439-252">In questo caso, non si usa un test come `if(IsPost && Validation.IsValid())`, vale a dire, da non combinare entrambi i test tramite and.</span><span class="sxs-lookup"><span data-stu-id="13439-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="13439-253">In questa pagina, prima di tutto determinare se è presente l'invio di un form (`if(IsPost)`) e registrare solo i campi per la convalida.</span><span class="sxs-lookup"><span data-stu-id="13439-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="13439-254">Quindi è possibile testare i risultati della convalida (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="13439-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="13439-255">Il flusso è leggermente diverso da quella di *AddMovie.cshtml* pagina, ma l'effetto è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="13439-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="13439-256">Ottenere i valori di caselle di testo usando `Request.Form["title"]` e un codice simile per gli altri `<input>` elementi.</span><span class="sxs-lookup"><span data-stu-id="13439-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="13439-257">Si noti che questa volta, il codice di ottenere l'ID del film all'esterno del campo nascosto (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="13439-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="13439-258">Quando la pagina è stata eseguita la prima volta, il codice segue l'ID dalla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="13439-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="13439-259">Si ottiene il valore del campo nascosto per assicurarsi di ottenere l'ID del film che originariamente è stato visualizzato, nel caso in cui la stringa di query è stata modificata in qualche modo da allora.</span><span class="sxs-lookup"><span data-stu-id="13439-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="13439-260">La differenza fondamentale tra i *AddMovie* codice e questo codice è che in questo codice è usare il codice SQL `Update` istruzione anziché il `Insert Into` istruzione.</span><span class="sxs-lookup"><span data-stu-id="13439-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="13439-261">L'esempio seguente illustra la sintassi SQL `Update` istruzione:</span><span class="sxs-lookup"><span data-stu-id="13439-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="13439-262">È possibile specificare tutte le colonne in qualsiasi ordine, e non necessariamente aggiornare tutte le colonne durante un `Update` operazione.</span><span class="sxs-lookup"><span data-stu-id="13439-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="13439-263">(Non è possibile aggiornare l'ID, in quanto che risparmierebbe in vigore il record come nuovo record, e che non è consentito per un `Update` operazione.)</span><span class="sxs-lookup"><span data-stu-id="13439-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="13439-264">**Importanti** il `Where` clausola con l'ID è molto importante, perché questo è come il database sappia quale database record che si desidera aggiornare.</span><span class="sxs-lookup"><span data-stu-id="13439-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="13439-265">Se è stata interrotta la `Where` clausola, il database aggiornerebbero *ogni* record nel database.</span><span class="sxs-lookup"><span data-stu-id="13439-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="13439-266">Nella maggior parte dei casi, sarebbe una situazione di emergenza.</span><span class="sxs-lookup"><span data-stu-id="13439-266">In most cases, that would be a disaster.</span></span>


<span data-ttu-id="13439-267">Nel codice, i valori da aggiornare vengono passati all'istruzione SQL con i segnaposto.</span><span class="sxs-lookup"><span data-stu-id="13439-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="13439-268">Per ripetere quanto abbiamo detto prima: per motivi di sicurezza *solo* usare i segnaposto per passare i valori in un'istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="13439-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="13439-269">Dopo che il codice Usa `db.Execute` per eseguire il `Update` istruzione, viene reindirizzato alla pagina di presentazione, in cui è possibile visualizzare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="13439-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="13439-270">**Istruzioni SQL differenti, diversi metodi**</span><span class="sxs-lookup"><span data-stu-id="13439-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="13439-271">Si potrebbe notare l'uso di metodi leggermente diversi per eseguire diverse istruzioni SQL.</span><span class="sxs-lookup"><span data-stu-id="13439-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="13439-272">Per eseguire una `Select` query che potrebbero restituisce più record, si utilizza il `Query` (metodo).</span><span class="sxs-lookup"><span data-stu-id="13439-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="13439-273">Per eseguire una `Select` query che già conosci restituirà un solo elemento di database, si utilizza il `QuerySingle` (metodo).</span><span class="sxs-lookup"><span data-stu-id="13439-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="13439-274">Per eseguire comandi che apportano modifiche, ma che non restituiscono gli elementi di database, si utilizza il `Execute` (metodo).</span><span class="sxs-lookup"><span data-stu-id="13439-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="13439-275">È necessario avere diversi metodi in quanto ognuno di essi restituisce risultati diversi, come già illustrato la differenza tra `Query` e `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="13439-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="13439-276">(Il `Execute` metodo effettivamente restituisce un valore anche &mdash; vale a dire, il numero di righe di database che sono stati interessati dal comando &mdash; ma si è stati ignorando che finora.)</span><span class="sxs-lookup"><span data-stu-id="13439-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="13439-277">Naturalmente, il `Query` metodo può restituire solo una riga di database.</span><span class="sxs-lookup"><span data-stu-id="13439-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="13439-278">ASP.NET, tuttavia, Considera sempre i risultati del `Query` metodo come una raccolta.</span><span class="sxs-lookup"><span data-stu-id="13439-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="13439-279">Anche se il metodo restituisce una sola riga, è necessario estrarre tale singola riga dalla raccolta.</span><span class="sxs-lookup"><span data-stu-id="13439-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="13439-280">Pertanto, nelle situazioni in cui si *conoscere* verranno restituite solo una riga, è un po' più comodo usare `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="13439-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="13439-281">Esistono alcuni altri metodi che eseguono tipi specifici di operazioni di database.</span><span class="sxs-lookup"><span data-stu-id="13439-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="13439-282">È possibile trovare un elenco dei metodi di database nel [riferimento rapido di ASP.NET Web Pages API](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="13439-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>


## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="13439-283">Effettua la convalida per l'ID più affidabile</span><span class="sxs-lookup"><span data-stu-id="13439-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="13439-284">La prima volta che viene eseguita la pagina, si ottiene l'ID del film dalla stringa di query in modo che è possibile passare a ottenere il film dal database.</span><span class="sxs-lookup"><span data-stu-id="13439-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="13439-285">È stata verificata la realtà è stato un valore da passare a cercare, che è avvenuto tramite questo codice:</span><span class="sxs-lookup"><span data-stu-id="13439-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="13439-286">Questo codice è stato usato per assicurarsi che se un utente per il *EditMovies* pagina senza selezionare prima un film nel *film* pagina, la pagina verrà visualizzato un messaggio di errore descrittivo.</span><span class="sxs-lookup"><span data-stu-id="13439-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="13439-287">(In caso contrario, gli utenti verrebbero visualizzato un errore che sarebbe probabilmente sufficiente confonderli).</span><span class="sxs-lookup"><span data-stu-id="13439-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="13439-288">Tuttavia, la convalida non è molto efficace.</span><span class="sxs-lookup"><span data-stu-id="13439-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="13439-289">La pagina potrebbe anche essere chiamata con questi errori:</span><span class="sxs-lookup"><span data-stu-id="13439-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="13439-290">L'ID non è un numero.</span><span class="sxs-lookup"><span data-stu-id="13439-290">The ID isn't a number.</span></span> <span data-ttu-id="13439-291">Ad esempio, la pagina potrebbe essere richiamata con un URL come `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="13439-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="13439-292">L'ID è un numero, ma fa riferimento a un filmato che non esiste (ad esempio, `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="13439-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="13439-293">Se si è interessati a visualizzare gli errori risultanti da questi URL, eseguire la *film* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="13439-294">Selezionare un film per modificare e quindi modificare l'URL del *EditMovie* pagina a un URL che contiene un carattere alfabetico, ID o l'ID di un film inesistente.</span><span class="sxs-lookup"><span data-stu-id="13439-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="13439-295">Quindi, cosa fare?</span><span class="sxs-lookup"><span data-stu-id="13439-295">So what should you do?</span></span> <span data-ttu-id="13439-296">La prima correzione consiste nell'assicurarsi che non solo è un ID passato alla pagina, ma che l'ID è un numero intero.</span><span class="sxs-lookup"><span data-stu-id="13439-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="13439-297">Modificare il codice per il `!IsPost` test come illustrato in questo esempio:</span><span class="sxs-lookup"><span data-stu-id="13439-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="13439-298">È stato aggiunto una seconda condizione il `IsEmpty` test, collegate con `&&` (AND logico):</span><span class="sxs-lookup"><span data-stu-id="13439-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="13439-299">Si ricorderà dal [Introduzione alla programmazione di ASP.NET Web Pages](../introducing-razor-syntax-c.md) esercitazione che metodi come `AsBool` un `AsInt` convertire una stringa di caratteri in un altro tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="13439-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="13439-300">Il `IsInt` metodo (e altri, come `IsBool` e `IsDateTime`) sono simili.</span><span class="sxs-lookup"><span data-stu-id="13439-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="13439-301">Tuttavia, eseguono il test solo se si *possibile* convertire la stringa, senza eseguire effettivamente la conversione.</span><span class="sxs-lookup"><span data-stu-id="13439-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="13439-302">Quindi, qui significa fondamentalmente *se il valore di stringa di query può essere convertito in un numero intero...* .</span><span class="sxs-lookup"><span data-stu-id="13439-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="13439-303">Potenziale problema sta cercando un film che non esiste.</span><span class="sxs-lookup"><span data-stu-id="13439-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="13439-304">Il codice per ottenere un film è simile a questo codice:</span><span class="sxs-lookup"><span data-stu-id="13439-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="13439-305">Se si passa una `movieId` valore per il `QuerySingle` metodo che non corrisponde a un film effettivo, non viene restituito e le istruzioni che seguono (ad esempio, `title=row.Title`) comportare errori.</span><span class="sxs-lookup"><span data-stu-id="13439-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="13439-306">Anche in questo caso è facile apportare la correzione.</span><span class="sxs-lookup"><span data-stu-id="13439-306">Again there's an easy fix.</span></span> <span data-ttu-id="13439-307">Se il `db.QuerySingle` metodo non restituisce alcun risultato, il `row` variabile sarà null.</span><span class="sxs-lookup"><span data-stu-id="13439-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="13439-308">Sarà pertanto possibile controllare se il `row` variabile è null prima di provare a ottenere i valori da quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="13439-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="13439-309">Il codice seguente aggiunge un' `if` blocco intorno alle istruzioni che ottengono i valori fuori il `row` oggetto:</span><span class="sxs-lookup"><span data-stu-id="13439-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="13439-310">Con questi due test di convalida aggiuntivi, la pagina diventa più valide.</span><span class="sxs-lookup"><span data-stu-id="13439-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="13439-311">Il codice completo per il `!IsPost` ramo avrà ora un aspetto simile all'esempio:</span><span class="sxs-lookup"><span data-stu-id="13439-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="13439-312">Si noterà che ancora una volta che questa attività è un utilizzo corretto per un `else` blocco.</span><span class="sxs-lookup"><span data-stu-id="13439-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="13439-313">Se il test non superati, il `else` blocchi impostato i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="13439-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="13439-314">Aggiunta di un collegamento per tornare alla pagina Movies</span><span class="sxs-lookup"><span data-stu-id="13439-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="13439-315">Un dettaglio finale e utile consiste nell'aggiungere un collegamento al *film* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="13439-316">Nel flusso ordinario di eventi, gli utenti inizieranno al *film* e fare clic su un **modificare** collegamento.</span><span class="sxs-lookup"><span data-stu-id="13439-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="13439-317">Che viene visualizzato il *EditMovie* pagina, in cui possono modificare il film e fare clic sul pulsante.</span><span class="sxs-lookup"><span data-stu-id="13439-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="13439-318">Dopo che il codice ha elaborato la modifica, reindirizzato al *film* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="13439-319">Tuttavia:</span><span class="sxs-lookup"><span data-stu-id="13439-319">However:</span></span>

- <span data-ttu-id="13439-320">L'utente potrebbe decidere di non apportare alcuna modifica.</span><span class="sxs-lookup"><span data-stu-id="13439-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="13439-321">L'utente potrebbe essere stato ricevuto da questa pagina senza prima avere scelto un' **Edit** clic sul collegamento nella *film* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="13439-322">In entrambi i casi, si desidera semplificare per poter tornare all'elenco principale.</span><span class="sxs-lookup"><span data-stu-id="13439-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="13439-323">È facile apportare la correzione &mdash; aggiungere il markup seguente subito dopo la chiusura `</form>` tag nel markup:</span><span class="sxs-lookup"><span data-stu-id="13439-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="13439-324">Questo markup Usa la stessa sintassi per un `<a>` elemento che si è visto in un' posizione.</span><span class="sxs-lookup"><span data-stu-id="13439-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="13439-325">L'URL include `~` può indicare "radice del sito Web".</span><span class="sxs-lookup"><span data-stu-id="13439-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="13439-326">Testare il processo di aggiornamento di film</span><span class="sxs-lookup"><span data-stu-id="13439-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="13439-327">A questo punto è possibile testare.</span><span class="sxs-lookup"><span data-stu-id="13439-327">Now you can test.</span></span> <span data-ttu-id="13439-328">Eseguire la *film* e fare clic su **modificare** accanto a un filmato.</span><span class="sxs-lookup"><span data-stu-id="13439-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="13439-329">Quando la *EditMovie* verrà visualizzata la pagina, apportare modifiche al film e fare clic su **Invia modifiche**.</span><span class="sxs-lookup"><span data-stu-id="13439-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="13439-330">Quando viene visualizzato l'elenco di film, assicurarsi che le modifiche vengono visualizzate.</span><span class="sxs-lookup"><span data-stu-id="13439-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="13439-331">Per assicurarsi che funzioni correttamente la convalida, fare clic su **modifica** per un altro film.</span><span class="sxs-lookup"><span data-stu-id="13439-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="13439-332">Quando si raggiunge il *EditMovie* pagina, deseleziona il **Genre** campo (o **anno** campo o entrambi) e provare a inviare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="13439-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="13439-333">Verrà visualizzato un errore, come previsto:</span><span class="sxs-lookup"><span data-stu-id="13439-333">You'll see an error, as you'd expect:</span></span>

![Modifica pagina film che mostri gli errori di convalida](updating-data/_static/image4.png)

<span data-ttu-id="13439-335">Fare clic sui **tornare all'elenco dei filmati** collegamento per ignorare le modifiche e tornare alle *film* pagina.</span><span class="sxs-lookup"><span data-stu-id="13439-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="13439-336">In arrivo</span><span class="sxs-lookup"><span data-stu-id="13439-336">Coming Up Next</span></span>

<span data-ttu-id="13439-337">Nella prossima esercitazione, verrà illustrato come eliminare un record di film.</span><span class="sxs-lookup"><span data-stu-id="13439-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="13439-338">Elenco completo per la pagina di film (aggiornata con i collegamenti di modifica)</span><span class="sxs-lookup"><span data-stu-id="13439-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="13439-339">Completare l'elenco di pagina per pagina film di modifica</span><span class="sxs-lookup"><span data-stu-id="13439-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="13439-340">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="13439-340">Additional Resources</span></span>

- [<span data-ttu-id="13439-341">Introduzione alla programmazione Web ASP.NET usando la sintassi Razor</span><span class="sxs-lookup"><span data-stu-id="13439-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="13439-342">[Istruzione SQL UPDATE](http://www.w3schools.com/sql/sql_update.asp) sul sito W3Schools</span><span class="sxs-lookup"><span data-stu-id="13439-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="13439-343">[Precedente](entering-data.md)
> [Successivo](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="13439-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
