---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Introduzione all'Pagine Web ASP.NET aggiornamento dei dati del database | Microsoft Docs
author: Rick-Anderson
description: Questa esercitazione illustra come aggiornare (modificare) una voce di database esistente quando si usa Pagine Web ASP.NET (Razor). Si presuppone che sia stata completata la serie...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 8f8bcfb7d9d2416a2699776cadbdaae8e12415ba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78574228"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="743a3-104">Introduzione all'Pagine Web ASP.NET aggiornamento dei dati del database</span><span class="sxs-lookup"><span data-stu-id="743a3-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="743a3-105">di [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="743a3-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="743a3-106">Questa esercitazione illustra come aggiornare (modificare) una voce di database esistente quando si usa Pagine Web ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="743a3-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="743a3-107">Si presuppone che sia stata completata la serie mediante l' [immissione di dati tramite i form utilizzando pagine Web ASP.NET](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="743a3-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="743a3-108">Contenuto dell'esercitazione:</span><span class="sxs-lookup"><span data-stu-id="743a3-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="743a3-109">Come selezionare un singolo record nell'helper `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="743a3-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="743a3-110">Come leggere un singolo record da un database.</span><span class="sxs-lookup"><span data-stu-id="743a3-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="743a3-111">Come precaricare un form con i valori del record del database.</span><span class="sxs-lookup"><span data-stu-id="743a3-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="743a3-112">Come aggiornare un record esistente in un database.</span><span class="sxs-lookup"><span data-stu-id="743a3-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="743a3-113">Modalità di archiviazione delle informazioni nella pagina senza visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="743a3-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="743a3-114">Come usare un campo nascosto per archiviare le informazioni.</span><span class="sxs-lookup"><span data-stu-id="743a3-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="743a3-115">Funzionalità/tecnologie discusse:</span><span class="sxs-lookup"><span data-stu-id="743a3-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="743a3-116">Helper `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="743a3-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="743a3-117">Comando SQL `Update`.</span><span class="sxs-lookup"><span data-stu-id="743a3-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="743a3-118">Metodo `Database.Execute` .</span><span class="sxs-lookup"><span data-stu-id="743a3-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="743a3-119">Campi nascosti (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="743a3-119">Hidden fields (`<input type="hidden">`).</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="743a3-120">Scopo dell'esercitazione</span><span class="sxs-lookup"><span data-stu-id="743a3-120">What You'll Build</span></span>

<span data-ttu-id="743a3-121">Nell'esercitazione precedente si è appreso come aggiungere un record a un database.</span><span class="sxs-lookup"><span data-stu-id="743a3-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="743a3-122">In questo articolo verrà illustrato come visualizzare un record per la modifica.</span><span class="sxs-lookup"><span data-stu-id="743a3-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="743a3-123">Nella pagina *Movies* verrà aggiornato l'helper `WebGrid` in modo da visualizzare un collegamento di **modifica** accanto a ogni film:</span><span class="sxs-lookup"><span data-stu-id="743a3-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![Visualizzazione WebGrid con un collegamento ' Edit ' per ogni film](updating-data/_static/image1.png)

<span data-ttu-id="743a3-125">Quando si fa clic sul collegamento **modifica** , viene configurata una pagina diversa, in cui le informazioni sul film sono già in un formato:</span><span class="sxs-lookup"><span data-stu-id="743a3-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Modifica la pagina di film che mostra il film da modificare](updating-data/_static/image2.png)

<span data-ttu-id="743a3-127">È possibile modificare qualsiasi valore.</span><span class="sxs-lookup"><span data-stu-id="743a3-127">You can change any of the values.</span></span> <span data-ttu-id="743a3-128">Quando si inviano le modifiche, il codice nella pagina Aggiorna il database e riporta all'elenco di film.</span><span class="sxs-lookup"><span data-stu-id="743a3-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="743a3-129">Questa parte del processo funziona quasi esattamente come la pagina *AddMovie. cshtml* creata nell'esercitazione precedente, quindi la maggior parte di questa esercitazione sarà familiare.</span><span class="sxs-lookup"><span data-stu-id="743a3-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="743a3-130">È possibile implementare un modo per modificare un singolo film in diversi modi.</span><span class="sxs-lookup"><span data-stu-id="743a3-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="743a3-131">L'approccio illustrato è stato scelto perché è facile da implementare e facile da comprendere.</span><span class="sxs-lookup"><span data-stu-id="743a3-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="743a3-132">Aggiunta di un collegamento di modifica all'elenco di film</span><span class="sxs-lookup"><span data-stu-id="743a3-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="743a3-133">Per iniziare, è necessario aggiornare la pagina dei *film* in modo che ogni voce di film includa anche un collegamento di **modifica** .</span><span class="sxs-lookup"><span data-stu-id="743a3-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="743a3-134">Aprire il file *Movies. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="743a3-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="743a3-135">Nel corpo della pagina modificare il markup `WebGrid` aggiungendo una colonna.</span><span class="sxs-lookup"><span data-stu-id="743a3-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="743a3-136">Ecco il markup modificato:</span><span class="sxs-lookup"><span data-stu-id="743a3-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="743a3-137">La nuova colonna è la seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="743a3-138">Il punto di questa colonna consiste nel visualizzare un collegamento (`<a>` elemento) il cui testo indica "Edit".</span><span class="sxs-lookup"><span data-stu-id="743a3-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="743a3-139">In seguito, viene creato un collegamento simile al seguente quando viene eseguita la pagina, con il valore `id` diverso per ogni film:</span><span class="sxs-lookup"><span data-stu-id="743a3-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="743a3-140">Questo collegamento richiama una pagina denominata *EditMovie*e passa la stringa di query `?id=7` a tale pagina.</span><span class="sxs-lookup"><span data-stu-id="743a3-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="743a3-141">La sintassi della nuova colonna potrebbe sembrare un po' complessa, ma ciò è dovuto al fatto che combina diversi elementi.</span><span class="sxs-lookup"><span data-stu-id="743a3-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="743a3-142">Ogni singolo elemento è semplice.</span><span class="sxs-lookup"><span data-stu-id="743a3-142">Each individual element is straightforward.</span></span> <span data-ttu-id="743a3-143">Se si concentra solo sull'elemento `<a>`, viene visualizzato questo markup:</span><span class="sxs-lookup"><span data-stu-id="743a3-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="743a3-144">Informazioni di base sul funzionamento della griglia: nella griglia vengono visualizzate le righe, una per ogni record di database e vengono visualizzate le colonne per ogni campo nel record del database.</span><span class="sxs-lookup"><span data-stu-id="743a3-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="743a3-145">Mentre ogni riga della griglia viene costruita, l'oggetto `item` contiene il record del database (elemento) per la riga.</span><span class="sxs-lookup"><span data-stu-id="743a3-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="743a3-146">Questa disposizione consente di ottenere un modo nel codice per ottenere i dati per la riga.</span><span class="sxs-lookup"><span data-stu-id="743a3-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="743a3-147">Questo è ciò che viene visualizzato: l'espressione `item.ID` sta ottenendo il valore ID dell'elemento del database corrente.</span><span class="sxs-lookup"><span data-stu-id="743a3-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="743a3-148">È possibile ottenere i valori del database (titolo, genere o anno) allo stesso modo usando `item.Title`, `item.Genre`o `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="743a3-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="743a3-149">L'espressione `"~/EditMovie?id=@item.ID` combina la parte hardcoded dell'URL di destinazione (`~/EditMovie?id=`) con questo ID derivato dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="743a3-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="743a3-150">Nell'esercitazione precedente è stato visto l'operatore `~`, ovvero un operatore ASP.NET che rappresenta la radice del sito Web corrente.</span><span class="sxs-lookup"><span data-stu-id="743a3-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="743a3-151">Il risultato è che questa parte del markup nella colonna produce semplicemente qualcosa di simile al markup seguente in fase di esecuzione:</span><span class="sxs-lookup"><span data-stu-id="743a3-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="743a3-152">Naturalmente, il valore effettivo di `id` sarà diverso per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="743a3-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="743a3-153">Creazione di una visualizzazione personalizzata per una colonna della griglia</span><span class="sxs-lookup"><span data-stu-id="743a3-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="743a3-154">Tornare alla colonna della griglia.</span><span class="sxs-lookup"><span data-stu-id="743a3-154">Now back to the grid column.</span></span> <span data-ttu-id="743a3-155">Le tre colonne originariamente presenti nella griglia visualizzavano solo i valori dei dati (titolo, genere e anno).</span><span class="sxs-lookup"><span data-stu-id="743a3-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="743a3-156">Questa visualizzazione è stata specificata passando il nome della colonna di database &mdash; ad esempio `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="743a3-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="743a3-157">La nuova colonna **modifica** collegamento è diversa.</span><span class="sxs-lookup"><span data-stu-id="743a3-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="743a3-158">Anziché specificare un nome di colonna, viene passato un parametro di `format`.</span><span class="sxs-lookup"><span data-stu-id="743a3-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="743a3-159">Questo parametro consente di definire il markup che verrà eseguito dal `WebGrid` Helper insieme al valore `item` per visualizzare i dati della colonna come grassetto o verde o nel formato desiderato.</span><span class="sxs-lookup"><span data-stu-id="743a3-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="743a3-160">Se ad esempio si desidera che il titolo appaia in grassetto, è possibile creare una colonna come nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="743a3-161">I vari `@` caratteri visualizzati nella proprietà `format` contrassegnano la transizione tra il markup e un valore di codice.</span><span class="sxs-lookup"><span data-stu-id="743a3-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="743a3-162">Quando si è a conoscenza della proprietà `format`, è più facile comprendere il modo in cui viene inserita la nuova colonna di collegamento **Edit (modifica** ):</span><span class="sxs-lookup"><span data-stu-id="743a3-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="743a3-163">La colonna è costituita *solo* dal markup che esegue il rendering del collegamento, più alcune informazioni (ID) estratte dal record del database per la riga.</span><span class="sxs-lookup"><span data-stu-id="743a3-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="743a3-164">**Parametri denominati e parametri posizionali per un metodo**</span><span class="sxs-lookup"><span data-stu-id="743a3-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="743a3-165">Molte volte quando è stato chiamato un metodo e passati parametri, sono stati semplicemente elencati i valori dei parametri separati da virgole.</span><span class="sxs-lookup"><span data-stu-id="743a3-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="743a3-166">Di seguito sono riportati alcuni esempi:</span><span class="sxs-lookup"><span data-stu-id="743a3-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="743a3-167">Il problema non è stato menzionato quando si è visto per la prima volta questo codice, ma in ogni caso si passano parametri ai metodi in un ordine specifico &mdash;, in particolare, l'ordine in cui i parametri sono definiti in tale metodo.</span><span class="sxs-lookup"><span data-stu-id="743a3-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="743a3-168">Per `db.Execute` e `Validation.RequireFields`, se si mescola l'ordine dei valori passati, viene restituito un messaggio di errore durante l'esecuzione della pagina o almeno alcuni risultati strani.</span><span class="sxs-lookup"><span data-stu-id="743a3-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="743a3-169">Ovviamente, è necessario essere a conoscenza dell'ordine in cui passare i parametri.</span><span class="sxs-lookup"><span data-stu-id="743a3-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="743a3-170">(In WebMatrix, IntelliSense consente di comprendere il nome, il tipo e l'ordine dei parametri).</span><span class="sxs-lookup"><span data-stu-id="743a3-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="743a3-171">In alternativa al passaggio dei valori nell'ordine, è possibile usare *parametri denominati*.</span><span class="sxs-lookup"><span data-stu-id="743a3-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="743a3-172">Il passaggio di parametri in ordine è noto come utilizzo di *parametri posizionali*. Per i parametri denominati, è necessario includere in modo esplicito il nome del parametro al passaggio del relativo valore.</span><span class="sxs-lookup"><span data-stu-id="743a3-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="743a3-173">In queste esercitazioni sono già stati usati parametri denominati.</span><span class="sxs-lookup"><span data-stu-id="743a3-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="743a3-174">Esempio:</span><span class="sxs-lookup"><span data-stu-id="743a3-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="743a3-175">e</span><span class="sxs-lookup"><span data-stu-id="743a3-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="743a3-176">I parametri denominati sono utili per alcune situazioni, soprattutto quando un metodo accetta molti parametri.</span><span class="sxs-lookup"><span data-stu-id="743a3-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="743a3-177">Uno è quando si desidera passare solo uno o due parametri, ma i valori che si desidera passare non sono tra le prime posizioni nell'elenco di parametri.</span><span class="sxs-lookup"><span data-stu-id="743a3-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="743a3-178">Un'altra situazione è quando si vuole rendere il codice più leggibile passando i parametri nell'ordine più sensato.</span><span class="sxs-lookup"><span data-stu-id="743a3-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="743a3-179">Ovviamente, per usare i parametri denominati, è necessario conoscerne i nomi.</span><span class="sxs-lookup"><span data-stu-id="743a3-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="743a3-180">Con IntelliSense di WebMatrix è possibile *visualizzare* i nomi, ma attualmente non è possibile compilarli automaticamente.</span><span class="sxs-lookup"><span data-stu-id="743a3-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>

## <a name="creating-the-edit-page"></a><span data-ttu-id="743a3-181">Creazione della pagina di modifica</span><span class="sxs-lookup"><span data-stu-id="743a3-181">Creating the Edit Page</span></span>

<span data-ttu-id="743a3-182">A questo punto è possibile creare la pagina *EditMovie* .</span><span class="sxs-lookup"><span data-stu-id="743a3-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="743a3-183">Quando gli utenti fanno clic sul collegamento di **modifica** , finiranno in questa pagina.</span><span class="sxs-lookup"><span data-stu-id="743a3-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="743a3-184">Creare una pagina denominata *EditMovie. cshtml* e sostituire gli elementi del file con il markup seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="743a3-185">Questo markup e codice è simile a quello presente nella pagina *AddMovie* .</span><span class="sxs-lookup"><span data-stu-id="743a3-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="743a3-186">Il testo per il pulsante Invia presenta una piccola differenza.</span><span class="sxs-lookup"><span data-stu-id="743a3-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="743a3-187">Come per la pagina *AddMovie* , esiste una chiamata `Html.ValidationSummary` che visualizzerà eventuali errori di convalida.</span><span class="sxs-lookup"><span data-stu-id="743a3-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="743a3-188">Questa volta sono state escluse le chiamate a `Validation.Message`, poiché gli errori verranno visualizzati nel Riepilogo di convalida.</span><span class="sxs-lookup"><span data-stu-id="743a3-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="743a3-189">Come indicato nell'esercitazione precedente, è possibile usare il riepilogo di convalida e i singoli messaggi di errore in varie combinazioni.</span><span class="sxs-lookup"><span data-stu-id="743a3-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="743a3-190">Si noti di nuovo che l'attributo `method` dell'elemento `<form>` è impostato su `post`.</span><span class="sxs-lookup"><span data-stu-id="743a3-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="743a3-191">Come per la pagina *AddMovie. cshtml* , questa pagina apporta modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="743a3-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="743a3-192">Questo modulo deve pertanto eseguire un'operazione di `POST`.</span><span class="sxs-lookup"><span data-stu-id="743a3-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="743a3-193">Per ulteriori informazioni sulla differenza tra le operazioni `GET` e `POST`, vedere la barra laterale relativa alla [sicurezza dei verbi Get, post e http](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) nell'esercitazione sui moduli HTML.</span><span class="sxs-lookup"><span data-stu-id="743a3-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="743a3-194">Come si è visto in un'esercitazione precedente, gli attributi `value` delle caselle di testo vengono impostati con il codice Razor per poterli precaricare.</span><span class="sxs-lookup"><span data-stu-id="743a3-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="743a3-195">Questa volta, tuttavia, si usano variabili come `title` e `genre` per l'attività anziché `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="743a3-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="743a3-196">Come in precedenza, questo markup precarica i valori della casella di testo con i valori dei film.</span><span class="sxs-lookup"><span data-stu-id="743a3-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="743a3-197">Questo è il motivo per cui è utile usare le variabili in questo momento invece di usare l'oggetto `Request`.</span><span class="sxs-lookup"><span data-stu-id="743a3-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="743a3-198">In questa pagina è presente anche un elemento `<input type="hidden">`.</span><span class="sxs-lookup"><span data-stu-id="743a3-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="743a3-199">Questo elemento archivia l'ID film senza renderlo visibile nella pagina.</span><span class="sxs-lookup"><span data-stu-id="743a3-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="743a3-200">L'ID viene passato inizialmente alla pagina usando un valore della stringa di query (`?id=7` o simile nell'URL).</span><span class="sxs-lookup"><span data-stu-id="743a3-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="743a3-201">Inserendo il valore ID in un campo nascosto, è possibile assicurarsi che sia disponibile quando il modulo viene inviato, anche se non è più possibile accedere all'URL originale con cui è stata richiamata la pagina.</span><span class="sxs-lookup"><span data-stu-id="743a3-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="743a3-202">A differenza della pagina *AddMovie* , il codice per la pagina *EditMovie* ha due funzioni distinte.</span><span class="sxs-lookup"><span data-stu-id="743a3-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="743a3-203">La prima funzione è che, quando la pagina viene visualizzata per la prima volta (e *solo* successivamente), il codice ottiene l'ID del film dalla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="743a3-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="743a3-204">Il codice usa quindi l'ID per leggere il film corrispondente dal database e visualizzarlo (precaricato) nelle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="743a3-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="743a3-205">La seconda funzione è che, quando l'utente fa clic sul pulsante **Submit Changes** , il codice deve leggere i valori delle caselle di testo e convalidarli.</span><span class="sxs-lookup"><span data-stu-id="743a3-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="743a3-206">Il codice deve anche aggiornare l'elemento del database con i nuovi valori.</span><span class="sxs-lookup"><span data-stu-id="743a3-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="743a3-207">Questa tecnica è simile all'aggiunta di un record, come si è visto in *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="743a3-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="743a3-208">Aggiunta di codice per la lettura di un singolo film</span><span class="sxs-lookup"><span data-stu-id="743a3-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="743a3-209">Per eseguire la prima funzione, aggiungere il codice seguente nella parte superiore della pagina:</span><span class="sxs-lookup"><span data-stu-id="743a3-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="743a3-210">La maggior parte di questo codice si trova all'interno di un blocco che inizia `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="743a3-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="743a3-211">L'operatore `!` significa "not", pertanto l'espressione indica *se la richiesta non è*di tipo post, ovvero *se la richiesta è la prima volta che la pagina è stata eseguita*.</span><span class="sxs-lookup"><span data-stu-id="743a3-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="743a3-212">Come indicato in precedenza, questo codice deve essere eseguito *solo* la prima volta che la pagina viene eseguita.</span><span class="sxs-lookup"><span data-stu-id="743a3-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="743a3-213">Se il codice non è stato chiuso in `if(!IsPost)`, viene eseguito ogni volta che viene richiamata la pagina, sia che si tratti della prima volta o in risposta a un clic su un pulsante.</span><span class="sxs-lookup"><span data-stu-id="743a3-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="743a3-214">Si noti che nel codice è incluso un blocco `else` questa volta.</span><span class="sxs-lookup"><span data-stu-id="743a3-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="743a3-215">Come abbiamo detto quando abbiamo introdotto blocchi di `if`, a volte si vuole eseguire codice alternativo se la condizione che si sta testando non è vera.</span><span class="sxs-lookup"><span data-stu-id="743a3-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="743a3-216">Questo è il caso.</span><span class="sxs-lookup"><span data-stu-id="743a3-216">That's the case here.</span></span> <span data-ttu-id="743a3-217">Se la condizione passa, ovvero se l'ID passato alla pagina è OK, viene letta una riga dal database.</span><span class="sxs-lookup"><span data-stu-id="743a3-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="743a3-218">Tuttavia, se la condizione non viene superata, il blocco `else` viene eseguito e il codice imposta un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="743a3-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="743a3-219">Convalida di un valore passato alla pagina</span><span class="sxs-lookup"><span data-stu-id="743a3-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="743a3-220">Il codice USA `Request.QueryString["id"]` per ottenere l'ID passato alla pagina.</span><span class="sxs-lookup"><span data-stu-id="743a3-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="743a3-221">Il codice consente di verificare che sia stato effettivamente passato un valore per l'ID.</span><span class="sxs-lookup"><span data-stu-id="743a3-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="743a3-222">Se non è stato passato alcun valore, il codice imposta un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="743a3-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="743a3-223">Questo codice mostra un modo diverso per convalidare le informazioni.</span><span class="sxs-lookup"><span data-stu-id="743a3-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="743a3-224">Nell'esercitazione precedente è stato usato il `Validation` helper.</span><span class="sxs-lookup"><span data-stu-id="743a3-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="743a3-225">Sono stati registrati i campi da convalidare e ASP.NET automaticamente la convalida ed è stato visualizzato l'errore usando `Html.ValidationMessage` e `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="743a3-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="743a3-226">In questo caso, tuttavia, non viene convalidato l'input dell'utente.</span><span class="sxs-lookup"><span data-stu-id="743a3-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="743a3-227">Al contrario, si sta convalidando un valore che è stato passato alla pagina da altrove.</span><span class="sxs-lookup"><span data-stu-id="743a3-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="743a3-228">Il `Validation` Helper non esegue questa operazione.</span><span class="sxs-lookup"><span data-stu-id="743a3-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="743a3-229">Pertanto, è possibile controllare il valore autonomamente, eseguendone il test con `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="743a3-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="743a3-230">Se si verifica un problema, è possibile visualizzare l'errore usando `Html.ValidationSummary`, come è stato fatto con l'helper `Validation`.</span><span class="sxs-lookup"><span data-stu-id="743a3-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="743a3-231">A tale scopo, chiamare `Validation.AddFormError` e passare un messaggio da visualizzare.</span><span class="sxs-lookup"><span data-stu-id="743a3-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="743a3-232">`Validation.AddFormError` è un metodo incorporato che consente di definire messaggi personalizzati che si collegano al sistema di convalida con cui si ha già familiarità.</span><span class="sxs-lookup"><span data-stu-id="743a3-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="743a3-233">Più avanti in questa esercitazione parleremo di come rendere il processo di convalida più affidabile.</span><span class="sxs-lookup"><span data-stu-id="743a3-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="743a3-234">Dopo aver verificato che sia presente un ID per il film, il codice legge il database, cercando solo un singolo elemento di database.</span><span class="sxs-lookup"><span data-stu-id="743a3-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="743a3-235">Probabilmente si è notato il modello generale per le operazioni di database: aprire il database, definire un'istruzione SQL ed eseguire l'istruzione. Questa volta, l'istruzione SQL `Select` include `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="743a3-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="743a3-236">Poiché l'ID è univoco, è possibile restituire un solo record.</span><span class="sxs-lookup"><span data-stu-id="743a3-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="743a3-237">La query viene eseguita usando `db.QuerySingle` (non `db.Query`, come è stato usato per l'elenco dei film) e il codice inserisce il risultato nella variabile `row`.</span><span class="sxs-lookup"><span data-stu-id="743a3-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="743a3-238">Il nome `row` è arbitrario; è possibile assegnare un nome a tutte le variabili.</span><span class="sxs-lookup"><span data-stu-id="743a3-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="743a3-239">Le variabili inizializzate in alto vengono quindi compilate con i dettagli del film in modo che questi valori possano essere visualizzati nelle caselle di testo.</span><span class="sxs-lookup"><span data-stu-id="743a3-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="743a3-240">Test della pagina di modifica (finora)</span><span class="sxs-lookup"><span data-stu-id="743a3-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="743a3-241">Se si vuole testare la pagina, eseguire ora la pagina dei *filmati* e fare clic su un collegamento di **modifica** accanto a qualsiasi film.</span><span class="sxs-lookup"><span data-stu-id="743a3-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="743a3-242">Verrà visualizzata la pagina *EditMovie* con i dettagli compilati per il film selezionato:</span><span class="sxs-lookup"><span data-stu-id="743a3-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Modifica la pagina di film che mostra il film da modificare](updating-data/_static/image3.png)

<span data-ttu-id="743a3-244">Si noti che l'URL della pagina include qualcosa come `?id=10` (o un altro numero).</span><span class="sxs-lookup"><span data-stu-id="743a3-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="743a3-245">Fino a questo punto è stato testato che i collegamenti di **modifica** nella pagina *film* funzionano, che la pagina sta leggendo l'ID dalla stringa di query e che la query di database per ottenere un singolo record cinematografico funziona.</span><span class="sxs-lookup"><span data-stu-id="743a3-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="743a3-246">È possibile modificare le informazioni sul film, ma non accade nulla quando si fa clic su **Invia modifiche**.</span><span class="sxs-lookup"><span data-stu-id="743a3-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="743a3-247">Aggiunta di codice per aggiornare il film con le modifiche dell'utente</span><span class="sxs-lookup"><span data-stu-id="743a3-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="743a3-248">Nel file *EditMovie. cshtml* , per implementare la seconda funzione (salvando le modifiche), aggiungere il codice seguente solo all'interno della parentesi graffa di chiusura del blocco `@`.</span><span class="sxs-lookup"><span data-stu-id="743a3-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="743a3-249">Se non si è certi del modo in cui inserire il codice, è possibile esaminare il [Listato di codice completo per la pagina Modifica film](#Complete_Page_Listing_for_EditMovie) visualizzata alla fine di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="743a3-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="743a3-250">Anche in questo caso, questo markup e codice è simile al codice in *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="743a3-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="743a3-251">Il codice si trova in un blocco di `if(IsPost)`, perché questo codice viene eseguito solo quando l'utente fa clic sul pulsante **Invia modifiche** &mdash; ovvero, quando (e solo quando) il form è stato inviato.</span><span class="sxs-lookup"><span data-stu-id="743a3-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="743a3-252">In questo caso, non si sta usando un test come `if(IsPost && Validation.IsValid())`, ovvero non vengono combinati entrambi i test tramite e.</span><span class="sxs-lookup"><span data-stu-id="743a3-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="743a3-253">In questa pagina è necessario innanzitutto determinare se è presente un modulo di invio (`if(IsPost)`) e quindi registrare solo i campi per la convalida.</span><span class="sxs-lookup"><span data-stu-id="743a3-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="743a3-254">È quindi possibile testare i risultati della convalida (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="743a3-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="743a3-255">Il flusso è leggermente diverso rispetto alla pagina *AddMovie. cshtml* , ma l'effetto è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="743a3-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="743a3-256">Per ottenere i valori delle caselle di testo, è possibile usare `Request.Form["title"]` e codice simile per gli altri elementi di `<input>`.</span><span class="sxs-lookup"><span data-stu-id="743a3-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="743a3-257">Si noti che questa volta il codice ottiene l'ID del film dal campo nascosto (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="743a3-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="743a3-258">Quando la pagina è stata eseguita per la prima volta, il codice ha ottenuto l'ID dalla stringa di query.</span><span class="sxs-lookup"><span data-stu-id="743a3-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="743a3-259">È possibile ottenere il valore dal campo nascosto per assicurarsi di ottenere l'ID del film originariamente visualizzato, nel caso in cui la stringa di query sia stata modificata in qualche modo da allora.</span><span class="sxs-lookup"><span data-stu-id="743a3-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="743a3-260">La differenza molto importante tra il codice *AddMovie* e questo codice è che in questo codice si usa l'istruzione SQL `Update` anziché l'istruzione `Insert Into`.</span><span class="sxs-lookup"><span data-stu-id="743a3-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="743a3-261">Nell'esempio seguente viene illustrata la sintassi dell'istruzione SQL `Update`:</span><span class="sxs-lookup"><span data-stu-id="743a3-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="743a3-262">È possibile specificare qualsiasi colonna in qualsiasi ordine e non è necessario aggiornare tutte le colonne durante un'operazione di `Update`.</span><span class="sxs-lookup"><span data-stu-id="743a3-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="743a3-263">Non è possibile aggiornare l'ID, perché sarebbe in effetti salvare il record come un nuovo record e non è consentito per un'operazione di `Update`.</span><span class="sxs-lookup"><span data-stu-id="743a3-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="743a3-264">**Importante** La clausola `Where` con l'ID è molto importante, perché questo è il modo in cui il database è in grado di riconoscere il record del database che si desidera aggiornare.</span><span class="sxs-lookup"><span data-stu-id="743a3-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="743a3-265">Se si esce dalla clausola `Where`, il database aggiornerà *ogni* record del database.</span><span class="sxs-lookup"><span data-stu-id="743a3-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="743a3-266">Nella maggior parte dei casi, si tratta di una situazione di emergenza.</span><span class="sxs-lookup"><span data-stu-id="743a3-266">In most cases, that would be a disaster.</span></span>

<span data-ttu-id="743a3-267">Nel codice i valori da aggiornare vengono passati all'istruzione SQL usando i segnaposto.</span><span class="sxs-lookup"><span data-stu-id="743a3-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="743a3-268">Per ripetere quanto detto in precedenza: per motivi di sicurezza, usare *solo* i segnaposto per passare i valori a un'istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="743a3-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="743a3-269">Quando il codice USA `db.Execute` per eseguire l'istruzione `Update`, viene reindirizzato alla pagina di elenco, in cui è possibile visualizzare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="743a3-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="743a3-270">**Diverse istruzioni SQL, metodi diversi**</span><span class="sxs-lookup"><span data-stu-id="743a3-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="743a3-271">Si potrebbe notare che si usano metodi leggermente diversi per eseguire istruzioni SQL diverse.</span><span class="sxs-lookup"><span data-stu-id="743a3-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="743a3-272">Per eseguire una query `Select` che potenzialmente restituisce più record, utilizzare il metodo `Query`.</span><span class="sxs-lookup"><span data-stu-id="743a3-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="743a3-273">Per eseguire una query `Select` che si sa restituirà un solo elemento del database, si userà il metodo `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="743a3-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="743a3-274">Per eseguire comandi che apportano modifiche ma che non restituiscono elementi di database, usare il metodo `Execute`.</span><span class="sxs-lookup"><span data-stu-id="743a3-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="743a3-275">È necessario disporre di metodi diversi perché ognuno di essi restituisce risultati diversi, come si è già visto nella differenza tra `Query` e `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="743a3-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="743a3-276">Il metodo `Execute` restituisce effettivamente un valore anche &mdash; nome, il numero di righe del database interessate dal comando &mdash; ma che finora è stato ignorato.</span><span class="sxs-lookup"><span data-stu-id="743a3-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="743a3-277">Naturalmente, il metodo `Query` potrebbe restituire solo una riga di database.</span><span class="sxs-lookup"><span data-stu-id="743a3-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="743a3-278">Tuttavia, ASP.NET considera sempre i risultati del metodo `Query` come raccolta.</span><span class="sxs-lookup"><span data-stu-id="743a3-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="743a3-279">Anche se il metodo restituisce una sola riga, è necessario estrarre l'unica riga dalla raccolta.</span><span class="sxs-lookup"><span data-stu-id="743a3-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="743a3-280">Pertanto, nelle situazioni in cui si è *certi* di ottenere una sola riga, è più comodo utilizzare `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="743a3-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="743a3-281">Esistono altri metodi che eseguono tipi specifici di operazioni di database.</span><span class="sxs-lookup"><span data-stu-id="743a3-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="743a3-282">È possibile trovare un elenco di metodi di database nel [riferimento rapido all'API pagine Web ASP.NET](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="743a3-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>

## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="743a3-283">Esecuzione della convalida per l'ID più affidabile</span><span class="sxs-lookup"><span data-stu-id="743a3-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="743a3-284">La prima volta che la pagina viene eseguita, si ottiene l'ID film dalla stringa di query, in modo che sia possibile recuperare il filmato dal database.</span><span class="sxs-lookup"><span data-stu-id="743a3-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="743a3-285">Si è verificato che in realtà era presente un valore da cercare, operazione eseguita usando il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="743a3-286">Questo codice è stato usato per assicurarsi che se un utente raggiunge la pagina *EditMovies* senza prima selezionare un film nella pagina dei *film* , nella pagina verrà visualizzato un messaggio di errore descrittivo.</span><span class="sxs-lookup"><span data-stu-id="743a3-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="743a3-287">In caso contrario, gli utenti visualizzeranno un errore che probabilmente ne confonderebbe.</span><span class="sxs-lookup"><span data-stu-id="743a3-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="743a3-288">Questa convalida, tuttavia, non è molto affidabile.</span><span class="sxs-lookup"><span data-stu-id="743a3-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="743a3-289">È possibile che la pagina venga richiamata anche con gli errori seguenti:</span><span class="sxs-lookup"><span data-stu-id="743a3-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="743a3-290">L'ID non è un numero.</span><span class="sxs-lookup"><span data-stu-id="743a3-290">The ID isn't a number.</span></span> <span data-ttu-id="743a3-291">Ad esempio, la pagina potrebbe essere richiamata con un URL come `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="743a3-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="743a3-292">L'ID è un numero, ma fa riferimento a un film che non esiste, ad esempio `http://localhost:nnnnn/EditMovie?id=100934`.</span><span class="sxs-lookup"><span data-stu-id="743a3-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="743a3-293">Se si è interessati a visualizzare gli errori derivanti da questi URL, eseguire la pagina *Movies* .</span><span class="sxs-lookup"><span data-stu-id="743a3-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="743a3-294">Selezionare un filmato da modificare, quindi modificare l'URL della pagina *EditMovie* in un URL che contiene un ID alfabetico o l'ID di un film inesistente.</span><span class="sxs-lookup"><span data-stu-id="743a3-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="743a3-295">Quindi, cosa devi fare?</span><span class="sxs-lookup"><span data-stu-id="743a3-295">So what should you do?</span></span> <span data-ttu-id="743a3-296">La prima correzione consiste nel verificare che non solo sia un ID passato alla pagina, ma che l'ID sia un numero intero.</span><span class="sxs-lookup"><span data-stu-id="743a3-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="743a3-297">Modificare il codice per il test di `!IsPost` come nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="743a3-298">È stata aggiunta una seconda condizione al test di `IsEmpty`, collegato con `&&` (AND logico):</span><span class="sxs-lookup"><span data-stu-id="743a3-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="743a3-299">È possibile ricordare dall'esercitazione [introduttiva a pagine Web ASP.NET Programming](../introducing-razor-syntax-c.md) che metodi come `AsBool` un `AsInt` convertire una stringa di caratteri in un altro tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="743a3-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="743a3-300">Il metodo `IsInt` e altri elementi, ad esempio `IsBool` e `IsDateTime`, sono simili.</span><span class="sxs-lookup"><span data-stu-id="743a3-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="743a3-301">Tuttavia, verificano solo se è *possibile* convertire la stringa senza eseguire effettivamente la conversione.</span><span class="sxs-lookup"><span data-stu-id="743a3-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="743a3-302">Quindi, qui si dice essenzialmente *se il valore della stringa di query può essere convertito in un numero intero...* .</span><span class="sxs-lookup"><span data-stu-id="743a3-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="743a3-303">L'altro potenziale problema sta cercando un film inesistente.</span><span class="sxs-lookup"><span data-stu-id="743a3-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="743a3-304">Il codice per ottenere un filmato ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="743a3-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="743a3-305">Se si passa un valore `movieId` al metodo `QuerySingle` che non corrisponde a un film effettivo, non viene restituito nulla e le istruzioni che seguono, ad esempio `title=row.Title`, generano errori.</span><span class="sxs-lookup"><span data-stu-id="743a3-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="743a3-306">Anche in questo caso, c'è una semplice correzione.</span><span class="sxs-lookup"><span data-stu-id="743a3-306">Again there's an easy fix.</span></span> <span data-ttu-id="743a3-307">Se il metodo `db.QuerySingle` non restituisce alcun risultato, la variabile `row` sarà null.</span><span class="sxs-lookup"><span data-stu-id="743a3-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="743a3-308">Quindi, è possibile verificare se la variabile `row` è null prima di tentare di ottenere i valori.</span><span class="sxs-lookup"><span data-stu-id="743a3-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="743a3-309">Il codice seguente aggiunge un blocco di `if` intorno alle istruzioni che ottengono i valori dall'oggetto `row`:</span><span class="sxs-lookup"><span data-stu-id="743a3-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="743a3-310">Con questi due test di convalida aggiuntivi, la pagina diventa più a prova di Bullet.</span><span class="sxs-lookup"><span data-stu-id="743a3-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="743a3-311">Il codice completo per il ramo `!IsPost` ora è simile a questo esempio:</span><span class="sxs-lookup"><span data-stu-id="743a3-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="743a3-312">Si noterà ancora una volta che questa attività è un valido utilizzo per un blocco di `else`.</span><span class="sxs-lookup"><span data-stu-id="743a3-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="743a3-313">Se i test non vengono superati, il `else` blocca la configurazione dei messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="743a3-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="743a3-314">Aggiunta di un collegamento per tornare alla pagina Movies</span><span class="sxs-lookup"><span data-stu-id="743a3-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="743a3-315">Un dettaglio finale e utile consiste nell'aggiungere un collegamento alla pagina *Movies* .</span><span class="sxs-lookup"><span data-stu-id="743a3-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="743a3-316">Nel flusso di eventi normali, gli utenti inizieranno dalla pagina dei *film* e faranno clic su un collegamento di **modifica** .</span><span class="sxs-lookup"><span data-stu-id="743a3-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="743a3-317">Che li porta alla pagina *EditMovie* , in cui è possibile modificare il film e fare clic sul pulsante.</span><span class="sxs-lookup"><span data-stu-id="743a3-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="743a3-318">Dopo che il codice ha elaborato la modifica, viene reindirizzato alla pagina *Movies* .</span><span class="sxs-lookup"><span data-stu-id="743a3-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="743a3-319">Tuttavia:</span><span class="sxs-lookup"><span data-stu-id="743a3-319">However:</span></span>

- <span data-ttu-id="743a3-320">L'utente potrebbe decidere di non modificare alcun elemento.</span><span class="sxs-lookup"><span data-stu-id="743a3-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="743a3-321">È possibile che l'utente abbia ottenuto questa pagina senza prima fare clic su un collegamento di **modifica** nella pagina dei *filmati* .</span><span class="sxs-lookup"><span data-stu-id="743a3-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="743a3-322">In entrambi i casi, si desidera semplificare il ritorno all'elenco principale.</span><span class="sxs-lookup"><span data-stu-id="743a3-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="743a3-323">Si tratta di una soluzione semplice &mdash; aggiungere il markup seguente subito dopo il tag di chiusura `</form>` nel markup:</span><span class="sxs-lookup"><span data-stu-id="743a3-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="743a3-324">Questo markup usa la stessa sintassi per un elemento `<a>` che si è visto altrove.</span><span class="sxs-lookup"><span data-stu-id="743a3-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="743a3-325">L'URL include `~` significa "radice del sito Web".</span><span class="sxs-lookup"><span data-stu-id="743a3-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="743a3-326">Test del processo di aggiornamento del film</span><span class="sxs-lookup"><span data-stu-id="743a3-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="743a3-327">A questo punto è possibile eseguire il test.</span><span class="sxs-lookup"><span data-stu-id="743a3-327">Now you can test.</span></span> <span data-ttu-id="743a3-328">Eseguire la pagina *filmati* e fare clic su **modifica** accanto a un film.</span><span class="sxs-lookup"><span data-stu-id="743a3-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="743a3-329">Quando viene visualizzata la pagina *EditMovie* , modificare il film e fare clic su **Invia modifiche**.</span><span class="sxs-lookup"><span data-stu-id="743a3-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="743a3-330">Quando viene visualizzato l'elenco dei film, verificare che le modifiche siano visualizzate.</span><span class="sxs-lookup"><span data-stu-id="743a3-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="743a3-331">Per assicurarsi che la convalida funzioni, fare clic su **modifica** per un altro film.</span><span class="sxs-lookup"><span data-stu-id="743a3-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="743a3-332">Quando si arriva alla pagina *EditMovie* , deselezionare il campo **genere** (o il campo **anno** o entrambi) e provare a inviare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="743a3-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="743a3-333">Verrà visualizzato un errore, come previsto:</span><span class="sxs-lookup"><span data-stu-id="743a3-333">You'll see an error, as you'd expect:</span></span>

![Modifica pagina film con errori di convalida](updating-data/_static/image4.png)

<span data-ttu-id="743a3-335">Fare clic sul collegamento **Return to Movie Listing** per abbandonare le modifiche e tornare alla pagina *Movies* .</span><span class="sxs-lookup"><span data-stu-id="743a3-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="743a3-336">Prossimi</span><span class="sxs-lookup"><span data-stu-id="743a3-336">Coming Up Next</span></span>

<span data-ttu-id="743a3-337">Nell'esercitazione successiva si vedrà come eliminare un record di film.</span><span class="sxs-lookup"><span data-stu-id="743a3-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="743a3-338">Elenco completo per la pagina di film (aggiornato con i collegamenti di modifica)</span><span class="sxs-lookup"><span data-stu-id="743a3-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="743a3-339">Elenco di pagine complete per la pagina Modifica film</span><span class="sxs-lookup"><span data-stu-id="743a3-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="743a3-340">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="743a3-340">Additional Resources</span></span>

- [<span data-ttu-id="743a3-341">Introduzione alla programmazione Web di ASP.NET tramite la sintassi Razor</span><span class="sxs-lookup"><span data-stu-id="743a3-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="743a3-342">[Istruzione SQL Update](http://www.w3schools.com/sql/sql_update.asp) nel sito di W3Schools</span><span class="sxs-lookup"><span data-stu-id="743a3-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="743a3-343">[Precedente](entering-data.md)
> [Successivo](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="743a3-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
