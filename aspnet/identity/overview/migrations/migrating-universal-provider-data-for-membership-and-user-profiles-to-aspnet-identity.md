---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: La migrazione di dati del Provider universali per appartenenza e i profili utente mobili ad ASP.NET Identity (C#)-ASP.NET 4.x
author: rustd
description: Questa esercitazione vengono descritti i passaggi necessari eseguire la migrazione di utenti e i dati del ruolo e i dati di profilo utente creati con i provider universali di un'app esistente...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: de154dde122886976054159ad745982669ca9315
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/06/2019
ms.locfileid: "65121379"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="2d9f8-103">Migrazione dei dati dei provider universali per l'appartenenza e i profili utente ad ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="2d9f8-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="2d9f8-104">dal [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="2d9f8-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="2d9f8-105">Questa esercitazione vengono descritti i passaggi necessari eseguire la migrazione di utenti e i dati del ruolo e dati del profilo utente creati con i provider universali di un'applicazione esistente per il modello di identità di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="2d9f8-106">L'approccio sopra indicate per eseguire la migrazione di dati del profilo utente possono essere utilizzate in un'applicazione con appartenenza SQL anche.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="2d9f8-107">Con la versione di Visual Studio 2013, il team ASP.NET ha introdotto un nuovo sistema di identità di ASP.NET e altre informazioni sulla versione [qui](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="2d9f8-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="2d9f8-108">Dopo l'analisi dell'articolo per eseguire la migrazione di applicazioni web dai [appartenenza SQL nel nuovo sistema di identità](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), questo articolo illustra i passaggi per eseguire la migrazione di applicazioni esistenti che seguono il modello di provider per la gestione di utenti e ruoli il nuovo modello di identità.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="2d9f8-109">L'obiettivo di questa esercitazione sarà principalmente sulla migrazione di dati del profilo utente per associarlo in modo trasparente nel nuovo sistema.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="2d9f8-110">Migrazione delle informazioni utente e il ruolo è simile per l'appartenenza SQL.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="2d9f8-111">L'approccio seguito per eseguire la migrazione dei dati di profilo può essere utilizzato in un'applicazione con anche l'appartenenza SQL.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="2d9f8-112">Ad esempio, si inizierà con un'app web creata utilizzando Visual Studio 2012 che viene utilizzato il modello di provider.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="2d9f8-113">Si verrà quindi aggiungere codice per la gestione dei profili, registrazione di un utente, aggiungere dati del profilo per gli utenti, eseguire la migrazione dello schema del database e modificare l'applicazione a usare il sistema di identità per la gestione di utenti e ruoli.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="2d9f8-114">Come un test della migrazione, gli utenti creati tramite Universal Providers dovrebbero essere possibile accedere e devono essere in grado di registrare i nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="2d9f8-115">È possibile trovare l'esempio completo alla [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="2d9f8-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>

## <a name="profile-data-migration-summary"></a><span data-ttu-id="2d9f8-116">Riepilogo della migrazione dei dati del profilo</span><span class="sxs-lookup"><span data-stu-id="2d9f8-116">Profile data migration summary</span></span>

<span data-ttu-id="2d9f8-117">Prima di iniziare con le migrazioni, esaminiamo l'esperienza di archiviazione dei dati del profilo nel modello di provider.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="2d9f8-118">Profilo dati per applicazione gli utenti possono essere archiviati in diversi modi, i più comuni tra di essi in corso usando provider di profili incorporato fornito con i provider universali.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="2d9f8-119">Includono i passaggi</span><span class="sxs-lookup"><span data-stu-id="2d9f8-119">The steps would include</span></span>

1. <span data-ttu-id="2d9f8-120">Aggiungere una classe che ha le proprietà utilizzate per archiviare i dati del profilo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="2d9f8-121">Aggiungere una classe che estende 'ProfileBase' e implementa i metodi per ottenere i dati del profilo precedente per l'utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="2d9f8-122">Consentire l'uso di provider di profili predefiniti in di *Web. config* file e definire la classe dichiarata nel passaggio #2 da utilizzare per l'accesso a informazioni sul profilo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="2d9f8-123">Le informazioni sul profilo vengono archiviati come dati binari nella tabella "Profiles" nel database e xml serializzato.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="2d9f8-124">Dopo la migrazione dell'applicazione per usare il nuovo sistema di identità di ASP.NET, le informazioni sul profilo viene deserializzati e archiviati come proprietà della classe utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="2d9f8-125">Ogni proprietà possono quindi essere mappate in colonne nella tabella utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="2d9f8-126">Il vantaggio è che le proprietà possono essere svolte direttamente usando la classe dell'utente oltre a disporre di non serializzare o deserializzare informazioni dati ogni ora durante l'accesso.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="2d9f8-127">Introduzione</span><span class="sxs-lookup"><span data-stu-id="2d9f8-127">Getting Started</span></span>

1. <span data-ttu-id="2d9f8-128">Creare una nuova applicazione Web Form ASP.NET 4.5 in Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="2d9f8-129">L'esempio corrente Usa il modello Web Form, ma è possibile usare anche applicazione MVC.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="2d9f8-130">Creare una nuova cartella 'Modelli' per archiviare le informazioni sul profilo</span><span class="sxs-lookup"><span data-stu-id="2d9f8-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="2d9f8-131">Ad esempio, invia i tuoi commenti archiviare la data di nascita, città, altezza e spessore dell'utente nel profilo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="2d9f8-132">L'altezza e spessore vengono archiviati come una classe personalizzata denominata 'PersonalStats'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="2d9f8-133">Per archiviare e recuperare il profilo, è necessaria una classe che estende 'ProfileBase'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="2d9f8-134">È possibile creare una nuova classe 'AppProfile' per ottenere e archiviare le informazioni del profilo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="2d9f8-135">Abilitare il profilo nel *Web. config* file.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="2d9f8-136">Immettere il nome della classe da utilizzare per archiviare/recuperare le informazioni utente create nel passaggio #3.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="2d9f8-137">Aggiungere una pagina web form nella cartella "Account" per ottenere i dati del profilo da parte dell'utente e archiviarli.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="2d9f8-138">Fare clic con il pulsante destro sul progetto e selezionare "Aggiungi nuovo elemento".</span><span class="sxs-lookup"><span data-stu-id="2d9f8-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="2d9f8-139">Aggiungere una nuova pagina Web Form con pagina master 'AddProfileData.aspx'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="2d9f8-140">Copiare quanto segue nella sezione 'MainContent':</span><span class="sxs-lookup"><span data-stu-id="2d9f8-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="2d9f8-141">Aggiungere il codice seguente nel code-behind:</span><span class="sxs-lookup"><span data-stu-id="2d9f8-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="2d9f8-142">Aggiungere lo spazio dei nomi in cui AppProfile classe è definita per rimuovere gli errori di compilazione.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="2d9f8-143">Eseguire l'app e creare un nuovo utente con il nome utente '**olduser'.**</span><span class="sxs-lookup"><span data-stu-id="2d9f8-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="2d9f8-144">Passare alla pagina 'AddProfileData' e aggiungere informazioni sul profilo dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="2d9f8-145">È possibile verificare che i dati vengono archiviati come codice xml serializzato nella tabella "Profiles" utilizzando la finestra Esplora Server.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="2d9f8-146">In Visual Studio, scegliere dal menu 'View', 'Esplora Server'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="2d9f8-147">Deve essere presente una connessione dati per il database definito nel *Web. config* file.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="2d9f8-148">Fare clic sulla connessione dati per visualizzare diverse sottocategorie.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="2d9f8-149">Espandere 'Tabelle' per mostrare le diverse tabelle nel database, quindi fare clic con il pulsante destro su "Profiles" e scegliere "Mostra dati tabella' per visualizzare i dati di profilo archiviati nella tabella di profili.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="2d9f8-150">La migrazione di schemi di database</span><span class="sxs-lookup"><span data-stu-id="2d9f8-150">Migrating database schema</span></span>

<span data-ttu-id="2d9f8-151">Per correggere il database esistente con il sistema di identità, è necessario aggiornare lo schema nel database di identità per supportare i campi che sono aggiunte al database originale.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="2d9f8-152">Questa operazione può essere eseguita con gli script SQL per creare nuove tabelle e copiare le informazioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="2d9f8-153">Nella finestra 'Server Explorer' espandere 'DefaultConnection' per visualizzare le tabelle.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="2d9f8-154">Fare clic con il pulsante destro tabelle e selezionare 'Nuova Query'</span><span class="sxs-lookup"><span data-stu-id="2d9f8-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="2d9f8-155">Incollare lo script SQL dalla [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) ed eseguirlo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="2d9f8-156">Se la stringa 'DefaultConnection' vengono aggiornate, noteremo che vengono aggiunte le nuove tabelle.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="2d9f8-157">È possibile controllare i dati all'interno di tabelle per verificare che le informazioni sono stata eseguita la migrazione.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="2d9f8-158">La migrazione dell'applicazione per usare ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="2d9f8-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="2d9f8-159">Installare i pacchetti Nuget necessari per ASP.NET Identity:</span><span class="sxs-lookup"><span data-stu-id="2d9f8-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="2d9f8-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="2d9f8-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="2d9f8-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="2d9f8-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="2d9f8-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="2d9f8-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="2d9f8-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="2d9f8-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="2d9f8-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="2d9f8-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="2d9f8-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="2d9f8-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="2d9f8-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="2d9f8-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="2d9f8-167">Altre informazioni sulla gestione dei pacchetti Nuget sono reperibili [qui](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="2d9f8-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="2d9f8-168">Per lavorare con i dati esistenti nella tabella, è necessario creare le classi modello che eseguire il mapping a tabelle e agganciare il sistema di identità.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="2d9f8-169">Come parte del contratto dell'identità, le classi del modello devono implementare le interfacce definite nella dll Identity.Core o estendono l'implementazione esistente di queste interfacce disponibili in EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="2d9f8-170">Si useranno le classi esistenti per ruolo, gli accessi utente e le attestazioni utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="2d9f8-171">È necessario usare un utente personalizzato per questo esempio.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="2d9f8-172">Fare clic con il pulsante destro sul progetto e creare una nuova cartella 'IdentityModels'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="2d9f8-173">Aggiungere una nuova classe di 'User', come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="2d9f8-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="2d9f8-174">Si noti che il 'ProfileInfo' a questo punto è una proprietà nella classe utente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="2d9f8-175">Di conseguenza è possibile usare la classe dell'utente per lavorare direttamente con i dati del profilo.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="2d9f8-176">Copiare i file nei **IdentityModels** e **IdentityAccount** cartelle dall'origine dei download ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="2d9f8-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="2d9f8-177">Queste sono le altre classi di modello e le nuove pagine necessari per l'utente e la gestione dei ruoli usando le API di identità di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="2d9f8-178">L'approccio usato è simile all'appartenenza SQL e una descrizione dettagliata è reperibile [qui](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="2d9f8-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="2d9f8-179">Copia dei dati di profilo per le nuove tabelle</span><span class="sxs-lookup"><span data-stu-id="2d9f8-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="2d9f8-180">Come accennato in precedenza, è necessario deserializzare i dati xml nelle tabelle di profili e archiviarlo in colonne della tabella AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="2d9f8-181">Nella tabella di utenti nel passaggio precedente sono state create le nuove colonne in modo che tutto ciò che resta consiste nel popolare le colonne con i dati necessari.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="2d9f8-182">A tale scopo, si userà un'applicazione console che viene eseguita una sola volta per popolare le colonne della tabella utente appena create.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="2d9f8-183">Creare una nuova applicazione console della soluzione in fase di chiusura.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="2d9f8-184">Installare la versione più recente del pacchetto di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="2d9f8-185">Aggiungere l'applicazione web creata in precedenza come riferimento per l'applicazione console.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="2d9f8-186">Per eseguire questo pulsante destro del mouse fare clic sul progetto, quindi 'Aggiungi riferimenti', quindi soluzioni, quindi fare clic sul progetto e fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="2d9f8-187">Copiare il seguente codice nella classe Program.cs.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="2d9f8-188">Questa logica legge i dati del profilo per ogni utente, lo serializza come 'ProfileInfo' oggetto e la archivia nel database.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="2d9f8-189">Alcuni dei modelli utilizzati sono definiti nella cartella 'IdentityModels' del progetto dell'applicazione web, pertanto è necessario includere gli spazi dei nomi corrispondente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="2d9f8-190">Il codice sopra riportato funziona sul file di database nell'App\_cartella dati del progetto dell'applicazione web creata nei passaggi precedenti.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="2d9f8-191">Per fare riferimento a tale, aggiornare la stringa di connessione nel file app. config dell'applicazione console con la stringa di connessione in Web. config dell'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="2d9f8-192">Specificare anche il percorso fisico completo nella proprietà 'AttachDbFilename'.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="2d9f8-193">Aprire un prompt dei comandi e passare alla cartella bin dell'applicazione console precedente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="2d9f8-194">Eseguire il file eseguibile ed esaminare l'output del log, come illustrato nell'immagine seguente.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="2d9f8-195">Aprire la tabella 'AspNetUsers' in Esplora Server e verificare i dati in nuove colonne che contengono le proprietà.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="2d9f8-196">È necessario aggiornarli con i valori di proprietà corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="2d9f8-197">Verificare le funzionalità</span><span class="sxs-lookup"><span data-stu-id="2d9f8-197">Verify functionality</span></span>

<span data-ttu-id="2d9f8-198">Utilizzare le pagine di appartenenze appena aggiunto che vengono implementate usando ASP.NET Identity per eseguire l'accesso di un utente dal database obsoleto.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="2d9f8-199">L'utente deve essere in grado di accedere usando le stesse credenziali.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="2d9f8-200">Provare altre funzionalità quali l'aggiunta di OAuth, creando un nuovo utente, la modifica di una password, l'aggiunta di ruoli, aggiungere utenti a ruoli e così via.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="2d9f8-201">I dati del profilo dell'utente precedente e i nuovi utenti devono essere recuperati e archiviati nella tabella degli utenti.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="2d9f8-202">La vecchia tabella non deve non sarà più possibile fare riferimento.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="2d9f8-203">Conclusione</span><span class="sxs-lookup"><span data-stu-id="2d9f8-203">Conclusion</span></span>

<span data-ttu-id="2d9f8-204">L'articolo ha illustrato il processo di migrazione delle applicazioni web che utilizza il modello di provider per l'appartenenza ad ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="2d9f8-205">L'articolo è descritta anche la migrazione dei dati di profilo per gli utenti di effettuare l'hook nel sistema di identità.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="2d9f8-206">Lasciare commenti sotto per domande e risolvere i problemi riscontrati quando si esegue la migrazione all'app.</span><span class="sxs-lookup"><span data-stu-id="2d9f8-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="2d9f8-207">*Rick Anderson e Robert McMurray grazie per aver letto l'articolo.*</span><span class="sxs-lookup"><span data-stu-id="2d9f8-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
