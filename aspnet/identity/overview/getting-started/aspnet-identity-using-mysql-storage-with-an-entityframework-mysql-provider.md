---
uid: identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
title: "ASP.NET Identity: uso dell'archiviazione MySQL con un provider MySQL EntityFrameworkC#()-ASP.NET 4. x"
author: maumar
description: Questa esercitazione illustra come sostituire il meccanismo di archiviazione dei dati predefinito per ASP.NET Identity con EntityFramework (provider client SQL) con un provid MySQL...
ms.author: riande
ms.date: 12/10/2013
ms.assetid: 15253312-a92c-43ba-908e-b5dacd3d08b8
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
msc.type: authoredcontent
ms.openlocfilehash: e89ed139657c5ce9ddcc56879946c62038919483
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584007"
---
# <a name="aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider-c"></a><span data-ttu-id="339bb-103">ASP.NET Identity: uso dell'archiviazione MySQL con un provider MySQL EntityFrameworkC#()</span><span class="sxs-lookup"><span data-stu-id="339bb-103">ASP.NET Identity: Using MySQL Storage with an EntityFramework MySQL Provider (C#)</span></span>

<span data-ttu-id="339bb-104">di [Maurycy Markowski](https://github.com/maumar), [Raquel Soares de Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span><span class="sxs-lookup"><span data-stu-id="339bb-104">by [Maurycy Markowski](https://github.com/maumar), [Raquel Soares De Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span></span>

> <span data-ttu-id="339bb-105">Questa esercitazione illustra come sostituire il meccanismo di archiviazione dei dati predefinito per [**ASP.NET Identity**](introduction-to-aspnet-identity.md) con EntityFramework (provider client SQL) con un provider MySQL.</span><span class="sxs-lookup"><span data-stu-id="339bb-105">This tutorial shows you how to replace the default data storage mechanism for [**ASP.NET Identity**](introduction-to-aspnet-identity.md) with EntityFramework (SQL client provider) with a MySQL provider.</span></span>

<span data-ttu-id="339bb-106">In questa esercitazione verranno trattati gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="339bb-106">The following topics will be covered in this tutorial:</span></span>

- <span data-ttu-id="339bb-107">Creazione di un database MySQL in Azure</span><span class="sxs-lookup"><span data-stu-id="339bb-107">Creating a MySQL database on Azure</span></span>
- <span data-ttu-id="339bb-108">Creazione di un'applicazione MVC con Visual Studio 2013 modello MVC</span><span class="sxs-lookup"><span data-stu-id="339bb-108">Creating an MVC application using Visual Studio 2013 MVC template</span></span>
- <span data-ttu-id="339bb-109">Configurazione di EntityFramework per l'uso con un provider di database MySQL</span><span class="sxs-lookup"><span data-stu-id="339bb-109">Configuring EntityFramework to work with a MySQL database provider</span></span>
- <span data-ttu-id="339bb-110">Esecuzione dell'applicazione per verificare i risultati</span><span class="sxs-lookup"><span data-stu-id="339bb-110">Running the application to verify the results</span></span>

<span data-ttu-id="339bb-111">Al termine di questa esercitazione, si disporrà di un'applicazione MVC con l'archivio ASP.NET Identity che usa un database MySQL ospitato in Azure.</span><span class="sxs-lookup"><span data-stu-id="339bb-111">At the end of this tutorial, you will have an MVC application with the ASP.NET Identity store that is using a MySQL database that is hosted in Azure.</span></span>

## <a name="creating-a-mysql-database-instance-on-azure"></a><span data-ttu-id="339bb-112">Creazione di un'istanza del database MySQL in Azure</span><span class="sxs-lookup"><span data-stu-id="339bb-112">Creating a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="339bb-113">Accedere al [portale di Azure](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="339bb-113">Log in to the [Azure Portal](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span></span>
2. <span data-ttu-id="339bb-114">Fare clic su **nuovo** nella parte inferiore della pagina e quindi selezionare **Store**:</span><span class="sxs-lookup"><span data-stu-id="339bb-114">Click **NEW** at the bottom of the page, and then select **STORE**:</span></span>

    [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.png)
3. <span data-ttu-id="339bb-115">Nella procedura guidata **Scegli e componente** aggiuntivo selezionare **ClearDB MySQL database**e quindi fare clic sulla freccia **Avanti** nella parte inferiore del frame:</span><span class="sxs-lookup"><span data-stu-id="339bb-115">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database**, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="339bb-116">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-116">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span></span>
4. <span data-ttu-id="339bb-118">Mantieni il piano **gratuito** predefinito, modifica il **nome** in **IdentityMySQLDatabase**, seleziona l'area più vicina, quindi fai clic sulla freccia **Avanti** nella parte inferiore del frame:</span><span class="sxs-lookup"><span data-stu-id="339bb-118">Keep the default **Free** plan, change the **NAME** to **IdentityMySQLDatabase**, select the region that is nearest to you, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="339bb-119">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-119">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span></span>
5. <span data-ttu-id="339bb-121">Fare clic sul segno di spunta **Acquista** per completare la creazione del database.</span><span class="sxs-lookup"><span data-stu-id="339bb-121">Click the **PURCHASE** checkmark to complete the database creation.</span></span>

   <span data-ttu-id="339bb-122">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-122">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span></span>
6. <span data-ttu-id="339bb-124">Dopo che è stato creato, il database può essere gestito nella scheda **ADD-ONS** del portale di gestione.</span><span class="sxs-lookup"><span data-stu-id="339bb-124">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span> <span data-ttu-id="339bb-125">Per recuperare le informazioni di connessione per il database, fare clic su **informazioni di connessione** nella parte inferiore della pagina:</span><span class="sxs-lookup"><span data-stu-id="339bb-125">To retrieve the connection information for your database, click **CONNECTION INFO** at the bottom of the page:</span></span>

   <span data-ttu-id="339bb-126">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-126">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span></span>
7. <span data-ttu-id="339bb-128">Copiare la stringa di connessione facendo clic sul pulsante Copy (copia) nel campo **CONNECTIONSTRING** e salvarla. Queste informazioni vengono usate più avanti in questa esercitazione per l'applicazione MVC:</span><span class="sxs-lookup"><span data-stu-id="339bb-128">Copy the connection string by clicking on the copy button by the **CONNECTIONSTRING** field and save it; you will use this information later in this tutorial for your MVC application:</span></span>

   <span data-ttu-id="339bb-129">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-129">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span></span>

## <a name="creating-an-mvc-application-project"></a><span data-ttu-id="339bb-131">Creazione di un progetto di applicazione MVC</span><span class="sxs-lookup"><span data-stu-id="339bb-131">Creating an MVC application project</span></span>

<span data-ttu-id="339bb-132">Per completare i passaggi descritti in questa sezione dell'esercitazione, è necessario installare [Visual Studio Express 2013 per il Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="339bb-132">To complete the steps in this section of the tutorial, you will first need to install [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="339bb-133">Una volta installato Visual Studio, attenersi alla procedura seguente per creare un nuovo progetto di applicazione MVC:</span><span class="sxs-lookup"><span data-stu-id="339bb-133">Once Visual Studio has been installed, use the following steps to create a new MVC application project:</span></span>

1. <span data-ttu-id="339bb-134">Aprire Visual Studio 2103.</span><span class="sxs-lookup"><span data-stu-id="339bb-134">Open Visual Studio 2103.</span></span>
2. <span data-ttu-id="339bb-135">Fare clic su **nuovo progetto** nella pagina **iniziale** . in alternativa, è possibile fare clic sul menu **file** e quindi su **nuovo progetto**:</span><span class="sxs-lookup"><span data-stu-id="339bb-135">Click **New Project** from the **Start** page, or you can click the **File** menu and then **New Project**:</span></span>

   <span data-ttu-id="339bb-136">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-136">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="339bb-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span></span>
3. <span data-ttu-id="339bb-138">Quando viene visualizzata la finestra di dialogo **nuovo progetto** , **espandere C# Visual** nell'elenco dei modelli, quindi fare clic su **Web**e selezionare **applicazione Web ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="339bb-138">When the **New Project** dialog box is displayed, expand **Visual C#** in the list of templates, then click **Web**, and select **ASP.NET Web Application**.</span></span> <span data-ttu-id="339bb-139">Assegnare al progetto il nome **IdentityMySQLDemo** e quindi fare clic su **OK**:</span><span class="sxs-lookup"><span data-stu-id="339bb-139">Name your project **IdentityMySQLDemo** and then click **OK**:</span></span>

   <span data-ttu-id="339bb-140">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-140">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span></span>
4. <span data-ttu-id="339bb-142">Nella finestra di dialogo **nuovo progetto ASP.NET** selezionare **MVC** templatewith opzioni predefinite. in questo modo, i **singoli account utente** vengono configurati come metodo di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="339bb-142">In the **New ASP.NET Project** dialog, select the **MVC** templatewith the default options; this will configure **Individual User Accounts** as the authentication method.</span></span> <span data-ttu-id="339bb-143">Fare clic su **OK**:</span><span class="sxs-lookup"><span data-stu-id="339bb-143">Click **OK**:</span></span>

   <span data-ttu-id="339bb-144">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-144">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span></span>

## <a name="configure-entityframework-to-work-with-a-mysql-database"></a><span data-ttu-id="339bb-146">Configurare EntityFramework per l'uso con un database MySQL</span><span class="sxs-lookup"><span data-stu-id="339bb-146">Configure EntityFramework to work with a MySQL database</span></span>

### <a name="update-the-entity-framework-assembly-for-your-project"></a><span data-ttu-id="339bb-147">Aggiornare l'assembly Entity Framework per il progetto</span><span class="sxs-lookup"><span data-stu-id="339bb-147">Update the Entity Framework assembly for your project</span></span>

<span data-ttu-id="339bb-148">L'applicazione MVC creata dal modello di Visual Studio 2013 contiene un riferimento al pacchetto 6.0.0 di [EntityFramework](http://www.nuget.org/packages/EntityFramework) , ma sono stati apportati aggiornamenti a tale assembly dalla relativa versione che contengono miglioramenti significativi delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="339bb-148">The MVC application that was created from the Visual Studio 2013 template contains a reference to the [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) package, but there have been updates to that assembly since its release which contain significant performance improvements.</span></span> <span data-ttu-id="339bb-149">Per usare questi ultimi aggiornamenti nell'applicazione, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="339bb-149">In order to use these latest updates in your application, use the following steps.</span></span>

1. <span data-ttu-id="339bb-150">Aprire il progetto MVC in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="339bb-150">Open your MVC project in Visual Studio.</span></span>
2. <span data-ttu-id="339bb-151">Fare clic su **strumenti**, quindi fare clic su **Gestione pacchetti NuGet**e quindi su **console di gestione pacchetti**:</span><span class="sxs-lookup"><span data-stu-id="339bb-151">Click **Tools**, then click **NuGet Package Manager**, and then click **Package Manager Console**:</span></span>

   <span data-ttu-id="339bb-152">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-152">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span></span>
3. <span data-ttu-id="339bb-154">La **console di gestione pacchetti** verrà visualizzata nella sezione inferiore di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="339bb-154">The **Package Manager Console** will appear in the bottom section of Visual Studio.</span></span> <span data-ttu-id="339bb-155">Digitare &quot;**Update-Package EntityFramework**&quot; e premere INVIO:</span><span class="sxs-lookup"><span data-stu-id="339bb-155">Type &quot;**Update-Package EntityFramework**&quot; and press Enter:</span></span>

   <span data-ttu-id="339bb-156">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-156">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span></span>

### <a name="install-the-mysql-provider-for-entityframework"></a><span data-ttu-id="339bb-158">Installare il provider MySQL per EntityFramework</span><span class="sxs-lookup"><span data-stu-id="339bb-158">Install the MySQL provider for EntityFramework</span></span>

<span data-ttu-id="339bb-159">Per consentire a EntityFramework di connettersi al database MySQL, è necessario installare un provider MySQL.</span><span class="sxs-lookup"><span data-stu-id="339bb-159">In order for EntityFramework to connect to MySQL database, you need to install a MySQL provider.</span></span> <span data-ttu-id="339bb-160">A tale scopo, aprire la **console di gestione pacchetti** e digitare &quot;**Install-Package MySQL. Data. Entity-pre**&quot;, quindi premere INVIO.</span><span class="sxs-lookup"><span data-stu-id="339bb-160">To do so, open the **Package Manager Console** and type &quot;**Install-Package MySql.Data.Entity -Pre**&quot;, and then press Enter.</span></span>

> [!NOTE]
> <span data-ttu-id="339bb-161">Si tratta di una versione non definitiva dell'assembly e, di conseguenza, può contenere bug.</span><span class="sxs-lookup"><span data-stu-id="339bb-161">This is a pre-release version of the assembly, and as such it may contain bugs.</span></span> <span data-ttu-id="339bb-162">Non usare una versione non definitiva del provider in produzione.</span><span class="sxs-lookup"><span data-stu-id="339bb-162">You should not use a pre-release version of the provider in production.</span></span>

<span data-ttu-id="339bb-163">[Fare clic sull'immagine seguente per espanderla.]</span><span class="sxs-lookup"><span data-stu-id="339bb-163">[Click the following image to expand it.]</span></span>

[![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image22.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image21.png)

### <a name="making-project-configuration-changes-to-the-webconfig-file-for-your-application"></a><span data-ttu-id="339bb-164">Apportare modifiche alla configurazione del progetto nel file Web. config per l'applicazione</span><span class="sxs-lookup"><span data-stu-id="339bb-164">Making project configuration changes to the Web.config file for your application</span></span>

<span data-ttu-id="339bb-165">In questa sezione si configurerà il Entity Framework per usare il provider MySQL appena installato, si registrerà la factory del provider MySQL e si aggiungerà la stringa di connessione da Azure.</span><span class="sxs-lookup"><span data-stu-id="339bb-165">In this section you will configure the Entity Framework to use the MySQL provider that you just installed, register the MySQL provider factory, and add your connection string from Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="339bb-166">Gli esempi seguenti contengono una versione dell'assembly specifica per MySql. Data. dll.</span><span class="sxs-lookup"><span data-stu-id="339bb-166">The following examples contain a specific assembly version for MySql.Data.dll.</span></span> <span data-ttu-id="339bb-167">Se la versione dell'assembly viene modificata, sarà necessario modificare le impostazioni di configurazione appropriate con la versione corretta.</span><span class="sxs-lookup"><span data-stu-id="339bb-167">If the assembly version changes, you will need to modify the appropriate configuration settings with the correct version.</span></span>

1. <span data-ttu-id="339bb-168">Aprire il file Web. config del progetto in Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="339bb-168">Open the Web.config file for your project in Visual Studio 2013.</span></span>
2. <span data-ttu-id="339bb-169">Individuare le impostazioni di configurazione seguenti, che definiscono il provider di database predefinito e la factory per il Entity Framework:</span><span class="sxs-lookup"><span data-stu-id="339bb-169">Locate the following configuration settings, which define the default database provider and factory for the Entity Framework:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample1.xml)]
3. <span data-ttu-id="339bb-170">Sostituire le impostazioni di configurazione con le seguenti, in modo da configurare il Entity Framework per l'uso del provider MySQL:</span><span class="sxs-lookup"><span data-stu-id="339bb-170">Replace those configuration settings with the following, which will configure the Entity Framework to use the MySQL provider:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample2.xml)]
4. <span data-ttu-id="339bb-171">Individuare la sezione &lt;connectionStrings&gt; e sostituirla con il codice seguente, che definirà la stringa di connessione per il database MySQL ospitato in Azure (si noti che anche il valore ProviderName è stato modificato rispetto all'originale):</span><span class="sxs-lookup"><span data-stu-id="339bb-171">Locate the &lt;connectionStrings&gt; section and replace it with the following code, which will define the connection string for your MySQL database that is hosted on Azure (note that providerName value has also been changed from the original):</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample3.xml?highlight=3-4)]

### <a name="adding-custom-migrationhistory-context"></a><span data-ttu-id="339bb-172">Aggiunta del contesto MigrationHistory personalizzato</span><span class="sxs-lookup"><span data-stu-id="339bb-172">Adding custom MigrationHistory context</span></span>

<span data-ttu-id="339bb-173">Entity Framework Code First usa una tabella **MigrationHistory** per tenere traccia delle modifiche del modello e per garantire la coerenza tra lo schema del database e lo schema concettuale.</span><span class="sxs-lookup"><span data-stu-id="339bb-173">Entity Framework Code First uses a **MigrationHistory** table to keep track of model changes and to ensure the consistency between the database schema and conceptual schema.</span></span> <span data-ttu-id="339bb-174">Tuttavia, questa tabella non funziona per MySQL per impostazione predefinita perché la chiave primaria è troppo grande.</span><span class="sxs-lookup"><span data-stu-id="339bb-174">However, this table does not work for MySQL by default because the primary key is too large.</span></span> <span data-ttu-id="339bb-175">Per risolvere questo problema, è necessario ridurre le dimensioni della chiave per tale tabella.</span><span class="sxs-lookup"><span data-stu-id="339bb-175">To remedy this situation, you will need to shrink the key size for that table.</span></span> <span data-ttu-id="339bb-176">A tale scopo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="339bb-176">To do so, use the following steps:</span></span>

1. <span data-ttu-id="339bb-177">Le informazioni sullo schema per questa tabella vengono acquisite in un **HistoryContext**, che può essere modificato come qualsiasi altro **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="339bb-177">The schema information for this table is captured in a **HistoryContext**, which can be modified as any other **DbContext**.</span></span> <span data-ttu-id="339bb-178">A tale scopo, aggiungere un nuovo file di classe denominato **MySqlHistoryContext.cs** al progetto e sostituirne il contenuto con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="339bb-178">To do so, add a new class file named **MySqlHistoryContext.cs** to the project, and replace its contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample4.cs)]
2. <span data-ttu-id="339bb-179">Successivamente, è necessario configurare Entity Framework per l'uso di **HistoryContext**modificati, anziché di uno predefinito.</span><span class="sxs-lookup"><span data-stu-id="339bb-179">Next you will need to configure Entity Framework to use the modified **HistoryContext**, rather than default one.</span></span> <span data-ttu-id="339bb-180">Questa operazione può essere eseguita sfruttando le funzionalità di configurazione basate su codice.</span><span class="sxs-lookup"><span data-stu-id="339bb-180">This can be done by leveraging code-based configuration features.</span></span> <span data-ttu-id="339bb-181">A tale scopo, aggiungere il nuovo file di classe denominato **MySqlConfiguration.cs** al progetto e sostituirne il contenuto con:</span><span class="sxs-lookup"><span data-stu-id="339bb-181">To do so, add new class file named **MySqlConfiguration.cs** to your project and replace its contents with:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample5.cs)]

### <a name="creating-a-custom-entityframework-initializer-for-applicationdbcontext"></a><span data-ttu-id="339bb-182">Creazione di un inizializzatore EntityFramework personalizzato per ApplicationDbContext</span><span class="sxs-lookup"><span data-stu-id="339bb-182">Creating a custom EntityFramework initializer for ApplicationDbContext</span></span>

<span data-ttu-id="339bb-183">Il provider MySQL incluso in questa esercitazione attualmente non supporta le migrazioni di Entity Framework, quindi è necessario usare gli inizializzatori di modello per connettersi al database.</span><span class="sxs-lookup"><span data-stu-id="339bb-183">The MySQL provider that is featured in this tutorial does not currently support Entity Framework migrations, so you will need to use model initializers in order to connect to the database.</span></span> <span data-ttu-id="339bb-184">Poiché questa esercitazione usa un'istanza di MySQL in Azure, sarà necessario creare un inizializzatore di Entity Framework personalizzato.</span><span class="sxs-lookup"><span data-stu-id="339bb-184">Because this tutorial is using a MySQL instance on Azure, you will need to create a custom Entity Framework initializer.</span></span>

> [!NOTE]
> <span data-ttu-id="339bb-185">Questo passaggio non è necessario se ci si connette a un'istanza di SQL Server in Azure o se si usa un database ospitato in locale.</span><span class="sxs-lookup"><span data-stu-id="339bb-185">This step is not required if you are connecting to a SQL Server instance on Azure or if you are using a database that is hosted on premises.</span></span>

<span data-ttu-id="339bb-186">Per creare un inizializzatore di Entity Framework personalizzato per MySQL, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="339bb-186">To create a custom Entity Framework initializer for MySQL, use the following steps:</span></span>

1. <span data-ttu-id="339bb-187">Aggiungere al progetto un nuovo file di classe denominato **MySqlInitializer.cs** e sostituirne il contenuto con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="339bb-187">Add a new class file named **MySqlInitializer.cs** to the project, and replace it's contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample6.cs?highlight=23)]
2. <span data-ttu-id="339bb-188">Aprire il file **IdentityModels.cs** per il progetto, che si trova nella directory **Models** e sostituirne il contenuto con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="339bb-188">Open the **IdentityModels.cs** file for your project, which is located in the **Models** directory, and replace it's contents with the following:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample7.cs)]

## <a name="running-the-application-and-verifying-the-database"></a><span data-ttu-id="339bb-189">Esecuzione dell'applicazione e verifica del database</span><span class="sxs-lookup"><span data-stu-id="339bb-189">Running the application and verifying the database</span></span>

<span data-ttu-id="339bb-190">Una volta completati i passaggi nelle sezioni precedenti, è necessario eseguire il test del database.</span><span class="sxs-lookup"><span data-stu-id="339bb-190">Once you have completed the steps in the preceding sections, you should test your database.</span></span> <span data-ttu-id="339bb-191">A tale scopo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="339bb-191">To do so, use the following steps:</span></span>

1. <span data-ttu-id="339bb-192">Premere **CTRL + F5** per compilare ed eseguire l'applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="339bb-192">Press **Ctrl + F5** to build and run the web application.</span></span>
2. <span data-ttu-id="339bb-193">Fare clic sulla scheda **Register (registra** ) nella parte superiore della pagina:</span><span class="sxs-lookup"><span data-stu-id="339bb-193">Click the **Register** tab on the top of the page:</span></span>

   <span data-ttu-id="339bb-194">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-194">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="339bb-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span></span>
3. <span data-ttu-id="339bb-196">Immettere un nuovo nome utente e una nuova password e quindi fare clic su **Register (registra**):</span><span class="sxs-lookup"><span data-stu-id="339bb-196">Enter a new user name and password, and then click **Register**:</span></span>

   <span data-ttu-id="339bb-197">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-197">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span></span>
4. <span data-ttu-id="339bb-199">A questo punto, le tabelle ASP.NET Identity vengono create nel database MySQL e l'utente viene registrato e registrato nell'applicazione:</span><span class="sxs-lookup"><span data-stu-id="339bb-199">At this point the ASP.NET Identity tables are created on the MySQL Database, and the user is registered and logged into the application:</span></span>

   <span data-ttu-id="339bb-200">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-200">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span><span class="sxs-lookup"><span data-stu-id="339bb-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span></span>

### <a name="installing-mysql-workbench-tool-to-verify-the-data"></a><span data-ttu-id="339bb-202">Installazione dello strumento MySQL Workbench per la verifica dei dati</span><span class="sxs-lookup"><span data-stu-id="339bb-202">Installing MySQL Workbench tool to verify the data</span></span>

1. <span data-ttu-id="339bb-203">Installare lo strumento **MySQL Workbench** dalla [pagina dei download di MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="339bb-203">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="339bb-204">Nell'installazione guidata: scheda **Selezione funzionalità** selezionare **MySQL Workbench** nella sezione **applicazioni** .</span><span class="sxs-lookup"><span data-stu-id="339bb-204">In the installation wizard: **Feature Selection** tab, select **MySQL Workbench** under **applications** section.</span></span>
3. <span data-ttu-id="339bb-205">Avviare l'app e aggiungere una nuova connessione usando i dati della stringa di connessione del database MySQL di Azure creato durante l'accattonaggio di questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="339bb-205">Launch the app and add a new connection using the connection string data from the Azure MySQL database you created at the begging of this tutorial.</span></span>
4. <span data-ttu-id="339bb-206">Dopo aver stabilito la connessione, esaminare le tabelle **ASP.NET Identity** create in **IdentityMySQLDatabase.**</span><span class="sxs-lookup"><span data-stu-id="339bb-206">After establishing the connection, inspect the **ASP.NET Identity** tables created on the **IdentityMySQLDatabase.**</span></span>
5. <span data-ttu-id="339bb-207">Si noterà che tutte le tabelle ASP.NET Identity richieste vengono create come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="339bb-207">You will see that all ASP.NET Identity required tables are created as shown in the image below:</span></span>

   <span data-ttu-id="339bb-208">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-208">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="339bb-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span></span>
6. <span data-ttu-id="339bb-210">Esaminare la tabella **aspnetusers** per l'istanza di per verificare la presenza di voci durante la registrazione di nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="339bb-210">Inspect the **aspnetusers** table for instance to check for the entries as you register new users.</span></span>

   <span data-ttu-id="339bb-211">[Fare clic sull'immagine seguente per espanderla.</span><span class="sxs-lookup"><span data-stu-id="339bb-211">[Click the following image to expand it.</span></span> <span data-ttu-id="339bb-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="339bb-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span></span>
