---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Sviluppo di app ASP.NET con Azure Active Directory-ASP.NET 4. x
author: Rick-Anderson
description: Microsoft ASP.NET Tools per Azure Active Directory semplifica l'abilitazione dell'autenticazione per le applicazioni Web ospitate in Azure. È possibile usare Azure Preautenti...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 28425ea8d1312dfc6e14df9677396f2cbcf6f16d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456725"
---
# <a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="4b2a3-104">Sviluppo di app ASP.NET con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="4b2a3-104">Developing ASP.NET Apps with Azure Active Directory</span></span>

<span data-ttu-id="4b2a3-105">di [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="4b2a3-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="4b2a3-106">Microsoft ASP.NET Tools per Azure Active Directory semplifica l'abilitazione dell'autenticazione per le app Web ospitate in [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="4b2a3-107">È possibile usare l'autenticazione di Azure per autenticare gli utenti di Office 365 dall'organizzazione, gli account aziendali sincronizzati dal Active Directory locale o dagli utenti creati nel dominio Azure Active Directory personalizzato.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="4b2a3-108">Con l'abilitazione dell'autenticazione di Windows Azure, l'applicazione viene configurata per autenticare gli utenti tramite un singolo tenant [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="4b2a3-109">In questa esercitazione viene illustrato come creare un'applicazione ASP.NET configurata per l'accesso con [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure ad).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="4b2a3-110">Si apprenderà anche come chiamare il API Graph per ottenere informazioni sull'utente attualmente connesso e su come distribuire l'applicazione in Azure.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4b2a3-111">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="4b2a3-111">Prerequisites</span></span>

1. <span data-ttu-id="4b2a3-112">[Visual Studio Express 2013 per il Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) o [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="4b2a3-113">È necessario [Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) aggiornamento 3 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="4b2a3-114">Un account Azure.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-114">An Azure account.</span></span> <span data-ttu-id="4b2a3-115">Per una versione di valutazione gratuita, [fare clic qui](https://azure.microsoft.com/pricing/free-trial/) se non si ha già un account.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="4b2a3-116">Aggiungere un amministratore globale al Active Directory</span><span class="sxs-lookup"><span data-stu-id="4b2a3-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="4b2a3-117">Accedere al [portale di gestione di Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="4b2a3-118">Tutti gli account Azure contengono una **directory predefinita** , fare clic su di essa, quindi fare clic sulla scheda **utenti** nella parte superiore della pagina (vedere l'immagine seguente).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="4b2a3-119">Fare clic su Add User.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="4b2a3-120">Creare un nuovo utente con il ruolo di **amministratore globale** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="4b2a3-121">Fare clic su **utenti** nel menu in alto, quindi fare clic sul pulsante **Aggiungi utente** sulla barra dei comandi.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="4b2a3-122">Nella finestra di dialogo **Aggiungi utente** immettere un nome per il nuovo utente e quindi fare clic sulla freccia a destra.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="4b2a3-123">Immettere il nome utente e impostare il ruolo su **amministratore globale**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="4b2a3-124">Per gli amministratori globali è necessario un indirizzo di posta elettronica alternativo per il ripristino della password.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="4b2a3-125">Al termine, fare clic sulla freccia a destra.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="4b2a3-126">Nella pagina successiva della finestra di dialogo fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="4b2a3-127">Verrà creata una password temporanea per il nuovo utente e visualizzata nella finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="4b2a3-128">Salvare la password. verrà richiesto di modificare la password dopo il primo accesso.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="4b2a3-129">La figura seguente mostra il nuovo account amministratore.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-129">The following image shows the new admin account.</span></span> <span data-ttu-id="4b2a3-130">È necessario usare la Azure Active Directory per accedere all'app, non l'account Microsoft visualizzata anche in questa pagina.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="4b2a3-131">Creare un'applicazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="4b2a3-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="4b2a3-132">La procedura seguente usa [Visual Studio Express 2013 per il Web](https://www.microsoft.com/download/details.aspx?id=40747)e richiede [Visual Studio 2013 aggiornamento 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="4b2a3-133">In Visual Studio fare clic su **file** , quindi su **nuovo progetto**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="4b2a3-134">Nella finestra di dialogo **nuovo progetto** selezionare il progetto C# Web visuale dal menu a sinistra e fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="4b2a3-135">Se non si vuole usare la funzionalità per l'applicazione, è anche possibile deselezionare la casella **di controllo aggiungi Application Insights al progetto** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="4b2a3-136">Nella finestra di dialogo **nuovo progetto ASP.NET** selezionare **MVC**, quindi fare clic su **Modifica autenticazione**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="4b2a3-137">Nella finestra di dialogo **Cambia autenticazione** selezionare **account aziendali**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="4b2a3-138">Queste opzioni possono essere usate per registrare automaticamente l'applicazione con Azure AD e configurare automaticamente l'applicazione per l'integrazione con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="4b2a3-139">Non è necessario usare la finestra di dialogo **Modifica autenticazione** per registrare e configurare l'applicazione, ma ciò rende molto più semplice.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="4b2a3-140">Se si usa Visual Studio 2012, ad esempio, è comunque possibile registrare manualmente l'applicazione nel portale di gestione di Azure e aggiornarne la configurazione per l'integrazione con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="4b2a3-141">Nei menu a discesa selezionare **cloud-singola organizzazione** e **Single Sign-on, lettura dati directory**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="4b2a3-142">Immettere il dominio per la directory Azure AD, ad esempio (nelle immagini seguenti) *aricka0yahoo.onmicrosoft.com*, quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="4b2a3-143">È possibile ottenere il nome di dominio dalla scheda domini per la directory predefinita nel portale di Azure (vedere l'immagine successiva in basso).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="4b2a3-144">Nell'immagine seguente viene illustrato il nome di dominio del portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="4b2a3-145">Facoltativamente, è possibile configurare l'URI dell'ID applicazione che verrà registrato in Azure AD facendo clic su **altre opzioni**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="4b2a3-146">L'URI ID app è l'identificatore univoco per un'applicazione, registrato in Azure AD e usato dall'applicazione per identificare se stesso durante la comunicazione con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="4b2a3-147">Per ulteriori informazioni sull'URI ID app e altre proprietà delle applicazioni registrate, vedere [questo argomento](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="4b2a3-148">Facendo clic sulla casella di controllo sotto il campo URI ID app, è anche possibile scegliere di sovrascrivere una registrazione esistente in Azure AD che usa lo stesso URI ID app.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="4b2a3-149">Dopo aver fatto clic su **OK**, verrà visualizzata una finestra di dialogo di accesso con un account amministratore globale (non l'account Microsoft associato alla sottoscrizione).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="4b2a3-150">Se in precedenza è stato creato un nuovo account amministratore, sarà necessario modificare la password e quindi eseguire di nuovo l'accesso con la nuova password.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="4b2a3-151">Una volta eseguita l'autenticazione, nella finestra di dialogo **nuovo progetto ASP.NET** verranno visualizzate la scelta di autenticazione (**organizzativa** ) e la directory in cui verrà registrata la nuova applicazione (*aricka0yahoo.onmicrosoft.com* nell'immagine seguente).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="4b2a3-152">Al di sotto di queste informazioni, selezionare la casella **di controllo host nel cloud**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="4b2a3-153">Se questa casella di controllo è selezionata, il progetto verrà sottoposta a provisioning come app Web di Azure e sarà abilitato per la pubblicazione semplificata in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="4b2a3-154">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="4b2a3-155">Verrà visualizzata la finestra di dialogo **Configura sito Web di Azure** con un nome del sito e un'area generati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="4b2a3-156">Si noti anche l'account a cui si è attualmente connessi nella finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="4b2a3-157">Si vuole assicurarsi che questo account sia quello a cui è associata la sottoscrizione di Azure, in genere un account Microsoft.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="4b2a3-158">Questo progetto richiede un database.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-158">This project requires a database.</span></span> <span data-ttu-id="4b2a3-159">È necessario selezionare uno dei database esistenti o crearne uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="4b2a3-160">È necessario un database perché il progetto utilizza già un file di database locale per archiviare una piccola quantità di dati di configurazione dell'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="4b2a3-161">Quando si distribuisce l'applicazione in un sito Web di Azure, questo database non è incluso nella distribuzione, quindi è necessario sceglierne uno accessibile nel cloud.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="4b2a3-162">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="4b2a3-163">Il progetto verrà creato e le opzioni di autenticazione e le opzioni dell'app Web verranno configurate automaticamente con il progetto.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="4b2a3-164">Al termine del processo, eseguire il progetto localmente premendo **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="4b2a3-165">Verrà richiesto di accedere con l'account aziendale.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="4b2a3-166">Fornire il nome utente e la password per l'account creato in precedenza e fare clic su **Accedi**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="4b2a3-167">Al termine dell'accesso, il sito di ASP.NET indicherà che è stata eseguita l'autenticazione visualizzando il nome utente nell'angolo in alto a destra della pagina.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="4b2a3-168">Se viene ricevuto l'errore, il valore non può essere null o vuoto.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="4b2a3-169">Nome parametro: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="4b2a3-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="4b2a3-170">vedere la sezione [debug](#dbg) alla fine dell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="4b2a3-171">Nozioni di base sul API Graph</span><span class="sxs-lookup"><span data-stu-id="4b2a3-171">Basics of the Graph API</span></span>

<span data-ttu-id="4b2a3-172">[Il API Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) è l'interfaccia a livello di codice utilizzata per eseguire operazioni CRUD e altre operazioni sugli oggetti nella directory Azure ad.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="4b2a3-173">Se si seleziona un'opzione per l'account aziendale per l'autenticazione quando si crea un nuovo progetto in Visual Studio 2013, l'applicazione sarà già configurata per chiamare il API Graph.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="4b2a3-174">Questa sezione illustra brevemente il funzionamento del API Graph.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="4b2a3-175">Nell'applicazione in esecuzione fare clic sul nome dell'utente connesso in alto a destra nella pagina.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="4b2a3-176">Verrà visualizzata la pagina del profilo utente, che è un'azione nel controller Home.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="4b2a3-177">Si noterà che la tabella contiene informazioni utente sull'account amministratore creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="4b2a3-178">Queste informazioni vengono archiviate nella directory e il API Graph viene chiamato per recuperare queste informazioni quando viene caricata la pagina.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="4b2a3-179">Tornare a Visual Studio ed espandere la cartella **Controllers** , quindi aprire il file **HomeController.cs** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="4b2a3-180">Verrà visualizzata un'azione **USERPROFILE ()** che contiene il codice per recuperare un token e quindi chiamare il API Graph.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="4b2a3-181">Questo codice è duplicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="4b2a3-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="4b2a3-182">Per chiamare il API Graph, è innanzitutto necessario recuperare un token.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="4b2a3-183">Quando il token viene recuperato, il relativo valore stringa deve essere accodato nell'intestazione di autorizzazione per tutte le richieste successive al API Graph.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="4b2a3-184">La maggior parte del codice precedente gestisce i dettagli dell'autenticazione per Azure AD per ottenere un token, usando il token per effettuare una chiamata al API Graph e quindi trasformando la risposta in modo che possa essere visualizzata nella visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="4b2a3-185">La parte più rilevante per la discussione è la seguente riga evidenziata: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="4b2a3-186">Questa riga rappresenta il nome dell'utente, che è stato deserializzato dalla risposta JSON e viene visualizzato nella vista.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="4b2a3-187">È possibile chiamare il API Graph usando HttpClient e gestire manualmente i dati non elaborati, ma un modo più semplice consiste nell'usare la [libreria client Graph, disponibile tramite NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="4b2a3-188">La libreria client gestisce automaticamente le richieste HTTP non elaborate e la trasformazione dei dati restituiti e rende molto più semplice lavorare con il API Graph in un ambiente .NET.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="4b2a3-189">Vedere gli esempi di codice API Graph correlati su [github.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="4b2a3-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="4b2a3-190">Distribuire l'applicazione in Azure</span><span class="sxs-lookup"><span data-stu-id="4b2a3-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="4b2a3-191">Nei passaggi seguenti viene illustrato come distribuire l'applicazione in Azure.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="4b2a3-192">Nei passaggi precedenti è stato connesso il nuovo progetto a un'app Web in Azure, quindi è pronto per essere pubblicato in pochi passaggi.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="4b2a3-193">In Visual Studio fare clic con il pulsante destro del mouse sul progetto e scegliere **pubblica**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="4b2a3-194">Verrà visualizzata la finestra di dialogo **pubblica sul Web** con ogni impostazione già configurata.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="4b2a3-195">Fare clic sul pulsante **Avanti** per passare alla pagina **Impostazioni** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="4b2a3-196">Potrebbe essere richiesto di eseguire l'autenticazione; Assicurarsi di eseguire l'autenticazione usando l'account della sottoscrizione di Azure (in genere un account Microsoft) e non l'account aziendale creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="4b2a3-197">Selezionare l'opzione **Enable Organizational Authentication** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="4b2a3-198">Nel campo **dominio** immettere il dominio per la directory.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="4b2a3-199">Dall'elenco a discesa **livello di accesso** selezionare **Single Sign-on, lettura dati directory**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="4b2a3-200">Si noterà che il database precedente utilizzato è già popolato nella sezione **database** .</span><span class="sxs-lookup"><span data-stu-id="4b2a3-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="4b2a3-201">Fare clic su **Pubblica**.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="4b2a3-202">Visual Studio inizierà la distribuzione del sito Web e quindi verrà visualizzata una nuova finestra del browser.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="4b2a3-203">Potrebbe essere richiesto di eseguire di nuovo l'autenticazione alla directory.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="4b2a3-204">Una volta eseguita l'autenticazione, si verrà reindirizzati al sito Web appena pubblicato in Azure.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="4b2a3-205">Debug dell'app</span><span class="sxs-lookup"><span data-stu-id="4b2a3-205">Debugging the app</span></span>

<span data-ttu-id="4b2a3-206">Se viene ricevuto il seguente errore: il valore non può essere null o vuoto.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="4b2a3-207">Nome parametro: linkText</span><span class="sxs-lookup"><span data-stu-id="4b2a3-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)

<span data-ttu-id="4b2a3-208">Sostituire il codice nel file *Views\Shared\\_LoginPartial. cshtml* con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4b2a3-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="4b2a3-209">Dopo aver eseguito l'app, se l'utente connesso Visualizza "utente null", disconnettersi ed eseguire di nuovo l'accesso con l'account Active Directory creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="4b2a3-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="4b2a3-210">Un'eccellente esercitazione da seguire è il approfondimento di Rick Rainy [: siti Web di Azure e autenticazione organizzativa con Azure ad](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="4b2a3-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="4b2a3-211">Altre informazioni</span><span class="sxs-lookup"><span data-stu-id="4b2a3-211">More Information</span></span>

- [<span data-ttu-id="4b2a3-212">Approfondimento: siti Web di Azure e autenticazione organizzativa con Azure AD</span><span class="sxs-lookup"><span data-stu-id="4b2a3-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="4b2a3-213">Panoramica di API Graph Azure AD</span><span class="sxs-lookup"><span data-stu-id="4b2a3-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="4b2a3-214">Scenari di autenticazione in Azure AD</span><span class="sxs-lookup"><span data-stu-id="4b2a3-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="4b2a3-215">Esempi di codice Azure AD su GitHub</span><span class="sxs-lookup"><span data-stu-id="4b2a3-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
