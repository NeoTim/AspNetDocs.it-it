---
title: Convalida del modello in ASP.NET Core MVC
author: tdykstra
description: Informazioni sulla convalida del modello in ASP.NET Core MVC.
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049068"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="c5bc6-103">Convalida del modello in ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="c5bc6-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="c5bc6-104">[Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="c5bc6-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="c5bc6-105">Introduzione alla convalida del modello</span><span class="sxs-lookup"><span data-stu-id="c5bc6-105">Introduction to model validation</span></span>

<span data-ttu-id="c5bc6-106">Prima di essere archiviati in un database, i dati devono essere convalidati dall'app.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="c5bc6-107">I dati devono essere controllati per escludere potenziali minacce alla sicurezza. È anche necessario verificare anche che il tipo e le dimensioni dei dati abbiano il formato corretto e che i dati siano conformi alle regole.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="c5bc6-108">Nonostante l'implementazione della convalida sia un'attività ridondante e noiosa, la convalida è un processo necessario.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="c5bc6-109">In MVC la convalida viene eseguita sia nel client sia nel server.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="c5bc6-110">Fortunatamente, in .NET la convalida viene astratta in attributi di convalida,</span><span class="sxs-lookup"><span data-stu-id="c5bc6-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="c5bc6-111">che contengono codice di convalida, riducendo così la quantità di codice da scrivere.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="c5bc6-112">In ASP.NET Core 2.2 e versioni successive, il runtime di ASP.NET Core blocca (ignora) la convalida se può determinare che un determinato grafo del modello non richiede la convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="c5bc6-113">Ignorare la convalida può consentire miglioramenti significativi delle prestazioni durante la convalida di modelli che non possono avere o non hanno controlli server di convalida associati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="c5bc6-114">La convalida ignorata include oggetti quali raccolte di primitive (`byte[]`, `string[]`, `Dictionary<string, string>` e così via) o grafi di oggetti complessi senza controllo server di convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="c5bc6-115">[Visualizzare o scaricare un esempio da GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="c5bc6-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="c5bc6-116">Attributi di convalida</span><span class="sxs-lookup"><span data-stu-id="c5bc6-116">Validation Attributes</span></span>

<span data-ttu-id="c5bc6-117">Gli attributi di convalida consentono di configurare la convalida. Concettualmente assomigliano alla convalida nei campi delle tabelle del database.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="c5bc6-118">Esistono vincoli, ad esempio l'assegnazione di tipi di dati o campi obbligatori.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="c5bc6-119">Altri tipi di convalida includono l'uso di modelli di dati per applicare le regole di business, ad esempio una carta di credito, il numero di telefono o un indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="c5bc6-120">Grazie agli attributi di convalida l'applicazione di questi requisiti si rivela più semplice e facile.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="c5bc6-121">Gli attributi di convalida sono specificati a livello di proprietà:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="c5bc6-122">Di seguito è riportato un modello `Movie` con annotazioni relativo a un'app che archivia informazioni su film e programmi televisivi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="c5bc6-123">È necessaria la maggior parte delle proprietà e alcune proprietà stringa devono essere conformi a requisiti di lunghezza.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="c5bc6-124">Esiste anche una limitazione per l'intervallo numerico che si applica alla proprietà `Price` da 0 a 999.99 dollari insieme a un attributo di convalida personalizzato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="c5bc6-125">È sufficiente leggere il modello per conoscere le regole relative ai dati per questa app, semplificando così la gestione del codice.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="c5bc6-126">Di seguito sono descritti alcuni degli attributi di convalida predefiniti più comuni:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="c5bc6-127">`[CreditCard]`: convalida che la proprietà abbia un formato di carta di credito.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="c5bc6-128">`[Compare]`: convalida che due proprietà abbiano corrispondenza in un modello.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="c5bc6-129">`[EmailAddress]`: convalida che la proprietà abbia un formato di indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="c5bc6-130">`[Phone]`: convalida che la proprietà abbia un formato di telefono.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="c5bc6-131">`[Range]`: convalida che il valore della proprietà rientri nell'intervallo specificato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="c5bc6-132">`[RegularExpression]`: convalida che i dati corrispondano all'espressione regolare specificata.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="c5bc6-133">`[Required]`: rende obbligatoria una proprietà.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="c5bc6-134">`[StringLength]`: convalida che una proprietà stringa non superi la lunghezza massima specificata.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="c5bc6-135">`[Url]`: convalida che la proprietà abbia un formato di URL.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="c5bc6-136">A scopo di convalida, MVC supporta tutti gli attributi derivati da `ValidationAttribute`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="c5bc6-137">Nello spazio dei nomi [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) è possibile trovare molti attributi di convalida utili.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="c5bc6-138">Esistono delle istanze in cui potrebbero essere necessarie altre funzionalità rispetto a quelle offerte dagli attributi predefiniti.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="c5bc6-139">In tali casi, è possibile personalizzare gli attributi di convalida derivando da `ValidationAttribute` o modificando il modello per implementare `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="c5bc6-140">Note sull'uso dell'attributo Required</span><span class="sxs-lookup"><span data-stu-id="c5bc6-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="c5bc6-141">I [tipi valore](/dotnet/csharp/language-reference/keywords/value-types) non nullable (ad esempio `decimal`, `int`, `float` e `DateTime`) sono intrinsecamente necessari e non richiedono l'attributo `Required`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="c5bc6-142">L'app non esegue controlli di convalida lato server per i tipi non nullable contrassegnati con `Required`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="c5bc6-143">L'associazione di modelli MVC, che non si occupa di convalida e di attributi di convalida, rifiuta l'invio di campi modulo che contengono un valore mancante o uno spazio vuoto per un tipo non nullable.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="c5bc6-144">In assenza di un attributo `BindRequired` nella proprietà di destinazione, l'associazione di modelli ignora i dati mancanti per i tipi non nullable dove il campo modulo manca nei dati modulo in ingresso.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="c5bc6-145">L'[attributo BindRequired](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (vedere anche <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) è utile per verificare che i dati del modulo siano completi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="c5bc6-146">Se è applicato a una proprietà, il sistema di associazione di modelli richiede un valore per tale proprietà.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="c5bc6-147">Quando è applicato a un tipo, il sistema di associazione di modelli richiede i valori per tutte le proprietà di quel tipo.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="c5bc6-148">Quando si usa un [tipo Nullable\<T >](/dotnet/csharp/programming-guide/nullable-types/) (ad esempio, `decimal?` o `System.Nullable<decimal>`) e lo si contrassegna con `Required`, viene eseguito un controllo di convalida lato server come se la proprietà fosse un tipo nullable standard, ad esempio `string`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="c5bc6-149">La convalida lato client richiede un valore per un campo modulo corrispondente a una proprietà del modello che è stata contrassegnata con `Required` e per una proprietà di tipo non nullable che non è stata contrassegnata con `Required`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="c5bc6-150">È possibile usare `Required` per controllare il messaggio di errore di convalida lato client.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="c5bc6-151">Convalida del nodo di primo livello</span><span class="sxs-lookup"><span data-stu-id="c5bc6-151">Top-level node validation</span></span>

<span data-ttu-id="c5bc6-152">I nodi di primo livello includono:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-152">Top-level nodes include:</span></span>

* <span data-ttu-id="c5bc6-153">Parametri di azione</span><span class="sxs-lookup"><span data-stu-id="c5bc6-153">Action parameters</span></span>
* <span data-ttu-id="c5bc6-154">Proprietà del controller</span><span class="sxs-lookup"><span data-stu-id="c5bc6-154">Controller properties</span></span>
* <span data-ttu-id="c5bc6-155">Parametri del gestore di pagina</span><span class="sxs-lookup"><span data-stu-id="c5bc6-155">Page handler parameters</span></span>
* <span data-ttu-id="c5bc6-156">Proprietà del modello di pagina</span><span class="sxs-lookup"><span data-stu-id="c5bc6-156">Page model properties</span></span>

<span data-ttu-id="c5bc6-157">Vengono convalidati i nodi di primo livello associati al modello, oltre a convalidare le proprietà del modello.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="c5bc6-158">Nell'esempio seguente dall'app di esempio, il metodo `VerifyPhone` usa <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> per convalidare i dati utente nel campo Phone di un modulo:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="c5bc6-159">I nodi di primo livello possono usare <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> con gli attributi di convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="c5bc6-160">Nell'esempio seguente dall'app di esempio, il metodo `CheckAge` specifica che il parametro `age` deve essere associato dalla stringa di query quando viene inviato il modulo:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="c5bc6-161">La pagina Check Age (*CheckAge.cshtml*), include due moduli.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="c5bc6-162">Il primo modulo invia un valore `Age` `99` come stringa di query: `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="c5bc6-163">Quando viene inviato un parametro correttamente formattato `age` dalla stringa di query, il modulo viene convalidato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="c5bc6-164">Il secondo modulo nella pagina Check Age invia il valore `Age` nel corpo della richiesta e la convalida ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="c5bc6-165">L'associazione non riesce perché il parametro `age` deve provenire da una stringa di query.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="c5bc6-166">La convalida è abilitata per impostazione predefinita e controllata dalla proprietà <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> di <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="c5bc6-167">Per disabilitare la convalida del nodo di primo livello, impostare `AllowValidatingTopLevelNodes` su `false` nelle opzioni di MVC (`Startup.ConfigureServices`):</span><span class="sxs-lookup"><span data-stu-id="c5bc6-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="c5bc6-168">Stato del modello</span><span class="sxs-lookup"><span data-stu-id="c5bc6-168">Model State</span></span>

<span data-ttu-id="c5bc6-169">Lo stato del modello rappresenta gli errori di convalida nei valori del modulo HTML inviati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="c5bc6-170">MVC continua a eseguire la convalida dei campi fino al raggiungimento del numero massimo di errori (200 per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="c5bc6-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="c5bc6-171">È possibile configurare questo numero con il codice seguente in `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="c5bc6-172">Gestire gli errori dello stato del modello</span><span class="sxs-lookup"><span data-stu-id="c5bc6-172">Handle Model State errors</span></span>

<span data-ttu-id="c5bc6-173">La convalida del modello avviene prima dell'esecuzione di un'azione del controller.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="c5bc6-174">È responsabilità dell'azione esaminare `ModelState.IsValid` e rispondere nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="c5bc6-175">In molti casi, la reazione appropriata consiste nel restituire una risposta di errore, specificando nel dettaglio il motivo per cui è la convalida del modello non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="c5bc6-176">Quando `ModelState.IsValid` restituisce `false` nei controller dell'API Web usando l'attributo `[ApiController]`, viene restituita una risposta HTTP 400 automatica contenente i dettagli del problema.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="c5bc6-177">Per altre informazioni, vedere [Risposte HTTP 400 automatiche](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="c5bc6-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="c5bc6-178">Alcune app scelgono di seguire una convenzione standard per gestire gli errori di convalida del modello. Nel tal caso il filtro può essere l'elemento adatto in cui implementare tali criteri.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="c5bc6-179">È consigliabile testare il comportamento delle azioni in caso di stati del modello validi e non validi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="c5bc6-180">Convalida manuale</span><span class="sxs-lookup"><span data-stu-id="c5bc6-180">Manual validation</span></span>

<span data-ttu-id="c5bc6-181">Dopo aver completato le operazioni di convalida e associazione di modelli, può essere necessario ripeterne alcune parti.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="c5bc6-182">Ad esempio, un utente ha immesso un testo in un campo in cui è previsto un numero intero oppure deve essere calcolato un valore per una proprietà del modello.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="c5bc6-183">Può essere necessario eseguire quindi la convalida manualmente.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-183">You may need to run validation manually.</span></span> <span data-ttu-id="c5bc6-184">A tale scopo, chiamare il metodo `TryValidateModel`, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="c5bc6-185">Convalida personalizzata</span><span class="sxs-lookup"><span data-stu-id="c5bc6-185">Custom validation</span></span>

<span data-ttu-id="c5bc6-186">Gli attributi di convalida possono essere applicati nella maggior parte dei casi di convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="c5bc6-187">Esistono tuttavia regole di business specifiche.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="c5bc6-188">È possibile che alcune regole non siano tecniche comuni di convalida dei dati. Può essere ad esempio necessario garantire che un campo sia obbligatorio o che sia conforme a un intervallo di valori.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="c5bc6-189">Per questi scenari, gli attributi di convalida personalizzati sono una soluzione efficace.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="c5bc6-190">Creare attributi di convalida personalizzati in MVC è un'operazione semplice.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="c5bc6-191">È sufficiente ereditare da `ValidationAttribute` ed eseguire l'override del metodo `IsValid`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="c5bc6-192">Il metodo `IsValid` accetta due parametri, il primo è un oggetto denominato *value*, il secondo è un oggetto `ValidationContext` denominato *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="c5bc6-193">L'oggetto *value* si riferisce al valore effettivo del campo di cui il validator personalizzato esegue la convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="c5bc6-194">Nell'esempio seguente, sulla base di una regola di business, non è possibile impostare il genere su *Classic* se l'uscita del film è successiva all'anno 1960.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="c5bc6-195">L'attributo `[ClassicMovie]` prima controlla il genere e, nel caso in cui sia un classico, verifica se la data di uscita è successiva al 1960.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="c5bc6-196">Se il film è uscito dopo il 1960, la convalida non riesce.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="c5bc6-197">L'attributo accetta un parametro integer rappresentante l'anno che è possibile usare per convalidare i dati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="c5bc6-198">Il valore del parametro può essere acquisito nel costruttore dell'attributo, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="c5bc6-199">La variabile `movie` specificata sopra rappresenta un oggetto `Movie` contenente i dati dell'invio del modulo da convalidare.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="c5bc6-200">In questo caso il codice di convalida controlla la data e il genere nel metodo `IsValid` della classe `ClassicMovieAttribute` sulla base delle regole.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="c5bc6-201">Se la convalida ha esito positivo,`IsValid` restituisce un codice `ValidationResult.Success`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="c5bc6-202">Se la convalida non ha esito positivo, viene restituito un codice `ValidationResult` con un messaggio di errore:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="c5bc6-203">Quando un utente modifica il campo `Genre` e invia il modulo, il metodo `IsValid` della classe `ClassicMovieAttribute` verifica se il film sia un classico.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="c5bc6-204">Come fosse un attributo predefinito, applicare la classe `ClassicMovieAttribute` a una proprietà, ad esempio `ReleaseDate`, per garantire che la convalida venga eseguita, come illustrato nell'esempio di codice precedente.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="c5bc6-205">Poiché l'esempio funziona solo con tipi `Movie`, è consigliabile usare `IValidatableObject` come illustrato nel paragrafo seguente.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="c5bc6-206">In alternativa, questo stesso codice può essere inserito nel modello implementando il metodo `Validate` nell'interfaccia `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="c5bc6-207">Mentre gli attributi di convalida personalizzati sono adatti per la convalida di singole proprietà, l'implementazione di `IValidatableObject` può essere usata per implementare la convalida a livello di classe:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="c5bc6-208">Convalida lato client</span><span class="sxs-lookup"><span data-stu-id="c5bc6-208">Client side validation</span></span>

<span data-ttu-id="c5bc6-209">La convalida lato client è un'operazione molto comoda.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="c5bc6-210">Consente infatti agli utenti di ridurre i tempi di attesa di un round trip a un server.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="c5bc6-211">In termini di business, anche poche frazioni di secondo moltiplicate per centinaia di volte al giorno contribuiscono all'aumento di tempo, costi e frustrazione.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="c5bc6-212">Grazie a un processo di convalida semplice e immediato, gli utenti possono lavorare in modo più efficiente e garantire input e output di qualità elevata.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="c5bc6-213">Perché la convalida lato client sia eseguita come illustrato di seguito, è necessario avere una visualizzazione con i riferimenti agli script JavaScript corretti.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="c5bc6-214">Lo script [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) è una libreria front-end Microsoft personalizzata che si basa sul noto plug-in [jQuery Validate](https://jqueryvalidation.org/).</span><span class="sxs-lookup"><span data-stu-id="c5bc6-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="c5bc6-215">Senza Query Unobtrusive Validation, sarebbe necessario scrivere il codice della stessa logica di convalida in due posizioni, vale a dire negli attributi di convalida lato server nelle proprietà del modello e nuovamente negli script lato client. Gli esempi del metodo [`validate()`](https://jqueryvalidation.org/validate/) jQuery Validate illustrano quanto sarebbe complessa questa operazione.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="c5bc6-216">Invece, grazie agli [helper tag](xref:mvc/views/tag-helpers/intro)e agli [helper HTML](xref:mvc/views/overview) di MVC è possibile usare gli attributi di convalida e i metadati di tipo delle proprietà del modello per eseguire il rendering degli [attributi data-](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) HTML 5 negli elementi del modulo che devono essere convalidati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="c5bc6-217">MVC genera gli attributi `data-` sia per gli attributi predefiniti sia per quelli personalizzati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="c5bc6-218">jQuery Unobtrusive Validation analizza quindi gli attributi `data-` e passa la logica a jQuery Validate, "copiando" in modo efficace la logica di convalida lato server nel client.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="c5bc6-219">È possibile visualizzare gli errori di convalida nel client tramite gli helper tag rilevanti, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="c5bc6-220">Gli helper tag precedenti eseguono il rendering del modulo HTML specificato di seguito.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="c5bc6-221">Si noti che gli attributi `data-` nell'output HTML corrispondono agli attributi di convalida per la proprietà `ReleaseDate`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="c5bc6-222">L'attributo `data-val-required` seguente contiene un messaggio di errore che viene visualizzato se l'utente non compila il campo relativo alla data di uscita.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="c5bc6-223">Lo script jQuery Unobtrusive Validation passa questo valore al metodo [`required()`](https://jqueryvalidation.org/required-method/) jQuery Validate, che visualizza il messaggio nell'elemento **\<span>** di accompagnamento.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="c5bc6-224">La convalida lato client non consente l'invio del modulo finché non è ritenuto valido.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="c5bc6-225">Tramite il pulsante Invia viene eseguito JavaScript, che invia il modulo oppure visualizza i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="c5bc6-226">MVC determina i valori attributo del tipo sulla base del tipo di dati .NET di una proprietà, di cui è stato possibilmente eseguito l'override tramite gli attributi `[DataType]`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="c5bc6-227">L'attributo `[DataType]` di base non esegue la vera convalida lato server.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="c5bc6-228">I browser selezionano i messaggi di errore e visualizzano gli errori a proprio piacimento. Il pacchetto jQuery Validation Unobtrusive può tuttavia eseguire l'override dei messaggi e visualizzarli insieme ad altri.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="c5bc6-229">Questo avviene soprattutto quando gli utenti applicano le sottoclassi `[DataType]`, ad esempio `[EmailAddress]`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="c5bc6-230">Aggiungere la convalida a moduli dinamici</span><span class="sxs-lookup"><span data-stu-id="c5bc6-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="c5bc6-231">Quando la pagina viene caricata, jQuery Unobtrusive Validation passa la logica e i parametri di convalida a jQuery Validate. I moduli generati in modo dinamico non presentano quindi automaticamente la convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="c5bc6-232">È invece necessario chiedere a jQuery Unobtrusive Validation di analizzare il modulo dinamico immediatamente dopo essere stato creato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="c5bc6-233">Il codice riportato di seguito illustra ad esempio come configurare la convalida lato client in un modulo che è stato aggiunto tramite AJAX.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="c5bc6-234">Il metodo `$.validator.unobtrusive.parse()` accetta un selettore jQuery per ogni argomento.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="c5bc6-235">Questo metodo indica a jQuery Unobtrusive Validation di analizzare gli attributi `data-` dei moduli all'interno di tale tipo di selettore.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="c5bc6-236">I valori di questi attributi vengono quindi passati al plug-in jQuery Validate in modo che il modulo presenti le regole di convalida lato client necessarie.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="c5bc6-237">Aggiungere la convalida a controlli dinamici</span><span class="sxs-lookup"><span data-stu-id="c5bc6-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="c5bc6-238">È anche possibile aggiornare le regole di convalida in un modulo quando singoli controlli, ad esempio `<input/>` e `<select/>`, vengono generati in modo dinamico.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="c5bc6-239">Non è possibile passare direttamente i selettori per questi elementi al metodo `parse()` perché il modulo adiacente è già stato analizzato e non sarà aggiornato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="c5bc6-240">È quindi necessario rimuovere i dati di convalida esistenti, quindi rianalizzare l'intero modulo, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="c5bc6-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="c5bc6-241">IClientModelValidator</span></span>

<span data-ttu-id="c5bc6-242">È possibile creare una logica lato client per l'attributo personalizzato, in modo che la [convalida discreta](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) (che crea un adattatore per la [convalida jQuery](http://jqueryvalidation.org/documentation/)) la esegua automaticamente nel client come parte del processo di convalida.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="c5bc6-243">Prima di tutto è necessario controllare quali attributi data- vengono aggiunti implementando l'interfaccia `IClientModelValidator`, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="c5bc6-244">Gli attributi che implementano questa interfaccia possono aggiungere attributi HTML ai campi generati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="c5bc6-245">Esaminando l'output dell'elemento `ReleaseDate` si può notare che il codice HTML è simile all'esempio precedente, ad eccezione di un attributo `data-val-classicmovie` che è stato definito nel metodo `AddValidation` di `IClientModelValidator`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="c5bc6-246">La convalida discreta usa i dati negli attributi `data-` per visualizzare i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="c5bc6-247">jQuery non riconosce tuttavia le regole o i messaggi finché non vengono aggiunti all'oggetto `validator` di jQuery,</span><span class="sxs-lookup"><span data-stu-id="c5bc6-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="c5bc6-248">Questa operazione è illustrata nell'esempio seguente, che aggiunge una metodo di convalida client `classicmovie` personalizzato all'oggetto jQuery `validator`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="c5bc6-249">Per una spiegazione del metodo `unobtrusive.adapters.add`, vedere [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) (Unobtrusive Client Validation in MVC ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="c5bc6-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="c5bc6-250">Con il codice precedente, il metodo `classicmovie` esegue la convalida lato client alla data di pubblicazione del film.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="c5bc6-251">Viene visualizzato il messaggio di errore se il metodo restituisce `false`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="c5bc6-252">Convalida remota</span><span class="sxs-lookup"><span data-stu-id="c5bc6-252">Remote validation</span></span>

<span data-ttu-id="c5bc6-253">La convalida remota è una funzionalità utile da usare quando è necessario convalidare i dati nel client rispetto ai dati nel server.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="c5bc6-254">Ad esempio, l'app deve verificare se un nome utente o un indirizzo di posta elettronica è già in uso. A tale scopo deve eseguire una query su un enorme quantitativo di dati.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="c5bc6-255">Per scaricare grandi set di dati per la convalida di uno o di alcuni campi sono necessarie troppe risorse</span><span class="sxs-lookup"><span data-stu-id="c5bc6-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="c5bc6-256">e si corre il rischio di esporre informazioni riservate.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-256">It may also expose sensitive information.</span></span> <span data-ttu-id="c5bc6-257">In alternativa è possibile richiedere un round trip per la convalida di un campo.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="c5bc6-258">La convalida remota può essere implementata in un processo a due fasi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="c5bc6-259">Prima di tutto è necessario annotare il modello con l'attributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="c5bc6-260">L'attributo `[Remote]` accetta più overload da usare per indirizzare JavaScript lato client al codice appropriato da chiamare.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="c5bc6-261">Nell'esempio seguente si fa riferimento al metodo di azione `VerifyEmail` del controller `Users`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="c5bc6-262">Il secondo passaggio prevede l'inserimento di codice di convalida nel metodo di azione corrispondente come definito nell'attributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="c5bc6-263">In base alla documentazione del metodo [remote](https://jqueryvalidation.org/remote-method/) di jQuery Validate, la risposta del server deve essere una stringa JSON che può essere:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="c5bc6-264">`"true"` per gli elementi validi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="c5bc6-265">`"false"`, `undefined` o `null` per gli elementi non validi, usando il messaggio di errore predefinito.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="c5bc6-266">Se la risposta del server è una stringa (ad esempio, `"That name is already taken, try peter123 instead"`), la stringa viene visualizzata come messaggio di errore personalizzato al posto della stringa predefinita.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="c5bc6-267">La definizione del metodo `VerifyEmail` segue le regole illustrate di seguito.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="c5bc6-268">Restituisce un messaggio di errore di convalida se l'indirizzo di posta elettronica è usato oppure `true` se l'indirizzo è libero, ed esegue il wrapping del risultato in un oggetto `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="c5bc6-269">Il lato client può usare il valore restituito per continuare o visualizzare l'errore se necessario.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="c5bc6-270">A questo punto, quando viene immesso un indirizzo di posta elettronica, JavaScript esegue nella visualizzazione una chiamata remota per verificare se l'indirizzo è in uso, e in caso affermativo, visualizza il messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="c5bc6-271">In caso contrario, è possibile inviare il modulo come di consueto.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="c5bc6-272">La proprietà `[Remote]` dell'attributo `AdditionalFields` è utile per la convalida di combinazioni di campi rispetto ai dati nel server.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="c5bc6-273">Ad esempio, se il modello `User` precedente avesse due proprietà aggiuntive denominate `FirstName` e `LastName`, potrebbe essere necessario controllare che non siano esistenti utenti con la stessa coppia di nomi.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="c5bc6-274">Definire le nuove proprietà come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="c5bc6-275">Non è stato possibile impostare in modo esplicito `AdditionalFields` sulle stringhe `"FirstName"` e `"LastName"`, ma tramite l'operatore [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) il successivo refactoring risulta semplificato.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="c5bc6-276">Il metodo di azione per eseguire la convalida deve accettare due argomenti, uno per il valore di `FirstName` e uno per il valore di `LastName`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="c5bc6-277">A questo punto quando viene immesso un nome e un cognome, JavaScript:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="c5bc6-278">Effettua una chiamata remota per controllare se la coppia di nomi è stata usata.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="c5bc6-279">Se la coppia è stata usata, viene visualizzato un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="c5bc6-280">In caso contrario, l'utente può inviare il modulo.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="c5bc6-281">Se si vuole convalidare due o più campi aggiuntivi con l'attributo `[Remote]`,specificarli sotto forma di elenco delimitato da virgole.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="c5bc6-282">Ad esempio, per aggiungere la proprietà `MiddleName` al modello, impostare l'attributo `[Remote]` come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="c5bc6-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="c5bc6-283">`AdditionalFields`, come tutti gli argomenti dell'attributo, deve essere un'espressione costante.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="c5bc6-284">Non è quindi necessario usare una [stringa interpolata](/dotnet/csharp/language-reference/keywords/interpolated-strings) oppure chiamare <xref:System.String.Join*> per inizializzare `AdditionalFields`.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="c5bc6-285">Per ogni altro campo aggiunto all'attributo `[Remote]`, è necessario aggiungere un altro argomento al metodo di azione del controller corrispondente.</span><span class="sxs-lookup"><span data-stu-id="c5bc6-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
